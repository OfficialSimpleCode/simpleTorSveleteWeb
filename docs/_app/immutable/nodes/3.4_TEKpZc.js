var et=Object.defineProperty;var tt=(l,e,t)=>e in l?et(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var ne=(l,e,t)=>(tt(l,typeof e!="symbol"?e+"":e,t),t);import{s as Ee,e as h,c as m,b,f as _,o as i,q as ke,p as B,i as S,h as d,u as X,n as Se,a as D,g as C,r as rt,m as K,v as W,w as st,t as ce,d as fe,j as we}from"../chunks/scheduler.1vBHOY7w.js";import{S as De,i as Ce,c as Pe,a as Re,m as Ae,t as Z,g as at,e as lt,b as Y,d as Ne}from"../chunks/index.8wpad2h3.js";import{e as $e}from"../chunks/each.tW7fvVFW.js";import{I as nt}from"../chunks/InfoCircle.JN6ZOyrJ.js";import{d as ie,e as je,G as Ye,t as it,f as ot,V as ut,p as He,h as qe,j as oe,E as ue,k as ct,A as ft,P as dt,U as v,l as Q,m as Oe,n as pt,D as ht,o as mt,q as _t,r as vt,s as gt,v as bt,B as q,w as It,x as xe,N as ze,y as Gt}from"../chunks/business_initializer.N3GO8_43.js";import{V as We}from"../chunks/verification_helper.iRcmyJ09.js";function kt(l){let e,t,r,a,s,f,n;return{c(){e=h("div"),t=h("button"),r=h("img"),this.h()},l(g){e=m(g,"DIV",{class:!0});var o=b(e);t=m(o,"BUTTON",{class:!0});var u=b(t);r=m(u,"IMG",{class:!0,src:!0,alt:!0}),u.forEach(_),o.forEach(_),this.h()},h(){i(r,"class","w-10 h-10"),ke(r.src,a=ie[l[0]])||i(r,"src",a),i(r,"alt",s=ie[l[0]]),i(t,"class","btn sm:btn-lg btn-outline w-full"),B(t,"text-gray-500",l[1]!=l[0]),i(e,"class","icon")},m(g,o){S(g,e,o),d(e,t),d(t,r),f||(n=X(t,"click",l[3]),f=!0)},p(g,[o]){o&1&&!ke(r.src,a=ie[g[0]])&&i(r,"src",a),o&1&&s!==(s=ie[g[0]])&&i(r,"alt",s),o&3&&B(t,"text-gray-500",g[1]!=g[0])},i:Se,o:Se,d(g){g&&_(e),f=!1,n()}}}function yt(l,e,t){let{gender:r}=e,{pickedGender:a}=e,{handleClick:s}=e;const f=()=>s(r);return l.$$set=n=>{"gender"in n&&t(0,r=n.gender),"pickedGender"in n&&t(1,a=n.pickedGender),"handleClick"in n&&t(2,s=n.handleClick)},[r,a,s,f]}class Et extends De{constructor(e){super(),Ce(this,e,yt,kt,Ee,{gender:0,pickedGender:1,handleClick:2})}}function Ze(l,e,t){const r=l.slice();return r[2]=e[t],r[4]=t,r}function Je(l){let e,t;return e=new Et({props:{pickedGender:l[0],gender:l[2],handleClick:l[1]}}),{c(){Pe(e.$$.fragment)},l(r){Re(e.$$.fragment,r)},m(r,a){Ae(e,r,a),t=!0},p(r,a){const s={};a&1&&(s.pickedGender=r[0]),e.$set(s)},i(r){t||(Z(e.$$.fragment,r),t=!0)},o(r){Y(e.$$.fragment,r),t=!1},d(r){Ne(e,r)}}}function wt(l){let e,t,r,a,s;r=new nt({props:{message:"hello this is a test message for the info circle"}});let f=$e(je),n=[];for(let o=0;o<f.length;o+=1)n[o]=Je(Ze(l,f,o));const g=o=>Y(n[o],1,1,()=>{n[o]=null});return{c(){e=h("div"),t=h("section"),Pe(r.$$.fragment),a=D();for(let o=0;o<n.length;o+=1)n[o].c();this.h()},l(o){e=m(o,"DIV",{class:!0});var u=b(e);t=m(u,"SECTION",{class:!0});var c=b(t);Re(r.$$.fragment,c),a=C(c);for(let I=0;I<n.length;I+=1)n[I].l(c);c.forEach(_),u.forEach(_),this.h()},h(){i(t,"class","relative rounded-lg bg-base-100 p-6 flex items-center justify-center gap-10 w-full"),i(e,"class","form-control")},m(o,u){S(o,e,u),d(e,t),Ae(r,t,null),d(t,a);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(t,null);s=!0},p(o,[u]){if(u&3){f=$e(je);let c;for(c=0;c<f.length;c+=1){const I=Ze(o,f,c);n[c]?(n[c].p(I,u),Z(n[c],1)):(n[c]=Je(I),n[c].c(),Z(n[c],1),n[c].m(t,null))}for(at(),c=f.length;c<n.length;c+=1)g(c);lt()}},i(o){if(!s){Z(r.$$.fragment,o);for(let u=0;u<f.length;u+=1)Z(n[u]);s=!0}},o(o){Y(r.$$.fragment,o),n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)Y(n[u]);s=!1},d(o){o&&_(e),Ne(r),rt(n,o)}}}function Dt(l,e,t){let{pickedGender:r=Ye.male}=e;function a(s){t(0,r=s)}return l.$$set=s=>{"pickedGender"in s&&t(0,r=s.pickedGender)},[r,a]}class Ct extends De{constructor(e){super(),Ce(this,e,Dt,wt,Ee,{pickedGender:0})}}function Pt(l){return l===null||l===""||/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l)?null:it("invalidEmail")}const{v4:Rt}=Gt,ee=class ee{constructor(){ne(this,"userRepo",new ot);ne(this,"verificationRepo",new ut)}static GI(){return ee._singleton}async createUser({gender:e,phone:t,email:r,isVerifiedPhone:a,isVerifiedEmail:s,userName:f,authProvider:n,userId:g}){const o=await this.userRepo.getDocSRV({path:He,docId:qe(t)});if(o===void 0||o.exists()){oe.GI().error=ue.alreadyExistPhone;return}const u=new ct({id:g,name:f,email:r,isVerifiedPhone:a,isVerifiedEmail:s,phoneNumber:t,myBuisnessesIds:[],productsIds:{},lastVisitedBuisnessesRemoved:[],lastVisitedBuisnesses:[],revenueCatId:Rt(),gender:e});u.authProviders=n?new Map([[n,new Date]]):new Map;let c;if(n===ft.Phone&&a&&(c=await this.mergePhoneCollectionWithUser(u,t,{fromCreateUser:!0}),c||(u.isVerifiedPhone=!1)),!!await this.userRepo.createUser({user:u}))return c||new dt}async mergePhoneCollectionWithUser(e,t,{fromCreateUser:r=!1}){const a=await this.userRepo.mergePhoneDataWithUser({phone:t,userId:e.id,name:e.name});if(!(a===void 0&&oe.GI().error===ue.alreadyExistPhone))return a}async updateCreditCardsPassword(e,t){const r={},a={};return e!==""&&Object.entries(v.GI().user.paymentCards).forEach(([s,f])=>{Object.entries(f).forEach(([n,g])=>{const u=g.decryptCard(e).encryptCard(t);r[s]??(r[s]={}),r[s][n]=u,a[s]??(a[s]={}),a[s][n]=u.toJson()})}),await this.userRepo.updateMultipleFieldsInsideDocAsMapRepo({docId:v.GI().user.id,path:Q,data:{cardPaymentsPass:Oe(t),paymentCards:a}}).then(async s=>(s&&(v.GI().user.cardPaymentsPass=Oe(t),v.GI().user.paymentCards=r),s))}async updateEmail(e,{isVerified:t=!1}={}){return Pt(e)!==null?(oe.GI().error=ue.illegalFields,!1):e===v.GI().user.userPublicData.email?!0:pt(v.GI().user.lastTimeUpdateEmail,new ht({days:1}))>new Date?(oe.GI().error=ue.cantUpdateEmailTooShortTimeBetween,!1):(v.GI().user.userPublicData.email=e,await this.userRepo.updateMultipleFieldsInsideDocAsMapRepo({path:`${Q}/${v.GI().user.id}/${mt}`,docId:_t,data:{email:e,isVerifiedEmail:t}}).then(async r=>{if(r){v.GI().user.userPublicData.isVerifiedEmail=t;const a=new Date;return await this.userRepo.updateFieldInsideDocAsMapRepo({path:Q,docId:v.GI().user.id,fieldName:"lastTimeUpdateEmail",value:a.toString()}).then(s=>(s&&(v.GI().user.lastTimeUpdateEmail=a),s))}return r}))}async updateSeenUpdates(e,t){return new Set([...v.GI().user.seenUpdates[e]].filter(a=>t.has(a))).size===t.size?!0:(v.GI().user.seenUpdates[e]=new Set([...t]),await this.userRepo.updateFieldInsideDocAsMapRepo({path:Q,docId:v.GI().user.id,fieldName:`seenUpdates.${e}`,value:Array.from(t)}))}async setGender(e){return e===v.GI().user.gender?!0:(v.GI().user.gender=e,await this.userRepo.updatePublicUserField({userId:v.GI().user.id,fieldName:"gender",value:vt[e],businessesIds:Object.keys(v.GI().user.userPublicData.permission)}))}async updateName(e){if(e===v.GI().user.name)return!0;const t=v.GI().user;return t.name=e,await this.userRepo.updatePublicUserField({userId:t.id,businessesIds:Object.keys(t.userPublicData.permission),fieldName:"name",value:e}).then(async r=>{if(r){const a=[];t.userPublicData.myBuisnessesIds.forEach(s=>{a.push(this.userRepo.updateFieldInsideDocAsMapRepo({fieldName:"ownersName",docId:s,path:gt,value:e}).then(f=>{f&&s==bt.currentBusinesssId&&(q.GI().business.ownersName=e)}))}),t.isVerifiedPhone&&a.push(this.userRepo.updateFieldInsideDocAsMapRepo({fieldName:"name",docId:qe(t.phoneNumber),path:He,value:e})),await Promise.all(a)}return r})}async addOrRemoveLikeForStoryImage(e,t,r,a){var f;const s=await this.userRepo.updateFieldInsideDocAsArrayRepo({path:Q,docId:r,fieldName:"storyLikes",value:e,command:a});if(s){const n=((f=q.GI().workers[t])==null?void 0:f.storylikesAmount[e])??0;a===It.add?(await this.userRepo.incrementNumberChild({childPath:xe.GI().getLisksChildPath(t),valueId:e,delta:1,command:ze.increment}),v.GI().user.storyLikes.push(e),q.GI().workers[t]&&(q.GI().workers[t].storylikesAmount[e]=n+1)):(n>=0&&(await this.userRepo.incrementNumberChild({childPath:xe.GI().getLisksChildPath(t),valueId:e,delta:1,command:ze.decrement}),q.GI().workers[t]&&(q.GI().workers[t].storylikesAmount[e]=Math.max(q.GI().workers[t].storylikesAmount[e]-1,0))),v.GI().user.storyLikes=v.GI().user.storyLikes.filter(g=>g!=e))}return s}};ne(ee,"_singleton",new ee);let ye=ee;function Ke(l){let e,t,r;return{c(){e=h("label"),t=h("span"),r=ce(l[1]),this.h()},l(a){e=m(a,"LABEL",{class:!0,for:!0});var s=b(e);t=m(s,"SPAN",{class:!0});var f=b(t);r=fe(f,l[1]),f.forEach(_),s.forEach(_),this.h()},h(){i(t,"class","label-text-alt text-error"),i(e,"class","label"),i(e,"for","name")},m(a,s){S(a,e,s),d(e,t),d(t,r)},p(a,s){s&2&&we(r,a[1])},d(a){a&&_(e)}}}function Qe(l){let e,t,r;return{c(){e=h("label"),t=h("span"),r=ce(l[3]),this.h()},l(a){e=m(a,"LABEL",{class:!0,for:!0});var s=b(e);t=m(s,"SPAN",{class:!0});var f=b(t);r=fe(f,l[3]),f.forEach(_),s.forEach(_),this.h()},h(){i(t,"class","label-text-alt text-error"),i(e,"class","label"),i(e,"for","email")},m(a,s){S(a,e,s),d(e,t),d(t,r)},p(a,s){s&8&&we(r,a[3])},d(a){a&&_(e)}}}function Xe(l){let e,t,r;return{c(){e=h("label"),t=h("span"),r=ce(l[5]),this.h()},l(a){e=m(a,"LABEL",{class:!0,for:!0});var s=b(e);t=m(s,"SPAN",{class:!0});var f=b(t);r=fe(f,l[5]),f.forEach(_),s.forEach(_),this.h()},h(){i(t,"class","label-text-alt text-error"),i(e,"class","label"),i(e,"for","tle")},m(a,s){S(a,e,s),d(e,t),d(t,r)},p(a,s){s&32&&we(r,a[5])},d(a){a&&_(e)}}}function At(l){let e;return{c(){e=ce("Finish Setup")},l(t){e=fe(t,"Finish Setup")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function Nt(l){let e;return{c(){e=h("div"),this.h()},l(t){e=m(t,"DIV",{class:!0}),b(e).forEach(_),this.h()},h(){i(e,"class","loading loading-spinner")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function Lt(l){let e,t,r,a,s,f,n='<h1 class="text-4xl">Account Setup</h1> <h5 class="text-gray-500">Fast and Easy</h5>',g,o,u,c,I,te='<span class="label-text">Full Name</span>',J,k,re,de,R,T,Le='<span class="label-text">Email (optional)</span>',pe,P,he,me,A,M,Ue='<span class="label-text">Phone Number</span>',_e,N,ve,ge,$,be,V,F,Ie,j,Te='By clikcing &quot;Finish Setup&quot; you agree to our <a href="https://google.com" class="link link-neutral">privacy policy</a>',H,Ge,Me,y=l[1]&&Ke(l),E=l[3]&&Qe(l),w=l[5]&&Xe(l);$=new Ct({});function Ve(p,G){return p[6]?Nt:At}let se=Ve(l),U=se(l);return{c(){e=h("main"),t=h("img"),a=D(),s=h("div"),f=h("div"),f.innerHTML=n,g=D(),o=h("div"),u=h("form"),c=h("div"),I=h("label"),I.innerHTML=te,J=D(),k=h("input"),re=D(),y&&y.c(),de=D(),R=h("div"),T=h("label"),T.innerHTML=Le,pe=D(),P=h("input"),he=D(),E&&E.c(),me=D(),A=h("div"),M=h("label"),M.innerHTML=Ue,_e=D(),N=h("input"),ve=D(),w&&w.c(),ge=D(),Pe($.$$.fragment),be=D(),V=h("div"),F=h("button"),U.c(),Ie=D(),j=h("p"),j.innerHTML=Te,this.h()},l(p){e=m(p,"MAIN",{class:!0});var G=b(e);t=m(G,"IMG",{class:!0,src:!0,alt:!0}),a=C(G),s=m(G,"DIV",{class:!0});var ae=b(s);f=m(ae,"DIV",{class:!0,"data-svelte-h":!0}),K(f)!=="svelte-a62nps"&&(f.innerHTML=n),g=C(ae),o=m(ae,"DIV",{class:!0});var Fe=b(o);u=m(Fe,"FORM",{class:!0});var L=b(u);c=m(L,"DIV",{class:!0});var O=b(c);I=m(O,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),K(I)!=="svelte-13vww76"&&(I.innerHTML=te),J=C(O),k=m(O,"INPUT",{type:!0,placeholder:!0,class:!0}),re=C(O),y&&y.l(O),O.forEach(_),de=C(L),R=m(L,"DIV",{class:!0});var x=b(R);T=m(x,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),K(T)!=="svelte-10b9mpm"&&(T.innerHTML=Le),pe=C(x),P=m(x,"INPUT",{type:!0,placeholder:!0,class:!0}),he=C(x),E&&E.l(x),x.forEach(_),me=C(L),A=m(L,"DIV",{class:!0});var z=b(A);M=m(z,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),K(M)!=="svelte-155qqjv"&&(M.innerHTML=Ue),_e=C(z),N=m(z,"INPUT",{type:!0,placeholder:!0,class:!0}),ve=C(z),w&&w.l(z),z.forEach(_),ge=C(L),Re($.$$.fragment,L),be=C(L),V=m(L,"DIV",{class:!0});var le=b(V);F=m(le,"BUTTON",{class:!0});var Be=b(F);U.l(Be),Be.forEach(_),Ie=C(le),j=m(le,"P",{class:!0,"data-svelte-h":!0}),K(j)!=="svelte-1pf6a0t"&&(j.innerHTML=Te),le.forEach(_),L.forEach(_),Fe.forEach(_),ae.forEach(_),G.forEach(_),this.h()},h(){i(t,"class","flex-[1] w-full h-full object-cover hidden md:block"),ke(t.src,r="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.timeout.com%2Fimages%2F105689091%2Fimage.jpg&f=1&nofb=1&ipt=f4b5132df6bedb3677bcdbc6907999e648fa1cc14693e8a5494a845d2cf3ec8a&ipo=images")||i(t,"src",r),i(t,"alt","account-setup"),i(f,"class","text-center"),i(I,"class","label"),i(I,"for","name"),i(k,"type","text"),i(k,"placeholder","full name"),i(k,"class","input input-bordered"),k.required=!0,B(k,"input-error",l[1]),i(c,"class","form-control"),i(T,"class","label"),i(T,"for","email"),i(P,"type","email"),i(P,"placeholder","email"),i(P,"class","input input-bordered"),B(P,"input-error",l[3]),i(R,"class","form-control"),i(M,"class","label"),i(M,"for","tel"),i(N,"type","tel"),i(N,"placeholder","phone number"),i(N,"class","input input-bordered"),B(N,"input-error",l[5]),i(A,"class","form-control"),i(F,"class","btn btn-primary"),i(j,"class","text-gray-500 text-sm text-center mt-2"),i(V,"class","form-control mt-6"),i(u,"class","card-body"),i(o,"class","card shrink-0 w-full max-w-sm shadow-2xl bg-base-100"),i(s,"class","flex-[1] w-full h-full flex flex-col justify-center items-center gap-10"),i(e,"class","w-full h-full flex flex-row items-center")},m(p,G){S(p,e,G),d(e,t),d(e,a),d(e,s),d(s,f),d(s,g),d(s,o),d(o,u),d(u,c),d(c,I),d(c,J),d(c,k),W(k,l[0]),d(c,re),y&&y.m(c,null),d(u,de),d(u,R),d(R,T),d(R,pe),d(R,P),W(P,l[2]),d(R,he),E&&E.m(R,null),d(u,me),d(u,A),d(A,M),d(A,_e),d(A,N),W(N,l[4]),d(A,ve),w&&w.m(A,null),d(u,ge),Ae($,u,null),d(u,be),d(u,V),d(V,F),U.m(F,null),d(V,Ie),d(V,j),H=!0,Ge||(Me=[X(k,"input",l[8]),X(P,"input",l[9]),X(N,"input",l[10]),X(F,"click",l[7])],Ge=!0)},p(p,[G]){G&1&&k.value!==p[0]&&W(k,p[0]),(!H||G&2)&&B(k,"input-error",p[1]),p[1]?y?y.p(p,G):(y=Ke(p),y.c(),y.m(c,null)):y&&(y.d(1),y=null),G&4&&P.value!==p[2]&&W(P,p[2]),(!H||G&8)&&B(P,"input-error",p[3]),p[3]?E?E.p(p,G):(E=Qe(p),E.c(),E.m(R,null)):E&&(E.d(1),E=null),G&16&&W(N,p[4]),(!H||G&32)&&B(N,"input-error",p[5]),p[5]?w?w.p(p,G):(w=Xe(p),w.c(),w.m(A,null)):w&&(w.d(1),w=null),se!==(se=Ve(p))&&(U.d(1),U=se(p),U&&(U.c(),U.m(F,null)))},i(p){H||(Z($.$$.fragment,p),H=!0)},o(p){Y($.$$.fragment,p),H=!1},d(p){p&&_(e),y&&y.d(),E&&E.d(),w&&w.d(),Ne($),U.d(),Ge=!1,st(Me)}}}function Ut(l,e,t){let r,a="",s,f="",n,g="",o=Ye.anonymous,u=!1;function c(){t(6,u=!0);try{ye.GI().createUser({gender:o,userName:r,phone:n,email:s,isVerifiedEmail:!1,isVerifiedPhone:!1,userId:v.GI().userId,authProvider:We.GI().currentAuthProvider}).then(async k=>k==null?null:(v.GI().userDoc=void 0,await v.GI().setupUser({newUserId:We.GI().userId})?k:null))}finally{t(6,u=!1)}}function I(){r=this.value,t(0,r)}function te(){s=this.value,t(2,s)}function J(){n=this.value,t(4,n)}return[r,a,s,f,n,g,u,c,I,te,J]}class jt extends De{constructor(e){super(),Ce(this,e,Ut,Lt,Ee,{})}}export{jt as component};
