import{a0 as pl,a1 as ml,S as Yr,M as xl,s as f0,e as We,c as He,b as de,f as K,m as L,i as Fe,n as Ie,a as at,E as bo,g as ct,z as dt,t as Nn,A as ft,d as Rn,h as ae,j as On,k as Do,a2 as gl,a3 as _l,a4 as vl,a5 as yl,l as El}from"../chunks/scheduler.qq0X-z8z.js";import{g as Cl,b as nn,e as wl,t as sn,S as p0,i as m0,c as bl,a as Dl,m as Al,d as kl}from"../chunks/index.iLsa6CDC.js";import{c as Il}from"../chunks/ToastManager.SzRfv4XG.js";import{f as x0,d as Ao,A as Sl,V as Fl}from"../chunks/auth.WngGw762.js";import{g as Bl,w as Tl,c as be,d as De,a as Pl,r as Nl,e as ri,i as Qr,o as Rl,T as pt,b as ko}from"../chunks/Business._zEmDPLL.js";import{v as P,g as nr,D as Mn,b as Ol,c as Ml,a as vs,d as Ll,_ as Ul,C as Wl,r as Io,w as le,x as ys,y as $e,z as Hl,A as Vl,B as $l,H as qt,I as on,J as Ln,K as Un,e as Gl,M as Lr,L as zl,N as g0,O as ql,P as Kl,s as So,i as _0,h as Jl,q as Yl,Q as Ql,S as Xl,R as Zl,t as v0,u as y0}from"../chunks/google.o7afagPn.js";import{p as jl}from"../chunks/stores._zjBMy95.js";import{w as eh}from"../chunks/entry.fO-TIcSB.js";function th(n,e){const t=e.token={};function r(i,s,o,c){if(e.token!==t)return;e.resolved=c;let l=e.ctx;o!==void 0&&(l=l.slice(),l[o]=c);const a=i&&(e.current=i)(l);let h=!1;e.block&&(e.blocks?e.blocks.forEach((d,u)=>{u!==s&&d&&(Cl(),nn(d,1,1,()=>{e.blocks[u]===d&&(e.blocks[u]=null)}),wl())}):e.block.d(1),a.c(),sn(a,1),a.m(e.mount(),e.anchor),h=!0),e.block=a,e.blocks&&(e.blocks[s]=a),h&&xl()}if(pl(n)){const i=ml();if(n.then(s=>{Yr(i),r(e.then,1,e.value,s),Yr(null)},s=>{if(Yr(i),r(e.catch,2,e.error,s),Yr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,n),!0;e.resolved=n}}function rh(n,e,t){const r=e.slice(),{resolved:i}=n;n.current===n.then&&(r[n.value]=i),n.current===n.catch&&(r[n.error]=i),n.block.p(r,t)}const nh=!0,Sm=Object.freeze(Object.defineProperty({__proto__:null,prerender:nh},Symbol.toStringTag,{value:"Module"}));function Fo(n){let e,t,r,i,s=n[0].status=="info"&&Bo(n),o=n[0].status=="success"&&To(n),c=n[0].status=="fail"&&Po(n),l=n[0].status=="warning"&&No(n);return{c(){s&&s.c(),e=at(),o&&o.c(),t=at(),c&&c.c(),r=at(),l&&l.c(),i=bo()},l(a){s&&s.l(a),e=ct(a),o&&o.l(a),t=ct(a),c&&c.l(a),r=ct(a),l&&l.l(a),i=bo()},m(a,h){s&&s.m(a,h),Fe(a,e,h),o&&o.m(a,h),Fe(a,t,h),c&&c.m(a,h),Fe(a,r,h),l&&l.m(a,h),Fe(a,i,h)},p(a,h){a[0].status=="info"?s?s.p(a,h):(s=Bo(a),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),a[0].status=="success"?o?o.p(a,h):(o=To(a),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),a[0].status=="fail"?c?c.p(a,h):(c=Po(a),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null),a[0].status=="warning"?l?l.p(a,h):(l=No(a),l.c(),l.m(i.parentNode,i)):l&&(l.d(1),l=null)},d(a){a&&(K(e),K(t),K(r),K(i)),s&&s.d(a),o&&o.d(a),c&&c.d(a),l&&l.d(a)}}}function Bo(n){let e,t,r,i,s,o=n[0].text+"",c;return{c(){e=We("div"),t=dt("svg"),r=dt("path"),i=at(),s=We("span"),c=Nn(o),this.h()},l(l){e=He(l,"DIV",{role:!0,class:!0});var a=de(e);t=ft(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,class:!0});var h=de(t);r=ft(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),de(r).forEach(K),h.forEach(K),i=ct(a),s=He(a,"SPAN",{});var d=de(s);c=Rn(d,o),d.forEach(K),a.forEach(K),this.h()},h(){L(r,"stroke-linecap","round"),L(r,"stroke-linejoin","round"),L(r,"stroke-width","2"),L(r,"d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"),L(t,"xmlns","http://www.w3.org/2000/svg"),L(t,"fill","none"),L(t,"viewBox","0 0 24 24"),L(t,"class","stroke-current shrink-0 w-6 h-6"),L(e,"role","alert"),L(e,"class","alert alert-info")},m(l,a){Fe(l,e,a),ae(e,t),ae(t,r),ae(e,i),ae(e,s),ae(s,c)},p(l,a){a&1&&o!==(o=l[0].text+"")&&On(c,o)},d(l){l&&K(e)}}}function To(n){let e,t,r,i,s,o=n[0].text+"",c;return{c(){e=We("div"),t=dt("svg"),r=dt("path"),i=at(),s=We("span"),c=Nn(o),this.h()},l(l){e=He(l,"DIV",{role:!0,class:!0});var a=de(e);t=ft(a,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var h=de(t);r=ft(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),de(r).forEach(K),h.forEach(K),i=ct(a),s=He(a,"SPAN",{});var d=de(s);c=Rn(d,o),d.forEach(K),a.forEach(K),this.h()},h(){L(r,"stroke-linecap","round"),L(r,"stroke-linejoin","round"),L(r,"stroke-width","2"),L(r,"d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"),L(t,"xmlns","http://www.w3.org/2000/svg"),L(t,"class","stroke-current shrink-0 h-6 w-6"),L(t,"fill","none"),L(t,"viewBox","0 0 24 24"),L(e,"role","alert"),L(e,"class","alert alert-success")},m(l,a){Fe(l,e,a),ae(e,t),ae(t,r),ae(e,i),ae(e,s),ae(s,c)},p(l,a){a&1&&o!==(o=l[0].text+"")&&On(c,o)},d(l){l&&K(e)}}}function Po(n){let e,t,r,i,s,o=n[0].text+"",c;return{c(){e=We("div"),t=dt("svg"),r=dt("path"),i=at(),s=We("span"),c=Nn(o),this.h()},l(l){e=He(l,"DIV",{role:!0,class:!0});var a=de(e);t=ft(a,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var h=de(t);r=ft(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),de(r).forEach(K),h.forEach(K),i=ct(a),s=He(a,"SPAN",{});var d=de(s);c=Rn(d,o),d.forEach(K),a.forEach(K),this.h()},h(){L(r,"stroke-linecap","round"),L(r,"stroke-linejoin","round"),L(r,"stroke-width","2"),L(r,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),L(t,"xmlns","http://www.w3.org/2000/svg"),L(t,"class","stroke-current shrink-0 h-6 w-6"),L(t,"fill","none"),L(t,"viewBox","0 0 24 24"),L(e,"role","alert"),L(e,"class","alert alert-error")},m(l,a){Fe(l,e,a),ae(e,t),ae(t,r),ae(e,i),ae(e,s),ae(s,c)},p(l,a){a&1&&o!==(o=l[0].text+"")&&On(c,o)},d(l){l&&K(e)}}}function No(n){let e,t,r,i,s,o=n[0].text+"",c;return{c(){e=We("div"),t=dt("svg"),r=dt("path"),i=at(),s=We("span"),c=Nn(o),this.h()},l(l){e=He(l,"DIV",{role:!0,class:!0});var a=de(e);t=ft(a,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var h=de(t);r=ft(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),de(r).forEach(K),h.forEach(K),i=ct(a),s=He(a,"SPAN",{});var d=de(s);c=Rn(d,o),d.forEach(K),a.forEach(K),this.h()},h(){L(r,"stroke-linecap","round"),L(r,"stroke-linejoin","round"),L(r,"stroke-width","2"),L(r,"d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"),L(t,"xmlns","http://www.w3.org/2000/svg"),L(t,"class","stroke-current shrink-0 h-6 w-6"),L(t,"fill","none"),L(t,"viewBox","0 0 24 24"),L(e,"role","alert"),L(e,"class","alert alert-warning")},m(l,a){Fe(l,e,a),ae(e,t),ae(t,r),ae(e,i),ae(e,s),ae(s,c)},p(l,a){a&1&&o!==(o=l[0].text+"")&&On(c,o)},d(l){l&&K(e)}}}function ih(n){let e,t=n[0]!==null&&Fo(n);return{c(){e=We("div"),t&&t.c(),this.h()},l(r){e=He(r,"DIV",{id:!0,class:!0});var i=de(e);t&&t.l(i),i.forEach(K),this.h()},h(){L(e,"id","toast"),L(e,"class","fixed bottom-8 right-12 min-w-[250px] z-50")},m(r,i){Fe(r,e,i),t&&t.m(e,null)},p(r,[i]){r[0]!==null?t?t.p(r,i):(t=Fo(r),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:Ie,o:Ie,d(r){r&&K(e),t&&t.d()}}}function sh(n,e,t){let r;return Il.subscribe(i=>t(0,r=i)),[r]}class oh extends p0{constructor(e){super(),m0(this,e,sh,ih,f0,{})}}const ah="production",ye=`enviroments/${ah}`,Ir="Users",ch="BookingsObjects",lh="Errors",Ro="Helpers",vr="PublicData",Xr="Workers",Oo="Bookings",nt="Businesses",hh="Reports",yr="publicData",uh="recurrenceBookings",Mo="LikesCollection",Lo="BusinessData",dh="Counters",fh="sasimple",ph="phone",Uo="^&8@^",Wo="^&9@^",Qi={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]};function Xi(n,e,t,r=!1){const i=String(e),s=(l,a)=>`\x1B[${a[0]}m${l}\x1B[${a[1]}m`,o=(l,a)=>a!=null&&typeof a=="string"?s(l,Qi[a]):a!=null&&Array.isArray(a)?a.reduce((h,d)=>o(h,d),l):a!=null&&a[l.trim()]!=null?o(l,a[l.trim()]):a!=null&&a["*"]!=null?o(l,a["*"]):l,c=null;return i.replace(/{{(.+?)}}/g,(l,a)=>{const h=t[a]!=null?String(t[a]):r?"":l;return n.stylePrettyLogs?o(h,n?.prettyLogStyles?.[a]??c)+s("",Qi.reset):h})}function ke(n,e=2,t=0){return n!=null&&isNaN(n)?"":(n=n!=null?n+t:n,e===2?n==null?"--":n<10?"0"+n:n.toString():n==null?"---":n<10?"00"+n:n<100?"0"+n:n.toString())}function mh(n){return{href:n.href,protocol:n.protocol,username:n.username,password:n.password,host:n.host,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search,searchParams:[...n.searchParams].map(([e,t])=>({key:e,value:t})),hash:n.hash,origin:n.origin}}function E0(n){const e=new Set;return JSON.stringify(n,(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return r})}function Se(n,e){const t={seen:[],stylize:C0};return e!=null&&A0(t,e),Mt(t.showHidden)&&(t.showHidden=!1),Mt(t.depth)&&(t.depth=2),Mt(t.colors)&&(t.colors=!0),Mt(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=gh),an(t,n,t.depth)}Se.colors=Qi;Se.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function xh(n){return typeof n=="boolean"}function Mt(n){return n===void 0}function C0(n){return n}function gh(n,e){const t=Se.styles[e];return t!=null&&Se?.colors?.[t]?.[0]!=null&&Se?.colors?.[t]?.[1]!=null?"\x1B["+Se.colors[t][0]+"m"+n+"\x1B["+Se.colors[t][1]+"m":n}function Zr(n){return typeof n=="function"}function w0(n){return typeof n=="string"}function _h(n){return typeof n=="number"}function b0(n){return n===null}function D0(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ni(n){return Wn(n)&&Es(n)==="[object RegExp]"}function Wn(n){return typeof n=="object"&&n!==null}function ii(n){return Wn(n)&&(Es(n)==="[object Error]"||n instanceof Error)}function Ho(n){return Wn(n)&&Es(n)==="[object Date]"}function Es(n){return Object.prototype.toString.call(n)}function vh(n){const e={};return n.forEach(t=>{e[t]=!0}),e}function yh(n,e,t,r,i){const s=[];for(let o=0,c=e.length;o<c;++o)D0(e,String(o))?s.push(Zi(n,e,t,r,String(o),!0)):s.push("");return i.forEach(o=>{o.match(/^\d+$/)||s.push(Zi(n,e,t,r,o,!0))}),s}function si(n){return"["+Error.prototype.toString.call(n)+"]"}function an(n,e,t=0){if(n.customInspect&&e!=null&&Zr(e)&&e?.inspect!==Se&&!(e?.constructor&&e?.constructor.prototype===e)){if(typeof e.inspect!="function"&&e.toString!=null)return e.toString();let h=e?.inspect(t,n);return w0(h)||(h=an(n,h,t)),h}const r=rt(n,e);if(r)return r;let i=Object.keys(e);const s=vh(i);try{n.showHidden&&Object.getOwnPropertyNames&&(i=Object.getOwnPropertyNames(e))}catch{}if(ii(e)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return si(e);if(i.length===0)if(Zr(n.stylize)){if(Zr(e)){const h=e.name?": "+e.name:"";return n.stylize("[Function"+h+"]","special")}if(ni(e))return n.stylize(RegExp.prototype.toString.call(e),"regexp");if(Ho(e))return n.stylize(Date.prototype.toISOString.call(e),"date");if(ii(e))return si(e)}else return e;let o="",c=!1,l=[`{
`,`
}`];if(Array.isArray(e)&&(c=!0,l=[`[
`,`
]`]),Zr(e)&&(o=" [Function"+(e.name?": "+e.name:"")+"]"),ni(e)&&(o=" "+RegExp.prototype.toString.call(e)),Ho(e)&&(o=" "+Date.prototype.toUTCString.call(e)),ii(e)&&(o=" "+si(e)),i.length===0&&(!c||e.length==0))return l[0]+o+l[1];if(t<0)return ni(e)?n.stylize(RegExp.prototype.toString.call(e),"regexp"):n.stylize("[Object]","special");n.seen.push(e);let a;return c?a=yh(n,e,t,s,i):a=i.map(h=>Zi(n,e,t,s,h,c)),n.seen.pop(),Eh(a,o,l)}function Zi(n,e,t,r,i,s){let o,c,l={value:void 0};try{l.value=e[i]}catch{}try{Object.getOwnPropertyDescriptor&&(l=Object.getOwnPropertyDescriptor(e,i)||l)}catch{}if(l.get?l.set?c=n.stylize("[Getter/Setter]","special"):c=n.stylize("[Getter]","special"):l.set&&(c=n.stylize("[Setter]","special")),D0(r,i)||(o="["+i+"]"),c||(n.seen.indexOf(l.value)<0?(b0(t)?c=an(n,l.value,void 0):c=an(n,l.value,t-1),c.indexOf(`
`)>-1&&(s?c=c.split(`
`).map(a=>"  "+a).join(`
`).substr(2):c=`
`+c.split(`
`).map(a=>"   "+a).join(`
`))):c=n.stylize("[Circular]","special")),Mt(o)){if(s&&i.match(/^\d+$/))return c;o=JSON.stringify(""+i),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=n.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\\'").replace(/(^"|"$)/g,"'"),o=n.stylize(o,"string"))}return o+": "+c}function rt(n,e){if(Mt(e))return n.stylize("undefined","undefined");if(w0(e)){const t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\\'")+"'";return n.stylize(t,"string")}if(_h(e))return n.stylize(""+e,"number");if(xh(e))return n.stylize(""+e,"boolean");if(b0(e))return n.stylize("null","null")}function Eh(n,e,t){return t[0]+(e===""?"":e+`
`)+"  "+n.join(`,
  `)+" "+t[1]}function A0(n,e){if(!e||!Wn(e))return n;const t={...n},r={...e},i=Object.keys(e);let s=i.length;for(;s--;)t[i[s]]=r[i[s]];return n}function Ch(n,...e){const t={seen:[],stylize:C0};n!=null&&A0(t,n);const r=e[0];let i=0,s="",o="";if(typeof r=="string"){if(e.length===1)return r;let c,l=0;for(let a=0;a<r.length-1;a++)if(r.charCodeAt(a)===37){const h=r.charCodeAt(++a);if(i+1!==e.length){switch(h){case 115:{const d=e[++i];typeof d=="number"||typeof d=="bigint"?c=rt(t,d):typeof d!="object"||d===null?c=String(d):c=Se(d,{...n,compact:3,colors:!1,depth:0});break}case 106:c=E0(e[++i]);break;case 100:{const d=e[++i];typeof d=="bigint"?c=rt(t,d):typeof d=="symbol"?c="NaN":c=rt(t,d);break}case 79:c=Se(e[++i],n);break;case 111:c=Se(e[++i],{...n,showHidden:!0,showProxy:!0,depth:4});break;case 105:{const d=e[++i];typeof d=="bigint"?c=rt(t,d):typeof d=="symbol"?c="NaN":c=rt(t,parseInt(c));break}case 102:{const d=e[++i];typeof d=="symbol"?c="NaN":c=rt(t,parseInt(d));break}case 99:i+=1,c="";break;case 37:s+=r.slice(l,a),l=a+1;continue;default:continue}l!==a-1&&(s+=r.slice(l,a-1)),s+=c,l=a+1}else h===37&&(s+=r.slice(l,a),l=a+1)}l!==0&&(i++,o=" ",l<r.length&&(s+=r.slice(l)))}for(;i<e.length;){const c=e[i];s+=o,s+=typeof c!="string"?Se(c,n):c,o=" ",i++}return s}const wh={getCallerStackFrame:k0,getErrorTrace:I0,getMeta:Ah,transportJSON:Sh,transportFormatted:Ih,isBuffer:Fh,isError:F0,prettyFormatLogObj:kh,prettyFormatErrorObj:B0},bh={runtime:[typeof window,typeof document].includes("undefined")?"Generic":"Browser",browser:globalThis?.navigator?.userAgent},Dh=/(?:(?:file|https?|global code|[^@]+)@)?(?:file:)?((?:\/[^:/]+){2,})(?::(\d+))?(?::(\d+))?/;function Ah(n,e,t,r,i,s){return Object.assign({},bh,{name:i,parentNames:s,date:new Date,logLevelId:n,logLevelName:e,path:r?void 0:k0(t)})}function k0(n,e=Error()){return S0(e?.stack?.split(`
`)?.filter(t=>!t.includes("Error: "))?.[n])}function I0(n){return n?.stack?.split(`
`)?.filter(e=>!e.includes("Error: "))?.reduce((e,t)=>(e.push(S0(t)),e),[])}function S0(n){const e=globalThis?.location?.origin,t={fullFilePath:void 0,fileName:void 0,fileNameWithLine:void 0,fileColumn:void 0,fileLine:void 0,filePath:void 0,filePathWithLine:void 0,method:void 0};if(n!=null){const r=n.match(Dh);if(r){t.filePath=r[1].replace(/\?.*$/,""),t.fullFilePath=`${e}${t.filePath}`;const i=t.filePath.split("/");t.fileName=i[i.length-1],t.fileLine=r[2],t.fileColumn=r[3],t.filePathWithLine=`${t.filePath}:${t.fileLine}`,t.fileNameWithLine=`${t.fileName}:${t.fileLine}`}}return t}function F0(n){return n instanceof Error}function kh(n,e){return n.reduce((t,r)=>(F0(r)?t.errors.push(B0(r,e)):t.args.push(r),t),{args:[],errors:[]})}function B0(n,e){const t=I0(n).map(i=>Xi(e,e.prettyErrorStackTemplate,{...i},!0)),r={errorName:` ${n.name} `,errorMessage:Object.getOwnPropertyNames(n).reduce((i,s)=>(s!=="stack"&&i.push(n[s]),i),[]).join(", "),errorStack:t.join(`
`)};return Xi(e,e.prettyErrorTemplate,r)}function Ih(n,e,t,r){const i=(t.length>0&&e.length>0?`
`:"")+t.join(`
`);r.prettyInspectOptions.colors=r.stylePrettyLogs,console.log(n+Ch(r.prettyInspectOptions,...e)+i)}function Sh(n){console.log(E0(n))}function Fh(n){return!1}class Bh{constructor(e,t,r=4){this.logObj=t,this.stackDepthLevel=r,this.runtime=wh,this.settings={type:e?.type??"pretty",name:e?.name,parentNames:e?.parentNames,minLevel:e?.minLevel??0,argumentsArrayName:e?.argumentsArrayName,hideLogPositionForProduction:e?.hideLogPositionForProduction??!1,prettyLogTemplate:e?.prettyLogTemplate??"{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}	{{logLevelName}}	{{filePathWithLine}}{{nameWithDelimiterPrefix}}	",prettyErrorTemplate:e?.prettyErrorTemplate??`
{{errorName}} {{errorMessage}}
error stack:
{{errorStack}}`,prettyErrorStackTemplate:e?.prettyErrorStackTemplate??`  â€¢ {{fileName}}	{{method}}
	{{filePathWithLine}}`,prettyErrorParentNamesSeparator:e?.prettyErrorParentNamesSeparator??":",prettyErrorLoggerNameDelimiter:e?.prettyErrorLoggerNameDelimiter??"	",stylePrettyLogs:e?.stylePrettyLogs??!0,prettyLogTimeZone:e?.prettyLogTimeZone??"UTC",prettyLogStyles:e?.prettyLogStyles??{logLevelName:{"*":["bold","black","bgWhiteBright","dim"],SILLY:["bold","white"],TRACE:["bold","whiteBright"],DEBUG:["bold","green"],INFO:["bold","blue"],WARN:["bold","yellow"],ERROR:["bold","red"],FATAL:["bold","redBright"]},dateIsoStr:"white",filePathWithLine:"white",name:["white","bold"],nameWithDelimiterPrefix:["white","bold"],nameWithDelimiterSuffix:["white","bold"],errorName:["bold","bgRedBright","whiteBright"],fileName:["yellow"],fileNameWithLine:"white"},prettyInspectOptions:e?.prettyInspectOptions??{colors:!0,compact:!1,depth:1/0},metaProperty:e?.metaProperty??"_meta",maskPlaceholder:e?.maskPlaceholder??"[***]",maskValuesOfKeys:e?.maskValuesOfKeys??["password"],maskValuesOfKeysCaseInsensitive:e?.maskValuesOfKeysCaseInsensitive??!1,maskValuesRegEx:e?.maskValuesRegEx,prefix:[...e?.prefix??[]],attachedTransports:[...e?.attachedTransports??[]],overwrite:{mask:e?.overwrite?.mask,toLogObj:e?.overwrite?.toLogObj,addMeta:e?.overwrite?.addMeta,addPlaceholders:e?.overwrite?.addPlaceholders,formatMeta:e?.overwrite?.formatMeta,formatLogObj:e?.overwrite?.formatLogObj,transportFormatted:e?.overwrite?.transportFormatted,transportJSON:e?.overwrite?.transportJSON}}}log(e,t,...r){if(e<this.settings.minLevel)return;const i=[...this.settings.prefix,...r],s=this.settings.overwrite?.mask!=null?this.settings.overwrite?.mask(i):this.settings.maskValuesOfKeys!=null&&this.settings.maskValuesOfKeys.length>0?this._mask(i):i,o=this.logObj!=null?this._recursiveCloneAndExecuteFunctions(this.logObj):void 0,c=this.settings.overwrite?.toLogObj!=null?this.settings.overwrite?.toLogObj(s,o):this._toLogObj(s,o),l=this.settings.overwrite?.addMeta!=null?this.settings.overwrite?.addMeta(c,e,t):this._addMetaToLogObj(c,e,t);let a,h;return this.settings.overwrite?.formatMeta!=null&&(a=this.settings.overwrite?.formatMeta(l?.[this.settings.metaProperty])),this.settings.overwrite?.formatLogObj!=null&&(h=this.settings.overwrite?.formatLogObj(s,this.settings)),this.settings.type==="pretty"&&(a=a??this._prettyFormatLogObjMeta(l?.[this.settings.metaProperty]),h=h??this.runtime.prettyFormatLogObj(s,this.settings)),a!=null&&h!=null?this.settings.overwrite?.transportFormatted!=null?this.settings.overwrite?.transportFormatted(a,h.args,h.errors,this.settings):this.runtime.transportFormatted(a,h.args,h.errors,this.settings):this.settings.overwrite?.transportJSON!=null?this.settings.overwrite?.transportJSON(l):this.settings.type!=="hidden"&&this.runtime.transportJSON(l),this.settings.attachedTransports!=null&&this.settings.attachedTransports.length>0&&this.settings.attachedTransports.forEach(d=>{d(l)}),l}attachTransport(e){this.settings.attachedTransports.push(e)}getSubLogger(e,t){const r={...this.settings,...e,parentNames:this.settings?.parentNames!=null&&this.settings?.name!=null?[...this.settings.parentNames,this.settings.name]:this.settings?.name!=null?[this.settings.name]:void 0,prefix:[...this.settings.prefix,...e?.prefix??[]]};return new this.constructor(r,t??this.logObj,this.stackDepthLevel)}_mask(e){const t=this.settings.maskValuesOfKeysCaseInsensitive!==!0?this.settings.maskValuesOfKeys:this.settings.maskValuesOfKeys.map(r=>r.toLowerCase());return e?.map(r=>this._recursiveCloneAndMaskValuesOfKeys(r,t))}_recursiveCloneAndMaskValuesOfKeys(e,t,r=[]){if(r.includes(e))return{...e};if(typeof e=="object"&&e!==null&&r.push(e),this.runtime.isError(e)||this.runtime.isBuffer(e))return e;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Array.isArray(e))return e.map(i=>this._recursiveCloneAndMaskValuesOfKeys(i,t,r));if(e instanceof Date)return new Date(e.getTime());if(e instanceof URL)return mh(e);if(e!==null&&typeof e=="object"){const i=this.runtime.isError(e)?this._cloneError(e):Object.create(Object.getPrototypeOf(e));return Object.getOwnPropertyNames(e).reduce((s,o)=>(s[o]=t.includes(this.settings?.maskValuesOfKeysCaseInsensitive!==!0?o:o.toLowerCase())?this.settings.maskPlaceholder:this._recursiveCloneAndMaskValuesOfKeys(e[o],t,r),s),i)}else{if(typeof e=="string"){let i=e;for(const s of this.settings?.maskValuesRegEx||[])i=i.replace(s,this.settings?.maskPlaceholder||"");return i}return e}}_recursiveCloneAndExecuteFunctions(e,t=[]){return this.isObjectOrArray(e)&&t.includes(e)?this.shallowCopy(e):(this.isObjectOrArray(e)&&t.push(e),Array.isArray(e)?e.map(r=>this._recursiveCloneAndExecuteFunctions(r,t)):e instanceof Date?new Date(e.getTime()):this.isObject(e)?Object.getOwnPropertyNames(e).reduce((r,i)=>{const s=Object.getOwnPropertyDescriptor(e,i);if(s){Object.defineProperty(r,i,s);const o=e[i];r[i]=typeof o=="function"?o():this._recursiveCloneAndExecuteFunctions(o,t)}return r},Object.create(Object.getPrototypeOf(e))):e)}isObjectOrArray(e){return typeof e=="object"&&e!==null}isObject(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null}shallowCopy(e){return Array.isArray(e)?[...e]:{...e}}_toLogObj(e,t={}){return e=e?.map(r=>this.runtime.isError(r)?this._toErrorObject(r):r),this.settings.argumentsArrayName==null?e.length===1&&!Array.isArray(e[0])&&this.runtime.isBuffer(e[0])!==!0&&!(e[0]instanceof Date)?t=typeof e[0]=="object"&&e[0]!=null?{...e[0],...t}:{0:e[0],...t}:t={...t,...e}:t={...t,[this.settings.argumentsArrayName]:e},t}_cloneError(e){const t=new e.constructor;return Object.getOwnPropertyNames(e).forEach(r=>{t[r]=e[r]}),t}_toErrorObject(e){return{nativeError:e,name:e.name??"Error",message:e.message,stack:this.runtime.getErrorTrace(e)}}_addMetaToLogObj(e,t,r){return{...e,[this.settings.metaProperty]:this.runtime.getMeta(t,r,this.stackDepthLevel,this.settings.hideLogPositionForProduction,this.settings.name,this.settings.parentNames)}}_prettyFormatLogObjMeta(e){if(e==null)return"";let t=this.settings.prettyLogTemplate;const r={};t.includes("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}")?t=t.replace("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}","{{dateIsoStr}}"):this.settings.prettyLogTimeZone==="UTC"?(r.yyyy=e?.date?.getUTCFullYear()??"----",r.mm=ke(e?.date?.getUTCMonth(),2,1),r.dd=ke(e?.date?.getUTCDate(),2),r.hh=ke(e?.date?.getUTCHours(),2),r.MM=ke(e?.date?.getUTCMinutes(),2),r.ss=ke(e?.date?.getUTCSeconds(),2),r.ms=ke(e?.date?.getUTCMilliseconds(),3)):(r.yyyy=e?.date?.getFullYear()??"----",r.mm=ke(e?.date?.getMonth(),2,1),r.dd=ke(e?.date?.getDate(),2),r.hh=ke(e?.date?.getHours(),2),r.MM=ke(e?.date?.getMinutes(),2),r.ss=ke(e?.date?.getSeconds(),2),r.ms=ke(e?.date?.getMilliseconds(),3));const i=this.settings.prettyLogTimeZone==="UTC"?e?.date:new Date(e?.date?.getTime()-e?.date?.getTimezoneOffset()*6e4);r.rawIsoStr=i?.toISOString(),r.dateIsoStr=i?.toISOString().replace("T"," ").replace("Z",""),r.logLevelName=e?.logLevelName,r.fileNameWithLine=e?.path?.fileNameWithLine??"",r.filePathWithLine=e?.path?.filePathWithLine??"",r.fullFilePath=e?.path?.fullFilePath??"";let s=this.settings.parentNames?.join(this.settings.prettyErrorParentNamesSeparator);return s=s!=null&&e?.name!=null?s+this.settings.prettyErrorParentNamesSeparator:void 0,r.name=e?.name!=null||s!=null?(s??"")+e?.name:"",r.nameWithDelimiterPrefix=r.name.length>0?this.settings.prettyErrorLoggerNameDelimiter+r.name:"",r.nameWithDelimiterSuffix=r.name.length>0?r.name+this.settings.prettyErrorLoggerNameDelimiter:"",this.settings.overwrite?.addPlaceholders!=null&&this.settings.overwrite?.addPlaceholders(e,r),Xi(this.settings,t,r)}}class Th extends Bh{constructor(e,t){const r=typeof window<"u"&&typeof document<"u",i=r?window.chrome!==void 0&&window.CSS!==void 0&&window.CSS.supports("color","green"):!1,s=r?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1;e=e||{},e.stylePrettyLogs=e.stylePrettyLogs&&r&&!i?!1:e.stylePrettyLogs,super(e,t,s?4:5)}log(e,t,...r){return super.log(e,t,...r)}silly(...e){return super.log(0,"SILLY",...e)}trace(...e){return super.log(1,"TRACE",...e)}debug(...e){return super.log(2,"DEBUG",...e)}info(...e){return super.log(3,"INFO",...e)}warn(...e){return super.log(4,"WARN",...e)}error(...e){return super.log(5,"ERROR",...e)}fatal(...e){return super.log(6,"FATAL",...e)}getSubLogger(e,t){return super.getSubLogger(e,t)}}const Re=new Th({minLevel:4});var T0=(n=>(n.login="login",n.enter="enter",n))(T0||{});const Vo={login:"login",enter:"enter"},Ph=["+972-504040624","+972-525656377"];var $o={};const Go="@firebase/database",zo="1.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let P0="";function Nh(n){P0=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),le(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ys(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return $e(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N0=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Rh(e)}}catch{}return new Oh},Ct=N0("localStorage"),ji=N0("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ut=new Gl("@firebase/database"),Mh=function(){let n=1;return function(){return n++}}(),R0=function(n){const e=Hl(n),t=new Vl;t.update(e);const r=t.digest();return $l.encodeByteArray(r)},Ur=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Ur.apply(null,r):typeof r=="object"?e+=le(r):e+=r,e+=" "}return e};let bt=null,qo=!0;const Lh=function(n,e){P(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ut.logLevel=zl.VERBOSE,bt=Ut.log.bind(Ut),e&&ji.set("logging_enabled",!0)):typeof n=="function"?bt=n:(bt=null,ji.remove("logging_enabled"))},pe=function(...n){if(qo===!0&&(qo=!1,bt===null&&ji.get("logging_enabled")===!0&&Lh(!0)),bt){const e=Ur.apply(null,n);bt(e)}},Wr=function(n){return function(...e){pe(n,...e)}},es=function(...n){const e="FIREBASE INTERNAL ERROR: "+Ur(...n);Ut.error(e)},je=function(...n){const e=`FIREBASE FATAL ERROR: ${Ur(...n)}`;throw Ut.error(e),new Error(e)},_e=function(...n){const e="FIREBASE WARNING: "+Ur(...n);Ut.warn(e)},Uh=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&_e("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Cs=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Wh=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Kt="[MIN_NAME]",At="[MAX_NAME]",St=function(n,e){if(n===e)return 0;if(n===Kt||e===At)return-1;if(e===Kt||n===At)return 1;{const t=Ko(n),r=Ko(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},Hh=function(n,e){return n===e?0:n<e?-1:1},pr=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+le(e))},ws=function(n){if(typeof n!="object"||n===null)return le(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=le(e[r]),t+=":",t+=ws(n[e[r]]);return t+="}",t},O0=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function me(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const M0=function(n){P(!Cs(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let i,s,o,c,l;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(c=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=c+r,o=Math.round(n*Math.pow(2,t-c)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));const a=[];for(l=t;l;l-=1)a.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)a.push(s%2?1:0),s=Math.floor(s/2);a.push(i?1:0),a.reverse();const h=a.join("");let d="";for(l=0;l<64;l+=8){let u=parseInt(h.substr(l,8),2).toString(16);u.length===1&&(u="0"+u),d=d+u}return d.toLowerCase()},Vh=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},$h=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Gh(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const zh=new RegExp("^-?(0*)\\d{1,10}$"),qh=-2147483648,Kh=2147483647,Ko=function(n){if(zh.test(n)){const e=Number(n);if(e>=qh&&e<=Kh)return e}return null},ir=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw _e("Exception was thrown by user callback.",t),e},Math.floor(0))}},Jh=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Er=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){_e(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(pe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',_e(e)}}class Wt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Wt.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs="5",L0="v",U0="s",W0="r",H0="f",V0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$0="ls",G0="p",ts="ac",z0="websocket",q0="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,t,r,i,s=!1,o="",c=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ct.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ct.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Xh(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function J0(n,e,t){P(typeof e=="string","typeof type must == string"),P(typeof t=="object","typeof params must == object");let r;if(e===z0)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===q0)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Xh(n)&&(t.ns=n.namespace);const i=[];return me(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(){this.counters_={}}incrementCounter(e,t=1){$e(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Ql(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oi={},ai={};function Ds(n){const e=n.toString();return oi[e]||(oi[e]=new Zh),oi[e]}function jh(n,e){const t=n.toString();return ai[t]||(ai[t]=e()),ai[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&ir(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jo="start",tu="close",ru="pLPCommand",nu="pRTLPCB",Y0="id",Q0="pw",X0="ser",iu="cb",su="seg",ou="ts",au="d",cu="dframe",Z0=1870,j0=30,lu=Z0-j0,hu=25e3,uu=3e4;class Lt{constructor(e,t,r,i,s,o,c){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Wr(e),this.stats_=Ds(t),this.urlFn=l=>(this.appCheckToken&&(l[ts]=this.appCheckToken),J0(t,q0,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new eu(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(uu)),Wh(()=>{if(this.isClosed_)return;this.scriptTagHolder=new As((...s)=>{const[o,c,l,a,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Jo)this.id=c,this.password=l;else if(o===tu)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,c]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,c)},()=>{this.onClosed_()},this.urlFn);const r={};r[Jo]="t",r[X0]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[iu]=this.scriptTagHolder.uniqueCallbackIdentifier),r[L0]=bs,this.transportSessionId&&(r[U0]=this.transportSessionId),this.lastSessionId&&(r[$0]=this.lastSessionId),this.applicationId&&(r[G0]=this.applicationId),this.appCheckToken&&(r[ts]=this.appCheckToken),typeof location<"u"&&location.hostname&&V0.test(location.hostname)&&(r[W0]=H0);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Lt.forceAllow_=!0}static forceDisallow(){Lt.forceDisallow_=!0}static isAvailable(){return Lt.forceAllow_?!0:!Lt.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Vh()&&!$h()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=le(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=Zl(t),i=O0(r,lu);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[cu]="t",r[Y0]=e,r[Q0]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=le(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class As{constructor(e,t,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Mh(),window[ru+this.uniqueCallbackIdentifier]=e,window[nu+this.uniqueCallbackIdentifier]=t,this.myIFrame=As.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(c){pe("frame writing exception"),c.stack&&pe(c.stack),pe(c)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||pe("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Y0]=this.myID,e[Q0]=this.myPW,e[X0]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+j0+r.length<=Z0;){const o=this.pendingSegs.shift();r=r+"&"+su+i+"="+o.seg+"&"+ou+i+"="+o.ts+"&"+au+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(hu)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{pe("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const du=16384,fu=45e3;let cn=null;typeof MozWebSocket<"u"?cn=MozWebSocket:typeof WebSocket<"u"&&(cn=WebSocket);class Oe{constructor(e,t,r,i,s,o,c){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Wr(this.connId),this.stats_=Ds(t),this.connURL=Oe.connectionURL_(t,o,c,i,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,i,s){const o={};return o[L0]=bs,typeof location<"u"&&location.hostname&&V0.test(location.hostname)&&(o[W0]=H0),t&&(o[U0]=t),r&&(o[$0]=r),i&&(o[ts]=i),s&&(o[G0]=s),J0(e,z0,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ct.set("previous_websocket_failure",!0);try{let r;g0(),this.mySock=new cn(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Oe.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&cn!==null&&!Oe.forceDisallow_}static previouslyFailed(){return Ct.isInMemoryStorage||Ct.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ct.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=ys(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(P(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=le(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=O0(t,du);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(fu))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Oe.responsesRequiredToBeHealthy=2;Oe.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Lt,Oe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Oe&&Oe.isAvailable();let r=t&&!Oe.previouslyFailed();if(e.webSocketOnly&&(t||_e("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Oe];else{const i=this.transports_=[];for(const s of Sr.ALL_TRANSPORTS)s&&s.isAvailable()&&i.push(s);Sr.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Sr.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pu=6e4,mu=5e3,xu=10*1024,gu=100*1024,ci="t",Yo="d",_u="s",Qo="r",vu="e",Xo="o",Zo="a",jo="n",ea="p",yu="h";class Eu{constructor(e,t,r,i,s,o,c,l,a,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=c,this.onDisconnect_=l,this.onKill_=a,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Wr("c:"+this.id+":"),this.transportManager_=new Sr(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Er(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>gu?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>xu?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ci in e){const t=e[ci];t===Zo?this.upgradeIfSecondaryHealthy_():t===Qo?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Xo&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=pr("t",e),r=pr("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ea,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Zo,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:jo,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=pr("t",e),r=pr("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=pr(ci,e);if(Yo in e){const r=e[Yo];if(t===yu){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===jo){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===_u?this.onConnectionShutdown_(r):t===Qo?this.onReset_(r):t===vu?es("Server Error: "+r):t===Xo?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):es("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),bs!==r&&_e("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Er(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(pu))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Er(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(mu))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ea,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ct.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e){this.allowedEvents_=e,this.listeners_={},P(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){P(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln extends tc{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!_0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ln}getInitialEvent(e){return P(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta=32,ra=768;class X{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function q(){return new X("")}function V(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function mt(n){return n.pieces_.length-n.pieceNum_}function te(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new X(n.pieces_,e)}function ks(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Cu(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Fr(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function rc(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new X(e,0)}function se(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof X)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new X(t,0)}function G(n){return n.pieceNum_>=n.pieces_.length}function ge(n,e){const t=V(n),r=V(e);if(t===null)return e;if(t===r)return ge(te(n),te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function wu(n,e){const t=Fr(n,0),r=Fr(e,0);for(let i=0;i<t.length&&i<r.length;i++){const s=St(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Is(n,e){if(mt(n)!==mt(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Be(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(mt(n)>mt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class bu{constructor(e,t){this.errorPrefix_=t,this.parts_=Fr(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ln(this.parts_[r]);nc(this)}}function Du(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ln(e),nc(n)}function Au(n){const e=n.parts_.pop();n.byteLength_-=Ln(e),n.parts_.length>0&&(n.byteLength_-=1)}function nc(n){if(n.byteLength_>ra)throw new Error(n.errorPrefix_+"has a key path longer than "+ra+" bytes ("+n.byteLength_+").");if(n.parts_.length>ta)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ta+") or object contains a cycle "+yt(n))}function yt(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss extends tc{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new Ss}getInitialEvent(e){return P(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr=1e3,ku=60*5*1e3,na=30*1e3,Iu=1.3,Su=3e4,Fu="server_kill",ia=3;class Ze extends ec{constructor(e,t,r,i,s,o,c,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=Ze.nextPersistentConnectionId_++,this.log_=Wr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=mr,this.maxReconnectDelay_=ku,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!g0())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ss.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ln.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(le(s)),P(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new Mn,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const c=o.d;o.s==="ok"?t.resolve(c):t.reject(c)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,r,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),P(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),P(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const c={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(o).set(s,c),this.connected_&&this.sendListen_(c)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,c=>{const l=c.d,a=c.s;Ze.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",c),a!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(a,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&$e(e,"w")){const r=qt(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();_e(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||ql(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=na)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Kl(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,i=>{const s=i.s,o=i.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),P(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,r,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";i&&(s.q=r,s.t=i),this.sendRequest(o,s)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,i){const s={p:t,d:r};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,r,i){this.putInternal("p",e,t,r,i)}merge(e,t,r,i){this.putInternal("m",e,t,r,i)}putInternal(e,t,r,i,s){this.initConnection_();const o={p:t,d:r};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const s=r.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+le(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):es("Unrecognized action received from server: "+le(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){P(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=mr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=mr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Su&&(this.reconnectDelay_=mr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Iu)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ze.nextConnectionId_++,s=this.lastSessionId;let o=!1,c=null;const l=function(){c?c.close():(o=!0,r())},a=function(d){P(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(d)};this.realtime_={close:l,sendRequest:a};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,u]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?pe("getToken() completed but was canceled"):(pe("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=u&&u.token,c=new Eu(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,f=>{_e(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Fu)},s))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&_e(d),l())}}}interrupt(e){pe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],So(this.interruptReasons_)&&(this.reconnectDelay_=mr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(s=>ws(s)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const r=new X(e).toString();let i;if(this.listens.has(r)){const s=this.listens.get(r);i=s.get(t),s.delete(t),s.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,t){pe("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ia&&(this.reconnectDelay_=na,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){pe("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ia&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+P0.replace(/\./g,"-")]=1,_0()?e["framework.cordova"]=1:Jl()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ln.getInstance().currentlyOnline();return So(this.interruptReasons_)&&e}}Ze.nextPersistentConnectionId_=0;Ze.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ${constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new $(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new $(Kt,e),i=new $(Kt,t);return this.compare(r,i)!==0}minPost(){return $.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jr;class ic extends Hn{static get __EMPTY_NODE(){return jr}static set __EMPTY_NODE(e){jr=e}compare(e,t){return St(e.name,t.name)}isDefinedOn(e){throw Lr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return $.MIN}maxPost(){return new $(At,jr)}makePost(e,t){return P(typeof e=="string","KeyIndex indexValue must always be a string."),new $(e,jr)}toString(){return".key"}}const Ht=new ic;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ue{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??ue.RED,this.left=i??Ee.EMPTY_NODE,this.right=s??Ee.EMPTY_NODE}copy(e,t,r,i,s){return new ue(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return s<0?i=i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ee.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,i;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Ee.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ue.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ue.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ue.RED=!0;ue.BLACK=!1;class Bu{copy(e,t,r,i,s){return this}insert(e,t,r){return new ue(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ee{constructor(e,t=Ee.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ee(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ue.BLACK,null,null))}remove(e){return new Ee(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ue.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new en(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new en(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new en(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new en(this.root_,null,this.comparator_,!0,e)}}Ee.EMPTY_NODE=new Bu;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(n,e){return St(n.name,e.name)}function Fs(n,e){return St(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rs;function Pu(n){rs=n}const sc=function(n){return typeof n=="number"?"number:"+M0(n):"string:"+n},oc=function(n){if(n.isLeafNode()){const e=n.val();P(typeof e=="string"||typeof e=="number"||typeof e=="object"&&$e(e,".sv"),"Priority must be a string or number.")}else P(n===rs||n.isEmpty(),"priority of unexpected type.");P(n===rs||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sa;class he{constructor(e,t=he.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,P(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),oc(this.priorityNode_)}static set __childrenNodeConstructor(e){sa=e}static get __childrenNodeConstructor(){return sa}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new he(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:he.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return G(e)?this:V(e)===".priority"?this.priorityNode_:he.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:he.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=V(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(P(r!==".priority"||mt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,he.__childrenNodeConstructor.EMPTY_NODE.updateChild(te(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+sc(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=M0(this.value_):e+=this.value_,this.lazyHash_=R0(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===he.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof he.__childrenNodeConstructor?-1:(P(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=he.VALUE_TYPE_ORDER.indexOf(t),s=he.VALUE_TYPE_ORDER.indexOf(r);return P(i>=0,"Unknown leaf type: "+t),P(s>=0,"Unknown leaf type: "+r),i===s?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}he.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ac,cc;function Nu(n){ac=n}function Ru(n){cc=n}class Ou extends Hn{compare(e,t){const r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?St(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return $.MIN}maxPost(){return new $(At,new he("[PRIORITY-POST]",cc))}makePost(e,t){const r=ac(e);return new $(t,new he("[PRIORITY-POST]",r))}toString(){return".priority"}}const oe=new Ou;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mu=Math.log(2);class Lu{constructor(e){const t=s=>parseInt(Math.log(s)/Mu,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const hn=function(n,e,t,r){n.sort(e);const i=function(l,a){const h=a-l;let d,u;if(h===0)return null;if(h===1)return d=n[l],u=t?t(d):d,new ue(u,d.node,ue.BLACK,null,null);{const f=parseInt(h/2,10)+l,p=i(l,f),_=i(f+1,a);return d=n[f],u=t?t(d):d,new ue(u,d.node,ue.BLACK,p,_)}},s=function(l){let a=null,h=null,d=n.length;const u=function(p,_){const g=d-p,E=d;d-=p;const m=i(g+1,E),x=n[g],v=t?t(x):x;f(new ue(v,x.node,_,null,m))},f=function(p){a?(a.left=p,a=p):(h=p,a=p)};for(let p=0;p<l.count;++p){const _=l.nextBitIsOne(),g=Math.pow(2,l.count-(p+1));_?u(g,ue.BLACK):(u(g,ue.BLACK),u(g,ue.RED))}return h},o=new Lu(n.length),c=s(o);return new Ee(r||e,c)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let li;const Ot={};class Ye{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return P(Ot&&oe,"ChildrenNode.ts has not been loaded"),li=li||new Ye({".priority":Ot},{".priority":oe}),li}get(e){const t=qt(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ee?t:null}hasIndex(e){return $e(this.indexSet_,e.toString())}addIndex(e,t){P(e!==Ht,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=t.getIterator($.Wrap);let o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let c;i?c=hn(r,e.getCompare()):c=Ot;const l=e.toString(),a=Object.assign({},this.indexSet_);a[l]=e;const h=Object.assign({},this.indexes_);return h[l]=c,new Ye(h,a)}addToIndexes(e,t){const r=on(this.indexes_,(i,s)=>{const o=qt(this.indexSet_,s);if(P(o,"Missing index implementation for "+s),i===Ot)if(o.isDefinedOn(e.node)){const c=[],l=t.getIterator($.Wrap);let a=l.getNext();for(;a;)a.name!==e.name&&c.push(a),a=l.getNext();return c.push(e),hn(c,o.getCompare())}else return Ot;else{const c=t.get(e.name);let l=i;return c&&(l=l.remove(new $(e.name,c))),l.insert(e,e.node)}});return new Ye(r,this.indexSet_)}removeFromIndexes(e,t){const r=on(this.indexes_,i=>{if(i===Ot)return i;{const s=t.get(e.name);return s?i.remove(new $(e.name,s)):i}});return new Ye(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xr;class M{constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&oc(this.priorityNode_),this.children_.isEmpty()&&P(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return xr||(xr=new M(new Ee(Fs),null,Ye.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||xr}updatePriority(e){return this.children_.isEmpty()?this:new M(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?xr:t}}getChild(e){const t=V(e);return t===null?this:this.getImmediateChild(t).getChild(te(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(P(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new $(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?xr:this.priorityNode_;return new M(i,o,s)}}updateChild(e,t){const r=V(e);if(r===null)return t;{P(V(e)!==".priority"||mt(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(te(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,i=0,s=!0;if(this.forEachChild(oe,(o,c)=>{t[o]=c.val(e),r++,s&&M.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*r){const o=[];for(const c in t)o[c]=t[c];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+sc(this.getPriority().val())+":"),this.forEachChild(oe,(t,r)=>{const i=r.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":R0(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const i=this.resolveIndex_(r);if(i){const s=i.getPredecessorKey(new $(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new $(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new $(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,$.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,$.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)>0;)i.getNext(),s=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Hr?-1:0}withIndex(e){if(e===Ht||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new M(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ht||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(oe),i=t.getIterator(oe);let s=r.getNext(),o=i.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=r.getNext(),o=i.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ht?null:this.indexMap_.get(e.toString())}}M.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Uu extends M{constructor(){super(new Ee(Fs),M.EMPTY_NODE,Ye.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return M.EMPTY_NODE}isEmpty(){return!1}}const Hr=new Uu;Object.defineProperties($,{MIN:{value:new $(Kt,M.EMPTY_NODE)},MAX:{value:new $(At,Hr)}});ic.__EMPTY_NODE=M.EMPTY_NODE;he.__childrenNodeConstructor=M;Pu(Hr);Ru(Hr);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wu=!0;function ce(n,e=null){if(n===null)return M.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),P(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new he(t,ce(e))}if(!(n instanceof Array)&&Wu){const t=[];let r=!1;if(me(n,(o,c)=>{if(o.substring(0,1)!=="."){const l=ce(c);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new $(o,l)))}}),t.length===0)return M.EMPTY_NODE;const s=hn(t,Tu,o=>o.name,Fs);if(r){const o=hn(t,oe.getCompare());return new M(s,ce(e),new Ye({".priority":o},{".priority":oe}))}else return new M(s,ce(e),Ye.Default)}else{let t=M.EMPTY_NODE;return me(n,(r,i)=>{if($e(n,r)&&r.substring(0,1)!=="."){const s=ce(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(ce(e))}}Nu(ce);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu extends Hn{constructor(e){super(),this.indexPath_=e,P(!G(e)&&V(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?St(e.name,t.name):s}makePost(e,t){const r=ce(e),i=M.EMPTY_NODE.updateChild(this.indexPath_,r);return new $(t,i)}maxPost(){const e=M.EMPTY_NODE.updateChild(this.indexPath_,Hr);return new $(At,e)}toString(){return Fr(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu extends Hn{compare(e,t){const r=e.node.compareTo(t.node);return r===0?St(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return $.MIN}maxPost(){return $.MAX}makePost(e,t){const r=ce(e);return new $(t,r)}toString(){return".value"}}const $u=new Vu;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(n){return{type:"value",snapshotNode:n}}function Jt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Br(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Tr(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Gu(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){P(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=e.getImmediateChild(t);return c.getChild(i).equals(r.getChild(i))&&c.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Br(t,c)):P(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?o.trackChildChange(Jt(t,r)):o.trackChildChange(Tr(t,r,c))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(oe,(i,s)=>{t.hasChild(i)||r.trackChildChange(Br(i,s))}),t.isLeafNode()||t.forEachChild(oe,(i,s)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Tr(i,s,o))}else r.trackChildChange(Jt(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?M.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e){this.indexedFilter_=new Bs(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Pr.getStartPost_(e),this.endPost_=Pr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new $(t,r))||(r=M.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=M.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(M.EMPTY_NODE);const s=this;return t.forEachChild(oe,(o,c)=>{s.matches(new $(o,c))||(i=i.updateImmediateChild(o,M.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Pr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new $(t,r))||(r=M.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=M.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=M.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const c=s.getNext();if(this.withinDirectionalStart(c))if(this.withinDirectionalEnd(c))i=i.updateImmediateChild(c.name,c.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(M.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){const c=s.getNext();o<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?o++:i=i.updateImmediateChild(c.name,M.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){const d=this.index_.getCompare();o=(u,f)=>d(f,u)}else o=this.index_.getCompare();const c=e;P(c.numChildren()===this.limit_,"");const l=new $(t,r),a=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(c.hasChild(t)){const d=c.getImmediateChild(t);let u=i.getChildAfterChild(this.index_,a,this.reverse_);for(;u!=null&&(u.name===t||c.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);const f=u==null?1:o(u,l);if(h&&!r.isEmpty()&&f>=0)return s?.trackChildChange(Tr(t,r,d)),c.updateImmediateChild(t,r);{s?.trackChildChange(Br(t,d));const _=c.updateImmediateChild(t,M.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(s?.trackChildChange(Jt(u.name,u.node)),_.updateImmediateChild(u.name,u.node)):_}}else return r.isEmpty()?e:h&&o(a,l)>=0?(s!=null&&(s.trackChildChange(Br(a.name,a.node)),s.trackChildChange(Jt(t,r))),c.updateImmediateChild(t,r).updateImmediateChild(a.name,M.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=oe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return P(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return P(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Kt}hasEnd(){return this.endSet_}getIndexEndValue(){return P(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return P(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:At}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return P(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===oe}copy(){const e=new Ts;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function qu(n){return n.loadsAllData()?new Bs(n.getIndex()):n.hasLimit()?new zu(n):new Pr(n)}function oa(n){const e={};if(n.isDefault())return e;let t;if(n.index_===oe?t="$priority":n.index_===$u?t="$value":n.index_===Ht?t="$key":(P(n.index_ instanceof Hu,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=le(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=le(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+le(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=le(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+le(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function aa(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==oe&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un extends ec{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Wr("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(P(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=un.getListenId_(e,r),c={};this.listens_[o]=c;const l=oa(e._queryParams);this.restRequest_(s+".json",l,(a,h)=>{let d=h;if(a===404&&(d=null,a=null),a===null&&this.onDataUpdate_(s,d,!1,r),qt(this.listens_,o)===c){let u;a?a===401?u="permission_denied":u="rest_error:"+a:u="ok",i(u,null)}})}unlisten(e,t){const r=un.getListenId_(e,t);delete this.listens_[r]}get(e){const t=oa(e._queryParams),r=e._path.toString(),i=new Mn;return this.restRequest_(r+".json",t,(s,o)=>{let c=o;s===404&&(c=null,s=null),s===null?(this.onDataUpdate_(r,c,!1,null),i.resolve(c)):i.reject(new Error(c))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Yl(t);this.log_("Sending REST request for "+o);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(r&&c.readyState===4){this.log_("REST Response for "+o+" received. status:",c.status,"response:",c.responseText);let l=null;if(c.status>=200&&c.status<300){try{l=ys(c.responseText)}catch{_e("Failed to parse JSON response for "+o+": "+c.responseText)}r(null,l)}else c.status!==401&&c.status!==404&&_e("Got unsuccessful REST response for "+o+" Status: "+c.status),r(c.status);r=null}},c.open("GET",o,!0),c.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(){this.rootNode_=M.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(){return{value:null,children:new Map}}function hc(n,e,t){if(G(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=V(e);n.children.has(r)||n.children.set(r,dn());const i=n.children.get(r);e=te(e),hc(i,e,t)}}function ns(n,e,t){n.value!==null?t(e,n.value):Ju(n,(r,i)=>{const s=new X(e.toString()+"/"+r);ns(i,s,t)})}function Ju(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&me(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ca=10*1e3,Qu=30*1e3,Xu=5*60*1e3;class Zu{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Yu(e);const r=ca+(Qu-ca)*Math.random();Er(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;me(e,(i,s)=>{s>0&&$e(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Er(this.reportStats_.bind(this),Math.floor(Math.random()*2*Xu))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Me;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Me||(Me={}));function Ps(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ns(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Rs(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Me.ACK_USER_WRITE,this.source=Ps()}operationForChild(e){if(G(this.path)){if(this.affectedTree.value!=null)return P(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new X(e));return new fn(q(),t,this.revert)}}else return P(V(this.path)===e,"operationForChild called for unrelated child."),new fn(te(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e,t){this.source=e,this.path=t,this.type=Me.LISTEN_COMPLETE}operationForChild(e){return G(this.path)?new Nr(this.source,q()):new Nr(this.source,te(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Me.OVERWRITE}operationForChild(e){return G(this.path)?new kt(this.source,q(),this.snap.getImmediateChild(e)):new kt(this.source,te(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Me.MERGE}operationForChild(e){if(G(this.path)){const t=this.children.subtree(new X(e));return t.isEmpty()?null:t.value?new kt(this.source,q(),t.value):new Yt(this.source,q(),t)}else return P(V(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Yt(this.source,te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(G(e))return this.isFullyInitialized()&&!this.filtered_;const t=V(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function ed(n,e,t,r){const i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Gu(o.childName,o.snapshotNode))}),gr(n,i,"child_removed",e,r,t),gr(n,i,"child_added",e,r,t),gr(n,i,"child_moved",s,r,t),gr(n,i,"child_changed",e,r,t),gr(n,i,"value",e,r,t),i}function gr(n,e,t,r,i,s){const o=r.filter(c=>c.type===t);o.sort((c,l)=>rd(n,c,l)),o.forEach(c=>{const l=td(n,c,s);i.forEach(a=>{a.respondsTo(c.type)&&e.push(a.createEvent(l,n.query_))})})}function td(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function rd(n,e,t){if(e.childName==null||t.childName==null)throw Lr("Should only compare child_ events.");const r=new $(e.childName,e.snapshotNode),i=new $(t.childName,t.snapshotNode);return n.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vn(n,e){return{eventCache:n,serverCache:e}}function Cr(n,e,t,r){return Vn(new xt(e,t,r),n.serverCache)}function uc(n,e,t,r){return Vn(n.eventCache,new xt(e,t,r))}function pn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function It(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hi;const nd=()=>(hi||(hi=new Ee(Hh)),hi);class ee{constructor(e,t=nd()){this.value=e,this.children=t}static fromObject(e){let t=new ee(null);return me(e,(r,i)=>{t=t.set(new X(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:q(),value:this.value};if(G(e))return null;{const r=V(e),i=this.children.get(r);if(i!==null){const s=i.findRootMostMatchingPathAndValue(te(e),t);return s!=null?{path:se(new X(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(G(e))return this;{const t=V(e),r=this.children.get(t);return r!==null?r.subtree(te(e)):new ee(null)}}set(e,t){if(G(e))return new ee(t,this.children);{const r=V(e),s=(this.children.get(r)||new ee(null)).set(te(e),t),o=this.children.insert(r,s);return new ee(this.value,o)}}remove(e){if(G(e))return this.children.isEmpty()?new ee(null):new ee(null,this.children);{const t=V(e),r=this.children.get(t);if(r){const i=r.remove(te(e));let s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new ee(null):new ee(this.value,s)}else return this}}get(e){if(G(e))return this.value;{const t=V(e),r=this.children.get(t);return r?r.get(te(e)):null}}setTree(e,t){if(G(e))return t;{const r=V(e),s=(this.children.get(r)||new ee(null)).setTree(te(e),t);let o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new ee(this.value,o)}}fold(e){return this.fold_(q(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(se(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,q(),t)}findOnPath_(e,t,r){const i=this.value?r(t,this.value):!1;if(i)return i;if(G(e))return null;{const s=V(e),o=this.children.get(s);return o?o.findOnPath_(te(e),se(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,q(),t)}foreachOnPath_(e,t,r){if(G(e))return this;{this.value&&r(t,this.value);const i=V(e),s=this.children.get(i);return s?s.foreachOnPath_(te(e),se(t,i),r):new ee(null)}}foreach(e){this.foreach_(q(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(se(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.writeTree_=e}static empty(){return new Ue(new ee(null))}}function wr(n,e,t){if(G(e))return new Ue(new ee(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let s=r.value;const o=ge(i,e);return s=s.updateChild(o,t),new Ue(n.writeTree_.set(i,s))}else{const i=new ee(t),s=n.writeTree_.setTree(e,i);return new Ue(s)}}}function is(n,e,t){let r=n;return me(t,(i,s)=>{r=wr(r,se(e,i),s)}),r}function la(n,e){if(G(e))return Ue.empty();{const t=n.writeTree_.setTree(e,new ee(null));return new Ue(t)}}function ss(n,e){return Ft(n,e)!=null}function Ft(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ge(t.path,e)):null}function ha(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(oe,(r,i)=>{e.push(new $(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new $(r,i.value))}),e}function lt(n,e){if(G(e))return n;{const t=Ft(n,e);return t!=null?new Ue(new ee(t)):new Ue(n.writeTree_.subtree(e))}}function os(n){return n.writeTree_.isEmpty()}function Qt(n,e){return dc(q(),n.writeTree_,e)}function dc(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(P(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=dc(se(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(se(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(n,e){return xc(e,n)}function id(n,e,t,r,i){P(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=wr(n.visibleWrites,e,t)),n.lastWriteId=r}function sd(n,e,t,r){P(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=is(n.visibleWrites,e,t),n.lastWriteId=r}function od(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function ad(n,e){const t=n.allWrites.findIndex(c=>c.writeId===e);P(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const c=n.allWrites[o];c.visible&&(o>=t&&cd(c,r.path)?i=!1:Be(r.path,c.path)&&(s=!0)),o--}if(i){if(s)return ld(n),!0;if(r.snap)n.visibleWrites=la(n.visibleWrites,r.path);else{const c=r.children;me(c,l=>{n.visibleWrites=la(n.visibleWrites,se(r.path,l))})}return!0}else return!1}function cd(n,e){if(n.snap)return Be(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Be(se(n.path,t),e))return!0;return!1}function ld(n){n.visibleWrites=fc(n.allWrites,hd,q()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function hd(n){return n.visible}function fc(n,e,t){let r=Ue.empty();for(let i=0;i<n.length;++i){const s=n[i];if(e(s)){const o=s.path;let c;if(s.snap)Be(t,o)?(c=ge(t,o),r=wr(r,c,s.snap)):Be(o,t)&&(c=ge(o,t),r=wr(r,q(),s.snap.getChild(c)));else if(s.children){if(Be(t,o))c=ge(t,o),r=is(r,c,s.children);else if(Be(o,t))if(c=ge(o,t),G(c))r=is(r,q(),s.children);else{const l=qt(s.children,V(c));if(l){const a=l.getChild(te(c));r=wr(r,q(),a)}}}else throw Lr("WriteRecord should have .snap or .children")}}return r}function pc(n,e,t,r,i){if(!r&&!i){const s=Ft(n.visibleWrites,e);if(s!=null)return s;{const o=lt(n.visibleWrites,e);if(os(o))return t;if(t==null&&!ss(o,q()))return null;{const c=t||M.EMPTY_NODE;return Qt(o,c)}}}else{const s=lt(n.visibleWrites,e);if(!i&&os(s))return t;if(!i&&t==null&&!ss(s,q()))return null;{const o=function(a){return(a.visible||i)&&(!r||!~r.indexOf(a.writeId))&&(Be(a.path,e)||Be(e,a.path))},c=fc(n.allWrites,o,e),l=t||M.EMPTY_NODE;return Qt(c,l)}}}function ud(n,e,t){let r=M.EMPTY_NODE;const i=Ft(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(oe,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){const s=lt(n.visibleWrites,e);return t.forEachChild(oe,(o,c)=>{const l=Qt(lt(s,new X(o)),c);r=r.updateImmediateChild(o,l)}),ha(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const s=lt(n.visibleWrites,e);return ha(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function dd(n,e,t,r,i){P(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=se(e,t);if(ss(n.visibleWrites,s))return null;{const o=lt(n.visibleWrites,s);return os(o)?i.getChild(t):Qt(o,i.getChild(t))}}function fd(n,e,t,r){const i=se(e,t),s=Ft(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){const o=lt(n.visibleWrites,i);return Qt(o,r.getNode().getImmediateChild(t))}else return null}function pd(n,e){return Ft(n.visibleWrites,e)}function md(n,e,t,r,i,s,o){let c;const l=lt(n.visibleWrites,e),a=Ft(l,q());if(a!=null)c=a;else if(t!=null)c=Qt(l,t);else return[];if(c=c.withIndex(o),!c.isEmpty()&&!c.isLeafNode()){const h=[],d=o.getCompare(),u=s?c.getReverseIteratorFrom(r,o):c.getIteratorFrom(r,o);let f=u.getNext();for(;f&&h.length<i;)d(f,r)!==0&&h.push(f),f=u.getNext();return h}else return[]}function xd(){return{visibleWrites:Ue.empty(),allWrites:[],lastWriteId:-1}}function mn(n,e,t,r){return pc(n.writeTree,n.treePath,e,t,r)}function Os(n,e){return ud(n.writeTree,n.treePath,e)}function ua(n,e,t,r){return dd(n.writeTree,n.treePath,e,t,r)}function xn(n,e){return pd(n.writeTree,se(n.treePath,e))}function gd(n,e,t,r,i,s){return md(n.writeTree,n.treePath,e,t,r,i,s)}function Ms(n,e,t){return fd(n.writeTree,n.treePath,e,t)}function mc(n,e){return xc(se(n.treePath,e),n.writeTree)}function xc(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;P(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),P(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Tr(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Br(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Jt(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Tr(r,e.snapshotNode,i.oldSnap));else throw Lr("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const gc=new vd;class Ls{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new xt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ms(this.writes_,e,r)}}getChildAfterChild(e,t,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:It(this.viewCache_),s=gd(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(n){return{filter:n}}function Ed(n,e){P(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),P(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Cd(n,e,t,r,i){const s=new _d;let o,c;if(t.type===Me.OVERWRITE){const a=t;a.source.fromUser?o=as(n,e,a.path,a.snap,r,i,s):(P(a.source.fromServer,"Unknown source."),c=a.source.tagged||e.serverCache.isFiltered()&&!G(a.path),o=gn(n,e,a.path,a.snap,r,i,c,s))}else if(t.type===Me.MERGE){const a=t;a.source.fromUser?o=bd(n,e,a.path,a.children,r,i,s):(P(a.source.fromServer,"Unknown source."),c=a.source.tagged||e.serverCache.isFiltered(),o=cs(n,e,a.path,a.children,r,i,c,s))}else if(t.type===Me.ACK_USER_WRITE){const a=t;a.revert?o=kd(n,e,a.path,r,i,s):o=Dd(n,e,a.path,a.affectedTree,r,i,s)}else if(t.type===Me.LISTEN_COMPLETE)o=Ad(n,e,t.path,r,s);else throw Lr("Unknown operation type: "+t.type);const l=s.getChanges();return wd(e,o,l),{viewCache:o,changes:l}}function wd(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=pn(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(lc(pn(e)))}}function _c(n,e,t,r,i,s){const o=e.eventCache;if(xn(r,t)!=null)return e;{let c,l;if(G(t))if(P(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const a=It(e),h=a instanceof M?a:M.EMPTY_NODE,d=Os(r,h);c=n.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{const a=mn(r,It(e));c=n.filter.updateFullNode(e.eventCache.getNode(),a,s)}else{const a=V(t);if(a===".priority"){P(mt(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=ua(r,t,h,l);d!=null?c=n.filter.updatePriority(h,d):c=o.getNode()}else{const h=te(t);let d;if(o.isCompleteForChild(a)){l=e.serverCache.getNode();const u=ua(r,t,o.getNode(),l);u!=null?d=o.getNode().getImmediateChild(a).updateChild(h,u):d=o.getNode().getImmediateChild(a)}else d=Ms(r,a,e.serverCache);d!=null?c=n.filter.updateChild(o.getNode(),a,d,h,i,s):c=o.getNode()}}return Cr(e,c,o.isFullyInitialized()||G(t),n.filter.filtersNodes())}}function gn(n,e,t,r,i,s,o,c){const l=e.serverCache;let a;const h=o?n.filter:n.filter.getIndexedFilter();if(G(t))a=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const f=l.getNode().updateChild(t,r);a=h.updateFullNode(l.getNode(),f,null)}else{const f=V(t);if(!l.isCompleteForPath(t)&&mt(t)>1)return e;const p=te(t),g=l.getNode().getImmediateChild(f).updateChild(p,r);f===".priority"?a=h.updatePriority(l.getNode(),g):a=h.updateChild(l.getNode(),f,g,p,gc,null)}const d=uc(e,a,l.isFullyInitialized()||G(t),h.filtersNodes()),u=new Ls(i,d,s);return _c(n,d,t,i,u,c)}function as(n,e,t,r,i,s,o){const c=e.eventCache;let l,a;const h=new Ls(i,e,s);if(G(t))a=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Cr(e,a,!0,n.filter.filtersNodes());else{const d=V(t);if(d===".priority")a=n.filter.updatePriority(e.eventCache.getNode(),r),l=Cr(e,a,c.isFullyInitialized(),c.isFiltered());else{const u=te(t),f=c.getNode().getImmediateChild(d);let p;if(G(u))p=r;else{const _=h.getCompleteChild(d);_!=null?ks(u)===".priority"&&_.getChild(rc(u)).isEmpty()?p=_:p=_.updateChild(u,r):p=M.EMPTY_NODE}if(f.equals(p))l=e;else{const _=n.filter.updateChild(c.getNode(),d,p,u,h,o);l=Cr(e,_,c.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function da(n,e){return n.eventCache.isCompleteForChild(e)}function bd(n,e,t,r,i,s,o){let c=e;return r.foreach((l,a)=>{const h=se(t,l);da(e,V(h))&&(c=as(n,c,h,a,i,s,o))}),r.foreach((l,a)=>{const h=se(t,l);da(e,V(h))||(c=as(n,c,h,a,i,s,o))}),c}function fa(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function cs(n,e,t,r,i,s,o,c){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,a;G(t)?a=r:a=new ee(null).setTree(t,r);const h=e.serverCache.getNode();return a.children.inorderTraversal((d,u)=>{if(h.hasChild(d)){const f=e.serverCache.getNode().getImmediateChild(d),p=fa(n,f,u);l=gn(n,l,new X(d),p,i,s,o,c)}}),a.children.inorderTraversal((d,u)=>{const f=!e.serverCache.isCompleteForChild(d)&&u.value===null;if(!h.hasChild(d)&&!f){const p=e.serverCache.getNode().getImmediateChild(d),_=fa(n,p,u);l=gn(n,l,new X(d),_,i,s,o,c)}}),l}function Dd(n,e,t,r,i,s,o){if(xn(i,t)!=null)return e;const c=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(G(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return gn(n,e,t,l.getNode().getChild(t),i,s,c,o);if(G(t)){let a=new ee(null);return l.getNode().forEachChild(Ht,(h,d)=>{a=a.set(new X(h),d)}),cs(n,e,t,a,i,s,c,o)}else return e}else{let a=new ee(null);return r.foreach((h,d)=>{const u=se(t,h);l.isCompleteForPath(u)&&(a=a.set(h,l.getNode().getChild(u)))}),cs(n,e,t,a,i,s,c,o)}}function Ad(n,e,t,r,i){const s=e.serverCache,o=uc(e,s.getNode(),s.isFullyInitialized()||G(t),s.isFiltered());return _c(n,o,t,r,gc,i)}function kd(n,e,t,r,i,s){let o;if(xn(r,t)!=null)return e;{const c=new Ls(r,e,i),l=e.eventCache.getNode();let a;if(G(t)||V(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=mn(r,It(e));else{const d=e.serverCache.getNode();P(d instanceof M,"serverChildren would be complete if leaf node"),h=Os(r,d)}h=h,a=n.filter.updateFullNode(l,h,s)}else{const h=V(t);let d=Ms(r,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?a=n.filter.updateChild(l,h,d,te(t),c,s):e.eventCache.getNode().hasChild(h)?a=n.filter.updateChild(l,h,M.EMPTY_NODE,te(t),c,s):a=l,a.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=mn(r,It(e)),o.isLeafNode()&&(a=n.filter.updateFullNode(a,o,s)))}return o=e.serverCache.isFullyInitialized()||xn(r,q())!=null,Cr(e,a,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new Bs(r.getIndex()),s=qu(r);this.processor_=yd(s);const o=t.serverCache,c=t.eventCache,l=i.updateFullNode(M.EMPTY_NODE,o.getNode(),null),a=s.updateFullNode(M.EMPTY_NODE,c.getNode(),null),h=new xt(l,o.isFullyInitialized(),i.filtersNodes()),d=new xt(a,c.isFullyInitialized(),s.filtersNodes());this.viewCache_=Vn(d,h),this.eventGenerator_=new ju(this.query_)}get query(){return this.query_}}function Sd(n){return n.viewCache_.serverCache.getNode()}function Fd(n){return pn(n.viewCache_)}function Bd(n,e){const t=It(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!G(e)&&!t.getImmediateChild(V(e)).isEmpty())?t.getChild(e):null}function pa(n){return n.eventRegistrations_.length===0}function Td(n,e){n.eventRegistrations_.push(e)}function ma(n,e,t){const r=[];if(t){P(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){const o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function xa(n,e,t,r){e.type===Me.MERGE&&e.source.queryId!==null&&(P(It(n.viewCache_),"We should always have a full cache before handling merges"),P(pn(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,s=Cd(n.processor_,i,e,t,r);return Ed(n.processor_,s.viewCache),P(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,vc(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Pd(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(oe,(s,o)=>{r.push(Jt(s,o))}),t.isFullyInitialized()&&r.push(lc(t.getNode())),vc(n,r,t.getNode(),e)}function vc(n,e,t,r){const i=r?[r]:n.eventRegistrations_;return ed(n.eventGenerator_,e,t,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _n;class yc{constructor(){this.views=new Map}}function Nd(n){P(!_n,"__referenceConstructor has already been defined"),_n=n}function Rd(){return P(_n,"Reference.ts has not been loaded"),_n}function Od(n){return n.views.size===0}function Us(n,e,t,r){const i=e.source.queryId;if(i!==null){const s=n.views.get(i);return P(s!=null,"SyncTree gave us an op for an invalid query."),xa(s,e,t,r)}else{let s=[];for(const o of n.views.values())s=s.concat(xa(o,e,t,r));return s}}function Ec(n,e,t,r,i){const s=e._queryIdentifier,o=n.views.get(s);if(!o){let c=mn(t,i?r:null),l=!1;c?l=!0:r instanceof M?(c=Os(t,r),l=!1):(c=M.EMPTY_NODE,l=!1);const a=Vn(new xt(c,l,!1),new xt(r,i,!1));return new Id(e,a)}return o}function Md(n,e,t,r,i,s){const o=Ec(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Td(o,t),Pd(o,t)}function Ld(n,e,t,r){const i=e._queryIdentifier,s=[];let o=[];const c=gt(n);if(i==="default")for(const[l,a]of n.views.entries())o=o.concat(ma(a,t,r)),pa(a)&&(n.views.delete(l),a.query._queryParams.loadsAllData()||s.push(a.query));else{const l=n.views.get(i);l&&(o=o.concat(ma(l,t,r)),pa(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||s.push(l.query)))}return c&&!gt(n)&&s.push(new(Rd())(e._repo,e._path)),{removed:s,events:o}}function Cc(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ht(n,e){let t=null;for(const r of n.views.values())t=t||Bd(r,e);return t}function wc(n,e){if(e._queryParams.loadsAllData())return Gn(n);{const r=e._queryIdentifier;return n.views.get(r)}}function bc(n,e){return wc(n,e)!=null}function gt(n){return Gn(n)!=null}function Gn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vn;function Ud(n){P(!vn,"__referenceConstructor has already been defined"),vn=n}function Wd(){return P(vn,"Reference.ts has not been loaded"),vn}let Hd=1;class ga{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ee(null),this.pendingWriteTree_=xd(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Dc(n,e,t,r,i){return id(n.pendingWriteTree_,e,t,r,i),i?sr(n,new kt(Ps(),e,t)):[]}function Vd(n,e,t,r){sd(n.pendingWriteTree_,e,t,r);const i=ee.fromObject(t);return sr(n,new Yt(Ps(),e,i))}function st(n,e,t=!1){const r=od(n.pendingWriteTree_,e);if(ad(n.pendingWriteTree_,e)){let s=new ee(null);return r.snap!=null?s=s.set(q(),!0):me(r.children,o=>{s=s.set(new X(o),!0)}),sr(n,new fn(r.path,s,t))}else return[]}function Vr(n,e,t){return sr(n,new kt(Ns(),e,t))}function $d(n,e,t){const r=ee.fromObject(t);return sr(n,new Yt(Ns(),e,r))}function Gd(n,e){return sr(n,new Nr(Ns(),e))}function zd(n,e,t){const r=Hs(n,t);if(r){const i=Vs(r),s=i.path,o=i.queryId,c=ge(s,e),l=new Nr(Rs(o),c);return $s(n,s,l)}else return[]}function yn(n,e,t,r,i=!1){const s=e._path,o=n.syncPointTree_.get(s);let c=[];if(o&&(e._queryIdentifier==="default"||bc(o,e))){const l=Ld(o,e,t,r);Od(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const a=l.removed;if(c=l.events,!i){const h=a.findIndex(u=>u._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(s,(u,f)=>gt(f));if(h&&!d){const u=n.syncPointTree_.subtree(s);if(!u.isEmpty()){const f=Jd(u);for(let p=0;p<f.length;++p){const _=f[p],g=_.query,E=Sc(n,_);n.listenProvider_.startListening(br(g),Rr(n,g),E.hashFn,E.onComplete)}}}!d&&a.length>0&&!r&&(h?n.listenProvider_.stopListening(br(e),null):a.forEach(u=>{const f=n.queryToTagMap.get(zn(u));n.listenProvider_.stopListening(br(u),f)}))}Yd(n,a)}return c}function Ac(n,e,t,r){const i=Hs(n,r);if(i!=null){const s=Vs(i),o=s.path,c=s.queryId,l=ge(o,e),a=new kt(Rs(c),l,t);return $s(n,o,a)}else return[]}function qd(n,e,t,r){const i=Hs(n,r);if(i){const s=Vs(i),o=s.path,c=s.queryId,l=ge(o,e),a=ee.fromObject(t),h=new Yt(Rs(c),l,a);return $s(n,o,h)}else return[]}function ls(n,e,t,r=!1){const i=e._path;let s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(u,f)=>{const p=ge(u,i);s=s||ht(f,p),o=o||gt(f)});let c=n.syncPointTree_.get(i);c?(o=o||gt(c),s=s||ht(c,q())):(c=new yc,n.syncPointTree_=n.syncPointTree_.set(i,c));let l;s!=null?l=!0:(l=!1,s=M.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((f,p)=>{const _=ht(p,q());_&&(s=s.updateImmediateChild(f,_))}));const a=bc(c,e);if(!a&&!e._queryParams.loadsAllData()){const u=zn(e);P(!n.queryToTagMap.has(u),"View does not exist, but we have a tag");const f=Qd();n.queryToTagMap.set(u,f),n.tagToQueryMap.set(f,u)}const h=$n(n.pendingWriteTree_,i);let d=Md(c,e,t,h,s,l);if(!a&&!o&&!r){const u=wc(c,e);d=d.concat(Xd(n,e,u))}return d}function Ws(n,e,t){const i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,c)=>{const l=ge(o,e),a=ht(c,l);if(a)return a});return pc(i,e,s,t,!0)}function Kd(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(a,h)=>{const d=ge(a,t);r=r||ht(h,d)});let i=n.syncPointTree_.get(t);i?r=r||ht(i,q()):(i=new yc,n.syncPointTree_=n.syncPointTree_.set(t,i));const s=r!=null,o=s?new xt(r,!0,!1):null,c=$n(n.pendingWriteTree_,e._path),l=Ec(i,e,c,s?o.getNode():M.EMPTY_NODE,s);return Fd(l)}function sr(n,e){return kc(e,n.syncPointTree_,null,$n(n.pendingWriteTree_,q()))}function kc(n,e,t,r){if(G(n.path))return Ic(n,e,t,r);{const i=e.get(q());t==null&&i!=null&&(t=ht(i,q()));let s=[];const o=V(n.path),c=n.operationForChild(o),l=e.children.get(o);if(l&&c){const a=t?t.getImmediateChild(o):null,h=mc(r,o);s=s.concat(kc(c,l,a,h))}return i&&(s=s.concat(Us(i,n,r,t))),s}}function Ic(n,e,t,r){const i=e.get(q());t==null&&i!=null&&(t=ht(i,q()));let s=[];return e.children.inorderTraversal((o,c)=>{const l=t?t.getImmediateChild(o):null,a=mc(r,o),h=n.operationForChild(o);h&&(s=s.concat(Ic(h,c,l,a)))}),i&&(s=s.concat(Us(i,n,r,t))),s}function Sc(n,e){const t=e.query,r=Rr(n,t);return{hashFn:()=>(Sd(e)||M.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?zd(n,t._path,r):Gd(n,t._path);{const s=Gh(i,t);return yn(n,t,null,s)}}}}function Rr(n,e){const t=zn(e);return n.queryToTagMap.get(t)}function zn(n){return n._path.toString()+"$"+n._queryIdentifier}function Hs(n,e){return n.tagToQueryMap.get(e)}function Vs(n){const e=n.indexOf("$");return P(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new X(n.substr(0,e))}}function $s(n,e,t){const r=n.syncPointTree_.get(e);P(r,"Missing sync point for query tag that we're tracking");const i=$n(n.pendingWriteTree_,e);return Us(r,t,i,null)}function Jd(n){return n.fold((e,t,r)=>{if(t&&gt(t))return[Gn(t)];{let i=[];return t&&(i=Cc(t)),me(r,(s,o)=>{i=i.concat(o)}),i}})}function br(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Wd())(n._repo,n._path):n}function Yd(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const i=zn(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function Qd(){return Hd++}function Xd(n,e,t){const r=e._path,i=Rr(n,e),s=Sc(n,t),o=n.listenProvider_.startListening(br(e),i,s.hashFn,s.onComplete),c=n.syncPointTree_.subtree(r);if(i)P(!gt(c.value),"If we're adding a query, it shouldn't be shadowed");else{const l=c.fold((a,h,d)=>{if(!G(a)&&h&&gt(h))return[Gn(h).query];{let u=[];return h&&(u=u.concat(Cc(h).map(f=>f.query))),me(d,(f,p)=>{u=u.concat(p)}),u}});for(let a=0;a<l.length;++a){const h=l[a];n.listenProvider_.stopListening(br(h),Rr(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Gs(t)}node(){return this.node_}}class zs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=se(this.path_,e);return new zs(this.syncTree_,t)}node(){return Ws(this.syncTree_,this.path_)}}const Zd=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},_a=function(n,e,t){if(!n||typeof n!="object")return n;if(P(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return jd(n[".sv"],e,t);if(typeof n[".sv"]=="object")return ef(n[".sv"],e);P(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},jd=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:P(!1,"Unexpected server value: "+n)}},ef=function(n,e,t){n.hasOwnProperty("increment")||P(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&P(!1,"Unexpected increment value: "+r);const i=e.node();if(P(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return typeof o!="number"?r:o+r},Fc=function(n,e,t,r){return qs(e,new zs(t,n),r)},Bc=function(n,e,t){return qs(n,new Gs(e),t)};function qs(n,e,t){const r=n.getPriority().val(),i=_a(r,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const o=n,c=_a(o.getValue(),e,t);return c!==o.getValue()||i!==o.getPriority().val()?new he(c,ce(i)):n}else{const o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new he(i))),o.forEachChild(oe,(c,l)=>{const a=qs(l,e.getImmediateChild(c),t);a!==l&&(s=s.updateImmediateChild(c,a))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Js(n,e){let t=e instanceof X?e:new X(e),r=n,i=V(t);for(;i!==null;){const s=qt(r.node.children,i)||{children:{},childCount:0};r=new Ks(i,r,s),t=te(t),i=V(t)}return r}function or(n){return n.node.value}function Tc(n,e){n.node.value=e,hs(n)}function Pc(n){return n.node.childCount>0}function tf(n){return or(n)===void 0&&!Pc(n)}function qn(n,e){me(n.node.children,(t,r)=>{e(new Ks(t,n,r))})}function Nc(n,e,t,r){t&&!r&&e(n),qn(n,i=>{Nc(i,e,!0,r)}),t&&r&&e(n)}function rf(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function $r(n){return new X(n.parent===null?n.name:$r(n.parent)+"/"+n.name)}function hs(n){n.parent!==null&&nf(n.parent,n.name,n)}function nf(n,e,t){const r=tf(t),i=$e(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,hs(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,hs(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf=/[\[\].#$\/\u0000-\u001F\u007F]/,of=/[\[\].#$\u0000-\u001F\u007F]/,ui=10*1024*1024,Ys=function(n){return typeof n=="string"&&n.length!==0&&!sf.test(n)},Rc=function(n){return typeof n=="string"&&n.length!==0&&!of.test(n)},af=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Rc(n)},cf=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Cs(n)||n&&typeof n=="object"&&$e(n,".sv")},lf=function(n,e,t,r){r&&e===void 0||Kn(Un(n,"value"),e,t)},Kn=function(n,e,t){const r=t instanceof X?new bu(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+yt(r));if(typeof e=="function")throw new Error(n+"contains a function "+yt(r)+" with contents = "+e.toString());if(Cs(e))throw new Error(n+"contains "+e.toString()+" "+yt(r));if(typeof e=="string"&&e.length>ui/3&&Ln(e)>ui)throw new Error(n+"contains a string greater than "+ui+" utf8 bytes "+yt(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(me(e,(o,c)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Ys(o)))throw new Error(n+" contains an invalid key ("+o+") "+yt(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Du(r,o),Kn(n,c,r),Au(r)}),i&&s)throw new Error(n+' contains ".value" child '+yt(r)+" in addition to actual children.")}},hf=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const s=Fr(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Ys(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(wu);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&Be(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},uf=function(n,e,t,r){if(r&&e===void 0)return;const i=Un(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const s=[];me(e,(o,c)=>{const l=new X(o);if(Kn(i,c,se(t,l)),ks(l)===".priority"&&!cf(c))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),hf(i,s)},Oc=function(n,e,t,r){if(!(r&&t===void 0)&&!Rc(t))throw new Error(Un(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},df=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Oc(n,e,t,r)},Mc=function(n,e){if(V(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},ff=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Ys(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!af(t))throw new Error(Un(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Jn(n,e){let t=null;for(let r=0;r<e.length;r++){const i=e[r],s=i.getPath();t!==null&&!Is(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function Lc(n,e,t){Jn(n,t),Uc(n,r=>Is(r,e))}function Te(n,e,t){Jn(n,t),Uc(n,r=>Be(r,e)||Be(e,r))}function Uc(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const i=n.eventLists_[r];if(i){const s=i.path;e(s)?(mf(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function mf(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();bt&&pe("event: "+t.toString()),ir(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xf="repo_interrupt",gf=25;class _f{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=dn(),this.transactionQueueTree_=new Ks,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function vf(n,e,t){if(n.stats_=Ds(n.repoInfo_),n.forceRestClient_||Jh())n.server_=new un(n.repoInfo_,(r,i,s,o)=>{va(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>ya(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{le(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Ze(n.repoInfo_,e,(r,i,s,o)=>{va(n,r,i,s,o)},r=>{ya(n,r)},r=>{Ef(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=jh(n.repoInfo_,()=>new Zu(n.stats_,n.server_)),n.infoData_=new Ku,n.infoSyncTree_=new ga({startListening:(r,i,s,o)=>{let c=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(c=Vr(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),c},stopListening:()=>{}}),Qs(n,"connected",!1),n.serverSyncTree_=new ga({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(c,l)=>{const a=o(c,l);Te(n.eventQueue_,r._path,a)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function yf(n){const t=n.infoData_.getNode(new X(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Yn(n){return Zd({timestamp:yf(n)})}function va(n,e,t,r,i){n.dataUpdateCount++;const s=new X(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){const l=on(t,a=>ce(a));o=qd(n.serverSyncTree_,s,l,i)}else{const l=ce(t);o=Ac(n.serverSyncTree_,s,l,i)}else if(r){const l=on(t,a=>ce(a));o=$d(n.serverSyncTree_,s,l)}else{const l=ce(t);o=Vr(n.serverSyncTree_,s,l)}let c=s;o.length>0&&(c=Xt(n,s)),Te(n.eventQueue_,c,o)}function ya(n,e){Qs(n,"connected",e),e===!1&&Df(n)}function Ef(n,e){me(e,(t,r)=>{Qs(n,t,r)})}function Qs(n,e,t){const r=new X("/.info/"+e),i=ce(t);n.infoData_.updateSnapshot(r,i);const s=Vr(n.infoSyncTree_,r,i);Te(n.eventQueue_,r,s)}function Xs(n){return n.nextWriteId_++}function Cf(n,e,t){const r=Kd(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{const s=ce(i).withIndex(e._queryParams.getIndex());ls(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Vr(n.serverSyncTree_,e._path,s);else{const c=Rr(n.serverSyncTree_,e);o=Ac(n.serverSyncTree_,e._path,s,c)}return Te(n.eventQueue_,e._path,o),yn(n.serverSyncTree_,e,t,null,!0),s},i=>(Gr(n,"get for query "+le(e)+" failed: "+i),Promise.reject(new Error(i))))}function wf(n,e,t,r,i){Gr(n,"set",{path:e.toString(),value:t,priority:r});const s=Yn(n),o=ce(t,r),c=Ws(n.serverSyncTree_,e),l=Bc(o,c,s),a=Xs(n),h=Dc(n.serverSyncTree_,e,l,a,!0);Jn(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(u,f)=>{const p=u==="ok";p||_e("set at "+e+" failed: "+u);const _=st(n.serverSyncTree_,a,!p);Te(n.eventQueue_,e,_),us(n,i,u,f)});const d=js(n,e);Xt(n,d),Te(n.eventQueue_,d,[])}function bf(n,e,t,r){Gr(n,"update",{path:e.toString(),value:t});let i=!0;const s=Yn(n),o={};if(me(t,(c,l)=>{i=!1,o[c]=Fc(se(e,c),ce(l),n.serverSyncTree_,s)}),i)pe("update() called with empty data.  Don't do anything."),us(n,r,"ok",void 0);else{const c=Xs(n),l=Vd(n.serverSyncTree_,e,o,c);Jn(n.eventQueue_,l),n.server_.merge(e.toString(),t,(a,h)=>{const d=a==="ok";d||_e("update at "+e+" failed: "+a);const u=st(n.serverSyncTree_,c,!d),f=u.length>0?Xt(n,e):e;Te(n.eventQueue_,f,u),us(n,r,a,h)}),me(t,a=>{const h=js(n,se(e,a));Xt(n,h)}),Te(n.eventQueue_,e,[])}}function Df(n){Gr(n,"onDisconnectEvents");const e=Yn(n),t=dn();ns(n.onDisconnect_,q(),(i,s)=>{const o=Fc(i,s,n.serverSyncTree_,e);hc(t,i,o)});let r=[];ns(t,q(),(i,s)=>{r=r.concat(Vr(n.serverSyncTree_,i,s));const o=js(n,i);Xt(n,o)}),n.onDisconnect_=dn(),Te(n.eventQueue_,q(),r)}function Af(n,e,t){let r;V(e._path)===".info"?r=ls(n.infoSyncTree_,e,t):r=ls(n.serverSyncTree_,e,t),Lc(n.eventQueue_,e._path,r)}function Ea(n,e,t){let r;V(e._path)===".info"?r=yn(n.infoSyncTree_,e,t):r=yn(n.serverSyncTree_,e,t),Lc(n.eventQueue_,e._path,r)}function kf(n){n.persistentConnection_&&n.persistentConnection_.interrupt(xf)}function Gr(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),pe(t,...e)}function us(n,e,t,r){e&&ir(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let s=i;r&&(s+=": "+r);const o=new Error(s);o.code=i,e(o)}})}function Wc(n,e,t){return Ws(n.serverSyncTree_,e,t)||M.EMPTY_NODE}function Zs(n,e=n.transactionQueueTree_){if(e||Qn(n,e),or(e)){const t=Vc(n,e);P(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&If(n,$r(e),t)}else Pc(e)&&qn(e,t=>{Zs(n,t)})}function If(n,e,t){const r=t.map(a=>a.currentWriteId),i=Wc(n,e,r);let s=i;const o=i.hash();for(let a=0;a<t.length;a++){const h=t[a];P(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=ge(e,h.path);s=s.updateChild(d,h.currentOutputSnapshotRaw)}const c=s.val(!0),l=e;n.server_.put(l.toString(),c,a=>{Gr(n,"transaction put response",{path:l.toString(),status:a});let h=[];if(a==="ok"){const d=[];for(let u=0;u<t.length;u++)t[u].status=2,h=h.concat(st(n.serverSyncTree_,t[u].currentWriteId)),t[u].onComplete&&d.push(()=>t[u].onComplete(null,!0,t[u].currentOutputSnapshotResolved)),t[u].unwatcher();Qn(n,Js(n.transactionQueueTree_,e)),Zs(n,n.transactionQueueTree_),Te(n.eventQueue_,e,h);for(let u=0;u<d.length;u++)ir(d[u])}else{if(a==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{_e("transaction at "+l.toString()+" failed: "+a);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=a}Xt(n,e)}},o)}function Xt(n,e){const t=Hc(n,e),r=$r(t),i=Vc(n,t);return Sf(n,i,r),r}function Sf(n,e,t){if(e.length===0)return;const r=[];let i=[];const o=e.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<e.length;c++){const l=e[c],a=ge(t,l.path);let h=!1,d;if(P(a!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,i=i.concat(st(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=gf)h=!0,d="maxretry",i=i.concat(st(n.serverSyncTree_,l.currentWriteId,!0));else{const u=Wc(n,l.path,o);l.currentInputSnapshot=u;const f=e[c].update(u.val());if(f!==void 0){Kn("transaction failed: Data returned ",f,l.path);let p=ce(f);typeof f=="object"&&f!=null&&$e(f,".priority")||(p=p.updatePriority(u.getPriority()));const g=l.currentWriteId,E=Yn(n),m=Bc(p,u,E);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=m,l.currentWriteId=Xs(n),o.splice(o.indexOf(g),1),i=i.concat(Dc(n.serverSyncTree_,l.path,m,l.currentWriteId,l.applyLocally)),i=i.concat(st(n.serverSyncTree_,g,!0))}else h=!0,d="nodata",i=i.concat(st(n.serverSyncTree_,l.currentWriteId,!0))}Te(n.eventQueue_,t,i),i=[],h&&(e[c].status=2,function(u){setTimeout(u,Math.floor(0))}(e[c].unwatcher),e[c].onComplete&&(d==="nodata"?r.push(()=>e[c].onComplete(null,!1,e[c].currentInputSnapshot)):r.push(()=>e[c].onComplete(new Error(d),!1,null))))}Qn(n,n.transactionQueueTree_);for(let c=0;c<r.length;c++)ir(r[c]);Zs(n,n.transactionQueueTree_)}function Hc(n,e){let t,r=n.transactionQueueTree_;for(t=V(e);t!==null&&or(r)===void 0;)r=Js(r,t),e=te(e),t=V(e);return r}function Vc(n,e){const t=[];return $c(n,e,t),t.sort((r,i)=>r.order-i.order),t}function $c(n,e,t){const r=or(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);qn(e,i=>{$c(n,i,t)})}function Qn(n,e){const t=or(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,Tc(e,t.length>0?t:void 0)}qn(e,r=>{Qn(n,r)})}function js(n,e){const t=$r(Hc(n,e)),r=Js(n.transactionQueueTree_,e);return rf(r,i=>{di(n,i)}),di(n,r),Nc(r,i=>{di(n,i)}),t}function di(n,e){const t=or(e);if(t){const r=[];let i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(P(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(P(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(st(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Tc(e,void 0):t.length=s+1,Te(n.eventQueue_,$r(e),i);for(let o=0;o<r.length;o++)ir(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ff(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Bf(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):_e(`Invalid query segment '${t}' in query '${n}'`)}return e}const Ca=function(n,e){const t=Tf(n),r=t.namespace;t.domain==="firebase.com"&&je(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&je("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Uh();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new K0(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new X(t.pathString)}},Tf=function(n){let e="",t="",r="",i="",s="",o=!0,c="https",l=443;if(typeof n=="string"){let a=n.indexOf("//");a>=0&&(c=n.substring(0,a-1),n=n.substring(a+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(i=Ff(n.substring(h,d)));const u=Bf(n.substring(Math.min(n.length,d)));a=e.indexOf(":"),a>=0?(o=c==="https"||c==="wss",l=parseInt(e.substring(a+1),10)):a=e.length;const f=e.slice(0,a);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const p=e.indexOf(".");r=e.substring(0,p).toLowerCase(),t=e.substring(p+1),s=r}"ns"in u&&(s=u.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:c,pathString:i,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+le(this.snapshot.exportVal())}}class zc{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return P(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return G(this._path)?null:ks(this._path)}get ref(){return new Ge(this._repo,this._path)}get _queryIdentifier(){const e=aa(this._queryParams),t=ws(e);return t==="{}"?"default":t}get _queryObject(){return aa(this._queryParams)}isEqual(e){if(e=nr(e),!(e instanceof eo))return!1;const t=this._repo===e._repo,r=Is(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Cu(this._path)}}class Ge extends eo{constructor(e,t){super(e,t,new Ts,!1)}get parent(){const e=rc(this._path);return e===null?null:new Ge(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Zt{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new X(e),r=En(this.ref,e);return new Zt(this._node.getChild(t),r,oe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new Zt(i,En(this.ref,r),oe)))}hasChild(e){const t=new X(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function vt(n,e){return n=nr(n),n._checkNotDeleted("ref"),e!==void 0?En(n._root,e):n._root}function En(n,e){return n=nr(n),V(n._path)===null?df("child","path",e,!1):Oc("child","path",e,!1),new Ge(n._repo,se(n._path,e))}function Pf(n){return Mc("remove",n._path),Kc(n,null)}function Kc(n,e){n=nr(n),Mc("set",n._path),lf("set",e,n._path,!1);const t=new Mn;return wf(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function fi(n,e){uf("update",e,n._path,!1);const t=new Mn;return bf(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Nf(n){n=nr(n);const e=new qc(()=>{}),t=new Xn(e);return Cf(n._repo,n,t).then(r=>new Zt(r,new Ge(n._repo,n._path),n._queryParams.getIndex()))}class Xn{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new Gc("value",this,new Zt(e.snapshotNode,new Ge(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new zc(this,e,t):null}matches(e){return e instanceof Xn?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class to{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new zc(this,e,t):null}createEvent(e,t){P(e.childName!=null,"Child events should have a childName.");const r=En(new Ge(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Gc(e.type,this,new Zt(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof to?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Rf(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){const l=t,a=(h,d)=>{Ea(n._repo,n,c),l(h,d)};a.userCallback=t.userCallback,a.context=t.context,t=a}const o=new qc(t,s||void 0),c=e==="value"?new Xn(o):new to(e,o);return Af(n._repo,n,c),()=>Ea(n._repo,n,c)}function Of(n,e,t,r){return Rf(n,"value",e,t,r)}Nd(Ge);Ud(Ge);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mf="FIREBASE_DATABASE_EMULATOR_HOST",ds={};let Lf=!1;function Uf(n,e,t,r){n.repoInfo_=new K0(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function Wf(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||je("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pe("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Ca(s,i),c=o.repoInfo,l,a;typeof process<"u"&&$o&&(a=$o[Mf]),a?(l=!0,s=`http://${a}?ns=${c.namespace}`,o=Ca(s,i),c=o.repoInfo):l=!o.repoInfo.secure;const h=i&&l?new Wt(Wt.OWNER):new Qh(n.name,n.options,e);ff("Invalid Firebase Database URL",o),G(o.path)||je("Database URL must point to the root of a Firebase Database (not including a child path).");const d=Vf(c,n,h,new Yh(n.name,t));return new $f(d,n)}function Hf(n,e){const t=ds[e];(!t||t[n.key]!==n)&&je(`Database ${e}(${n.repoInfo_}) has already been deleted.`),kf(n),delete t[n.key]}function Vf(n,e,t,r){let i=ds[e.name];i||(i={},ds[e.name]=i);let s=i[n.toURLString()];return s&&je("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new _f(n,Lf,t,r),i[n.toURLString()]=s,s}class $f{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(vf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ge(this._repo,q())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Hf(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&je("Cannot call "+e+" on a deleted database.")}}function Gf(n=vs(),e){const t=Ol(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=Ml("database");r&&zf(t,...r)}return t}function zf(n,e,t,r={}){n=nr(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&je("Cannot call useEmulator() after instance has already been initialized.");const i=n._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&je('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Wt(Wt.OWNER);else if(r.mockUserToken){const o=typeof r.mockUserToken=="string"?r.mockUserToken:Ll(r.mockUserToken,n.app.options.projectId);s=new Wt(o)}Uf(i,e,t,s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(n){Nh(Xl),Ul(new Wl("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Wf(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Io(Go,zo,n),Io(Go,zo,"esm2017")}function wa(n){return{".sv":{increment:n}}}Ze.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ze.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};qf();class Kf{_db;constructor(){this._db=Gf()}async getChild({childPath:e}){try{const t=vt(this._db,`${envKey}/${e}`);return await Nf(t)}catch(t){throw t}}async updateChild({childPath:e,data:t}){try{const r=vt(this._db,`${envKey}/${e}`);return await fi(r,t),!0}catch{return!1}}async removeChild({childPath:e}){try{const t=vt(this._db,`${envKey}/${e}`);return await Pf(t),!0}catch{return!1}}async incrementNumberChild({childPath:e,valueId:t,delta:r,command:i}){try{i==="decrement"&&(r=-r);const s={[t]:wa(r)},o=vt(this._db,`${envKey}/${e}`);return await fi(o,s),!0}catch{return!1}}async incrementMultipleNumberChild({childPath:e,data:t}){try{const r={};for(const[s,o]of Object.entries(t))r[s]=wa(o);const i=vt(this._db,`${envKey}/${e}`);return await fi(i,r),!0}catch{return!1}}listenToChild({childPath:e,callback:t}){const r=vt(this._db,`${envKey}/${e}`);return Of(r,t)}async setChild({childPath:e,data:t}){try{const r=vt(this._db,`${envKey}/${e}`);return await Kc(r,t),!0}catch{return!1}}}class Jf extends Kf{_firestore;constructor(){v0().length===0?y0(x0):vs(),super(),this._firestore=Bl()}get getBatch(){return Tl(this._firestore)}async getDocSRV({path:e,docId:t,insideEnviroments:r=!0}){try{const i=be(this._firestore,r?`${ye}/${e}`:e),s=De(i,t);return await Pl(s)}catch(i){if(i instanceof Error)throw Re.error(i.message),AppErrorsHelper.GI().addError({error:Errors.serverError,details:i.message}),i}}async commmitBatch(e){try{return await e.commit(),!0}catch(t){throw Re.error("Error while commit batch -->",t),t instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:t.toString()}),new Error(`Server Error: ${t}`)}}async runTransaction(e){try{return await Nl(this._firestore,async r=>await e(r))}catch(t){throw console.error("Error while run transaction -->",t),t instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:t.toString()}),new Error(`Server Error: ${t}`)}}async transactionGet(e,t,r){try{const i=be(this._firestore,`${ye}/${t}`),s=De(i,r);return await e.get(s)}catch(i){throw console.error("Error while getting document in transaction -->",i),i instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:i.toString()}),new Error(`Server Error: ${i}`)}}async transactionUpdateAsMap({transaction:e,path:t,docId:r,fieldName:i,value:s}){try{const o=be(this._firestore,`${ye}/${t}`),c=De(o,r),l={[i]:s||ri()};e.update(c,l)}catch(o){throw Re.error("Error while updating document in transaction -->",o),o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async setAsMap({batch:e,path:t,docId:r,data:i,insideEnviroments:s=!0}){try{const o=be(this._firestore,s?`${ye}/${t}`:t),c=De(o,r);e.set(c,i,{merge:!0})}catch(o){throw o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),o}}async transactionUpdateMultipleFieldsAsMap({transaction:e,path:t,docId:r,data:i,insideEnvironments:s=!0}){try{const o=be(this._firestore,s?`${ye}/${t}`:t),c=De(o,r),l=this.organizeData(i);e.update(c,l)}catch(o){throw console.error("Error while updating multiple fields in transaction -->",o),o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async transactionCreateDoc({transaction:e,path:t,docId:r,value:i}){try{const s=be(this._firestore,`${ye}/${t}`),o=De(s,r);e.set(o,i)}catch(s){throw Re.error("Error while creating document in transaction -->",s),s instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:s.toString()}),new Error(`Server Error: ${s}`)}}async transactionSetAsMap({transaction:e,path:t,docId:r,data:i}){try{const s=be(this._firestore,`${ye}/${t}`),o=De(s,r),c=this.organizeData(i);e.set(o,c,{merge:!0})}catch(s){throw Re.error("Error while setting document as map in transaction -->",s),s instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:s.toString()}),new Error(`Server Error: ${s}`)}}async deleteDoc({batch:e,path:t,docId:r}){try{const i=be(this._firestore,`${ye}/${t}`),s=De(i,r);e.delete(s)}catch(i){throw i instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:i.toString()}),i}}async setDoc({batch:e,path:t,docId:r,valueToSet:i,insideEnviroments:s=!0}){try{const o=be(this._firestore,s?`${ye}/${t}`:t),c=De(o,r);e.set(c,i)}catch(o){throw o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),o}}async createDoc({batch:e,path:t,docId:r,valueAsJson:i,insideEnviroments:s=!0,mergeIfExist:o=!1}){try{const c=o?{merge:!0}:null,l=be(this._firestore,s?`${ye}/${t}`:t),a=De(l,r);e.set(a,i,{merge:o})}catch(c){throw c instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:c.toString()}),c}}async updateFieldInsideDocAsMap({batch:e,path:t,docId:r,value:i,fieldName:s,command:o,insideEnviroments:c=!0}){try{const l=be(this._firestore,c?`${ye}/${t}`:t),a=De(l,r);o===null?e.update(a,{[s]:i??ri()}):e.update(a,{[s]:o===1?Qr(1):Qr(-1)})}catch(l){throw l instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:l.toString()}),l}}async updateMultipleFieldsInsideDocAsMap({batch:e,path:t,docId:r,data:i,insideEnviroments:s=!0}){try{const o=be(this._firestore,s?`${ye}/${t}`:t),c=De(o,r);e.update(c,this.organizeData(i))}catch(o){throw Re.error("Error while updating the batch -->",o),o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}docListener({path:e,docId:t,onChanged:r}){try{const i=be(this._firestore,`${ye}/${e}`),s=De(i,t);return Rl(s,r)}catch(i){throw i instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:i.message}),i}}organizeData(e){var t={};return Object.entries(e).forEach(([r,i])=>{let s=i;s===null&&(s=ri()),s===1&&(s=Qr(1)),s===0&&(s=Qr(-1)),t[r]=s}),t}get currentTimestamp(){return pt.now()}}class ro extends Jf{constructor(){super()}async getDocRepo({path:e,docId:t,insideEnviroments:r=!0}){return await super.getDocSRV({path:e,docId:t,insideEnviroments:r})}async createDocRepo({path:e,docId:t,valueAsJson:r,insideEnviroments:i=!0,mergeIfExist:s=!1}){const o=this.getBatch;return super.createDoc({batch:o,path:e,docId:t,valueAsJson:r,insideEnviroments:i,mergeIfExist:s}),await this.commmitBatch(o)}async updateFieldInsideDocAsMapRepo({path:e,docId:t,fieldName:r,value:i,insideEnviroments:s=!0,command:o=null}){const c=this.getBatch;return this.updateFieldInsideDocAsMap({batch:c,path:e,docId:t,fieldName:r,value:i,command:o,insideEnviroments:s}),await this.commmitBatch(c)}async updateMultipleFieldsInsideDocAsMapRepo({path:e,docId:t,data:r,insideEnviroments:i=!0}){const s=this.getBatch;return super.updateMultipleFieldsInsideDocAsMap({batch:s,path:e,docId:t,data:r,insideEnviroments:i}),await this.commmitBatch(s)}async deleteDocRepo({path:e,docId:t}){const r=this.getBatch;return super.deleteDoc({batch:r,path:e,docId:t}),await this.commmitBatch(r)}async setDocRepo({path:e,docId:t,valueAsJson:r,insideEnviroments:i=!0}){const s=this.getBatch;return super.setDoc({batch:s,path:e,docId:t,valueToSet:r,insideEnviroments:i}),await this.commmitBatch(s)}async setAsMapWithMergeRepo({path:e,docId:t,valueAsJson:r,insideEnviroments:i=!0}){const s=this.getBatch;return super.setAsMap({batch:s,path:e,docId:t,data:r,insideEnviroments:i}),await this.commmitBatch(s)}docListenerRepo({path:e,docId:t,onChanged:r}){return super.docListener({path:e,docId:t,onChanged:r})}}class zr{code="";name="";symbol="";constructor({code:e="",name:t="",symbol:r=""}={}){this.code=e,this.name=t,this.symbol=r}static fromJson(e){return new zr({code:e.code||"",name:e.name||"",symbol:e.symbol||""})}toJson(){return{code:this.code,name:this.name,symbol:this.symbol}}isEqual(e){return e.code===this.code}toString(){return JSON.stringify(this.toJson(),null,2)}}const no=new zr({code:"USD",name:"US Dollar",symbol:"$"}),rn=5;class Ke{static currentBusinesssId="";static hasPaddingFromTop=!1;static paddingFromTop=0;static attemptsLeftForCardPassword=rn;static productionVersion=!0;static developers={}}function Yf(n){const e=n.toString(),t=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16);return(t*299+r*587+i*114)/1e3>155}async function Qf(){return!0}var fs=(n=>(n[n.light=0]="light",n[n.dark=1]="dark",n))(fs||{});class Qe{background=0;primary=0;surface=0;inverseSurface=0;tertiary=0;id="";fontName="";themeName="";constructor({background:e=0,primary:t=0,surface:r=0,inverseSurface:i=0,tertiary:s=0,id:o,fontName:c="",themeName:l=""}){this.background=e,this.primary=t,this.surface=r,this.inverseSurface=i,this.tertiary=s,this.id=o,this.fontName=c,this.themeName=l}static fromJson(e,t){return new Qe({background:e.background||0,primary:e.primary||0,id:t,themeName:e.themeName||"",surface:e.surface||0,tertiary:e.tertiary||0,inverseSurface:e.inverseSurface||0,fontName:e.fontName||""})}static fromBusinessTheme(e){return new Qe({themeName:e.themeName,background:e.background,primary:e.primary,tertiary:e.tertiary,id:e.id,surface:e.surface,inverseSurface:e.inverseSurface,fontName:e.fontName})}isEqual(e,t=!0){const r=e.toJson();t&&(r.id=e.id);const i=this.toJson();return t&&(i.id=this.id),JSON.stringify(r)===JSON.stringify(i)}get brightness(){return Yf(this.background)?1:0}toJson(){const e={};return this.fontName!==""&&(e.fontName=this.fontName),this.surface!==0&&(e.surface=this.surface),this.inverseSurface!==0&&(e.inverseSurface=this.inverseSurface),e.tertiary=this.tertiary,e.themeName=this.themeName,this.background!==0&&(e.background=this.background),this.primary!==0&&(e.primary=this.primary),e}}var ze=(n=>(n[n.Grid=0]="Grid",n[n.Carousel=1]="Carousel",n[n.EndlessCarousel=2]="EndlessCarousel",n))(ze||{});const ba={0:"grid",1:"carousel",2:"endlessCarousel"},Da={grid:0,carousel:1,endlessCarousel:2},Jc={dark:new Qe({fontName:"Varela Round",themeName:"Original",id:"dark",inverseSurface:4279637532,background:4280229673,surface:4280690225,tertiary:4279834916,primary:4294940672}),darkIos:new Qe({fontName:"Varela Round",themeName:"Dark",id:"darkIos",inverseSurface:4281084974,background:4279637528,surface:4280361252,tertiary:4278190080,primary:4278225100}),light:new Qe({fontName:"Varela Round",themeName:"Pink",id:"light",inverseSurface:4294831859,background:4294375158,surface:4294967295,tertiary:4294243315,primary:4294936498}),lightIos:new Qe({fontName:"Varela Round",themeName:"Light",id:"lightIos",inverseSurface:4292664541,background:4294111991,surface:4294967295,tertiary:4293322471,primary:4278221567})};class Le{id="";token="";constructor(e){e&&(this.id=e.I||"",this.token=e.T||"")}static fromShopIconUrl(e){const t=new Le;try{const r=e.split("SHOPICON");t.id=r[1].split("?alt")[0];const i=e.split("&token=");return t.token=i[1],t}catch{return new Le}}static fromJson(e){const t=new Le;return t.id=e.I||"",t.token=e.T||"",t}static fromJsonStr(e){const t=JSON.parse(e),r=new Le;return r.id=t.I||"",r.token=t.T||"",r}get isEmpty(){return this.token===""||this.id===""}get isNotEmpty(){return this.token!==""&&this.id!==""}isEqual(e){return e.id==this.id&&e.token==this.token}getShopIconPath(e){return this.token===""||this.id===""?"":`https://firebasestorage.googleapis.com/v0/b/managementsystemapp-c1fda.appspot.com/o/enviroments%2F${ye.replace("enviroments/","")}%2F${e}%2Fimages%2Flogos%2FSHOPICON${this.id}?alt=media&token=${this.token}`}toJsonStr(){const e={I:this.id,T:this.token};return JSON.stringify(e)}toJson(){return{I:this.id,T:this.token}}}class Vt{amount=0;currency=no;constructor({amount:e,currency:t}){const r=parseFloat(e)||0;this.amount=parseFloat(r.toFixed(2)),this.currency=t}static fromJson(e){const t=new Vt({amount:"0.0",currency:zr.fromJson(e.currency)});return e.amount!=null&&(t.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),t}add(e){e.currency.code===this.currency.code&&(this.amount+=e.amount)}isEqual(e){return this.amount===e.amount&&this.currency.code===e.currency.code}toString(){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.currency.code}).format(this.amount)}toJson(){return{amount:this.amount,currency:this.currency.toJson()}}}class jt{description="";price;imageUrl="";id="";name="";createdAt=new Date;constructor({name:e="",description:t="",id:r="",price:i,imageUrl:s=""}={}){this.name=e||"",this.description=t||"",this.id=r||"",this.price=i,this.imageUrl=s||""}static fromProduct(e){const t=new jt({id:e.id,description:e.description,price:e.price,imageUrl:e.imageUrl,name:e.name});return t.createdAt=e.createdAt,t}static fromJson(e,t){const r=new jt({id:t,description:e.description,price:Vt.fromJson(e.price),imageUrl:e.imageUrl,name:e.name});return r.createdAt=e.createdAt,r}toJson(){return{description:this.description,price:this.price?this.price.toJson():null,imageUrl:this.imageUrl,name:this.name,createdAt:this.createdAt}}toString(){return JSON.stringify(this.toJson())}}class er{title="";content="";lastModified="";index="";id="";popOnEnter=!1;constructor(e,t,r,i,s,o=!1){this.title=e,this.content=t,this.id=r,this.lastModified=i,this.index=s,this.popOnEnter=o}static fromJson(e,t){return new er(e.title??"",e.content??"",e.id??"",e.lastModified??"",t,e.popOnEnter??!1)}static fromUpdate(e){return new er(e.title,e.content,e.id,e.lastModified,e.index,e.popOnEnter)}toJson(){const e={};return e.title=this.title,e.id=this.id,e.content=this.content,this.lastModified!==""&&(e.lastModified=this.lastModified),this.popOnEnter&&(e.popOnEnter=this.popOnEnter),e}isValid(){return this.title!==""&&this.content!==""}toString(){return JSON.stringify(this,null,2)}}class Xe{storyView=ze.Grid;productView=ze.Grid;changingImages=[];products=new Map;updates=new Map;storyTitle="";shopIconUrl="";productsTitle="";bottomIcons=!1;changingImagesSwapSeconds=6;pickedThemeKey="darkIos";lastTimeToUpdateTerm=new Date(0);businessThemes=new Map;term="";mustConfirmTerm=!1;popTermOnFirstEneter=!1;isPrivateTheme=!1;constructor({storyView:e=ze.Grid,productView:t=ze.Grid,changingImagesSwapSeconds:r=6,shopIconUrl:i="",pickedThemeKey:s="darkIos"}={}){this.changingImagesSwapSeconds=r,this.shopIconUrl=i,this.pickedThemeKey=s}static fromJson(e){const t=new Xe;return Object.entries(e.products).forEach(([r,i])=>{t.products.set(r,jt.fromJson(i,r))}),e.changingImages&&(t.changingImages=e.changingImages.map(r=>r)),e.updates&&Object.entries(e.updates).forEach(([r,i])=>{t.updates.set(r,er.fromJson(i,r))}),e.storyView&&(t.storyView=Da[e.storyView]||ze.EndlessCarousel),e.productView&&(t.productView=Da[e.productView]||ze.Grid),e.businessThemes&&Object.entries(e.businessThemes).forEach(([r,i])=>{t.businessThemes.set(r,Qe.fromJson(i,r))}),e.lastTimeToUpdateTerm&&(t.lastTimeToUpdateTerm=new Date(e.lastTimeToUpdateTerm)||new Date(0)),t.pickedThemeKey=e.pickedThemeKey||"darkIoss",t.term=e.term||"",t.bottomIcons=e.bottomIcons||!1,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds||6,t.productsTitle=e.productsTitle||"",t.storyTitle=e.storyTitle||"",t.shopIconUrl=e.shopIcon||"",t.mustConfirmTerm=e.mustConfirmTerm||!1,t.popTermOnFirstEneter=e.popTermOnFirstEneter||!1,t.isPrivateTheme=e.isPrivateTheme||!1,t}get shopIconData(){return Le.fromShopIconUrl(this.shopIconUrl)}static fromBusinessDesign(e){const t=new Xe;return e.products.forEach((r,i)=>{t.products.set(i,jt.fromProduct(r))}),t.changingImages=[...e.changingImages],e.updates.forEach((r,i)=>{t.updates.set(i,er.fromUpdate(r))}),t.storyView=e.storyView,e.businessThemes.forEach((r,i)=>{t.businessThemes.set(i,Qe.fromBusinessTheme(r))}),t.shopIconUrl=e.shopIconUrl,t.pickedThemeKey=e.pickedThemeKey,t.lastTimeToUpdateTerm=e.lastTimeToUpdateTerm,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds,t.term=e.term,t.bottomIcons=e.bottomIcons,t.productsTitle=e.productsTitle,t.productView=e.productView,t.storyTitle=e.storyTitle,t.mustConfirmTerm=e.mustConfirmTerm,t.popTermOnFirstEneter=e.popTermOnFirstEneter,t.isPrivateTheme=e.isPrivateTheme,t}toJson(){const e={};return this.storyView!==ze.EndlessCarousel&&(e.storyView=ba[this.storyView]),this.productView!==ze.Grid&&(e.productView=ba[this.storyView]),e.changingImages=this.changingImages,e.products={},this.products.forEach((t,r)=>{e.products[r]=t.toJson()}),e.updates={},this.updates.forEach((t,r)=>{e.updates[r]=t.toJson()}),this.mustConfirmTerm&&(e.mustConfirmTerm=this.mustConfirmTerm),this.popTermOnFirstEneter&&(e.popTermOnFirstEneter=this.popTermOnFirstEneter),this.term!==""&&(e.term=this.term),this.lastTimeToUpdateTerm!==new Date(0)&&(e.lastTimeToUpdateTerm=this.lastTimeToUpdateTerm.toISOString()),e.bottomIcons=this.bottomIcons,e.changingImagesSwapSeconds=this.changingImagesSwapSeconds,e.storyTitle=this.storyTitle,e.productsTitle=this.productsTitle,e.businessThemes={},this.businessThemes.forEach((t,r)=>{Jc.hasOwnProperty(r)||(e.businessThemes[r]=t.toJson())}),e.pickedThemeKey=this.pickedThemeKey,e.shopIcon=this.shopIconUrl,e.isPrivateTheme=this.isPrivateTheme,e}}class Cn{businessId="";shopIcon=new Le;businessName="";constructor({businessId:e="",businessName:t="",shopIcon:r=new Le}={}){this.businessId=e,this.shopIcon=r,this.businessName=t}static empty(){return new Cn}static fromJsonStr(e){const t=JSON.parse(e),r=Cn.empty();return r.businessId=t.businessId,r.businessName=t.businessName,t.shopIcon&&(r.shopIcon=Le.fromJsonStr(t.shopIcon)),r}toJsonStr(){const e={businessId:this.businessId,shopIcon:this.shopIcon.toJsonStr(),businessName:this.businessName};return JSON.stringify(e)}}var $t=(n=>(n[n.Barber=0]="Barber",n[n.Polish=1]="Polish",n[n.Beautician=2]="Beautician",n[n.ManicurePedicure=3]="ManicurePedicure",n[n.Eyelashes=4]="Eyelashes",n[n.Eyebrows=5]="Eyebrows",n[n.Braids=6]="Braids",n[n.MakeUpArtist=7]="MakeUpArtist",n[n.TattooArtist=8]="TattooArtist",n[n.HairRemoval=9]="HairRemoval",n[n.Masseur=10]="Masseur",n[n.Physiotherapy=11]="Physiotherapy",n[n.Cobblers=12]="Cobblers",n[n.Clown=13]="Clown",n[n.SocialWorker=14]="SocialWorker",n[n.Magician=15]="Magician",n[n.Doctor=16]="Doctor",n[n.Veterinarian=17]="Veterinarian",n[n.CommunicationTherapist=18]="CommunicationTherapist",n[n.DogGroomer=19]="DogGroomer",n[n.DJ=20]="DJ",n[n.Psychologist=21]="Psychologist",n[n.Tutor=22]="Tutor",n[n.WeddingDresses=23]="WeddingDresses",n[n.DanceTeacher=24]="DanceTeacher",n[n.Babysitter=25]="Babysitter",n[n.Reflexologist=26]="Reflexologist",n[n.Dietitian=27]="Dietitian",n[n.CarWash=28]="CarWash",n[n.Photographer=29]="Photographer",n[n.SwimmingTeacher=30]="SwimmingTeacher",n[n.Counselor=31]="Counselor",n[n.Mentor=32]="Mentor",n[n.TennisCoach=33]="TennisCoach",n[n.PrivateChef=34]="PrivateChef",n[n.PersonalTrainer=35]="PersonalTrainer",n[n.Lawyer=36]="Lawyer",n[n.Sales=37]="Sales",n[n.RealEstate=38]="RealEstate",n[n.DrivingTeacher=39]="DrivingTeacher",n[n.InvestmentAdvice=40]="InvestmentAdvice",n[n.Library=41]="Library",n[n.Tailor=42]="Tailor",n[n.Restaurant=43]="Restaurant",n[n.NailConstruction=44]="NailConstruction",n[n.Dentist=45]="Dentist",n[n.BeautysSalon=46]="BeautysSalon",n[n.Washer=47]="Washer",n[n.CleaningSofas=48]="CleaningSofas",n[n.Other=49]="Other",n))($t||{});const Xf={0:"barber",1:"polish",48:"cleaningSofas",2:"beautician",3:"manicurePedicure",4:"eyelashes",5:"eyebrows",25:"babysitter",6:"braids",7:"makeUpArtist",8:"tattooArtist",9:"hairRemoval",10:"masseur",12:"cobblers",13:"clown",14:"socialWorker",15:"magician",16:"doctor",20:"dj",17:"veterinarian",18:"communicationTherapist",19:"dogGroomer",21:"psychologist",11:"physiotherapy",22:"Tutor",23:"weddingDresses",24:"danceTeacher",26:"reflexologist",27:"dietitian",28:"carWash",29:"photographer",30:"swimmingTeacher",31:"counselor",32:"mentor",33:"tennisCoach",34:"privateChef",35:"personalTrainer",36:"lawyer",37:"sales",38:"realEstate",39:"drivingTeacher",40:"investmentAdvice",41:"library",49:"other",42:"tailor",43:"restaurant",44:"nailConstruction",45:"dentist",46:"beautysSalon",47:"washer"},Yc={barber:0,cleaningSofas:48,polish:1,beautician:2,manicurePedicure:3,eyelashes:4,eyebrows:5,babysitter:25,braids:6,makeUpArtist:7,tattooArtist:8,hairRemoval:9,masseur:10,cobblers:12,clown:13,socialWorker:14,magician:15,doctor:16,veterinarian:17,communicationTherapist:18,dogGroomer:19,psychologist:21,physiotherapy:11,Tutor:22,weddingDresses:23,danceTeacher:24,reflexologist:26,dietitian:27,carWash:28,photographer:29,swimmingTeacher:30,counselor:31,mentor:32,dj:20,tennisCoach:33,privateChef:34,personalTrainer:35,lawyer:36,sales:37,realEstate:38,drivingTeacher:39,investmentAdvice:40,library:41,other:49,restaurant:43,tailor:42,nailConstruction:44,dentist:45,beautysSalon:46,washer:47},Zf={noPayNoPayment:0,noPayNoPaymentWithReceipts:1,pay100For30WithReceipts:2,pay70For700Actiions:3},jf=15,ep=20,tp={simpletor_golden_business_month_1:1e3,simpletor_advanced_business_month_1:200,simpletor_basic_business_month_1:0,simpletor_landing_business_month_1:0},rp={simpletor_golden_business_month_1:100,simpletor_advanced_business_month_1:20,simpletor_basic_business_month_1:10,simpletor_landing_business_month_1:10};class wn{messagesCounter=0;paymentRequestCounter=0;constructor(e=0,t=0){this.messagesCounter=e,this.paymentRequestCounter=t}static forNewBusiness(){return new wn(ep,jf)}static fromProductId(e){return new wn(tp[e]||0,rp[e]||0)}setBusinessData(e){this.messagesCounter=parseInt(e.child("messagesCounter").val().toString())||0,this.paymentRequestCounter=parseInt(e.child("paymentRequestCounter").val().toString())||0}toJson(){const e={};return e.messagesCounter=this.messagesCounter,e.paymentRequestCounter=this.paymentRequestCounter,e}}class tr{businesseType=$t.Other;currency=no;notifyOnNewCustomer=!0;searchable=!0;billingIssue=new Map;isLandingPageMode=!1;allWorkersIds=new Map;workersIds=new Map;hypPath;expiredDate=new Date;shopPhone="";ownersName="";companyNumber="";ownersPhone="";masofNumber="";previewDoc="";instagramAccount="";revenueCatId="";pendingWorkersProductsId="";adress="";workersProductsId="";pendingProductId="";dynamicLink="";shopName="";productId="";businessId="";createdAt=new Date;blockedUsersTemp=new Map;lastTimeConnected=new Date;businessData=new wn;design=new Xe;constructor({shopName:e="",businessId:t,productId:r="",adress:i="",dynamicLink:s="",revenueCatId:o="",ownersName:c="",instagramAccount:l="",shopPhone:a="",design:h}){this.shopName=e,this.businessId=t,this.productId=r,this.adress=i,this.dynamicLink=s,this.revenueCatId=o,this.ownersName=c,this.instagramAccount=l,this.shopPhone=a,this.design=h}static empty(){return new tr({design:new Xe,businessId:""})}get businessPayLoadData(){return new Cn({businessId:this.businessId,businessName:this.shopName,shopIcon:this.design.shopIconData})}static fromJson(e,t){const r=new tr({businessId:t,design:new Xe});return r.setData(e,t),r}setData(e,t){if(this.businessId=t,e.currency!=null&&(this.currency=zr.fromJson(e.currency)),e.design!=null)this.design=Xe.fromJson(e.design);else{const i=e.theme;this.design.pickedThemeKey=i,Object.entries(e.products).forEach(([s,o])=>{this.design.products.set(s,jt.fromJson(o,s))}),e.changingImages!=null&&(this.design.changingImages=e.changingImages.map(s=>s)),e.updates!=null&&e.updates.forEach((s,o)=>{this.design.updates.set(o.toString(),er.fromJson(s,o.toString()))}),this.design.bottomIcons=e.bottomIcons??!1,this.design.storyTitle=e.storyTitle??"",this.design.changingImagesSwapSeconds=e.changingImagesSwapSeconds??6,this.design.shopIconUrl=e.shopIcon??""}this.previewDoc=e.previewDoc??"",this.workersProductsId=e.workersProductsId??"",this.pendingWorkersProductsId=e.pendingWorkersProductsId??"",this.shopName=e.shopName??"",this.isLandingPageMode=e.isLandingPageMode??!1,this.searchable=e.searchable??!0,e.expiredDate!=null&&(this.expiredDate=new Date(e.expiredDate)),this.notifyOnNewCustomer=e.notifyOnNewCustomer??!0,this.companyNumber=e.companyNumber??"",e.hypPath!=null&&(this.hypPath=Zf[e.hypPath]),this.allWorkersIds=new Map,e.allWorkersIds!=null&&Object.entries(e.allWorkersIds).forEach(([i,s])=>{this.allWorkersIds.set(i,s)});const r=this.businessId.split("--")[0];this.allWorkersIds.hasOwnProperty("+"+r)||this.allWorkersIds.set("+"+r,""),this.workersIds=new Map,e.workersIds!=null&&Object.entries(e.workersIds).forEach(([i,s])=>{this.workersIds.set(i,s)}),this.workersIds.hasOwnProperty(r)||this.workersIds.set(r,""),this.dynamicLink=e.dynamicLink??"",this.masofNumber=e.masofNumber??"",this.ownersName=e.ownersName??"",this.revenueCatId=e.revenueCatId??"",this.productId=e.productId??"",this.pendingProductId=e.pendingProductId??"",this.businesseType=Yc[e.businesseType]??$t.Other,this.instagramAccount=e.instagramAccount??"",this.adress=e.adress??"",this.shopPhone=e.shopPhone??"";try{e.billingIssue!=null&&Object.entries(e.billingIssue).forEach(([i,s])=>{this.billingIssue.set(i,s.toDate())})}catch{}e.createdAt instanceof pt?this.createdAt=e.createdAt.toDate():typeof e.createdAt=="string"&&(this.createdAt=new Date(e.createdAt)||new Date),e.lastTimeConnected!=null&&(this.lastTimeConnected=new Date(e.lastTimeConnected)||new Date)}toJson(){const e={};return e.notifyOnNewCustomer=this.notifyOnNewCustomer,e.currency=this.currency.toJson(),e.searchable=this.searchable,e.workersProductsId=this.workersProductsId,e.pendingWorkersProductsId=this.pendingWorkersProductsId,e.previewDoc=this.previewDoc,e.masofNumber=this.masofNumber,e.revenueCatId=this.revenueCatId,e.pendingProductId=this.pendingProductId,e.productId=this.productId,e.shopName=this.shopName,this.hypPath&&(e.hypPath=this.hypPath),this.billingIssue.size>0&&(e.billingIssue={},this.billingIssue.forEach((t,r)=>{e.billingIssue[r]=pt.fromDate(t)})),this.dynamicLink!==""&&(e.dynamicLink=this.dynamicLink),e.companyNumber=this.companyNumber,e.expiredDate=this.expiredDate,e.businesseType=this.businesseType,e.ownersName=this.ownersName,e.instagramAccount=this.instagramAccount,e.adress=this.adress,e.shopPhone=this.shopPhone,e.workersIds=this.workersIds,e.createdAt=this.createdAt,e.lastTimeConnected=this.lastTimeConnected,this.isLandingPageMode&&(e.isLandingPageMode=this.isLandingPageMode),e.design=this.design.toJson(),e}toString(){return JSON.stringify(this.toJson())}}let Dt=class _r{static instance;constructor(){}static GI(){return _r.instance||(_r.instance=new _r),_r.instance}generalRepo=new ro;business=new tr({businessId:"",design:new Xe});workers={};businessIcon="";async initSettings(e,{fromLoading:t=!1}={}){try{this.workers={},Ke.currentBusinesssId=e;const r=await Promise.all([this._loadSettingsDoc(e)]);return!0}catch{return!1}}async loadBusiness(e,t,{fromLoading:r=!1,fromSearch:i=!1}={}){try{const s=await this.initSettings(e,{fromLoading:r});return!0}catch{return!1}}async _loadSettingsDoc(e){try{const t=await this.generalRepo.getDocRepo({path:nt,docId:e});return t===void 0||!t.exists||t.data()===null?(AppErrorsHelper.GI().error=Errors.notFoundBusiness,!1):(this.business=tr.fromJson(t.data(),e),!0)}catch{return!1}}};var xe=(n=>(n[n.success=0]="success",n[n.unknownError=1]="unknownError",n[n.timeError=2]="timeError",n[n.loading=3]="loading",n[n.maintenanceMode=4]="maintenanceMode",n[n.updateAvailable=5]="updateAvailable",n[n.noInternetConnection=6]="noInternetConnection",n))(xe||{});class bn{static _singleton=new bn;constructor(){}static GI(){return bn._singleton}getLisksChildPath(e){const t=`${nt}/${Ke.currentBusinesssId}/${Xr}`,r=`${e}/${Mo}`;return`${t}/${r}`}getImageStorageName(e,t){const r=e.toUpperCase(),i=t.split(r);return`${r}${i[1].split(".jpg")[0]}`}getLikesChildPath(e,t,r){const i=`${nt}/${t}/${Xr}`,s=`${e}/${Mo}`;return`${i}/${s}/${r}`}getBusinessDataPath(e){return`${nt}/${e}/${Lo}`}getWorkerCountersPath(e,t){return`${nt}/${e}/${Xr}/${t}/${dh}`}getMessageCounterPath(e){return`${nt}/${e}/${Lo}/messagesCounter`}userBookingsPathByBooking(e){return`${Ir}/${e.customerId}/${vr}/${yr}/${Oo}`}userBookingsPathByUser(e){return`${Ir}/${e}/${vr}/${yr}/${Oo}`}workerBookingsPath(e){return`${nt}/${e.buisnessId}/${Xr}/${e.workerId}/${vr}/${yr}/${ch}`}}class np extends ro{constructor(){super()}}var Q=(n=>(n[n.male=0]="male",n[n.female=1]="female",n[n.anonymous=2]="anonymous",n))(Q||{});const Aa={"××ª×” ×‘×˜×•×—":"××ª ×‘×˜×•×—×”","××ª×” ×™×›×•×œ":"××ª ×™×›×•×œ×”","×“×¨×’ ":"×“×¨×’×™ ","××ª×” ":"××ª ","×‘×˜×•×— ":"×‘×˜×•×—×” ","×‘×˜×•×—?":"×‘×˜×•×—×”?",×”×¤×¢×œ:"×”×¤×¢×œ×™",×¦×:"×¦××™"," ×¦×•×¨":" ×¦×¨×™","×‘×—×¨ ":"×‘×—×¨×™ ",×ª×—×•×™×‘:"×ª×—×•×™×‘×™",××©×¨:"××©×¨×™",×œ×§×•×—:"×œ×§×•×—×”","×¡×ž×Ÿ ":"×¡×ž× ×™ ","×”×›× ×¡ ":"×”×›× ×™×¡×™ ",×”×–×ž×Ÿ:"×”×–×ž×™× ×™",× ×•×•×˜:"× ×•×•×˜×™","×”×•×¡×£ ":"×”×•×¡×™×¤×™ ","×”×–×ž×Ÿ ":"×”×–×ž×™× ×™ ",×¨×©×•×:"×¨×©×•×ž×”",×ž×¡×ª×›×Ÿ:"×ž×¡×ª×›× ×ª","×”×–×ž×™× ×™ ×©×”×–× ×ª":"×”×–×ž×Ÿ ×©×”×–× ×ª",×©×ª×¨×¦×”:"×©×ª×¨×¦×™",×©×œ×:"×©×œ×ž×™",×œ×©×œ×ž×™:"×œ×©×œ×","×ª×¨×¦×” ":"×ª×¨×¦×™ ",×¢×“×›×Ÿ:"×¢×“×›× ×™","×©×œ× ×”×›×œ":"×©×œ×ž×™ ×”×›×œ",×”×¤×§×“:"×”×¤×§×“×™",×‘×˜×œ:"×‘×˜×œ×™","×œ×—×¥ ":"×œ×—×¦×™ ",×”×©××¨:"×”×©××™×¨×™","×©×™× ×œ×‘":"×©×™×ž×™ ×œ×‘","×”×–×Ÿ ":"×”×–×™× ×™ ",×‘×•×:"×‘×•××™","×”×§×œ×“ ":"×”×§×œ×“×™ ","×©×‘×”×Ÿ ××ª ×¢×•×‘×“":"×©×‘×”×Ÿ ××ª ×¢×•×‘×“×ª","×›××Ÿ ×ª×•×›×œ ×œ×”×•×¡×™×£":"×›××Ÿ ×ª×•×›×œ×™ ×œ×”×•×¡×™×£","×‘×ž×¡×š ×–×” ×ª×•×›×œ":"×‘×ž×¡×š ×–×” ×ª×•×›×œ×™","×¢×“×™×™×Ÿ ×ž×ª×œ×‘×˜":"×¢×“×™×™×Ÿ ×ž×ª×œ×‘×˜×ª",×•×ª×•×›×œ:"×•×ª×•×›×œ×™",×¡×™×™×:"×¡×™×™×ž×™",×”×ž×©×š:"×”×ž×©×™×›×™","×‘×¨×•×š ×”×‘×":"×‘×¨×•×›×” ×”×‘××”","× ×¡×” ":"× ×¡×™ ",×”×•×¦××™×ª:"×”×•×¦××ª","×ª×”×™×” ":"×ª×”×™×™ ",×”×ª×§×©×¨:"×”×ª×§×©×¨×™",×ª×•×¡×¨:"×ª×•×¡×¨×™","×ª×•×›×œ ":"×ª×•×›×œ×™ ","××ª ×ž×©×ª×ž×©":"××ª ×ž×©×ª×ž×©×ª",×œ×§×•×—×”×•×ª:"×œ×§×•×—×•×ª",×¦×¨×™×ª:"×¦×•×¨×ª","×ž×—×§ ××ª":"×ž×—×§×™ ××ª",×ž××‘×“:"×ž××‘×“×ª",××ž×ª:"××ž×ª×™",×ž×•×ª××ž×ª:"×ž×ª×•××ž×ª",×œ××ž×ª×™:"×œ××ž×ª",×“×œ×’:"×“×œ×’×™",×œ×‘×˜×œ×™:"×œ×‘×˜×œ",×›××©×¨×™:"×›××©×¨",×¡×¨×‘:"×¡×¨×‘×™",×œ×¡×¨×‘×™:"×œ×¡×¨×‘",×œ× ×•×•×˜×™:"×œ× ×•×•×˜",×ª×§×‘×œ:"×ª×§×‘×œ×™",××©×¨×™××™:"××©×¨××™"},Dn={0:"male",1:"female",2:"anonymous"},rr={male:0,female:1,anonymous:2};class Dr{businessName="";iconUrl="";businessId="";type=$t.Other;adress="";ownerName="";shopPhone="";constructor({businessId:e,shopPhone:t,type:r,adress:i,ownerName:s,iconUrl:o,businessName:c}){this.businessId=e,this.shopPhone=t,this.type=r,this.adress=i,this.ownerName=s,this.iconUrl=o,this.businessName=c}static empty(){return new Dr({businessId:"",shopPhone:"",type:$t.Other,adress:"",ownerName:"",iconUrl:"",businessName:""})}static fromJson(e,t){const r=e.businessName||"",i=e.iconUrl||"",s=Yc[e.T]||$t.Other,o=e.ON||"",c=e.SP||"",l=e.A||"";return new Dr({businessId:t,shopPhone:c,type:s,adress:l,ownerName:o,iconUrl:i,businessName:r})}get toBusinessModel(){const e=new tr({businessId:this.businessId,design:new Xe({shopIconUrl:this.iconUrl})});return e.ownersName=this.ownerName,e.shopPhone=this.shopPhone,e.shopName=this.businessName,e.adress=this.adress,e.businesseType=this.type,e}static fromBusinessInfo(e){return new Dr({businessId:e.businessId,shopPhone:e.shopPhone,type:e.type,adress:e.adress,ownerName:e.ownerName,iconUrl:e.iconUrl,businessName:e.businessName})}toJson(){const e={};return e.businessName=this.businessName,e.iconUrl=this.iconUrl,e.ON=this.ownerName,e.SP=this.shopPhone,e.A=this.adress,e.T=Xf[this.type],e}isTheSame(e){return e.iconUrl===this.iconUrl&&e.ownerName===this.ownerName&&e.shopPhone===this.shopPhone&&e.adress===this.adress&&e.type===this.type&&e.businessName===this.businessName}toString(){return JSON.stringify(this.toJson())}}function ip(n,e){return n===null&&e===null?null:n===null?e:e===null?n:e>n?e:n}function sp(n,e=-1){let t="",r="",i="",s="",o="",c="",l=n.days;Math.floor(l/30)>0&&(Math.floor(l/30)===1&&(c=ne("month")),Math.floor(l/30)===2&&(c=ne("twoMonths")),Math.floor(l/30)>2&&(c=`${Math.floor(l/30)} `+ne("months"))),l-=Math.floor(l/30)*30,Math.floor(l/7)>0&&(Math.floor(l/7)===1&&(o=ne("week")),Math.floor(l/7)===2&&(o=ne("twoWeeks")),Math.floor(l/7)>2&&(o=`${Math.floor(l/7)} `+ne("weeks"))),l-=Math.floor(l/7)*7,l===1&&(s=ne("day")),l===2&&(s=ne("twoDays")),l>2&&(s=`${l} `+ne("days"));let a=n.hours-n.days*24;a===1&&(t=ne("hour")),a===2&&(t=ne("twoHours")),a>2&&(t=`${a}`+ne("hoursChar"));let h=n.minutes-n.hours*60;r=h>0?`${h}`+ne("minutesChar"):"";let d=n.seconds-n.minutes*60;d===1&&(i=ne("second",!1)),d>1&&(i=`${d} `+ne("seconds"));let u="";return n.days===365?u=ne("year"):n.days%365===0&&n.days>365?u=(n.days/365).toFixed(0)+" "+ne("years"):o===""&&c!==""&&s===""?u=c:o!==""&&c===""&&s===""?u=o:o!==""&&c!==""&&s===""?u=c+" "+ne("and")+o:o!==""&&c===""&&s!==""?u=o+" "+ne("and")+s:o===""&&c!==""&&s!==""?u=c+" "+ne("and")+s:o!==""&&c!==""&&s!==""?u=c+" ,"+o+" "+ne("and")+s:r===""&&t===""&&s!==""?u=s:r!==""&&t===""&&s===""?u=r:r===""&&t!==""&&s===""?u=t:r!==""&&t!==""&&s===""?u=t+" "+ne("and")+r:r!==""&&t===""&&s!==""?u=s+" "+ne("and")+r:r===""&&t!==""&&s!==""?u=s+" "+ne("and")+t:r!==""&&t!==""&&s!==""?u=s+" ,"+t+" "+ne("and")+r:i!==""&&(u=i),u.length===0?"":e===-1||e>u.length?u:u.slice(0,e)+".."+u.slice(e)}function op(n){const e=it.GI().user.gender;return e===Q.male||e===Q.anonymous||Object.keys(Aa).forEach(r=>{n=n.replaceAll(r,Aa[r])}),n}function ne(n,e=!0){const t=ApplicationLocalizations.translate(n);return LanguageHelper().currentLaguageCode==="he"&&e?op(t):t}function An(n){return new Intl.DateTimeFormat("en-US",{month:"2-digit",year:"numeric"}).format(n)}function ap(n){return new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}).format(n)}function cp(n){return new Date(`1970-01-01T${n}`)}function lp(n){return new Date(n)}function hp(n){return new Date(n)}function ka(n,e){return n===null&&e===null?null:n===null?e:e===null||n<e?n:e}function up(n){return new Date(n.getFullYear(),n.getMonth(),1)}class ut{token;joinDate;id;activeNotifications;constructor({token:e="",joinDate:t,id:r="",activeNotifications:i=!0}){this.token=e,this.joinDate=t,this.id=r,this.activeNotifications=i}static fromJson(e,t){const r=new ut({joinDate:new Date(0)});return r.id=t,r.activeNotifications=e.activeNotifications??!0,r.token=e.token??"",r}toJson(){const e={};return this.activeNotifications||(e.activeNotifications=this.activeNotifications),e.token=this.token,e.joinDate=ap(this.joinDate),e}static fromDevice(e){return new ut({joinDate:e.joinDate,id:e.id,activeNotifications:e.activeNotifications,token:e.token})}}var Or=(n=>(n[n.SMS=0]="SMS",n[n.SMSOrPush=1]="SMSOrPush",n[n.WhatsAppOrPush=2]="WhatsAppOrPush",n[n.WhatsApp=3]="WhatsApp",n[n.SMSOnly=4]="SMSOnly",n[n.WhatAppOnly=5]="WhatAppOnly",n[n.Push=6]="Push",n[n.PushOrWhatsApp=7]="PushOrWhatsApp",n[n.PushOrSMS=8]="PushOrSMS",n[n.OnlyPush=9]="OnlyPush",n))(Or||{});const dp={0:"SMS",4:"SMSOnly",5:"WhatAppOnly",1:"SMSOrPush",2:"WhatsAppOrPush",3:"WhatsApp",9:"OnlyPush",7:"PushOrWhatsApp",8:"PushOrSMS",6:"Push"},fp={SMS:0,SMSOrPush:1,WhatAppOnly:5,SMSOnly:4,WhatsAppOrPush:2,WhatsApp:3,OnlyPush:9,PushOrWhatsApp:7,PushOrSMS:8,Push:6},pp=/^[a-zA-Z0-9-_.~%]{1,900}$/,Ia="~.9.~",mp="..",pi="_";class kn{id="";businessId="";workerName="";date="";workerId="";timeStr="";treatmentId="";treatmentName="";constructor({workerName:e="",date:t="",workerId:r="",timeStr:i="",treatmentId:s="",treatmentName:o="",businessId:c=""}){this.workerName=e,this.date=t,this.workerId=r,this.timeStr=i,this.treatmentId=s,this.treatmentName=o,this.businessId=c}fixEmptyAttributes(){this.workerName=this.workerName===""?"E":this.workerName,this.date=this.date===""?"E":this.date,this.businessId=this.businessId===""?"E":this.businessId,this.workerId=this.workerId===""?"E":this.workerId}static fromJson(e,t){const r=new kn({});return r.id=t,r.workerName=e.workerName??"",r.date=e.date??"",r.timeStr=e.timeStr??"",r.treatmentId=e.treatmentId??"",r.treatmentName=e.treatmentName??"",r.businessId=e.businessId??"",r.workerId=e.workerId??"",r}get isMulti(){return this.timeStr!==""}static fromTopicStr(e){const t=new kn({}),r=e.split(mp),i=r[0].split(pi),s=r[1].split(pi);return t.businessId=i[0],t.workerId=i[1].replaceAll(Ia,"+"),t.date=i[2],t.workerName=s[1],t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}toTopicStr(){this.fixEmptyAttributes();const e=this.workerId.replaceAll("+",Ia);return[this.businessId,e,this.date,this.timeStr,this.treatmentId].join(pi).split("").filter(i=>pp.test(i)).join("")}get dateTime(){const e=lp(this.date),t=this.timeStr===""?new Date(0):cp(this.timeStr);return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes())}toJson(){const e={};return e.businessId=this.businessId,this.workerName!==""&&(e.workerName=this.workerName),this.workerId!==""&&(e.workerId=this.workerId),this.date!==""&&(e.date=this.date),this.timeStr!==""&&(e.timeStr=this.timeStr),this.treatmentName!==""&&(e.treatmentName=this.treatmentName),this.treatmentId!==""&&(e.treatmentId=this.treatmentId),e}toString(){return JSON.stringify(this.toJson())}}const xp={1:"PL",2:"MasterCard",3:"Visa",4:"Maestro",5:"Isracard"},gp={PL:"1",MasterCard:"2",Visa:"3",Maestro:"4",Isracard:"5"},_p={1:"Isracard",2:"Visa Cal",3:"Diners",4:"Amex",6:"Leumi Card"},vp={Isracard:"1","Visa Cal":"2",Diners:"3",Amex:"4","Leumi Card":"6"};class Ar{brand="";token="";validityMonth="";validityYear="";name="";bankName="";l4Digits="";userId="";attemptsLeft=rn;cardId="";businessId="";constructor({brand:e="",token:t="",validityMonth:r="",validityYear:i="",name:s="",userId:o="",bankName:c="",l4Digits:l="",cardId:a="",businessId:h="",attemptsLeft:d=rn}={}){this.brand=e,this.token=t,this.validityMonth=r,this.validityYear=i,this.name=s,this.userId=o,this.bankName=c,this.l4Digits=l,this.cardId=a,this.businessId=h,this.attemptsLeft=d}static fromJson(e,t,r){const i=new Ar;return i.cardId=t,i.brand=xp[e.brand]||"Card",i.token=e.token||"",i.userId=e.userId||"",i.attemptsLeft=e.attemptsLeft||rn,i.validityMonth=e.validityMonth||"",i.validityYear=e.validityYear||"",i.businessId=r,i.name=e.name||"",i.bankName=e.bankName||"",i.bankName=_p[e.bankName]||"Bank",i.l4Digits=e.l4Digits||"",i}fromPaymentCard(e){this.brand=e.brand,this.token=e.token,this.userId=e.userId,this.businessId=e.businessId,this.cardId=e.cardId,this.attemptsLeft=e.attemptsLeft,this.validityMonth=e.validityMonth,this.validityYear=e.validityYear,this.name=e.name,this.bankName=e.bankName,this.l4Digits=e.l4Digits}toJson(){const e={};return e.brand=gp[this.brand]||"",e.token=this.token,e.userId=this.userId,e.attemptsLeft=this.attemptsLeft,e.validityMonth=this.validityMonth,e.validityYear=this.validityYear,e.name=this.name,e.bankName=this.bankName,e.bankName=vp[this.bankName]||"",e.l4Digits=this.l4Digits,e}decryptCard(e){return new Ar({cardId:this.cardId,brand:this.brand,token:decryptText({encryption:this.token,password:e}),validityMonth:decryptText({encryption:this.validityMonth,password:e}),validityYear:decryptText({encryption:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}encryptCard(e){return new Ar({cardId:this.cardId,brand:this.brand,token:encryptText({text:this.token,password:e}),validityMonth:encryptText({text:this.validityMonth,password:e}),validityYear:encryptText({text:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}isTheSameAs(e){return this.bankName===e.bankName&&this.brand===e.brand&&this.name===e.name&&this.l4Digits===e.l4Digits&&this.userId===e.userId&&this.validityMonth===e.validityMonth&&this.validityYear===e.validityYear}toString(){return JSON.stringify(this,null,"  ")}}var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yp(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ep(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Qc={exports:{}};function Cp(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mi={exports:{}};const wp={},bp=Object.freeze(Object.defineProperty({__proto__:null,default:wp},Symbol.toStringTag,{value:"Module"})),Dp=Ep(bp);var Sa;function z(){return Sa||(Sa=1,function(n,e){(function(t,r){n.exports=r()})(W,function(){var t=t||function(r,i){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof W<"u"&&W.crypto&&(s=W.crypto),!s&&typeof Cp=="function")try{s=Dp}catch{}var o=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},c=Object.create||function(){function m(){}return function(x){var v;return m.prototype=x,v=new m,m.prototype=null,v}}(),l={},a=l.lib={},h=a.Base=function(){return{extend:function(m){var x=c(this);return m&&x.mixIn(m),(!x.hasOwnProperty("init")||this.init===x.init)&&(x.init=function(){x.$super.init.apply(this,arguments)}),x.init.prototype=x,x.$super=this,x},create:function(){var m=this.extend();return m.init.apply(m,arguments),m},init:function(){},mixIn:function(m){for(var x in m)m.hasOwnProperty(x)&&(this[x]=m[x]);m.hasOwnProperty("toString")&&(this.toString=m.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=a.WordArray=h.extend({init:function(m,x){m=this.words=m||[],x!=i?this.sigBytes=x:this.sigBytes=m.length*4},toString:function(m){return(m||f).stringify(this)},concat:function(m){var x=this.words,v=m.words,w=this.sigBytes,C=m.sigBytes;if(this.clamp(),w%4)for(var b=0;b<C;b++){var A=v[b>>>2]>>>24-b%4*8&255;x[w+b>>>2]|=A<<24-(w+b)%4*8}else for(var N=0;N<C;N+=4)x[w+N>>>2]=v[N>>>2];return this.sigBytes+=C,this},clamp:function(){var m=this.words,x=this.sigBytes;m[x>>>2]&=4294967295<<32-x%4*8,m.length=r.ceil(x/4)},clone:function(){var m=h.clone.call(this);return m.words=this.words.slice(0),m},random:function(m){for(var x=[],v=0;v<m;v+=4)x.push(o());return new d.init(x,m)}}),u=l.enc={},f=u.Hex={stringify:function(m){for(var x=m.words,v=m.sigBytes,w=[],C=0;C<v;C++){var b=x[C>>>2]>>>24-C%4*8&255;w.push((b>>>4).toString(16)),w.push((b&15).toString(16))}return w.join("")},parse:function(m){for(var x=m.length,v=[],w=0;w<x;w+=2)v[w>>>3]|=parseInt(m.substr(w,2),16)<<24-w%8*4;return new d.init(v,x/2)}},p=u.Latin1={stringify:function(m){for(var x=m.words,v=m.sigBytes,w=[],C=0;C<v;C++){var b=x[C>>>2]>>>24-C%4*8&255;w.push(String.fromCharCode(b))}return w.join("")},parse:function(m){for(var x=m.length,v=[],w=0;w<x;w++)v[w>>>2]|=(m.charCodeAt(w)&255)<<24-w%4*8;return new d.init(v,x)}},_=u.Utf8={stringify:function(m){try{return decodeURIComponent(escape(p.stringify(m)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(m){return p.parse(unescape(encodeURIComponent(m)))}},g=a.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(m){typeof m=="string"&&(m=_.parse(m)),this._data.concat(m),this._nDataBytes+=m.sigBytes},_process:function(m){var x,v=this._data,w=v.words,C=v.sigBytes,b=this.blockSize,A=b*4,N=C/A;m?N=r.ceil(N):N=r.max((N|0)-this._minBufferSize,0);var y=N*b,D=r.min(y*4,C);if(y){for(var I=0;I<y;I+=b)this._doProcessBlock(w,I);x=w.splice(0,y),v.sigBytes-=D}return new d.init(x,D)},clone:function(){var m=h.clone.call(this);return m._data=this._data.clone(),m},_minBufferSize:0});a.Hasher=g.extend({cfg:h.extend(),init:function(m){this.cfg=this.cfg.extend(m),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(m){return this._append(m),this._process(),this},finalize:function(m){m&&this._append(m);var x=this._doFinalize();return x},blockSize:16,_createHelper:function(m){return function(x,v){return new m.init(v).finalize(x)}},_createHmacHelper:function(m){return function(x,v){return new E.HMAC.init(m,v).finalize(x)}}});var E=l.algo={};return l}(Math);return t})}(mi)),mi.exports}var xi={exports:{}},Fa;function Zn(){return Fa||(Fa=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(r){var i=t,s=i.lib,o=s.Base,c=s.WordArray,l=i.x64={};l.Word=o.extend({init:function(a,h){this.high=a,this.low=h}}),l.WordArray=o.extend({init:function(a,h){a=this.words=a||[],h!=r?this.sigBytes=h:this.sigBytes=a.length*8},toX32:function(){for(var a=this.words,h=a.length,d=[],u=0;u<h;u++){var f=a[u];d.push(f.high),d.push(f.low)}return c.create(d,this.sigBytes)},clone:function(){for(var a=o.clone.call(this),h=a.words=this.words.slice(0),d=h.length,u=0;u<d;u++)h[u]=h[u].clone();return a}})}(),t})}(xi)),xi.exports}var gi={exports:{}},Ba;function Ap(){return Ba||(Ba=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,i=r.lib,s=i.WordArray,o=s.init,c=s.init=function(l){if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),l instanceof Uint8Array){for(var a=l.byteLength,h=[],d=0;d<a;d++)h[d>>>2]|=l[d]<<24-d%4*8;o.call(this,h,a)}else o.apply(this,arguments)};c.prototype=s}}(),t.lib.WordArray})}(gi)),gi.exports}var _i={exports:{}},Ta;function kp(){return Ta||(Ta=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(){var r=t,i=r.lib,s=i.WordArray,o=r.enc;o.Utf16=o.Utf16BE={stringify:function(l){for(var a=l.words,h=l.sigBytes,d=[],u=0;u<h;u+=2){var f=a[u>>>2]>>>16-u%4*8&65535;d.push(String.fromCharCode(f))}return d.join("")},parse:function(l){for(var a=l.length,h=[],d=0;d<a;d++)h[d>>>1]|=l.charCodeAt(d)<<16-d%2*16;return s.create(h,a*2)}},o.Utf16LE={stringify:function(l){for(var a=l.words,h=l.sigBytes,d=[],u=0;u<h;u+=2){var f=c(a[u>>>2]>>>16-u%4*8&65535);d.push(String.fromCharCode(f))}return d.join("")},parse:function(l){for(var a=l.length,h=[],d=0;d<a;d++)h[d>>>1]|=c(l.charCodeAt(d)<<16-d%2*16);return s.create(h,a*2)}};function c(l){return l<<8&4278255360|l>>>8&16711935}}(),t.enc.Utf16})}(_i)),_i.exports}var vi={exports:{}},Pa;function Bt(){return Pa||(Pa=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(){var r=t,i=r.lib,s=i.WordArray,o=r.enc;o.Base64={stringify:function(l){var a=l.words,h=l.sigBytes,d=this._map;l.clamp();for(var u=[],f=0;f<h;f+=3)for(var p=a[f>>>2]>>>24-f%4*8&255,_=a[f+1>>>2]>>>24-(f+1)%4*8&255,g=a[f+2>>>2]>>>24-(f+2)%4*8&255,E=p<<16|_<<8|g,m=0;m<4&&f+m*.75<h;m++)u.push(d.charAt(E>>>6*(3-m)&63));var x=d.charAt(64);if(x)for(;u.length%4;)u.push(x);return u.join("")},parse:function(l){var a=l.length,h=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var u=0;u<h.length;u++)d[h.charCodeAt(u)]=u}var f=h.charAt(64);if(f){var p=l.indexOf(f);p!==-1&&(a=p)}return c(l,a,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function c(l,a,h){for(var d=[],u=0,f=0;f<a;f++)if(f%4){var p=h[l.charCodeAt(f-1)]<<f%4*2,_=h[l.charCodeAt(f)]>>>6-f%4*2,g=p|_;d[u>>>2]|=g<<24-u%4*8,u++}return s.create(d,u)}}(),t.enc.Base64})}(vi)),vi.exports}var yi={exports:{}},Na;function Ip(){return Na||(Na=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(){var r=t,i=r.lib,s=i.WordArray,o=r.enc;o.Base64url={stringify:function(l,a){a===void 0&&(a=!0);var h=l.words,d=l.sigBytes,u=a?this._safe_map:this._map;l.clamp();for(var f=[],p=0;p<d;p+=3)for(var _=h[p>>>2]>>>24-p%4*8&255,g=h[p+1>>>2]>>>24-(p+1)%4*8&255,E=h[p+2>>>2]>>>24-(p+2)%4*8&255,m=_<<16|g<<8|E,x=0;x<4&&p+x*.75<d;x++)f.push(u.charAt(m>>>6*(3-x)&63));var v=u.charAt(64);if(v)for(;f.length%4;)f.push(v);return f.join("")},parse:function(l,a){a===void 0&&(a=!0);var h=l.length,d=a?this._safe_map:this._map,u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var f=0;f<d.length;f++)u[d.charCodeAt(f)]=f}var p=d.charAt(64);if(p){var _=l.indexOf(p);_!==-1&&(h=_)}return c(l,h,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function c(l,a,h){for(var d=[],u=0,f=0;f<a;f++)if(f%4){var p=h[l.charCodeAt(f-1)]<<f%4*2,_=h[l.charCodeAt(f)]>>>6-f%4*2,g=p|_;d[u>>>2]|=g<<24-u%4*8,u++}return s.create(d,u)}}(),t.enc.Base64url})}(yi)),yi.exports}var Ei={exports:{}},Ra;function Tt(){return Ra||(Ra=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(r){var i=t,s=i.lib,o=s.WordArray,c=s.Hasher,l=i.algo,a=[];(function(){for(var _=0;_<64;_++)a[_]=r.abs(r.sin(_+1))*4294967296|0})();var h=l.MD5=c.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(_,g){for(var E=0;E<16;E++){var m=g+E,x=_[m];_[m]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360}var v=this._hash.words,w=_[g+0],C=_[g+1],b=_[g+2],A=_[g+3],N=_[g+4],y=_[g+5],D=_[g+6],I=_[g+7],S=_[g+8],R=_[g+9],O=_[g+10],U=_[g+11],re=_[g+12],J=_[g+13],Z=_[g+14],Y=_[g+15],k=v[0],B=v[1],T=v[2],F=v[3];k=d(k,B,T,F,w,7,a[0]),F=d(F,k,B,T,C,12,a[1]),T=d(T,F,k,B,b,17,a[2]),B=d(B,T,F,k,A,22,a[3]),k=d(k,B,T,F,N,7,a[4]),F=d(F,k,B,T,y,12,a[5]),T=d(T,F,k,B,D,17,a[6]),B=d(B,T,F,k,I,22,a[7]),k=d(k,B,T,F,S,7,a[8]),F=d(F,k,B,T,R,12,a[9]),T=d(T,F,k,B,O,17,a[10]),B=d(B,T,F,k,U,22,a[11]),k=d(k,B,T,F,re,7,a[12]),F=d(F,k,B,T,J,12,a[13]),T=d(T,F,k,B,Z,17,a[14]),B=d(B,T,F,k,Y,22,a[15]),k=u(k,B,T,F,C,5,a[16]),F=u(F,k,B,T,D,9,a[17]),T=u(T,F,k,B,U,14,a[18]),B=u(B,T,F,k,w,20,a[19]),k=u(k,B,T,F,y,5,a[20]),F=u(F,k,B,T,O,9,a[21]),T=u(T,F,k,B,Y,14,a[22]),B=u(B,T,F,k,N,20,a[23]),k=u(k,B,T,F,R,5,a[24]),F=u(F,k,B,T,Z,9,a[25]),T=u(T,F,k,B,A,14,a[26]),B=u(B,T,F,k,S,20,a[27]),k=u(k,B,T,F,J,5,a[28]),F=u(F,k,B,T,b,9,a[29]),T=u(T,F,k,B,I,14,a[30]),B=u(B,T,F,k,re,20,a[31]),k=f(k,B,T,F,y,4,a[32]),F=f(F,k,B,T,S,11,a[33]),T=f(T,F,k,B,U,16,a[34]),B=f(B,T,F,k,Z,23,a[35]),k=f(k,B,T,F,C,4,a[36]),F=f(F,k,B,T,N,11,a[37]),T=f(T,F,k,B,I,16,a[38]),B=f(B,T,F,k,O,23,a[39]),k=f(k,B,T,F,J,4,a[40]),F=f(F,k,B,T,w,11,a[41]),T=f(T,F,k,B,A,16,a[42]),B=f(B,T,F,k,D,23,a[43]),k=f(k,B,T,F,R,4,a[44]),F=f(F,k,B,T,re,11,a[45]),T=f(T,F,k,B,Y,16,a[46]),B=f(B,T,F,k,b,23,a[47]),k=p(k,B,T,F,w,6,a[48]),F=p(F,k,B,T,I,10,a[49]),T=p(T,F,k,B,Z,15,a[50]),B=p(B,T,F,k,y,21,a[51]),k=p(k,B,T,F,re,6,a[52]),F=p(F,k,B,T,A,10,a[53]),T=p(T,F,k,B,O,15,a[54]),B=p(B,T,F,k,C,21,a[55]),k=p(k,B,T,F,S,6,a[56]),F=p(F,k,B,T,Y,10,a[57]),T=p(T,F,k,B,D,15,a[58]),B=p(B,T,F,k,J,21,a[59]),k=p(k,B,T,F,N,6,a[60]),F=p(F,k,B,T,U,10,a[61]),T=p(T,F,k,B,b,15,a[62]),B=p(B,T,F,k,R,21,a[63]),v[0]=v[0]+k|0,v[1]=v[1]+B|0,v[2]=v[2]+T|0,v[3]=v[3]+F|0},_doFinalize:function(){var _=this._data,g=_.words,E=this._nDataBytes*8,m=_.sigBytes*8;g[m>>>5]|=128<<24-m%32;var x=r.floor(E/4294967296),v=E;g[(m+64>>>9<<4)+15]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,g[(m+64>>>9<<4)+14]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,_.sigBytes=(g.length+1)*4,this._process();for(var w=this._hash,C=w.words,b=0;b<4;b++){var A=C[b];C[b]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}return w},clone:function(){var _=c.clone.call(this);return _._hash=this._hash.clone(),_}});function d(_,g,E,m,x,v,w){var C=_+(g&E|~g&m)+x+w;return(C<<v|C>>>32-v)+g}function u(_,g,E,m,x,v,w){var C=_+(g&m|E&~m)+x+w;return(C<<v|C>>>32-v)+g}function f(_,g,E,m,x,v,w){var C=_+(g^E^m)+x+w;return(C<<v|C>>>32-v)+g}function p(_,g,E,m,x,v,w){var C=_+(E^(g|~m))+x+w;return(C<<v|C>>>32-v)+g}i.MD5=c._createHelper(h),i.HmacMD5=c._createHmacHelper(h)}(Math),t.MD5})}(Ei)),Ei.exports}var Ci={exports:{}},Oa;function Xc(){return Oa||(Oa=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(){var r=t,i=r.lib,s=i.WordArray,o=i.Hasher,c=r.algo,l=[],a=c.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(h,d){for(var u=this._hash.words,f=u[0],p=u[1],_=u[2],g=u[3],E=u[4],m=0;m<80;m++){if(m<16)l[m]=h[d+m]|0;else{var x=l[m-3]^l[m-8]^l[m-14]^l[m-16];l[m]=x<<1|x>>>31}var v=(f<<5|f>>>27)+E+l[m];m<20?v+=(p&_|~p&g)+1518500249:m<40?v+=(p^_^g)+1859775393:m<60?v+=(p&_|p&g|_&g)-1894007588:v+=(p^_^g)-899497514,E=g,g=_,_=p<<30|p>>>2,p=f,f=v}u[0]=u[0]+f|0,u[1]=u[1]+p|0,u[2]=u[2]+_|0,u[3]=u[3]+g|0,u[4]=u[4]+E|0},_doFinalize:function(){var h=this._data,d=h.words,u=this._nDataBytes*8,f=h.sigBytes*8;return d[f>>>5]|=128<<24-f%32,d[(f+64>>>9<<4)+14]=Math.floor(u/4294967296),d[(f+64>>>9<<4)+15]=u,h.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var h=o.clone.call(this);return h._hash=this._hash.clone(),h}});r.SHA1=o._createHelper(a),r.HmacSHA1=o._createHmacHelper(a)}(),t.SHA1})}(Ci)),Ci.exports}var wi={exports:{}},Ma;function io(){return Ma||(Ma=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){return function(r){var i=t,s=i.lib,o=s.WordArray,c=s.Hasher,l=i.algo,a=[],h=[];(function(){function f(E){for(var m=r.sqrt(E),x=2;x<=m;x++)if(!(E%x))return!1;return!0}function p(E){return(E-(E|0))*4294967296|0}for(var _=2,g=0;g<64;)f(_)&&(g<8&&(a[g]=p(r.pow(_,1/2))),h[g]=p(r.pow(_,1/3)),g++),_++})();var d=[],u=l.SHA256=c.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(f,p){for(var _=this._hash.words,g=_[0],E=_[1],m=_[2],x=_[3],v=_[4],w=_[5],C=_[6],b=_[7],A=0;A<64;A++){if(A<16)d[A]=f[p+A]|0;else{var N=d[A-15],y=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,D=d[A-2],I=(D<<15|D>>>17)^(D<<13|D>>>19)^D>>>10;d[A]=y+d[A-7]+I+d[A-16]}var S=v&w^~v&C,R=g&E^g&m^E&m,O=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),U=(v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25),re=b+U+S+h[A]+d[A],J=O+R;b=C,C=w,w=v,v=x+re|0,x=m,m=E,E=g,g=re+J|0}_[0]=_[0]+g|0,_[1]=_[1]+E|0,_[2]=_[2]+m|0,_[3]=_[3]+x|0,_[4]=_[4]+v|0,_[5]=_[5]+w|0,_[6]=_[6]+C|0,_[7]=_[7]+b|0},_doFinalize:function(){var f=this._data,p=f.words,_=this._nDataBytes*8,g=f.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=r.floor(_/4294967296),p[(g+64>>>9<<4)+15]=_,f.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var f=c.clone.call(this);return f._hash=this._hash.clone(),f}});i.SHA256=c._createHelper(u),i.HmacSHA256=c._createHmacHelper(u)}(Math),t.SHA256})}(wi)),wi.exports}var bi={exports:{}},La;function Sp(){return La||(La=1,function(n,e){(function(t,r,i){n.exports=r(z(),io())})(W,function(t){return function(){var r=t,i=r.lib,s=i.WordArray,o=r.algo,c=o.SHA256,l=o.SHA224=c.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var a=c._doFinalize.call(this);return a.sigBytes-=4,a}});r.SHA224=c._createHelper(l),r.HmacSHA224=c._createHmacHelper(l)}(),t.SHA224})}(bi)),bi.exports}var Di={exports:{}},Ua;function Zc(){return Ua||(Ua=1,function(n,e){(function(t,r,i){n.exports=r(z(),Zn())})(W,function(t){return function(){var r=t,i=r.lib,s=i.Hasher,o=r.x64,c=o.Word,l=o.WordArray,a=r.algo;function h(){return c.create.apply(c,arguments)}var d=[h(1116352408,3609767458),h(1899447441,602891725),h(3049323471,3964484399),h(3921009573,2173295548),h(961987163,4081628472),h(1508970993,3053834265),h(2453635748,2937671579),h(2870763221,3664609560),h(3624381080,2734883394),h(310598401,1164996542),h(607225278,1323610764),h(1426881987,3590304994),h(1925078388,4068182383),h(2162078206,991336113),h(2614888103,633803317),h(3248222580,3479774868),h(3835390401,2666613458),h(4022224774,944711139),h(264347078,2341262773),h(604807628,2007800933),h(770255983,1495990901),h(1249150122,1856431235),h(1555081692,3175218132),h(1996064986,2198950837),h(2554220882,3999719339),h(2821834349,766784016),h(2952996808,2566594879),h(3210313671,3203337956),h(3336571891,1034457026),h(3584528711,2466948901),h(113926993,3758326383),h(338241895,168717936),h(666307205,1188179964),h(773529912,1546045734),h(1294757372,1522805485),h(1396182291,2643833823),h(1695183700,2343527390),h(1986661051,1014477480),h(2177026350,1206759142),h(2456956037,344077627),h(2730485921,1290863460),h(2820302411,3158454273),h(3259730800,3505952657),h(3345764771,106217008),h(3516065817,3606008344),h(3600352804,1432725776),h(4094571909,1467031594),h(275423344,851169720),h(430227734,3100823752),h(506948616,1363258195),h(659060556,3750685593),h(883997877,3785050280),h(958139571,3318307427),h(1322822218,3812723403),h(1537002063,2003034995),h(1747873779,3602036899),h(1955562222,1575990012),h(2024104815,1125592928),h(2227730452,2716904306),h(2361852424,442776044),h(2428436474,593698344),h(2756734187,3733110249),h(3204031479,2999351573),h(3329325298,3815920427),h(3391569614,3928383900),h(3515267271,566280711),h(3940187606,3454069534),h(4118630271,4000239992),h(116418474,1914138554),h(174292421,2731055270),h(289380356,3203993006),h(460393269,320620315),h(685471733,587496836),h(852142971,1086792851),h(1017036298,365543100),h(1126000580,2618297676),h(1288033470,3409855158),h(1501505948,4234509866),h(1607167915,987167468),h(1816402316,1246189591)],u=[];(function(){for(var p=0;p<80;p++)u[p]=h()})();var f=a.SHA512=s.extend({_doReset:function(){this._hash=new l.init([new c.init(1779033703,4089235720),new c.init(3144134277,2227873595),new c.init(1013904242,4271175723),new c.init(2773480762,1595750129),new c.init(1359893119,2917565137),new c.init(2600822924,725511199),new c.init(528734635,4215389547),new c.init(1541459225,327033209)])},_doProcessBlock:function(p,_){for(var g=this._hash.words,E=g[0],m=g[1],x=g[2],v=g[3],w=g[4],C=g[5],b=g[6],A=g[7],N=E.high,y=E.low,D=m.high,I=m.low,S=x.high,R=x.low,O=v.high,U=v.low,re=w.high,J=w.low,Z=C.high,Y=C.low,k=b.high,B=b.low,T=A.high,F=A.low,ie=N,j=y,ve=D,H=I,ar=S,Pt=R,ei=O,cr=U,Pe=re,Ce=J,qr=Z,lr=Y,Kr=k,hr=B,ti=T,ur=F,Ne=0;Ne<80;Ne++){var Ae,et,Jr=u[Ne];if(Ne<16)et=Jr.high=p[_+Ne*2]|0,Ae=Jr.low=p[_+Ne*2+1]|0;else{var uo=u[Ne-15],Nt=uo.high,dr=uo.low,tl=(Nt>>>1|dr<<31)^(Nt>>>8|dr<<24)^Nt>>>7,fo=(dr>>>1|Nt<<31)^(dr>>>8|Nt<<24)^(dr>>>7|Nt<<25),po=u[Ne-2],Rt=po.high,fr=po.low,rl=(Rt>>>19|fr<<13)^(Rt<<3|fr>>>29)^Rt>>>6,mo=(fr>>>19|Rt<<13)^(fr<<3|Rt>>>29)^(fr>>>6|Rt<<26),xo=u[Ne-7],nl=xo.high,il=xo.low,go=u[Ne-16],sl=go.high,_o=go.low;Ae=fo+il,et=tl+nl+(Ae>>>0<fo>>>0?1:0),Ae=Ae+mo,et=et+rl+(Ae>>>0<mo>>>0?1:0),Ae=Ae+_o,et=et+sl+(Ae>>>0<_o>>>0?1:0),Jr.high=et,Jr.low=Ae}var ol=Pe&qr^~Pe&Kr,vo=Ce&lr^~Ce&hr,al=ie&ve^ie&ar^ve&ar,cl=j&H^j&Pt^H&Pt,ll=(ie>>>28|j<<4)^(ie<<30|j>>>2)^(ie<<25|j>>>7),yo=(j>>>28|ie<<4)^(j<<30|ie>>>2)^(j<<25|ie>>>7),hl=(Pe>>>14|Ce<<18)^(Pe>>>18|Ce<<14)^(Pe<<23|Ce>>>9),ul=(Ce>>>14|Pe<<18)^(Ce>>>18|Pe<<14)^(Ce<<23|Pe>>>9),Eo=d[Ne],dl=Eo.high,Co=Eo.low,we=ur+ul,tt=ti+hl+(we>>>0<ur>>>0?1:0),we=we+vo,tt=tt+ol+(we>>>0<vo>>>0?1:0),we=we+Co,tt=tt+dl+(we>>>0<Co>>>0?1:0),we=we+Ae,tt=tt+et+(we>>>0<Ae>>>0?1:0),wo=yo+cl,fl=ll+al+(wo>>>0<yo>>>0?1:0);ti=Kr,ur=hr,Kr=qr,hr=lr,qr=Pe,lr=Ce,Ce=cr+we|0,Pe=ei+tt+(Ce>>>0<cr>>>0?1:0)|0,ei=ar,cr=Pt,ar=ve,Pt=H,ve=ie,H=j,j=we+wo|0,ie=tt+fl+(j>>>0<we>>>0?1:0)|0}y=E.low=y+j,E.high=N+ie+(y>>>0<j>>>0?1:0),I=m.low=I+H,m.high=D+ve+(I>>>0<H>>>0?1:0),R=x.low=R+Pt,x.high=S+ar+(R>>>0<Pt>>>0?1:0),U=v.low=U+cr,v.high=O+ei+(U>>>0<cr>>>0?1:0),J=w.low=J+Ce,w.high=re+Pe+(J>>>0<Ce>>>0?1:0),Y=C.low=Y+lr,C.high=Z+qr+(Y>>>0<lr>>>0?1:0),B=b.low=B+hr,b.high=k+Kr+(B>>>0<hr>>>0?1:0),F=A.low=F+ur,A.high=T+ti+(F>>>0<ur>>>0?1:0)},_doFinalize:function(){var p=this._data,_=p.words,g=this._nDataBytes*8,E=p.sigBytes*8;_[E>>>5]|=128<<24-E%32,_[(E+128>>>10<<5)+30]=Math.floor(g/4294967296),_[(E+128>>>10<<5)+31]=g,p.sigBytes=_.length*4,this._process();var m=this._hash.toX32();return m},clone:function(){var p=s.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=s._createHelper(f),r.HmacSHA512=s._createHmacHelper(f)}(),t.SHA512})}(Di)),Di.exports}var Ai={exports:{}},Wa;function Fp(){return Wa||(Wa=1,function(n,e){(function(t,r,i){n.exports=r(z(),Zn(),Zc())})(W,function(t){return function(){var r=t,i=r.x64,s=i.Word,o=i.WordArray,c=r.algo,l=c.SHA512,a=c.SHA384=l.extend({_doReset:function(){this._hash=new o.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var h=l._doFinalize.call(this);return h.sigBytes-=16,h}});r.SHA384=l._createHelper(a),r.HmacSHA384=l._createHmacHelper(a)}(),t.SHA384})}(Ai)),Ai.exports}var ki={exports:{}},Ha;function Bp(){return Ha||(Ha=1,function(n,e){(function(t,r,i){n.exports=r(z(),Zn())})(W,function(t){return function(r){var i=t,s=i.lib,o=s.WordArray,c=s.Hasher,l=i.x64,a=l.Word,h=i.algo,d=[],u=[],f=[];(function(){for(var g=1,E=0,m=0;m<24;m++){d[g+5*E]=(m+1)*(m+2)/2%64;var x=E%5,v=(2*g+3*E)%5;g=x,E=v}for(var g=0;g<5;g++)for(var E=0;E<5;E++)u[g+5*E]=E+(2*g+3*E)%5*5;for(var w=1,C=0;C<24;C++){for(var b=0,A=0,N=0;N<7;N++){if(w&1){var y=(1<<N)-1;y<32?A^=1<<y:b^=1<<y-32}w&128?w=w<<1^113:w<<=1}f[C]=a.create(b,A)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=a.create()})();var _=h.SHA3=c.extend({cfg:c.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],E=0;E<25;E++)g[E]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,E){for(var m=this._state,x=this.blockSize/2,v=0;v<x;v++){var w=g[E+2*v],C=g[E+2*v+1];w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360;var b=m[v];b.high^=C,b.low^=w}for(var A=0;A<24;A++){for(var N=0;N<5;N++){for(var y=0,D=0,I=0;I<5;I++){var b=m[N+5*I];y^=b.high,D^=b.low}var S=p[N];S.high=y,S.low=D}for(var N=0;N<5;N++)for(var R=p[(N+4)%5],O=p[(N+1)%5],U=O.high,re=O.low,y=R.high^(U<<1|re>>>31),D=R.low^(re<<1|U>>>31),I=0;I<5;I++){var b=m[N+5*I];b.high^=y,b.low^=D}for(var J=1;J<25;J++){var y,D,b=m[J],Z=b.high,Y=b.low,k=d[J];k<32?(y=Z<<k|Y>>>32-k,D=Y<<k|Z>>>32-k):(y=Y<<k-32|Z>>>64-k,D=Z<<k-32|Y>>>64-k);var B=p[u[J]];B.high=y,B.low=D}var T=p[0],F=m[0];T.high=F.high,T.low=F.low;for(var N=0;N<5;N++)for(var I=0;I<5;I++){var J=N+5*I,b=m[J],ie=p[J],j=p[(N+1)%5+5*I],ve=p[(N+2)%5+5*I];b.high=ie.high^~j.high&ve.high,b.low=ie.low^~j.low&ve.low}var b=m[0],H=f[A];b.high^=H.high,b.low^=H.low}},_doFinalize:function(){var g=this._data,E=g.words;this._nDataBytes*8;var m=g.sigBytes*8,x=this.blockSize*32;E[m>>>5]|=1<<24-m%32,E[(r.ceil((m+1)/x)*x>>>5)-1]|=128,g.sigBytes=E.length*4,this._process();for(var v=this._state,w=this.cfg.outputLength/8,C=w/8,b=[],A=0;A<C;A++){var N=v[A],y=N.high,D=N.low;y=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,D=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,b.push(D),b.push(y)}return new o.init(b,w)},clone:function(){for(var g=c.clone.call(this),E=g._state=this._state.slice(0),m=0;m<25;m++)E[m]=E[m].clone();return g}});i.SHA3=c._createHelper(_),i.HmacSHA3=c._createHmacHelper(_)}(Math),t.SHA3})}(ki)),ki.exports}var Ii={exports:{}},Va;function Tp(){return Va||(Va=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){/** @preserve
			(c) 2012 by CÃ©dric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(r){var i=t,s=i.lib,o=s.WordArray,c=s.Hasher,l=i.algo,a=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),h=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),f=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),_=l.RIPEMD160=c.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,b){for(var A=0;A<16;A++){var N=b+A,y=C[N];C[N]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var D=this._hash.words,I=f.words,S=p.words,R=a.words,O=h.words,U=d.words,re=u.words,J,Z,Y,k,B,T,F,ie,j,ve;T=J=D[0],F=Z=D[1],ie=Y=D[2],j=k=D[3],ve=B=D[4];for(var H,A=0;A<80;A+=1)H=J+C[b+R[A]]|0,A<16?H+=g(Z,Y,k)+I[0]:A<32?H+=E(Z,Y,k)+I[1]:A<48?H+=m(Z,Y,k)+I[2]:A<64?H+=x(Z,Y,k)+I[3]:H+=v(Z,Y,k)+I[4],H=H|0,H=w(H,U[A]),H=H+B|0,J=B,B=k,k=w(Y,10),Y=Z,Z=H,H=T+C[b+O[A]]|0,A<16?H+=v(F,ie,j)+S[0]:A<32?H+=x(F,ie,j)+S[1]:A<48?H+=m(F,ie,j)+S[2]:A<64?H+=E(F,ie,j)+S[3]:H+=g(F,ie,j)+S[4],H=H|0,H=w(H,re[A]),H=H+ve|0,T=ve,ve=j,j=w(ie,10),ie=F,F=H;H=D[1]+Y+j|0,D[1]=D[2]+k+ve|0,D[2]=D[3]+B+T|0,D[3]=D[4]+J+F|0,D[4]=D[0]+Z+ie|0,D[0]=H},_doFinalize:function(){var C=this._data,b=C.words,A=this._nDataBytes*8,N=C.sigBytes*8;b[N>>>5]|=128<<24-N%32,b[(N+64>>>9<<4)+14]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,C.sigBytes=(b.length+1)*4,this._process();for(var y=this._hash,D=y.words,I=0;I<5;I++){var S=D[I];D[I]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}return y},clone:function(){var C=c.clone.call(this);return C._hash=this._hash.clone(),C}});function g(C,b,A){return C^b^A}function E(C,b,A){return C&b|~C&A}function m(C,b,A){return(C|~b)^A}function x(C,b,A){return C&A|b&~A}function v(C,b,A){return C^(b|~A)}function w(C,b){return C<<b|C>>>32-b}i.RIPEMD160=c._createHelper(_),i.HmacRIPEMD160=c._createHmacHelper(_)}(),t.RIPEMD160})}(Ii)),Ii.exports}var Si={exports:{}},$a;function so(){return $a||($a=1,function(n,e){(function(t,r){n.exports=r(z())})(W,function(t){(function(){var r=t,i=r.lib,s=i.Base,o=r.enc,c=o.Utf8,l=r.algo;l.HMAC=s.extend({init:function(a,h){a=this._hasher=new a.init,typeof h=="string"&&(h=c.parse(h));var d=a.blockSize,u=d*4;h.sigBytes>u&&(h=a.finalize(h)),h.clamp();for(var f=this._oKey=h.clone(),p=this._iKey=h.clone(),_=f.words,g=p.words,E=0;E<d;E++)_[E]^=1549556828,g[E]^=909522486;f.sigBytes=p.sigBytes=u,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var h=this._hasher,d=h.finalize(a);h.reset();var u=h.finalize(this._oKey.clone().concat(d));return u}})})()})}(Si)),Si.exports}var Fi={exports:{}},Ga;function Pp(){return Ga||(Ga=1,function(n,e){(function(t,r,i){n.exports=r(z(),io(),so())})(W,function(t){return function(){var r=t,i=r.lib,s=i.Base,o=i.WordArray,c=r.algo,l=c.SHA256,a=c.HMAC,h=c.PBKDF2=s.extend({cfg:s.extend({keySize:128/32,hasher:l,iterations:25e4}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,u){for(var f=this.cfg,p=a.create(f.hasher,d),_=o.create(),g=o.create([1]),E=_.words,m=g.words,x=f.keySize,v=f.iterations;E.length<x;){var w=p.update(u).finalize(g);p.reset();for(var C=w.words,b=C.length,A=w,N=1;N<v;N++){A=p.finalize(A),p.reset();for(var y=A.words,D=0;D<b;D++)C[D]^=y[D]}_.concat(w),m[0]++}return _.sigBytes=x*4,_}});r.PBKDF2=function(d,u,f){return h.create(f).compute(d,u)}}(),t.PBKDF2})}(Fi)),Fi.exports}var Bi={exports:{}},za;function _t(){return za||(za=1,function(n,e){(function(t,r,i){n.exports=r(z(),Xc(),so())})(W,function(t){return function(){var r=t,i=r.lib,s=i.Base,o=i.WordArray,c=r.algo,l=c.MD5,a=c.EvpKDF=s.extend({cfg:s.extend({keySize:128/32,hasher:l,iterations:1}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,d){for(var u,f=this.cfg,p=f.hasher.create(),_=o.create(),g=_.words,E=f.keySize,m=f.iterations;g.length<E;){u&&p.update(u),u=p.update(h).finalize(d),p.reset();for(var x=1;x<m;x++)u=p.finalize(u),p.reset();_.concat(u)}return _.sigBytes=E*4,_}});r.EvpKDF=function(h,d,u){return a.create(u).compute(h,d)}}(),t.EvpKDF})}(Bi)),Bi.exports}var Ti={exports:{}},qa;function fe(){return qa||(qa=1,function(n,e){(function(t,r,i){n.exports=r(z(),_t())})(W,function(t){t.lib.Cipher||function(r){var i=t,s=i.lib,o=s.Base,c=s.WordArray,l=s.BufferedBlockAlgorithm,a=i.enc;a.Utf8;var h=a.Base64,d=i.algo,u=d.EvpKDF,f=s.Cipher=l.extend({cfg:o.extend(),createEncryptor:function(y,D){return this.create(this._ENC_XFORM_MODE,y,D)},createDecryptor:function(y,D){return this.create(this._DEC_XFORM_MODE,y,D)},init:function(y,D,I){this.cfg=this.cfg.extend(I),this._xformMode=y,this._key=D,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(y){return this._append(y),this._process()},finalize:function(y){y&&this._append(y);var D=this._doFinalize();return D},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function y(D){return typeof D=="string"?N:C}return function(D){return{encrypt:function(I,S,R){return y(S).encrypt(D,I,S,R)},decrypt:function(I,S,R){return y(S).decrypt(D,I,S,R)}}}}()});s.StreamCipher=f.extend({_doFinalize:function(){var y=this._process(!0);return y},blockSize:1});var p=i.mode={},_=s.BlockCipherMode=o.extend({createEncryptor:function(y,D){return this.Encryptor.create(y,D)},createDecryptor:function(y,D){return this.Decryptor.create(y,D)},init:function(y,D){this._cipher=y,this._iv=D}}),g=p.CBC=function(){var y=_.extend();y.Encryptor=y.extend({processBlock:function(I,S){var R=this._cipher,O=R.blockSize;D.call(this,I,S,O),R.encryptBlock(I,S),this._prevBlock=I.slice(S,S+O)}}),y.Decryptor=y.extend({processBlock:function(I,S){var R=this._cipher,O=R.blockSize,U=I.slice(S,S+O);R.decryptBlock(I,S),D.call(this,I,S,O),this._prevBlock=U}});function D(I,S,R){var O,U=this._iv;U?(O=U,this._iv=r):O=this._prevBlock;for(var re=0;re<R;re++)I[S+re]^=O[re]}return y}(),E=i.pad={},m=E.Pkcs7={pad:function(y,D){for(var I=D*4,S=I-y.sigBytes%I,R=S<<24|S<<16|S<<8|S,O=[],U=0;U<S;U+=4)O.push(R);var re=c.create(O,S);y.concat(re)},unpad:function(y){var D=y.words[y.sigBytes-1>>>2]&255;y.sigBytes-=D}};s.BlockCipher=f.extend({cfg:f.cfg.extend({mode:g,padding:m}),reset:function(){var y;f.reset.call(this);var D=this.cfg,I=D.iv,S=D.mode;this._xformMode==this._ENC_XFORM_MODE?y=S.createEncryptor:(y=S.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==y?this._mode.init(this,I&&I.words):(this._mode=y.call(S,this,I&&I.words),this._mode.__creator=y)},_doProcessBlock:function(y,D){this._mode.processBlock(y,D)},_doFinalize:function(){var y,D=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(D.pad(this._data,this.blockSize),y=this._process(!0)):(y=this._process(!0),D.unpad(y)),y},blockSize:128/32});var x=s.CipherParams=o.extend({init:function(y){this.mixIn(y)},toString:function(y){return(y||this.formatter).stringify(this)}}),v=i.format={},w=v.OpenSSL={stringify:function(y){var D,I=y.ciphertext,S=y.salt;return S?D=c.create([1398893684,1701076831]).concat(S).concat(I):D=I,D.toString(h)},parse:function(y){var D,I=h.parse(y),S=I.words;return S[0]==1398893684&&S[1]==1701076831&&(D=c.create(S.slice(2,4)),S.splice(0,4),I.sigBytes-=16),x.create({ciphertext:I,salt:D})}},C=s.SerializableCipher=o.extend({cfg:o.extend({format:w}),encrypt:function(y,D,I,S){S=this.cfg.extend(S);var R=y.createEncryptor(I,S),O=R.finalize(D),U=R.cfg;return x.create({ciphertext:O,key:I,iv:U.iv,algorithm:y,mode:U.mode,padding:U.padding,blockSize:y.blockSize,formatter:S.format})},decrypt:function(y,D,I,S){S=this.cfg.extend(S),D=this._parse(D,S.format);var R=y.createDecryptor(I,S).finalize(D.ciphertext);return R},_parse:function(y,D){return typeof y=="string"?D.parse(y,this):y}}),b=i.kdf={},A=b.OpenSSL={execute:function(y,D,I,S,R){if(S||(S=c.random(64/8)),R)var O=u.create({keySize:D+I,hasher:R}).compute(y,S);else var O=u.create({keySize:D+I}).compute(y,S);var U=c.create(O.words.slice(D),I*4);return O.sigBytes=D*4,x.create({key:O,iv:U,salt:S})}},N=s.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:A}),encrypt:function(y,D,I,S){S=this.cfg.extend(S);var R=S.kdf.execute(I,y.keySize,y.ivSize,S.salt,S.hasher);S.iv=R.iv;var O=C.encrypt.call(this,y,D,R.key,S);return O.mixIn(R),O},decrypt:function(y,D,I,S){S=this.cfg.extend(S),D=this._parse(D,S.format);var R=S.kdf.execute(I,y.keySize,y.ivSize,D.salt,S.hasher);S.iv=R.iv;var O=C.decrypt.call(this,y,D,R.key,S);return O}})}()})}(Ti)),Ti.exports}var Pi={exports:{}},Ka;function Np(){return Ka||(Ka=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(s,o){var c=this._cipher,l=c.blockSize;i.call(this,s,o,l,c),this._prevBlock=s.slice(o,o+l)}}),r.Decryptor=r.extend({processBlock:function(s,o){var c=this._cipher,l=c.blockSize,a=s.slice(o,o+l);i.call(this,s,o,l,c),this._prevBlock=a}});function i(s,o,c,l){var a,h=this._iv;h?(a=h.slice(0),this._iv=void 0):a=this._prevBlock,l.encryptBlock(a,0);for(var d=0;d<c;d++)s[o+d]^=a[d]}return r}(),t.mode.CFB})}(Pi)),Pi.exports}var Ni={exports:{}},Ja;function Rp(){return Ja||(Ja=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(s,o){var c=this._cipher,l=c.blockSize,a=this._iv,h=this._counter;a&&(h=this._counter=a.slice(0),this._iv=void 0);var d=h.slice(0);c.encryptBlock(d,0),h[l-1]=h[l-1]+1|0;for(var u=0;u<l;u++)s[o+u]^=d[u]}});return r.Decryptor=i,r}(),t.mode.CTR})}(Ni)),Ni.exports}var Ri={exports:{}},Ya;function Op(){return Ya||(Ya=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function i(c){if((c>>24&255)===255){var l=c>>16&255,a=c>>8&255,h=c&255;l===255?(l=0,a===255?(a=0,h===255?h=0:++h):++a):++l,c=0,c+=l<<16,c+=a<<8,c+=h}else c+=1<<24;return c}function s(c){return(c[0]=i(c[0]))===0&&(c[1]=i(c[1])),c}var o=r.Encryptor=r.extend({processBlock:function(c,l){var a=this._cipher,h=a.blockSize,d=this._iv,u=this._counter;d&&(u=this._counter=d.slice(0),this._iv=void 0),s(u);var f=u.slice(0);a.encryptBlock(f,0);for(var p=0;p<h;p++)c[l+p]^=f[p]}});return r.Decryptor=o,r}(),t.mode.CTRGladman})}(Ri)),Ri.exports}var Oi={exports:{}},Qa;function Mp(){return Qa||(Qa=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(s,o){var c=this._cipher,l=c.blockSize,a=this._iv,h=this._keystream;a&&(h=this._keystream=a.slice(0),this._iv=void 0),c.encryptBlock(h,0);for(var d=0;d<l;d++)s[o+d]^=h[d]}});return r.Decryptor=i,r}(),t.mode.OFB})}(Oi)),Oi.exports}var Mi={exports:{}},Xa;function Lp(){return Xa||(Xa=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(i,s){this._cipher.encryptBlock(i,s)}}),r.Decryptor=r.extend({processBlock:function(i,s){this._cipher.decryptBlock(i,s)}}),r}(),t.mode.ECB})}(Mi)),Mi.exports}var Li={exports:{}},Za;function Up(){return Za||(Za=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.pad.AnsiX923={pad:function(r,i){var s=r.sigBytes,o=i*4,c=o-s%o,l=s+c-1;r.clamp(),r.words[l>>>2]|=c<<24-l%4*8,r.sigBytes+=c},unpad:function(r){var i=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=i}},t.pad.Ansix923})}(Li)),Li.exports}var Ui={exports:{}},ja;function Wp(){return ja||(ja=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.pad.Iso10126={pad:function(r,i){var s=i*4,o=s-r.sigBytes%s;r.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(r){var i=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=i}},t.pad.Iso10126})}(Ui)),Ui.exports}var Wi={exports:{}},e0;function Hp(){return e0||(e0=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.pad.Iso97971={pad:function(r,i){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,i)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(Wi)),Wi.exports}var Hi={exports:{}},t0;function Vp(){return t0||(t0=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.pad.ZeroPadding={pad:function(r,i){var s=i*4;r.clamp(),r.sigBytes+=s-(r.sigBytes%s||s)},unpad:function(r){for(var i=r.words,s=r.sigBytes-1,s=r.sigBytes-1;s>=0;s--)if(i[s>>>2]>>>24-s%4*8&255){r.sigBytes=s+1;break}}},t.pad.ZeroPadding})}(Hi)),Hi.exports}var Vi={exports:{}},r0;function $p(){return r0||(r0=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(Vi)),Vi.exports}var $i={exports:{}},n0;function Gp(){return n0||(n0=1,function(n,e){(function(t,r,i){n.exports=r(z(),fe())})(W,function(t){return function(r){var i=t,s=i.lib,o=s.CipherParams,c=i.enc,l=c.Hex,a=i.format;a.Hex={stringify:function(h){return h.ciphertext.toString(l)},parse:function(h){var d=l.parse(h);return o.create({ciphertext:d})}}}(),t.format.Hex})}($i)),$i.exports}var Gi={exports:{}},i0;function zp(){return i0||(i0=1,function(n,e){(function(t,r,i){n.exports=r(z(),Bt(),Tt(),_t(),fe())})(W,function(t){return function(){var r=t,i=r.lib,s=i.BlockCipher,o=r.algo,c=[],l=[],a=[],h=[],d=[],u=[],f=[],p=[],_=[],g=[];(function(){for(var x=[],v=0;v<256;v++)v<128?x[v]=v<<1:x[v]=v<<1^283;for(var w=0,C=0,v=0;v<256;v++){var b=C^C<<1^C<<2^C<<3^C<<4;b=b>>>8^b&255^99,c[w]=b,l[b]=w;var A=x[w],N=x[A],y=x[N],D=x[b]*257^b*16843008;a[w]=D<<24|D>>>8,h[w]=D<<16|D>>>16,d[w]=D<<8|D>>>24,u[w]=D;var D=y*16843009^N*65537^A*257^w*16843008;f[b]=D<<24|D>>>8,p[b]=D<<16|D>>>16,_[b]=D<<8|D>>>24,g[b]=D,w?(w=A^x[x[x[y^A]]],C^=x[x[C]]):w=C=1}})();var E=[0,1,2,4,8,16,32,64,128,27,54],m=o.AES=s.extend({_doReset:function(){var x;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var v=this._keyPriorReset=this._key,w=v.words,C=v.sigBytes/4,b=this._nRounds=C+6,A=(b+1)*4,N=this._keySchedule=[],y=0;y<A;y++)y<C?N[y]=w[y]:(x=N[y-1],y%C?C>6&&y%C==4&&(x=c[x>>>24]<<24|c[x>>>16&255]<<16|c[x>>>8&255]<<8|c[x&255]):(x=x<<8|x>>>24,x=c[x>>>24]<<24|c[x>>>16&255]<<16|c[x>>>8&255]<<8|c[x&255],x^=E[y/C|0]<<24),N[y]=N[y-C]^x);for(var D=this._invKeySchedule=[],I=0;I<A;I++){var y=A-I;if(I%4)var x=N[y];else var x=N[y-4];I<4||y<=4?D[I]=x:D[I]=f[c[x>>>24]]^p[c[x>>>16&255]]^_[c[x>>>8&255]]^g[c[x&255]]}}},encryptBlock:function(x,v){this._doCryptBlock(x,v,this._keySchedule,a,h,d,u,c)},decryptBlock:function(x,v){var w=x[v+1];x[v+1]=x[v+3],x[v+3]=w,this._doCryptBlock(x,v,this._invKeySchedule,f,p,_,g,l);var w=x[v+1];x[v+1]=x[v+3],x[v+3]=w},_doCryptBlock:function(x,v,w,C,b,A,N,y){for(var D=this._nRounds,I=x[v]^w[0],S=x[v+1]^w[1],R=x[v+2]^w[2],O=x[v+3]^w[3],U=4,re=1;re<D;re++){var J=C[I>>>24]^b[S>>>16&255]^A[R>>>8&255]^N[O&255]^w[U++],Z=C[S>>>24]^b[R>>>16&255]^A[O>>>8&255]^N[I&255]^w[U++],Y=C[R>>>24]^b[O>>>16&255]^A[I>>>8&255]^N[S&255]^w[U++],k=C[O>>>24]^b[I>>>16&255]^A[S>>>8&255]^N[R&255]^w[U++];I=J,S=Z,R=Y,O=k}var J=(y[I>>>24]<<24|y[S>>>16&255]<<16|y[R>>>8&255]<<8|y[O&255])^w[U++],Z=(y[S>>>24]<<24|y[R>>>16&255]<<16|y[O>>>8&255]<<8|y[I&255])^w[U++],Y=(y[R>>>24]<<24|y[O>>>16&255]<<16|y[I>>>8&255]<<8|y[S&255])^w[U++],k=(y[O>>>24]<<24|y[I>>>16&255]<<16|y[S>>>8&255]<<8|y[R&255])^w[U++];x[v]=J,x[v+1]=Z,x[v+2]=Y,x[v+3]=k},keySize:256/32});r.AES=s._createHelper(m)}(),t.AES})}(Gi)),Gi.exports}var zi={exports:{}},s0;function qp(){return s0||(s0=1,function(n,e){(function(t,r,i){n.exports=r(z(),Bt(),Tt(),_t(),fe())})(W,function(t){return function(){var r=t,i=r.lib,s=i.WordArray,o=i.BlockCipher,c=r.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],h=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],f=c.DES=o.extend({_doReset:function(){for(var E=this._key,m=E.words,x=[],v=0;v<56;v++){var w=l[v]-1;x[v]=m[w>>>5]>>>31-w%32&1}for(var C=this._subKeys=[],b=0;b<16;b++){for(var A=C[b]=[],N=h[b],v=0;v<24;v++)A[v/6|0]|=x[(a[v]-1+N)%28]<<31-v%6,A[4+(v/6|0)]|=x[28+(a[v+24]-1+N)%28]<<31-v%6;A[0]=A[0]<<1|A[0]>>>31;for(var v=1;v<7;v++)A[v]=A[v]>>>(v-1)*4+3;A[7]=A[7]<<5|A[7]>>>27}for(var y=this._invSubKeys=[],v=0;v<16;v++)y[v]=C[15-v]},encryptBlock:function(E,m){this._doCryptBlock(E,m,this._subKeys)},decryptBlock:function(E,m){this._doCryptBlock(E,m,this._invSubKeys)},_doCryptBlock:function(E,m,x){this._lBlock=E[m],this._rBlock=E[m+1],p.call(this,4,252645135),p.call(this,16,65535),_.call(this,2,858993459),_.call(this,8,16711935),p.call(this,1,1431655765);for(var v=0;v<16;v++){for(var w=x[v],C=this._lBlock,b=this._rBlock,A=0,N=0;N<8;N++)A|=d[N][((b^w[N])&u[N])>>>0];this._lBlock=b,this._rBlock=C^A}var y=this._lBlock;this._lBlock=this._rBlock,this._rBlock=y,p.call(this,1,1431655765),_.call(this,8,16711935),_.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),E[m]=this._lBlock,E[m+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(E,m){var x=(this._lBlock>>>E^this._rBlock)&m;this._rBlock^=x,this._lBlock^=x<<E}function _(E,m){var x=(this._rBlock>>>E^this._lBlock)&m;this._lBlock^=x,this._rBlock^=x<<E}r.DES=o._createHelper(f);var g=c.TripleDES=o.extend({_doReset:function(){var E=this._key,m=E.words;if(m.length!==2&&m.length!==4&&m.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var x=m.slice(0,2),v=m.length<4?m.slice(0,2):m.slice(2,4),w=m.length<6?m.slice(0,2):m.slice(4,6);this._des1=f.createEncryptor(s.create(x)),this._des2=f.createEncryptor(s.create(v)),this._des3=f.createEncryptor(s.create(w))},encryptBlock:function(E,m){this._des1.encryptBlock(E,m),this._des2.decryptBlock(E,m),this._des3.encryptBlock(E,m)},decryptBlock:function(E,m){this._des3.decryptBlock(E,m),this._des2.encryptBlock(E,m),this._des1.decryptBlock(E,m)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=o._createHelper(g)}(),t.TripleDES})}(zi)),zi.exports}var qi={exports:{}},o0;function Kp(){return o0||(o0=1,function(n,e){(function(t,r,i){n.exports=r(z(),Bt(),Tt(),_t(),fe())})(W,function(t){return function(){var r=t,i=r.lib,s=i.StreamCipher,o=r.algo,c=o.RC4=s.extend({_doReset:function(){for(var h=this._key,d=h.words,u=h.sigBytes,f=this._S=[],p=0;p<256;p++)f[p]=p;for(var p=0,_=0;p<256;p++){var g=p%u,E=d[g>>>2]>>>24-g%4*8&255;_=(_+f[p]+E)%256;var m=f[p];f[p]=f[_],f[_]=m}this._i=this._j=0},_doProcessBlock:function(h,d){h[d]^=l.call(this)},keySize:256/32,ivSize:0});function l(){for(var h=this._S,d=this._i,u=this._j,f=0,p=0;p<4;p++){d=(d+1)%256,u=(u+h[d])%256;var _=h[d];h[d]=h[u],h[u]=_,f|=h[(h[d]+h[u])%256]<<24-p*8}return this._i=d,this._j=u,f}r.RC4=s._createHelper(c);var a=o.RC4Drop=c.extend({cfg:c.cfg.extend({drop:192}),_doReset:function(){c._doReset.call(this);for(var h=this.cfg.drop;h>0;h--)l.call(this)}});r.RC4Drop=s._createHelper(a)}(),t.RC4})}(qi)),qi.exports}var Ki={exports:{}},a0;function Jp(){return a0||(a0=1,function(n,e){(function(t,r,i){n.exports=r(z(),Bt(),Tt(),_t(),fe())})(W,function(t){return function(){var r=t,i=r.lib,s=i.StreamCipher,o=r.algo,c=[],l=[],a=[],h=o.Rabbit=s.extend({_doReset:function(){for(var u=this._key.words,f=this.cfg.iv,p=0;p<4;p++)u[p]=(u[p]<<8|u[p]>>>24)&16711935|(u[p]<<24|u[p]>>>8)&4278255360;var _=this._X=[u[0],u[3]<<16|u[2]>>>16,u[1],u[0]<<16|u[3]>>>16,u[2],u[1]<<16|u[0]>>>16,u[3],u[2]<<16|u[1]>>>16],g=this._C=[u[2]<<16|u[2]>>>16,u[0]&4294901760|u[1]&65535,u[3]<<16|u[3]>>>16,u[1]&4294901760|u[2]&65535,u[0]<<16|u[0]>>>16,u[2]&4294901760|u[3]&65535,u[1]<<16|u[1]>>>16,u[3]&4294901760|u[0]&65535];this._b=0;for(var p=0;p<4;p++)d.call(this);for(var p=0;p<8;p++)g[p]^=_[p+4&7];if(f){var E=f.words,m=E[0],x=E[1],v=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,w=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,C=v>>>16|w&4294901760,b=w<<16|v&65535;g[0]^=v,g[1]^=C,g[2]^=w,g[3]^=b,g[4]^=v,g[5]^=C,g[6]^=w,g[7]^=b;for(var p=0;p<4;p++)d.call(this)}},_doProcessBlock:function(u,f){var p=this._X;d.call(this),c[0]=p[0]^p[5]>>>16^p[3]<<16,c[1]=p[2]^p[7]>>>16^p[5]<<16,c[2]=p[4]^p[1]>>>16^p[7]<<16,c[3]=p[6]^p[3]>>>16^p[1]<<16;for(var _=0;_<4;_++)c[_]=(c[_]<<8|c[_]>>>24)&16711935|(c[_]<<24|c[_]>>>8)&4278255360,u[f+_]^=c[_]},blockSize:128/32,ivSize:64/32});function d(){for(var u=this._X,f=this._C,p=0;p<8;p++)l[p]=f[p];f[0]=f[0]+1295307597+this._b|0,f[1]=f[1]+3545052371+(f[0]>>>0<l[0]>>>0?1:0)|0,f[2]=f[2]+886263092+(f[1]>>>0<l[1]>>>0?1:0)|0,f[3]=f[3]+1295307597+(f[2]>>>0<l[2]>>>0?1:0)|0,f[4]=f[4]+3545052371+(f[3]>>>0<l[3]>>>0?1:0)|0,f[5]=f[5]+886263092+(f[4]>>>0<l[4]>>>0?1:0)|0,f[6]=f[6]+1295307597+(f[5]>>>0<l[5]>>>0?1:0)|0,f[7]=f[7]+3545052371+(f[6]>>>0<l[6]>>>0?1:0)|0,this._b=f[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var _=u[p]+f[p],g=_&65535,E=_>>>16,m=((g*g>>>17)+g*E>>>15)+E*E,x=((_&4294901760)*_|0)+((_&65535)*_|0);a[p]=m^x}u[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,u[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,u[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,u[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,u[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,u[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,u[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,u[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}r.Rabbit=s._createHelper(h)}(),t.Rabbit})}(Ki)),Ki.exports}var Ji={exports:{}},c0;function Yp(){return c0||(c0=1,function(n,e){(function(t,r,i){n.exports=r(z(),Bt(),Tt(),_t(),fe())})(W,function(t){return function(){var r=t,i=r.lib,s=i.StreamCipher,o=r.algo,c=[],l=[],a=[],h=o.RabbitLegacy=s.extend({_doReset:function(){var u=this._key.words,f=this.cfg.iv,p=this._X=[u[0],u[3]<<16|u[2]>>>16,u[1],u[0]<<16|u[3]>>>16,u[2],u[1]<<16|u[0]>>>16,u[3],u[2]<<16|u[1]>>>16],_=this._C=[u[2]<<16|u[2]>>>16,u[0]&4294901760|u[1]&65535,u[3]<<16|u[3]>>>16,u[1]&4294901760|u[2]&65535,u[0]<<16|u[0]>>>16,u[2]&4294901760|u[3]&65535,u[1]<<16|u[1]>>>16,u[3]&4294901760|u[0]&65535];this._b=0;for(var g=0;g<4;g++)d.call(this);for(var g=0;g<8;g++)_[g]^=p[g+4&7];if(f){var E=f.words,m=E[0],x=E[1],v=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,w=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,C=v>>>16|w&4294901760,b=w<<16|v&65535;_[0]^=v,_[1]^=C,_[2]^=w,_[3]^=b,_[4]^=v,_[5]^=C,_[6]^=w,_[7]^=b;for(var g=0;g<4;g++)d.call(this)}},_doProcessBlock:function(u,f){var p=this._X;d.call(this),c[0]=p[0]^p[5]>>>16^p[3]<<16,c[1]=p[2]^p[7]>>>16^p[5]<<16,c[2]=p[4]^p[1]>>>16^p[7]<<16,c[3]=p[6]^p[3]>>>16^p[1]<<16;for(var _=0;_<4;_++)c[_]=(c[_]<<8|c[_]>>>24)&16711935|(c[_]<<24|c[_]>>>8)&4278255360,u[f+_]^=c[_]},blockSize:128/32,ivSize:64/32});function d(){for(var u=this._X,f=this._C,p=0;p<8;p++)l[p]=f[p];f[0]=f[0]+1295307597+this._b|0,f[1]=f[1]+3545052371+(f[0]>>>0<l[0]>>>0?1:0)|0,f[2]=f[2]+886263092+(f[1]>>>0<l[1]>>>0?1:0)|0,f[3]=f[3]+1295307597+(f[2]>>>0<l[2]>>>0?1:0)|0,f[4]=f[4]+3545052371+(f[3]>>>0<l[3]>>>0?1:0)|0,f[5]=f[5]+886263092+(f[4]>>>0<l[4]>>>0?1:0)|0,f[6]=f[6]+1295307597+(f[5]>>>0<l[5]>>>0?1:0)|0,f[7]=f[7]+3545052371+(f[6]>>>0<l[6]>>>0?1:0)|0,this._b=f[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var _=u[p]+f[p],g=_&65535,E=_>>>16,m=((g*g>>>17)+g*E>>>15)+E*E,x=((_&4294901760)*_|0)+((_&65535)*_|0);a[p]=m^x}u[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,u[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,u[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,u[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,u[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,u[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,u[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,u[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}r.RabbitLegacy=s._createHelper(h)}(),t.RabbitLegacy})}(Ji)),Ji.exports}var Yi={exports:{}},l0;function Qp(){return l0||(l0=1,function(n,e){(function(t,r,i){n.exports=r(z(),Bt(),Tt(),_t(),fe())})(W,function(t){return function(){var r=t,i=r.lib,s=i.BlockCipher,o=r.algo;const c=16,l=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],a=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var h={pbox:[],sbox:[]};function d(g,E){let m=E>>24&255,x=E>>16&255,v=E>>8&255,w=E&255,C=g.sbox[0][m]+g.sbox[1][x];return C=C^g.sbox[2][v],C=C+g.sbox[3][w],C}function u(g,E,m){let x=E,v=m,w;for(let C=0;C<c;++C)x=x^g.pbox[C],v=d(g,x)^v,w=x,x=v,v=w;return w=x,x=v,v=w,v=v^g.pbox[c],x=x^g.pbox[c+1],{left:x,right:v}}function f(g,E,m){let x=E,v=m,w;for(let C=c+1;C>1;--C)x=x^g.pbox[C],v=d(g,x)^v,w=x,x=v,v=w;return w=x,x=v,v=w,v=v^g.pbox[1],x=x^g.pbox[0],{left:x,right:v}}function p(g,E,m){for(let b=0;b<4;b++){g.sbox[b]=[];for(let A=0;A<256;A++)g.sbox[b][A]=a[b][A]}let x=0;for(let b=0;b<c+2;b++)g.pbox[b]=l[b]^E[x],x++,x>=m&&(x=0);let v=0,w=0,C=0;for(let b=0;b<c+2;b+=2)C=u(g,v,w),v=C.left,w=C.right,g.pbox[b]=v,g.pbox[b+1]=w;for(let b=0;b<4;b++)for(let A=0;A<256;A+=2)C=u(g,v,w),v=C.left,w=C.right,g.sbox[b][A]=v,g.sbox[b][A+1]=w;return!0}var _=o.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,E=g.words,m=g.sigBytes/4;p(h,E,m)}},encryptBlock:function(g,E){var m=u(h,g[E],g[E+1]);g[E]=m.left,g[E+1]=m.right},decryptBlock:function(g,E){var m=f(h,g[E],g[E+1]);g[E]=m.left,g[E+1]=m.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=s._createHelper(_)}(),t.Blowfish})}(Yi)),Yi.exports}(function(n,e){(function(t,r,i){n.exports=r(z(),Zn(),Ap(),kp(),Bt(),Ip(),Tt(),Xc(),io(),Sp(),Zc(),Fp(),Bp(),Tp(),so(),Pp(),_t(),fe(),Np(),Rp(),Op(),Mp(),Lp(),Up(),Wp(),Hp(),Vp(),$p(),Gp(),zp(),qp(),Kp(),Jp(),Yp(),Qp())})(W,function(t){return t})})(Qc);var Xp=Qc.exports;const Zp=yp(Xp),{AES:jp,enc:In,SHA256:jc}=Zp,em="16charactersiv!";function tm(n,e){const t=rm(e),r=In.Utf8.parse(em);return jp.encrypt(n,t,{iv:r}).toString()}function rm(n){let e="htr;lmn;rkmnkryemnkrmnbavsdbshtg6437";return e=jc(n+e).toString(In.Hex).substring(0,32),In.Utf8.parse(e)}function nm({id:n}){if(n.length<7)return"";const e=n.substring(3,6),t=jc(n+e).toString(In.Hex);return t.substring(0,Math.min(10,t.length)).replace(/[/.*]/g,"")}function el(n){return tm(n+ph,fh).replace("/","").replace("*","").replace(".","")}class jn{userId="";name="";gender=Q.male;phone="";payments={};isExist=!1;fcmTokens;isVerifiedPhone=!1;userDecline=!1;constructor({userId:e="",name:t="",gender:r=Q.male,isVerifiedPhone:i=!1,phone:s="",isExist:o=!0,userDecline:c=!1}){this.userId=e,this.name=t,this.gender=r,this.isVerifiedPhone=i,this.phone=s,this.isExist=o,this.userDecline=c}get customerHashPhone(){return el(this.phone)}get customerPhoneAsCollection(){return this.phone.replaceAll("-","")}get isPaid(){return Object.keys(this.payments).length>0}static fromJson(e,t){const r=new jn({userId:t,name:e.N??"",gender:e.G?rr[e.G]:Q.male,isVerifiedPhone:e.IVP??!1,phone:e.P??"",isExist:e.IE??!0,userDecline:e.UD??!1});return e.PY!=null&&typeof e.PY=="object"&&Object.entries(e.PY).forEach(([i,s])=>{r.payments[i]=s?new Date(s):new Date(0)}),r}toJson(){const e={};return e.N=this.name,this.isVerifiedPhone&&(e.IVP=this.isVerifiedPhone),this.isExist||(e.IE=this.isExist),e.P=this.phone,this.gender!==Q.male&&(e.G=Q[this.gender]),Object.keys(this.payments).length>0&&(e.PY={},Object.entries(this.payments).forEach(([t,r])=>{e.PY[t]=r.toString()})),this.userDecline&&(e.UD=this.userDecline),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}var qe=(n=>(n.waiting="waiting",n.approved="approved",n))(qe||{});const im={waiting:"waiting",approved:"approved"},sm={waiting:"waiting",approved:"approved"};var Je=(n=>(n.app="app",n.web="web",n.byWorker="byWorker",n))(Je||{});const om={app:"app",web:"web",byWorker:"byWorker"},am={app:"app",web:"web",byWorker:"byWorker"};var Sn=(n=>(n.regular="regular",n.confirmArrival="confirmArrival",n))(Sn||{});const tn={regular:"regular",confirmArrival:"confirmArrival"};var wt=(n=>(n.message="message",n.push="push",n.none="none",n.whatsapp="whatsapp",n))(wt||{});const cm={message:"message",push:"push",none:"none",whatsapp:"whatsapp"},lm={message:"message",push:"push",whatsapp:"whatsapp",none:"none"},ps={0:"deposit",1:"payment"},ms={deposit:0,payment:1};let h0=class xs{type=1;amount=0;createdAt=new Date(0);id="";hypId="";constructor({type:e,amount:t,id:r,hypId:i,createdAt:s}){this.type=e,this.amount=Number(t.toFixed(2))||t,this.id=r,this.hypId=i,this.createdAt=s}static fromJson(e,t){const r=new xs({});return e.amount!=null&&(r.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),r.hypId=e.hypId||"",r.id=t,r.type=ms[e.type]||1,r.createdAt=e.createdAt?new Date(e.createdAt):new Date(0),r}static fromTransaction(e){const t=new xs({});return t.type=e.type,t.amount=e.amount,t.id=e.id,t.hypId=e.hypId,t.createdAt=e.createdAt,t}toJson(){const e={};return e.amount=this.amount,e.hypId=this.hypId,e.type=ps[this.type],e.createdAt=this.createdAt.toISOString(),e}toString(){return JSON.stringify(this.toJson(),null,2)}};class ot{totalMinutes=0;index="";id="";note="";price;amountInAdvance=0;paymentType;isMulti=!1;showPrice=!0;showTime=!0;count=1;name="";colorIndex=-2;maxParticipants=1;maxTicketsForUser=1;tempMaxParticipants;hide=!1;showParticipants=!0;times=new Map;priceChangingNote;constructor({times:e=new Map,id:t="",price:r,count:i=1,name:s="",isMulti:o=!1,maxTicketsForUser:c=1,index:l="",amountInAdvance:a=0,colorIndex:h=-2,hide:d=!1,paymentType:u,note:f="",maxParticipants:p=1,showPrice:_=!0,showParticipants:g=!0,showTime:E=!0}={}){this.times=e,this.id=t,this.price=r,this.count=i,this.name=s,this.isMulti=o,this.maxTicketsForUser=c,this.index=l,this.amountInAdvance=a,this.colorIndex=h,this.hide=d,this.paymentType=u,this.note=f,this.maxParticipants=p,this.showPrice=_,this.showParticipants=g,this.showTime=E,this.totalMinutes=this.totalTotalMinutes}isEqual(e){return!0}get totalTotalMinutes(){let e=0;return this.times.forEach((t,r)=>{e+=t.wholeMinutes}),e}get totalWorkMinutes(){let e=0;return this.times.forEach((t,r)=>{e+=t.workMinutes}),e}get totalMinutesForBooking(){return this.totalMinutes*this.count}get amountInAdvanceForBooking(){return this.amountInAdvance*this.count}get totalPriceForBooking(){return this.price.amount*this.count}get nameForBooking(){return this.count===1?this.name:`${this.name} X${this.count}`}static fromTreatment(e){const t=new ot({times:new Map,showTime:e.showTime,paymentType:e.paymentType,id:e.id,hide:e.hide,showPrice:e.showPrice,price:e.price,index:e.index,maxTicketsForUser:e.maxTicketsForUser,colorIndex:e.colorIndex,name:e.name,isMulti:e.isMulti,note:e.note,count:e.count,maxParticipants:e.maxParticipants,amountInAdvance:e.amountInAdvance});return t.priceChangingNote=e.priceChangingNote,t.tempMaxParticipants=e.tempMaxParticipants,t.totalMinutes=e.totalMinutes,e.times.forEach((r,i)=>{t.times.set(i,TreatmentTime.fromTreatmentTime(r))}),t}static fromTreatmentsMap(e){let t=0;const r=new ot({price:new Vt({amount:"0",currency:no})});return e.forEach((i,s)=>{for(let o=0;o<i.count;o++)i.times.forEach((c,l)=>{r.times.set(t.toString(),c),t++}),i.price&&(r.price.amount+=i.price.amount,r.price.currency=i.price.currency),r.name===""?r.name=i.name:r.name+=` + ${i.name}`,r.showTime=r.showTime&&i.showTime,r.showPrice=r.showPrice&&i.showPrice,r.paymentType=i.paymentType,r.amountInAdvance+=i.amountInAdvance,r.totalMinutes+=i.totalMinutes}),r}get participants(){return this.tempMaxParticipants!==void 0?this.tempMaxParticipants:this.maxParticipants}priceToString(){return this.price.toString()}minutesToString(){return sp(new Duration({minutes:this.totalMinutes}))}static fromJson(e,t){const r=new ot({times:new Map,id:e.id||"",colorIndex:e.colorIndex||-2,maxTicketsForUser:e.maxTicketsForUser||1,index:t,hide:e.hide||!1,name:e.name||"",isMulti:e.isMulti||!1,note:e.note||"",count:e.count||1,price:e.price?Vt.fromJson(e.price):void 0,amountInAdvance:e.amountInAdvance!==void 0?typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance):0,maxParticipants:e.maxParticipants||1,paymentType:ms[e.paymentType],showPrice:e.showPrice||!1,showTime:e.showTime||!1,showParticipants:e.showParticipants||!0});if(r.priceChangingNote=e.priceChangingNote,r.tempMaxParticipants=e.tempMaxParticipants,e.times)for(const i in e.times)r.times.set(i,TreatmentTime.fromJson(e.times[i]));return r}toJson(){const e={};return e.times={},this.times.forEach((t,r)=>{e.times[r]=t.toJson()}),e.name=this.name,this.note!==""&&(e.note=this.note),this.id!==""&&(e.id=this.id),this.hide&&(e.hide=this.hide),this.maxTicketsForUser>1&&(e.maxTicketsForUser=this.maxTicketsForUser),this.colorIndex!==-2&&(e.colorIndex=this.colorIndex),this.priceChangingNote!==void 0&&(e.priceChangingNote=this.priceChangingNote),e.price=this.price?this.price.toJson():void 0,this.amountInAdvance!==0&&(e.amountInAdvance=this.amountInAdvance),this.paymentType!=null&&ps[this.paymentType]!=null&&(e.paymentType=ps[this.paymentType]),this.isMulti&&(e.isMulti=this.isMulti),this.tempMaxParticipants!==void 0&&(e.tempMaxParticipants=this.tempMaxParticipants),this.count!==1&&(e.count=this.count),this.maxParticipants!==1&&(e.maxParticipants=this.maxParticipants),this.showParticipants||(e.showParticipants=this.showParticipants),e.showPrice=this.showPrice,e.showTime=this.showTime,e}static fromOldJson(e,t,r,i){const s=new ot({});if(e.times)for(const o in e.times)e.times.hasOwnProperty(o)&&s.times.set(o,TreatmentTime.fromJson(e.times[o]));return s.id="",s.colorIndex=i,s.index=t,s.name=s.parseNameFromDbField(r),e.price&&(s.price=Vt.fromJson(e.price)),e.amountInAdvance!==void 0&&(s.amountInAdvance=typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance)),s.paymentType=ms[e.paymentType],s.showPrice=e.showPrice||!1,s.showTime=e.showTime||!1,s.totalMinutes=s.totalTotalMinutes,s}parseNameFromDbField(e){return e.replace(Uo,"/").replace(Wo,"*")}parseNameToDbField(e){return e.replace("/",Uo).replace("*",Wo)}toString(){return JSON.stringify(this,null,2)}}let u0=class gs{createdAt=new Date(0);id="";amount=0;description="";showUser=!1;constructor({createdAt:e,amount:t,id:r,showUser:i,description:s=""}){this.createdAt=e,this.amount=t,this.id=r,this.showUser=i,this.description=s}static fromJson(e,t){return new gs({createdAt:e.createdAt?new Date(e.createdAt):new Date(0),amount:e.amount!=null?typeof e.amount=="number"?e.amount:parseFloat(e.amount):0,id:t,showUser:e.showUser??!1,description:e.description??""})}static fromDebt(e){return new gs({createdAt:e.createdAt,amount:e.amount,id:e.id,showUser:e.showUser,description:e.description})}isEqual(e){return e.id===this.id&&e.description===this.description&&e.showUser===this.showUser&&e.createdAt.toString()===this.createdAt.toString()&&this.amount===e.amount}toJson(){const e={};return e.createdAt=this.createdAt.toISOString(),e.amount=this.amount,this.showUser&&(e.showUser=this.showUser),this.description!==""&&(e.description=this.description),e}};class hm{date=new Date(0);workerId="";workerName="";workerPhone="";buisnessId="";businessName="";recurrenceRef;recurrenceFatherDate;recurrenceNotificationsLastDate;recurrenceChildDate;constructor({workerId:e="",workerName:t="",businessName:r="",buisnessId:i="",workerPhone:s=""}={}){this.workerId=e,this.workerName=t,this.businessName=r,this.buisnessId=i,this.workerPhone=s}}let d0=class _s{invoiceId="";docId="";monthStr="";issuedBy="";amount=0;constructor({monthStr:e,invoiceId:t,docId:r,amount:i,issuedBy:s}){this.monthStr=e,this.invoiceId=t,this.docId=r,this.amount=i,this.issuedBy=s}toJson(){const e={};return e.monthStr=this.monthStr,e.docId=this.docId,e.issuedBy=this.issuedBy,e.amount=this.amount,e}static fromJson(e,t,r){const i=new _s({});return i.invoiceId=t,i.docId=e.docId??"",i.monthStr=e.monthStr??"",i.issuedBy=e.issuedBy??r,e.amount!=null&&(i.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),i}static fromBookingInvoiceData(e){const t=new _s({});return t.invoiceId=e.invoiceId,t.docId=e.docId,t.monthStr=e.monthStr,t.issuedBy=e.issuedBy,t.amount=e.amount,t}toString(){return JSON.stringify(this.toJson(),null,2)}};const um="simpletor.officialsimplecode.com",dm="?PaymentId=PAYMENT_ID";class oo{id="";workerId="";createdAt=new Date(0);signNewMultiBookingUsers=!0;constructor({id:e,workerId:t}){this.id=e,this.workerId=t}get link(){return`https://${um}/${dm}`.replace("PAYMENT_ID",this.id)}static fromJson(e){const t=new oo({});return t.id=e.id??"",e.createdAt!=null&&(t.createdAt=new Date(e.createdAt)||new Date(0)),t.workerId=e.workerId??"",t.signNewMultiBookingUsers=e.signNewMultiBookingUsers??!0,t}toJson(){const e={};return this.createdAt.getTime()!==new Date(0).getTime()&&(e.createdAt=this.createdAt.toISOString()),this.signNewMultiBookingUsers||(e.signNewMultiBookingUsers=this.signNewMultiBookingUsers),e.id=this.id,e.workerId=this.workerId,e}toString(){return JSON.stringify(this.toJson(),null,2)}}class Gt extends hm{customerName="";customerPhone="";customerId="";orderingOptions=Je.app;isVerifiedPhone=!1;isUserExist=!0;notificationType=wt.none;workerNotificationOption=Or.PushOrSMS;workerRemindersTypes=new Map;workerDeleted=!1;clientMail="";showAdressAlert=!1;showPhoneAlert=!1;signOnDeviceCalendar=!1;isMultiRef=!1;cancelDate;lastTimeNotifyOnDebt;adress="";wasWaiting=!1;bookingDate=new Date(0);note="";needCancel=!1;treatments=new Map;userGender=Q.anonymous;workerGender=Q.anonymous;status=qe.approved;confirmedArrival=!1;bookingId="";userFcms=new Set;clientNote="";shopIcon=new Le;remindersTypes=new Map;createdAt=new Date;finishInvoices=!1;invoices=new Map;transactions=new Map;recurrenceTimeId;recurreneFatherDate;debts=new Map;addToClientAt=!1;paymentRequest;userDeleted=!1;fatherMultiBooking;fatherRecurrenceBooking;constructor({workerId:e,workerName:t,businessName:r,buisnessId:i,workerPhone:s}){super({workerId:e,workerName:t,businessName:r,buisnessId:i,workerPhone:s})}static empty(){return new Gt({})}static fromBooking(e){const t=new Gt({});return t.customerName=e.customerName,t.customerPhone=e.customerPhone,t.customerId=e.customerId,t.workerPhone=e.workerPhone,t.workerGender=e.workerGender,t.userGender=e.userGender,t.businessName=e.businessName,t.buisnessId=e.buisnessId,t.bookingId=e.bookingId,t.workerGender=e.workerGender,t.shopIcon=e.shopIcon,t.recurrenceTimeId=e.recurrenceTimeId,t.note=e.note,t.workerRemindersTypes={...e.workerRemindersTypes},t.signOnDeviceCalendar=e.signOnDeviceCalendar,t.userDeleted=e.userDeleted,t.workerNotificationOption=e.workerNotificationOption,t.paymentRequest=e.paymentRequest,t.remindersTypes={...e.remindersTypes},t.isVerifiedPhone=e.isVerifiedPhone,t.workerDeleted=e.workerDeleted,t.finishInvoices=e.finishInvoices,t.adress=e.adress,t.addToClientAt=e.addToClientAt,t.showAdressAlert=e.showAdressAlert,t.showPhoneAlert=e.showPhoneAlert,t.orderingOptions=e.orderingOptions,t.isUserExist=e.isUserExist,t.isMultiRef=e.isMultiRef,t.needCancel=e.needCancel,t.userGender=e.userGender,t.bookingDate=e.bookingDate,t.recurrenceNotificationsLastDate=e.recurrenceNotificationsLastDate,t.cancelDate=e.cancelDate,t.customerId=e.customerId,t.workerPhone=e.workerPhone,t.lastTimeNotifyOnDebt=e.lastTimeNotifyOnDebt,e.debts.forEach((r,i)=>{t.debts.set(i,u0.fromDebt(r))}),t.treatments=new Map,e.treatments.forEach((r,i)=>{const s=ot.fromTreatment(r);s.index=i,t.treatments.set(i,r)}),t.invoices=new Map,e.invoices.forEach((r,i)=>{t.invoices.set(i,d0.fromBookingInvoiceData(r))}),t.clientNote=e.clientNote,t.status=e.status,t.confirmedArrival=e.confirmedArrival,t.createdAt=e.createdAt,t.clientMail=e.clientMail,t.workerName=e.workerName,t.buisnessId=e.buisnessId,t.notificationType=e.notificationType,t.userFcms=new Set(e.userFcms),t.recurreneFatherDate=e.recurreneFatherDate,t.recurrenceRef=e.recurrenceRef,t.transactions=new Map,e.transactions.forEach((r,i)=>{t.transactions.set(i,h0.fromTransaction(r))}),t}static fromJson(e,t){const r=new Gt({});if(r.workerGender=rr[e.workerGender]||Q.anonymous,r.customerName=e.customerName||"",r.note=e.note||"",r.bookingId=t,r.signOnDeviceCalendar=e.signOnDeviceCalendar||!1,r.userDeleted=e.userDeleted||!1,r.workerDeleted=e.workerDeleted||!1,r.customerId=e.customerId||e.customerPhone||"",r.workerPhone=e.workerPhone||"",r.customerPhone=e.customerPhone||"",r.recurrenceTimeId=e.recurrenceTimeId,r.workerId=e.workerId||e.workerPhone||"",r.adress=e.adress||"",e.shopIcon!=null&&(r.shopIcon=Le.fromJson(e.shopIcon)),r.isVerifiedPhone=e.isVerifiedPhone||!1,r.customerId==r.customerPhone&&r.customerId.length==14&&(r.isVerifiedPhone=!0),r.isMultiRef=e.isMultiRef||!1,r.needCancel=e.needCancel||!1,e.lastTimeNotifyOnDebt!=null&&(r.lastTimeNotifyOnDebt=new Date(e.lastTimeNotifyOnDebt)),r.finishInvoices=e.finishInvoices||!1,e.remindersTypes!=null?Object.entries(e.remindersTypes).forEach(([i,s])=>{tn[i]!=null&&r.remindersTypes.set(tn[i],s)}):r.remindersTypes=new Map([Sn.regular,e.minutesBeforeNotify||60]),e.workerRemindersTypes!=null&&Object.entries(e.workerRemindersTypes).forEach(([i,s])=>{tn[i]!=null&&r.workerRemindersTypes.set(tn[i],s)}),r.clientMail=e.clientMail||"",e.recurrenceNotificationsLastDate!=null&&(r.recurrenceNotificationsLastDate=new Date(e.recurrenceNotificationsLastDate)),r.clientNote=e.clientNote||"",r.recurreneFatherDate=e.recurreneFatherDate,r.recurrenceRef=e.recurrenceRef,e.orderingOptions!=null&&(r.orderingOptions=am[e.orderingOptions]||Je.app),e.debts!=null&&Object.entries(e.debts).forEach(([i,s])=>{r.debts.set(i,u0.fromJson(s,i))}),e.cancelDate!=null&&(r.cancelDate=new Date(e.cancelDate)),r.wasWaiting=e.wasWaiting||!1,r.isUserExist=e.isUserExist||!0,e.invoices!=null&&Object.entries(e.invoices).forEach(([i,s])=>{r.invoices.set(i,d0.fromJson(s,i,r.workerId))}),e.userGender!=null&&(r.userGender=rr[e.userGender]||Q.anonymous),r.status=sm[e.status.toString()]||qe.approved,r.confirmedArrival=e.confirmedArrival||!1,e.bookingDate!=null&&(r.bookingDate=new Date(e.bookingDate)||new Date(0)),e.treatments!=null){r.treatments=new Map;let i=0;Object.entries(e.treatments).forEach(([s,o])=>{const c=e.treatments[i.toString()];r.treatments.set(i.toString(),ot.fromJson(c,i.toString())),i+=1})}else if(e.treatment!=null){const i=ot.fromJson(e.treatment,"0");r.treatments.set("0",i)}return r.showAdressAlert=e.showAdressAlert||!1,r.showPhoneAlert=e.showPhoneAlert||!1,r.workerName=e.workerName||"",r.businessName=e.businessName||"",r.buisnessId=e.buisnessId||"",e.notificationType!=null?r.notificationType=lm[e.notificationType]||wt.push:e.withMessage?r.notificationType=wt.message:r.notificationType=wt.push,e.workerNotificationOption!=null&&(r.workerNotificationOption=fp[e.workerNotificationOption]||Or.PushOrSMS),e.userFcms!=null?e.userFcms.forEach(i=>{r.userFcms.add(i)}):e.deviceFCM!=null&&e.deviceFCM!=""&&(r.userFcms=new Set([e.deviceFCM])),e.createdAt!=null&&(r.createdAt=new Date(e.createdAt)||new Date(0)),r.transactions=new Map,e.transactions!=null&&Object.entries(e.transactions).forEach(([i,s])=>{r.transactions.set(i,h0.fromJson(s,i))}),e.paymentRequest!=null&&(r.paymentRequest=oo.fromJson(e.paymentRequest)),r}get treatmentLength(){return Array.from(this.treatments.values()).reduce((e,t)=>t.count+e,0)}get treatmentsToStringNotDetailed(){return this.treatmentLength===1?this.treatments.values().next().value.name:this.treatments.size===1?`${this.treatments.values().next().value.name}x${this.treatmentLength}`:`${this.treatments.values().next().value.name}+${this.treatmentLength-1}`}get totalMinutes(){let e=0;return this.treatments.forEach((t,r)=>{e+=t.totalMinutesForBooking}),e}toJson(){const e={};return e.workerGender=Dn[this.workerGender],e.customerName=this.customerName,e.note=this.note,e.customerId=this.customerId,this.wasWaiting&&(e.wasWaiting=this.wasWaiting),this.workerDeleted&&(e.workerDeleted=this.workerDeleted),this.cancelDate!=null&&(e.cancelDate=this.cancelDate.toString()),e.remindersTypes={},this.clientNote!=""&&(e.clientNote=this.clientNote),this.finishInvoices&&(e.finishInvoices=this.finishInvoices),this.debts.size>0&&(e.debts={},this.debts.forEach((t,r)=>{e.debts[r]=t.toJson()})),this.lastTimeNotifyOnDebt!=null&&(e.lastTimeNotifyOnDebt=this.lastTimeNotifyOnDebt.toString()),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.userDeleted&&(e.userDeleted=this.userDeleted),e.bookingId=this.bookingId,e.needCancel=this.needCancel,e.userGender=Dn[this.userGender],e.businessName=this.businessName,this.signOnDeviceCalendar&&(e.signOnDeviceCalendar=this.signOnDeviceCalendar),this.recurrenceTimeId!=null&&(e.recurrenceTimeId=this.recurrenceTimeId),e.treatments={},this.recurrenceRef!=null&&(e.recurrenceRef=this.recurrenceRef),this.recurreneFatherDate!=null&&(e.recurreneFatherDate=this.recurreneFatherDate),this.treatments.forEach((t,r)=>{e.treatments[r.toString()]=t.toJson()}),e.invoices={},this.invoices.forEach((t,r)=>{e.invoices[r]=t.toJson()}),this.isMultiRef&&(e.isMultiRef=this.isMultiRef),this.isUserExist||(e.isUserExist=this.isUserExist),this.orderingOptions!=Je.app&&(e.orderingOptions=om[this.orderingOptions]),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.adress!=""&&(e.adress=this.adress),this.clientMail!=""&&(e.clientMail=this.clientMail),e.customerPhone=this.customerPhone,e.status=im[this.status],e.confirmedArrival=this.confirmedArrival,e.bookingDate=this.bookingDate.toISOString(),e.workerId=this.workerId.toString(),e.workerName=this.workerName,e.buisnessId=this.buisnessId,e.shopIcon=this.shopIcon.toJson(),this.recurrenceNotificationsLastDate!=null&&(e.recurrenceNotificationsLastDate=this.recurrenceNotificationsLastDate.toString()),e.notificationType=cm[this.notificationType],e.workerNotificationOption=dp[this.workerNotificationOption],e.userFcms=Array.from(this.userFcms),e.createdAt=this.createdAt.toISOString(),e.transactions={},this.transactions.forEach((t,r)=>{e.transactions[r]=t.toJson()}),this.paymentRequest!=null&&(e.paymentRequest=this.paymentRequest.toJson()),e}}class fm{futureBookings={};passedBookings={};recurrence;setMonth(e,t){const r=hp(t),i=up(new Date);r.getTime()===i.getTime()?(this.passedBookings[t]={},this.futureBookings[t]={}):r.getTime()>i.getTime()?this.futureBookings[t]={}:r.getTime()<i.getTime()&&(this.passedBookings[t]={}),Object.entries(e).forEach(([s,o])=>{const c=Gt.fromJson(o,s);c.cancelDate===null&&(c.isPassed?this.passedBookings[t][s]=c:this.futureBookings[t][s]=c)})}setRecurrence(e){this.recurrence={},Object.entries(e).forEach(([t,r])=>{const i=Gt.fromJson(r,t);i.cancelDate===null&&(this.recurrence[t]=i)})}get all(){const e={};return Object.values(this.futureBookings).forEach(t=>{Object.entries(t).forEach(([r,i])=>{e[i.bookingId]=i})}),Object.values(this.passedBookings).forEach(t=>{Object.entries(t).forEach(([r,i])=>{e[i.bookingId]=i})}),this.recurrence!==void 0&&Object.entries(this.recurrence).forEach(([t,r])=>{e[t]=r}),e}addBooking(e){if(e.recurrenceEvent!==null)this.recurrence??={},this.recurrence[e.bookingId]=e;else{const t=An(e.bookingDate);e.isPassed?(this.passedBookings[t]??={},this.passedBookings[t][e.bookingId]=e):(this.futureBookings[t]??={},this.futureBookings[t][e.bookingId]=e)}}deleteBooking(e){if(e.recurrenceEvent!==null)delete this.recurrence?.[e.bookingId];else{const t=An(e.bookingDate);delete this.passedBookings[t]?.[e.bookingId],delete this.futureBookings[t]?.[e.bookingId]}}lastBookingForBusiness(e,t,r=!1,i,s){let o=i;return Object.entries(this.futureBookings).forEach(([c,l])=>{Object.entries(l).forEach(([a,h])=>{e!==h.buisnessId||t!==h.workerId||s!==void 0&&s.getTime()===h.bookingDate.getTime()||(o===void 0||h.bookingDate.getTime()>o.getTime())&&(o=h.bookingDate)})}),o}}class ao{customerName="";customerPhone="";isVerifiedPhone=!1;notificationType=wt.none;workerNotificationOption=Or.PushOrSMS;workerRemindersTypes=new Map;customerId="";orderingOptions=Je.app;remindersTypes=new Map;isUserExist=!0;signOnDeviceCalendar=!1;lastTimeNotifyOnDebt=null;clientMail="";finishInvoices=!1;showAdressAlert=!1;userBookingId="";showPhoneAlert=!1;cancelDate=null;wasWaiting=!1;createdAt=new Date(0);needCancel=!1;userGender=Q.anonymous;status=qe.approved;confirmedArrival=!1;userFcms=new Set;clientNote="";invoices=new Map;transactions=new Map;debts=new Map;addToClientAt=!1;userDeleted=!1;constructor(){}copyDataToOrder(e){const{worker:t,needToHoldOn:r,workerAction:i,bookingDate:s,addToCalendar:o,noteText:c=""}=e;if(this.clientNote=c,r?this.status=qe.waiting:this.status=qe.approved,this.showAdressAlert=t.notifications.showAdressAlert,this.showPhoneAlert=t.notifications.showPhoneAlert,!i&&!r&&s.getTime()-Date.now()<60*60*1e3&&(this.confirmedArrival=!0),this.signOnDeviceCalendar=o,this.workerNotificationOption=t.notifications.notificationOption,this.workerRemindersTypes=new Map(t.notifications.remindersTypes),t.notifications.remindersTypes.forEach((l,a)=>{s.getTime()<Date.now()||l===Sn.confirmArrival&&this.confirmedArrival||(s.getTime()-a*60*1e3<Date.now()+1e3?(this.remindersTypes.set(l,Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))-Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))%5),this.remindersTypes.get(l)<10&&this.remindersTypes.delete(l)):this.remindersTypes.set(l,a))}),this.orderingOptions=Je.web,this.isUserExist=!0,i){const l=t.customers.customersData.get(this.customerId);this.addToClientAt=(l?.amoutOfBookings||0)<=0,this.isVerifiedPhone=l?.isVerifiedPhone||!1}else{this.userFcms=new Set(UserInitializer().user.userPublicData.fcmsTokens),this.isVerifiedPhone=UserInitializer().user.isVerifiedPhone;const l=UserInitializer().user.userPublicData.clientAt;this.addToClientAt=!l.has(BusinessInitializer().business.businessId)||!l.get(BusinessInitializer().business.businessId).has(t.id)}this.createdAt.getTime()===new Date(0).getTime()&&(this.createdAt=new Date),this.userBookingId,this.notificationType=sendMessageForMulti(this,t)}get toCustomerData(){return{name:this.customerName,phoneNumber:this.customerPhone,isVerifiedPhone:this.isVerifiedPhone,email:this.clientMail,customerUuid:this.customerId,gender:this.userGender}}get isDepositTransaction(){let e=!1;return this.transactions.forEach((t,r)=>{e=r.type===PaymentTypes.deposit}),e}get transactionsTotalPaymentAmount(){let e=0;return this.transactions.forEach((t,r)=>{r.type===PaymentTypes.payment&&(e+=r.amount)}),e}get canSendMessage(){return this.isVerifiedPhone||this.orderingOptions===Je.byWorker}get totalDebtAmount(){let e=0;return this.debts.forEach((t,r)=>{e+=r.amount}),e}get invoicePriceAmount(){return Array.from(this.invoices.values()).reduce((e,t)=>e+t.amount,0)}invoicesCoverPrice(e){const{totalAmount:t}=e;return this.finishInvoices||this.invoices.size>0&&Array.from(this.invoices.values()).reduce((r,i)=>r+i.amount,0)>=t}get transactionsTotalDepositAmount(){let e=0;return this.transactions.forEach((t,r)=>{r.type===PaymentTypes.deposit&&(e+=r.amount)}),e}get customerHashPhone(){return phoneToDocId(this.customerPhone)}get customerPhoneAsCollection(){return this.customerPhone.replace(/-/g,"")}reminderId(e){return this.userBookingId+"__"+bookingReminderTypeToStr[e]}get toPaymentRequestUser(){return{name:this.customerName,userId:this.customerId,gender:this.userGender,isExist:this.isUserExist,isVerifiedPhone:this.isVerifiedPhone,phone:this.customerPhone}}get toBooking(){const e=new Map;this.invoices.forEach((r,i)=>{e.set(r,BookingInvoiceData.fromBookingInvoiceData(i))});const t=new Map;return this.transactions.forEach((r,i)=>{t.set(r,BookingTransactionModel.fromTransaction(i))}),{customerName:this.customerName,customerPhone:this.customerPhone,showAdressAlert:this.showAdressAlert,showPhoneAlert:this.showPhoneAlert,orderingOptions:this.orderingOptions,isUserExist:this.isUserExist,needCancel:this.needCancel,userGender:this.userGender,userDeleted:this.userDeleted,bookingId:this.userBookingId,signOnDeviceCalendar:this.signOnDeviceCalendar,finishInvoices:this.finishInvoices,cancelDate:this.cancelDate,isVerifiedPhone:this.isVerifiedPhone,customerId:this.customerId,clientNote:this.clientNote,lastTimeNotifyOnDebt:this.lastTimeNotifyOnDebt,debts:this.debts,status:this.status,confirmedArrival:this.confirmedArrival,clientMail:this.clientMail,notificationType:this.notificationType,userFcms:new Set(this.userFcms),workerNotificationOption:this.workerNotificationOption}.workerRemindersTypes=new Map(this.workerRemindersTypes).createdAt=this.createdAt.invoices=e.transactions=t}get typesOfEvents(){const e=new Map;return this.needCancel&&e.set(EventFilterType.needCancel,1),this.debts.size>0&&e.set(EventFilterType.withDebts,1),this.status===qe.waiting&&e.set(EventFilterType.onHold,1),e}static fromJson(e,t,r){return new ao({customerName:e.customerName||"",customerId:e.customerId||"",customerPhone:e.customerPhone||this.customerId,needCancel:e.needCancel||!1,remindersTypes:e.remindersTypes?new Map(Object.entries(e.remindersTypes).map(([s,o])=>[bookingReminderTypeFromStr[s],o])):new Map([[Sn.regular,e.minutesBeforeNotify||60]]),workerRemindersTypes:e.workerRemindersTypes?new Map(Object.entries(e.workerRemindersTypes).map(([s,o])=>[bookingReminderTypeFromStr[s],o])):new Map,signOnDeviceCalendar:e.signOnDeviceCalendar||!1,userDeleted:e.userDeleted||!1,isVerifiedPhone:e.isVerifiedPhone||!1,clientMail:e.clientMail||"",clientNote:e.clientNote||"",userBookingId:t,orderingOptions:orderingOptionsFromStr[e.orderingOptions]||Je.app,debts:e.debts?new Map(Object.entries(e.debts).map(([s,o])=>[s,Debt.fromJson(o,s)])):new Map,finishInvoices:e.finishInvoices||!1,cancelDate:e.cancelDate?new Date(e.cancelDate):null,wasWaiting:e.wasWaiting||!1,isUserExist:e.isUserExist||!0,lastTimeNotifyOnDebt:e.lastTimeNotifyOnDebt?new Date(e.lastTimeNotifyOnDebt):null,invoices:e.invoices?new Map(Object.entries(e.invoices).map(([s,o])=>[s,BookingInvoiceData.fromJson(o,s,r)])):new Map,userGender:genderFromStr[e.userGender]||Q.anonymous,status:bookingsMassageKeys[e.status.toString()]||qe.approved,confirmedArrival:e.confirmedArrival||!1,showAdressAlert:e.showAdressAlert||!1,showPhoneAlert:e.showPhoneAlert||!1,notificationType:notificationTypeFromStr[e.notificationType]||wt.none,workerNotificationOption:notificationOptionFromStr[e.workerNotificationOption]||Or.PushOrSMS,userFcms:e.userFcms?new Set(e.userFcms):e.deviceFCM&&e.deviceFCM!==""?new Set([e.deviceFCM]):new Set,createdAt:e.createdAt?new Date(e.createdAt):new Date(0),transactions:e.transactions?new Map(Object.entries(e.transactions).map(([s,o])=>[s,BookingTransactionModel.fromJson(o,s)])):new Map})}toJson(){const e={};return e.customerName=this.customerName,e.customerId=this.customerId,this.wasWaiting&&(e.wasWaiting=this.wasWaiting),this.cancelDate&&(e.cancelDate=this.cancelDate.toISOString()),e.remindersTypes={},this.remindersTypes.forEach((t,r)=>{e.remindersTypes[bookingReminderTypeToStr[t]]=r}),e.workerRemindersTypes={},this.workerRemindersTypes.forEach((t,r)=>{e.workerRemindersTypes[bookingReminderTypeToStr[t]]=r}),this.userDeleted&&(e.userDeleted=this.userDeleted),this.signOnDeviceCalendar&&(e.signOnDeviceCalendar=this.signOnDeviceCalendar),this.clientNote!==""&&(e.clientNote=this.clientNote),this.needCancel&&(e.needCancel=this.needCancel),this.finishInvoices&&(e.finishInvoices=this.finishInvoices),e.userGender=genderToStr[this.userGender],this.invoices.size>0&&(e.invoices={},this.invoices.forEach((t,r)=>{e.invoices[t]=r.toJson()})),this.debts.size>0&&(e.debts={},this.debts.forEach((t,r)=>{e.debts[t]=r.toJson()})),this.lastTimeNotifyOnDebt&&(e.lastTimeNotifyOnDebt=this.lastTimeNotifyOnDebt.toISOString()),this.isUserExist||(e.isUserExist=this.isUserExist),this.orderingOptions!==Je.app&&(e.orderingOptions=orderingOptionsToStr[this.orderingOptions]),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.clientMail!==""&&(e.clientMail=this.clientMail),e.customerPhone=this.customerPhone,this.status!==qe.approved&&(e.status=bookingsMassage[this.status]),this.confirmedArrival&&(e.confirmedArrival=this.confirmedArrival),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.userFcms.size>0&&(e.userFcms=Array.from(this.userFcms)),e.createdAt=this.createdAt.toISOString(),this.transactions.size>0&&(e.transactions={},this.transactions.forEach((t,r)=>{e.transactions[t]=r.toJson()})),e}toString(){return JSON.stringify(this,null,"  ")}}class kr{freeFromPayments;hashNumber;blocked;constructor({freeFromPayments:e=!1,hashNumber:t="",blocked:r=!1}={}){this.freeFromPayments=e,this.hashNumber=t,this.blocked=r}static fromJson(e,t){return new kr({freeFromPayments:e.freeFromPayments,hashNumber:t})}static fromMinimalJson(e,t){return new kr({blocked:e.B??!1,freeFromPayments:e.FP,hashNumber:t})}static fromCustomerData(e){return new kr({blocked:e.blocked,freeFromPayments:e.freeFromPayments,hashNumber:e.hashNumber})}toJson(){const e={};return e.freeFromPayments=this.freeFromPayments,e.blocked=this.blocked,e}toMinimalJson(){const e={};return e.FP=this.freeFromPayments,e.B=this.blocked,e}toString(){return JSON.stringify(this.toJson(),null,2)}}const pm=3;class Fn{name="";workerNaming="";phoneNumber="";freeFromPayments=!1;isExapmle=!1;id="";customerUuid="";blocked=!1;isVerifiedPhone=!1;email="";addedManually=!1;gender=Q.male;amoutOfBookings=0;firstBookingsDate;userFirstBookingsDate;lastBookingsDate;belongings=new Set;isDeleted=!1;constructor({name:e="",amoutOfBookings:t=0,gender:r=Q.male,email:i="",id:s="",freeFromPayments:o=!1,addedManually:c=!1,customerUuid:l="",isVerifiedPhone:a=!1,workerNaming:h="",blocked:d=!1,phoneNumber:u="",firstBookingsDate:f,userFirstBookingsDate:p,lastBookingsDate:_}){this.name=e,this.amoutOfBookings=t,this.gender=r,this.email=i,this.id=s,this.freeFromPayments=o,this.addedManually=c,this.customerUuid=l,this.isVerifiedPhone=a,this.workerNaming=h,this.blocked=d,this.phoneNumber=u,this.firstBookingsDate=f,this.userFirstBookingsDate=p,this.lastBookingsDate=_}static fromJson(e,t){const r=new Fn({});return r.name=e.name??"",e.gender!=null&&(r.gender=r.getGenderFromStr(e.gender)),r.isVerifiedPhone=e.isVerifiedPhone??!1,r.freeFromPayments=e.freeFromPayments??!1,r.customerUuid=t,r.phoneNumber=e.phoneNumber??(t.length<20&&t.includes("-")?t:""),e.firstBookingsDate!=""&&e.firstBookingsDate!=null&&(r.firstBookingsDate=new Date(e.firstBookingsDate)),e.userFirstBookingsDate!=""&&e.userFirstBookingsDate!=null&&(r.userFirstBookingsDate=new Date(e.userFirstBookingsDate),(r.firstBookingsDate==null||r.userFirstBookingsDate<r.firstBookingsDate)&&(r.firstBookingsDate=r.userFirstBookingsDate)),e.lastBookingsDate!=null&&(r.lastBookingsDate=new Date(e.lastBookingsDate)),r.workerNaming=e.workerNaming??"",r.amoutOfBookings=e.amoutOfBookings??0,r.blocked=e.blocked??!1,r.email=e.email??"",r.id=e.id??"",r.addedManually=e.AM??!1,r}fromCustomerData(e){return this.name=e.name,this.gender=e.gender,this.isVerifiedPhone=e.isVerifiedPhone,this.phoneNumber=e.phoneNumber,this.belongings=e.belongings,this.email=e.email,this.isDeleted=e.isDeleted,this.blocked=e.blocked,this.id=e.id,this.addedManually=e.addedManually,this.freeFromPayments=e.freeFromPayments,this.customerUuid=e.customerUuid,this.workerNaming=e.workerNaming,this.firstBookingsDate=e.firstBookingsDate,this.lastBookingsDate=e.lastBookingsDate,this.amoutOfBookings=e.amoutOfBookings,this.userFirstBookingsDate=e.userFirstBookingsDate,this}get nameForWorker(){return this.workerNaming==""?this.name:this.workerNaming}get getFirstDate(){return this.firstBookingsDate==null||this.userFirstBookingsDate!=null&&this.userFirstBookingsDate<this.firstBookingsDate?this.userFirstBookingsDate:this.firstBookingsDate}get customerHashPhone(){return el(this.phoneNumber)}get customerPhoneAsCollection(){return this.phoneNumber.replaceAll("-","")}isTheSameAs(e,{withId:t=!1}={}){const r=this.toJson();t&&(r.id=e.customerUuid);const i=e.toJson();return t&&(i.id=this.customerUuid),JSON.stringify(i)===JSON.stringify(r)}getType({bookingInMonthForRegularClient:e,worker:t}){return t.id===this.customerUuid?5:this.isDeleted?7:this.amoutOfBookings<=pm?2:this.amountOfBookingsInMonth()<e?1:0}getGenderFromStr(e){return e==null||e=="A"?Q.anonymous:e=="F"?Q.female:Q.male}getStrFromGender(e){return{[Q.anonymous]:"A",[Q.male]:"M",[Q.female]:"F"}[e]||"A"}get toMultiBookingUser(){const e=new ao;return e.customerName=this.name!=""?this.name:this.workerNaming,e.customerPhone=this.phoneNumber,e.customerId=this.customerUuid,e.userGender=this.gender,e}get toPaymentRequestUser(){return new jn({userId:this.customerUuid,name:this.nameForWorker,gender:this.gender,isExist:!this.addedManually,isVerifiedPhone:this.isVerifiedPhone,phone:this.phoneNumber})}isMissing(e){return this.lastBookingsDate==null?!1:(new Date().getTime()-this.lastBookingsDate.getTime())/(1e3*3600*24)>e}amountOfBookingsInMonth(){if(this.firstBookingsDate==null)return-1;if(this.lastBookingsDate==null)return 0;const e=this.lastBookingsDate>new Date?new Date:this.lastBookingsDate,t=Math.max((e.getTime()-this.firstBookingsDate.getTime())/(1e3*3600*24),1);return this.amoutOfBookings/t*30}toJson(){const e={};return this.name!==""&&(e.name=this.name),this.gender!==Q.male&&(e.gender=this.getStrFromGender(this.gender)),this.phoneNumber!==this.id&&(e.phoneNumber=this.phoneNumber),this.firstBookingsDate!=null&&(e.firstBookingsDate=this.firstBookingsDate.toISOString()),this.userFirstBookingsDate!=null&&(e.userFirstBookingsDate=this.userFirstBookingsDate.toISOString()),this.lastBookingsDate!=null&&(e.lastBookingsDate=this.lastBookingsDate.toISOString()),this.amoutOfBookings!==0&&(e.amoutOfBookings=this.amoutOfBookings),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.freeFromPayments=this.freeFromPayments,this.email!==""&&(e.email=this.email),e.blocked=this.blocked,this.id!==""&&(e.id=this.id),this.addedManually&&(e.AM=this.addedManually),this.workerNaming!==""&&(e.workerNaming=this.workerNaming),e}toMinimalJson(){const e={};return e.N=this.name!==""?this.name:this.workerNaming,e.G=this.getStrFromGender(this.gender),e.P=this.phoneNumber,this.phoneNumber!==this.customerUuid&&(e.CU=this.customerUuid),this.email!==""&&(e.E=this.email),this.id!==""&&(e.ID=this.id),e}merge(e){return!e.addedManually&&this.addedManually&&(this.email=e.email!==""?e.email:this.email,this.name=e.name!==""?e.name:this.name,this.addedManually=!1,this.customerUuid=e.customerUuid),this.workerNaming===""&&(this.workerNaming=e.workerNaming),this.isVerifiedPhone=e.isVerifiedPhone||this.isVerifiedPhone,this.gender=this.gender,this.blocked=e.blocked||this.blocked,this.lastBookingsDate=ip(e.lastBookingsDate,this.lastBookingsDate),this.firstBookingsDate=ka(e.firstBookingsDate,this.firstBookingsDate),this.userFirstBookingsDate=ka(e.userFirstBookingsDate,this.userFirstBookingsDate),this.amoutOfBookings+=e.amoutOfBookings,this}fromMinimalJson(e){return this.workerNaming=e.N??"",this.name=e.N??"",e.G!=null&&(this.gender=this.getGenderFromStr(e.gender)),this.addedManually=e.AM??!1,this.phoneNumber=e.P??"",this.customerUuid=e.CU??e.P??"",this.email=e.E??"",this.id=e.ID??"",this}get publicCustomer(){return new kr({freeFromPayments:this.freeFromPayments,blocked:this.blocked,hashNumber:nm({id:this.customerUuid})})}belongingsNames(e){return Array.from(this.belongings).map(t=>e.get(t)?.name??"").join(", ")}get forUpdate(){const e=new Fn({});return e.name=this.name,e.gender=this.gender,e.isVerifiedPhone=this.isVerifiedPhone,e.phoneNumber=this.phoneNumber,e.belongings=this.belongings,e.email=this.email,e.isDeleted=this.isDeleted,e.blocked=this.blocked,e.id=this.id,e.addedManually=this.addedManually,e.freeFromPayments=this.freeFromPayments,e.customerUuid=this.customerUuid,e.workerNaming=this.workerNaming,e.firstBookingsDate=null,e.userFirstBookingsDate=null,e.amoutOfBookings=0,e.lastBookingsDate=null,e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class co{docId="";path="";constructor(e,t){this.docId=e,this.path=t}toJson(){const e={};return e.docId=this.docId,e.path=this.path,e}static fromJson(e){const t=new co("","");return t.docId=e.docId||"",t.path=e.path||"",t}toString(){return JSON.stringify(this,null,2)}}class lo{bookingCount=0;lastUpdateTime=new Date(0);docId="";constructor({docId:e=""}){this.docId=e}static fromJson(e,t){const r=new lo({});return e!==void 0&&t!==void 0&&(r.docId=t,r.bookingCount=e.bookingCount??0,r.lastUpdateTime=e.lastUpdateTime?new Date(e.lastUpdateTime):new Date(0)),r}toJson(){const e={};return this.lastUpdateTime.getTime()!==new Date(0).getTime()&&(e.lastUpdateTime=this.lastUpdateTime.toISOString()),this.bookingCount>0&&(e.bookingCount=this.bookingCount),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class zt{email="";name="";phoneNumber="";id="";devices={};gender=Q.anonymous;myBuisnessesIds=[];clientAt={};hasNotificationPermission=!0;permission={};tempFcm;allowAppNotification=!0;isVerifiedPhone=!1;isVerifiedEmail=!1;invoiceCounter;reminders;newWorkerWelcomes=new Set;bookings;bookingsPreviews={};bookingsDocsToLoad=new Set;localDocsToDelete=new Set;constructor(e){this.email=e.email||"",this.isVerifiedPhone=e.isVerifiedPhone||!1,this.isVerifiedEmail=e.isVerifiedEmail||!1,this.name=e.name||"",this.phoneNumber=e.phoneNumber||"",this.id=e.id||"",this.gender=e.gender||Q.anonymous,this.devices=e.devices,this.myBuisnessesIds=e.myBuisnessesIds,this.bookings=e.bookings}static fromJson(e,t){const r=new zt({email:e.email,isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:e.isVerifiedEmail,name:e.name,phoneNumber:e.phoneNumber,id:e.id,gender:e.gender,devices:e.devices,myBuisnessesIds:e.myBuisnessesIds,bookings:e.bookings});return r.setUserPublicData(e,t),r}get customerData(){return new Fn({customerUuid:this.id,name:this.name,email:this.email,isVerifiedPhone:this.isVerifiedPhone,gender:this.gender,phoneNumber:this.phoneNumber})}setUserPublicData(e,t){if(this.permission={},this.myBuisnessesIds=[],this.isVerifiedEmail=e.isVerifiedEmail||!1,this.email=e.email||"",this.allowAppNotification=e.allowAppNotification||!0,this.email=e.email||"",this.name=e.name||"",this.clientAt={},e.clientAt&&Object.entries(e.clientAt).forEach(([r,i])=>{Object.keys(i).length!==0&&(this.clientAt[r]=new Set,Object.keys(i).forEach(s=>{this.clientAt[r].add(s)}))}),e.localDocsToDelete&&(this.localDocsToDelete=new Set,e.localDocsToDelete.forEach(r=>{this.localDocsToDelete.add(co.fromJson(r))})),this.invoiceCounter=e.invoiceCounter,this.devices={},e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([r,i])=>{this.devices[r]=ut.fromJson(i,r)}):e.currentFcm&&e.currentFcm!==""&&(this.tempFcm=e.currentFcm),this.hasNotificationPermission=e.hasNotificationPermission||!0,e.gender&&(this.gender=rr[e.gender]||Q.anonymous),this.phoneNumber=e.phoneNumber||"",this.id=e.id||e.phoneNumber||"",e.permission&&Object.entries(e.permission).forEach(([r,i])=>{i===2&&this.myBuisnessesIds.push(r),this.permission[r]=i}),e.bookings&&(this.bookings={}),this.bookingsDocsToLoad=new Set,e.bookingsPreviews){const r={};Object.entries(e.bookingsPreviews).forEach(([i,s])=>{r[i]=lo.fromJson(s,i)}),this.bookingsPreviews=r}this.id===this.phoneNumber?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1,this.newWorkerWelcomes=new Set,e.newWorkerWelcomes&&Object.keys(e.newWorkerWelcomes).forEach(r=>{this.newWorkerWelcomes.add(r)})}get fcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm)return new Set(this.tempFcm);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDevicesByToken(e){const t=[];return Object.values(this.devices).forEach(r=>{r.token===e&&t.push(ut.fromDevice(r))}),t}toJson(){const e={};return this.hasNotificationPermission||(e.hasNotificationPermission=this.hasNotificationPermission),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.isVerifiedEmail&&(e.isVerifiedEmail=this.isVerifiedEmail),this.email!==""&&(e.email=this.email),Object.keys(this.bookingsPreviews).length>0&&(e.bookingsPreviews={},Object.entries(this.bookingsPreviews).forEach(([t,r])=>{e.bookingsPreviews[t]=r.toJson()})),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),e.permission={},Object.entries(this.permission).forEach(([t,r])=>{e.permission[t]=r}),this.localDocsToDelete.size>0&&(e.localDocsToDelete=[],this.localDocsToDelete.forEach(t=>{e.localDocsToDelete.push(t.toJson())})),e.email=this.email,e.name=this.name,e.devices={},Object.entries(this.devices).forEach(([t,r])=>{e.devices[t]=r.toJson()}),e.clientAt={},Object.entries(this.clientAt).forEach(([t,r])=>{e.clientAt[t]={},r.forEach(i=>{e.clientAt[t][i]=""})}),e.gender=Dn[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,this.newWorkerWelcomes.size>0&&(e.newWorkerWelcomes={},this.newWorkerWelcomes.forEach(t=>{e.newWorkerWelcomes[t]=""})),e}}class ho{businessId="";date;productId="";constructor(e,t,r){this.businessId=e,this.date=t,this.productId=r}static fromJson(e,t){const r=new ho(t,null,"");return r.businessId=e.businessId||"",e.date instanceof pt&&(r.date=e.date),r}toJson(){const e={};return e.businessId=this.businessId,this.date!==null&&this.date!==void 0&&(e.date=this.date),e}}class Bn{productsIds={};pendingProductsIds={};id="";revenueCatId="";limitOfBuisnesses=1;preferdTipPercentage=0;cardPaymentsPass="";lastTimeUpdatePhone=new Date(0);lastTimeUpdateEmail=new Date(0);authProviders={};businessesInfo={};storyLikes=[];paymentCards={};lastVisitedBuisnesses=[];lastVisitedBuisnessesRemoved=[];lastCleanDate=pt.fromDate(new Date);businessTopics=new Set;waitingListTopics={};tempFcm;termsApprovals={};seenUpdates={};createdAt=new Date;userPublicData=new zt({devices:{},myBuisnessesIds:[]});name="";isVerifiedPhone=!1;phoneNumber="";gender=Q.anonymous;lastTimeConnect=new Date;userPublicDataListener;connectedGoogleEmail="";currentMonthInvoices;currentMonthPaymentRequest;currentMonthPayments;existInvoicesDocs=new Set;existPaymentsDocs=new Set;existPaymentRequestsDocs=new Set;invoices={};devices={};bookings=new fm;hasOldNotification=!1;constructor({name:e="",phoneNumber:t="",id:r="",productsIds:i={},myBuisnessesIds:s=[],revenueCatId:o="",limitOfBuisnesses:c=1,gender:l=Q.anonymous,lastVisitedBuisnesses:a=[],lastVisitedBuisnessesRemoved:h=[],paymentCards:d={},isVerifiedPhone:u=!1,isVerifiedEmail:f=!1,email:p="",lastCleanDate:_=pt.fromDate(new Date),createdAt:g=new Date}){this.userPublicData=new zt({email:p,isVerifiedEmail:f,isVerifiedPhone:u,name:e,phoneNumber:t,id:r,devices:this.devices,gender:l,myBuisnessesIds:s}),this.name=e,this.phoneNumber=t,this.id=r,this.productsIds=i,this.revenueCatId=o,this.limitOfBuisnesses=c,this.gender=l,this.lastVisitedBuisnesses=a,this.lastVisitedBuisnessesRemoved=h,this.paymentCards=d,this.isVerifiedPhone=u,this.cardPaymentsPass="",this.lastCleanDate=_,this.createdAt=g}get toPaymentRequestUser(){return new jn({userId:this.id,name:this.name,gender:this.gender,isVerifiedPhone:this.isVerifiedPhone,isExist:!0,phone:this.phoneNumber,userDecline:!1})}get fcmsTokens(){if(!this.userPublicData.allowAppNotification)return new Set;if(this.tempFcm)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDeviceByToken(e){let t;return Object.values(this.devices).forEach(r=>{r.token===e&&(t=ut.fromDevice(r))}),t}static fromUserDocJson(e){const t=new Bn({name:e.name,phoneNumber:e.phoneNumber,id:e.id,productsIds:{},myBuisnessesIds:[],revenueCatId:e.revenueCatId,limitOfBuisnesses:e.limitOfBuisnesses,gender:rr[e.gender],lastVisitedBuisnesses:e.lastVisitedBuisnesses,lastVisitedBuisnessesRemoved:e.lastVisitedBuisnessesRemoved,paymentCards:{},isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:!1,email:"",lastCleanDate:e.lastCleanDate,createdAt:new Date(e.createdAt)});return e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([r,i])=>{t.devices[r]=ut.fromJson(i,r)}):e.currentFcm&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),e.termsApprovals&&Object.entries(e.termsApprovals).forEach(([r,i])=>{t.termsApprovals[r]=new Date(i)||new Date(0)}),t.seenUpdates={},e.seenUpdates&&Object.entries(e.seenUpdates).forEach(([r,i])=>{t.seenUpdates[r]=new Set(i)}),t.phoneNumber=e.phoneNumber||"0",t.id=e.id||e.phoneNumber,t.preferdTipPercentage=0,e.preferdTipPercentage&&(t.preferdTipPercentage=Number.isInteger(e.preferdTipPercentage)?e.preferdTipPercentage:Math.floor(e.preferdTipPercentage)),t.cardPaymentsPass=e.cardPaymentsPass||"",e.storyLikes&&e.storyLikes.forEach(r=>t.storyLikes.push(r)),e.lastTimeUpdatePhone&&(t.lastTimeUpdatePhone=new Date(e.lastTimeUpdatePhone)||new Date(0)),e.lastTimeUpdateEmail&&(t.lastTimeUpdateEmail=new Date(e.lastTimeUpdateEmail)||new Date(0)),t.productsIds={},e.productsIds&&Object.entries(e.productsIds).forEach(([r,i])=>{t.productsIds[r]=ho.fromJson(i,r)}),e.pendingProductsIds&&Object.entries(e.pendingProductsIds).forEach(([r,i])=>{t.pendingProductsIds[r]=i}),t.revenueCatId=e.revenueCatId||"",t.lastCleanDate=e.lastCleanDate,e.lastVisitedBuisnesses.forEach(r=>t.lastVisitedBuisnesses.push(r)),e.lastVisitedBuisnessesRemoved&&e.lastVisitedBuisnessesRemoved.forEach(r=>t.lastVisitedBuisnessesRemoved.push(r)),t.businessesInfo={},e.businessesInfo&&Object.entries(e.businessesInfo).forEach(([r,i])=>{t.businessesInfo[r]=Dr.fromJson(i,r)}),e.businessTopics&&e.businessTopics.forEach(r=>{t.businessTopics.add(r)}),e.waitingListTopics&&(t.waitingListTopics={},Object.entries(e.waitingListTopics).forEach(([r,i])=>{const s=kn.fromJson(i,r);s.date===""?t.businessTopics.add(r):t.waitingListTopics[r]=s})),t.paymentCards={},e.paymentCards&&Object.entries(e.paymentCards).forEach(([r,i])=>{t.paymentCards[r]={},Object.entries(i).forEach(([s,o])=>{t.paymentCards[r][s]=Ar.fromJson(o,s,r)})}),t.createdAt=new Date(e.createdAt),t.limitOfBuisnesses=e.limitOfBuisnesses||1,e.authProviders?Object.entries(e.authProviders).forEach(([r,i])=>{if(Ao[r]){const s=Ao[r];t.authProviders[s]=new Date(i)||new Date(2023)}}):t.authProviders={[Sl.Phone]:t.createdAt},t.id===t.phoneNumber?t.isVerifiedPhone=!0:t.isVerifiedPhone=e.isVerifiedPhone||!1,e.lastTimeConnect&&(t.lastTimeConnect=new Date(e.lastTimeConnect)||new Date),t.userPublicData=new zt({myBuisnessesIds:[],devices:{},isVerifiedPhone:t.isVerifiedPhone,phoneNumber:t.phoneNumber}),t}setUserPublicData(e){this.name=e.name||"",e.devices&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,r])=>{this.devices[t]=ut.fromJson(r,t)}),this.gender=rr[e.gender],this.phoneNumber=e.phoneNumber,this.id=e.id||e.phoneNumber,this.userPublicData.setUserPublicData(e,this)}firstEnterance(e){return!new Set([...this.lastVisitedBuisnesses,...this.lastVisitedBuisnessesRemoved]).has(e)}toUserDocJson(){const e={};return e.name=this.name,e.devices={},Object.entries(this.devices).forEach(([t,r])=>{e.devices[t]=r.toJson()}),this.lastTimeUpdateEmail.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdateEmail=this.lastTimeUpdateEmail.toISOString()),this.lastTimeUpdatePhone.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdatePhone=this.lastTimeUpdatePhone.toISOString()),e.gender=Dn[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,Object.keys(this.termsApprovals).length>0&&(e.termsApprovals={},Object.entries(this.termsApprovals).forEach(([t,r])=>{e.termsApprovals[t]=r.toISOString()})),Object.keys(this.seenUpdates).length>0&&(e.seenUpdates={},Object.entries(this.seenUpdates).forEach(([t,r])=>{e.seenUpdates[t]=Array.from(r)})),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.preferdTipPercentage=this.preferdTipPercentage,e.revenueCatId=this.revenueCatId,Object.keys(this.productsIds).length>0&&(e.productsIds={},Object.entries(this.productsIds).forEach(([t,r])=>{e.productsIds[t]=r.toJson()})),e.pendingProductsIds=this.pendingProductsIds,e.lastCleanDate=this.lastCleanDate,e.limitOfBuisnesses=this.limitOfBuisnesses,e.lastVisitedBuisnesses=this.lastVisitedBuisnesses,e.lastVisitedBuisnessesRemoved=this.lastVisitedBuisnessesRemoved,e.businessesInfo={},this.cardPaymentsPass!==""&&(e.cardPaymentsPass=this.cardPaymentsPass),Object.entries(this.businessesInfo).forEach(([t,r])=>{e.businessesInfo[t]=r.toJson()}),e.storyLikes=this.storyLikes,e.waitingListTopics={},Object.entries(this.waitingListTopics).forEach(([t,r])=>{e.waitingListTopics[t]=r.toJson()}),e.businessTopics=Array.from(this.businessTopics),e.authProviders={},Object.entries(this.authProviders).forEach(([t,r])=>{e.authProviders[t]=r.toISOString()}),e.paymentCards={},Object.entries(this.paymentCards).forEach(([t,r])=>{e.paymentCards[t]={},Object.entries(r).forEach(([i,s])=>{e.paymentCards[t][i]=s.toJson()})}),e.createdAt=this.createdAt.toISOString(),e}get developerId(){return this.id.replace("+","")}toString(){return JSON.stringify(this.toUserDocJson())+JSON.stringify(this.userPublicData.toJson())}}let it=class Et{static instance;constructor(){}static GI(){return Et.instance||(Et.instance=new Et),Et.instance}user=new Bn({});verificationRepo=new Fl;userRepo=new np;userDoc;get getPermission(){return 0}isDeveloper(){return this.isConnected?Ke.developers.hasOwnProperty(this.user.id.replace("+","")):!1}get isConnected(){return this.verificationRepo.isLoggedIn}get userId(){try{return this.verificationRepo.userId}catch{return""}}async setupUser({newUserId:e="",logoutIfDosentExist:t=!1}){try{return Re.info(`The user id is -> ${e}`),e.length<5?(await this.verificationRepo.logout(),!0):(this.userDoc===void 0&&(this.userDoc=await this.userRepo.getDocRepo({path:Ir,docId:e})),!t&&(this.userDoc==null||!this.userDoc.exists())?(this.userDoc=void 0,!0):(this.user=Bn.fromUserDocJson(this.userDoc?.data()),this.startPublicDataListening(),!0))}catch(r){return this.userDoc=void 0,r instanceof Error&&(Re.error(`Error while setting up the user --> ${r}`),AppErrorsHelper.GI().addError({details:r.toString()})),!1}}async startPublicDataListening(){this.isConnected&&(this.user.userPublicDataListener=this.userRepo.docListenerRepo({path:`${Ir}/${this.user.id}/${vr}`,docId:yr,onChanged:async e=>{try{e.exists()&&this.user.setUserPublicData(e.data())}catch(t){console.error(`Error in startPublicDataListening: ${t}`)}}}))}async loadBookingsDocs(e){const t=[];e.forEach(r=>{t.push(this.loadBookingDoc(r))}),await Promise.all(t)}async loadBookingDoc(e){try{const t=await this.userRepo.getDocRepo({path:bn.GI().userBookingsPathByUser(this.user.id),docId:e});e===uh?Et.GI().user.bookings.setRecurrence(t?.data()||{}):Et.GI().user.bookings.setMonth(t?.data()||{},e)}catch(t){console.error(`Error loading booking doc ${e}: ${t}`)}}};class Tn{static _singleton=new Tn;constructor(){}static GI(){return Tn._singleton}generalRepo=new ro;async getDevelopersFcms(){let e=new Set;const t=[];return Ph.forEach(r=>{t.push(this.generalRepo.getDocRepo({path:`${Ir}/${r}/${vr}`,docId:yr}).then(i=>{if(i!==void 0&&i.exists()&&i.data()!=null){const s=zt.fromJson(i.data());e=new Set([...e,...s.fcmsTokens])}}))}),await Promise.all(t),e}async changeSearchStatusOfBusiness(e,t){return await this.generalRepo.updateFieldInsideDocAsMapRepo({path:nt,docId:e,fieldName:"show",value:t}).then(r=>(r&&e===Dt.GI().business.businessId&&(Dt.GI().business.searchable=t),r))}async logErrorToDb({userId:e,errorType:t,exceptions:r,extras:i,strIssue:s}){const o={date:pt.now().toDate().toUTCString(),error:r.toString(),currentBusinessId:Ke.currentBusinesssId,...i};s&&(o.strIssue=s),console.log("TO DO uuid"),o.device="web";const c={[e]:{ssssssssssssssss:o}};await this.generalRepo.setAsMapWithMergeRepo({path:`${Ro}/${lh}/${Vo[t]}`,docId:An(new Date),insideEnviroments:!1,valueAsJson:c}).then(l=>{})}async loginProblemReport(e,t){return await this.generalRepo.setAsMapWithMergeRepo({path:`${Ro}/${hh}/${Vo[t]}`,docId:An(new Date),insideEnviroments:!1,valueAsJson:{[e.id]:e.toJson()}}).then(r=>r)}}class Pn{static _singleton=new Pn;constructor(){}static GI(){return Pn._singleton}defaultTheme="darkIos";currentKeyTheme=null;themeCauseMainBuilt=!1;currentThemes={...Jc};currentBusinessTheme=null;async changeTheme(e,{needOverlayHandling:t=!0,ovveride:r=!1,needWaitOverlay:i=!1}={}){const s=this.currentThemes[e];if(s==null||this.currentBusinessTheme==null||!s.isEqual(this.currentBusinessTheme)||r){switch(this.currentThemes[e]?.brightness){case fs.light:Dt.GI().businessIcon="darkShopIcon";break;case fs.dark:Dt.GI().businessIcon="lightShopIcon";break;default:Dt.GI().businessIcon="lightShopIcon";break}return this.themeCauseMainBuilt=!0,this.currentKeyTheme=e,this.currentThemes.hasOwnProperty(e)&&(this.currentBusinessTheme=this.currentThemes[e]),!0}return!1}}class Mr{static _singleton=new Mr;constructor(){}static GI(){return Mr._singleton}status=xe.loading;preLoading=[];cachedBusinessId=null;firstTime=!0;async loadAppData(){if(this.status===xe.loading){if(Pn.GI().themeCauseMainBuilt){this.status=xe.success;return}Qf().then(e=>{e||this.updateStatus(xe.noInternetConnection)});try{if((await Promise.all([this.loadInitialBusiness(),this.loadUserData()])).includes(!1))return}catch(e){e instanceof Error&&(AppErrorsHelper.GI().details="4 -->"+e.toString()),this.updateStatus(xe.unknownError);return}Ke.developers=this.parseDevelopers(),Ke.hasPaddingFromTop=Ke.paddingFromTop>0,this.updateStatus(xe.success)}}parseDevelopers(){return{}}checkForErrors(e){return e[1]===!1?()=>{this.updateStatus(xe.timeError)}:e[0]===!1?()=>{this.updateStatus(xe.unknownError)}:null}async loadUserData(){return console.log("111111111111111111111111111111"),console.log(it.GI().userId),it.GI().isConnected?(console.log("rrrrrrrrrrrrr"),!!await this.executeFuture(async()=>await it.GI().setupUser({newUserId:it.GI().userId}))):!0}updateStatus(e){if(this.status===xe.noInternetConnection&&e!==xe.loading&&e!==xe.success){Re.info("Ignore status update (no internet is above) --> $status");return}Re.info("Status is updated to --> $status"),this.status=e}async loadInitialBusiness(){try{await Ve.GI().handleOpenAppLink();let e=Ve.GI().linkedBuisnessId;return e.length<7&&(e=""),e===""?(Re.info("empty LinkBuisnessId, client ->${GeneralData.currentBusinesssId}"),e=Ke.currentBusinesssId):Ve.GI().linkedBuisnessId="",e===""||await this.executeFuture(()=>Dt.GI().loadBusiness(e,it.GI().userId,{fromLoading:!0}))||(this.cachedBusinessId="",Ke.currentBusinesssId=""),!0}catch(e){return e instanceof Error&&(AppErrorsHelper.GI().details="5 --> ${UserInitializer.getInstance().isConnected} "+e.toString()),this.updateStatus(xe.unknownError),!1}}async executeFuture(e){const t=await e();return t||this.updateStatus(xe.unknownError),t}async cachedBusinessIdFuture(){for(;;){if(this.cachedBusinessId!==null)return this.cachedBusinessId;await new Promise(e=>setTimeout(e,5))}}async preLoadingFuncs(){}initReloadApp(){this.status=xe.loading,this.preLoading=[],this.cachedBusinessId=null,this.preLoadingFuncs()}async reportIssue(e,t,r){await Tn.GI().logErrorToDb({userId:it.GI().userId,errorType:T0.enter,exceptions:[e],strIssue:r?.strIssue,extras:{StageOfCrush:t,timeofCrush:pt.now().toDate().toUTCString()}})}}class Ve{static _instance;appFirstTime=!0;linkedHasChanged=!1;linkedBuisnessId="";linkedPaymentId="";constructor(){}static GI(){return Ve._instance||(Ve._instance=new Ve),Ve._instance}async handleOpenAppLink(){console.log(`AppFirstTime: ${this.appFirstTime}`);try{if(this.appFirstTime){this.appFirstTime=!1;const e="";console.log(`The link of the first time --> ${e}`)}}catch(e){console.error(`Link general error ${e}`)}}async linksAfterResumeApp(){console.log(`LinkedHasChanged ---->  ${this.linkedHasChanged}`),this.linkedHasChanged&&(console.log("Link update screen"),this.linkedHasChanged=!1,Mr.GI().status=xe.loading)}getPaymentId(e){const t=new URL(e);return console.log(`Query params --> ${JSON.stringify(t.searchParams)}`),console.log(`Segments --> ${JSON.stringify(t.pathname.split("/"))}`),t.searchParams.get("PaymentId")||""}getBuisnessId(e){const t=new URL(e);console.log(`Query params --> ${JSON.stringify(t.searchParams)}`),console.log(`Segments --> ${JSON.stringify(t.pathname.split("/"))}`);let r=t.searchParams.get("BusinessId")||"";return t.pathname.endsWith("lielcohen")&&(r="972-545401020--d0363260-ef23-11ed-8922-f300f55ecac2"),r.replace(/~@~/g,"--")}}let mm=eh();function xm(n){return{c:Ie,l:Ie,m:Ie,p:Ie,i:Ie,o:Ie,d:Ie}}function gm(n){let e;const t=n[2].default,r=gl(t,n,n[1],null);return{c(){r&&r.c()},l(i){r&&r.l(i)},m(i,s){r&&r.m(i,s),e=!0},p(i,s){r&&r.p&&(!e||s&2)&&_l(r,t,i,i[1],e?yl(t,i[1],s,null):vl(i[1]),null)},i(i){e||(sn(r,i),e=!0)},o(i){nn(r,i),e=!1},d(i){r&&r.d(i)}}}function _m(n){let e,t='<h1 class="text-4xl text-white">Loading Business</h1> <div class="loading loading-spinner loading-lg bg-white"></div>';return{c(){e=We("div"),e.innerHTML=t,this.h()},l(r){e=He(r,"DIV",{class:!0,"data-svelte-h":!0}),El(e)!=="svelte-1ws00so"&&(e.innerHTML=t),this.h()},h(){L(e,"class","h-full w-full flex flex-col items-center justify-center gap-8 bg-black")},m(r,i){Fe(r,e,i)},p:Ie,i:Ie,o:Ie,d(r){r&&K(e)}}}function vm(n){let e,t,r,i;e=new oh({});let s={ctx:n,current:null,token:null,hasCatch:!1,pending:_m,then:gm,catch:xm,value:6,blocks:[,,,]};return th(n[0],s),{c(){bl(e.$$.fragment),t=at(),r=We("div"),s.block.c(),this.h()},l(o){Dl(e.$$.fragment,o),t=ct(o),r=He(o,"DIV",{class:!0});var c=de(r);s.block.l(c),c.forEach(K),this.h()},h(){L(r,"class","h-screen w-screen")},m(o,c){Al(e,o,c),Fe(o,t,c),Fe(o,r,c),s.block.m(r,s.anchor=null),s.mount=()=>r,s.anchor=null,i=!0},p(o,[c]){n=o,rh(s,n,c)},i(o){i||(sn(e.$$.fragment,o),sn(s.block),i=!0)},o(o){nn(e.$$.fragment,o);for(let c=0;c<3;c+=1){const l=s.blocks[c];nn(l)}i=!1},d(o){o&&(K(t),K(r)),kl(e,o),s.block.d(),s.token=null,s=null}}}function ym(n,e,t){let r,i;Do(n,jl,a=>t(3,r=a)),Do(n,ko,a=>t(4,i=a));let{$$slots:s={},$$scope:o}=e;async function c(){if(i||(Ve.GI().linkedBuisnessId=r.data.businessID||"972-525656377--50ab63a0-a192-11ed-950c-3ba22fe40036",Ve.GI().linkedBuisnessId===""))return;v0().length===0?y0(x0):vs(),await Mr.GI().loadAppData();const a=Dt.GI().business;ko.set(a);const h=it.GI().user;mm.set(h)}let l=c();return n.$$set=a=>{"$$scope"in a&&t(1,o=a.$$scope)},[l,o,s]}class Fm extends p0{constructor(e){super(),m0(this,e,ym,vm,f0,{})}}export{Fm as component,Sm as universal};
