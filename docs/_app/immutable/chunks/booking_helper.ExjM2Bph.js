var ie=Object.defineProperty;var le=(a,e,t)=>e in a?ie(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var M=(a,e,t)=>(le(a,typeof e!="symbol"?e+"":e,t),t);import{s as ce,e as y,a as E,t as q,b as D,d as h,h as V,f as L,g,i as f,k as de,l as i,o as me,c as ue}from"./scheduler.wWfgp4j4.js";import{S as fe,i as ge,c as Q,a as X,m as Y,t as Z,b as ee,d as te}from"./index.k__OFNMC.js";import{o as O,t as R,w as z,q as ae,m as T,s as N,E as W,v as se,B as re,x as pe,y as ye}from"./business_initializer.RqQi4dFb.js";import{G as oe}from"./images_utils.CMDjVbss.js";import{$ as De}from"./runtime.NUMuemaG.js";import{B as he}from"./user_helper.UE2zaSmp.js";function we(a){let e,t,r,c,o,n,m,w,l,I=(a[1]?a[2]?O(a[0]):R(z[a[0].getDay()],a[3]):`  (${a[2]?O(a[0]):R(z[a[0].getDay()],a[3])})`)+"",v,G,F,_,S,p,u,H,b,U,j,x,k;return r=new oe({props:{icon:"mdi:date-range",size:22}}),u=new oe({props:{icon:"mdi:clock-time-three-outline",size:22}}),{c(){e=y("div"),t=y("div"),Q(r.$$.fragment),c=E(),o=y("div"),n=y("p"),m=q(a[5]),w=E(),l=y("p"),v=q(I),F=E(),_=y("div"),S=E(),p=y("div"),Q(u.$$.fragment),H=E(),b=y("p"),U=q(a[4]),j=E(),x=y("div"),this.h()},l(s){e=D(s,"DIV",{class:!0});var d=h(e);t=D(d,"DIV",{class:!0});var P=h(t);X(r.$$.fragment,P),c=V(P),o=D(P,"DIV",{class:!0});var A=h(o);n=D(A,"P",{dir:!0,class:!0});var $=h(n);m=L($,a[5]),$.forEach(g),w=V(A),l=D(A,"P",{});var J=h(l);v=L(J,I),J.forEach(g),A.forEach(g),P.forEach(g),F=V(d),_=D(d,"DIV",{class:!0}),h(_).forEach(g),S=V(d),p=D(d,"DIV",{class:!0});var B=h(p);X(u.$$.fragment,B),H=V(B),b=D(B,"P",{dir:!0,class:!0});var K=h(b);U=L(K,a[4]),K.forEach(g),B.forEach(g),j=V(d),x=D(d,"DIV",{class:!0}),h(x).forEach(g),d.forEach(g),this.h()},h(){f(n,"dir","ltr"),f(n,"class","whitespace-nowrap"),f(o,"class",G="flex "+(a[1]?"flex-col":"flex-row")+" text-primary"),f(t,"class","flex flex-row items-center justify-center gap-2"),f(_,"class","w-8"),f(b,"dir","ltr"),f(b,"class","text-primary"),f(p,"class","flex flex-row gap-2 justify-center text-center"),f(x,"class","flex flex-row"),f(e,"class","flex flex-row items-center justify-center text-center bg-base-300 py-2 px-4 rounded-lg w-min text-nowrap")},m(s,d){de(s,e,d),i(e,t),Y(r,t,null),i(t,c),i(t,o),i(o,n),i(n,m),i(o,w),i(o,l),i(l,v),i(e,F),i(e,_),i(e,S),i(e,p),Y(u,p,null),i(p,H),i(p,b),i(b,U),i(e,j),i(e,x),k=!0},p(s,[d]){(!k||d&15)&&I!==(I=(s[1]?s[2]?O(s[0]):R(z[s[0].getDay()],s[3]):`  (${s[2]?O(s[0]):R(z[s[0].getDay()],s[3])})`)+"")&&me(v,I),(!k||d&2&&G!==(G="flex "+(s[1]?"flex-col":"flex-row")+" text-primary"))&&f(o,"class",G)},i(s){k||(Z(r.$$.fragment,s),Z(u.$$.fragment,s),k=!0)},o(s){ee(r.$$.fragment,s),ee(u.$$.fragment,s),k=!1},d(s){s&&g(e),te(r),te(u)}}}function Ie(a,e,t){let r;ue(a,De,l=>t(3,r=l));let{date:c}=e,{dayVertical:o=!0}=e,{showTodayAndTommrow:n=!1}=e;const m=ae(c,"HH:mm"),w=ae(c,"dd-MM-yyyy");return a.$$set=l=>{"date"in l&&t(0,c=l.date),"dayVertical"in l&&t(1,o=l.dayVertical),"showTodayAndTommrow"in l&&t(2,n=l.showTodayAndTommrow)},[c,o,n,r,m,w]}class Ve extends fe{constructor(e){super(),ge(this,e,Ie,we,ce,{date:0,dayVertical:1,showTodayAndTommrow:2})}}const C=class C{constructor(){M(this,"bookingRepo",new he)}static GI(){return C._singleton}async addBooking({booking:e,worker:t,clientNote:r="",needPayInAdvance:c=!1,filledBooking:o=!1}){if(!T.GI().isConnected){N.GI().error=W.notLogedIn;return}if(console.log("22222222222222222"),e.treatments.size===0){N.GI().error=W.noTreatment;return}o||await e.copyDataToOrder({worker:t,user:T.GI().user,needToHoldOn:se(e.bookingDate,t),business:re.GI().business,clientNoteText:r}),console.log("eeeeeeeeeeeeeeeeeeee");const n=T.GI().user.customerDataFromBooking({booking:e});return await this.bookingRepo.addBooking({booking:e,needPayInAdvance:c,worker:t,afterPayment:!1,customerData:n}).then(async m=>(console.log(m),m))}async deleteBookingOnlyFromUserDoc({booking:e,deleteFromPassed:t}){return await this.bookingRepo.deleteBookingOnlyFromUser({booking:e}).then(async r=>r)}async deleteBooking({booking:e,worker:t}){if(!T.GI().isConnected)return N.GI().error=W.notLogedIn,null;const r=new Date,c=e.status===pe.waiting,o=T.GI().user.customerDataFromBooking({booking:e,needDelete:!0});console.log("booking.isPassed",e.isPassed);const n=await this.bookingRepo.deleteBooking({booking:e,deleteAllBooking:c,cancelDate:r,customerData:o,deleteFromWorker:!e.isPassed,deleteFromUser:!0});return n?(n.forEach(m=>{}),n):null}async updateBooking({newBooking:e,oldBooking:t,newWorker:r,oldWorker:c,forceUpdate:o=!1,oldBookingDateForReccurence:n,noteText:m,newClientNote:w="",keepRecurrence:l=!1,workerAction:I=!1}){if(!o&&e.isTheSameAs({booking:t,note:I?m:t.note,customerId:t.customerId}))return ye.debug("Don't need to access the database, no changes in the booking"),!0;e.updateBookingByBooking({oldBooking:t,worker:r,needToHoldOn:se(e.bookingDate,r),business:re.GI().business,newClientNote:w,keepRecurrence:l});const v=t.customerId===e.customerId&&e.workerId===t.workerId,G=v?e.bookingDate:void 0;t.bookingDate.getTime()+t.totalMinutes*60*1e3<Date.now();const F=v?t.bookingDate:void 0,_=T.GI().user.customerDataFromBooking({booking:t,needDelete:!0,initDate:G}),S=T.GI().user.customerDataFromBooking({booking:e,exclude:F});return await this.bookingRepo.updateBooking({oldBooking:t,newBooking:e,oldBookingCustomerData:_,newBookingCustomerData:S,oldBookingDateForReccurence:n}).then(async u=>(u&&console.log("value",u),u))}};M(C,"_singleton",new C);let ne=C;export{ne as B,Ve as D};
