import{w as kl}from"./entry.XKPTSYpg.js";import{f as Tl,d as No,A as Il,V as Sl}from"./auth.gvZHwwcQ.js";import{g as Bl,w as Fl,d as ve,e as Ce,f as Pl,h as Nl,r as Ol,j as ar,k as ti,o as Rl,T as ct,l as Ml,m as W,n as Ll}from"./Business.xm36v60I.js";import{z as P,c as cn,D as Ui,h as Wl,x as Ul,k as yc,y as Hl,_ as Vl,C as ql,r as Oo,A as ce,B as As,G as Ue,H as Gl,I as $l,J as zl,K as Jt,M as ui,N as Hi,O as Vi,l as Yl,P as qn,L as Kl,Q as wc,R as Jl,T as Ql,p as Ro,i as Cc,a as Xl,q as Zl,U as jl,S as eh,V as th,s as nh,t as ih}from"./index.esm2017.KfS18cUq.js";import{D as re}from"./duration.G4fcU3Nn.js";const os={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]};function as(i,e,t,n=!1){const r=String(e),s=(l,c)=>`\x1B[${c[0]}m${l}\x1B[${c[1]}m`,o=(l,c)=>c!=null&&typeof c=="string"?s(l,os[c]):c!=null&&Array.isArray(c)?c.reduce((h,d)=>o(h,d),l):c!=null&&c[l.trim()]!=null?o(l,c[l.trim()]):c!=null&&c["*"]!=null?o(l,c["*"]):l,a=null;return r.replace(/{{(.+?)}}/g,(l,c)=>{const h=t[c]!=null?String(t[c]):n?"":l;return i.stylePrettyLogs?o(h,i?.prettyLogStyles?.[c]??a)+s("",os.reset):h})}function Ae(i,e=2,t=0){return i!=null&&isNaN(i)?"":(i=i!=null?i+t:i,e===2?i==null?"--":i<10?"0"+i:i.toString():i==null?"---":i<10?"00"+i:i<100?"0"+i:i.toString())}function rh(i){return{href:i.href,protocol:i.protocol,username:i.username,password:i.password,host:i.host,hostname:i.hostname,port:i.port,pathname:i.pathname,search:i.search,searchParams:[...i.searchParams].map(([e,t])=>({key:e,value:t})),hash:i.hash,origin:i.origin}}function Dc(i){const e=new Set;return JSON.stringify(i,(t,n)=>{if(typeof n=="object"&&n!==null){if(e.has(n))return"[Circular]";e.add(n)}return n})}function ke(i,e){const t={seen:[],stylize:Ec};return e!=null&&Tc(t,e),Wt(t.showHidden)&&(t.showHidden=!1),Wt(t.depth)&&(t.depth=2),Wt(t.colors)&&(t.colors=!0),Wt(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=oh),di(t,i,t.depth)}ke.colors=os;ke.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function sh(i){return typeof i=="boolean"}function Wt(i){return i===void 0}function Ec(i){return i}function oh(i,e){const t=ke.styles[e];return t!=null&&ke?.colors?.[t]?.[0]!=null&&ke?.colors?.[t]?.[1]!=null?"\x1B["+ke.colors[t][0]+"m"+i+"\x1B["+ke.colors[t][1]+"m":i}function ni(i){return typeof i=="function"}function bc(i){return typeof i=="string"}function ah(i){return typeof i=="number"}function Ac(i){return i===null}function kc(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function cr(i){return qi(i)&&ks(i)==="[object RegExp]"}function qi(i){return typeof i=="object"&&i!==null}function lr(i){return qi(i)&&(ks(i)==="[object Error]"||i instanceof Error)}function Mo(i){return qi(i)&&ks(i)==="[object Date]"}function ks(i){return Object.prototype.toString.call(i)}function ch(i){const e={};return i.forEach(t=>{e[t]=!0}),e}function lh(i,e,t,n,r){const s=[];for(let o=0,a=e.length;o<a;++o)kc(e,String(o))?s.push(cs(i,e,t,n,String(o),!0)):s.push("");return r.forEach(o=>{o.match(/^\d+$/)||s.push(cs(i,e,t,n,o,!0))}),s}function hr(i){return"["+Error.prototype.toString.call(i)+"]"}function di(i,e,t=0){if(i.customInspect&&e!=null&&ni(e)&&e?.inspect!==ke&&!(e?.constructor&&e?.constructor.prototype===e)){if(typeof e.inspect!="function"&&e.toString!=null)return e.toString();let h=e?.inspect(t,i);return bc(h)||(h=di(i,h,t)),h}const n=it(i,e);if(n)return n;let r=Object.keys(e);const s=ch(r);try{i.showHidden&&Object.getOwnPropertyNames&&(r=Object.getOwnPropertyNames(e))}catch{}if(lr(e)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return hr(e);if(r.length===0)if(ni(i.stylize)){if(ni(e)){const h=e.name?": "+e.name:"";return i.stylize("[Function"+h+"]","special")}if(cr(e))return i.stylize(RegExp.prototype.toString.call(e),"regexp");if(Mo(e))return i.stylize(Date.prototype.toISOString.call(e),"date");if(lr(e))return hr(e)}else return e;let o="",a=!1,l=[`{
`,`
}`];if(Array.isArray(e)&&(a=!0,l=[`[
`,`
]`]),ni(e)&&(o=" [Function"+(e.name?": "+e.name:"")+"]"),cr(e)&&(o=" "+RegExp.prototype.toString.call(e)),Mo(e)&&(o=" "+Date.prototype.toUTCString.call(e)),lr(e)&&(o=" "+hr(e)),r.length===0&&(!a||e.length==0))return l[0]+o+l[1];if(t<0)return cr(e)?i.stylize(RegExp.prototype.toString.call(e),"regexp"):i.stylize("[Object]","special");i.seen.push(e);let c;return a?c=lh(i,e,t,s,r):c=r.map(h=>cs(i,e,t,s,h,a)),i.seen.pop(),hh(c,o,l)}function cs(i,e,t,n,r,s){let o,a,l={value:void 0};try{l.value=e[r]}catch{}try{Object.getOwnPropertyDescriptor&&(l=Object.getOwnPropertyDescriptor(e,r)||l)}catch{}if(l.get?l.set?a=i.stylize("[Getter/Setter]","special"):a=i.stylize("[Getter]","special"):l.set&&(a=i.stylize("[Setter]","special")),kc(n,r)||(o="["+r+"]"),a||(i.seen.indexOf(l.value)<0?(Ac(t)?a=di(i,l.value,void 0):a=di(i,l.value,t-1),a.indexOf(`
`)>-1&&(s?a=a.split(`
`).map(c=>"  "+c).join(`
`).substr(2):a=`
`+a.split(`
`).map(c=>"   "+c).join(`
`))):a=i.stylize("[Circular]","special")),Wt(o)){if(s&&r.match(/^\d+$/))return a;o=JSON.stringify(""+r),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=i.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\\'").replace(/(^"|"$)/g,"'"),o=i.stylize(o,"string"))}return o+": "+a}function it(i,e){if(Wt(e))return i.stylize("undefined","undefined");if(bc(e)){const t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\\'")+"'";return i.stylize(t,"string")}if(ah(e))return i.stylize(""+e,"number");if(sh(e))return i.stylize(""+e,"boolean");if(Ac(e))return i.stylize("null","null")}function hh(i,e,t){return t[0]+(e===""?"":e+`
`)+"  "+i.join(`,
  `)+" "+t[1]}function Tc(i,e){if(!e||!qi(e))return i;const t={...i},n={...e},r=Object.keys(e);let s=r.length;for(;s--;)t[r[s]]=n[r[s]];return i}function uh(i,...e){const t={seen:[],stylize:Ec};i!=null&&Tc(t,i);const n=e[0];let r=0,s="",o="";if(typeof n=="string"){if(e.length===1)return n;let a,l=0;for(let c=0;c<n.length-1;c++)if(n.charCodeAt(c)===37){const h=n.charCodeAt(++c);if(r+1!==e.length){switch(h){case 115:{const d=e[++r];typeof d=="number"||typeof d=="bigint"?a=it(t,d):typeof d!="object"||d===null?a=String(d):a=ke(d,{...i,compact:3,colors:!1,depth:0});break}case 106:a=Dc(e[++r]);break;case 100:{const d=e[++r];typeof d=="bigint"?a=it(t,d):typeof d=="symbol"?a="NaN":a=it(t,d);break}case 79:a=ke(e[++r],i);break;case 111:a=ke(e[++r],{...i,showHidden:!0,showProxy:!0,depth:4});break;case 105:{const d=e[++r];typeof d=="bigint"?a=it(t,d):typeof d=="symbol"?a="NaN":a=it(t,parseInt(a));break}case 102:{const d=e[++r];typeof d=="symbol"?a="NaN":a=it(t,parseInt(d));break}case 99:r+=1,a="";break;case 37:s+=n.slice(l,c),l=c+1;continue;default:continue}l!==c-1&&(s+=n.slice(l,c-1)),s+=a,l=c+1}else h===37&&(s+=n.slice(l,c),l=c+1)}l!==0&&(r++,o=" ",l<n.length&&(s+=n.slice(l)))}for(;r<e.length;){const a=e[r];s+=o,s+=typeof a!="string"?ke(a,i):a,o=" ",r++}return s}const dh={getCallerStackFrame:Ic,getErrorTrace:Sc,getMeta:ph,transportJSON:vh,transportFormatted:gh,isBuffer:_h,isError:Fc,prettyFormatLogObj:xh,prettyFormatErrorObj:Pc},fh={runtime:[typeof window,typeof document].includes("undefined")?"Generic":"Browser",browser:globalThis?.navigator?.userAgent},mh=/(?:(?:file|https?|global code|[^@]+)@)?(?:file:)?((?:\/[^:/]+){2,})(?::(\d+))?(?::(\d+))?/;function ph(i,e,t,n,r,s){return Object.assign({},fh,{name:r,parentNames:s,date:new Date,logLevelId:i,logLevelName:e,path:n?void 0:Ic(t)})}function Ic(i,e=Error()){return Bc(e?.stack?.split(`
`)?.filter(t=>!t.includes("Error: "))?.[i])}function Sc(i){return i?.stack?.split(`
`)?.filter(e=>!e.includes("Error: "))?.reduce((e,t)=>(e.push(Bc(t)),e),[])}function Bc(i){const e=globalThis?.location?.origin,t={fullFilePath:void 0,fileName:void 0,fileNameWithLine:void 0,fileColumn:void 0,fileLine:void 0,filePath:void 0,filePathWithLine:void 0,method:void 0};if(i!=null){const n=i.match(mh);if(n){t.filePath=n[1].replace(/\?.*$/,""),t.fullFilePath=`${e}${t.filePath}`;const r=t.filePath.split("/");t.fileName=r[r.length-1],t.fileLine=n[2],t.fileColumn=n[3],t.filePathWithLine=`${t.filePath}:${t.fileLine}`,t.fileNameWithLine=`${t.fileName}:${t.fileLine}`}}return t}function Fc(i){return i instanceof Error}function xh(i,e){return i.reduce((t,n)=>(Fc(n)?t.errors.push(Pc(n,e)):t.args.push(n),t),{args:[],errors:[]})}function Pc(i,e){const t=Sc(i).map(r=>as(e,e.prettyErrorStackTemplate,{...r},!0)),n={errorName:` ${i.name} `,errorMessage:Object.getOwnPropertyNames(i).reduce((r,s)=>(s!=="stack"&&r.push(i[s]),r),[]).join(", "),errorStack:t.join(`
`)};return as(e,e.prettyErrorTemplate,n)}function gh(i,e,t,n){const r=(t.length>0&&e.length>0?`
`:"")+t.join(`
`);n.prettyInspectOptions.colors=n.stylePrettyLogs,console.log(i+uh(n.prettyInspectOptions,...e)+r)}function vh(i){console.log(Dc(i))}function _h(i){return!1}class yh{constructor(e,t,n=4){this.logObj=t,this.stackDepthLevel=n,this.runtime=dh,this.settings={type:e?.type??"pretty",name:e?.name,parentNames:e?.parentNames,minLevel:e?.minLevel??0,argumentsArrayName:e?.argumentsArrayName,hideLogPositionForProduction:e?.hideLogPositionForProduction??!1,prettyLogTemplate:e?.prettyLogTemplate??"{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}	{{logLevelName}}	{{filePathWithLine}}{{nameWithDelimiterPrefix}}	",prettyErrorTemplate:e?.prettyErrorTemplate??`
{{errorName}} {{errorMessage}}
error stack:
{{errorStack}}`,prettyErrorStackTemplate:e?.prettyErrorStackTemplate??`  • {{fileName}}	{{method}}
	{{filePathWithLine}}`,prettyErrorParentNamesSeparator:e?.prettyErrorParentNamesSeparator??":",prettyErrorLoggerNameDelimiter:e?.prettyErrorLoggerNameDelimiter??"	",stylePrettyLogs:e?.stylePrettyLogs??!0,prettyLogTimeZone:e?.prettyLogTimeZone??"UTC",prettyLogStyles:e?.prettyLogStyles??{logLevelName:{"*":["bold","black","bgWhiteBright","dim"],SILLY:["bold","white"],TRACE:["bold","whiteBright"],DEBUG:["bold","green"],INFO:["bold","blue"],WARN:["bold","yellow"],ERROR:["bold","red"],FATAL:["bold","redBright"]},dateIsoStr:"white",filePathWithLine:"white",name:["white","bold"],nameWithDelimiterPrefix:["white","bold"],nameWithDelimiterSuffix:["white","bold"],errorName:["bold","bgRedBright","whiteBright"],fileName:["yellow"],fileNameWithLine:"white"},prettyInspectOptions:e?.prettyInspectOptions??{colors:!0,compact:!1,depth:1/0},metaProperty:e?.metaProperty??"_meta",maskPlaceholder:e?.maskPlaceholder??"[***]",maskValuesOfKeys:e?.maskValuesOfKeys??["password"],maskValuesOfKeysCaseInsensitive:e?.maskValuesOfKeysCaseInsensitive??!1,maskValuesRegEx:e?.maskValuesRegEx,prefix:[...e?.prefix??[]],attachedTransports:[...e?.attachedTransports??[]],overwrite:{mask:e?.overwrite?.mask,toLogObj:e?.overwrite?.toLogObj,addMeta:e?.overwrite?.addMeta,addPlaceholders:e?.overwrite?.addPlaceholders,formatMeta:e?.overwrite?.formatMeta,formatLogObj:e?.overwrite?.formatLogObj,transportFormatted:e?.overwrite?.transportFormatted,transportJSON:e?.overwrite?.transportJSON}}}log(e,t,...n){if(e<this.settings.minLevel)return;const r=[...this.settings.prefix,...n],s=this.settings.overwrite?.mask!=null?this.settings.overwrite?.mask(r):this.settings.maskValuesOfKeys!=null&&this.settings.maskValuesOfKeys.length>0?this._mask(r):r,o=this.logObj!=null?this._recursiveCloneAndExecuteFunctions(this.logObj):void 0,a=this.settings.overwrite?.toLogObj!=null?this.settings.overwrite?.toLogObj(s,o):this._toLogObj(s,o),l=this.settings.overwrite?.addMeta!=null?this.settings.overwrite?.addMeta(a,e,t):this._addMetaToLogObj(a,e,t);let c,h;return this.settings.overwrite?.formatMeta!=null&&(c=this.settings.overwrite?.formatMeta(l?.[this.settings.metaProperty])),this.settings.overwrite?.formatLogObj!=null&&(h=this.settings.overwrite?.formatLogObj(s,this.settings)),this.settings.type==="pretty"&&(c=c??this._prettyFormatLogObjMeta(l?.[this.settings.metaProperty]),h=h??this.runtime.prettyFormatLogObj(s,this.settings)),c!=null&&h!=null?this.settings.overwrite?.transportFormatted!=null?this.settings.overwrite?.transportFormatted(c,h.args,h.errors,this.settings):this.runtime.transportFormatted(c,h.args,h.errors,this.settings):this.settings.overwrite?.transportJSON!=null?this.settings.overwrite?.transportJSON(l):this.settings.type!=="hidden"&&this.runtime.transportJSON(l),this.settings.attachedTransports!=null&&this.settings.attachedTransports.length>0&&this.settings.attachedTransports.forEach(d=>{d(l)}),l}attachTransport(e){this.settings.attachedTransports.push(e)}getSubLogger(e,t){const n={...this.settings,...e,parentNames:this.settings?.parentNames!=null&&this.settings?.name!=null?[...this.settings.parentNames,this.settings.name]:this.settings?.name!=null?[this.settings.name]:void 0,prefix:[...this.settings.prefix,...e?.prefix??[]]};return new this.constructor(n,t??this.logObj,this.stackDepthLevel)}_mask(e){const t=this.settings.maskValuesOfKeysCaseInsensitive!==!0?this.settings.maskValuesOfKeys:this.settings.maskValuesOfKeys.map(n=>n.toLowerCase());return e?.map(n=>this._recursiveCloneAndMaskValuesOfKeys(n,t))}_recursiveCloneAndMaskValuesOfKeys(e,t,n=[]){if(n.includes(e))return{...e};if(typeof e=="object"&&e!==null&&n.push(e),this.runtime.isError(e)||this.runtime.isBuffer(e))return e;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Array.isArray(e))return e.map(r=>this._recursiveCloneAndMaskValuesOfKeys(r,t,n));if(e instanceof Date)return new Date(e.getTime());if(e instanceof URL)return rh(e);if(e!==null&&typeof e=="object"){const r=this.runtime.isError(e)?this._cloneError(e):Object.create(Object.getPrototypeOf(e));return Object.getOwnPropertyNames(e).reduce((s,o)=>(s[o]=t.includes(this.settings?.maskValuesOfKeysCaseInsensitive!==!0?o:o.toLowerCase())?this.settings.maskPlaceholder:this._recursiveCloneAndMaskValuesOfKeys(e[o],t,n),s),r)}else{if(typeof e=="string"){let r=e;for(const s of this.settings?.maskValuesRegEx||[])r=r.replace(s,this.settings?.maskPlaceholder||"");return r}return e}}_recursiveCloneAndExecuteFunctions(e,t=[]){return this.isObjectOrArray(e)&&t.includes(e)?this.shallowCopy(e):(this.isObjectOrArray(e)&&t.push(e),Array.isArray(e)?e.map(n=>this._recursiveCloneAndExecuteFunctions(n,t)):e instanceof Date?new Date(e.getTime()):this.isObject(e)?Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=Object.getOwnPropertyDescriptor(e,r);if(s){Object.defineProperty(n,r,s);const o=e[r];n[r]=typeof o=="function"?o():this._recursiveCloneAndExecuteFunctions(o,t)}return n},Object.create(Object.getPrototypeOf(e))):e)}isObjectOrArray(e){return typeof e=="object"&&e!==null}isObject(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null}shallowCopy(e){return Array.isArray(e)?[...e]:{...e}}_toLogObj(e,t={}){return e=e?.map(n=>this.runtime.isError(n)?this._toErrorObject(n):n),this.settings.argumentsArrayName==null?e.length===1&&!Array.isArray(e[0])&&this.runtime.isBuffer(e[0])!==!0&&!(e[0]instanceof Date)?t=typeof e[0]=="object"&&e[0]!=null?{...e[0],...t}:{0:e[0],...t}:t={...t,...e}:t={...t,[this.settings.argumentsArrayName]:e},t}_cloneError(e){const t=new e.constructor;return Object.getOwnPropertyNames(e).forEach(n=>{t[n]=e[n]}),t}_toErrorObject(e){return{nativeError:e,name:e.name??"Error",message:e.message,stack:this.runtime.getErrorTrace(e)}}_addMetaToLogObj(e,t,n){return{...e,[this.settings.metaProperty]:this.runtime.getMeta(t,n,this.stackDepthLevel,this.settings.hideLogPositionForProduction,this.settings.name,this.settings.parentNames)}}_prettyFormatLogObjMeta(e){if(e==null)return"";let t=this.settings.prettyLogTemplate;const n={};t.includes("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}")?t=t.replace("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}","{{dateIsoStr}}"):this.settings.prettyLogTimeZone==="UTC"?(n.yyyy=e?.date?.getUTCFullYear()??"----",n.mm=Ae(e?.date?.getUTCMonth(),2,1),n.dd=Ae(e?.date?.getUTCDate(),2),n.hh=Ae(e?.date?.getUTCHours(),2),n.MM=Ae(e?.date?.getUTCMinutes(),2),n.ss=Ae(e?.date?.getUTCSeconds(),2),n.ms=Ae(e?.date?.getUTCMilliseconds(),3)):(n.yyyy=e?.date?.getFullYear()??"----",n.mm=Ae(e?.date?.getMonth(),2,1),n.dd=Ae(e?.date?.getDate(),2),n.hh=Ae(e?.date?.getHours(),2),n.MM=Ae(e?.date?.getMinutes(),2),n.ss=Ae(e?.date?.getSeconds(),2),n.ms=Ae(e?.date?.getMilliseconds(),3));const r=this.settings.prettyLogTimeZone==="UTC"?e?.date:new Date(e?.date?.getTime()-e?.date?.getTimezoneOffset()*6e4);n.rawIsoStr=r?.toISOString(),n.dateIsoStr=r?.toISOString().replace("T"," ").replace("Z",""),n.logLevelName=e?.logLevelName,n.fileNameWithLine=e?.path?.fileNameWithLine??"",n.filePathWithLine=e?.path?.filePathWithLine??"",n.fullFilePath=e?.path?.fullFilePath??"";let s=this.settings.parentNames?.join(this.settings.prettyErrorParentNamesSeparator);return s=s!=null&&e?.name!=null?s+this.settings.prettyErrorParentNamesSeparator:void 0,n.name=e?.name!=null||s!=null?(s??"")+e?.name:"",n.nameWithDelimiterPrefix=n.name.length>0?this.settings.prettyErrorLoggerNameDelimiter+n.name:"",n.nameWithDelimiterSuffix=n.name.length>0?n.name+this.settings.prettyErrorLoggerNameDelimiter:"",this.settings.overwrite?.addPlaceholders!=null&&this.settings.overwrite?.addPlaceholders(e,n),as(this.settings,t,n)}}class wh extends yh{constructor(e,t){const n=typeof window<"u"&&typeof document<"u",r=n?window.chrome!==void 0&&window.CSS!==void 0&&window.CSS.supports("color","green"):!1,s=n?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1;e=e||{},e.stylePrettyLogs=e.stylePrettyLogs&&n&&!r?!1:e.stylePrettyLogs,super(e,t,s?4:5)}log(e,t,...n){return super.log(e,t,...n)}silly(...e){return super.log(0,"SILLY",...e)}trace(...e){return super.log(1,"TRACE",...e)}debug(...e){return super.log(2,"DEBUG",...e)}info(...e){return super.log(3,"INFO",...e)}warn(...e){return super.log(4,"WARN",...e)}error(...e){return super.log(5,"ERROR",...e)}fatal(...e){return super.log(6,"FATAL",...e)}getSubLogger(e,t){return super.getSubLogger(e,t)}}const Le=new wh({minLevel:4});var Ch=(i=>(i.login="login",i.enter="enter",i))(Ch||{});const Dx={login:"login",enter:"enter"},Ex=["+972-504040624","+972-525656377"],Dh="production",me=`enviroments/${Dh}`,fi="Users",Eh="BookingsObjects",bx="Errors",Ax="Helpers",oi="PublicData",bn="Workers",Lo="Bookings",rt="Businesses",kx="Reports",ai="publicData",Nc="recurrenceBookings",Wo="LikesCollection",Uo="BusinessData",bh="Counters",Ah="sasimple",kh="phone",Ho="^&8@^",Vo="^&9@^";var qo={};const Go="@firebase/database",$o="1.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oc="";function Th(i){Oc=i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ce(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:As(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ue(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){const e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ih(e)}}catch{}return new Sh},vt=Rc("localStorage"),ls=Rc("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht=new Yl("@firebase/database"),Bh=function(){let i=1;return function(){return i++}}(),Mc=function(i){const e=Gl(i),t=new $l;t.update(e);const n=t.digest();return zl.encodeByteArray(n)},Gn=function(...i){let e="";for(let t=0;t<i.length;t++){const n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=Gn.apply(null,n):typeof n=="object"?e+=ce(n):e+=n,e+=" "}return e};let Ct=null,zo=!0;const Fh=function(i,e){P(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(Ht.logLevel=Kl.VERBOSE,Ct=Ht.log.bind(Ht),e&&ls.set("logging_enabled",!0)):typeof i=="function"?Ct=i:(Ct=null,ls.remove("logging_enabled"))},de=function(...i){if(zo===!0&&(zo=!1,Ct===null&&ls.get("logging_enabled")===!0&&Fh(!0)),Ct){const e=Gn.apply(null,i);Ct(e)}},$n=function(i){return function(...e){de(i,...e)}},hs=function(...i){const e="FIREBASE INTERNAL ERROR: "+Gn(...i);Ht.error(e)},Ze=function(...i){const e=`FIREBASE FATAL ERROR: ${Gn(...i)}`;throw Ht.error(e),new Error(e)},xe=function(...i){const e="FIREBASE WARNING: "+Gn(...i);Ht.warn(e)},Ph=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&xe("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ts=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},Nh=function(i){if(document.readyState==="complete")i();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Qt="[MIN_NAME]",Et="[MAX_NAME]",St=function(i,e){if(i===e)return 0;if(i===Qt||e===Et)return-1;if(e===Qt||i===Et)return 1;{const t=Yo(i),n=Yo(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},Oh=function(i,e){return i===e?0:i<e?-1:1},_n=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+ce(e))},Is=function(i){if(typeof i!="object"||i===null)return ce(i);const e=[];for(const n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=ce(e[n]),t+=":",t+=Is(i[e[n]]);return t+="}",t},Lc=function(i,e){const t=i.length;if(t<=e)return[i];const n=[];for(let r=0;r<t;r+=e)r+e>t?n.push(i.substring(r,t)):n.push(i.substring(r,r+e));return n};function fe(i,e){for(const t in i)i.hasOwnProperty(t)&&e(t,i[t])}const Wc=function(i){P(!Ts(i),"Invalid JSON number");const e=11,t=52,n=(1<<e-1)-1;let r,s,o,a,l;i===0?(s=0,o=0,r=1/i===-1/0?1:0):(r=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(i)/Math.LN2),n),s=a+n,o=Math.round(i*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(i/Math.pow(2,1-n-t))));const c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();const h=c.join("");let d="";for(l=0;l<64;l+=8){let u=parseInt(h.substr(l,8),2).toString(16);u.length===1&&(u="0"+u),d=d+u}return d.toLowerCase()},Rh=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Mh=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Lh(i,e){let t="Unknown Error";i==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?t="Client doesn't have permission to access the desired data.":i==="unavailable"&&(t="The service is unavailable");const n=new Error(i+" at "+e._path.toString()+": "+t);return n.code=i.toUpperCase(),n}const Wh=new RegExp("^-?(0*)\\d{1,10}$"),Uh=-2147483648,Hh=2147483647,Yo=function(i){if(Wh.test(i)){const e=Number(i);if(e>=Uh&&e<=Hh)return e}return null},ln=function(i){try{i()}catch(e){setTimeout(()=>{const t=e.stack||"";throw xe("Exception was thrown by user callback.",t),e},Math.floor(0))}},Vh=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},kn=function(i,e){const t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){xe(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(de("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',xe(e)}}class Vt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Vt.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ss="5",Uc="v",Hc="s",Vc="r",qc="f",Gc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$c="ls",zc="p",us="ac",Yc="websocket",Kc="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t,n,r,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=vt.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&vt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function $h(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function Qc(i,e,t){P(typeof e=="string","typeof type must == string"),P(typeof t=="object","typeof params must == object");let n;if(e===Yc)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===Kc)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);$h(i)&&(t.ns=i.namespace);const r=[];return fe(t,(s,o)=>{r.push(s+"="+o)}),n+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{constructor(){this.counters_={}}incrementCounter(e,t=1){Ue(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return jl(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ur={},dr={};function Bs(i){const e=i.toString();return ur[e]||(ur[e]=new zh),ur[e]}function Yh(i,e){const t=i.toString();return dr[t]||(dr[t]=e()),dr[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<n.length;++r)n[r]&&ln(()=>{this.onMessage_(n[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ko="start",Jh="close",Qh="pLPCommand",Xh="pRTLPCB",Xc="id",Zc="pw",jc="ser",Zh="cb",jh="seg",eu="ts",tu="d",nu="dframe",e0=1870,t0=30,iu=e0-t0,ru=25e3,su=3e4;class Ut{constructor(e,t,n,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=$n(e),this.stats_=Bs(t),this.urlFn=l=>(this.appCheckToken&&(l[us]=this.appCheckToken),Qc(t,Kc,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Kh(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(su)),Nh(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Fs((...s)=>{const[o,a,l,c,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Ko)this.id=a,this.password=l;else if(o===Jh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const n={};n[Ko]="t",n[jc]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[Zh]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Uc]=Ss,this.transportSessionId&&(n[Hc]=this.transportSessionId),this.lastSessionId&&(n[$c]=this.lastSessionId),this.applicationId&&(n[zc]=this.applicationId),this.appCheckToken&&(n[us]=this.appCheckToken),typeof location<"u"&&location.hostname&&Gc.test(location.hostname)&&(n[Vc]=qc);const r=this.urlFn(n);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ut.forceAllow_=!0}static forceDisallow(){Ut.forceDisallow_=!0}static isAvailable(){return Ut.forceAllow_?!0:!Ut.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Rh()&&!Mh()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ce(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=th(t),r=Lc(n,iu);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={};n[nu]="t",n[Xc]=e,n[Zc]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ce(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Fs{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Bh(),window[Qh+this.uniqueCallbackIdentifier]=e,window[Xh+this.uniqueCallbackIdentifier]=t,this.myIFrame=Fs.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){de("frame writing exception"),a.stack&&de(a.stack),de(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||de("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Xc]=this.myID,e[Zc]=this.myPW,e[jc]=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+t0+n.length<=e0;){const o=this.pendingSegs.shift();n=n+"&"+jh+r+"="+o.seg+"&"+eu+r+"="+o.ts+"&"+tu+r+"="+o.d,r++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(ru)),s=()=>{clearTimeout(r),n()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const r=n.readyState;(!r||r==="loaded"||r==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{de("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou=16384,au=45e3;let mi=null;typeof MozWebSocket<"u"?mi=MozWebSocket:typeof WebSocket<"u"&&(mi=WebSocket);class Pe{constructor(e,t,n,r,s,o,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=$n(this.connId),this.stats_=Bs(t),this.connURL=Pe.connectionURL_(t,o,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,s){const o={};return o[Uc]=Ss,typeof location<"u"&&location.hostname&&Gc.test(location.hostname)&&(o[Vc]=qc),t&&(o[Hc]=t),n&&(o[$c]=n),r&&(o[us]=r),s&&(o[zc]=s),Qc(e,Yc,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,vt.set("previous_websocket_failure",!0);try{let n;wc(),this.mySock=new mi(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Pe.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&mi!==null&&!Pe.forceDisallow_}static previouslyFailed(){return vt.isInMemoryStorage||vt.get("previous_websocket_failure")===!0}markConnectionHealthy(){vt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const n=As(t);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(P(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const n=this.extractFrameCount_(t);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const t=ce(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Lc(t,ou);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(au))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Pe.responsesRequiredToBeHealthy=2;Pe.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ut,Pe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Pe&&Pe.isAvailable();let n=t&&!Pe.previouslyFailed();if(e.webSocketOnly&&(t||xe("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Pe];else{const r=this.transports_=[];for(const s of Nn.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);Nn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Nn.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cu=6e4,lu=5e3,hu=10*1024,uu=100*1024,fr="t",Jo="d",du="s",Qo="r",fu="e",Xo="o",Zo="a",jo="n",ea="p",mu="h";class pu{constructor(e,t,n,r,s,o,a,l,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=$n("c:"+this.id+":"),this.transportManager_=new Nn(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=kn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>uu?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>hu?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(fr in e){const t=e[fr];t===Zo?this.upgradeIfSecondaryHealthy_():t===Qo?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Xo&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=_n("t",e),n=_n("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ea,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Zo,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:jo,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=_n("t",e),n=_n("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=_n(fr,e);if(Jo in e){const n=e[Jo];if(t===mu){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===jo){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===du?this.onConnectionShutdown_(n):t===Qo?this.onReset_(n):t===fu?hs("Server Error: "+n):t===Xo?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):hs("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Ss!==n&&xe("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),kn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(cu))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(lu))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ea,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(vt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.allowedEvents_=e,this.listeners_={},P(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let r=0;r<n.length;r++)n[r].callback.apply(n[r].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!n||n===r[s].context)){r.splice(s,1);return}}validateEventType_(e){P(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi extends i0{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Cc()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new pi}getInitialEvent(e){return P(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta=32,na=768;class X{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Y(){return new X("")}function H(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function lt(i){return i.pieces_.length-i.pieceNum_}function te(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new X(i.pieces_,e)}function Ps(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function xu(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function On(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function r0(i){if(i.pieceNum_>=i.pieces_.length)return null;const e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new X(e,0)}function se(i,e){const t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof X)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{const n=e.split("/");for(let r=0;r<n.length;r++)n[r].length>0&&t.push(n[r])}return new X(t,0)}function q(i){return i.pieceNum_>=i.pieces_.length}function pe(i,e){const t=H(i),n=H(e);if(t===null)return e;if(t===n)return pe(te(i),te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function gu(i,e){const t=On(i,0),n=On(e,0);for(let r=0;r<t.length&&r<n.length;r++){const s=St(t[r],n[r]);if(s!==0)return s}return t.length===n.length?0:t.length<n.length?-1:1}function Ns(i,e){if(lt(i)!==lt(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function Te(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(lt(i)>lt(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}class vu{constructor(e,t){this.errorPrefix_=t,this.parts_=On(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Hi(this.parts_[n]);s0(this)}}function _u(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=Hi(e),s0(i)}function yu(i){const e=i.parts_.pop();i.byteLength_-=Hi(e),i.parts_.length>0&&(i.byteLength_-=1)}function s0(i){if(i.byteLength_>na)throw new Error(i.errorPrefix_+"has a key path longer than "+na+" bytes ("+i.byteLength_+").");if(i.parts_.length>ta)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ta+") or object contains a cycle "+xt(i))}function xt(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends i0{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new Os}getInitialEvent(e){return P(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yn=1e3,wu=60*5*1e3,ia=30*1e3,Cu=1.3,Du=3e4,Eu="server_kill",ra=3;class Qe extends n0{constructor(e,t,n,r,s,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Qe.nextPersistentConnectionId_++,this.log_=$n("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=yn,this.maxReconnectDelay_=wu,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!wc())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Os.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&pi.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(ce(s)),P(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Ui,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,n,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),P(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),P(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const s={p:n},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const l=a.d,c=a.s;Qe.warnOnListenWarnings_(l,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(n,r),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ue(e,"w")){const n=Jt(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();xe(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Jl(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ia)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Ql(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(t,n,r=>{const s=r.s,o=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),P(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";r&&(s.q=n,s.t=r),this.sendRequest(o,s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,s){this.initConnection_();const o={p:t,d:n};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,n=>{if(n.s!=="ok"){const s=n.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ce(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):hs("Unrecognized action received from server: "+ce(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){P(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=yn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=yn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Du&&(this.reconnectDelay_=yn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Cu)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Qe.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,n())},c=function(d){P(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,u]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?de("getToken() completed but was canceled"):(de("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=u&&u.token,a=new pu(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,f=>{xe(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Eu)},s))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&xe(d),l())}}}interrupt(e){de("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){de("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ro(this.interruptReasons_)&&(this.reconnectDelay_=yn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;t?n=t.map(s=>Is(s)).join("$"):n="default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new X(e).toString();let r;if(this.listens.has(n)){const s=this.listens.get(n);r=s.get(t),s.delete(t),s.size===0&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){de("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ra&&(this.reconnectDelay_=ia,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){de("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ra&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Oc.replace(/\./g,"-")]=1,Cc()?e["framework.cordova"]=1:Xl()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=pi.getInstance().currentlyOnline();return Ro(this.interruptReasons_)&&e}}Qe.nextPersistentConnectionId_=0;Qe.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new V(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new V(Qt,e),r=new V(Qt,t);return this.compare(n,r)!==0}minPost(){return V.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ii;class o0 extends Gi{static get __EMPTY_NODE(){return ii}static set __EMPTY_NODE(e){ii=e}compare(e,t){return St(e.name,t.name)}isDefinedOn(e){throw qn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return V.MIN}maxPost(){return new V(Et,ii)}makePost(e,t){return P(typeof e=="string","KeyIndex indexValue must always be a string."),new V(e,ii)}toString(){return".key"}}const qt=new o0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e,t,n,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class he{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??he.RED,this.left=r??_e.EMPTY_NODE,this.right=s??_e.EMPTY_NODE}copy(e,t,n,r,s){return new he(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return _e.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),t(e,n.key)===0){if(n.right.isEmpty())return _e.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,he.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,he.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}he.RED=!0;he.BLACK=!1;class bu{copy(e,t,n,r,s){return this}insert(e,t,n){return new he(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class _e{constructor(e,t=_e.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new _e(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,he.BLACK,null,null))}remove(e){return new _e(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,he.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(r=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ri(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ri(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ri(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ri(this.root_,null,this.comparator_,!0,e)}}_e.EMPTY_NODE=new bu;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Au(i,e){return St(i.name,e.name)}function Rs(i,e){return St(i,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ds;function ku(i){ds=i}const a0=function(i){return typeof i=="number"?"number:"+Wc(i):"string:"+i},c0=function(i){if(i.isLeafNode()){const e=i.val();P(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ue(e,".sv"),"Priority must be a string or number.")}else P(i===ds||i.isEmpty(),"priority of unexpected type.");P(i===ds||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sa;class le{constructor(e,t=le.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,P(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),c0(this.priorityNode_)}static set __childrenNodeConstructor(e){sa=e}static get __childrenNodeConstructor(){return sa}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new le(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:le.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return q(e)?this:H(e)===".priority"?this.priorityNode_:le.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:le.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=H(e);return n===null?t:t.isEmpty()&&n!==".priority"?this:(P(n!==".priority"||lt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,le.__childrenNodeConstructor.EMPTY_NODE.updateChild(te(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+a0(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Wc(this.value_):e+=this.value_,this.lazyHash_=Mc(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===le.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof le.__childrenNodeConstructor?-1:(P(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=le.VALUE_TYPE_ORDER.indexOf(t),s=le.VALUE_TYPE_ORDER.indexOf(n);return P(r>=0,"Unknown leaf type: "+t),P(s>=0,"Unknown leaf type: "+n),r===s?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}le.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let l0,h0;function Tu(i){l0=i}function Iu(i){h0=i}class Su extends Gi{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),s=n.compareTo(r);return s===0?St(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return V.MIN}maxPost(){return new V(Et,new le("[PRIORITY-POST]",h0))}makePost(e,t){const n=l0(e);return new V(t,new le("[PRIORITY-POST]",n))}toString(){return".priority"}}const oe=new Su;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bu=Math.log(2);class Fu{constructor(e){const t=s=>parseInt(Math.log(s)/Bu,10),n=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const xi=function(i,e,t,n){i.sort(e);const r=function(l,c){const h=c-l;let d,u;if(h===0)return null;if(h===1)return d=i[l],u=t?t(d):d,new he(u,d.node,he.BLACK,null,null);{const f=parseInt(h/2,10)+l,m=r(l,f),v=r(f+1,c);return d=i[f],u=t?t(d):d,new he(u,d.node,he.BLACK,m,v)}},s=function(l){let c=null,h=null,d=i.length;const u=function(m,v){const g=d-m,w=d;d-=m;const p=r(g+1,w),x=i[g],_=t?t(x):x;f(new he(_,x.node,v,null,p))},f=function(m){c?(c.left=m,c=m):(h=m,c=m)};for(let m=0;m<l.count;++m){const v=l.nextBitIsOne(),g=Math.pow(2,l.count-(m+1));v?u(g,he.BLACK):(u(g,he.BLACK),u(g,he.RED))}return h},o=new Fu(i.length),a=s(o);return new _e(n||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mr;const Mt={};class Ye{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return P(Mt&&oe,"ChildrenNode.ts has not been loaded"),mr=mr||new Ye({".priority":Mt},{".priority":oe}),mr}get(e){const t=Jt(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof _e?t:null}hasIndex(e){return Ue(this.indexSet_,e.toString())}addIndex(e,t){P(e!==qt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const s=t.getIterator(V.Wrap);let o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=s.getNext();let a;r?a=xi(n,e.getCompare()):a=Mt;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Ye(h,c)}addToIndexes(e,t){const n=ui(this.indexes_,(r,s)=>{const o=Jt(this.indexSet_,s);if(P(o,"Missing index implementation for "+s),r===Mt)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(V.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),xi(a,o.getCompare())}else return Mt;else{const a=t.get(e.name);let l=r;return a&&(l=l.remove(new V(e.name,a))),l.insert(e,e.node)}});return new Ye(n,this.indexSet_)}removeFromIndexes(e,t){const n=ui(this.indexes_,r=>{if(r===Mt)return r;{const s=t.get(e.name);return s?r.remove(new V(e.name,s)):r}});return new Ye(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wn;class M{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&c0(this.priorityNode_),this.children_.isEmpty()&&P(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return wn||(wn=new M(new _e(Rs),null,Ye.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||wn}updatePriority(e){return this.children_.isEmpty()?this:new M(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?wn:t}}getChild(e){const t=H(e);return t===null?this:this.getImmediateChild(t).getChild(te(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(P(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const n=new V(e,t);let r,s;t.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const o=r.isEmpty()?wn:this.priorityNode_;return new M(r,o,s)}}updateChild(e,t){const n=H(e);if(n===null)return t;{P(H(e)!==".priority"||lt(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(te(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,s=!0;if(this.forEachChild(oe,(o,a)=>{t[o]=a.val(e),n++,s&&M.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1}),!e&&s&&r<2*n){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+a0(this.getPriority().val())+":"),this.forEachChild(oe,(t,n)=>{const r=n.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":Mc(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const s=r.getPredecessorKey(new V(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new V(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new V(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,V.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,V.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===zn?-1:0}withIndex(e){if(e===qt||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new M(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===qt||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const n=this.getIterator(oe),r=t.getIterator(oe);let s=n.getNext(),o=r.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=n.getNext(),o=r.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===qt?null:this.indexMap_.get(e.toString())}}M.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Pu extends M{constructor(){super(new _e(Rs),M.EMPTY_NODE,Ye.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return M.EMPTY_NODE}isEmpty(){return!1}}const zn=new Pu;Object.defineProperties(V,{MIN:{value:new V(Qt,M.EMPTY_NODE)},MAX:{value:new V(Et,zn)}});o0.__EMPTY_NODE=M.EMPTY_NODE;le.__childrenNodeConstructor=M;ku(zn);Iu(zn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nu=!0;function ae(i,e=null){if(i===null)return M.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),P(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){const t=i;return new le(t,ae(e))}if(!(i instanceof Array)&&Nu){const t=[];let n=!1;if(fe(i,(o,a)=>{if(o.substring(0,1)!=="."){const l=ae(a);l.isEmpty()||(n=n||!l.getPriority().isEmpty(),t.push(new V(o,l)))}}),t.length===0)return M.EMPTY_NODE;const s=xi(t,Au,o=>o.name,Rs);if(n){const o=xi(t,oe.getCompare());return new M(s,ae(e),new Ye({".priority":o},{".priority":oe}))}else return new M(s,ae(e),Ye.Default)}else{let t=M.EMPTY_NODE;return fe(i,(n,r)=>{if(Ue(i,n)&&n.substring(0,1)!=="."){const s=ae(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(n,s))}}),t.updatePriority(ae(e))}}Tu(ae);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou extends Gi{constructor(e){super(),this.indexPath_=e,P(!q(e)&&H(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),s=n.compareTo(r);return s===0?St(e.name,t.name):s}makePost(e,t){const n=ae(e),r=M.EMPTY_NODE.updateChild(this.indexPath_,n);return new V(t,r)}maxPost(){const e=M.EMPTY_NODE.updateChild(this.indexPath_,zn);return new V(Et,e)}toString(){return On(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru extends Gi{compare(e,t){const n=e.node.compareTo(t.node);return n===0?St(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return V.MIN}maxPost(){return V.MAX}makePost(e,t){const n=ae(e);return new V(t,n)}toString(){return".value"}}const Mu=new Ru;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u0(i){return{type:"value",snapshotNode:i}}function Xt(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function Rn(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function Mn(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function Lu(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(e){this.index_=e}updateChild(e,t,n,r,s,o){P(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Rn(t,a)):P(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Xt(t,n)):o.trackChildChange(Mn(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(oe,(r,s)=>{t.hasChild(r)||n.trackChildChange(Rn(r,s))}),t.isLeafNode()||t.forEachChild(oe,(r,s)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(s)||n.trackChildChange(Mn(r,s,o))}else n.trackChildChange(Xt(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?M.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.indexedFilter_=new Ms(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ln.getStartPost_(e),this.endPost_=Ln.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,s,o){return this.matches(new V(t,n))||(n=M.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,s,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=M.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(M.EMPTY_NODE);const s=this;return t.forEachChild(oe,(o,a)=>{s.matches(new V(o,a))||(r=r.updateImmediateChild(o,M.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{const n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new Ln(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,s,o){return this.rangedFilter_.matches(new V(t,n))||(n=M.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,s,o):this.fullLimitUpdateChild_(e,t,n,s,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=M.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=M.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(M.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,M.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,s){let o;if(this.reverse_){const d=this.index_.getCompare();o=(u,f)=>d(f,u)}else o=this.index_.getCompare();const a=e;P(a.numChildren()===this.limit_,"");const l=new V(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const d=a.getImmediateChild(t);let u=r.getChildAfterChild(this.index_,c,this.reverse_);for(;u!=null&&(u.name===t||a.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);const f=u==null?1:o(u,l);if(h&&!n.isEmpty()&&f>=0)return s?.trackChildChange(Mn(t,n,d)),a.updateImmediateChild(t,n);{s?.trackChildChange(Rn(t,d));const v=a.updateImmediateChild(t,M.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(s?.trackChildChange(Xt(u.name,u.node)),v.updateImmediateChild(u.name,u.node)):v}}else return n.isEmpty()?e:h&&o(c,l)>=0?(s!=null&&(s.trackChildChange(Rn(c.name,c.node)),s.trackChildChange(Xt(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,M.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=oe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return P(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return P(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Qt}hasEnd(){return this.endSet_}getIndexEndValue(){return P(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return P(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Et}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return P(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===oe}copy(){const e=new Ls;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Uu(i){return i.loadsAllData()?new Ms(i.getIndex()):i.hasLimit()?new Wu(i):new Ln(i)}function oa(i){const e={};if(i.isDefault())return e;let t;if(i.index_===oe?t="$priority":i.index_===Mu?t="$value":i.index_===qt?t="$key":(P(i.index_ instanceof Ou,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=ce(t),i.startSet_){const n=i.startAfterSet_?"startAfter":"startAt";e[n]=ce(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+ce(i.indexStartName_))}if(i.endSet_){const n=i.endBeforeSet_?"endBefore":"endAt";e[n]=ce(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+ce(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function aa(i){const e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==oe&&(e.i=i.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi extends n0{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=$n("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(P(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=gi.getListenId_(e,n),a={};this.listens_[o]=a;const l=oa(e._queryParams);this.restRequest_(s+".json",l,(c,h)=>{let d=h;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(s,d,!1,n),Jt(this.listens_,o)===a){let u;c?c===401?u="permission_denied":u="rest_error:"+c:u="ok",r(u,null)}})}unlisten(e,t){const n=gi.getListenId_(e,t);delete this.listens_[n]}get(e){const t=oa(e._queryParams),n=e._path.toString(),r=new Ui;return this.restRequest_(n+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(n,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zl(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=As(a.responseText)}catch{xe("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,l)}else a.status!==401&&a.status!==404&&xe("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(){this.rootNode_=M.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vi(){return{value:null,children:new Map}}function d0(i,e,t){if(q(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{const n=H(e);i.children.has(n)||i.children.set(n,vi());const r=i.children.get(n);e=te(e),d0(r,e,t)}}function fs(i,e,t){i.value!==null?t(e,i.value):Vu(i,(n,r)=>{const s=new X(e.toString()+"/"+n);fs(r,s,t)})}function Vu(i,e){i.children.forEach((t,n)=>{e(n,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&fe(this.last_,(n,r)=>{t[n]=t[n]-r}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ca=10*1e3,Gu=30*1e3,$u=5*60*1e3;class zu{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new qu(e);const n=ca+(Gu-ca)*Math.random();kn(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;fe(e,(r,s)=>{s>0&&Ue(this.statsToReport_,r)&&(t[r]=s,n=!0)}),n&&this.server_.reportStats(t),kn(this.reportStats_.bind(this),Math.floor(Math.random()*2*$u))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ne;(function(i){i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ne||(Ne={}));function Ws(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Us(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Hs(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ne.ACK_USER_WRITE,this.source=Ws()}operationForChild(e){if(q(this.path)){if(this.affectedTree.value!=null)return P(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new X(e));return new _i(Y(),t,this.revert)}}else return P(H(this.path)===e,"operationForChild called for unrelated child."),new _i(te(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t){this.source=e,this.path=t,this.type=Ne.LISTEN_COMPLETE}operationForChild(e){return q(this.path)?new Wn(this.source,Y()):new Wn(this.source,te(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ne.OVERWRITE}operationForChild(e){return q(this.path)?new bt(this.source,Y(),this.snap.getImmediateChild(e)):new bt(this.source,te(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ne.MERGE}operationForChild(e){if(q(this.path)){const t=this.children.subtree(new X(e));return t.isEmpty()?null:t.value?new bt(this.source,Y(),t.value):new Zt(this.source,Y(),t)}else return P(H(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Zt(this.source,te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(q(e))return this.isFullyInitialized()&&!this.filtered_;const t=H(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ku(i,e,t,n){const r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&i.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Lu(o.childName,o.snapshotNode))}),Cn(i,r,"child_removed",e,n,t),Cn(i,r,"child_added",e,n,t),Cn(i,r,"child_moved",s,n,t),Cn(i,r,"child_changed",e,n,t),Cn(i,r,"value",e,n,t),r}function Cn(i,e,t,n,r,s){const o=n.filter(a=>a.type===t);o.sort((a,l)=>Qu(i,a,l)),o.forEach(a=>{const l=Ju(i,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,i.query_))})})}function Ju(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function Qu(i,e,t){if(e.childName==null||t.childName==null)throw qn("Should only compare child_ events.");const n=new V(e.childName,e.snapshotNode),r=new V(t.childName,t.snapshotNode);return i.index_.compare(n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(i,e){return{eventCache:i,serverCache:e}}function Tn(i,e,t,n){return $i(new ht(e,t,n),i.serverCache)}function f0(i,e,t,n){return $i(i.eventCache,new ht(e,t,n))}function yi(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function At(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pr;const Xu=()=>(pr||(pr=new _e(Oh)),pr);class ee{constructor(e,t=Xu()){this.value=e,this.children=t}static fromObject(e){let t=new ee(null);return fe(e,(n,r)=>{t=t.set(new X(n),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Y(),value:this.value};if(q(e))return null;{const n=H(e),r=this.children.get(n);if(r!==null){const s=r.findRootMostMatchingPathAndValue(te(e),t);return s!=null?{path:se(new X(n),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(q(e))return this;{const t=H(e),n=this.children.get(t);return n!==null?n.subtree(te(e)):new ee(null)}}set(e,t){if(q(e))return new ee(t,this.children);{const n=H(e),s=(this.children.get(n)||new ee(null)).set(te(e),t),o=this.children.insert(n,s);return new ee(this.value,o)}}remove(e){if(q(e))return this.children.isEmpty()?new ee(null):new ee(null,this.children);{const t=H(e),n=this.children.get(t);if(n){const r=n.remove(te(e));let s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new ee(null):new ee(this.value,s)}else return this}}get(e){if(q(e))return this.value;{const t=H(e),n=this.children.get(t);return n?n.get(te(e)):null}}setTree(e,t){if(q(e))return t;{const n=H(e),s=(this.children.get(n)||new ee(null)).setTree(te(e),t);let o;return s.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,s),new ee(this.value,o)}}fold(e){return this.fold_(Y(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,s)=>{n[r]=s.fold_(se(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Y(),t)}findOnPath_(e,t,n){const r=this.value?n(t,this.value):!1;if(r)return r;if(q(e))return null;{const s=H(e),o=this.children.get(s);return o?o.findOnPath_(te(e),se(t,s),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Y(),t)}foreachOnPath_(e,t,n){if(q(e))return this;{this.value&&n(t,this.value);const r=H(e),s=this.children.get(r);return s?s.foreachOnPath_(te(e),se(t,r),n):new ee(null)}}foreach(e){this.foreach_(Y(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(se(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.writeTree_=e}static empty(){return new Me(new ee(null))}}function In(i,e,t){if(q(e))return new Me(new ee(t));{const n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){const r=n.path;let s=n.value;const o=pe(r,e);return s=s.updateChild(o,t),new Me(i.writeTree_.set(r,s))}else{const r=new ee(t),s=i.writeTree_.setTree(e,r);return new Me(s)}}}function ms(i,e,t){let n=i;return fe(t,(r,s)=>{n=In(n,se(e,r),s)}),n}function la(i,e){if(q(e))return Me.empty();{const t=i.writeTree_.setTree(e,new ee(null));return new Me(t)}}function ps(i,e){return Bt(i,e)!=null}function Bt(i,e){const t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild(pe(t.path,e)):null}function ha(i){const e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(oe,(n,r)=>{e.push(new V(n,r))}):i.writeTree_.children.inorderTraversal((n,r)=>{r.value!=null&&e.push(new V(n,r.value))}),e}function ot(i,e){if(q(e))return i;{const t=Bt(i,e);return t!=null?new Me(new ee(t)):new Me(i.writeTree_.subtree(e))}}function xs(i){return i.writeTree_.isEmpty()}function jt(i,e){return m0(Y(),i.writeTree_,e)}function m0(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(P(s.value!==null,"Priority writes must always be leaf nodes"),n=s.value):t=m0(se(i,r),s,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(se(i,".priority"),n)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(i,e){return v0(e,i)}function Zu(i,e,t,n,r){P(n>i.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:r}),r&&(i.visibleWrites=In(i.visibleWrites,e,t)),i.lastWriteId=n}function ju(i,e,t,n){P(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:e,children:t,writeId:n,visible:!0}),i.visibleWrites=ms(i.visibleWrites,e,t),i.lastWriteId=n}function ed(i,e){for(let t=0;t<i.allWrites.length;t++){const n=i.allWrites[t];if(n.writeId===e)return n}return null}function td(i,e){const t=i.allWrites.findIndex(a=>a.writeId===e);P(t>=0,"removeWrite called with nonexistent writeId.");const n=i.allWrites[t];i.allWrites.splice(t,1);let r=n.visible,s=!1,o=i.allWrites.length-1;for(;r&&o>=0;){const a=i.allWrites[o];a.visible&&(o>=t&&nd(a,n.path)?r=!1:Te(n.path,a.path)&&(s=!0)),o--}if(r){if(s)return id(i),!0;if(n.snap)i.visibleWrites=la(i.visibleWrites,n.path);else{const a=n.children;fe(a,l=>{i.visibleWrites=la(i.visibleWrites,se(n.path,l))})}return!0}else return!1}function nd(i,e){if(i.snap)return Te(i.path,e);for(const t in i.children)if(i.children.hasOwnProperty(t)&&Te(se(i.path,t),e))return!0;return!1}function id(i){i.visibleWrites=p0(i.allWrites,rd,Y()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function rd(i){return i.visible}function p0(i,e,t){let n=Me.empty();for(let r=0;r<i.length;++r){const s=i[r];if(e(s)){const o=s.path;let a;if(s.snap)Te(t,o)?(a=pe(t,o),n=In(n,a,s.snap)):Te(o,t)&&(a=pe(o,t),n=In(n,Y(),s.snap.getChild(a)));else if(s.children){if(Te(t,o))a=pe(t,o),n=ms(n,a,s.children);else if(Te(o,t))if(a=pe(o,t),q(a))n=ms(n,Y(),s.children);else{const l=Jt(s.children,H(a));if(l){const c=l.getChild(te(a));n=In(n,Y(),c)}}}else throw qn("WriteRecord should have .snap or .children")}}return n}function x0(i,e,t,n,r){if(!n&&!r){const s=Bt(i.visibleWrites,e);if(s!=null)return s;{const o=ot(i.visibleWrites,e);if(xs(o))return t;if(t==null&&!ps(o,Y()))return null;{const a=t||M.EMPTY_NODE;return jt(o,a)}}}else{const s=ot(i.visibleWrites,e);if(!r&&xs(s))return t;if(!r&&t==null&&!ps(s,Y()))return null;{const o=function(c){return(c.visible||r)&&(!n||!~n.indexOf(c.writeId))&&(Te(c.path,e)||Te(e,c.path))},a=p0(i.allWrites,o,e),l=t||M.EMPTY_NODE;return jt(a,l)}}}function sd(i,e,t){let n=M.EMPTY_NODE;const r=Bt(i.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(oe,(s,o)=>{n=n.updateImmediateChild(s,o)}),n;if(t){const s=ot(i.visibleWrites,e);return t.forEachChild(oe,(o,a)=>{const l=jt(ot(s,new X(o)),a);n=n.updateImmediateChild(o,l)}),ha(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{const s=ot(i.visibleWrites,e);return ha(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function od(i,e,t,n,r){P(n||r,"Either existingEventSnap or existingServerSnap must exist");const s=se(e,t);if(ps(i.visibleWrites,s))return null;{const o=ot(i.visibleWrites,s);return xs(o)?r.getChild(t):jt(o,r.getChild(t))}}function ad(i,e,t,n){const r=se(e,t),s=Bt(i.visibleWrites,r);if(s!=null)return s;if(n.isCompleteForChild(t)){const o=ot(i.visibleWrites,r);return jt(o,n.getNode().getImmediateChild(t))}else return null}function cd(i,e){return Bt(i.visibleWrites,e)}function ld(i,e,t,n,r,s,o){let a;const l=ot(i.visibleWrites,e),c=Bt(l,Y());if(c!=null)a=c;else if(t!=null)a=jt(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),u=s?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o);let f=u.getNext();for(;f&&h.length<r;)d(f,n)!==0&&h.push(f),f=u.getNext();return h}else return[]}function hd(){return{visibleWrites:Me.empty(),allWrites:[],lastWriteId:-1}}function wi(i,e,t,n){return x0(i.writeTree,i.treePath,e,t,n)}function Vs(i,e){return sd(i.writeTree,i.treePath,e)}function ua(i,e,t,n){return od(i.writeTree,i.treePath,e,t,n)}function Ci(i,e){return cd(i.writeTree,se(i.treePath,e))}function ud(i,e,t,n,r,s){return ld(i.writeTree,i.treePath,e,t,n,r,s)}function qs(i,e,t){return ad(i.writeTree,i.treePath,e,t)}function g0(i,e){return v0(se(i.treePath,e),i.writeTree)}function v0(i,e){return{treePath:i,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;P(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),P(n!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(n,Mn(n,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(n,Rn(n,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(n,Xt(n,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(n,Mn(n,e.snapshotNode,r.oldSnap));else throw qn("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}const _0=new fd;class Gs{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new ht(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return qs(this.writes_,e,n)}}getChildAfterChild(e,t,n){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:At(this.viewCache_),s=ud(this.writes_,r,t,1,n,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function md(i){return{filter:i}}function pd(i,e){P(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),P(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function xd(i,e,t,n,r){const s=new dd;let o,a;if(t.type===Ne.OVERWRITE){const c=t;c.source.fromUser?o=gs(i,e,c.path,c.snap,n,r,s):(P(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!q(c.path),o=Di(i,e,c.path,c.snap,n,r,a,s))}else if(t.type===Ne.MERGE){const c=t;c.source.fromUser?o=vd(i,e,c.path,c.children,n,r,s):(P(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=vs(i,e,c.path,c.children,n,r,a,s))}else if(t.type===Ne.ACK_USER_WRITE){const c=t;c.revert?o=wd(i,e,c.path,n,r,s):o=_d(i,e,c.path,c.affectedTree,n,r,s)}else if(t.type===Ne.LISTEN_COMPLETE)o=yd(i,e,t.path,n,s);else throw qn("Unknown operation type: "+t.type);const l=s.getChanges();return gd(e,o,l),{viewCache:o,changes:l}}function gd(i,e,t){const n=e.eventCache;if(n.isFullyInitialized()){const r=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=yi(i);(t.length>0||!i.eventCache.isFullyInitialized()||r&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&t.push(u0(yi(e)))}}function y0(i,e,t,n,r,s){const o=e.eventCache;if(Ci(n,t)!=null)return e;{let a,l;if(q(t))if(P(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=At(e),h=c instanceof M?c:M.EMPTY_NODE,d=Vs(n,h);a=i.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{const c=wi(n,At(e));a=i.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{const c=H(t);if(c===".priority"){P(lt(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=ua(n,t,h,l);d!=null?a=i.filter.updatePriority(h,d):a=o.getNode()}else{const h=te(t);let d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const u=ua(n,t,o.getNode(),l);u!=null?d=o.getNode().getImmediateChild(c).updateChild(h,u):d=o.getNode().getImmediateChild(c)}else d=qs(n,c,e.serverCache);d!=null?a=i.filter.updateChild(o.getNode(),c,d,h,r,s):a=o.getNode()}}return Tn(e,a,o.isFullyInitialized()||q(t),i.filter.filtersNodes())}}function Di(i,e,t,n,r,s,o,a){const l=e.serverCache;let c;const h=o?i.filter:i.filter.getIndexedFilter();if(q(t))c=h.updateFullNode(l.getNode(),n,null);else if(h.filtersNodes()&&!l.isFiltered()){const f=l.getNode().updateChild(t,n);c=h.updateFullNode(l.getNode(),f,null)}else{const f=H(t);if(!l.isCompleteForPath(t)&&lt(t)>1)return e;const m=te(t),g=l.getNode().getImmediateChild(f).updateChild(m,n);f===".priority"?c=h.updatePriority(l.getNode(),g):c=h.updateChild(l.getNode(),f,g,m,_0,null)}const d=f0(e,c,l.isFullyInitialized()||q(t),h.filtersNodes()),u=new Gs(r,d,s);return y0(i,d,t,r,u,a)}function gs(i,e,t,n,r,s,o){const a=e.eventCache;let l,c;const h=new Gs(r,e,s);if(q(t))c=i.filter.updateFullNode(e.eventCache.getNode(),n,o),l=Tn(e,c,!0,i.filter.filtersNodes());else{const d=H(t);if(d===".priority")c=i.filter.updatePriority(e.eventCache.getNode(),n),l=Tn(e,c,a.isFullyInitialized(),a.isFiltered());else{const u=te(t),f=a.getNode().getImmediateChild(d);let m;if(q(u))m=n;else{const v=h.getCompleteChild(d);v!=null?Ps(u)===".priority"&&v.getChild(r0(u)).isEmpty()?m=v:m=v.updateChild(u,n):m=M.EMPTY_NODE}if(f.equals(m))l=e;else{const v=i.filter.updateChild(a.getNode(),d,m,u,h,o);l=Tn(e,v,a.isFullyInitialized(),i.filter.filtersNodes())}}}return l}function da(i,e){return i.eventCache.isCompleteForChild(e)}function vd(i,e,t,n,r,s,o){let a=e;return n.foreach((l,c)=>{const h=se(t,l);da(e,H(h))&&(a=gs(i,a,h,c,r,s,o))}),n.foreach((l,c)=>{const h=se(t,l);da(e,H(h))||(a=gs(i,a,h,c,r,s,o))}),a}function fa(i,e,t){return t.foreach((n,r)=>{e=e.updateChild(n,r)}),e}function vs(i,e,t,n,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;q(t)?c=n:c=new ee(null).setTree(t,n);const h=e.serverCache.getNode();return c.children.inorderTraversal((d,u)=>{if(h.hasChild(d)){const f=e.serverCache.getNode().getImmediateChild(d),m=fa(i,f,u);l=Di(i,l,new X(d),m,r,s,o,a)}}),c.children.inorderTraversal((d,u)=>{const f=!e.serverCache.isCompleteForChild(d)&&u.value===null;if(!h.hasChild(d)&&!f){const m=e.serverCache.getNode().getImmediateChild(d),v=fa(i,m,u);l=Di(i,l,new X(d),v,r,s,o,a)}}),l}function _d(i,e,t,n,r,s,o){if(Ci(r,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(n.value!=null){if(q(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Di(i,e,t,l.getNode().getChild(t),r,s,a,o);if(q(t)){let c=new ee(null);return l.getNode().forEachChild(qt,(h,d)=>{c=c.set(new X(h),d)}),vs(i,e,t,c,r,s,a,o)}else return e}else{let c=new ee(null);return n.foreach((h,d)=>{const u=se(t,h);l.isCompleteForPath(u)&&(c=c.set(h,l.getNode().getChild(u)))}),vs(i,e,t,c,r,s,a,o)}}function yd(i,e,t,n,r){const s=e.serverCache,o=f0(e,s.getNode(),s.isFullyInitialized()||q(t),s.isFiltered());return y0(i,o,t,n,_0,r)}function wd(i,e,t,n,r,s){let o;if(Ci(n,t)!=null)return e;{const a=new Gs(n,e,r),l=e.eventCache.getNode();let c;if(q(t)||H(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=wi(n,At(e));else{const d=e.serverCache.getNode();P(d instanceof M,"serverChildren would be complete if leaf node"),h=Vs(n,d)}h=h,c=i.filter.updateFullNode(l,h,s)}else{const h=H(t);let d=qs(n,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?c=i.filter.updateChild(l,h,d,te(t),a,s):e.eventCache.getNode().hasChild(h)?c=i.filter.updateChild(l,h,M.EMPTY_NODE,te(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=wi(n,At(e)),o.isLeafNode()&&(c=i.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||Ci(n,Y())!=null,Tn(e,c,o,i.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Ms(n.getIndex()),s=Uu(n);this.processor_=md(s);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(M.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(M.EMPTY_NODE,a.getNode(),null),h=new ht(l,o.isFullyInitialized(),r.filtersNodes()),d=new ht(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=$i(d,h),this.eventGenerator_=new Yu(this.query_)}get query(){return this.query_}}function Dd(i){return i.viewCache_.serverCache.getNode()}function Ed(i){return yi(i.viewCache_)}function bd(i,e){const t=At(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!q(e)&&!t.getImmediateChild(H(e)).isEmpty())?t.getChild(e):null}function ma(i){return i.eventRegistrations_.length===0}function Ad(i,e){i.eventRegistrations_.push(e)}function pa(i,e,t){const n=[];if(t){P(e==null,"A cancel should cancel all event registrations.");const r=i.query._path;i.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,r);o&&n.push(o)})}if(e){let r=[];for(let s=0;s<i.eventRegistrations_.length;++s){const o=i.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(i.eventRegistrations_.slice(s+1));break}}i.eventRegistrations_=r}else i.eventRegistrations_=[];return n}function xa(i,e,t,n){e.type===Ne.MERGE&&e.source.queryId!==null&&(P(At(i.viewCache_),"We should always have a full cache before handling merges"),P(yi(i.viewCache_),"Missing event cache, even though we have a server cache"));const r=i.viewCache_,s=xd(i.processor_,r,e,t,n);return pd(i.processor_,s.viewCache),P(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=s.viewCache,w0(i,s.changes,s.viewCache.eventCache.getNode(),null)}function kd(i,e){const t=i.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(oe,(s,o)=>{n.push(Xt(s,o))}),t.isFullyInitialized()&&n.push(u0(t.getNode())),w0(i,n,t.getNode(),e)}function w0(i,e,t,n){const r=n?[n]:i.eventRegistrations_;return Ku(i.eventGenerator_,e,t,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ei;class C0{constructor(){this.views=new Map}}function Td(i){P(!Ei,"__referenceConstructor has already been defined"),Ei=i}function Id(){return P(Ei,"Reference.ts has not been loaded"),Ei}function Sd(i){return i.views.size===0}function $s(i,e,t,n){const r=e.source.queryId;if(r!==null){const s=i.views.get(r);return P(s!=null,"SyncTree gave us an op for an invalid query."),xa(s,e,t,n)}else{let s=[];for(const o of i.views.values())s=s.concat(xa(o,e,t,n));return s}}function D0(i,e,t,n,r){const s=e._queryIdentifier,o=i.views.get(s);if(!o){let a=wi(t,r?n:null),l=!1;a?l=!0:n instanceof M?(a=Vs(t,n),l=!1):(a=M.EMPTY_NODE,l=!1);const c=$i(new ht(a,l,!1),new ht(n,r,!1));return new Cd(e,c)}return o}function Bd(i,e,t,n,r,s){const o=D0(i,e,n,r,s);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,o),Ad(o,t),kd(o,t)}function Fd(i,e,t,n){const r=e._queryIdentifier,s=[];let o=[];const a=ut(i);if(r==="default")for(const[l,c]of i.views.entries())o=o.concat(pa(c,t,n)),ma(c)&&(i.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const l=i.views.get(r);l&&(o=o.concat(pa(l,t,n)),ma(l)&&(i.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!ut(i)&&s.push(new(Id())(e._repo,e._path)),{removed:s,events:o}}function E0(i){const e=[];for(const t of i.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function at(i,e){let t=null;for(const n of i.views.values())t=t||bd(n,e);return t}function b0(i,e){if(e._queryParams.loadsAllData())return Yi(i);{const n=e._queryIdentifier;return i.views.get(n)}}function A0(i,e){return b0(i,e)!=null}function ut(i){return Yi(i)!=null}function Yi(i){for(const e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bi;function Pd(i){P(!bi,"__referenceConstructor has already been defined"),bi=i}function Nd(){return P(bi,"Reference.ts has not been loaded"),bi}let Od=1;class ga{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ee(null),this.pendingWriteTree_=hd(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function k0(i,e,t,n,r){return Zu(i.pendingWriteTree_,e,t,n,r),r?hn(i,new bt(Ws(),e,t)):[]}function Rd(i,e,t,n){ju(i.pendingWriteTree_,e,t,n);const r=ee.fromObject(t);return hn(i,new Zt(Ws(),e,r))}function st(i,e,t=!1){const n=ed(i.pendingWriteTree_,e);if(td(i.pendingWriteTree_,e)){let s=new ee(null);return n.snap!=null?s=s.set(Y(),!0):fe(n.children,o=>{s=s.set(new X(o),!0)}),hn(i,new _i(n.path,s,t))}else return[]}function Yn(i,e,t){return hn(i,new bt(Us(),e,t))}function Md(i,e,t){const n=ee.fromObject(t);return hn(i,new Zt(Us(),e,n))}function Ld(i,e){return hn(i,new Wn(Us(),e))}function Wd(i,e,t){const n=Ys(i,t);if(n){const r=Ks(n),s=r.path,o=r.queryId,a=pe(s,e),l=new Wn(Hs(o),a);return Js(i,s,l)}else return[]}function Ai(i,e,t,n,r=!1){const s=e._path,o=i.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||A0(o,e))){const l=Fd(o,e,t,n);Sd(o)&&(i.syncPointTree_=i.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!r){const h=c.findIndex(u=>u._queryParams.loadsAllData())!==-1,d=i.syncPointTree_.findOnPath(s,(u,f)=>ut(f));if(h&&!d){const u=i.syncPointTree_.subtree(s);if(!u.isEmpty()){const f=Vd(u);for(let m=0;m<f.length;++m){const v=f[m],g=v.query,w=B0(i,v);i.listenProvider_.startListening(Sn(g),Un(i,g),w.hashFn,w.onComplete)}}}!d&&c.length>0&&!n&&(h?i.listenProvider_.stopListening(Sn(e),null):c.forEach(u=>{const f=i.queryToTagMap.get(Ki(u));i.listenProvider_.stopListening(Sn(u),f)}))}qd(i,c)}return a}function T0(i,e,t,n){const r=Ys(i,n);if(r!=null){const s=Ks(r),o=s.path,a=s.queryId,l=pe(o,e),c=new bt(Hs(a),l,t);return Js(i,o,c)}else return[]}function Ud(i,e,t,n){const r=Ys(i,n);if(r){const s=Ks(r),o=s.path,a=s.queryId,l=pe(o,e),c=ee.fromObject(t),h=new Zt(Hs(a),l,c);return Js(i,o,h)}else return[]}function _s(i,e,t,n=!1){const r=e._path;let s=null,o=!1;i.syncPointTree_.foreachOnPath(r,(u,f)=>{const m=pe(u,r);s=s||at(f,m),o=o||ut(f)});let a=i.syncPointTree_.get(r);a?(o=o||ut(a),s=s||at(a,Y())):(a=new C0,i.syncPointTree_=i.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=M.EMPTY_NODE,i.syncPointTree_.subtree(r).foreachChild((f,m)=>{const v=at(m,Y());v&&(s=s.updateImmediateChild(f,v))}));const c=A0(a,e);if(!c&&!e._queryParams.loadsAllData()){const u=Ki(e);P(!i.queryToTagMap.has(u),"View does not exist, but we have a tag");const f=Gd();i.queryToTagMap.set(u,f),i.tagToQueryMap.set(f,u)}const h=zi(i.pendingWriteTree_,r);let d=Bd(a,e,t,h,s,l);if(!c&&!o&&!n){const u=b0(a,e);d=d.concat($d(i,e,u))}return d}function zs(i,e,t){const r=i.pendingWriteTree_,s=i.syncPointTree_.findOnPath(e,(o,a)=>{const l=pe(o,e),c=at(a,l);if(c)return c});return x0(r,e,s,t,!0)}function Hd(i,e){const t=e._path;let n=null;i.syncPointTree_.foreachOnPath(t,(c,h)=>{const d=pe(c,t);n=n||at(h,d)});let r=i.syncPointTree_.get(t);r?n=n||at(r,Y()):(r=new C0,i.syncPointTree_=i.syncPointTree_.set(t,r));const s=n!=null,o=s?new ht(n,!0,!1):null,a=zi(i.pendingWriteTree_,e._path),l=D0(r,e,a,s?o.getNode():M.EMPTY_NODE,s);return Ed(l)}function hn(i,e){return I0(e,i.syncPointTree_,null,zi(i.pendingWriteTree_,Y()))}function I0(i,e,t,n){if(q(i.path))return S0(i,e,t,n);{const r=e.get(Y());t==null&&r!=null&&(t=at(r,Y()));let s=[];const o=H(i.path),a=i.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,h=g0(n,o);s=s.concat(I0(a,l,c,h))}return r&&(s=s.concat($s(r,i,n,t))),s}}function S0(i,e,t,n){const r=e.get(Y());t==null&&r!=null&&(t=at(r,Y()));let s=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=g0(n,o),h=i.operationForChild(o);h&&(s=s.concat(S0(h,a,l,c)))}),r&&(s=s.concat($s(r,i,n,t))),s}function B0(i,e){const t=e.query,n=Un(i,t);return{hashFn:()=>(Dd(e)||M.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return n?Wd(i,t._path,n):Ld(i,t._path);{const s=Lh(r,t);return Ai(i,t,null,s)}}}}function Un(i,e){const t=Ki(e);return i.queryToTagMap.get(t)}function Ki(i){return i._path.toString()+"$"+i._queryIdentifier}function Ys(i,e){return i.tagToQueryMap.get(e)}function Ks(i){const e=i.indexOf("$");return P(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new X(i.substr(0,e))}}function Js(i,e,t){const n=i.syncPointTree_.get(e);P(n,"Missing sync point for query tag that we're tracking");const r=zi(i.pendingWriteTree_,e);return $s(n,t,r,null)}function Vd(i){return i.fold((e,t,n)=>{if(t&&ut(t))return[Yi(t)];{let r=[];return t&&(r=E0(t)),fe(n,(s,o)=>{r=r.concat(o)}),r}})}function Sn(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(Nd())(i._repo,i._path):i}function qd(i,e){for(let t=0;t<e.length;++t){const n=e[t];if(!n._queryParams.loadsAllData()){const r=Ki(n),s=i.queryToTagMap.get(r);i.queryToTagMap.delete(r),i.tagToQueryMap.delete(s)}}}function Gd(){return Od++}function $d(i,e,t){const n=e._path,r=Un(i,e),s=B0(i,t),o=i.listenProvider_.startListening(Sn(e),r,s.hashFn,s.onComplete),a=i.syncPointTree_.subtree(n);if(r)P(!ut(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,d)=>{if(!q(c)&&h&&ut(h))return[Yi(h).query];{let u=[];return h&&(u=u.concat(E0(h).map(f=>f.query))),fe(d,(f,m)=>{u=u.concat(m)}),u}});for(let c=0;c<l.length;++c){const h=l[c];i.listenProvider_.stopListening(Sn(h),Un(i,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Qs(t)}node(){return this.node_}}class Xs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=se(this.path_,e);return new Xs(this.syncTree_,t)}node(){return zs(this.syncTree_,this.path_)}}const zd=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},va=function(i,e,t){if(!i||typeof i!="object")return i;if(P(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return Yd(i[".sv"],e,t);if(typeof i[".sv"]=="object")return Kd(i[".sv"],e);P(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},Yd=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:P(!1,"Unexpected server value: "+i)}},Kd=function(i,e,t){i.hasOwnProperty("increment")||P(!1,"Unexpected server value: "+JSON.stringify(i,null,2));const n=i.increment;typeof n!="number"&&P(!1,"Unexpected increment value: "+n);const r=e.node();if(P(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return n;const o=r.getValue();return typeof o!="number"?n:o+n},F0=function(i,e,t,n){return Zs(e,new Xs(t,i),n)},P0=function(i,e,t){return Zs(i,new Qs(e),t)};function Zs(i,e,t){const n=i.getPriority().val(),r=va(n,e.getImmediateChild(".priority"),t);let s;if(i.isLeafNode()){const o=i,a=va(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new le(a,ae(r)):i}else{const o=i;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new le(r))),o.forEachChild(oe,(a,l)=>{const c=Zs(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function eo(i,e){let t=e instanceof X?e:new X(e),n=i,r=H(t);for(;r!==null;){const s=Jt(n.node.children,r)||{children:{},childCount:0};n=new js(r,n,s),t=te(t),r=H(t)}return n}function un(i){return i.node.value}function N0(i,e){i.node.value=e,ys(i)}function O0(i){return i.node.childCount>0}function Jd(i){return un(i)===void 0&&!O0(i)}function Ji(i,e){fe(i.node.children,(t,n)=>{e(new js(t,i,n))})}function R0(i,e,t,n){t&&!n&&e(i),Ji(i,r=>{R0(r,e,!0,n)}),t&&n&&e(i)}function Qd(i,e,t){let n=t?i:i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function Kn(i){return new X(i.parent===null?i.name:Kn(i.parent)+"/"+i.name)}function ys(i){i.parent!==null&&Xd(i.parent,i.name,i)}function Xd(i,e,t){const n=Jd(t),r=Ue(i.node.children,e);n&&r?(delete i.node.children[e],i.node.childCount--,ys(i)):!n&&!r&&(i.node.children[e]=t.node,i.node.childCount++,ys(i))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd=/[\[\].#$\/\u0000-\u001F\u007F]/,jd=/[\[\].#$\u0000-\u001F\u007F]/,xr=10*1024*1024,to=function(i){return typeof i=="string"&&i.length!==0&&!Zd.test(i)},M0=function(i){return typeof i=="string"&&i.length!==0&&!jd.test(i)},ef=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),M0(i)},tf=function(i){return i===null||typeof i=="string"||typeof i=="number"&&!Ts(i)||i&&typeof i=="object"&&Ue(i,".sv")},nf=function(i,e,t,n){n&&e===void 0||Qi(Vi(i,"value"),e,t)},Qi=function(i,e,t){const n=t instanceof X?new vu(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+xt(n));if(typeof e=="function")throw new Error(i+"contains a function "+xt(n)+" with contents = "+e.toString());if(Ts(e))throw new Error(i+"contains "+e.toString()+" "+xt(n));if(typeof e=="string"&&e.length>xr/3&&Hi(e)>xr)throw new Error(i+"contains a string greater than "+xr+" utf8 bytes "+xt(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(fe(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!to(o)))throw new Error(i+" contains an invalid key ("+o+") "+xt(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);_u(n,o),Qi(i,a,n),yu(n)}),r&&s)throw new Error(i+' contains ".value" child '+xt(n)+" in addition to actual children.")}},rf=function(i,e){let t,n;for(t=0;t<e.length;t++){n=e[t];const s=On(n);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!to(s[o]))throw new Error(i+"contains an invalid key ("+s[o]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(gu);let r=null;for(t=0;t<e.length;t++){if(n=e[t],r!==null&&Te(r,n))throw new Error(i+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}},sf=function(i,e,t,n){if(n&&e===void 0)return;const r=Vi(i,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const s=[];fe(e,(o,a)=>{const l=new X(o);if(Qi(r,a,se(t,l)),Ps(l)===".priority"&&!tf(a))throw new Error(r+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),rf(r,s)},L0=function(i,e,t,n){if(!(n&&t===void 0)&&!M0(t))throw new Error(Vi(i,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},of=function(i,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),L0(i,e,t,n)},W0=function(i,e){if(H(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},af=function(i,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!to(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!ef(t))throw new Error(Vi(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Xi(i,e){let t=null;for(let n=0;n<e.length;n++){const r=e[n],s=r.getPath();t!==null&&!Ns(s,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&i.eventLists_.push(t)}function U0(i,e,t){Xi(i,t),H0(i,n=>Ns(n,e))}function Se(i,e,t){Xi(i,t),H0(i,n=>Te(n,e)||Te(e,n))}function H0(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){const r=i.eventLists_[n];if(r){const s=r.path;e(s)?(lf(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function lf(i){for(let e=0;e<i.events.length;e++){const t=i.events[e];if(t!==null){i.events[e]=null;const n=t.getEventRunner();Ct&&de("event: "+t.toString()),ln(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hf="repo_interrupt",uf=25;class df{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new cf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=vi(),this.transactionQueueTree_=new js,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ff(i,e,t){if(i.stats_=Bs(i.repoInfo_),i.forceRestClient_||Vh())i.server_=new gi(i.repoInfo_,(n,r,s,o)=>{_a(i,n,r,s,o)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>ya(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ce(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new Qe(i.repoInfo_,e,(n,r,s,o)=>{_a(i,n,r,s,o)},n=>{ya(i,n)},n=>{pf(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=Yh(i.repoInfo_,()=>new zu(i.stats_,i.server_)),i.infoData_=new Hu,i.infoSyncTree_=new ga({startListening:(n,r,s,o)=>{let a=[];const l=i.infoData_.getNode(n._path);return l.isEmpty()||(a=Yn(i.infoSyncTree_,n._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),no(i,"connected",!1),i.serverSyncTree_=new ga({startListening:(n,r,s,o)=>(i.server_.listen(n,s,r,(a,l)=>{const c=o(a,l);Se(i.eventQueue_,n._path,c)}),[]),stopListening:(n,r)=>{i.server_.unlisten(n,r)}})}function mf(i){const t=i.infoData_.getNode(new X(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Zi(i){return zd({timestamp:mf(i)})}function _a(i,e,t,n,r){i.dataUpdateCount++;const s=new X(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(n){const l=ui(t,c=>ae(c));o=Ud(i.serverSyncTree_,s,l,r)}else{const l=ae(t);o=T0(i.serverSyncTree_,s,l,r)}else if(n){const l=ui(t,c=>ae(c));o=Md(i.serverSyncTree_,s,l)}else{const l=ae(t);o=Yn(i.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=en(i,s)),Se(i.eventQueue_,a,o)}function ya(i,e){no(i,"connected",e),e===!1&&_f(i)}function pf(i,e){fe(e,(t,n)=>{no(i,t,n)})}function no(i,e,t){const n=new X("/.info/"+e),r=ae(t);i.infoData_.updateSnapshot(n,r);const s=Yn(i.infoSyncTree_,n,r);Se(i.eventQueue_,n,s)}function io(i){return i.nextWriteId_++}function xf(i,e,t){const n=Hd(i.serverSyncTree_,e);return n!=null?Promise.resolve(n):i.server_.get(e).then(r=>{const s=ae(r).withIndex(e._queryParams.getIndex());_s(i.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Yn(i.serverSyncTree_,e._path,s);else{const a=Un(i.serverSyncTree_,e);o=T0(i.serverSyncTree_,e._path,s,a)}return Se(i.eventQueue_,e._path,o),Ai(i.serverSyncTree_,e,t,null,!0),s},r=>(Jn(i,"get for query "+ce(e)+" failed: "+r),Promise.reject(new Error(r))))}function gf(i,e,t,n,r){Jn(i,"set",{path:e.toString(),value:t,priority:n});const s=Zi(i),o=ae(t,n),a=zs(i.serverSyncTree_,e),l=P0(o,a,s),c=io(i),h=k0(i.serverSyncTree_,e,l,c,!0);Xi(i.eventQueue_,h),i.server_.put(e.toString(),o.val(!0),(u,f)=>{const m=u==="ok";m||xe("set at "+e+" failed: "+u);const v=st(i.serverSyncTree_,c,!m);Se(i.eventQueue_,e,v),ws(i,r,u,f)});const d=so(i,e);en(i,d),Se(i.eventQueue_,d,[])}function vf(i,e,t,n){Jn(i,"update",{path:e.toString(),value:t});let r=!0;const s=Zi(i),o={};if(fe(t,(a,l)=>{r=!1,o[a]=F0(se(e,a),ae(l),i.serverSyncTree_,s)}),r)de("update() called with empty data.  Don't do anything."),ws(i,n,"ok",void 0);else{const a=io(i),l=Rd(i.serverSyncTree_,e,o,a);Xi(i.eventQueue_,l),i.server_.merge(e.toString(),t,(c,h)=>{const d=c==="ok";d||xe("update at "+e+" failed: "+c);const u=st(i.serverSyncTree_,a,!d),f=u.length>0?en(i,e):e;Se(i.eventQueue_,f,u),ws(i,n,c,h)}),fe(t,c=>{const h=so(i,se(e,c));en(i,h)}),Se(i.eventQueue_,e,[])}}function _f(i){Jn(i,"onDisconnectEvents");const e=Zi(i),t=vi();fs(i.onDisconnect_,Y(),(r,s)=>{const o=F0(r,s,i.serverSyncTree_,e);d0(t,r,o)});let n=[];fs(t,Y(),(r,s)=>{n=n.concat(Yn(i.serverSyncTree_,r,s));const o=so(i,r);en(i,o)}),i.onDisconnect_=vi(),Se(i.eventQueue_,Y(),n)}function yf(i,e,t){let n;H(e._path)===".info"?n=_s(i.infoSyncTree_,e,t):n=_s(i.serverSyncTree_,e,t),U0(i.eventQueue_,e._path,n)}function wa(i,e,t){let n;H(e._path)===".info"?n=Ai(i.infoSyncTree_,e,t):n=Ai(i.serverSyncTree_,e,t),U0(i.eventQueue_,e._path,n)}function wf(i){i.persistentConnection_&&i.persistentConnection_.interrupt(hf)}function Jn(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),de(t,...e)}function ws(i,e,t,n){e&&ln(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let s=r;n&&(s+=": "+n);const o=new Error(s);o.code=r,e(o)}})}function V0(i,e,t){return zs(i.serverSyncTree_,e,t)||M.EMPTY_NODE}function ro(i,e=i.transactionQueueTree_){if(e||ji(i,e),un(e)){const t=G0(i,e);P(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&Cf(i,Kn(e),t)}else O0(e)&&Ji(e,t=>{ro(i,t)})}function Cf(i,e,t){const n=t.map(c=>c.currentWriteId),r=V0(i,e,n);let s=r;const o=r.hash();for(let c=0;c<t.length;c++){const h=t[c];P(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=pe(e,h.path);s=s.updateChild(d,h.currentOutputSnapshotRaw)}const a=s.val(!0),l=e;i.server_.put(l.toString(),a,c=>{Jn(i,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const d=[];for(let u=0;u<t.length;u++)t[u].status=2,h=h.concat(st(i.serverSyncTree_,t[u].currentWriteId)),t[u].onComplete&&d.push(()=>t[u].onComplete(null,!0,t[u].currentOutputSnapshotResolved)),t[u].unwatcher();ji(i,eo(i.transactionQueueTree_,e)),ro(i,i.transactionQueueTree_),Se(i.eventQueue_,e,h);for(let u=0;u<d.length;u++)ln(d[u])}else{if(c==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{xe("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=c}en(i,e)}},o)}function en(i,e){const t=q0(i,e),n=Kn(t),r=G0(i,t);return Df(i,r,n),n}function Df(i,e,t){if(e.length===0)return;const n=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=pe(t,l.path);let h=!1,d;if(P(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,r=r.concat(st(i.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=uf)h=!0,d="maxretry",r=r.concat(st(i.serverSyncTree_,l.currentWriteId,!0));else{const u=V0(i,l.path,o);l.currentInputSnapshot=u;const f=e[a].update(u.val());if(f!==void 0){Qi("transaction failed: Data returned ",f,l.path);let m=ae(f);typeof f=="object"&&f!=null&&Ue(f,".priority")||(m=m.updatePriority(u.getPriority()));const g=l.currentWriteId,w=Zi(i),p=P0(m,u,w);l.currentOutputSnapshotRaw=m,l.currentOutputSnapshotResolved=p,l.currentWriteId=io(i),o.splice(o.indexOf(g),1),r=r.concat(k0(i.serverSyncTree_,l.path,p,l.currentWriteId,l.applyLocally)),r=r.concat(st(i.serverSyncTree_,g,!0))}else h=!0,d="nodata",r=r.concat(st(i.serverSyncTree_,l.currentWriteId,!0))}Se(i.eventQueue_,t,r),r=[],h&&(e[a].status=2,function(u){setTimeout(u,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(d),!1,null))))}ji(i,i.transactionQueueTree_);for(let a=0;a<n.length;a++)ln(n[a]);ro(i,i.transactionQueueTree_)}function q0(i,e){let t,n=i.transactionQueueTree_;for(t=H(e);t!==null&&un(n)===void 0;)n=eo(n,t),e=te(e),t=H(e);return n}function G0(i,e){const t=[];return $0(i,e,t),t.sort((n,r)=>n.order-r.order),t}function $0(i,e,t){const n=un(e);if(n)for(let r=0;r<n.length;r++)t.push(n[r]);Ji(e,r=>{$0(i,r,t)})}function ji(i,e){const t=un(e);if(t){let n=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[n]=t[r],n++);t.length=n,N0(e,t.length>0?t:void 0)}Ji(e,n=>{ji(i,n)})}function so(i,e){const t=Kn(q0(i,e)),n=eo(i.transactionQueueTree_,e);return Qd(n,r=>{gr(i,r)}),gr(i,n),R0(n,r=>{gr(i,r)}),t}function gr(i,e){const t=un(e);if(t){const n=[];let r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(P(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(P(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(st(i.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?N0(e,void 0):t.length=s+1,Se(i.eventQueue_,Kn(e),r);for(let o=0;o<n.length;o++)ln(n[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(i){let e="";const t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let r=t[n];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function bf(i){const e={};i.charAt(0)==="?"&&(i=i.substring(1));for(const t of i.split("&")){if(t.length===0)continue;const n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):xe(`Invalid query segment '${t}' in query '${i}'`)}return e}const Ca=function(i,e){const t=Af(i),n=t.namespace;t.domain==="firebase.com"&&Ze(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Ze("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Ph();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Jc(t.host,t.secure,n,r,e,"",n!==t.subdomain),path:new X(t.pathString)}},Af=function(i){let e="",t="",n="",r="",s="",o=!0,a="https",l=443;if(typeof i=="string"){let c=i.indexOf("//");c>=0&&(a=i.substring(0,c-1),i=i.substring(c+2));let h=i.indexOf("/");h===-1&&(h=i.length);let d=i.indexOf("?");d===-1&&(d=i.length),e=i.substring(0,Math.min(h,d)),h<d&&(r=Ef(i.substring(h,d)));const u=bf(i.substring(Math.min(i.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const m=e.indexOf(".");n=e.substring(0,m).toLowerCase(),t=e.substring(m+1),s=n}"ns"in u&&(s=u.ns)}return{host:e,port:l,domain:t,subdomain:n,secure:o,scheme:a,pathString:r,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ce(this.snapshot.exportVal())}}class Y0{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return P(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return q(this._path)?null:Ps(this._path)}get ref(){return new He(this._repo,this._path)}get _queryIdentifier(){const e=aa(this._queryParams),t=Is(e);return t==="{}"?"default":t}get _queryObject(){return aa(this._queryParams)}isEqual(e){if(e=cn(e),!(e instanceof oo))return!1;const t=this._repo===e._repo,n=Ns(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+xu(this._path)}}class He extends oo{constructor(e,t){super(e,t,new Ls,!1)}get parent(){const e=r0(this._path);return e===null?null:new He(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class tn{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new X(e),n=ki(this.ref,e);return new tn(this._node.getChild(t),n,oe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,r)=>e(new tn(r,ki(this.ref,n),oe)))}hasChild(e){const t=new X(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function mt(i,e){return i=cn(i),i._checkNotDeleted("ref"),e!==void 0?ki(i._root,e):i._root}function ki(i,e){return i=cn(i),H(i._path)===null?of("child","path",e,!1):L0("child","path",e,!1),new He(i._repo,se(i._path,e))}function kf(i){return W0("remove",i._path),J0(i,null)}function J0(i,e){i=cn(i),W0("set",i._path),nf("set",e,i._path,!1);const t=new Ui;return gf(i._repo,i._path,e,null,t.wrapCallback(()=>{})),t.promise}function vr(i,e){sf("update",e,i._path,!1);const t=new Ui;return vf(i._repo,i._path,e,t.wrapCallback(()=>{})),t.promise}function Tf(i){i=cn(i);const e=new K0(()=>{}),t=new er(e);return xf(i._repo,i,t).then(n=>new tn(n,new He(i._repo,i._path),i._queryParams.getIndex()))}class er{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const n=t._queryParams.getIndex();return new z0("value",this,new tn(e.snapshotNode,new He(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Y0(this,e,t):null}matches(e){return e instanceof er?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class ao{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Y0(this,e,t):null}createEvent(e,t){P(e.childName!=null,"Child events should have a childName.");const n=ki(new He(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new z0(e.type,this,new tn(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ao?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function If(i,e,t,n,r){let s;if(typeof n=="object"&&(s=void 0,r=n),typeof n=="function"&&(s=n),r&&r.onlyOnce){const l=t,c=(h,d)=>{wa(i._repo,i,a),l(h,d)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new K0(t,s||void 0),a=e==="value"?new er(o):new ao(e,o);return yf(i._repo,i,a),()=>wa(i._repo,i,a)}function Sf(i,e,t,n){return If(i,"value",e,t,n)}Td(He);Pd(He);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bf="FIREBASE_DATABASE_EMULATOR_HOST",Cs={};let Ff=!1;function Pf(i,e,t,n){i.repoInfo_=new Jc(`${e}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0),n&&(i.authTokenProvider_=n)}function Nf(i,e,t,n,r){let s=n||i.options.databaseURL;s===void 0&&(i.options.projectId||Ze("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),de("Using default host for project ",i.options.projectId),s=`${i.options.projectId}-default-rtdb.firebaseio.com`);let o=Ca(s,r),a=o.repoInfo,l,c;typeof process<"u"&&qo&&(c=qo[Bf]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=Ca(s,r),a=o.repoInfo):l=!o.repoInfo.secure;const h=r&&l?new Vt(Vt.OWNER):new Gh(i.name,i.options,e);af("Invalid Firebase Database URL",o),q(o.path)||Ze("Database URL must point to the root of a Firebase Database (not including a child path).");const d=Rf(a,i,h,new qh(i.name,t));return new Mf(d,i)}function Of(i,e){const t=Cs[e];(!t||t[i.key]!==i)&&Ze(`Database ${e}(${i.repoInfo_}) has already been deleted.`),wf(i),delete t[i.key]}function Rf(i,e,t,n){let r=Cs[e.name];r||(r={},Cs[e.name]=r);let s=r[i.toURLString()];return s&&Ze("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new df(i,Ff,t,n),r[i.toURLString()]=s,s}class Mf{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ff(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new He(this._repo,Y())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Of(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ze("Cannot call "+e+" on a deleted database.")}}function Lf(i=yc(),e){const t=Wl(i,"database").getImmediate({identifier:e});if(!t._instanceStarted){const n=Ul("database");n&&Wf(t,...n)}return t}function Wf(i,e,t,n={}){i=cn(i),i._checkNotDeleted("useEmulator"),i._instanceStarted&&Ze("Cannot call useEmulator() after instance has already been initialized.");const r=i._repoInternal;let s;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&Ze('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Vt(Vt.OWNER);else if(n.mockUserToken){const o=typeof n.mockUserToken=="string"?n.mockUserToken:Hl(n.mockUserToken,i.app.options.projectId);s=new Vt(o)}Pf(r,e,t,s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(i){Th(eh),Vl(new ql("database",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Nf(n,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Oo(Go,$o,i),Oo(Go,$o,"esm2017")}function Da(i){return{".sv":{increment:i}}}Qe.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};Qe.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};Uf();class Hf{_db;constructor(){this._db=Lf()}async getChild({childPath:e}){try{const t=mt(this._db,`${envKey}/${e}`);return await Tf(t)}catch(t){throw t}}async updateChild({childPath:e,data:t}){try{const n=mt(this._db,`${envKey}/${e}`);return await vr(n,t),!0}catch{return!1}}async removeChild({childPath:e}){try{const t=mt(this._db,`${envKey}/${e}`);return await kf(t),!0}catch{return!1}}async incrementNumberChild({childPath:e,valueId:t,delta:n,command:r}){try{r==="decrement"&&(n=-n);const s={[t]:Da(n)},o=mt(this._db,`${envKey}/${e}`);return await vr(o,s),!0}catch{return!1}}async incrementMultipleNumberChild({childPath:e,data:t}){try{const n={};for(const[s,o]of Object.entries(t))n[s]=Da(o);const r=mt(this._db,`${envKey}/${e}`);return await vr(r,n),!0}catch{return!1}}listenToChild({childPath:e,callback:t}){const n=mt(this._db,`${envKey}/${e}`);return Sf(n,t)}async setChild({childPath:e,data:t}){try{const n=mt(this._db,`${envKey}/${e}`);return await J0(n,t),!0}catch{return!1}}}class Vf extends Hf{_firestore;constructor(){nh().length===0?ih(Tl):yc(),super(),this._firestore=Bl()}get getBatch(){return Fl(this._firestore)}async getDocSRV({path:e,docId:t,insideEnviroments:n=!0}){try{const r=ve(this._firestore,n?`${me}/${e}`:e),s=Ce(r,t);return await Pl(s)}catch(r){if(r instanceof Error)throw Le.error(r.message),AppErrorsHelper.GI().addError({error:Errors.serverError,details:r.message}),r}}async getAllDocsInsideCollection(e){try{const t=ve(this._firestore,`${me}/${e}`);return(await Nl(t)).docs.map(r=>r.data())}catch(t){if(t instanceof Error)throw AppErrorsHelper.GI().addError({error:Errors.serverError,details:t.toString()}),t;return[]}}async commmitBatch(e){try{return await e.commit(),!0}catch(t){throw Le.error("Error while commit batch -->",t),t instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:t.toString()}),new Error(`Server Error: ${t}`)}}async runTransaction(e){try{return await Ol(this._firestore,async n=>await e(n))}catch(t){throw console.error("Error while run transaction -->",t),t instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:t.toString()}),new Error(`Server Error: ${t}`)}}async transactionGet(e,t,n){try{const r=ve(this._firestore,`${me}/${t}`),s=Ce(r,n);return await e.get(s)}catch(r){throw console.error("Error while getting document in transaction -->",r),r instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:r.toString()}),new Error(`Server Error: ${r}`)}}async transactionUpdateAsMap({transaction:e,path:t,docId:n,fieldName:r,value:s}){try{const o=ve(this._firestore,`${me}/${t}`),a=Ce(o,n),l={[r]:s||ar()};e.update(a,l)}catch(o){throw Le.error("Error while updating document in transaction -->",o),o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async setAsMap({batch:e,path:t,docId:n,data:r,insideEnviroments:s=!0}){try{const o=ve(this._firestore,s?`${me}/${t}`:t),a=Ce(o,n);e.set(a,r,{merge:!0})}catch(o){throw o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),o}}async transactionUpdateMultipleFieldsAsMap({transaction:e,path:t,docId:n,data:r,insideEnvironments:s=!0}){try{const o=ve(this._firestore,s?`${me}/${t}`:t),a=Ce(o,n),l=this.organizeData(r);e.update(a,l)}catch(o){throw console.error("Error while updating multiple fields in transaction -->",o),o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async transactionCreateDoc({transaction:e,path:t,docId:n,value:r}){try{const s=ve(this._firestore,`${me}/${t}`),o=Ce(s,n);e.set(o,r)}catch(s){throw Le.error("Error while creating document in transaction -->",s),s instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:s.toString()}),new Error(`Server Error: ${s}`)}}async transactionSetAsMap({transaction:e,path:t,docId:n,data:r}){try{const s=ve(this._firestore,`${me}/${t}`),o=Ce(s,n),a=this.organizeData(r);e.set(o,a,{merge:!0})}catch(s){throw Le.error("Error while setting document as map in transaction -->",s),s instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:s.toString()}),new Error(`Server Error: ${s}`)}}async deleteDoc({batch:e,path:t,docId:n}){try{const r=ve(this._firestore,`${me}/${t}`),s=Ce(r,n);e.delete(s)}catch(r){throw r instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:r.toString()}),r}}async setDoc({batch:e,path:t,docId:n,valueToSet:r,insideEnviroments:s=!0}){try{const o=ve(this._firestore,s?`${me}/${t}`:t),a=Ce(o,n);e.set(a,r)}catch(o){throw o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),o}}async createDoc({batch:e,path:t,docId:n,valueAsJson:r,insideEnviroments:s=!0,mergeIfExist:o=!1}){try{const a=o?{merge:!0}:null,l=ve(this._firestore,s?`${me}/${t}`:t),c=Ce(l,n);e.set(c,r,{merge:o})}catch(a){throw a instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:a.toString()}),a}}async updateFieldInsideDocAsMap({batch:e,path:t,docId:n,value:r,fieldName:s,command:o,insideEnviroments:a=!0}){try{const l=ve(this._firestore,a?`${me}/${t}`:t),c=Ce(l,n);o===null?e.update(c,{[s]:r??ar()}):e.update(c,{[s]:o===1?ti(1):ti(-1)})}catch(l){throw l instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:l.toString()}),l}}async updateMultipleFieldsInsideDocAsMap({batch:e,path:t,docId:n,data:r,insideEnviroments:s=!0}){try{const o=ve(this._firestore,s?`${me}/${t}`:t),a=Ce(o,n);e.update(a,this.organizeData(r))}catch(o){throw Le.error("Error while updating the batch -->",o),o instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}docListener({path:e,docId:t,onChanged:n}){try{const r=ve(this._firestore,`${me}/${e}`),s=Ce(r,t);return Rl(s,n)}catch(r){throw r instanceof Error&&AppErrorsHelper.GI().addError({error:Errors.serverError,details:r.message}),r}}organizeData(e){var t={};return Object.entries(e).forEach(([n,r])=>{let s=r;s===null&&(s=ar()),s===1&&(s=ti(1)),s===0&&(s=ti(-1)),t[n]=s}),t}get currentTimestamp(){return ct.now()}}class Q0 extends Vf{constructor(){super()}async getDocRepo({path:e,docId:t,insideEnviroments:n=!0}){return await super.getDocSRV({path:e,docId:t,insideEnviroments:n})}async createDocRepo({path:e,docId:t,valueAsJson:n,insideEnviroments:r=!0,mergeIfExist:s=!1}){const o=this.getBatch;return super.createDoc({batch:o,path:e,docId:t,valueAsJson:n,insideEnviroments:r,mergeIfExist:s}),await this.commmitBatch(o)}async updateFieldInsideDocAsMapRepo({path:e,docId:t,fieldName:n,value:r,insideEnviroments:s=!0,command:o=null}){const a=this.getBatch;return this.updateFieldInsideDocAsMap({batch:a,path:e,docId:t,fieldName:n,value:r,command:o,insideEnviroments:s}),await this.commmitBatch(a)}async updateMultipleFieldsInsideDocAsMapRepo({path:e,docId:t,data:n,insideEnviroments:r=!0}){const s=this.getBatch;return super.updateMultipleFieldsInsideDocAsMap({batch:s,path:e,docId:t,data:n,insideEnviroments:r}),await this.commmitBatch(s)}async deleteDocRepo({path:e,docId:t}){const n=this.getBatch;return super.deleteDoc({batch:n,path:e,docId:t}),await this.commmitBatch(n)}async setDocRepo({path:e,docId:t,valueAsJson:n,insideEnviroments:r=!0}){const s=this.getBatch;return super.setDoc({batch:s,path:e,docId:t,valueToSet:n,insideEnviroments:r}),await this.commmitBatch(s)}async setAsMapWithMergeRepo({path:e,docId:t,valueAsJson:n,insideEnviroments:r=!0}){const s=this.getBatch;return super.setAsMap({batch:s,path:e,docId:t,data:n,insideEnviroments:r}),await this.commmitBatch(s)}docListenerRepo({path:e,docId:t,onChanged:n}){return super.docListener({path:e,docId:t,onChanged:n})}}class Qn{code="";name="";symbol="";constructor({code:e="",name:t="",symbol:n=""}={}){this.code=e,this.name=t,this.symbol=n}static fromJson(e){return new Qn({code:e.code||"",name:e.name||"",symbol:e.symbol||""})}toJson(){return{code:this.code,name:this.name,symbol:this.symbol}}isEqual(e){return e.code===this.code}toString(){return JSON.stringify(this.toJson(),null,2)}}const co=new Qn({code:"USD",name:"US Dollar",symbol:"$"}),ci=5;class lo{static currentBusinesssId="";static hasPaddingFromTop=!1;static paddingFromTop=0;static attemptsLeftForCardPassword=ci;static productionVersion=!0;static developers={}}function qf(i){const e=i.toString(),t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return(t*299+n*587+r*114)/1e3>155}function Ea(i,e){if(i===null)return e===null;if(e===null||i.size!==e.size)return!1;if(i===e)return!0;for(const t of i)if(!e.has(t))return!1;return!0}async function Tx(){return!0}var Gf=(i=>(i[i.light=0]="light",i[i.dark=1]="dark",i))(Gf||{});class Ke{background=0;primary=0;surface=0;inverseSurface=0;tertiary=0;id="";fontName="";themeName="";constructor({background:e=0,primary:t=0,surface:n=0,inverseSurface:r=0,tertiary:s=0,id:o,fontName:a="",themeName:l=""}){this.background=e,this.primary=t,this.surface=n,this.inverseSurface=r,this.tertiary=s,this.id=o,this.fontName=a,this.themeName=l}static fromJson(e,t){return new Ke({background:e.background||0,primary:e.primary||0,id:t,themeName:e.themeName||"",surface:e.surface||0,tertiary:e.tertiary||0,inverseSurface:e.inverseSurface||0,fontName:e.fontName||""})}static fromBusinessTheme(e){return new Ke({themeName:e.themeName,background:e.background,primary:e.primary,tertiary:e.tertiary,id:e.id,surface:e.surface,inverseSurface:e.inverseSurface,fontName:e.fontName})}isEqual(e,t=!0){const n=e.toJson();t&&(n.id=e.id);const r=this.toJson();return t&&(r.id=this.id),JSON.stringify(n)===JSON.stringify(r)}get brightness(){return qf(this.background)?1:0}toJson(){const e={};return this.fontName!==""&&(e.fontName=this.fontName),this.surface!==0&&(e.surface=this.surface),this.inverseSurface!==0&&(e.inverseSurface=this.inverseSurface),e.tertiary=this.tertiary,e.themeName=this.themeName,this.background!==0&&(e.background=this.background),this.primary!==0&&(e.primary=this.primary),e}}var Ge=(i=>(i[i.Grid=0]="Grid",i[i.Carousel=1]="Carousel",i[i.EndlessCarousel=2]="EndlessCarousel",i))(Ge||{});const ba={0:"grid",1:"carousel",2:"endlessCarousel"},Aa={grid:0,carousel:1,endlessCarousel:2},$f={dark:new Ke({fontName:"Varela Round",themeName:"Original",id:"dark",inverseSurface:4279637532,background:4280229673,surface:4280690225,tertiary:4279834916,primary:4294940672}),darkIos:new Ke({fontName:"Varela Round",themeName:"Dark",id:"darkIos",inverseSurface:4281084974,background:4279637528,surface:4280361252,tertiary:4278190080,primary:4278225100}),light:new Ke({fontName:"Varela Round",themeName:"Pink",id:"light",inverseSurface:4294831859,background:4294375158,surface:4294967295,tertiary:4294243315,primary:4294936498}),lightIos:new Ke({fontName:"Varela Round",themeName:"Light",id:"lightIos",inverseSurface:4292664541,background:4294111991,surface:4294967295,tertiary:4293322471,primary:4278221567})};class Oe{id="";token="";constructor(e){e&&(this.id=e.I||"",this.token=e.T||"")}static fromShopIconUrl(e){const t=new Oe;try{const n=e.split("SHOPICON");t.id=n[1].split("?alt")[0];const r=e.split("&token=");return t.token=r[1],t}catch{return new Oe}}static fromJson(e){const t=new Oe;return t.id=e.I||"",t.token=e.T||"",t}static fromJsonStr(e){const t=JSON.parse(e),n=new Oe;return n.id=t.I||"",n.token=t.T||"",n}get isEmpty(){return this.token===""||this.id===""}get isNotEmpty(){return this.token!==""&&this.id!==""}isEqual(e){return e.id==this.id&&e.token==this.token}getShopIconPath(e){return this.token===""||this.id===""?"":`https://firebasestorage.googleapis.com/v0/b/managementsystemapp-c1fda.appspot.com/o/enviroments%2F${me.replace("enviroments/","")}%2F${e}%2Fimages%2Flogos%2FSHOPICON${this.id}?alt=media&token=${this.token}`}toJsonStr(){const e={I:this.id,T:this.token};return JSON.stringify(e)}toJson(){return{I:this.id,T:this.token}}}class Gt{amount=0;currency=co;constructor({amount:e,currency:t}){const n=parseFloat(e)||0;this.amount=parseFloat(n.toFixed(2)),this.currency=t}static fromJson(e){const t=new Gt({amount:"0.0",currency:Qn.fromJson(e.currency)});return e.amount!=null&&(t.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),t}add(e){e.currency.code===this.currency.code&&(this.amount+=e.amount)}isEqual(e){return this.amount===e.amount&&this.currency.code===e.currency.code}toString(){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.currency.code}).format(this.amount)}toJson(){return{amount:this.amount,currency:this.currency.toJson()}}}class nn{description="";price;imageUrl="";id="";name="";createdAt=new Date;constructor({name:e="",description:t="",id:n="",price:r,imageUrl:s=""}={}){this.name=e||"",this.description=t||"",this.id=n||"",this.price=r,this.imageUrl=s||""}static fromProduct(e){const t=new nn({id:e.id,description:e.description,price:e.price,imageUrl:e.imageUrl,name:e.name});return t.createdAt=e.createdAt,t}static fromJson(e,t){const n=new nn({id:t,description:e.description,price:Gt.fromJson(e.price),imageUrl:e.imageUrl,name:e.name});return n.createdAt=e.createdAt,n}toJson(){return{description:this.description,price:this.price?this.price.toJson():null,imageUrl:this.imageUrl,name:this.name,createdAt:this.createdAt}}toString(){return JSON.stringify(this.toJson())}}class rn{title="";content="";lastModified="";index="";id="";popOnEnter=!1;constructor(e,t,n,r,s,o=!1){this.title=e,this.content=t,this.id=n,this.lastModified=r,this.index=s,this.popOnEnter=o}static fromJson(e,t){return new rn(e.title??"",e.content??"",e.id??"",e.lastModified??"",t,e.popOnEnter??!1)}static fromUpdate(e){return new rn(e.title,e.content,e.id,e.lastModified,e.index,e.popOnEnter)}toJson(){const e={};return e.title=this.title,e.id=this.id,e.content=this.content,this.lastModified!==""&&(e.lastModified=this.lastModified),this.popOnEnter&&(e.popOnEnter=this.popOnEnter),e}isValid(){return this.title!==""&&this.content!==""}toString(){return JSON.stringify(this,null,2)}}class Je{storyView=Ge.Grid;productView=Ge.Grid;changingImages=[];products=new Map;updates=new Map;storyTitle="";shopIconUrl="";productsTitle="";bottomIcons=!1;changingImagesSwapSeconds=6;pickedThemeKey="darkIos";lastTimeToUpdateTerm=new Date(0);businessThemes=new Map;term="";mustConfirmTerm=!1;popTermOnFirstEneter=!1;isPrivateTheme=!1;constructor({storyView:e=Ge.Grid,productView:t=Ge.Grid,changingImagesSwapSeconds:n=6,shopIconUrl:r="",pickedThemeKey:s="darkIos"}={}){this.changingImagesSwapSeconds=n,this.shopIconUrl=r,this.pickedThemeKey=s}static fromJson(e){const t=new Je;return Object.entries(e.products).forEach(([n,r])=>{t.products.set(n,nn.fromJson(r,n))}),e.changingImages&&(t.changingImages=e.changingImages.map(n=>n)),e.updates&&Object.entries(e.updates).forEach(([n,r])=>{t.updates.set(n,rn.fromJson(r,n))}),e.storyView&&(t.storyView=Aa[e.storyView]||Ge.EndlessCarousel),e.productView&&(t.productView=Aa[e.productView]||Ge.Grid),e.businessThemes&&Object.entries(e.businessThemes).forEach(([n,r])=>{t.businessThemes.set(n,Ke.fromJson(r,n))}),e.lastTimeToUpdateTerm&&(t.lastTimeToUpdateTerm=new Date(e.lastTimeToUpdateTerm)||new Date(0)),t.pickedThemeKey=e.pickedThemeKey||"darkIoss",t.term=e.term||"",t.bottomIcons=e.bottomIcons||!1,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds||6,t.productsTitle=e.productsTitle||"",t.storyTitle=e.storyTitle||"",t.shopIconUrl=e.shopIcon||"",t.mustConfirmTerm=e.mustConfirmTerm||!1,t.popTermOnFirstEneter=e.popTermOnFirstEneter||!1,t.isPrivateTheme=e.isPrivateTheme||!1,t}get shopIconData(){return Oe.fromShopIconUrl(this.shopIconUrl)}static fromBusinessDesign(e){const t=new Je;return e.products.forEach((n,r)=>{t.products.set(r,nn.fromProduct(n))}),t.changingImages=[...e.changingImages],e.updates.forEach((n,r)=>{t.updates.set(r,rn.fromUpdate(n))}),t.storyView=e.storyView,e.businessThemes.forEach((n,r)=>{t.businessThemes.set(r,Ke.fromBusinessTheme(n))}),t.shopIconUrl=e.shopIconUrl,t.pickedThemeKey=e.pickedThemeKey,t.lastTimeToUpdateTerm=e.lastTimeToUpdateTerm,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds,t.term=e.term,t.bottomIcons=e.bottomIcons,t.productsTitle=e.productsTitle,t.productView=e.productView,t.storyTitle=e.storyTitle,t.mustConfirmTerm=e.mustConfirmTerm,t.popTermOnFirstEneter=e.popTermOnFirstEneter,t.isPrivateTheme=e.isPrivateTheme,t}toJson(){const e={};return this.storyView!==Ge.EndlessCarousel&&(e.storyView=ba[this.storyView]),this.productView!==Ge.Grid&&(e.productView=ba[this.storyView]),e.changingImages=this.changingImages,e.products={},this.products.forEach((t,n)=>{e.products[n]=t.toJson()}),e.updates={},this.updates.forEach((t,n)=>{e.updates[n]=t.toJson()}),this.mustConfirmTerm&&(e.mustConfirmTerm=this.mustConfirmTerm),this.popTermOnFirstEneter&&(e.popTermOnFirstEneter=this.popTermOnFirstEneter),this.term!==""&&(e.term=this.term),this.lastTimeToUpdateTerm!==new Date(0)&&(e.lastTimeToUpdateTerm=this.lastTimeToUpdateTerm.toISOString()),e.bottomIcons=this.bottomIcons,e.changingImagesSwapSeconds=this.changingImagesSwapSeconds,e.storyTitle=this.storyTitle,e.productsTitle=this.productsTitle,e.businessThemes={},this.businessThemes.forEach((t,n)=>{$f.hasOwnProperty(n)||(e.businessThemes[n]=t.toJson())}),e.pickedThemeKey=this.pickedThemeKey,e.shopIcon=this.shopIconUrl,e.isPrivateTheme=this.isPrivateTheme,e}}class Ti{businessId="";shopIcon=new Oe;businessName="";constructor({businessId:e="",businessName:t="",shopIcon:n=new Oe}={}){this.businessId=e,this.shopIcon=n,this.businessName=t}static empty(){return new Ti}static fromJsonStr(e){const t=JSON.parse(e),n=Ti.empty();return n.businessId=t.businessId,n.businessName=t.businessName,t.shopIcon&&(n.shopIcon=Oe.fromJsonStr(t.shopIcon)),n}toJsonStr(){const e={businessId:this.businessId,shopIcon:this.shopIcon.toJsonStr(),businessName:this.businessName};return JSON.stringify(e)}}var $t=(i=>(i[i.Barber=0]="Barber",i[i.Polish=1]="Polish",i[i.Beautician=2]="Beautician",i[i.ManicurePedicure=3]="ManicurePedicure",i[i.Eyelashes=4]="Eyelashes",i[i.Eyebrows=5]="Eyebrows",i[i.Braids=6]="Braids",i[i.MakeUpArtist=7]="MakeUpArtist",i[i.TattooArtist=8]="TattooArtist",i[i.HairRemoval=9]="HairRemoval",i[i.Masseur=10]="Masseur",i[i.Physiotherapy=11]="Physiotherapy",i[i.Cobblers=12]="Cobblers",i[i.Clown=13]="Clown",i[i.SocialWorker=14]="SocialWorker",i[i.Magician=15]="Magician",i[i.Doctor=16]="Doctor",i[i.Veterinarian=17]="Veterinarian",i[i.CommunicationTherapist=18]="CommunicationTherapist",i[i.DogGroomer=19]="DogGroomer",i[i.DJ=20]="DJ",i[i.Psychologist=21]="Psychologist",i[i.Tutor=22]="Tutor",i[i.WeddingDresses=23]="WeddingDresses",i[i.DanceTeacher=24]="DanceTeacher",i[i.Babysitter=25]="Babysitter",i[i.Reflexologist=26]="Reflexologist",i[i.Dietitian=27]="Dietitian",i[i.CarWash=28]="CarWash",i[i.Photographer=29]="Photographer",i[i.SwimmingTeacher=30]="SwimmingTeacher",i[i.Counselor=31]="Counselor",i[i.Mentor=32]="Mentor",i[i.TennisCoach=33]="TennisCoach",i[i.PrivateChef=34]="PrivateChef",i[i.PersonalTrainer=35]="PersonalTrainer",i[i.Lawyer=36]="Lawyer",i[i.Sales=37]="Sales",i[i.RealEstate=38]="RealEstate",i[i.DrivingTeacher=39]="DrivingTeacher",i[i.InvestmentAdvice=40]="InvestmentAdvice",i[i.Library=41]="Library",i[i.Tailor=42]="Tailor",i[i.Restaurant=43]="Restaurant",i[i.NailConstruction=44]="NailConstruction",i[i.Dentist=45]="Dentist",i[i.BeautysSalon=46]="BeautysSalon",i[i.Washer=47]="Washer",i[i.CleaningSofas=48]="CleaningSofas",i[i.Other=49]="Other",i))($t||{});const zf={0:"barber",1:"polish",48:"cleaningSofas",2:"beautician",3:"manicurePedicure",4:"eyelashes",5:"eyebrows",25:"babysitter",6:"braids",7:"makeUpArtist",8:"tattooArtist",9:"hairRemoval",10:"masseur",12:"cobblers",13:"clown",14:"socialWorker",15:"magician",16:"doctor",20:"dj",17:"veterinarian",18:"communicationTherapist",19:"dogGroomer",21:"psychologist",11:"physiotherapy",22:"Tutor",23:"weddingDresses",24:"danceTeacher",26:"reflexologist",27:"dietitian",28:"carWash",29:"photographer",30:"swimmingTeacher",31:"counselor",32:"mentor",33:"tennisCoach",34:"privateChef",35:"personalTrainer",36:"lawyer",37:"sales",38:"realEstate",39:"drivingTeacher",40:"investmentAdvice",41:"library",49:"other",42:"tailor",43:"restaurant",44:"nailConstruction",45:"dentist",46:"beautysSalon",47:"washer"},X0={barber:0,cleaningSofas:48,polish:1,beautician:2,manicurePedicure:3,eyelashes:4,eyebrows:5,babysitter:25,braids:6,makeUpArtist:7,tattooArtist:8,hairRemoval:9,masseur:10,cobblers:12,clown:13,socialWorker:14,magician:15,doctor:16,veterinarian:17,communicationTherapist:18,dogGroomer:19,psychologist:21,physiotherapy:11,Tutor:22,weddingDresses:23,danceTeacher:24,reflexologist:26,dietitian:27,carWash:28,photographer:29,swimmingTeacher:30,counselor:31,mentor:32,dj:20,tennisCoach:33,privateChef:34,personalTrainer:35,lawyer:36,sales:37,realEstate:38,drivingTeacher:39,investmentAdvice:40,library:41,other:49,restaurant:43,tailor:42,nailConstruction:44,dentist:45,beautysSalon:46,washer:47},Yf={noPayNoPayment:0,noPayNoPaymentWithReceipts:1,pay100For30WithReceipts:2,pay70For700Actiions:3},Kf=15,Jf=20,Qf={simpletor_golden_business_month_1:1e3,simpletor_advanced_business_month_1:200,simpletor_basic_business_month_1:0,simpletor_landing_business_month_1:0},Xf={simpletor_golden_business_month_1:100,simpletor_advanced_business_month_1:20,simpletor_basic_business_month_1:10,simpletor_landing_business_month_1:10};class Ii{messagesCounter=0;paymentRequestCounter=0;constructor(e=0,t=0){this.messagesCounter=e,this.paymentRequestCounter=t}static forNewBusiness(){return new Ii(Jf,Kf)}static fromProductId(e){return new Ii(Qf[e]||0,Xf[e]||0)}setBusinessData(e){this.messagesCounter=parseInt(e.child("messagesCounter").val().toString())||0,this.paymentRequestCounter=parseInt(e.child("paymentRequestCounter").val().toString())||0}toJson(){const e={};return e.messagesCounter=this.messagesCounter,e.paymentRequestCounter=this.paymentRequestCounter,e}}class sn{businesseType=$t.Other;currency=co;notifyOnNewCustomer=!0;searchable=!0;billingIssue=new Map;isLandingPageMode=!1;allWorkersIds=new Map;workersIds=new Map;hypPath;expiredDate=new Date;shopPhone="";ownersName="";companyNumber="";ownersPhone="";masofNumber="";previewDoc="";instagramAccount="";revenueCatId="";pendingWorkersProductsId="";adress="";workersProductsId="";pendingProductId="";dynamicLink="";shopName="";productId="";businessId="";createdAt=new Date;blockedUsersTemp=new Map;lastTimeConnected=new Date;businessData=new Ii;design=new Je;constructor({shopName:e="",businessId:t,productId:n="",adress:r="",dynamicLink:s="",revenueCatId:o="",ownersName:a="",instagramAccount:l="",shopPhone:c="",design:h}){this.shopName=e,this.businessId=t,this.productId=n,this.adress=r,this.dynamicLink=s,this.revenueCatId=o,this.ownersName=a,this.instagramAccount=l,this.shopPhone=c,this.design=h}static empty(){return new sn({design:new Je,businessId:""})}get businessPayLoadData(){return new Ti({businessId:this.businessId,businessName:this.shopName,shopIcon:this.design.shopIconData})}static fromJson(e,t){const n=new sn({businessId:t,design:new Je});return n.setData(e,t),n}setData(e,t){if(this.businessId=t,e.currency&&(this.currency=Qn.fromJson(e.currency)),e.design)this.design=Je.fromJson(e.design);else{const r=e.theme;this.design.pickedThemeKey=r,Object.entries(e.products).forEach(([s,o])=>{this.design.products.set(s,nn.fromJson(o,s))}),e.changingImages&&(this.design.changingImages=e.changingImages.map(s=>s)),e.updates&&e.updates.forEach((s,o)=>{this.design.updates.set(o.toString(),rn.fromJson(s,o.toString()))}),this.design.bottomIcons=e.bottomIcons??!1,this.design.storyTitle=e.storyTitle??"",this.design.changingImagesSwapSeconds=e.changingImagesSwapSeconds??6,this.design.shopIconUrl=e.shopIcon??""}this.previewDoc=e.previewDoc??"",this.workersProductsId=e.workersProductsId??"",this.pendingWorkersProductsId=e.pendingWorkersProductsId??"",this.shopName=e.shopName??"",this.isLandingPageMode=e.isLandingPageMode??!1,this.searchable=e.searchable??!0,e.expiredDate!=null&&(this.expiredDate=new Date(e.expiredDate)),this.notifyOnNewCustomer=e.notifyOnNewCustomer??!0,this.companyNumber=e.companyNumber??"",e.hypPath!=null&&(this.hypPath=Yf[e.hypPath]),this.allWorkersIds=new Map,e.allWorkersIds!=null&&Object.entries(e.allWorkersIds).forEach(([r,s])=>{this.allWorkersIds.set(r,s)});const n=this.businessId.split("--")[0];this.allWorkersIds.hasOwnProperty("+"+n)||this.allWorkersIds.set("+"+n,""),this.workersIds=new Map,e.workersIds!=null&&Object.entries(e.workersIds).forEach(([r,s])=>{this.workersIds.set(r,s)}),this.workersIds.hasOwnProperty(n)||this.workersIds.set(n,""),this.dynamicLink=e.dynamicLink??"",this.masofNumber=e.masofNumber??"",this.ownersName=e.ownersName??"",this.revenueCatId=e.revenueCatId??"",this.productId=e.productId??"",this.pendingProductId=e.pendingProductId??"",this.businesseType=X0[e.businesseType]??$t.Other,this.instagramAccount=e.instagramAccount??"",this.adress=e.adress??"",this.shopPhone=e.shopPhone??"";try{e.billingIssue!=null&&Object.entries(e.billingIssue).forEach(([r,s])=>{this.billingIssue.set(r,s.toDate())})}catch{}e.createdAt instanceof ct?this.createdAt=e.createdAt.toDate():typeof e.createdAt=="string"&&(this.createdAt=new Date(e.createdAt)||new Date),e.lastTimeConnected!=null&&(this.lastTimeConnected=new Date(e.lastTimeConnected)||new Date)}toJson(){const e={};return e.notifyOnNewCustomer=this.notifyOnNewCustomer,e.currency=this.currency.toJson(),e.searchable=this.searchable,e.workersProductsId=this.workersProductsId,e.pendingWorkersProductsId=this.pendingWorkersProductsId,e.previewDoc=this.previewDoc,e.masofNumber=this.masofNumber,e.revenueCatId=this.revenueCatId,e.pendingProductId=this.pendingProductId,e.productId=this.productId,e.shopName=this.shopName,this.hypPath&&(e.hypPath=this.hypPath),this.billingIssue.size>0&&(e.billingIssue={},this.billingIssue.forEach((t,n)=>{e.billingIssue[n]=ct.fromDate(t)})),this.dynamicLink!==""&&(e.dynamicLink=this.dynamicLink),e.companyNumber=this.companyNumber,e.expiredDate=this.expiredDate,e.businesseType=this.businesseType,e.ownersName=this.ownersName,e.instagramAccount=this.instagramAccount,e.adress=this.adress,e.shopPhone=this.shopPhone,e.workersIds=this.workersIds,e.createdAt=this.createdAt,e.lastTimeConnected=this.lastTimeConnected,this.isLandingPageMode&&(e.isLandingPageMode=this.isLandingPageMode),e.design=this.design.toJson(),e}toString(){return JSON.stringify(this.toJson())}}var $e=(i=>(i.waiting="waiting",i.approved="approved",i))($e||{});const Z0={waiting:"waiting",approved:"approved"},j0={waiting:"waiting",approved:"approved"};var ze=(i=>(i.app="app",i.web="web",i.byWorker="byWorker",i))(ze||{});const el={app:"app",web:"web",byWorker:"byWorker"},tl={app:"app",web:"web",byWorker:"byWorker"};var dt=(i=>(i.regular="regular",i.confirmArrival="confirmArrival",i))(dt||{});const _r={regular:"regular",confirmArrival:"confirmArrival"},_t={regular:"regular",confirmArrival:"confirmArrival"};var yt=(i=>(i.message="message",i.push="push",i.none="none",i.whatsapp="whatsapp",i))(yt||{});const Zf={message:"message",push:"push",none:"none",whatsapp:"whatsapp"},nl={message:"message",push:"push",whatsapp:"whatsapp",none:"none"};var z=(i=>(i[i.male=0]="male",i[i.female=1]="female",i[i.anonymous=2]="anonymous",i))(z||{});const ka={"אתה בטוח":"את בטוחה","אתה יכול":"את יכולה","דרג ":"דרגי ","אתה ":"את ","בטוח ":"בטוחה ","בטוח?":"בטוחה?",הפעל:"הפעלי",צא:"צאי"," צור":" צרי","בחר ":"בחרי ",תחויב:"תחויבי",אשר:"אשרי",לקוח:"לקוחה","סמן ":"סמני ","הכנס ":"הכניסי ",הזמן:"הזמיני",נווט:"נווטי","הוסף ":"הוסיפי ","הזמן ":"הזמיני ",רשום:"רשומה",מסתכן:"מסתכנת","הזמיני שהזנת":"הזמן שהזנת",שתרצה:"שתרצי",שלם:"שלמי",לשלמי:"לשלם","תרצה ":"תרצי ",עדכן:"עדכני","שלם הכל":"שלמי הכל",הפקד:"הפקדי",בטל:"בטלי","לחץ ":"לחצי ",השאר:"השאירי","שים לב":"שימי לב","הזן ":"הזיני ",בוא:"בואי","הקלד ":"הקלדי ","שבהן את עובד":"שבהן את עובדת","כאן תוכל להוסיף":"כאן תוכלי להוסיף","במסך זה תוכל":"במסך זה תוכלי","עדיין מתלבט":"עדיין מתלבטת",ותוכל:"ותוכלי",סיים:"סיימי",המשך:"המשיכי","ברוך הבא":"ברוכה הבאה","נסה ":"נסי ",הוצאית:"הוצאת","תהיה ":"תהיי ",התקשר:"התקשרי",תוסר:"תוסרי","תוכל ":"תוכלי ","את משתמש":"את משתמשת",לקוחהות:"לקוחות",צרית:"צורת","מחק את":"מחקי את",מאבד:"מאבדת",אמת:"אמתי",מותאמת:"מתואמת",לאמתי:"לאמת",דלג:"דלגי",לבטלי:"לבטל",כאשרי:"כאשר",סרב:"סרבי",לסרבי:"לסרב",לנווטי:"לנווט",תקבל:"תקבלי",אשריאי:"אשראי"},Hn={0:"male",1:"female",2:"anonymous"},je={male:0,female:1,anonymous:2};var Ie=(i=>(i[i.SMS=0]="SMS",i[i.SMSOrPush=1]="SMSOrPush",i[i.WhatsAppOrPush=2]="WhatsAppOrPush",i[i.WhatsApp=3]="WhatsApp",i[i.SMSOnly=4]="SMSOnly",i[i.WhatAppOnly=5]="WhatAppOnly",i[i.Push=6]="Push",i[i.PushOrWhatsApp=7]="PushOrWhatsApp",i[i.PushOrSMS=8]="PushOrSMS",i[i.OnlyPush=9]="OnlyPush",i))(Ie||{});const jf={0:"SMS",4:"SMSOnly",5:"WhatAppOnly",1:"SMSOrPush",2:"WhatsAppOrPush",3:"WhatsApp",9:"OnlyPush",7:"PushOrWhatsApp",8:"PushOrSMS",6:"Push"},tr={SMS:0,SMSOrPush:1,WhatAppOnly:5,SMSOnly:4,WhatsAppOrPush:2,WhatsApp:3,OnlyPush:9,PushOrWhatsApp:7,PushOrSMS:8,Push:6},em=/^[a-zA-Z0-9-_.~%]{1,900}$/;var li=(i=>(i[i.shortestTreatment=0]="shortestTreatment",i[i.longestTreatment=1]="longestTreatment",i[i.custom=2]="custom",i[i.first=3]="first",i[i.last=4]="last",i[i.edges=5]="edges",i))(li||{});const tm={3:"first",4:"last",5:"edges",0:"shortestTreatment",1:"longestTreatment",2:"custom"},nm={first:3,last:4,edges:5,shortestTreatment:0,longestTreatment:1,custom:2},im={0:"muslim",1:"christian",2:"jewish"},rm={muslim:0,christian:1,jewish:2};var hi=(i=>(i[i.onHold=0]="onHold",i[i.needCancel=1]="needCancel",i[i.waitingList=2]="waitingList",i[i.withDebts=3]="withDebts",i[i.withOutRecipts=4]="withOutRecipts",i[i.withOnlinePayment=5]="withOnlinePayment",i[i.withoutConfirmArrival=6]="withoutConfirmArrival",i))(hi||{});class Si{static _singleton=new Si;constructor(){}static GI(){return Si._singleton}getLisksChildPath(e){const t=`${rt}/${lo.currentBusinesssId}/${bn}`,n=`${e}/${Wo}`;return`${t}/${n}`}getImageStorageName(e,t){const n=e.toUpperCase(),r=t.split(n);return`${n}${r[1].split(".jpg")[0]}`}getLikesChildPath(e,t,n){const r=`${rt}/${t}/${bn}`,s=`${e}/${Wo}`;return`${r}/${s}/${n}`}getBusinessDataPath(e){return`${rt}/${e}/${Uo}`}getWorkerCountersPath(e,t){return`${rt}/${e}/${bn}/${t}/${bh}`}getMessageCounterPath(e){return`${rt}/${e}/${Uo}/messagesCounter`}userBookingsPathByBooking(e){return`${fi}/${e.customerId}/${oi}/${ai}/${Lo}`}userBookingsPathByUser(e){return`${fi}/${e}/${oi}/${ai}/${Lo}`}workerBookingsPath(e){return`${rt}/${e.buisnessId}/${bn}/${e.workerId}/${oi}/${ai}/${Eh}`}}class sm extends Q0{constructor(){super()}}class Bn{businessName="";iconUrl="";businessId="";type=$t.Other;adress="";ownerName="";shopPhone="";constructor({businessId:e,shopPhone:t,type:n,adress:r,ownerName:s,iconUrl:o,businessName:a}){this.businessId=e,this.shopPhone=t,this.type=n,this.adress=r,this.ownerName=s,this.iconUrl=o,this.businessName=a}static empty(){return new Bn({businessId:"",shopPhone:"",type:$t.Other,adress:"",ownerName:"",iconUrl:"",businessName:""})}static fromJson(e,t){const n=e.businessName||"",r=e.iconUrl||"",s=X0[e.T]||$t.Other,o=e.ON||"",a=e.SP||"",l=e.A||"";return new Bn({businessId:t,shopPhone:a,type:s,adress:l,ownerName:o,iconUrl:r,businessName:n})}get toBusinessModel(){const e=new sn({businessId:this.businessId,design:new Je({shopIconUrl:this.iconUrl})});return e.ownersName=this.ownerName,e.shopPhone=this.shopPhone,e.shopName=this.businessName,e.adress=this.adress,e.businesseType=this.type,e}static fromBusinessInfo(e){return new Bn({businessId:e.businessId,shopPhone:e.shopPhone,type:e.type,adress:e.adress,ownerName:e.ownerName,iconUrl:e.iconUrl,businessName:e.businessName})}toJson(){const e={};return e.businessName=this.businessName,e.iconUrl=this.iconUrl,e.ON=this.ownerName,e.SP=this.shopPhone,e.A=this.adress,e.T=zf[this.type],e}isTheSame(e){return e.iconUrl===this.iconUrl&&e.ownerName===this.ownerName&&e.shopPhone===this.shopPhone&&e.adress===this.adress&&e.type===this.type&&e.businessName===this.businessName}toString(){return JSON.stringify(this.toJson())}}function Ve(i){const e=Object.prototype.toString.call(i);return i instanceof Date||typeof i=="object"&&e==="[object Date]"?new i.constructor(+i):typeof i=="number"||e==="[object Number]"||typeof i=="string"||e==="[object String]"?new Date(i):new Date(NaN)}function kt(i,e){return i instanceof Date?new i.constructor(e):new Date(e)}const il=6048e5,om=864e5;let am={};function nr(){return am}function Vn(i,e){const t=nr(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,r=Ve(i),s=r.getDay(),o=(s<n?7:0)+s-n;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}function Bi(i){return Vn(i,{weekStartsOn:1})}function rl(i){const e=Ve(i),t=e.getFullYear(),n=kt(i,0);n.setFullYear(t+1,0,4),n.setHours(0,0,0,0);const r=Bi(n),s=kt(i,0);s.setFullYear(t,0,4),s.setHours(0,0,0,0);const o=Bi(s);return e.getTime()>=r.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function Ta(i){const e=Ve(i);return e.setHours(0,0,0,0),e}function Ia(i){const e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()));return e.setUTCFullYear(i.getFullYear()),i.getTime()-e.getTime()}function cm(i,e){const t=Ta(i),n=Ta(e),r=t.getTime()-Ia(t),s=n.getTime()-Ia(n);return Math.round((r-s)/om)}function lm(i){const e=rl(i),t=kt(i,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Bi(t)}function hm(i){return i instanceof Date||typeof i=="object"&&Object.prototype.toString.call(i)==="[object Date]"}function um(i){if(!hm(i)&&typeof i!="number")return!1;const e=Ve(i);return!isNaN(Number(e))}function dm(i){const e=Ve(i),t=kt(i,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const fm={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},mm=(i,e,t)=>{let n;const r=fm[i];return typeof r=="string"?n=r:e===1?n=r.one:n=r.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function yr(i){return(e={})=>{const t=e.width?String(e.width):i.defaultWidth;return i.formats[t]||i.formats[i.defaultWidth]}}const pm={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xm={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},gm={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},vm={date:yr({formats:pm,defaultWidth:"full"}),time:yr({formats:xm,defaultWidth:"full"}),dateTime:yr({formats:gm,defaultWidth:"full"})},_m={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ym=(i,e,t,n)=>_m[i];function Dn(i){return(e,t)=>{const n=t?.context?String(t.context):"standalone";let r;if(n==="formatting"&&i.formattingValues){const o=i.defaultFormattingWidth||i.defaultWidth,a=t?.width?String(t.width):o;r=i.formattingValues[a]||i.formattingValues[o]}else{const o=i.defaultWidth,a=t?.width?String(t.width):i.defaultWidth;r=i.values[a]||i.values[o]}const s=i.argumentCallback?i.argumentCallback(e):e;return r[s]}}const wm={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Cm={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Dm={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Em={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},bm={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Am={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},km=(i,e)=>{const t=Number(i),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Tm={ordinalNumber:km,era:Dn({values:wm,defaultWidth:"wide"}),quarter:Dn({values:Cm,defaultWidth:"wide",argumentCallback:i=>i-1}),month:Dn({values:Dm,defaultWidth:"wide"}),day:Dn({values:Em,defaultWidth:"wide"}),dayPeriod:Dn({values:bm,defaultWidth:"wide",formattingValues:Am,defaultFormattingWidth:"wide"})};function En(i){return(e,t={})=>{const n=t.width,r=n&&i.matchPatterns[n]||i.matchPatterns[i.defaultMatchWidth],s=e.match(r);if(!s)return null;const o=s[0],a=n&&i.parsePatterns[n]||i.parsePatterns[i.defaultParseWidth],l=Array.isArray(a)?Sm(a,d=>d.test(o)):Im(a,d=>d.test(o));let c;c=i.valueCallback?i.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;const h=e.slice(o.length);return{value:c,rest:h}}}function Im(i,e){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&e(i[t]))return t}function Sm(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return t}function Bm(i){return(e,t={})=>{const n=e.match(i.matchPattern);if(!n)return null;const r=n[0],s=e.match(i.parsePattern);if(!s)return null;let o=i.valueCallback?i.valueCallback(s[0]):s[0];o=t.valueCallback?t.valueCallback(o):o;const a=e.slice(r.length);return{value:o,rest:a}}}const Fm=/^(\d+)(th|st|nd|rd)?/i,Pm=/\d+/i,Nm={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Om={any:[/^b/i,/^(a|c)/i]},Rm={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Mm={any:[/1/i,/2/i,/3/i,/4/i]},Lm={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Wm={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Um={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Hm={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Vm={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qm={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Gm={ordinalNumber:Bm({matchPattern:Fm,parsePattern:Pm,valueCallback:i=>parseInt(i,10)}),era:En({matchPatterns:Nm,defaultMatchWidth:"wide",parsePatterns:Om,defaultParseWidth:"any"}),quarter:En({matchPatterns:Rm,defaultMatchWidth:"wide",parsePatterns:Mm,defaultParseWidth:"any",valueCallback:i=>i+1}),month:En({matchPatterns:Lm,defaultMatchWidth:"wide",parsePatterns:Wm,defaultParseWidth:"any"}),day:En({matchPatterns:Um,defaultMatchWidth:"wide",parsePatterns:Hm,defaultParseWidth:"any"}),dayPeriod:En({matchPatterns:Vm,defaultMatchWidth:"any",parsePatterns:qm,defaultParseWidth:"any"})},$m={code:"en-US",formatDistance:mm,formatLong:vm,formatRelative:ym,localize:Tm,match:Gm,options:{weekStartsOn:0,firstWeekContainsDate:1}};function zm(i){const e=Ve(i);return cm(e,dm(e))+1}function Ym(i){const e=Ve(i),t=Bi(e).getTime()-lm(e).getTime();return Math.round(t/il)+1}function sl(i,e){const t=Ve(i),n=t.getFullYear(),r=nr(),s=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,o=kt(i,0);o.setFullYear(n+1,0,s),o.setHours(0,0,0,0);const a=Vn(o,e),l=kt(i,0);l.setFullYear(n,0,s),l.setHours(0,0,0,0);const c=Vn(l,e);return t.getTime()>=a.getTime()?n+1:t.getTime()>=c.getTime()?n:n-1}function Km(i,e){const t=nr(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,r=sl(i,e),s=kt(i,0);return s.setFullYear(r,0,n),s.setHours(0,0,0,0),Vn(s,e)}function Jm(i,e){const t=Ve(i),n=Vn(t,e).getTime()-Km(t,e).getTime();return Math.round(n/il)+1}function J(i,e){const t=i<0?"-":"",n=Math.abs(i).toString().padStart(e,"0");return t+n}const nt={y(i,e){const t=i.getFullYear(),n=t>0?t:1-t;return J(e==="yy"?n%100:n,e.length)},M(i,e){const t=i.getMonth();return e==="M"?String(t+1):J(t+1,2)},d(i,e){return J(i.getDate(),e.length)},a(i,e){const t=i.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(i,e){return J(i.getHours()%12||12,e.length)},H(i,e){return J(i.getHours(),e.length)},m(i,e){return J(i.getMinutes(),e.length)},s(i,e){return J(i.getSeconds(),e.length)},S(i,e){const t=e.length,n=i.getMilliseconds(),r=Math.floor(n*Math.pow(10,t-3));return J(r,e.length)}},Lt={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Qm={G:function(i,e,t){const n=i.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(i,e,t){if(e==="yo"){const n=i.getFullYear(),r=n>0?n:1-n;return t.ordinalNumber(r,{unit:"year"})}return nt.y(i,e)},Y:function(i,e,t,n){const r=sl(i,n),s=r>0?r:1-r;if(e==="YY"){const o=s%100;return J(o,2)}return e==="Yo"?t.ordinalNumber(s,{unit:"year"}):J(s,e.length)},R:function(i,e){const t=rl(i);return J(t,e.length)},u:function(i,e){const t=i.getFullYear();return J(t,e.length)},Q:function(i,e,t){const n=Math.ceil((i.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return J(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(i,e,t){const n=Math.ceil((i.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return J(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(i,e,t){const n=i.getMonth();switch(e){case"M":case"MM":return nt.M(i,e);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(i,e,t){const n=i.getMonth();switch(e){case"L":return String(n+1);case"LL":return J(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(i,e,t,n){const r=Jm(i,n);return e==="wo"?t.ordinalNumber(r,{unit:"week"}):J(r,e.length)},I:function(i,e,t){const n=Ym(i);return e==="Io"?t.ordinalNumber(n,{unit:"week"}):J(n,e.length)},d:function(i,e,t){return e==="do"?t.ordinalNumber(i.getDate(),{unit:"date"}):nt.d(i,e)},D:function(i,e,t){const n=zm(i);return e==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):J(n,e.length)},E:function(i,e,t){const n=i.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(i,e,t,n){const r=i.getDay(),s=(r-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(s);case"ee":return J(s,2);case"eo":return t.ordinalNumber(s,{unit:"day"});case"eee":return t.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(r,{width:"short",context:"formatting"});case"eeee":default:return t.day(r,{width:"wide",context:"formatting"})}},c:function(i,e,t,n){const r=i.getDay(),s=(r-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(s);case"cc":return J(s,e.length);case"co":return t.ordinalNumber(s,{unit:"day"});case"ccc":return t.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(r,{width:"narrow",context:"standalone"});case"cccccc":return t.day(r,{width:"short",context:"standalone"});case"cccc":default:return t.day(r,{width:"wide",context:"standalone"})}},i:function(i,e,t){const n=i.getDay(),r=n===0?7:n;switch(e){case"i":return String(r);case"ii":return J(r,e.length);case"io":return t.ordinalNumber(r,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(i,e,t){const r=i.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(i,e,t){const n=i.getHours();let r;switch(n===12?r=Lt.noon:n===0?r=Lt.midnight:r=n/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(i,e,t){const n=i.getHours();let r;switch(n>=17?r=Lt.evening:n>=12?r=Lt.afternoon:n>=4?r=Lt.morning:r=Lt.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(i,e,t){if(e==="ho"){let n=i.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return nt.h(i,e)},H:function(i,e,t){return e==="Ho"?t.ordinalNumber(i.getHours(),{unit:"hour"}):nt.H(i,e)},K:function(i,e,t){const n=i.getHours()%12;return e==="Ko"?t.ordinalNumber(n,{unit:"hour"}):J(n,e.length)},k:function(i,e,t){let n=i.getHours();return n===0&&(n=24),e==="ko"?t.ordinalNumber(n,{unit:"hour"}):J(n,e.length)},m:function(i,e,t){return e==="mo"?t.ordinalNumber(i.getMinutes(),{unit:"minute"}):nt.m(i,e)},s:function(i,e,t){return e==="so"?t.ordinalNumber(i.getSeconds(),{unit:"second"}):nt.s(i,e)},S:function(i,e){return nt.S(i,e)},X:function(i,e,t,n){const s=(n._originalDate||i).getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return Ba(s);case"XXXX":case"XX":return gt(s);case"XXXXX":case"XXX":default:return gt(s,":")}},x:function(i,e,t,n){const s=(n._originalDate||i).getTimezoneOffset();switch(e){case"x":return Ba(s);case"xxxx":case"xx":return gt(s);case"xxxxx":case"xxx":default:return gt(s,":")}},O:function(i,e,t,n){const s=(n._originalDate||i).getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Sa(s,":");case"OOOO":default:return"GMT"+gt(s,":")}},z:function(i,e,t,n){const s=(n._originalDate||i).getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Sa(s,":");case"zzzz":default:return"GMT"+gt(s,":")}},t:function(i,e,t,n){const r=n._originalDate||i,s=Math.floor(r.getTime()/1e3);return J(s,e.length)},T:function(i,e,t,n){const s=(n._originalDate||i).getTime();return J(s,e.length)}};function Sa(i,e=""){const t=i>0?"-":"+",n=Math.abs(i),r=Math.floor(n/60),s=n%60;return s===0?t+String(r):t+String(r)+e+J(s,2)}function Ba(i,e){return i%60===0?(i>0?"-":"+")+J(Math.abs(i)/60,2):gt(i,e)}function gt(i,e=""){const t=i>0?"-":"+",n=Math.abs(i),r=J(Math.floor(n/60),2),s=J(n%60,2);return t+r+e+s}const Fa=(i,e)=>{switch(i){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},ol=(i,e)=>{switch(i){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Xm=(i,e)=>{const t=i.match(/(P+)(p+)?/)||[],n=t[1],r=t[2];if(!r)return Fa(i,e);let s;switch(n){case"P":s=e.dateTime({width:"short"});break;case"PP":s=e.dateTime({width:"medium"});break;case"PPP":s=e.dateTime({width:"long"});break;case"PPPP":default:s=e.dateTime({width:"full"});break}return s.replace("{{date}}",Fa(n,e)).replace("{{time}}",ol(r,e))},Zm={p:ol,P:Xm},jm=/^D+$/,ep=/^Y+$/,tp=["D","DD","YY","YYYY"];function np(i){return jm.test(i)}function ip(i){return ep.test(i)}function Pa(i,e,t){const n=rp(i,e,t);if(console.warn(n),tp.includes(i))throw new RangeError(n)}function rp(i,e,t){const n=i[0]==="Y"?"years":"days of the month";return`Use \`${i.toLowerCase()}\` instead of \`${i}\` (in \`${e}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const sp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,op=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ap=/^'([^]*?)'?$/,cp=/''/g,lp=/[a-zA-Z]/;function wr(i,e,t){const n=nr(),r=t?.locale??n.locale??$m,s=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,a=Ve(i);if(!um(a))throw new RangeError("Invalid time value");const l={firstWeekContainsDate:s,weekStartsOn:o,locale:r,_originalDate:a};return e.match(op).map(function(h){const d=h[0];if(d==="p"||d==="P"){const u=Zm[d];return u(h,r.formatLong)}return h}).join("").match(sp).map(function(h){if(h==="''")return"'";const d=h[0];if(d==="'")return hp(h);const u=Qm[d];if(u)return!t?.useAdditionalWeekYearTokens&&ip(h)&&Pa(h,e,String(i)),!t?.useAdditionalDayOfYearTokens&&np(h)&&Pa(h,e,String(i)),u(a,h,r.localize,l);if(d.match(lp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+d+"`");return h}).join("")}function hp(i){const e=i.match(ap);return e?e[1].replace(cp,"'"):i}const Ds={0:"deposit",1:"payment"},Es={deposit:0,payment:1};class Tt{type=1;amount=0;createdAt=new Date(0);id="";hypId="";constructor({type:e,amount:t,id:n,hypId:r,createdAt:s}){this.type=e,this.amount=Number(t.toFixed(2))||t,this.id=n,this.hypId=r,this.createdAt=s}static fromJson(e,t){const n=new Tt({});return e.amount!=null&&(n.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),n.hypId=e.hypId||"",n.id=t,n.type=Es[e.type]||1,n.createdAt=e.createdAt?new Date(e.createdAt):new Date(0),n}static fromTransaction(e){const t=new Tt({});return t.type=e.type,t.amount=e.amount,t.id=e.id,t.hypId=e.hypId,t.createdAt=e.createdAt,t}toJson(){const e={};return e.amount=this.amount,e.hypId=this.hypId,e.type=Ds[this.type],e.createdAt=this.createdAt.toISOString(),e}toString(){return JSON.stringify(this.toJson(),null,2)}}class zt{workMinutes=0;breakMinutes=0;title="";constructor({workMinutes:e=0,breakMinutes:t=0,title:n=""}){this.workMinutes=e,this.breakMinutes=t,this.title=n}get wholeMinutes(){return this.workMinutes+this.breakMinutes}static fromTreatmentTime(e){return new zt({breakMinutes:e.breakMinutes,workMinutes:e.workMinutes,title:e.title})}static fromJson(e){return new zt({breakMinutes:e.break||0,workMinutes:e.duration||0,title:e.title||""})}toJson(){const e={};return e.break=this.breakMinutes,e.duration=this.workMinutes,e.title=this.title,e}toString(){return JSON.stringify(this,null,2)}}class Re{totalMinutes=0;index="";id="";note="";price;amountInAdvance=0;paymentType;isMulti=!1;showPrice=!0;showTime=!0;count=1;name="";colorIndex=-2;maxParticipants=1;maxTicketsForUser=1;tempMaxParticipants;hide=!1;showParticipants=!0;times=new Map;priceChangingNote;constructor({times:e=new Map,id:t="",price:n,count:r=1,name:s="",isMulti:o=!1,maxTicketsForUser:a=1,index:l="",amountInAdvance:c=0,colorIndex:h=-2,hide:d=!1,paymentType:u,note:f="",maxParticipants:m=1,showPrice:v=!0,showParticipants:g=!0,showTime:w=!0}={}){this.times=e,this.id=t,this.price=n,this.count=r,this.name=s,this.isMulti=o,this.maxTicketsForUser=a,this.index=l,this.amountInAdvance=c,this.colorIndex=h,this.hide=d,this.paymentType=u,this.note=f,this.maxParticipants=m,this.showPrice=v,this.showParticipants=g,this.showTime=w,this.totalMinutes=this.totalTotalMinutes}isEqual(e){return!0}get totalTotalMinutes(){let e=0;return this.times.forEach((t,n)=>{e+=t.wholeMinutes}),e}get totalWorkMinutes(){let e=0;return this.times.forEach((t,n)=>{e+=t.workMinutes}),e}get totalMinutesForBooking(){return this.totalMinutes*this.count}get amountInAdvanceForBooking(){return this.amountInAdvance*this.count}get totalPriceForBooking(){return this.price.amount*this.count}get nameForBooking(){return this.count===1?this.name:`${this.name} X${this.count}`}static fromTreatment(e){const t=new Re({times:new Map,showTime:e.showTime,paymentType:e.paymentType,id:e.id,hide:e.hide,showPrice:e.showPrice,price:e.price,index:e.index,maxTicketsForUser:e.maxTicketsForUser,colorIndex:e.colorIndex,name:e.name,isMulti:e.isMulti,note:e.note,count:e.count,maxParticipants:e.maxParticipants,amountInAdvance:e.amountInAdvance});return t.priceChangingNote=e.priceChangingNote,t.tempMaxParticipants=e.tempMaxParticipants,t.totalMinutes=e.totalMinutes,e.times.forEach((n,r)=>{t.times.set(r,zt.fromTreatmentTime(n))}),t}static fromTreatmentsMap(e){let t=0;const n=new Re({price:new Gt({amount:"0",currency:co})});return e.forEach((r,s)=>{for(let o=0;o<r.count;o++)r.times.forEach((a,l)=>{n.times.set(t.toString(),a),t++}),r.price&&(n.price.amount+=r.price.amount,n.price.currency=r.price.currency),n.name===""?n.name=r.name:n.name+=` + ${r.name}`,n.showTime=n.showTime&&r.showTime,n.showPrice=n.showPrice&&r.showPrice,n.paymentType=r.paymentType,n.amountInAdvance+=r.amountInAdvance,n.totalMinutes+=r.totalMinutes}),n}get participants(){return this.tempMaxParticipants!==void 0?this.tempMaxParticipants:this.maxParticipants}priceToString(){return this.price.toString()}minutesToString(){return An(new re({minutes:this.totalMinutes}))}static fromJson(e,t){const n=new Re({times:new Map,id:e.id||"",colorIndex:e.colorIndex||-2,maxTicketsForUser:e.maxTicketsForUser||1,index:t,hide:e.hide||!1,name:e.name||"",isMulti:e.isMulti||!1,note:e.note||"",count:e.count||1,price:e.price?Gt.fromJson(e.price):void 0,amountInAdvance:e.amountInAdvance!==void 0?typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance):0,maxParticipants:e.maxParticipants||1,paymentType:Es[e.paymentType],showPrice:e.showPrice||!1,showTime:e.showTime||!1,showParticipants:e.showParticipants||!0});if(n.priceChangingNote=e.priceChangingNote,n.tempMaxParticipants=e.tempMaxParticipants,e.times)for(const r in e.times)n.times.set(r,zt.fromJson(e.times[r]));return n}toJson(){const e={};return e.times={},this.times.forEach((t,n)=>{e.times[n]=t.toJson()}),e.name=this.name,this.note!==""&&(e.note=this.note),this.id!==""&&(e.id=this.id),this.hide&&(e.hide=this.hide),this.maxTicketsForUser>1&&(e.maxTicketsForUser=this.maxTicketsForUser),this.colorIndex!==-2&&(e.colorIndex=this.colorIndex),this.priceChangingNote!==void 0&&(e.priceChangingNote=this.priceChangingNote),e.price=this.price?this.price.toJson():void 0,this.amountInAdvance!==0&&(e.amountInAdvance=this.amountInAdvance),this.paymentType!=null&&Ds[this.paymentType]!=null&&(e.paymentType=Ds[this.paymentType]),this.isMulti&&(e.isMulti=this.isMulti),this.tempMaxParticipants!==void 0&&(e.tempMaxParticipants=this.tempMaxParticipants),this.count!==1&&(e.count=this.count),this.maxParticipants!==1&&(e.maxParticipants=this.maxParticipants),this.showParticipants||(e.showParticipants=this.showParticipants),e.showPrice=this.showPrice,e.showTime=this.showTime,e}static fromOldJson(e,t,n,r){const s=new Re({});if(e.times)for(const o in e.times)e.times.hasOwnProperty(o)&&s.times.set(o,zt.fromJson(e.times[o]));return s.id="",s.colorIndex=r,s.index=t,s.name=s.parseNameFromDbField(n),e.price&&(s.price=Gt.fromJson(e.price)),e.amountInAdvance!==void 0&&(s.amountInAdvance=typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance)),s.paymentType=Es[e.paymentType],s.showPrice=e.showPrice||!1,s.showTime=e.showTime||!1,s.totalMinutes=s.totalTotalMinutes,s}parseNameFromDbField(e){return e.replace(Ho,"/").replace(Vo,"*")}parseNameToDbField(e){return e.replace("/",Ho).replace("*",Vo)}toString(){return JSON.stringify(this,null,2)}}function Na(i,e){let t=i.getFullYear()-e.getFullYear(),n=i.getMonth()-e.getMonth();return n<0&&(t-=1,n+=12),Math.abs(t*12+n)}function up(i,e){return i===null&&e===null?null:i===null?e:e===null?i:e>i?e:i}function dp(i){return new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric"}).format(i)}function fp(i){return new Intl.DateTimeFormat("en-US",{day:"2-digit"}).format(i)}function bs(i){return new Intl.DateTimeFormat("en-US",{month:"2-digit",year:"numeric"}).format(i)}function Xe(i){return new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}).format(i)}function mp(i){return new Date(`1970-01-01T${i}`)}function ir(i){return new Date(i)}function al(i){return new Date(i)}function Oa(i,e){return i===null&&e===null?null:i===null?e:e===null||i<e?i:e}function cl(i){return new Date(i.getFullYear(),i.getMonth(),1)}function De(i){return new Date(i.getFullYear(),i.getMonth(),i.getDate())}function Ra(i,e){return new Date(i.getFullYear(),i.getMonth()+e,i.getDate(),i.getHours(),i.getMinutes())}function pt(i){const e=i.getDay(),t=i.getDate()-e+(e===0?-6:1);return new Date(i.setDate(t))}class We{token;joinDate;id;activeNotifications;constructor({token:e="",joinDate:t,id:n="",activeNotifications:r=!0}){this.token=e,this.joinDate=t,this.id=n,this.activeNotifications=r}static fromJson(e,t){const n=new We({joinDate:new Date(0)});return n.id=t,n.activeNotifications=e.activeNotifications??!0,n.token=e.token??"",n}toJson(){const e={};return this.activeNotifications||(e.activeNotifications=this.activeNotifications),e.token=this.token,e.joinDate=Xe(this.joinDate),e}static fromDevice(e){return new We({joinDate:e.joinDate,id:e.id,activeNotifications:e.activeNotifications,token:e.token})}}const Ma="~.9.~",pp="..",Cr="_";class Fi{id="";businessId="";workerName="";date="";workerId="";timeStr="";treatmentId="";treatmentName="";constructor({workerName:e="",date:t="",workerId:n="",timeStr:r="",treatmentId:s="",treatmentName:o="",businessId:a=""}){this.workerName=e,this.date=t,this.workerId=n,this.timeStr=r,this.treatmentId=s,this.treatmentName=o,this.businessId=a}fixEmptyAttributes(){this.workerName=this.workerName===""?"E":this.workerName,this.date=this.date===""?"E":this.date,this.businessId=this.businessId===""?"E":this.businessId,this.workerId=this.workerId===""?"E":this.workerId}static fromJson(e,t){const n=new Fi({});return n.id=t,n.workerName=e.workerName??"",n.date=e.date??"",n.timeStr=e.timeStr??"",n.treatmentId=e.treatmentId??"",n.treatmentName=e.treatmentName??"",n.businessId=e.businessId??"",n.workerId=e.workerId??"",n}get isMulti(){return this.timeStr!==""}static fromTopicStr(e){const t=new Fi({}),n=e.split(pp),r=n[0].split(Cr),s=n[1].split(Cr);return t.businessId=r[0],t.workerId=r[1].replaceAll(Ma,"+"),t.date=r[2],t.workerName=s[1],t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}toTopicStr(){this.fixEmptyAttributes();const e=this.workerId.replaceAll("+",Ma);return[this.businessId,e,this.date,this.timeStr,this.treatmentId].join(Cr).split("").filter(r=>em.test(r)).join("")}get dateTime(){const e=ir(this.date),t=this.timeStr===""?new Date(0):mp(this.timeStr);return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes())}toJson(){const e={};return e.businessId=this.businessId,this.workerName!==""&&(e.workerName=this.workerName),this.workerId!==""&&(e.workerId=this.workerId),this.date!==""&&(e.date=this.date),this.timeStr!==""&&(e.timeStr=this.timeStr),this.treatmentName!==""&&(e.treatmentName=this.treatmentName),this.treatmentId!==""&&(e.treatmentId=this.treatmentId),e}toString(){return JSON.stringify(this.toJson())}}const xp={1:"PL",2:"MasterCard",3:"Visa",4:"Maestro",5:"Isracard"},gp={PL:"1",MasterCard:"2",Visa:"3",Maestro:"4",Isracard:"5"},vp={1:"Isracard",2:"Visa Cal",3:"Diners",4:"Amex",6:"Leumi Card"},_p={Isracard:"1","Visa Cal":"2",Diners:"3",Amex:"4","Leumi Card":"6"};class Fn{brand="";token="";validityMonth="";validityYear="";name="";bankName="";l4Digits="";userId="";attemptsLeft=ci;cardId="";businessId="";constructor({brand:e="",token:t="",validityMonth:n="",validityYear:r="",name:s="",userId:o="",bankName:a="",l4Digits:l="",cardId:c="",businessId:h="",attemptsLeft:d=ci}={}){this.brand=e,this.token=t,this.validityMonth=n,this.validityYear=r,this.name=s,this.userId=o,this.bankName=a,this.l4Digits=l,this.cardId=c,this.businessId=h,this.attemptsLeft=d}static fromJson(e,t,n){const r=new Fn;return r.cardId=t,r.brand=xp[e.brand]||"Card",r.token=e.token||"",r.userId=e.userId||"",r.attemptsLeft=e.attemptsLeft||ci,r.validityMonth=e.validityMonth||"",r.validityYear=e.validityYear||"",r.businessId=n,r.name=e.name||"",r.bankName=e.bankName||"",r.bankName=vp[e.bankName]||"Bank",r.l4Digits=e.l4Digits||"",r}fromPaymentCard(e){this.brand=e.brand,this.token=e.token,this.userId=e.userId,this.businessId=e.businessId,this.cardId=e.cardId,this.attemptsLeft=e.attemptsLeft,this.validityMonth=e.validityMonth,this.validityYear=e.validityYear,this.name=e.name,this.bankName=e.bankName,this.l4Digits=e.l4Digits}toJson(){const e={};return e.brand=gp[this.brand]||"",e.token=this.token,e.userId=this.userId,e.attemptsLeft=this.attemptsLeft,e.validityMonth=this.validityMonth,e.validityYear=this.validityYear,e.name=this.name,e.bankName=this.bankName,e.bankName=_p[this.bankName]||"",e.l4Digits=this.l4Digits,e}decryptCard(e){return new Fn({cardId:this.cardId,brand:this.brand,token:decryptText({encryption:this.token,password:e}),validityMonth:decryptText({encryption:this.validityMonth,password:e}),validityYear:decryptText({encryption:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}encryptCard(e){return new Fn({cardId:this.cardId,brand:this.brand,token:encryptText({text:this.token,password:e}),validityMonth:encryptText({text:this.validityMonth,password:e}),validityYear:encryptText({text:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}isTheSameAs(e){return this.bankName===e.bankName&&this.brand===e.brand&&this.name===e.name&&this.l4Digits===e.l4Digits&&this.userId===e.userId&&this.validityMonth===e.validityMonth&&this.validityYear===e.validityYear}toString(){return JSON.stringify(this,null,"  ")}}var ll={exports:{}};function yp(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Dr={exports:{}};const wp={},Cp=Object.freeze(Object.defineProperty({__proto__:null,default:wp},Symbol.toStringTag,{value:"Module"})),Dp=Ml(Cp);var La;function G(){return La||(La=1,function(i,e){(function(t,n){i.exports=n()})(W,function(){var t=t||function(n,r){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof W<"u"&&W.crypto&&(s=W.crypto),!s&&typeof yp=="function")try{s=Dp}catch{}var o=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function p(){}return function(x){var _;return p.prototype=x,_=new p,p.prototype=null,_}}(),l={},c=l.lib={},h=c.Base=function(){return{extend:function(p){var x=a(this);return p&&x.mixIn(p),(!x.hasOwnProperty("init")||this.init===x.init)&&(x.init=function(){x.$super.init.apply(this,arguments)}),x.init.prototype=x,x.$super=this,x},create:function(){var p=this.extend();return p.init.apply(p,arguments),p},init:function(){},mixIn:function(p){for(var x in p)p.hasOwnProperty(x)&&(this[x]=p[x]);p.hasOwnProperty("toString")&&(this.toString=p.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=c.WordArray=h.extend({init:function(p,x){p=this.words=p||[],x!=r?this.sigBytes=x:this.sigBytes=p.length*4},toString:function(p){return(p||f).stringify(this)},concat:function(p){var x=this.words,_=p.words,D=this.sigBytes,C=p.sigBytes;if(this.clamp(),D%4)for(var E=0;E<C;E++){var A=_[E>>>2]>>>24-E%4*8&255;x[D+E>>>2]|=A<<24-(D+E)%4*8}else for(var N=0;N<C;N+=4)x[D+N>>>2]=_[N>>>2];return this.sigBytes+=C,this},clamp:function(){var p=this.words,x=this.sigBytes;p[x>>>2]&=4294967295<<32-x%4*8,p.length=n.ceil(x/4)},clone:function(){var p=h.clone.call(this);return p.words=this.words.slice(0),p},random:function(p){for(var x=[],_=0;_<p;_+=4)x.push(o());return new d.init(x,p)}}),u=l.enc={},f=u.Hex={stringify:function(p){for(var x=p.words,_=p.sigBytes,D=[],C=0;C<_;C++){var E=x[C>>>2]>>>24-C%4*8&255;D.push((E>>>4).toString(16)),D.push((E&15).toString(16))}return D.join("")},parse:function(p){for(var x=p.length,_=[],D=0;D<x;D+=2)_[D>>>3]|=parseInt(p.substr(D,2),16)<<24-D%8*4;return new d.init(_,x/2)}},m=u.Latin1={stringify:function(p){for(var x=p.words,_=p.sigBytes,D=[],C=0;C<_;C++){var E=x[C>>>2]>>>24-C%4*8&255;D.push(String.fromCharCode(E))}return D.join("")},parse:function(p){for(var x=p.length,_=[],D=0;D<x;D++)_[D>>>2]|=(p.charCodeAt(D)&255)<<24-D%4*8;return new d.init(_,x)}},v=u.Utf8={stringify:function(p){try{return decodeURIComponent(escape(m.stringify(p)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(p){return m.parse(unescape(encodeURIComponent(p)))}},g=c.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(p){typeof p=="string"&&(p=v.parse(p)),this._data.concat(p),this._nDataBytes+=p.sigBytes},_process:function(p){var x,_=this._data,D=_.words,C=_.sigBytes,E=this.blockSize,A=E*4,N=C/A;p?N=n.ceil(N):N=n.max((N|0)-this._minBufferSize,0);var y=N*E,b=n.min(y*4,C);if(y){for(var T=0;T<y;T+=E)this._doProcessBlock(D,T);x=D.splice(0,y),_.sigBytes-=b}return new d.init(x,b)},clone:function(){var p=h.clone.call(this);return p._data=this._data.clone(),p},_minBufferSize:0});c.Hasher=g.extend({cfg:h.extend(),init:function(p){this.cfg=this.cfg.extend(p),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(p){return this._append(p),this._process(),this},finalize:function(p){p&&this._append(p);var x=this._doFinalize();return x},blockSize:16,_createHelper:function(p){return function(x,_){return new p.init(_).finalize(x)}},_createHmacHelper:function(p){return function(x,_){return new w.HMAC.init(p,_).finalize(x)}}});var w=l.algo={};return l}(Math);return t})}(Dr)),Dr.exports}var Er={exports:{}},Wa;function rr(){return Wa||(Wa=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(n){var r=t,s=r.lib,o=s.Base,a=s.WordArray,l=r.x64={};l.Word=o.extend({init:function(c,h){this.high=c,this.low=h}}),l.WordArray=o.extend({init:function(c,h){c=this.words=c||[],h!=n?this.sigBytes=h:this.sigBytes=c.length*8},toX32:function(){for(var c=this.words,h=c.length,d=[],u=0;u<h;u++){var f=c[u];d.push(f.high),d.push(f.low)}return a.create(d,this.sigBytes)},clone:function(){for(var c=o.clone.call(this),h=c.words=this.words.slice(0),d=h.length,u=0;u<d;u++)h[u]=h[u].clone();return c}})}(),t})}(Er)),Er.exports}var br={exports:{}},Ua;function Ep(){return Ua||(Ua=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(){if(typeof ArrayBuffer=="function"){var n=t,r=n.lib,s=r.WordArray,o=s.init,a=s.init=function(l){if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),l instanceof Uint8Array){for(var c=l.byteLength,h=[],d=0;d<c;d++)h[d>>>2]|=l[d]<<24-d%4*8;o.call(this,h,c)}else o.apply(this,arguments)};a.prototype=s}}(),t.lib.WordArray})}(br)),br.exports}var Ar={exports:{}},Ha;function bp(){return Ha||(Ha=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(){var n=t,r=n.lib,s=r.WordArray,o=n.enc;o.Utf16=o.Utf16BE={stringify:function(l){for(var c=l.words,h=l.sigBytes,d=[],u=0;u<h;u+=2){var f=c[u>>>2]>>>16-u%4*8&65535;d.push(String.fromCharCode(f))}return d.join("")},parse:function(l){for(var c=l.length,h=[],d=0;d<c;d++)h[d>>>1]|=l.charCodeAt(d)<<16-d%2*16;return s.create(h,c*2)}},o.Utf16LE={stringify:function(l){for(var c=l.words,h=l.sigBytes,d=[],u=0;u<h;u+=2){var f=a(c[u>>>2]>>>16-u%4*8&65535);d.push(String.fromCharCode(f))}return d.join("")},parse:function(l){for(var c=l.length,h=[],d=0;d<c;d++)h[d>>>1]|=a(l.charCodeAt(d)<<16-d%2*16);return s.create(h,c*2)}};function a(l){return l<<8&4278255360|l>>>8&16711935}}(),t.enc.Utf16})}(Ar)),Ar.exports}var kr={exports:{}},Va;function Ft(){return Va||(Va=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(){var n=t,r=n.lib,s=r.WordArray,o=n.enc;o.Base64={stringify:function(l){var c=l.words,h=l.sigBytes,d=this._map;l.clamp();for(var u=[],f=0;f<h;f+=3)for(var m=c[f>>>2]>>>24-f%4*8&255,v=c[f+1>>>2]>>>24-(f+1)%4*8&255,g=c[f+2>>>2]>>>24-(f+2)%4*8&255,w=m<<16|v<<8|g,p=0;p<4&&f+p*.75<h;p++)u.push(d.charAt(w>>>6*(3-p)&63));var x=d.charAt(64);if(x)for(;u.length%4;)u.push(x);return u.join("")},parse:function(l){var c=l.length,h=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var u=0;u<h.length;u++)d[h.charCodeAt(u)]=u}var f=h.charAt(64);if(f){var m=l.indexOf(f);m!==-1&&(c=m)}return a(l,c,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(l,c,h){for(var d=[],u=0,f=0;f<c;f++)if(f%4){var m=h[l.charCodeAt(f-1)]<<f%4*2,v=h[l.charCodeAt(f)]>>>6-f%4*2,g=m|v;d[u>>>2]|=g<<24-u%4*8,u++}return s.create(d,u)}}(),t.enc.Base64})}(kr)),kr.exports}var Tr={exports:{}},qa;function Ap(){return qa||(qa=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(){var n=t,r=n.lib,s=r.WordArray,o=n.enc;o.Base64url={stringify:function(l,c){c===void 0&&(c=!0);var h=l.words,d=l.sigBytes,u=c?this._safe_map:this._map;l.clamp();for(var f=[],m=0;m<d;m+=3)for(var v=h[m>>>2]>>>24-m%4*8&255,g=h[m+1>>>2]>>>24-(m+1)%4*8&255,w=h[m+2>>>2]>>>24-(m+2)%4*8&255,p=v<<16|g<<8|w,x=0;x<4&&m+x*.75<d;x++)f.push(u.charAt(p>>>6*(3-x)&63));var _=u.charAt(64);if(_)for(;f.length%4;)f.push(_);return f.join("")},parse:function(l,c){c===void 0&&(c=!0);var h=l.length,d=c?this._safe_map:this._map,u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var f=0;f<d.length;f++)u[d.charCodeAt(f)]=f}var m=d.charAt(64);if(m){var v=l.indexOf(m);v!==-1&&(h=v)}return a(l,h,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(l,c,h){for(var d=[],u=0,f=0;f<c;f++)if(f%4){var m=h[l.charCodeAt(f-1)]<<f%4*2,v=h[l.charCodeAt(f)]>>>6-f%4*2,g=m|v;d[u>>>2]|=g<<24-u%4*8,u++}return s.create(d,u)}}(),t.enc.Base64url})}(Tr)),Tr.exports}var Ir={exports:{}},Ga;function Pt(){return Ga||(Ga=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(n){var r=t,s=r.lib,o=s.WordArray,a=s.Hasher,l=r.algo,c=[];(function(){for(var v=0;v<64;v++)c[v]=n.abs(n.sin(v+1))*4294967296|0})();var h=l.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(v,g){for(var w=0;w<16;w++){var p=g+w,x=v[p];v[p]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360}var _=this._hash.words,D=v[g+0],C=v[g+1],E=v[g+2],A=v[g+3],N=v[g+4],y=v[g+5],b=v[g+6],T=v[g+7],I=v[g+8],O=v[g+9],R=v[g+10],L=v[g+11],ne=v[g+12],K=v[g+13],Z=v[g+14],Q=v[g+15],k=_[0],B=_[1],F=_[2],S=_[3];k=d(k,B,F,S,D,7,c[0]),S=d(S,k,B,F,C,12,c[1]),F=d(F,S,k,B,E,17,c[2]),B=d(B,F,S,k,A,22,c[3]),k=d(k,B,F,S,N,7,c[4]),S=d(S,k,B,F,y,12,c[5]),F=d(F,S,k,B,b,17,c[6]),B=d(B,F,S,k,T,22,c[7]),k=d(k,B,F,S,I,7,c[8]),S=d(S,k,B,F,O,12,c[9]),F=d(F,S,k,B,R,17,c[10]),B=d(B,F,S,k,L,22,c[11]),k=d(k,B,F,S,ne,7,c[12]),S=d(S,k,B,F,K,12,c[13]),F=d(F,S,k,B,Z,17,c[14]),B=d(B,F,S,k,Q,22,c[15]),k=u(k,B,F,S,C,5,c[16]),S=u(S,k,B,F,b,9,c[17]),F=u(F,S,k,B,L,14,c[18]),B=u(B,F,S,k,D,20,c[19]),k=u(k,B,F,S,y,5,c[20]),S=u(S,k,B,F,R,9,c[21]),F=u(F,S,k,B,Q,14,c[22]),B=u(B,F,S,k,N,20,c[23]),k=u(k,B,F,S,O,5,c[24]),S=u(S,k,B,F,Z,9,c[25]),F=u(F,S,k,B,A,14,c[26]),B=u(B,F,S,k,I,20,c[27]),k=u(k,B,F,S,K,5,c[28]),S=u(S,k,B,F,E,9,c[29]),F=u(F,S,k,B,T,14,c[30]),B=u(B,F,S,k,ne,20,c[31]),k=f(k,B,F,S,y,4,c[32]),S=f(S,k,B,F,I,11,c[33]),F=f(F,S,k,B,L,16,c[34]),B=f(B,F,S,k,Z,23,c[35]),k=f(k,B,F,S,C,4,c[36]),S=f(S,k,B,F,N,11,c[37]),F=f(F,S,k,B,T,16,c[38]),B=f(B,F,S,k,R,23,c[39]),k=f(k,B,F,S,K,4,c[40]),S=f(S,k,B,F,D,11,c[41]),F=f(F,S,k,B,A,16,c[42]),B=f(B,F,S,k,b,23,c[43]),k=f(k,B,F,S,O,4,c[44]),S=f(S,k,B,F,ne,11,c[45]),F=f(F,S,k,B,Q,16,c[46]),B=f(B,F,S,k,E,23,c[47]),k=m(k,B,F,S,D,6,c[48]),S=m(S,k,B,F,T,10,c[49]),F=m(F,S,k,B,Z,15,c[50]),B=m(B,F,S,k,y,21,c[51]),k=m(k,B,F,S,ne,6,c[52]),S=m(S,k,B,F,A,10,c[53]),F=m(F,S,k,B,R,15,c[54]),B=m(B,F,S,k,C,21,c[55]),k=m(k,B,F,S,I,6,c[56]),S=m(S,k,B,F,Q,10,c[57]),F=m(F,S,k,B,b,15,c[58]),B=m(B,F,S,k,K,21,c[59]),k=m(k,B,F,S,N,6,c[60]),S=m(S,k,B,F,L,10,c[61]),F=m(F,S,k,B,E,15,c[62]),B=m(B,F,S,k,O,21,c[63]),_[0]=_[0]+k|0,_[1]=_[1]+B|0,_[2]=_[2]+F|0,_[3]=_[3]+S|0},_doFinalize:function(){var v=this._data,g=v.words,w=this._nDataBytes*8,p=v.sigBytes*8;g[p>>>5]|=128<<24-p%32;var x=n.floor(w/4294967296),_=w;g[(p+64>>>9<<4)+15]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,g[(p+64>>>9<<4)+14]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,v.sigBytes=(g.length+1)*4,this._process();for(var D=this._hash,C=D.words,E=0;E<4;E++){var A=C[E];C[E]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}return D},clone:function(){var v=a.clone.call(this);return v._hash=this._hash.clone(),v}});function d(v,g,w,p,x,_,D){var C=v+(g&w|~g&p)+x+D;return(C<<_|C>>>32-_)+g}function u(v,g,w,p,x,_,D){var C=v+(g&p|w&~p)+x+D;return(C<<_|C>>>32-_)+g}function f(v,g,w,p,x,_,D){var C=v+(g^w^p)+x+D;return(C<<_|C>>>32-_)+g}function m(v,g,w,p,x,_,D){var C=v+(w^(g|~p))+x+D;return(C<<_|C>>>32-_)+g}r.MD5=a._createHelper(h),r.HmacMD5=a._createHmacHelper(h)}(Math),t.MD5})}(Ir)),Ir.exports}var Sr={exports:{}},$a;function hl(){return $a||($a=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(){var n=t,r=n.lib,s=r.WordArray,o=r.Hasher,a=n.algo,l=[],c=a.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(h,d){for(var u=this._hash.words,f=u[0],m=u[1],v=u[2],g=u[3],w=u[4],p=0;p<80;p++){if(p<16)l[p]=h[d+p]|0;else{var x=l[p-3]^l[p-8]^l[p-14]^l[p-16];l[p]=x<<1|x>>>31}var _=(f<<5|f>>>27)+w+l[p];p<20?_+=(m&v|~m&g)+1518500249:p<40?_+=(m^v^g)+1859775393:p<60?_+=(m&v|m&g|v&g)-1894007588:_+=(m^v^g)-899497514,w=g,g=v,v=m<<30|m>>>2,m=f,f=_}u[0]=u[0]+f|0,u[1]=u[1]+m|0,u[2]=u[2]+v|0,u[3]=u[3]+g|0,u[4]=u[4]+w|0},_doFinalize:function(){var h=this._data,d=h.words,u=this._nDataBytes*8,f=h.sigBytes*8;return d[f>>>5]|=128<<24-f%32,d[(f+64>>>9<<4)+14]=Math.floor(u/4294967296),d[(f+64>>>9<<4)+15]=u,h.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var h=o.clone.call(this);return h._hash=this._hash.clone(),h}});n.SHA1=o._createHelper(c),n.HmacSHA1=o._createHmacHelper(c)}(),t.SHA1})}(Sr)),Sr.exports}var Br={exports:{}},za;function ho(){return za||(za=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){return function(n){var r=t,s=r.lib,o=s.WordArray,a=s.Hasher,l=r.algo,c=[],h=[];(function(){function f(w){for(var p=n.sqrt(w),x=2;x<=p;x++)if(!(w%x))return!1;return!0}function m(w){return(w-(w|0))*4294967296|0}for(var v=2,g=0;g<64;)f(v)&&(g<8&&(c[g]=m(n.pow(v,1/2))),h[g]=m(n.pow(v,1/3)),g++),v++})();var d=[],u=l.SHA256=a.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(f,m){for(var v=this._hash.words,g=v[0],w=v[1],p=v[2],x=v[3],_=v[4],D=v[5],C=v[6],E=v[7],A=0;A<64;A++){if(A<16)d[A]=f[m+A]|0;else{var N=d[A-15],y=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,b=d[A-2],T=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;d[A]=y+d[A-7]+T+d[A-16]}var I=_&D^~_&C,O=g&w^g&p^w&p,R=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),L=(_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25),ne=E+L+I+h[A]+d[A],K=R+O;E=C,C=D,D=_,_=x+ne|0,x=p,p=w,w=g,g=ne+K|0}v[0]=v[0]+g|0,v[1]=v[1]+w|0,v[2]=v[2]+p|0,v[3]=v[3]+x|0,v[4]=v[4]+_|0,v[5]=v[5]+D|0,v[6]=v[6]+C|0,v[7]=v[7]+E|0},_doFinalize:function(){var f=this._data,m=f.words,v=this._nDataBytes*8,g=f.sigBytes*8;return m[g>>>5]|=128<<24-g%32,m[(g+64>>>9<<4)+14]=n.floor(v/4294967296),m[(g+64>>>9<<4)+15]=v,f.sigBytes=m.length*4,this._process(),this._hash},clone:function(){var f=a.clone.call(this);return f._hash=this._hash.clone(),f}});r.SHA256=a._createHelper(u),r.HmacSHA256=a._createHmacHelper(u)}(Math),t.SHA256})}(Br)),Br.exports}var Fr={exports:{}},Ya;function kp(){return Ya||(Ya=1,function(i,e){(function(t,n,r){i.exports=n(G(),ho())})(W,function(t){return function(){var n=t,r=n.lib,s=r.WordArray,o=n.algo,a=o.SHA256,l=o.SHA224=a.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var c=a._doFinalize.call(this);return c.sigBytes-=4,c}});n.SHA224=a._createHelper(l),n.HmacSHA224=a._createHmacHelper(l)}(),t.SHA224})}(Fr)),Fr.exports}var Pr={exports:{}},Ka;function ul(){return Ka||(Ka=1,function(i,e){(function(t,n,r){i.exports=n(G(),rr())})(W,function(t){return function(){var n=t,r=n.lib,s=r.Hasher,o=n.x64,a=o.Word,l=o.WordArray,c=n.algo;function h(){return a.create.apply(a,arguments)}var d=[h(1116352408,3609767458),h(1899447441,602891725),h(3049323471,3964484399),h(3921009573,2173295548),h(961987163,4081628472),h(1508970993,3053834265),h(2453635748,2937671579),h(2870763221,3664609560),h(3624381080,2734883394),h(310598401,1164996542),h(607225278,1323610764),h(1426881987,3590304994),h(1925078388,4068182383),h(2162078206,991336113),h(2614888103,633803317),h(3248222580,3479774868),h(3835390401,2666613458),h(4022224774,944711139),h(264347078,2341262773),h(604807628,2007800933),h(770255983,1495990901),h(1249150122,1856431235),h(1555081692,3175218132),h(1996064986,2198950837),h(2554220882,3999719339),h(2821834349,766784016),h(2952996808,2566594879),h(3210313671,3203337956),h(3336571891,1034457026),h(3584528711,2466948901),h(113926993,3758326383),h(338241895,168717936),h(666307205,1188179964),h(773529912,1546045734),h(1294757372,1522805485),h(1396182291,2643833823),h(1695183700,2343527390),h(1986661051,1014477480),h(2177026350,1206759142),h(2456956037,344077627),h(2730485921,1290863460),h(2820302411,3158454273),h(3259730800,3505952657),h(3345764771,106217008),h(3516065817,3606008344),h(3600352804,1432725776),h(4094571909,1467031594),h(275423344,851169720),h(430227734,3100823752),h(506948616,1363258195),h(659060556,3750685593),h(883997877,3785050280),h(958139571,3318307427),h(1322822218,3812723403),h(1537002063,2003034995),h(1747873779,3602036899),h(1955562222,1575990012),h(2024104815,1125592928),h(2227730452,2716904306),h(2361852424,442776044),h(2428436474,593698344),h(2756734187,3733110249),h(3204031479,2999351573),h(3329325298,3815920427),h(3391569614,3928383900),h(3515267271,566280711),h(3940187606,3454069534),h(4118630271,4000239992),h(116418474,1914138554),h(174292421,2731055270),h(289380356,3203993006),h(460393269,320620315),h(685471733,587496836),h(852142971,1086792851),h(1017036298,365543100),h(1126000580,2618297676),h(1288033470,3409855158),h(1501505948,4234509866),h(1607167915,987167468),h(1816402316,1246189591)],u=[];(function(){for(var m=0;m<80;m++)u[m]=h()})();var f=c.SHA512=s.extend({_doReset:function(){this._hash=new l.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(m,v){for(var g=this._hash.words,w=g[0],p=g[1],x=g[2],_=g[3],D=g[4],C=g[5],E=g[6],A=g[7],N=w.high,y=w.low,b=p.high,T=p.low,I=x.high,O=x.low,R=_.high,L=_.low,ne=D.high,K=D.low,Z=C.high,Q=C.low,k=E.high,B=E.low,F=A.high,S=A.low,ie=N,j=y,ge=b,U=T,dn=I,Nt=O,sr=R,fn=L,Be=ne,ye=K,Zn=Z,mn=Q,jn=k,pn=B,or=F,xn=S,Fe=0;Fe<80;Fe++){var be,et,ei=u[Fe];if(Fe<16)et=ei.high=m[v+Fe*2]|0,be=ei.low=m[v+Fe*2+1]|0;else{var Co=u[Fe-15],Ot=Co.high,gn=Co.low,ml=(Ot>>>1|gn<<31)^(Ot>>>8|gn<<24)^Ot>>>7,Do=(gn>>>1|Ot<<31)^(gn>>>8|Ot<<24)^(gn>>>7|Ot<<25),Eo=u[Fe-2],Rt=Eo.high,vn=Eo.low,pl=(Rt>>>19|vn<<13)^(Rt<<3|vn>>>29)^Rt>>>6,bo=(vn>>>19|Rt<<13)^(vn<<3|Rt>>>29)^(vn>>>6|Rt<<26),Ao=u[Fe-7],xl=Ao.high,gl=Ao.low,ko=u[Fe-16],vl=ko.high,To=ko.low;be=Do+gl,et=ml+xl+(be>>>0<Do>>>0?1:0),be=be+bo,et=et+pl+(be>>>0<bo>>>0?1:0),be=be+To,et=et+vl+(be>>>0<To>>>0?1:0),ei.high=et,ei.low=be}var _l=Be&Zn^~Be&jn,Io=ye&mn^~ye&pn,yl=ie&ge^ie&dn^ge&dn,wl=j&U^j&Nt^U&Nt,Cl=(ie>>>28|j<<4)^(ie<<30|j>>>2)^(ie<<25|j>>>7),So=(j>>>28|ie<<4)^(j<<30|ie>>>2)^(j<<25|ie>>>7),Dl=(Be>>>14|ye<<18)^(Be>>>18|ye<<14)^(Be<<23|ye>>>9),El=(ye>>>14|Be<<18)^(ye>>>18|Be<<14)^(ye<<23|Be>>>9),Bo=d[Fe],bl=Bo.high,Fo=Bo.low,we=xn+El,tt=or+Dl+(we>>>0<xn>>>0?1:0),we=we+Io,tt=tt+_l+(we>>>0<Io>>>0?1:0),we=we+Fo,tt=tt+bl+(we>>>0<Fo>>>0?1:0),we=we+be,tt=tt+et+(we>>>0<be>>>0?1:0),Po=So+wl,Al=Cl+yl+(Po>>>0<So>>>0?1:0);or=jn,xn=pn,jn=Zn,pn=mn,Zn=Be,mn=ye,ye=fn+we|0,Be=sr+tt+(ye>>>0<fn>>>0?1:0)|0,sr=dn,fn=Nt,dn=ge,Nt=U,ge=ie,U=j,j=we+Po|0,ie=tt+Al+(j>>>0<we>>>0?1:0)|0}y=w.low=y+j,w.high=N+ie+(y>>>0<j>>>0?1:0),T=p.low=T+U,p.high=b+ge+(T>>>0<U>>>0?1:0),O=x.low=O+Nt,x.high=I+dn+(O>>>0<Nt>>>0?1:0),L=_.low=L+fn,_.high=R+sr+(L>>>0<fn>>>0?1:0),K=D.low=K+ye,D.high=ne+Be+(K>>>0<ye>>>0?1:0),Q=C.low=Q+mn,C.high=Z+Zn+(Q>>>0<mn>>>0?1:0),B=E.low=B+pn,E.high=k+jn+(B>>>0<pn>>>0?1:0),S=A.low=S+xn,A.high=F+or+(S>>>0<xn>>>0?1:0)},_doFinalize:function(){var m=this._data,v=m.words,g=this._nDataBytes*8,w=m.sigBytes*8;v[w>>>5]|=128<<24-w%32,v[(w+128>>>10<<5)+30]=Math.floor(g/4294967296),v[(w+128>>>10<<5)+31]=g,m.sigBytes=v.length*4,this._process();var p=this._hash.toX32();return p},clone:function(){var m=s.clone.call(this);return m._hash=this._hash.clone(),m},blockSize:1024/32});n.SHA512=s._createHelper(f),n.HmacSHA512=s._createHmacHelper(f)}(),t.SHA512})}(Pr)),Pr.exports}var Nr={exports:{}},Ja;function Tp(){return Ja||(Ja=1,function(i,e){(function(t,n,r){i.exports=n(G(),rr(),ul())})(W,function(t){return function(){var n=t,r=n.x64,s=r.Word,o=r.WordArray,a=n.algo,l=a.SHA512,c=a.SHA384=l.extend({_doReset:function(){this._hash=new o.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var h=l._doFinalize.call(this);return h.sigBytes-=16,h}});n.SHA384=l._createHelper(c),n.HmacSHA384=l._createHmacHelper(c)}(),t.SHA384})}(Nr)),Nr.exports}var Or={exports:{}},Qa;function Ip(){return Qa||(Qa=1,function(i,e){(function(t,n,r){i.exports=n(G(),rr())})(W,function(t){return function(n){var r=t,s=r.lib,o=s.WordArray,a=s.Hasher,l=r.x64,c=l.Word,h=r.algo,d=[],u=[],f=[];(function(){for(var g=1,w=0,p=0;p<24;p++){d[g+5*w]=(p+1)*(p+2)/2%64;var x=w%5,_=(2*g+3*w)%5;g=x,w=_}for(var g=0;g<5;g++)for(var w=0;w<5;w++)u[g+5*w]=w+(2*g+3*w)%5*5;for(var D=1,C=0;C<24;C++){for(var E=0,A=0,N=0;N<7;N++){if(D&1){var y=(1<<N)-1;y<32?A^=1<<y:E^=1<<y-32}D&128?D=D<<1^113:D<<=1}f[C]=c.create(E,A)}})();var m=[];(function(){for(var g=0;g<25;g++)m[g]=c.create()})();var v=h.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],w=0;w<25;w++)g[w]=new c.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,w){for(var p=this._state,x=this.blockSize/2,_=0;_<x;_++){var D=g[w+2*_],C=g[w+2*_+1];D=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360;var E=p[_];E.high^=C,E.low^=D}for(var A=0;A<24;A++){for(var N=0;N<5;N++){for(var y=0,b=0,T=0;T<5;T++){var E=p[N+5*T];y^=E.high,b^=E.low}var I=m[N];I.high=y,I.low=b}for(var N=0;N<5;N++)for(var O=m[(N+4)%5],R=m[(N+1)%5],L=R.high,ne=R.low,y=O.high^(L<<1|ne>>>31),b=O.low^(ne<<1|L>>>31),T=0;T<5;T++){var E=p[N+5*T];E.high^=y,E.low^=b}for(var K=1;K<25;K++){var y,b,E=p[K],Z=E.high,Q=E.low,k=d[K];k<32?(y=Z<<k|Q>>>32-k,b=Q<<k|Z>>>32-k):(y=Q<<k-32|Z>>>64-k,b=Z<<k-32|Q>>>64-k);var B=m[u[K]];B.high=y,B.low=b}var F=m[0],S=p[0];F.high=S.high,F.low=S.low;for(var N=0;N<5;N++)for(var T=0;T<5;T++){var K=N+5*T,E=p[K],ie=m[K],j=m[(N+1)%5+5*T],ge=m[(N+2)%5+5*T];E.high=ie.high^~j.high&ge.high,E.low=ie.low^~j.low&ge.low}var E=p[0],U=f[A];E.high^=U.high,E.low^=U.low}},_doFinalize:function(){var g=this._data,w=g.words;this._nDataBytes*8;var p=g.sigBytes*8,x=this.blockSize*32;w[p>>>5]|=1<<24-p%32,w[(n.ceil((p+1)/x)*x>>>5)-1]|=128,g.sigBytes=w.length*4,this._process();for(var _=this._state,D=this.cfg.outputLength/8,C=D/8,E=[],A=0;A<C;A++){var N=_[A],y=N.high,b=N.low;y=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,b=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,E.push(b),E.push(y)}return new o.init(E,D)},clone:function(){for(var g=a.clone.call(this),w=g._state=this._state.slice(0),p=0;p<25;p++)w[p]=w[p].clone();return g}});r.SHA3=a._createHelper(v),r.HmacSHA3=a._createHmacHelper(v)}(Math),t.SHA3})}(Or)),Or.exports}var Rr={exports:{}},Xa;function Sp(){return Xa||(Xa=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(n){var r=t,s=r.lib,o=s.WordArray,a=s.Hasher,l=r.algo,c=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),h=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),f=o.create([0,1518500249,1859775393,2400959708,2840853838]),m=o.create([1352829926,1548603684,1836072691,2053994217,0]),v=l.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,E){for(var A=0;A<16;A++){var N=E+A,y=C[N];C[N]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var b=this._hash.words,T=f.words,I=m.words,O=c.words,R=h.words,L=d.words,ne=u.words,K,Z,Q,k,B,F,S,ie,j,ge;F=K=b[0],S=Z=b[1],ie=Q=b[2],j=k=b[3],ge=B=b[4];for(var U,A=0;A<80;A+=1)U=K+C[E+O[A]]|0,A<16?U+=g(Z,Q,k)+T[0]:A<32?U+=w(Z,Q,k)+T[1]:A<48?U+=p(Z,Q,k)+T[2]:A<64?U+=x(Z,Q,k)+T[3]:U+=_(Z,Q,k)+T[4],U=U|0,U=D(U,L[A]),U=U+B|0,K=B,B=k,k=D(Q,10),Q=Z,Z=U,U=F+C[E+R[A]]|0,A<16?U+=_(S,ie,j)+I[0]:A<32?U+=x(S,ie,j)+I[1]:A<48?U+=p(S,ie,j)+I[2]:A<64?U+=w(S,ie,j)+I[3]:U+=g(S,ie,j)+I[4],U=U|0,U=D(U,ne[A]),U=U+ge|0,F=ge,ge=j,j=D(ie,10),ie=S,S=U;U=b[1]+Q+j|0,b[1]=b[2]+k+ge|0,b[2]=b[3]+B+F|0,b[3]=b[4]+K+S|0,b[4]=b[0]+Z+ie|0,b[0]=U},_doFinalize:function(){var C=this._data,E=C.words,A=this._nDataBytes*8,N=C.sigBytes*8;E[N>>>5]|=128<<24-N%32,E[(N+64>>>9<<4)+14]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,C.sigBytes=(E.length+1)*4,this._process();for(var y=this._hash,b=y.words,T=0;T<5;T++){var I=b[T];b[T]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360}return y},clone:function(){var C=a.clone.call(this);return C._hash=this._hash.clone(),C}});function g(C,E,A){return C^E^A}function w(C,E,A){return C&E|~C&A}function p(C,E,A){return(C|~E)^A}function x(C,E,A){return C&A|E&~A}function _(C,E,A){return C^(E|~A)}function D(C,E){return C<<E|C>>>32-E}r.RIPEMD160=a._createHelper(v),r.HmacRIPEMD160=a._createHmacHelper(v)}(),t.RIPEMD160})}(Rr)),Rr.exports}var Mr={exports:{}},Za;function uo(){return Za||(Za=1,function(i,e){(function(t,n){i.exports=n(G())})(W,function(t){(function(){var n=t,r=n.lib,s=r.Base,o=n.enc,a=o.Utf8,l=n.algo;l.HMAC=s.extend({init:function(c,h){c=this._hasher=new c.init,typeof h=="string"&&(h=a.parse(h));var d=c.blockSize,u=d*4;h.sigBytes>u&&(h=c.finalize(h)),h.clamp();for(var f=this._oKey=h.clone(),m=this._iKey=h.clone(),v=f.words,g=m.words,w=0;w<d;w++)v[w]^=1549556828,g[w]^=909522486;f.sigBytes=m.sigBytes=u,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var h=this._hasher,d=h.finalize(c);h.reset();var u=h.finalize(this._oKey.clone().concat(d));return u}})})()})}(Mr)),Mr.exports}var Lr={exports:{}},ja;function Bp(){return ja||(ja=1,function(i,e){(function(t,n,r){i.exports=n(G(),ho(),uo())})(W,function(t){return function(){var n=t,r=n.lib,s=r.Base,o=r.WordArray,a=n.algo,l=a.SHA256,c=a.HMAC,h=a.PBKDF2=s.extend({cfg:s.extend({keySize:128/32,hasher:l,iterations:25e4}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,u){for(var f=this.cfg,m=c.create(f.hasher,d),v=o.create(),g=o.create([1]),w=v.words,p=g.words,x=f.keySize,_=f.iterations;w.length<x;){var D=m.update(u).finalize(g);m.reset();for(var C=D.words,E=C.length,A=D,N=1;N<_;N++){A=m.finalize(A),m.reset();for(var y=A.words,b=0;b<E;b++)C[b]^=y[b]}v.concat(D),p[0]++}return v.sigBytes=x*4,v}});n.PBKDF2=function(d,u,f){return h.create(f).compute(d,u)}}(),t.PBKDF2})}(Lr)),Lr.exports}var Wr={exports:{}},ec;function ft(){return ec||(ec=1,function(i,e){(function(t,n,r){i.exports=n(G(),hl(),uo())})(W,function(t){return function(){var n=t,r=n.lib,s=r.Base,o=r.WordArray,a=n.algo,l=a.MD5,c=a.EvpKDF=s.extend({cfg:s.extend({keySize:128/32,hasher:l,iterations:1}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,d){for(var u,f=this.cfg,m=f.hasher.create(),v=o.create(),g=v.words,w=f.keySize,p=f.iterations;g.length<w;){u&&m.update(u),u=m.update(h).finalize(d),m.reset();for(var x=1;x<p;x++)u=m.finalize(u),m.reset();v.concat(u)}return v.sigBytes=w*4,v}});n.EvpKDF=function(h,d,u){return c.create(u).compute(h,d)}}(),t.EvpKDF})}(Wr)),Wr.exports}var Ur={exports:{}},tc;function ue(){return tc||(tc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ft())})(W,function(t){t.lib.Cipher||function(n){var r=t,s=r.lib,o=s.Base,a=s.WordArray,l=s.BufferedBlockAlgorithm,c=r.enc;c.Utf8;var h=c.Base64,d=r.algo,u=d.EvpKDF,f=s.Cipher=l.extend({cfg:o.extend(),createEncryptor:function(y,b){return this.create(this._ENC_XFORM_MODE,y,b)},createDecryptor:function(y,b){return this.create(this._DEC_XFORM_MODE,y,b)},init:function(y,b,T){this.cfg=this.cfg.extend(T),this._xformMode=y,this._key=b,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(y){return this._append(y),this._process()},finalize:function(y){y&&this._append(y);var b=this._doFinalize();return b},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function y(b){return typeof b=="string"?N:C}return function(b){return{encrypt:function(T,I,O){return y(I).encrypt(b,T,I,O)},decrypt:function(T,I,O){return y(I).decrypt(b,T,I,O)}}}}()});s.StreamCipher=f.extend({_doFinalize:function(){var y=this._process(!0);return y},blockSize:1});var m=r.mode={},v=s.BlockCipherMode=o.extend({createEncryptor:function(y,b){return this.Encryptor.create(y,b)},createDecryptor:function(y,b){return this.Decryptor.create(y,b)},init:function(y,b){this._cipher=y,this._iv=b}}),g=m.CBC=function(){var y=v.extend();y.Encryptor=y.extend({processBlock:function(T,I){var O=this._cipher,R=O.blockSize;b.call(this,T,I,R),O.encryptBlock(T,I),this._prevBlock=T.slice(I,I+R)}}),y.Decryptor=y.extend({processBlock:function(T,I){var O=this._cipher,R=O.blockSize,L=T.slice(I,I+R);O.decryptBlock(T,I),b.call(this,T,I,R),this._prevBlock=L}});function b(T,I,O){var R,L=this._iv;L?(R=L,this._iv=n):R=this._prevBlock;for(var ne=0;ne<O;ne++)T[I+ne]^=R[ne]}return y}(),w=r.pad={},p=w.Pkcs7={pad:function(y,b){for(var T=b*4,I=T-y.sigBytes%T,O=I<<24|I<<16|I<<8|I,R=[],L=0;L<I;L+=4)R.push(O);var ne=a.create(R,I);y.concat(ne)},unpad:function(y){var b=y.words[y.sigBytes-1>>>2]&255;y.sigBytes-=b}};s.BlockCipher=f.extend({cfg:f.cfg.extend({mode:g,padding:p}),reset:function(){var y;f.reset.call(this);var b=this.cfg,T=b.iv,I=b.mode;this._xformMode==this._ENC_XFORM_MODE?y=I.createEncryptor:(y=I.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==y?this._mode.init(this,T&&T.words):(this._mode=y.call(I,this,T&&T.words),this._mode.__creator=y)},_doProcessBlock:function(y,b){this._mode.processBlock(y,b)},_doFinalize:function(){var y,b=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(b.pad(this._data,this.blockSize),y=this._process(!0)):(y=this._process(!0),b.unpad(y)),y},blockSize:128/32});var x=s.CipherParams=o.extend({init:function(y){this.mixIn(y)},toString:function(y){return(y||this.formatter).stringify(this)}}),_=r.format={},D=_.OpenSSL={stringify:function(y){var b,T=y.ciphertext,I=y.salt;return I?b=a.create([1398893684,1701076831]).concat(I).concat(T):b=T,b.toString(h)},parse:function(y){var b,T=h.parse(y),I=T.words;return I[0]==1398893684&&I[1]==1701076831&&(b=a.create(I.slice(2,4)),I.splice(0,4),T.sigBytes-=16),x.create({ciphertext:T,salt:b})}},C=s.SerializableCipher=o.extend({cfg:o.extend({format:D}),encrypt:function(y,b,T,I){I=this.cfg.extend(I);var O=y.createEncryptor(T,I),R=O.finalize(b),L=O.cfg;return x.create({ciphertext:R,key:T,iv:L.iv,algorithm:y,mode:L.mode,padding:L.padding,blockSize:y.blockSize,formatter:I.format})},decrypt:function(y,b,T,I){I=this.cfg.extend(I),b=this._parse(b,I.format);var O=y.createDecryptor(T,I).finalize(b.ciphertext);return O},_parse:function(y,b){return typeof y=="string"?b.parse(y,this):y}}),E=r.kdf={},A=E.OpenSSL={execute:function(y,b,T,I,O){if(I||(I=a.random(64/8)),O)var R=u.create({keySize:b+T,hasher:O}).compute(y,I);else var R=u.create({keySize:b+T}).compute(y,I);var L=a.create(R.words.slice(b),T*4);return R.sigBytes=b*4,x.create({key:R,iv:L,salt:I})}},N=s.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:A}),encrypt:function(y,b,T,I){I=this.cfg.extend(I);var O=I.kdf.execute(T,y.keySize,y.ivSize,I.salt,I.hasher);I.iv=O.iv;var R=C.encrypt.call(this,y,b,O.key,I);return R.mixIn(O),R},decrypt:function(y,b,T,I){I=this.cfg.extend(I),b=this._parse(b,I.format);var O=I.kdf.execute(T,y.keySize,y.ivSize,b.salt,I.hasher);I.iv=O.iv;var R=C.decrypt.call(this,y,b,O.key,I);return R}})}()})}(Ur)),Ur.exports}var Hr={exports:{}},nc;function Fp(){return nc||(nc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.mode.CFB=function(){var n=t.lib.BlockCipherMode.extend();n.Encryptor=n.extend({processBlock:function(s,o){var a=this._cipher,l=a.blockSize;r.call(this,s,o,l,a),this._prevBlock=s.slice(o,o+l)}}),n.Decryptor=n.extend({processBlock:function(s,o){var a=this._cipher,l=a.blockSize,c=s.slice(o,o+l);r.call(this,s,o,l,a),this._prevBlock=c}});function r(s,o,a,l){var c,h=this._iv;h?(c=h.slice(0),this._iv=void 0):c=this._prevBlock,l.encryptBlock(c,0);for(var d=0;d<a;d++)s[o+d]^=c[d]}return n}(),t.mode.CFB})}(Hr)),Hr.exports}var Vr={exports:{}},ic;function Pp(){return ic||(ic=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.mode.CTR=function(){var n=t.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(s,o){var a=this._cipher,l=a.blockSize,c=this._iv,h=this._counter;c&&(h=this._counter=c.slice(0),this._iv=void 0);var d=h.slice(0);a.encryptBlock(d,0),h[l-1]=h[l-1]+1|0;for(var u=0;u<l;u++)s[o+u]^=d[u]}});return n.Decryptor=r,n}(),t.mode.CTR})}(Vr)),Vr.exports}var qr={exports:{}},rc;function Np(){return rc||(rc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var n=t.lib.BlockCipherMode.extend();function r(a){if((a>>24&255)===255){var l=a>>16&255,c=a>>8&255,h=a&255;l===255?(l=0,c===255?(c=0,h===255?h=0:++h):++c):++l,a=0,a+=l<<16,a+=c<<8,a+=h}else a+=1<<24;return a}function s(a){return(a[0]=r(a[0]))===0&&(a[1]=r(a[1])),a}var o=n.Encryptor=n.extend({processBlock:function(a,l){var c=this._cipher,h=c.blockSize,d=this._iv,u=this._counter;d&&(u=this._counter=d.slice(0),this._iv=void 0),s(u);var f=u.slice(0);c.encryptBlock(f,0);for(var m=0;m<h;m++)a[l+m]^=f[m]}});return n.Decryptor=o,n}(),t.mode.CTRGladman})}(qr)),qr.exports}var Gr={exports:{}},sc;function Op(){return sc||(sc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.mode.OFB=function(){var n=t.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(s,o){var a=this._cipher,l=a.blockSize,c=this._iv,h=this._keystream;c&&(h=this._keystream=c.slice(0),this._iv=void 0),a.encryptBlock(h,0);for(var d=0;d<l;d++)s[o+d]^=h[d]}});return n.Decryptor=r,n}(),t.mode.OFB})}(Gr)),Gr.exports}var $r={exports:{}},oc;function Rp(){return oc||(oc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.mode.ECB=function(){var n=t.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(r,s){this._cipher.encryptBlock(r,s)}}),n.Decryptor=n.extend({processBlock:function(r,s){this._cipher.decryptBlock(r,s)}}),n}(),t.mode.ECB})}($r)),$r.exports}var zr={exports:{}},ac;function Mp(){return ac||(ac=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.pad.AnsiX923={pad:function(n,r){var s=n.sigBytes,o=r*4,a=o-s%o,l=s+a-1;n.clamp(),n.words[l>>>2]|=a<<24-l%4*8,n.sigBytes+=a},unpad:function(n){var r=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=r}},t.pad.Ansix923})}(zr)),zr.exports}var Yr={exports:{}},cc;function Lp(){return cc||(cc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.pad.Iso10126={pad:function(n,r){var s=r*4,o=s-n.sigBytes%s;n.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(n){var r=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=r}},t.pad.Iso10126})}(Yr)),Yr.exports}var Kr={exports:{}},lc;function Wp(){return lc||(lc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.pad.Iso97971={pad:function(n,r){n.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(n,r)},unpad:function(n){t.pad.ZeroPadding.unpad(n),n.sigBytes--}},t.pad.Iso97971})}(Kr)),Kr.exports}var Jr={exports:{}},hc;function Up(){return hc||(hc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.pad.ZeroPadding={pad:function(n,r){var s=r*4;n.clamp(),n.sigBytes+=s-(n.sigBytes%s||s)},unpad:function(n){for(var r=n.words,s=n.sigBytes-1,s=n.sigBytes-1;s>=0;s--)if(r[s>>>2]>>>24-s%4*8&255){n.sigBytes=s+1;break}}},t.pad.ZeroPadding})}(Jr)),Jr.exports}var Qr={exports:{}},uc;function Hp(){return uc||(uc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(Qr)),Qr.exports}var Xr={exports:{}},dc;function Vp(){return dc||(dc=1,function(i,e){(function(t,n,r){i.exports=n(G(),ue())})(W,function(t){return function(n){var r=t,s=r.lib,o=s.CipherParams,a=r.enc,l=a.Hex,c=r.format;c.Hex={stringify:function(h){return h.ciphertext.toString(l)},parse:function(h){var d=l.parse(h);return o.create({ciphertext:d})}}}(),t.format.Hex})}(Xr)),Xr.exports}var Zr={exports:{}},fc;function qp(){return fc||(fc=1,function(i,e){(function(t,n,r){i.exports=n(G(),Ft(),Pt(),ft(),ue())})(W,function(t){return function(){var n=t,r=n.lib,s=r.BlockCipher,o=n.algo,a=[],l=[],c=[],h=[],d=[],u=[],f=[],m=[],v=[],g=[];(function(){for(var x=[],_=0;_<256;_++)_<128?x[_]=_<<1:x[_]=_<<1^283;for(var D=0,C=0,_=0;_<256;_++){var E=C^C<<1^C<<2^C<<3^C<<4;E=E>>>8^E&255^99,a[D]=E,l[E]=D;var A=x[D],N=x[A],y=x[N],b=x[E]*257^E*16843008;c[D]=b<<24|b>>>8,h[D]=b<<16|b>>>16,d[D]=b<<8|b>>>24,u[D]=b;var b=y*16843009^N*65537^A*257^D*16843008;f[E]=b<<24|b>>>8,m[E]=b<<16|b>>>16,v[E]=b<<8|b>>>24,g[E]=b,D?(D=A^x[x[x[y^A]]],C^=x[x[C]]):D=C=1}})();var w=[0,1,2,4,8,16,32,64,128,27,54],p=o.AES=s.extend({_doReset:function(){var x;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var _=this._keyPriorReset=this._key,D=_.words,C=_.sigBytes/4,E=this._nRounds=C+6,A=(E+1)*4,N=this._keySchedule=[],y=0;y<A;y++)y<C?N[y]=D[y]:(x=N[y-1],y%C?C>6&&y%C==4&&(x=a[x>>>24]<<24|a[x>>>16&255]<<16|a[x>>>8&255]<<8|a[x&255]):(x=x<<8|x>>>24,x=a[x>>>24]<<24|a[x>>>16&255]<<16|a[x>>>8&255]<<8|a[x&255],x^=w[y/C|0]<<24),N[y]=N[y-C]^x);for(var b=this._invKeySchedule=[],T=0;T<A;T++){var y=A-T;if(T%4)var x=N[y];else var x=N[y-4];T<4||y<=4?b[T]=x:b[T]=f[a[x>>>24]]^m[a[x>>>16&255]]^v[a[x>>>8&255]]^g[a[x&255]]}}},encryptBlock:function(x,_){this._doCryptBlock(x,_,this._keySchedule,c,h,d,u,a)},decryptBlock:function(x,_){var D=x[_+1];x[_+1]=x[_+3],x[_+3]=D,this._doCryptBlock(x,_,this._invKeySchedule,f,m,v,g,l);var D=x[_+1];x[_+1]=x[_+3],x[_+3]=D},_doCryptBlock:function(x,_,D,C,E,A,N,y){for(var b=this._nRounds,T=x[_]^D[0],I=x[_+1]^D[1],O=x[_+2]^D[2],R=x[_+3]^D[3],L=4,ne=1;ne<b;ne++){var K=C[T>>>24]^E[I>>>16&255]^A[O>>>8&255]^N[R&255]^D[L++],Z=C[I>>>24]^E[O>>>16&255]^A[R>>>8&255]^N[T&255]^D[L++],Q=C[O>>>24]^E[R>>>16&255]^A[T>>>8&255]^N[I&255]^D[L++],k=C[R>>>24]^E[T>>>16&255]^A[I>>>8&255]^N[O&255]^D[L++];T=K,I=Z,O=Q,R=k}var K=(y[T>>>24]<<24|y[I>>>16&255]<<16|y[O>>>8&255]<<8|y[R&255])^D[L++],Z=(y[I>>>24]<<24|y[O>>>16&255]<<16|y[R>>>8&255]<<8|y[T&255])^D[L++],Q=(y[O>>>24]<<24|y[R>>>16&255]<<16|y[T>>>8&255]<<8|y[I&255])^D[L++],k=(y[R>>>24]<<24|y[T>>>16&255]<<16|y[I>>>8&255]<<8|y[O&255])^D[L++];x[_]=K,x[_+1]=Z,x[_+2]=Q,x[_+3]=k},keySize:256/32});n.AES=s._createHelper(p)}(),t.AES})}(Zr)),Zr.exports}var jr={exports:{}},mc;function Gp(){return mc||(mc=1,function(i,e){(function(t,n,r){i.exports=n(G(),Ft(),Pt(),ft(),ue())})(W,function(t){return function(){var n=t,r=n.lib,s=r.WordArray,o=r.BlockCipher,a=n.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],c=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],h=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],f=a.DES=o.extend({_doReset:function(){for(var w=this._key,p=w.words,x=[],_=0;_<56;_++){var D=l[_]-1;x[_]=p[D>>>5]>>>31-D%32&1}for(var C=this._subKeys=[],E=0;E<16;E++){for(var A=C[E]=[],N=h[E],_=0;_<24;_++)A[_/6|0]|=x[(c[_]-1+N)%28]<<31-_%6,A[4+(_/6|0)]|=x[28+(c[_+24]-1+N)%28]<<31-_%6;A[0]=A[0]<<1|A[0]>>>31;for(var _=1;_<7;_++)A[_]=A[_]>>>(_-1)*4+3;A[7]=A[7]<<5|A[7]>>>27}for(var y=this._invSubKeys=[],_=0;_<16;_++)y[_]=C[15-_]},encryptBlock:function(w,p){this._doCryptBlock(w,p,this._subKeys)},decryptBlock:function(w,p){this._doCryptBlock(w,p,this._invSubKeys)},_doCryptBlock:function(w,p,x){this._lBlock=w[p],this._rBlock=w[p+1],m.call(this,4,252645135),m.call(this,16,65535),v.call(this,2,858993459),v.call(this,8,16711935),m.call(this,1,1431655765);for(var _=0;_<16;_++){for(var D=x[_],C=this._lBlock,E=this._rBlock,A=0,N=0;N<8;N++)A|=d[N][((E^D[N])&u[N])>>>0];this._lBlock=E,this._rBlock=C^A}var y=this._lBlock;this._lBlock=this._rBlock,this._rBlock=y,m.call(this,1,1431655765),v.call(this,8,16711935),v.call(this,2,858993459),m.call(this,16,65535),m.call(this,4,252645135),w[p]=this._lBlock,w[p+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function m(w,p){var x=(this._lBlock>>>w^this._rBlock)&p;this._rBlock^=x,this._lBlock^=x<<w}function v(w,p){var x=(this._rBlock>>>w^this._lBlock)&p;this._lBlock^=x,this._rBlock^=x<<w}n.DES=o._createHelper(f);var g=a.TripleDES=o.extend({_doReset:function(){var w=this._key,p=w.words;if(p.length!==2&&p.length!==4&&p.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var x=p.slice(0,2),_=p.length<4?p.slice(0,2):p.slice(2,4),D=p.length<6?p.slice(0,2):p.slice(4,6);this._des1=f.createEncryptor(s.create(x)),this._des2=f.createEncryptor(s.create(_)),this._des3=f.createEncryptor(s.create(D))},encryptBlock:function(w,p){this._des1.encryptBlock(w,p),this._des2.decryptBlock(w,p),this._des3.encryptBlock(w,p)},decryptBlock:function(w,p){this._des3.decryptBlock(w,p),this._des2.encryptBlock(w,p),this._des1.decryptBlock(w,p)},keySize:192/32,ivSize:64/32,blockSize:64/32});n.TripleDES=o._createHelper(g)}(),t.TripleDES})}(jr)),jr.exports}var es={exports:{}},pc;function $p(){return pc||(pc=1,function(i,e){(function(t,n,r){i.exports=n(G(),Ft(),Pt(),ft(),ue())})(W,function(t){return function(){var n=t,r=n.lib,s=r.StreamCipher,o=n.algo,a=o.RC4=s.extend({_doReset:function(){for(var h=this._key,d=h.words,u=h.sigBytes,f=this._S=[],m=0;m<256;m++)f[m]=m;for(var m=0,v=0;m<256;m++){var g=m%u,w=d[g>>>2]>>>24-g%4*8&255;v=(v+f[m]+w)%256;var p=f[m];f[m]=f[v],f[v]=p}this._i=this._j=0},_doProcessBlock:function(h,d){h[d]^=l.call(this)},keySize:256/32,ivSize:0});function l(){for(var h=this._S,d=this._i,u=this._j,f=0,m=0;m<4;m++){d=(d+1)%256,u=(u+h[d])%256;var v=h[d];h[d]=h[u],h[u]=v,f|=h[(h[d]+h[u])%256]<<24-m*8}return this._i=d,this._j=u,f}n.RC4=s._createHelper(a);var c=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var h=this.cfg.drop;h>0;h--)l.call(this)}});n.RC4Drop=s._createHelper(c)}(),t.RC4})}(es)),es.exports}var ts={exports:{}},xc;function zp(){return xc||(xc=1,function(i,e){(function(t,n,r){i.exports=n(G(),Ft(),Pt(),ft(),ue())})(W,function(t){return function(){var n=t,r=n.lib,s=r.StreamCipher,o=n.algo,a=[],l=[],c=[],h=o.Rabbit=s.extend({_doReset:function(){for(var u=this._key.words,f=this.cfg.iv,m=0;m<4;m++)u[m]=(u[m]<<8|u[m]>>>24)&16711935|(u[m]<<24|u[m]>>>8)&4278255360;var v=this._X=[u[0],u[3]<<16|u[2]>>>16,u[1],u[0]<<16|u[3]>>>16,u[2],u[1]<<16|u[0]>>>16,u[3],u[2]<<16|u[1]>>>16],g=this._C=[u[2]<<16|u[2]>>>16,u[0]&4294901760|u[1]&65535,u[3]<<16|u[3]>>>16,u[1]&4294901760|u[2]&65535,u[0]<<16|u[0]>>>16,u[2]&4294901760|u[3]&65535,u[1]<<16|u[1]>>>16,u[3]&4294901760|u[0]&65535];this._b=0;for(var m=0;m<4;m++)d.call(this);for(var m=0;m<8;m++)g[m]^=v[m+4&7];if(f){var w=f.words,p=w[0],x=w[1],_=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,D=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,C=_>>>16|D&4294901760,E=D<<16|_&65535;g[0]^=_,g[1]^=C,g[2]^=D,g[3]^=E,g[4]^=_,g[5]^=C,g[6]^=D,g[7]^=E;for(var m=0;m<4;m++)d.call(this)}},_doProcessBlock:function(u,f){var m=this._X;d.call(this),a[0]=m[0]^m[5]>>>16^m[3]<<16,a[1]=m[2]^m[7]>>>16^m[5]<<16,a[2]=m[4]^m[1]>>>16^m[7]<<16,a[3]=m[6]^m[3]>>>16^m[1]<<16;for(var v=0;v<4;v++)a[v]=(a[v]<<8|a[v]>>>24)&16711935|(a[v]<<24|a[v]>>>8)&4278255360,u[f+v]^=a[v]},blockSize:128/32,ivSize:64/32});function d(){for(var u=this._X,f=this._C,m=0;m<8;m++)l[m]=f[m];f[0]=f[0]+1295307597+this._b|0,f[1]=f[1]+3545052371+(f[0]>>>0<l[0]>>>0?1:0)|0,f[2]=f[2]+886263092+(f[1]>>>0<l[1]>>>0?1:0)|0,f[3]=f[3]+1295307597+(f[2]>>>0<l[2]>>>0?1:0)|0,f[4]=f[4]+3545052371+(f[3]>>>0<l[3]>>>0?1:0)|0,f[5]=f[5]+886263092+(f[4]>>>0<l[4]>>>0?1:0)|0,f[6]=f[6]+1295307597+(f[5]>>>0<l[5]>>>0?1:0)|0,f[7]=f[7]+3545052371+(f[6]>>>0<l[6]>>>0?1:0)|0,this._b=f[7]>>>0<l[7]>>>0?1:0;for(var m=0;m<8;m++){var v=u[m]+f[m],g=v&65535,w=v>>>16,p=((g*g>>>17)+g*w>>>15)+w*w,x=((v&4294901760)*v|0)+((v&65535)*v|0);c[m]=p^x}u[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,u[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,u[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,u[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,u[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,u[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,u[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,u[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}n.Rabbit=s._createHelper(h)}(),t.Rabbit})}(ts)),ts.exports}var ns={exports:{}},gc;function Yp(){return gc||(gc=1,function(i,e){(function(t,n,r){i.exports=n(G(),Ft(),Pt(),ft(),ue())})(W,function(t){return function(){var n=t,r=n.lib,s=r.StreamCipher,o=n.algo,a=[],l=[],c=[],h=o.RabbitLegacy=s.extend({_doReset:function(){var u=this._key.words,f=this.cfg.iv,m=this._X=[u[0],u[3]<<16|u[2]>>>16,u[1],u[0]<<16|u[3]>>>16,u[2],u[1]<<16|u[0]>>>16,u[3],u[2]<<16|u[1]>>>16],v=this._C=[u[2]<<16|u[2]>>>16,u[0]&4294901760|u[1]&65535,u[3]<<16|u[3]>>>16,u[1]&4294901760|u[2]&65535,u[0]<<16|u[0]>>>16,u[2]&4294901760|u[3]&65535,u[1]<<16|u[1]>>>16,u[3]&4294901760|u[0]&65535];this._b=0;for(var g=0;g<4;g++)d.call(this);for(var g=0;g<8;g++)v[g]^=m[g+4&7];if(f){var w=f.words,p=w[0],x=w[1],_=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,D=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,C=_>>>16|D&4294901760,E=D<<16|_&65535;v[0]^=_,v[1]^=C,v[2]^=D,v[3]^=E,v[4]^=_,v[5]^=C,v[6]^=D,v[7]^=E;for(var g=0;g<4;g++)d.call(this)}},_doProcessBlock:function(u,f){var m=this._X;d.call(this),a[0]=m[0]^m[5]>>>16^m[3]<<16,a[1]=m[2]^m[7]>>>16^m[5]<<16,a[2]=m[4]^m[1]>>>16^m[7]<<16,a[3]=m[6]^m[3]>>>16^m[1]<<16;for(var v=0;v<4;v++)a[v]=(a[v]<<8|a[v]>>>24)&16711935|(a[v]<<24|a[v]>>>8)&4278255360,u[f+v]^=a[v]},blockSize:128/32,ivSize:64/32});function d(){for(var u=this._X,f=this._C,m=0;m<8;m++)l[m]=f[m];f[0]=f[0]+1295307597+this._b|0,f[1]=f[1]+3545052371+(f[0]>>>0<l[0]>>>0?1:0)|0,f[2]=f[2]+886263092+(f[1]>>>0<l[1]>>>0?1:0)|0,f[3]=f[3]+1295307597+(f[2]>>>0<l[2]>>>0?1:0)|0,f[4]=f[4]+3545052371+(f[3]>>>0<l[3]>>>0?1:0)|0,f[5]=f[5]+886263092+(f[4]>>>0<l[4]>>>0?1:0)|0,f[6]=f[6]+1295307597+(f[5]>>>0<l[5]>>>0?1:0)|0,f[7]=f[7]+3545052371+(f[6]>>>0<l[6]>>>0?1:0)|0,this._b=f[7]>>>0<l[7]>>>0?1:0;for(var m=0;m<8;m++){var v=u[m]+f[m],g=v&65535,w=v>>>16,p=((g*g>>>17)+g*w>>>15)+w*w,x=((v&4294901760)*v|0)+((v&65535)*v|0);c[m]=p^x}u[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,u[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,u[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,u[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,u[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,u[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,u[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,u[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}n.RabbitLegacy=s._createHelper(h)}(),t.RabbitLegacy})}(ns)),ns.exports}var is={exports:{}},vc;function Kp(){return vc||(vc=1,function(i,e){(function(t,n,r){i.exports=n(G(),Ft(),Pt(),ft(),ue())})(W,function(t){return function(){var n=t,r=n.lib,s=r.BlockCipher,o=n.algo;const a=16,l=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],c=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var h={pbox:[],sbox:[]};function d(g,w){let p=w>>24&255,x=w>>16&255,_=w>>8&255,D=w&255,C=g.sbox[0][p]+g.sbox[1][x];return C=C^g.sbox[2][_],C=C+g.sbox[3][D],C}function u(g,w,p){let x=w,_=p,D;for(let C=0;C<a;++C)x=x^g.pbox[C],_=d(g,x)^_,D=x,x=_,_=D;return D=x,x=_,_=D,_=_^g.pbox[a],x=x^g.pbox[a+1],{left:x,right:_}}function f(g,w,p){let x=w,_=p,D;for(let C=a+1;C>1;--C)x=x^g.pbox[C],_=d(g,x)^_,D=x,x=_,_=D;return D=x,x=_,_=D,_=_^g.pbox[1],x=x^g.pbox[0],{left:x,right:_}}function m(g,w,p){for(let E=0;E<4;E++){g.sbox[E]=[];for(let A=0;A<256;A++)g.sbox[E][A]=c[E][A]}let x=0;for(let E=0;E<a+2;E++)g.pbox[E]=l[E]^w[x],x++,x>=p&&(x=0);let _=0,D=0,C=0;for(let E=0;E<a+2;E+=2)C=u(g,_,D),_=C.left,D=C.right,g.pbox[E]=_,g.pbox[E+1]=D;for(let E=0;E<4;E++)for(let A=0;A<256;A+=2)C=u(g,_,D),_=C.left,D=C.right,g.sbox[E][A]=_,g.sbox[E][A+1]=D;return!0}var v=o.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,w=g.words,p=g.sigBytes/4;m(h,w,p)}},encryptBlock:function(g,w){var p=u(h,g[w],g[w+1]);g[w]=p.left,g[w+1]=p.right},decryptBlock:function(g,w){var p=f(h,g[w],g[w+1]);g[w]=p.left,g[w+1]=p.right},blockSize:64/32,keySize:128/32,ivSize:64/32});n.Blowfish=s._createHelper(v)}(),t.Blowfish})}(is)),is.exports}(function(i,e){(function(t,n,r){i.exports=n(G(),rr(),Ep(),bp(),Ft(),Ap(),Pt(),hl(),ho(),kp(),ul(),Tp(),Ip(),Sp(),uo(),Bp(),ft(),ue(),Fp(),Pp(),Np(),Op(),Rp(),Mp(),Lp(),Wp(),Up(),Hp(),Vp(),qp(),Gp(),$p(),zp(),Yp(),Kp())})(W,function(t){return t})})(ll);var Jp=ll.exports;const Qp=Ll(Jp),{AES:Xp,enc:Pi,SHA256:dl}=Qp,Zp="16charactersiv!";function jp(i,e){const t=ex(e),n=Pi.Utf8.parse(Zp);return Xp.encrypt(i,t,{iv:n}).toString()}function ex(i){let e="htr;lmn;rkmnkryemnkrmnbavsdbshtg6437";return e=dl(i+e).toString(Pi.Hex).substring(0,32),Pi.Utf8.parse(e)}function tx({id:i}){if(i.length<7)return"";const e=i.substring(3,6),t=dl(i+e).toString(Pi.Hex);return t.substring(0,Math.min(10,t.length)).replace(/[/.*]/g,"")}function fo(i){return jp(i+kh,Ah).replace("/","").replace("*","").replace(".","")}class Xn{userId="";name="";gender=z.male;phone="";payments={};isExist=!1;fcmTokens;isVerifiedPhone=!1;userDecline=!1;constructor({userId:e="",name:t="",gender:n=z.male,isVerifiedPhone:r=!1,phone:s="",isExist:o=!0,userDecline:a=!1}){this.userId=e,this.name=t,this.gender=n,this.isVerifiedPhone=r,this.phone=s,this.isExist=o,this.userDecline=a}get customerHashPhone(){return fo(this.phone)}get customerPhoneAsCollection(){return this.phone.replaceAll("-","")}get isPaid(){return Object.keys(this.payments).length>0}static fromJson(e,t){const n=new Xn({userId:t,name:e.N??"",gender:e.G?je[e.G]:z.male,isVerifiedPhone:e.IVP??!1,phone:e.P??"",isExist:e.IE??!0,userDecline:e.UD??!1});return e.PY!=null&&typeof e.PY=="object"&&Object.entries(e.PY).forEach(([r,s])=>{n.payments[r]=s?new Date(s):new Date(0)}),n}toJson(){const e={};return e.N=this.name,this.isVerifiedPhone&&(e.IVP=this.isVerifiedPhone),this.isExist||(e.IE=this.isExist),e.P=this.phone,this.gender!==z.male&&(e.G=z[this.gender]),Object.keys(this.payments).length>0&&(e.PY={},Object.entries(this.payments).forEach(([t,n])=>{e.PY[t]=n.toString()})),this.userDecline&&(e.UD=this.userDecline),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class on{createdAt=new Date(0);id="";amount=0;description="";showUser=!1;constructor({createdAt:e,amount:t,id:n,showUser:r,description:s=""}){this.createdAt=e,this.amount=t,this.id=n,this.showUser=r,this.description=s}static fromJson(e,t){return new on({createdAt:e.createdAt?new Date(e.createdAt):new Date(0),amount:e.amount!=null?typeof e.amount=="number"?e.amount:parseFloat(e.amount):0,id:t,showUser:e.showUser??!1,description:e.description??""})}static fromDebt(e){return new on({createdAt:e.createdAt,amount:e.amount,id:e.id,showUser:e.showUser,description:e.description})}isEqual(e){return e.id===this.id&&e.description===this.description&&e.showUser===this.showUser&&e.createdAt.toString()===this.createdAt.toString()&&this.amount===e.amount}toJson(){const e={};return e.createdAt=this.createdAt.toISOString(),e.amount=this.amount,this.showUser&&(e.showUser=this.showUser),this.description!==""&&(e.description=this.description),e}}class nx{date=new Date(0);workerId="";workerName="";workerPhone="";buisnessId="";businessName="";recurrenceRef;recurrenceFatherDate;recurrenceNotificationsLastDate;recurrenceChildDate;constructor({workerId:e="",workerName:t="",businessName:n="",buisnessId:r="",workerPhone:s=""}={}){this.workerId=e,this.workerName=t,this.businessName=n,this.buisnessId=r,this.workerPhone=s}}class It{invoiceId="";docId="";monthStr="";issuedBy="";amount=0;constructor({monthStr:e,invoiceId:t,docId:n,amount:r,issuedBy:s}){this.monthStr=e,this.invoiceId=t,this.docId=n,this.amount=r,this.issuedBy=s}toJson(){const e={};return e.monthStr=this.monthStr,e.docId=this.docId,e.issuedBy=this.issuedBy,e.amount=this.amount,e}static fromJson(e,t,n){const r=new It({});return r.invoiceId=t,r.docId=e.docId??"",r.monthStr=e.monthStr??"",r.issuedBy=e.issuedBy??n,e.amount!=null&&(r.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),r}static fromBookingInvoiceData(e){const t=new It({});return t.invoiceId=e.invoiceId,t.docId=e.docId,t.monthStr=e.monthStr,t.issuedBy=e.issuedBy,t.amount=e.amount,t}toString(){return JSON.stringify(this.toJson(),null,2)}}const ix="simpletor.officialsimplecode.com",rx="?PaymentId=PAYMENT_ID";class mo{id="";workerId="";createdAt=new Date(0);signNewMultiBookingUsers=!0;constructor({id:e,workerId:t}){this.id=e,this.workerId=t}get link(){return`https://${ix}/${rx}`.replace("PAYMENT_ID",this.id)}static fromJson(e){const t=new mo({});return t.id=e.id??"",e.createdAt!=null&&(t.createdAt=new Date(e.createdAt)||new Date(0)),t.workerId=e.workerId??"",t.signNewMultiBookingUsers=e.signNewMultiBookingUsers??!0,t}toJson(){const e={};return this.createdAt.getTime()!==new Date(0).getTime()&&(e.createdAt=this.createdAt.toISOString()),this.signNewMultiBookingUsers||(e.signNewMultiBookingUsers=this.signNewMultiBookingUsers),e.id=this.id,e.workerId=this.workerId,e}toString(){return JSON.stringify(this.toJson(),null,2)}}class Dt extends nx{customerName="";customerPhone="";customerId="";orderingOptions=ze.app;isVerifiedPhone=!1;isUserExist=!0;notificationType=yt.none;workerNotificationOption=Ie.PushOrSMS;workerRemindersTypes=new Map;workerDeleted=!1;clientMail="";showAdressAlert=!1;showPhoneAlert=!1;signOnDeviceCalendar=!1;isMultiRef=!1;cancelDate;lastTimeNotifyOnDebt;adress="";wasWaiting=!1;bookingDate=new Date(0);note="";needCancel=!1;treatments=new Map;userGender=z.anonymous;workerGender=z.anonymous;status=$e.approved;confirmedArrival=!1;bookingId="";userFcms=new Set;clientNote="";shopIcon=new Oe;remindersTypes=new Map;createdAt=new Date;finishInvoices=!1;invoices=new Map;transactions=new Map;recurrenceTimeId;recurreneFatherDate;debts=new Map;addToClientAt=!1;paymentRequest;userDeleted=!1;fatherMultiBooking;fatherRecurrenceBooking;constructor({workerId:e,workerName:t,businessName:n,buisnessId:r,workerPhone:s}){super({workerId:e,workerName:t,businessName:n,buisnessId:r,workerPhone:s})}static empty(){return new Dt({})}static fromBooking(e){const t=new Dt({});return t.customerName=e.customerName,t.customerPhone=e.customerPhone,t.customerId=e.customerId,t.workerPhone=e.workerPhone,t.workerGender=e.workerGender,t.userGender=e.userGender,t.businessName=e.businessName,t.buisnessId=e.buisnessId,t.bookingId=e.bookingId,t.workerGender=e.workerGender,t.shopIcon=e.shopIcon,t.recurrenceTimeId=e.recurrenceTimeId,t.note=e.note,t.workerRemindersTypes={...e.workerRemindersTypes},t.signOnDeviceCalendar=e.signOnDeviceCalendar,t.userDeleted=e.userDeleted,t.workerNotificationOption=e.workerNotificationOption,t.paymentRequest=e.paymentRequest,t.remindersTypes={...e.remindersTypes},t.isVerifiedPhone=e.isVerifiedPhone,t.workerDeleted=e.workerDeleted,t.finishInvoices=e.finishInvoices,t.adress=e.adress,t.addToClientAt=e.addToClientAt,t.showAdressAlert=e.showAdressAlert,t.showPhoneAlert=e.showPhoneAlert,t.orderingOptions=e.orderingOptions,t.isUserExist=e.isUserExist,t.isMultiRef=e.isMultiRef,t.needCancel=e.needCancel,t.userGender=e.userGender,t.bookingDate=e.bookingDate,t.recurrenceNotificationsLastDate=e.recurrenceNotificationsLastDate,t.cancelDate=e.cancelDate,t.customerId=e.customerId,t.workerPhone=e.workerPhone,t.lastTimeNotifyOnDebt=e.lastTimeNotifyOnDebt,e.debts.forEach((n,r)=>{t.debts.set(r,on.fromDebt(n))}),t.treatments=new Map,e.treatments.forEach((n,r)=>{const s=Re.fromTreatment(n);s.index=r,t.treatments.set(r,n)}),t.invoices=new Map,e.invoices.forEach((n,r)=>{t.invoices.set(r,It.fromBookingInvoiceData(n))}),t.clientNote=e.clientNote,t.status=e.status,t.confirmedArrival=e.confirmedArrival,t.createdAt=e.createdAt,t.clientMail=e.clientMail,t.workerName=e.workerName,t.buisnessId=e.buisnessId,t.notificationType=e.notificationType,t.userFcms=new Set(e.userFcms),t.recurreneFatherDate=e.recurreneFatherDate,t.recurrenceRef=e.recurrenceRef,t.transactions=new Map,e.transactions.forEach((n,r)=>{t.transactions.set(r,Tt.fromTransaction(n))}),t}static fromJson(e,t){const n=new Dt({});if(n.workerGender=je[e.workerGender]||z.anonymous,n.customerName=e.customerName||"",n.note=e.note||"",n.bookingId=t,n.signOnDeviceCalendar=e.signOnDeviceCalendar||!1,n.userDeleted=e.userDeleted||!1,n.workerDeleted=e.workerDeleted||!1,n.customerId=e.customerId||e.customerPhone||"",n.workerPhone=e.workerPhone||"",n.customerPhone=e.customerPhone||"",n.recurrenceTimeId=e.recurrenceTimeId,n.workerId=e.workerId||e.workerPhone||"",n.adress=e.adress||"",e.shopIcon!=null&&(n.shopIcon=Oe.fromJson(e.shopIcon)),n.isVerifiedPhone=e.isVerifiedPhone||!1,n.customerId==n.customerPhone&&n.customerId.length==14&&(n.isVerifiedPhone=!0),n.isMultiRef=e.isMultiRef||!1,n.needCancel=e.needCancel||!1,e.lastTimeNotifyOnDebt!=null&&(n.lastTimeNotifyOnDebt=new Date(e.lastTimeNotifyOnDebt)),n.finishInvoices=e.finishInvoices||!1,e.remindersTypes!=null?Object.entries(e.remindersTypes).forEach(([r,s])=>{_t[r]!=null&&n.remindersTypes.set(_t[r],s)}):n.remindersTypes=new Map([dt.regular,e.minutesBeforeNotify||60]),e.workerRemindersTypes!=null&&Object.entries(e.workerRemindersTypes).forEach(([r,s])=>{_t[r]!=null&&n.workerRemindersTypes.set(_t[r],s)}),n.clientMail=e.clientMail||"",e.recurrenceNotificationsLastDate!=null&&(n.recurrenceNotificationsLastDate=new Date(e.recurrenceNotificationsLastDate)),n.clientNote=e.clientNote||"",n.recurreneFatherDate=e.recurreneFatherDate,n.recurrenceRef=e.recurrenceRef,e.orderingOptions!=null&&(n.orderingOptions=tl[e.orderingOptions]||ze.app),e.debts!=null&&Object.entries(e.debts).forEach(([r,s])=>{n.debts.set(r,on.fromJson(s,r))}),e.cancelDate!=null&&(n.cancelDate=new Date(e.cancelDate)),n.wasWaiting=e.wasWaiting||!1,n.isUserExist=e.isUserExist||!0,e.invoices!=null&&Object.entries(e.invoices).forEach(([r,s])=>{n.invoices.set(r,It.fromJson(s,r,n.workerId))}),e.userGender!=null&&(n.userGender=je[e.userGender]||z.anonymous),n.status=j0[e.status.toString()]||$e.approved,n.confirmedArrival=e.confirmedArrival||!1,e.bookingDate!=null&&(n.bookingDate=new Date(e.bookingDate)||new Date(0)),e.treatments!=null){n.treatments=new Map;let r=0;Object.entries(e.treatments).forEach(([s,o])=>{const a=e.treatments[r.toString()];n.treatments.set(r.toString(),Re.fromJson(a,r.toString())),r+=1})}else if(e.treatment!=null){const r=Re.fromJson(e.treatment,"0");n.treatments.set("0",r)}return n.showAdressAlert=e.showAdressAlert||!1,n.showPhoneAlert=e.showPhoneAlert||!1,n.workerName=e.workerName||"",n.businessName=e.businessName||"",n.buisnessId=e.buisnessId||"",e.notificationType!=null?n.notificationType=nl[e.notificationType]||yt.push:e.withMessage?n.notificationType=yt.message:n.notificationType=yt.push,e.workerNotificationOption!=null&&(n.workerNotificationOption=tr[e.workerNotificationOption]||Ie.PushOrSMS),e.userFcms!=null?e.userFcms.forEach(r=>{n.userFcms.add(r)}):e.deviceFCM!=null&&e.deviceFCM!=""&&(n.userFcms=new Set([e.deviceFCM])),e.createdAt!=null&&(n.createdAt=new Date(e.createdAt)||new Date(0)),n.transactions=new Map,e.transactions!=null&&Object.entries(e.transactions).forEach(([r,s])=>{n.transactions.set(r,Tt.fromJson(s,r))}),e.paymentRequest!=null&&(n.paymentRequest=mo.fromJson(e.paymentRequest)),n}get treatmentLength(){return Array.from(this.treatments.values()).reduce((e,t)=>t.count+e,0)}get treatmentsToStringNotDetailed(){return this.treatmentLength===1?this.treatments.values().next().value.name:this.treatments.size===1?`${this.treatments.values().next().value.name}x${this.treatmentLength}`:`${this.treatments.values().next().value.name}+${this.treatmentLength-1}`}get totalMinutes(){let e=0;return this.treatments.forEach((t,n)=>{e+=t.totalMinutesForBooking}),e}toJson(){const e={};return e.workerGender=Hn[this.workerGender],e.customerName=this.customerName,e.note=this.note,e.customerId=this.customerId,this.wasWaiting&&(e.wasWaiting=this.wasWaiting),this.workerDeleted&&(e.workerDeleted=this.workerDeleted),this.cancelDate!=null&&(e.cancelDate=this.cancelDate.toString()),e.remindersTypes={},this.clientNote!=""&&(e.clientNote=this.clientNote),this.finishInvoices&&(e.finishInvoices=this.finishInvoices),this.debts.size>0&&(e.debts={},this.debts.forEach((t,n)=>{e.debts[n]=t.toJson()})),this.lastTimeNotifyOnDebt!=null&&(e.lastTimeNotifyOnDebt=this.lastTimeNotifyOnDebt.toString()),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.userDeleted&&(e.userDeleted=this.userDeleted),e.bookingId=this.bookingId,e.needCancel=this.needCancel,e.userGender=Hn[this.userGender],e.businessName=this.businessName,this.signOnDeviceCalendar&&(e.signOnDeviceCalendar=this.signOnDeviceCalendar),this.recurrenceTimeId!=null&&(e.recurrenceTimeId=this.recurrenceTimeId),e.treatments={},this.recurrenceRef!=null&&(e.recurrenceRef=this.recurrenceRef),this.recurreneFatherDate!=null&&(e.recurreneFatherDate=this.recurreneFatherDate),this.treatments.forEach((t,n)=>{e.treatments[n.toString()]=t.toJson()}),e.invoices={},this.invoices.forEach((t,n)=>{e.invoices[n]=t.toJson()}),this.isMultiRef&&(e.isMultiRef=this.isMultiRef),this.isUserExist||(e.isUserExist=this.isUserExist),this.orderingOptions!=ze.app&&(e.orderingOptions=el[this.orderingOptions]),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.adress!=""&&(e.adress=this.adress),this.clientMail!=""&&(e.clientMail=this.clientMail),e.customerPhone=this.customerPhone,e.status=Z0[this.status],e.confirmedArrival=this.confirmedArrival,e.bookingDate=this.bookingDate.toISOString(),e.workerId=this.workerId.toString(),e.workerName=this.workerName,e.buisnessId=this.buisnessId,e.shopIcon=this.shopIcon.toJson(),this.recurrenceNotificationsLastDate!=null&&(e.recurrenceNotificationsLastDate=this.recurrenceNotificationsLastDate.toString()),e.notificationType=Zf[this.notificationType],e.workerNotificationOption=jf[this.workerNotificationOption],e.userFcms=Array.from(this.userFcms),e.createdAt=this.createdAt.toISOString(),e.transactions={},this.transactions.forEach((t,n)=>{e.transactions[n]=t.toJson()}),this.paymentRequest!=null&&(e.paymentRequest=this.paymentRequest.toJson()),e}}class sx{futureBookings={};passedBookings={};recurrence;setMonth(e,t){const n=al(t),r=cl(new Date);n.getTime()===r.getTime()?(this.passedBookings[t]={},this.futureBookings[t]={}):n.getTime()>r.getTime()?this.futureBookings[t]={}:n.getTime()<r.getTime()&&(this.passedBookings[t]={}),Object.entries(e).forEach(([s,o])=>{const a=Dt.fromJson(o,s);a.cancelDate===null&&(a.isPassed?this.passedBookings[t][s]=a:this.futureBookings[t][s]=a)})}setRecurrence(e){this.recurrence={},Object.entries(e).forEach(([t,n])=>{const r=Dt.fromJson(n,t);r.cancelDate===null&&(this.recurrence[t]=r)})}get all(){const e={};return Object.values(this.futureBookings).forEach(t=>{Object.entries(t).forEach(([n,r])=>{e[r.bookingId]=r})}),Object.values(this.passedBookings).forEach(t=>{Object.entries(t).forEach(([n,r])=>{e[r.bookingId]=r})}),this.recurrence!==void 0&&Object.entries(this.recurrence).forEach(([t,n])=>{e[t]=n}),e}addBooking(e){if(e.recurrenceEvent!==null)this.recurrence??={},this.recurrence[e.bookingId]=e;else{const t=bs(e.bookingDate);e.isPassed?(this.passedBookings[t]??={},this.passedBookings[t][e.bookingId]=e):(this.futureBookings[t]??={},this.futureBookings[t][e.bookingId]=e)}}deleteBooking(e){if(e.recurrenceEvent!==null)delete this.recurrence?.[e.bookingId];else{const t=bs(e.bookingDate);delete this.passedBookings[t]?.[e.bookingId],delete this.futureBookings[t]?.[e.bookingId]}}lastBookingForBusiness(e,t,n=!1,r,s){let o=r;return Object.entries(this.futureBookings).forEach(([a,l])=>{Object.entries(l).forEach(([c,h])=>{e!==h.buisnessId||t!==h.workerId||s!==void 0&&s.getTime()===h.bookingDate.getTime()||(o===void 0||h.bookingDate.getTime()>o.getTime())&&(o=h.bookingDate)})}),o}}class po{customerName="";customerPhone="";isVerifiedPhone=!1;notificationType=yt.none;workerNotificationOption=Ie.PushOrSMS;workerRemindersTypes=new Map;customerId="";orderingOptions=ze.app;remindersTypes=new Map;isUserExist=!0;signOnDeviceCalendar=!1;lastTimeNotifyOnDebt=null;clientMail="";finishInvoices=!1;showAdressAlert=!1;userBookingId="";showPhoneAlert=!1;cancelDate=null;wasWaiting=!1;createdAt=new Date(0);needCancel=!1;userGender=z.anonymous;status=$e.approved;confirmedArrival=!1;userFcms=new Set;clientNote="";invoices=new Map;transactions=new Map;debts=new Map;addToClientAt=!1;userDeleted=!1;constructor(){}copyDataToOrder(e){const{worker:t,needToHoldOn:n,workerAction:r,bookingDate:s,addToCalendar:o,noteText:a=""}=e;if(this.clientNote=a,n?this.status=$e.waiting:this.status=$e.approved,this.showAdressAlert=t.notifications.showAdressAlert,this.showPhoneAlert=t.notifications.showPhoneAlert,!r&&!n&&s.getTime()-Date.now()<60*60*1e3&&(this.confirmedArrival=!0),this.signOnDeviceCalendar=o,this.workerNotificationOption=t.notifications.notificationOption,this.workerRemindersTypes=new Map(t.notifications.remindersTypes),t.notifications.remindersTypes.forEach((l,c)=>{s.getTime()<Date.now()||c===dt.confirmArrival&&this.confirmedArrival||(s.getTime()-l*60*1e3<Date.now()+1e3?(this.remindersTypes.set(c,Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))-Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))%5),this.remindersTypes.get(c)<10&&this.remindersTypes.delete(c)):this.remindersTypes.set(c,l))}),this.orderingOptions=ze.web,this.isUserExist=!0,r){const l=t.customers.customersData.get(this.customerId);this.addToClientAt=(l?.amoutOfBookings||0)<=0,this.isVerifiedPhone=l?.isVerifiedPhone||!1}else{this.userFcms=new Set(Ee.GI().user.userPublicData.fcmsTokens),this.isVerifiedPhone=Ee.GI().user.isVerifiedPhone;const l=Ee.GI().user.userPublicData.clientAt;this.addToClientAt=!l.has(wt.GI().business.businessId)||!l.get(wt.GI().business.businessId).has(t.id)}this.createdAt.getTime()===new Date(0).getTime()&&(this.createdAt=new Date),this.userBookingId,this.notificationType=sendMessageForMulti(this,t)}get toCustomerData(){return{name:this.customerName,phoneNumber:this.customerPhone,isVerifiedPhone:this.isVerifiedPhone,email:this.clientMail,customerUuid:this.customerId,gender:this.userGender}}get isDepositTransaction(){let e=!1;return this.transactions.forEach((t,n)=>{e=t.type===PaymentTypes.deposit}),e}get transactionsTotalPaymentAmount(){let e=0;return this.transactions.forEach((t,n)=>{t.type===PaymentTypes.payment&&(e+=t.amount)}),e}get canSendMessage(){return this.isVerifiedPhone||this.orderingOptions===ze.byWorker}get totalDebtAmount(){let e=0;return this.debts.forEach((t,n)=>{e+=t.amount}),e}get invoicePriceAmount(){return Array.from(this.invoices.values()).reduce((e,t)=>e+t.amount,0)}invoicesCoverPrice(e){const{totalAmount:t}=e;return this.finishInvoices||this.invoices.size>0&&Array.from(this.invoices.values()).reduce((n,r)=>n+r.amount,0)>=t}get transactionsTotalDepositAmount(){let e=0;return this.transactions.forEach((t,n)=>{t.type===PaymentTypes.deposit&&(e+=t.amount)}),e}get customerHashPhone(){return fo(this.customerPhone)}get customerPhoneAsCollection(){return this.customerPhone.replace(/-/g,"")}reminderId(e){return this.userBookingId+"__"+_r[e]}get toPaymentRequestUser(){return new Xn({name:this.customerName,userId:this.customerId,gender:this.userGender,isExist:this.isUserExist,isVerifiedPhone:this.isVerifiedPhone,phone:this.customerPhone})}get toBooking(){const e=new Map;this.invoices.forEach((n,r)=>{e.set(r,It.fromBookingInvoiceData(n))});const t=new Map;return this.transactions.forEach((n,r)=>{t.set(n,Tt.fromTransaction(r))}),{customerName:this.customerName,customerPhone:this.customerPhone,showAdressAlert:this.showAdressAlert,showPhoneAlert:this.showPhoneAlert,orderingOptions:this.orderingOptions,isUserExist:this.isUserExist,needCancel:this.needCancel,userGender:this.userGender,userDeleted:this.userDeleted,bookingId:this.userBookingId,signOnDeviceCalendar:this.signOnDeviceCalendar,finishInvoices:this.finishInvoices,cancelDate:this.cancelDate,isVerifiedPhone:this.isVerifiedPhone,customerId:this.customerId,clientNote:this.clientNote,lastTimeNotifyOnDebt:this.lastTimeNotifyOnDebt,debts:this.debts,status:this.status,confirmedArrival:this.confirmedArrival,clientMail:this.clientMail,notificationType:this.notificationType,userFcms:new Set(this.userFcms),workerNotificationOption:this.workerNotificationOption}.workerRemindersTypes=new Map(this.workerRemindersTypes).createdAt=this.createdAt.invoices=e.transactions=t}get typesOfEvents(){const e=new Map;return this.needCancel&&e.set(hi.needCancel,1),this.debts.size>0&&e.set(hi.withDebts,1),this.status===$e.waiting&&e.set(hi.onHold,1),e}static fromJson(e,t,n){const r=new po;return r.customerName=e.customerName||"",r.customerId=e.customerId||"",r.customerPhone=e.customerPhone||this.customerId,r.needCancel=e.needCancel||!1,r.remindersTypes=e.remindersTypes?new Map(Object.entries(e.remindersTypes).map(([s,o])=>[_t[s],o])):new Map([[dt.regular,e.minutesBeforeNotify||60]]),r.workerRemindersTypes=e.workerRemindersTypes?new Map(Object.entries(e.workerRemindersTypes).map(([s,o])=>[_t[s],o])):new Map,r.signOnDeviceCalendar=e.signOnDeviceCalendar||!1,r.userDeleted=e.userDeleted||!1,r.isVerifiedPhone=e.isVerifiedPhone||!1,r.clientMail=e.clientMail||"",r.clientNote=e.clientNote||"",r.userBookingId=t,r.orderingOptions=tl[e.orderingOptions]||ze.app,r.debts=e.debts?new Map(Object.entries(e.debts).map(([s,o])=>[s,on.fromJson(o,s)])):new Map,r.finishInvoices=e.finishInvoices||!1,r.cancelDate=e.cancelDate?new Date(e.cancelDate):null,r.wasWaiting=e.wasWaiting||!1,r.isUserExist=e.isUserExist||!0,r.lastTimeNotifyOnDebt=e.lastTimeNotifyOnDebt?new Date(e.lastTimeNotifyOnDebt):null,r.invoices=e.invoices?new Map(Object.entries(e.invoices).map(([s,o])=>[s,It.fromJson(o,s,n)])):new Map,r.userGender=je[e.userGender]||z.anonymous,r.status=j0[e.status.toString()]||$e.approved,r.confirmedArrival=e.confirmedArrival||!1,r.showAdressAlert=e.showAdressAlert||!1,r.showPhoneAlert=e.showPhoneAlert||!1,r.notificationType=nl[e.notificationType]||yt.none,r.workerNotificationOption=tr[e.workerNotificationOption]||Ie.PushOrSMS,r.userFcms=e.userFcms?new Set(e.userFcms):e.deviceFCM&&e.deviceFCM!==""?new Set([e.deviceFCM]):new Set,r.createdAt=e.createdAt?new Date(e.createdAt):new Date(0),r.transactions=e.transactions?new Map(Object.entries(e.transactions).map(([s,o])=>[s,Tt.fromJson(o,s)])):new Map,r}toJson(){const e={};return e.customerName=this.customerName,e.customerId=this.customerId,this.wasWaiting&&(e.wasWaiting=this.wasWaiting),this.cancelDate&&(e.cancelDate=this.cancelDate.toISOString()),e.remindersTypes={},this.remindersTypes.forEach((t,n)=>{e.remindersTypes[_r[t]]=n}),e.workerRemindersTypes={},this.workerRemindersTypes.forEach((t,n)=>{e.workerRemindersTypes[_r[t]]=n}),this.userDeleted&&(e.userDeleted=this.userDeleted),this.signOnDeviceCalendar&&(e.signOnDeviceCalendar=this.signOnDeviceCalendar),this.clientNote!==""&&(e.clientNote=this.clientNote),this.needCancel&&(e.needCancel=this.needCancel),this.finishInvoices&&(e.finishInvoices=this.finishInvoices),e.userGender=genderToStr[this.userGender],this.invoices.size>0&&(e.invoices={},this.invoices.forEach((t,n)=>{e.invoices[t]=n.toJson()})),this.debts.size>0&&(e.debts={},this.debts.forEach((t,n)=>{e.debts[t]=n.toJson()})),this.lastTimeNotifyOnDebt&&(e.lastTimeNotifyOnDebt=this.lastTimeNotifyOnDebt.toISOString()),this.isUserExist||(e.isUserExist=this.isUserExist),this.orderingOptions!==ze.app&&(e.orderingOptions=el[this.orderingOptions]),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.clientMail!==""&&(e.clientMail=this.clientMail),e.customerPhone=this.customerPhone,this.status!==$e.approved&&(e.status=Z0[this.status]),this.confirmedArrival&&(e.confirmedArrival=this.confirmedArrival),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.userFcms.size>0&&(e.userFcms=Array.from(this.userFcms)),e.createdAt=this.createdAt.toISOString(),this.transactions.size>0&&(e.transactions={},this.transactions.forEach((t,n)=>{e.transactions[t]=n.toJson()})),e}toString(){return JSON.stringify(this,null,"  ")}}class Yt{freeFromPayments;hashNumber;blocked;constructor({freeFromPayments:e=!1,hashNumber:t="",blocked:n=!1}={}){this.freeFromPayments=e,this.hashNumber=t,this.blocked=n}static fromJson(e,t){return new Yt({freeFromPayments:e.freeFromPayments,hashNumber:t})}static fromMinimalJson(e,t){return new Yt({blocked:e.B??!1,freeFromPayments:e.FP,hashNumber:t})}static fromCustomerData(e){return new Yt({blocked:e.blocked,freeFromPayments:e.freeFromPayments,hashNumber:e.hashNumber})}toJson(){const e={};return e.freeFromPayments=this.freeFromPayments,e.blocked=this.blocked,e}toMinimalJson(){const e={};return e.FP=this.freeFromPayments,e.B=this.blocked,e}toString(){return JSON.stringify(this.toJson(),null,2)}}const ox=3;class Ni{name="";workerNaming="";phoneNumber="";freeFromPayments=!1;isExapmle=!1;id="";customerUuid="";blocked=!1;isVerifiedPhone=!1;email="";addedManually=!1;gender=z.male;amoutOfBookings=0;firstBookingsDate;userFirstBookingsDate;lastBookingsDate;belongings=new Set;isDeleted=!1;constructor({name:e="",amoutOfBookings:t=0,gender:n=z.male,email:r="",id:s="",freeFromPayments:o=!1,addedManually:a=!1,customerUuid:l="",isVerifiedPhone:c=!1,workerNaming:h="",blocked:d=!1,phoneNumber:u="",firstBookingsDate:f,userFirstBookingsDate:m,lastBookingsDate:v}){this.name=e,this.amoutOfBookings=t,this.gender=n,this.email=r,this.id=s,this.freeFromPayments=o,this.addedManually=a,this.customerUuid=l,this.isVerifiedPhone=c,this.workerNaming=h,this.blocked=d,this.phoneNumber=u,this.firstBookingsDate=f,this.userFirstBookingsDate=m,this.lastBookingsDate=v}static fromJson(e,t){const n=new Ni({});return n.name=e.name??"",e.gender!=null&&(n.gender=n.getGenderFromStr(e.gender)),n.isVerifiedPhone=e.isVerifiedPhone??!1,n.freeFromPayments=e.freeFromPayments??!1,n.customerUuid=t,n.phoneNumber=e.phoneNumber??(t.length<20&&t.includes("-")?t:""),e.firstBookingsDate!=""&&e.firstBookingsDate!=null&&(n.firstBookingsDate=new Date(e.firstBookingsDate)),e.userFirstBookingsDate!=""&&e.userFirstBookingsDate!=null&&(n.userFirstBookingsDate=new Date(e.userFirstBookingsDate),(n.firstBookingsDate==null||n.userFirstBookingsDate<n.firstBookingsDate)&&(n.firstBookingsDate=n.userFirstBookingsDate)),e.lastBookingsDate!=null&&(n.lastBookingsDate=new Date(e.lastBookingsDate)),n.workerNaming=e.workerNaming??"",n.amoutOfBookings=e.amoutOfBookings??0,n.blocked=e.blocked??!1,n.email=e.email??"",n.id=e.id??"",n.addedManually=e.AM??!1,n}fromCustomerData(e){return this.name=e.name,this.gender=e.gender,this.isVerifiedPhone=e.isVerifiedPhone,this.phoneNumber=e.phoneNumber,this.belongings=e.belongings,this.email=e.email,this.isDeleted=e.isDeleted,this.blocked=e.blocked,this.id=e.id,this.addedManually=e.addedManually,this.freeFromPayments=e.freeFromPayments,this.customerUuid=e.customerUuid,this.workerNaming=e.workerNaming,this.firstBookingsDate=e.firstBookingsDate,this.lastBookingsDate=e.lastBookingsDate,this.amoutOfBookings=e.amoutOfBookings,this.userFirstBookingsDate=e.userFirstBookingsDate,this}get nameForWorker(){return this.workerNaming==""?this.name:this.workerNaming}get getFirstDate(){return this.firstBookingsDate==null||this.userFirstBookingsDate!=null&&this.userFirstBookingsDate<this.firstBookingsDate?this.userFirstBookingsDate:this.firstBookingsDate}get customerHashPhone(){return fo(this.phoneNumber)}get customerPhoneAsCollection(){return this.phoneNumber.replaceAll("-","")}isTheSameAs(e,{withId:t=!1}={}){const n=this.toJson();t&&(n.id=e.customerUuid);const r=e.toJson();return t&&(r.id=this.customerUuid),JSON.stringify(r)===JSON.stringify(n)}getType({bookingInMonthForRegularClient:e,worker:t}){return t.id===this.customerUuid?5:this.isDeleted?7:this.amoutOfBookings<=ox?2:this.amountOfBookingsInMonth()<e?1:0}getGenderFromStr(e){return e==null||e=="A"?z.anonymous:e=="F"?z.female:z.male}getStrFromGender(e){return{[z.anonymous]:"A",[z.male]:"M",[z.female]:"F"}[e]||"A"}get toMultiBookingUser(){const e=new po;return e.customerName=this.name!=""?this.name:this.workerNaming,e.customerPhone=this.phoneNumber,e.customerId=this.customerUuid,e.userGender=this.gender,e}get toPaymentRequestUser(){return new Xn({userId:this.customerUuid,name:this.nameForWorker,gender:this.gender,isExist:!this.addedManually,isVerifiedPhone:this.isVerifiedPhone,phone:this.phoneNumber})}isMissing(e){return this.lastBookingsDate==null?!1:(new Date().getTime()-this.lastBookingsDate.getTime())/(1e3*3600*24)>e}amountOfBookingsInMonth(){if(this.firstBookingsDate==null)return-1;if(this.lastBookingsDate==null)return 0;const e=this.lastBookingsDate>new Date?new Date:this.lastBookingsDate,t=Math.max((e.getTime()-this.firstBookingsDate.getTime())/(1e3*3600*24),1);return this.amoutOfBookings/t*30}toJson(){const e={};return this.name!==""&&(e.name=this.name),this.gender!==z.male&&(e.gender=this.getStrFromGender(this.gender)),this.phoneNumber!==this.id&&(e.phoneNumber=this.phoneNumber),this.firstBookingsDate!=null&&(e.firstBookingsDate=this.firstBookingsDate.toISOString()),this.userFirstBookingsDate!=null&&(e.userFirstBookingsDate=this.userFirstBookingsDate.toISOString()),this.lastBookingsDate!=null&&(e.lastBookingsDate=this.lastBookingsDate.toISOString()),this.amoutOfBookings!==0&&(e.amoutOfBookings=this.amoutOfBookings),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.freeFromPayments=this.freeFromPayments,this.email!==""&&(e.email=this.email),e.blocked=this.blocked,this.id!==""&&(e.id=this.id),this.addedManually&&(e.AM=this.addedManually),this.workerNaming!==""&&(e.workerNaming=this.workerNaming),e}toMinimalJson(){const e={};return e.N=this.name!==""?this.name:this.workerNaming,e.G=this.getStrFromGender(this.gender),e.P=this.phoneNumber,this.phoneNumber!==this.customerUuid&&(e.CU=this.customerUuid),this.email!==""&&(e.E=this.email),this.id!==""&&(e.ID=this.id),e}merge(e){return!e.addedManually&&this.addedManually&&(this.email=e.email!==""?e.email:this.email,this.name=e.name!==""?e.name:this.name,this.addedManually=!1,this.customerUuid=e.customerUuid),this.workerNaming===""&&(this.workerNaming=e.workerNaming),this.isVerifiedPhone=e.isVerifiedPhone||this.isVerifiedPhone,this.gender=this.gender,this.blocked=e.blocked||this.blocked,this.lastBookingsDate=up(e.lastBookingsDate,this.lastBookingsDate),this.firstBookingsDate=Oa(e.firstBookingsDate,this.firstBookingsDate),this.userFirstBookingsDate=Oa(e.userFirstBookingsDate,this.userFirstBookingsDate),this.amoutOfBookings+=e.amoutOfBookings,this}fromMinimalJson(e){return this.workerNaming=e.N??"",this.name=e.N??"",e.G!=null&&(this.gender=this.getGenderFromStr(e.gender)),this.addedManually=e.AM??!1,this.phoneNumber=e.P??"",this.customerUuid=e.CU??e.P??"",this.email=e.E??"",this.id=e.ID??"",this}get publicCustomer(){return new Yt({freeFromPayments:this.freeFromPayments,blocked:this.blocked,hashNumber:tx({id:this.customerUuid})})}belongingsNames(e){return Array.from(this.belongings).map(t=>e.get(t)?.name??"").join(", ")}get forUpdate(){const e=new Ni({});return e.name=this.name,e.gender=this.gender,e.isVerifiedPhone=this.isVerifiedPhone,e.phoneNumber=this.phoneNumber,e.belongings=this.belongings,e.email=this.email,e.isDeleted=this.isDeleted,e.blocked=this.blocked,e.id=this.id,e.addedManually=this.addedManually,e.freeFromPayments=this.freeFromPayments,e.customerUuid=this.customerUuid,e.workerNaming=this.workerNaming,e.firstBookingsDate=null,e.userFirstBookingsDate=null,e.amoutOfBookings=0,e.lastBookingsDate=null,e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class xo{docId="";path="";constructor(e,t){this.docId=e,this.path=t}toJson(){const e={};return e.docId=this.docId,e.path=this.path,e}static fromJson(e){const t=new xo("","");return t.docId=e.docId||"",t.path=e.path||"",t}toString(){return JSON.stringify(this,null,2)}}class go{bookingCount=0;lastUpdateTime=new Date(0);docId="";constructor({docId:e=""}){this.docId=e}static fromJson(e,t){const n=new go({});return e!==void 0&&t!==void 0&&(n.docId=t,n.bookingCount=e.bookingCount??0,n.lastUpdateTime=e.lastUpdateTime?new Date(e.lastUpdateTime):new Date(0)),n}toJson(){const e={};return this.lastUpdateTime.getTime()!==new Date(0).getTime()&&(e.lastUpdateTime=this.lastUpdateTime.toISOString()),this.bookingCount>0&&(e.bookingCount=this.bookingCount),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class Pn{email="";name="";phoneNumber="";id="";devices=new Map;gender=z.anonymous;myBuisnessesIds=[];reminders;clientAt=new Map;hasNotificationPermission=!0;permission=new Map;tempFcm;allowAppNotification=!0;isVerifiedPhone=!1;isVerifiedEmail=!1;invoiceCounter;newWorkerWelcomes=new Set;bookings=new Map;bookingsPreviews=new Map;bookingsDocsToLoad=new Set;localDocsToDelete=new Set;constructor(e){this.email=e.email||"",this.isVerifiedPhone=e.isVerifiedPhone||!1,this.isVerifiedEmail=e.isVerifiedEmail||!1,this.name=e.name||"",this.phoneNumber=e.phoneNumber||"",this.id=e.id||"",this.gender=e.gender||z.anonymous,this.devices=e.devices,this.myBuisnessesIds=e.myBuisnessesIds,this.bookings=e.bookings}static fromJson(e,t){const n=new Pn({email:e.email,isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:e.isVerifiedEmail,name:e.name,phoneNumber:e.phoneNumber,id:e.id,gender:e.gender,devices:e.devices,myBuisnessesIds:e.myBuisnessesIds,bookings:e.bookings});return n.setUserPublicData(e,t),n}get customerData(){return new Ni({customerUuid:this.id,name:this.name,email:this.email,isVerifiedPhone:this.isVerifiedPhone,gender:this.gender,phoneNumber:this.phoneNumber})}setUserPublicData(e,t){if(this.permission=new Map,this.myBuisnessesIds=[],this.isVerifiedEmail=e.isVerifiedEmail||!1,this.email=e.email||"",this.allowAppNotification=e.allowAppNotification||!0,this.email=e.email||"",this.name=e.name||"",this.clientAt=new Map,e.clientAt&&Object.entries(e.clientAt).forEach(([n,r])=>{Object.keys(r).length!==0&&(this.clientAt.set(n,new Set),Object.keys(r).forEach(s=>{this.clientAt.set(n,this.clientAt.get(n).add(s))}))}),e.localDocsToDelete&&(this.localDocsToDelete=new Set,e.localDocsToDelete.forEach(n=>{this.localDocsToDelete.add(xo.fromJson(n))})),this.invoiceCounter=e.invoiceCounter,this.devices=new Map,e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([n,r])=>{this.devices.set(n,We.fromJson(r,n))}):e.currentFcm&&e.currentFcm!==""&&(this.tempFcm=e.currentFcm),this.hasNotificationPermission=e.hasNotificationPermission||!0,e.gender&&(this.gender=je[e.gender]||z.anonymous),this.phoneNumber=e.phoneNumber||"",this.id=e.id||e.phoneNumber||"",e.permission&&Object.entries(e.permission).forEach(([n,r])=>{r===2&&this.myBuisnessesIds.push(n),this.permission.set(n,r)}),e.bookings&&(this.bookings=new Map,Object.entries(e.bookings).forEach(([n,r])=>{const s=Dt.fromJson(r,n);s.cancelDate||this.bookings.set(n,s)})),this.bookingsDocsToLoad=new Set,e.bookingsPreviews){const n=new Map;Object.entries(e.bookingsPreviews).forEach(([r,s])=>{n.set(r,go.fromJson(s,r))}),n.forEach((r,s)=>{this.bookingsPreviews.get(s)?.lastUpdateTime!==r.lastUpdateTime&&(s===Nc||al(s)>=cl(new Date)||(t?.bookings.passedBookings?.hasOwnProperty(s)??!1))&&this.bookingsDocsToLoad.add(s)}),this.bookingsPreviews=n}this.id===this.phoneNumber?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1,this.newWorkerWelcomes=new Set,e.newWorkerWelcomes&&Object.keys(e.newWorkerWelcomes).forEach(n=>{this.newWorkerWelcomes.add(n)})}get fcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm)return new Set(this.tempFcm);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDevicesByToken(e){const t=[];return Object.values(this.devices).forEach(n=>{n.token===e&&t.push(We.fromDevice(n))}),t}toJson(){const e={};return this.hasNotificationPermission||(e.hasNotificationPermission=this.hasNotificationPermission),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.isVerifiedEmail&&(e.isVerifiedEmail=this.isVerifiedEmail),this.email!==""&&(e.email=this.email),Object.keys(this.bookingsPreviews).length>0&&(e.bookingsPreviews={},Object.entries(this.bookingsPreviews).forEach(([t,n])=>{e.bookingsPreviews[t]=n.toJson()})),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),e.permission={},Object.entries(this.permission).forEach(([t,n])=>{e.permission[t]=n}),this.localDocsToDelete.size>0&&(e.localDocsToDelete=[],this.localDocsToDelete.forEach(t=>{e.localDocsToDelete.push(t.toJson())})),e.email=this.email,e.name=this.name,e.devices={},this.devices.forEach((t,n)=>{e.devices[n]=t.toJson()}),e.clientAt={},this.clientAt.forEach((t,n)=>{e.clientAt[n]={},t.forEach(r=>{e.clientAt[n][r]=""})}),e.gender=Hn[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,this.newWorkerWelcomes.size>0&&(e.newWorkerWelcomes={},this.newWorkerWelcomes.forEach(t=>{e.newWorkerWelcomes[t]=""})),e}}class vo{businessId="";date;productId="";constructor(e,t,n){this.businessId=e,this.date=t,this.productId=n}static fromJson(e,t){const n=new vo(t,null,"");return n.businessId=e.businessId||"",e.date instanceof ct&&(n.date=e.date),n}toJson(){const e={};return e.businessId=this.businessId,this.date!==null&&this.date!==void 0&&(e.date=this.date),e}}class Oi{productsIds={};pendingProductsIds={};id="";revenueCatId="";limitOfBuisnesses=1;preferdTipPercentage=0;cardPaymentsPass="";lastTimeUpdatePhone=new Date(0);lastTimeUpdateEmail=new Date(0);authProviders={};businessesInfo={};storyLikes=[];paymentCards={};lastVisitedBuisnesses=[];lastVisitedBuisnessesRemoved=[];lastCleanDate=ct.fromDate(new Date);businessTopics=new Set;waitingListTopics={};tempFcm;termsApprovals={};seenUpdates={};createdAt=new Date;userPublicData=new Pn({devices:{},myBuisnessesIds:[]});name="";isVerifiedPhone=!1;phoneNumber="";gender=z.anonymous;lastTimeConnect=new Date;userPublicDataListener;connectedGoogleEmail="";currentMonthInvoices;currentMonthPaymentRequest;currentMonthPayments;existInvoicesDocs=new Set;existPaymentsDocs=new Set;existPaymentRequestsDocs=new Set;invoices={};devices={};bookings=new sx;hasOldNotification=!1;constructor({name:e="",phoneNumber:t="",id:n="",productsIds:r={},myBuisnessesIds:s=[],revenueCatId:o="",limitOfBuisnesses:a=1,gender:l=z.anonymous,lastVisitedBuisnesses:c=[],lastVisitedBuisnessesRemoved:h=[],paymentCards:d={},isVerifiedPhone:u=!1,isVerifiedEmail:f=!1,email:m="",lastCleanDate:v=ct.fromDate(new Date),createdAt:g=new Date}){this.userPublicData=new Pn({email:m,isVerifiedEmail:f,isVerifiedPhone:u,name:e,phoneNumber:t,id:n,devices:this.devices,gender:l,myBuisnessesIds:s}),this.name=e,this.phoneNumber=t,this.id=n,this.productsIds=r,this.revenueCatId=o,this.limitOfBuisnesses=a,this.gender=l,this.lastVisitedBuisnesses=c,this.lastVisitedBuisnessesRemoved=h,this.paymentCards=d,this.isVerifiedPhone=u,this.cardPaymentsPass="",this.lastCleanDate=v,this.createdAt=g}get toPaymentRequestUser(){return new Xn({userId:this.id,name:this.name,gender:this.gender,isVerifiedPhone:this.isVerifiedPhone,isExist:!0,phone:this.phoneNumber,userDecline:!1})}get fcmsTokens(){if(!this.userPublicData.allowAppNotification)return new Set;if(this.tempFcm)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDeviceByToken(e){let t;return Object.values(this.devices).forEach(n=>{n.token===e&&(t=We.fromDevice(n))}),t}static fromUserDocJson(e){const t=new Oi({name:e.name,phoneNumber:e.phoneNumber,id:e.id,productsIds:{},myBuisnessesIds:[],revenueCatId:e.revenueCatId,limitOfBuisnesses:e.limitOfBuisnesses,gender:je[e.gender],lastVisitedBuisnesses:e.lastVisitedBuisnesses,lastVisitedBuisnessesRemoved:e.lastVisitedBuisnessesRemoved,paymentCards:{},isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:!1,email:"",lastCleanDate:e.lastCleanDate,createdAt:new Date(e.createdAt)});return e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([n,r])=>{t.devices[n]=We.fromJson(r,n)}):e.currentFcm&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),e.termsApprovals&&Object.entries(e.termsApprovals).forEach(([n,r])=>{t.termsApprovals[n]=new Date(r)||new Date(0)}),t.seenUpdates={},e.seenUpdates&&Object.entries(e.seenUpdates).forEach(([n,r])=>{t.seenUpdates[n]=new Set(r)}),t.phoneNumber=e.phoneNumber||"0",t.id=e.id||e.phoneNumber,t.preferdTipPercentage=0,e.preferdTipPercentage&&(t.preferdTipPercentage=Number.isInteger(e.preferdTipPercentage)?e.preferdTipPercentage:Math.floor(e.preferdTipPercentage)),t.cardPaymentsPass=e.cardPaymentsPass||"",e.storyLikes&&e.storyLikes.forEach(n=>t.storyLikes.push(n)),e.lastTimeUpdatePhone&&(t.lastTimeUpdatePhone=new Date(e.lastTimeUpdatePhone)||new Date(0)),e.lastTimeUpdateEmail&&(t.lastTimeUpdateEmail=new Date(e.lastTimeUpdateEmail)||new Date(0)),t.productsIds={},e.productsIds&&Object.entries(e.productsIds).forEach(([n,r])=>{t.productsIds[n]=vo.fromJson(r,n)}),e.pendingProductsIds&&Object.entries(e.pendingProductsIds).forEach(([n,r])=>{t.pendingProductsIds[n]=r}),t.revenueCatId=e.revenueCatId||"",t.lastCleanDate=e.lastCleanDate,e.lastVisitedBuisnesses.forEach(n=>t.lastVisitedBuisnesses.push(n)),e.lastVisitedBuisnessesRemoved&&e.lastVisitedBuisnessesRemoved.forEach(n=>t.lastVisitedBuisnessesRemoved.push(n)),t.businessesInfo={},e.businessesInfo&&Object.entries(e.businessesInfo).forEach(([n,r])=>{t.businessesInfo[n]=Bn.fromJson(r,n)}),e.businessTopics&&e.businessTopics.forEach(n=>{t.businessTopics.add(n)}),e.waitingListTopics&&(t.waitingListTopics={},Object.entries(e.waitingListTopics).forEach(([n,r])=>{const s=Fi.fromJson(r,n);s.date===""?t.businessTopics.add(n):t.waitingListTopics[n]=s})),t.paymentCards={},e.paymentCards&&Object.entries(e.paymentCards).forEach(([n,r])=>{t.paymentCards[n]={},Object.entries(r).forEach(([s,o])=>{t.paymentCards[n][s]=Fn.fromJson(o,s,n)})}),t.createdAt=new Date(e.createdAt),t.limitOfBuisnesses=e.limitOfBuisnesses||1,e.authProviders?Object.entries(e.authProviders).forEach(([n,r])=>{if(No[n]){const s=No[n];t.authProviders[s]=new Date(r)||new Date(2023)}}):t.authProviders={[Il.Phone]:t.createdAt},t.id===t.phoneNumber?t.isVerifiedPhone=!0:t.isVerifiedPhone=e.isVerifiedPhone||!1,e.lastTimeConnect&&(t.lastTimeConnect=new Date(e.lastTimeConnect)||new Date),t.userPublicData=new Pn({myBuisnessesIds:[],devices:{},isVerifiedPhone:t.isVerifiedPhone,phoneNumber:t.phoneNumber}),t}setUserPublicData(e){this.name=e.name||"",e.devices&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,n])=>{this.devices[t]=We.fromJson(n,t)}),this.gender=je[e.gender],this.phoneNumber=e.phoneNumber,this.id=e.id||e.phoneNumber,this.userPublicData.setUserPublicData(e,this)}firstEnterance(e){return!new Set([...this.lastVisitedBuisnesses,...this.lastVisitedBuisnessesRemoved]).has(e)}toUserDocJson(){const e={};return e.name=this.name,e.devices={},Object.entries(this.devices).forEach(([t,n])=>{e.devices[t]=n.toJson()}),this.lastTimeUpdateEmail.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdateEmail=this.lastTimeUpdateEmail.toISOString()),this.lastTimeUpdatePhone.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdatePhone=this.lastTimeUpdatePhone.toISOString()),e.gender=Hn[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,Object.keys(this.termsApprovals).length>0&&(e.termsApprovals={},Object.entries(this.termsApprovals).forEach(([t,n])=>{e.termsApprovals[t]=n.toISOString()})),Object.keys(this.seenUpdates).length>0&&(e.seenUpdates={},Object.entries(this.seenUpdates).forEach(([t,n])=>{e.seenUpdates[t]=Array.from(n)})),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.preferdTipPercentage=this.preferdTipPercentage,e.revenueCatId=this.revenueCatId,Object.keys(this.productsIds).length>0&&(e.productsIds={},Object.entries(this.productsIds).forEach(([t,n])=>{e.productsIds[t]=n.toJson()})),e.pendingProductsIds=this.pendingProductsIds,e.lastCleanDate=this.lastCleanDate,e.limitOfBuisnesses=this.limitOfBuisnesses,e.lastVisitedBuisnesses=this.lastVisitedBuisnesses,e.lastVisitedBuisnessesRemoved=this.lastVisitedBuisnessesRemoved,e.businessesInfo={},this.cardPaymentsPass!==""&&(e.cardPaymentsPass=this.cardPaymentsPass),Object.entries(this.businessesInfo).forEach(([t,n])=>{e.businessesInfo[t]=n.toJson()}),e.storyLikes=this.storyLikes,e.waitingListTopics={},Object.entries(this.waitingListTopics).forEach(([t,n])=>{e.waitingListTopics[t]=n.toJson()}),e.businessTopics=Array.from(this.businessTopics),e.authProviders={},Object.entries(this.authProviders).forEach(([t,n])=>{e.authProviders[t]=n.toISOString()}),e.paymentCards={},Object.entries(this.paymentCards).forEach(([t,n])=>{e.paymentCards[t]={},Object.entries(n).forEach(([r,s])=>{e.paymentCards[t][r]=s.toJson()})}),e.createdAt=this.createdAt.toISOString(),e}get developerId(){return this.id.replace("+","")}toString(){return JSON.stringify(this.toUserDocJson())+JSON.stringify(this.userPublicData.toJson())}}class Ee{static instance;constructor(){}static GI(){return Ee.instance||(Ee.instance=new Ee),Ee.instance}user=new Oi({});verificationRepo=new Sl;userRepo=new sm;userDoc;get getPermission(){return 0}isDeveloper(){return this.isConnected?lo.developers.hasOwnProperty(this.user.id.replace("+","")):!1}get isConnected(){return this.verificationRepo.isLoggedIn}get userId(){try{return this.verificationRepo.userId}catch{return""}}async setupUser({newUserId:e="",logoutIfDosentExist:t=!1}){try{return Le.info(`The user id is -> ${e}`),e.length<5?(await this.verificationRepo.logout(),!0):(this.userDoc===void 0&&(this.userDoc=await this.userRepo.getDocRepo({path:fi,docId:e})),!t&&(this.userDoc==null||!this.userDoc.exists())?(this.userDoc=void 0,!0):(this.user=Oi.fromUserDocJson(this.userDoc?.data()),this.startPublicDataListening(),!0))}catch(n){return this.userDoc=void 0,n instanceof Error&&(Le.error(`Error while setting up the user --> ${n}`),AppErrorsHelper.GI().addError({details:n.toString()})),!1}}async startPublicDataListening(){this.isConnected&&(this.user.userPublicDataListener=this.userRepo.docListenerRepo({path:`${fi}/${this.user.id}/${oi}`,docId:ai,onChanged:async e=>{try{e.exists()&&this.user.setUserPublicData(e.data())}catch(t){console.error(`Error in startPublicDataListening: ${t}`)}}}))}async loadBookingsDocs(e){const t=[];e.forEach(n=>{t.push(this.loadBookingDoc(n))}),await Promise.all(t)}async loadBookingDoc(e){try{const t=await this.userRepo.getDocRepo({path:Si.GI().userBookingsPathByUser(this.user.id),docId:e});e===Nc?Ee.GI().user.bookings.setRecurrence(t?.data()||{}):Ee.GI().user.bookings.setMonth(t?.data()||{},e)}catch(t){console.error(`Error loading booking doc ${e}: ${t}`)}}}function An(i,e=-1){let t="",n="",r="",s="",o="",a="",l=i.days;Math.floor(l/30)>0&&(Math.floor(l/30)===1&&(a=$("month")),Math.floor(l/30)===2&&(a=$("twoMonths")),Math.floor(l/30)>2&&(a=`${Math.floor(l/30)} `+$("months"))),l-=Math.floor(l/30)*30,Math.floor(l/7)>0&&(Math.floor(l/7)===1&&(o=$("week")),Math.floor(l/7)===2&&(o=$("twoWeeks")),Math.floor(l/7)>2&&(o=`${Math.floor(l/7)} `+$("weeks"))),l-=Math.floor(l/7)*7,l===1&&(s=$("day")),l===2&&(s=$("twoDays")),l>2&&(s=`${l} `+$("days"));let c=i.hours-i.days*24;c===1&&(t=$("hour")),c===2&&(t=$("twoHours")),c>2&&(t=`${c}`+$("hoursChar"));let h=i.minutes-i.hours*60;n=h>0?`${h}`+$("minutesChar"):"";let d=i.seconds-i.minutes*60;d===1&&(r=$("second",!1)),d>1&&(r=`${d} `+$("seconds"));let u="";return i.days===365?u=$("year"):i.days%365===0&&i.days>365?u=(i.days/365).toFixed(0)+" "+$("years"):o===""&&a!==""&&s===""?u=a:o!==""&&a===""&&s===""?u=o:o!==""&&a!==""&&s===""?u=a+" "+$("and")+o:o!==""&&a===""&&s!==""?u=o+" "+$("and")+s:o===""&&a!==""&&s!==""?u=a+" "+$("and")+s:o!==""&&a!==""&&s!==""?u=a+" ,"+o+" "+$("and")+s:n===""&&t===""&&s!==""?u=s:n!==""&&t===""&&s===""?u=n:n===""&&t!==""&&s===""?u=t:n!==""&&t!==""&&s===""?u=t+" "+$("and")+n:n!==""&&t===""&&s!==""?u=s+" "+$("and")+n:n===""&&t!==""&&s!==""?u=s+" "+$("and")+t:n!==""&&t!==""&&s!==""?u=s+" ,"+t+" "+$("and")+n:r!==""&&(u=r),u.length===0?"":e===-1||e>u.length?u:u.slice(0,e)+".."+u.slice(e)}function ax(i){const e=Ee.GI().user.gender;return e===z.male||e===z.anonymous||Object.keys(ka).forEach(n=>{i=i.replaceAll(n,ka[n])}),i}function $(i,e=!0){const t=ApplicationLocalizations.translate(i);return LanguageHelper().currentLaguageCode==="he"&&e?ax(t):t}class _o{times={};duringPaymentsTimes={};listener;lastBookingTimeDate;constructor(){}static fromJson(e){const t=new _o;return t.setData(e),t}setData(e,t=!0){this.times={},e.eventsTimes!==null&&Object.entries(e.eventsTimes).forEach(([n,r])=>{const s=new Date(n),o=new Date;o.setDate(o.getDate()-7),s>=o&&r instanceof Object&&Object.keys(r).length>0&&(this.times[n]={},Object.entries(r).forEach(([a,l])=>{this.times[n][a]=MultiBookingTime.fromJson(l)}))}),e.eventsTimeDuringPayment!==null&&t&&Object.entries(e.eventsTimeDuringPayment).forEach(([n,r])=>{const s=new Date(n),o=new Date;o.setDate(o.getDate()-7),s>=o&&Object.entries(r).forEach(([a,l])=>{const c=MultiBookingTime.fromJson(l);if(c.expiredDate!==null&&c.expiredDate.getTime()>Date.now()){if(this.times[n]??={},this.times[n][a]===null){const h=MultiBookingTime.fromMultiBookingTime(c);h.expiredDate=void 0,this.times[n][a]=h}else this.times[n][a].currentParticipants+=c.currentParticipants;s>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=s),this.duringPaymentsTimes[n]??={},this.duringPaymentsTimes[n][a]=c}})})}toJson(){const e={};return e.eventsTimes={},Object.entries(this.times).forEach(([t,n])=>{e.eventsTimes[t]={},Object.entries(n).forEach(([r,s])=>{e.eventsTimes[t][r]=s.toJson()})}),e}}class Kt{showAdressAlert=!1;showAdressMessage=!1;showPhoneAlert=!1;showPhoneMessage=!1;recurrenceNotificationsLastDate;notifyOnPayments=!0;notifyOnWaitingListEvents=!0;notifyAboutCancelNearDeadline=!0;notifyOnClientConfirmArrival=!0;notifyAboutOrderNearDeadline=!0;notificationOption=Ie.PushOrSMS;notifyWhenGettingBooking=!0;remindersTypes=new Map;constructor(){}static fromJson(e){const t=new Kt;if(t.notifyOnWaitingListEvents=e.notifyOnWaitingListEvents??!0,e.notificationOption!=null&&(t.notificationOption=tr[e.notificationOption]??Ie.PushOrSMS),t.recurrenceNotificationsLastDate=e.recurrenceNotificationsLastDate?new Date(e.recurrenceNotificationsLastDate):void 0,t.remindersTypes=new Map,e.remindersTypes!=null)for(const[n,r]of Object.entries(e.remindersTypes)){const s=_t[n];s!=null&&t.remindersTypes.set(s,r)}else t.remindersTypes.set(dt.regular,e.minutesBeforeNotify??60);return t.notifyOnClientConfirmArrival=e.notifyOnClientConfirmArrival??!0,t.showAdressAlert=e.showAdressAlert??!1,t.showAdressMessage=e.showAdressMessage??!1,t.showPhoneAlert=e.showPhoneAlert??!1,t.showPhoneMessage=e.showPhoneMessage??!1,t.notifyOnPayments=e.notifyOnPayments??!0,t.notifyAboutCancelNearDeadline=e.notifyAboutCancelNearDeadline??!0,t.notifyAboutOrderNearDeadline=e.notifyAboutOrderNearDeadline??!0,t.notifyWhenGettingBooking=e.notifyWhenGettingBooking??!0,t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}static fromWorkerNotificatiosSettings(e){return Kt.fromJson(e.toJson())}toJson(){const e={};return this.notifyOnWaitingListEvents||(e.notifyOnWaitingListEvents=this.notifyOnWaitingListEvents),this.notificationOption!==Ie.PushOrSMS&&(e.notificationOption=Ie[this.notificationOption]),this.recurrenceNotificationsLastDate!=null&&(e.recurrenceNotificationsLastDate=this.recurrenceNotificationsLastDate.toISOString()),this.notifyOnClientConfirmArrival||(e.notifyOnClientConfirmArrival=this.notifyOnClientConfirmArrival),this.notifyOnPayments||(e.notifyOnPayments=this.notifyOnPayments),e.remindersTypes={},this.remindersTypes.forEach((t,n)=>{e.remindersTypes[dt[n]]=t}),this.notifyAboutCancelNearDeadline||(e.notifyAboutCancelNearDeadline=this.notifyAboutCancelNearDeadline),this.notifyAboutOrderNearDeadline||(e.notifyAboutOrderNearDeadline=this.notifyAboutOrderNearDeadline),this.notifyWhenGettingBooking||(e.notifyWhenGettingBooking=this.notifyWhenGettingBooking),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showAdressMessage&&(e.showAdressMessage=this.showAdressMessage),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.showPhoneMessage&&(e.showPhoneMessage=this.showPhoneMessage),e}toString(){return JSON.stringify(this.toJson())}}class yo{publicCustomersData;constructor({publicCustomersData:e}={}){this.publicCustomersData=e}static fromJson(e){return new yo().setPublicCustomersDataJson(e)}setPublicCustomersDataJson(e){return e.data??={},this.publicCustomersData={},Object.entries(e.data).forEach(([t,n])=>{const r=Yt.fromMinimalJson(n,t);this.publicCustomersData[t]=r}),this}toMinimalJson(){const e={};return e.data={},this.publicCustomersData??={},Object.entries(this.publicCustomersData).forEach(([t,n])=>{e.data[t]=n.toMinimalJson()}),e}}function qe(i,e){return new Date(i.getTime()+e.inMilliseconds)}const cx={0:"years",1:"months",2:"weeks",3:"days"},lx={years:0,months:1,weeks:2,days:3},hx={0:"YEARLY",1:"MONTHLY",2:"WEEKLY",3:"DAILY"};var fl=(i=>(i[i.endless=0]="endless",i[i.date=1]="date",i[i.repeats=2]="repeats",i))(fl||{});const rs=["SU","MO","TU","WE","TH","FR","SA"],ss={0:new re({days:365}),1:new re({days:30}),2:new re({days:7}),3:new re({days:1})};class an{start;endDate;repeats=10;interval=1;freqRecurrence=3;weekDays=new SplayTreeSet;endOption=2;exceptionDates=new Set;customEndDate;constructor({start:e,endOption:t=2,endDate:n,repeats:r=10,interval:s=1,weekDays:o=new SplayTreeSet,customEndDate:a,freqRecurrence:l=3,exceptionDates:c=new Set}){this.start=e,this.weekDays=o,this.endOption=t,this.endDate=n,this.repeats=r,this.interval=s,this.customEndDate=a,this.freqRecurrence=l,this.exceptionDates=c}static fromJson(e,t){const n=new an({});return n.start=t,n.endDate=e.ED?new Date(e.ED):void 0,n.repeats=e.R||10,n.interval=e.I||1,n.weekDays=new SplayTreeSet(e.WD||[]),n.exceptionDates=new Set(Object.keys(e.EDA||{}).map(ir)),n.freqRecurrence=lx[e.FR]||3,n}toJson({saveStartDate:e=!1,saveEnd:t=!0,saveException:n=!0}){const r={};return t&&this.endDate&&this.endOption===1&&(r.ED=Xe(this.endDate)),t&&this.endOption===2&&(r.R=this.repeats),this.interval!==1&&(r.I=this.interval),this.weekDays.size>0&&this.freqRecurrence===2&&(r.WD=[...this.weekDays]),n&&this.exceptionDates.size>0&&(r.EDA={},this.exceptionDates.forEach(s=>{r.EDA[Xe(s)]=""})),e&&this.start&&(r.SD=this.start.toISOString()),r.FR=cx[this.freqRecurrence],r}static fromRecurrenceEvent(e){return new an({start:e.start,endDate:e.endDate,repeats:e.repeats,interval:e.interval,freqRecurrence:e.freqRecurrence,weekDays:new SplayTreeSet(e.weekDays),endOption:e.endOption,exceptionDates:new Set(e.exceptionDates)})}isEqual(e){return!this.start||!e.start||this.start.getTime()!==e.start.getTime()||(this.endDate?.getTime()||0)!==(e.endDate?.getTime()||0)?!1:this.repeats===e.repeats&&this.interval===e.interval&&this.freqRecurrence===e.freqRecurrence&&Ea(e.weekDays,this.weekDays)&&Ea(e.exceptionDates,this.exceptionDates)&&this.endOption===e.endOption}get syncfuString(){let e=`FREQ=${hx[this.freqRecurrence]};`;if(this.freqRecurrence===1&&this.start&&(e+=`BYMONTHDAY=${this.start.getDate()};`),this.freqRecurrence===0&&this.start&&(e+=`BYMONTHDAY=${this.start.getDate()};BYMONTH=${this.start.getMonth()+1};`),e+=`INTERVAL=${this.interval};`,this.freqRecurrence===2&&this.weekDays.size>0&&(e+="BYDAY=",this.weekDays.forEach(t=>{t<rs.length&&(e+=rs[t]+",")}),e=e.slice(0,-1)+";"),this.customEndDate&&(this.endOption===0||this.endOfTheEvent&&this.endOfTheEvent>new Date)){const t=new Date(this.customEndDate.getFullYear(),this.customEndDate.getMonth(),this.customEndDate.getDate(),this.start?.getHours()??0,this.start?.getMinutes()??0);e+=`UNTIL=${wr(t,"yyyyMMdd'T'HHmmss'Z'")}`}else switch(this.endOption){case 0:break;case 1:if(this.endDate){const t=new Date(this.endDate.getFullYear(),this.endDate.getMonth(),this.endDate.getDate(),this.start?.getHours()??0,this.start?.getMinutes()??0);e+=`UNTIL=${wr(t,"yyyyMMdd'T'HHmmss'Z'")}`}break;case 2:e+=`COUNT=${this.repeats}`;break}return e}get accurances(){if(!this.start||this.endOption===0)return null;if(this.endOption===2)return this.repeats-this.exceptionDates.size;if(this.endOption===1&&this.endDate){let e=0;if(this.exceptionDates.forEach(t=>{t<=this.endDate&&e++}),this.freqRecurrence===2){let t=0;const n=pt(this.start);this.weekDays.forEach(c=>{this.isAccureInDate({date:qe(n,new re({days:c})),considerException:!1})&&t++});const r=Math.abs(qe(n,new re({days:6})).getTime()-pt(this.endDate).getTime()),s=Math.floor(r/this.rangeBetweenInterval.inMilliseconds),o=pt(this.endDate);let a=0;return De(o).getTime()!==De(n).getTime()&&this.weekDays.forEach(c=>{this.isAccureInDate({date:qe(o,new re({days:c})),considerException:!1})&&a++}),s*this.weekDays.size+a+t-e}else if(this.freqRecurrence===1){const t=Na(this.start,this.endDate);return Math.floor(t/this.interval)-e}else{const t=this.start.getTime()-this.endDate.getTime();return Math.floor(Math.abs(t)/this.rangeBetweenInterval.inDays)-e}}return null}get rangeBetweenInterval(){return new re({minutes:ss[this.freqRecurrence].inMinutes*this.interval})}get endOfTheEvent(){const e=this.rangeBetweenInterval;if(this.endOption===1&&this.endDate!==null)return this.endDate??null;if(this.endOption===2)if(this.freqRecurrence===2){let t=0;const n=this.start.getDay()===7?0:this.start.getDay();this.weekDays.forEach(c=>{c>=n&&t++});const r=this.repeats-t,s=Math.ceil(r/this.weekDays.size),o=r%this.weekDays.size,a=new Date(this.start.getTime()+new re({minutes:e.inMinutes*s}).milliseconds),l=pt(a);this.weekDays=new SplayTreeSet(this.weekDays,(c,h)=>c-h);try{return new Date(l.getTime()+new re({days:o-1<0?this.weekDays.last:this.weekDays.elementAt(o-1)}).inMilliseconds)}catch{return null}}else return this.freqRecurrence===1?Ra(this.start,(this.repeats-1)*this.interval):new Date(this.start.getTime()+new re({minutes:e.inMinutes*(this.repeats-1)}).inMilliseconds);return null}get explainText(){if(this.start===null)return"";let e="";const t=new re({minutes:ss[this.freqRecurrence].inMinutes*this.interval});switch(this.freqRecurrence){case 0:e+=$("yearTamplate").replaceAll("DURATION",An(t)).replaceAll("DATE",wr(this.start,"dd/MM"));break;case 1:e+=$("monthTemplate").replaceAll("DURATION",An(t)).replaceAll("DATE",this.start.getDate().toString());break;case 2:let r="";this.weekDays.forEach(s=>{r+=$(rs[s])+", "}),r=r.substring(0,r.length-2),e+=$("weekTemplate").replaceAll("DURATION",An(t)).replaceAll("DAYS",r).replaceAll("AMOUNT",$(Object.keys(this.weekDays).length===1?"onDay":"onDays"));break;case 3:e+=$("dayTemplate").replaceAll("DURATION",An(t));break}const n=this.endOfTheEvent;return n!==null&&(e+=` ${$("until")} ${Xe(n)}`),e}isAccureInDate({date:e,considerException:t=!0}){if(this.start===null||De(this.start)>e)return!1;const n=this.endOfTheEvent;if(n!==null&&n<De(e)||t&&this.exceptionDates.has(De(e)))return!1;const r=new re({minutes:ss[this.freqRecurrence].inMinutes*this.interval}),s=new re({milliseconds:e.getTime()-De(this.start).getTime()}),o=this.start.getDay()===7?0:this.start.getDay(),a=e.getDay()===7?0:e.getDay();if(this.freqRecurrence===2){const l=7-o,c=r.inDays-o,h=(s.inDays+r.inDays)%r.inDays;return(h<l||h>=c)&&this.weekDays.has(a)}if(this.freqRecurrence===1){const l=Na(this.start,e);return this.start.getDate()===e.getDate()&&l%this.interval===0}return s.inDays%r.inDays===0}addRangeBetween(e){const t=new Date(e.getUTCDate());return this.freqRecurrence===1?Ra(t,this.interval):qe(t,new re({minutes:this.rangeBetweenInterval.inMinutes}))}overlapingDatesWith(e){if(this.start===null||e.start===null)return new Set([new Date(0)]);if(this.endOfTheEvent===null&&e.endOfTheEvent===null)return new Set([new Date(0)]);const t=new Set,n=this._getOptimalEventToPassOver(this,e),r=n[0],s=n[1];let o=r.start;for(;De(o)<=De(r.endOfTheEvent);){if(r.freqRecurrence===2){const a=pt(o);r.weekDays.forEach(l=>{const c=qe(a,new re({days:l}));s.isAccureInDate({date:c})&&r.isAccureInDate({date:c})&&t.add(De(c))})}else s.isAccureInDate({date:o})&&r.isAccureInDate({date:o})&&t.add(De(o));o=this.addRangeBetween(o)}return t}get isRelevant(){return this.endOfTheEvent===null||this.endOfTheEvent>new Date}nearestFutureAccurenceDate(e,{needToBeAfterStart:t=!0}={}){if(this.endOfTheEvent!==null&&e>this.endOfTheEvent)return null;if(this.start===null||e<this.start&&t&&this.isAccureInDate({date:this.start}))return this.start??null;const n=new re({milliseconds:e.getTime()-this.start.getTime()}).inDays;if(this.freqRecurrence===2){const a=Math.floor(n/this.rangeBetweenInterval.inDays);let l=qe(this.start,new re({days:a*this.rangeBetweenInterval.inDays})),c=pt(l);for(const h of this.weekDays){const d=new Date(c.getTime()+new re({days:h}).inMilliseconds);if(d>=e&&(this.endOfTheEvent===null||l<=this.endOfTheEvent))return d}l=qe(l,this.rangeBetweenInterval),c=pt(l);for(const h of this.weekDays){const d=qe(c,new re({days:h}));if(d>=e&&(this.endOfTheEvent===null||l<=this.endOfTheEvent))return d}return null}const r=Math.ceil(n/this.rangeBetweenInterval.inDays);let s=qe(this.start,new re({days:r*this.rangeBetweenInterval.inDays}));s<e&&(s=this.addRangeBetween(s));const o=this.endOfTheEvent;for(;!this.isAccureInDate({date:s})&&(o===null||s<o);)s=this.addRangeBetween(s);return o===null||s<=o?s:null}_getOptimalEventToPassOver(e,t){return e.endOfTheEvent===null&&t.endOfTheEvent!==null?[t,e]:e.endOfTheEvent!==null&&t.endOfTheEvent===null?[e,t]:(t.jumps??99999)<(e.jumps??99999)?[t,e]:[e,t]}get jumps(){if(this.start===null||this.endOfTheEvent===null)return null;const t=new re({milliseconds:this.start.getTime()-this.endOfTheEvent.getTime()}).inMinutes/this.rangeBetweenInterval.inMinutes;return Math.ceil(t*Math.max(this.weekDays.size,1))}toString(){return JSON.stringify(this,null,2)}}class wo{eventName="";from=new Date(0);to=new Date(0);colorIndex=-1;isBreak=!1;eventIndex=0;eventsBelong=1;partOfRecurrence=!1;treatmentName="";transactionCounter=0;wantDelete=!1;onHold=!1;hasInvoice=!1;durationMinutes=0;breakNotificaiton=!1;minutesBreakNotification=60;extraData;note=null;ids=[];recurrenceEvent=void 0;timeId=null;hasDebt=!1;confirmArrival=!1;treatmentId=null;isMulti=!1;currentParticipants=0;debtCounter=0;onHoldCounter=0;invoiceCoverCounter=0;transactionsPerUser=0;wantDeleteCounter=0;confirmedArrivalAmount=0;recurrenceFatherBookingId;recurrenceBreakFatherDate;blockSchedule=!0;recurrenceBreakRefInfo;breakIconData;breakBusinessName;breakFatherRecurrenceId;breakBusinessId;breakAddedToDeviceCalendar=!1;breakId="";vacationId="";belongTreatments=1;vacationCreatedAt=void 0;isVacation=!1;vacationAddedToDeviceCalendar=!1;vacationEndTemp=null;isHoliday=!1;holidayReligion=null;subTreatmentName="";totalBookingMinutes=0;waitingListCounter=1;isWaitingList=!1;waitingListCustomerGender=z.male;customerPhoneWaitingList="";constructor(){}static fromJson({json:e,timeStr:t,dayString:n,monthString:r,workerId:s,businessModel:o,newTimeId:a}){const l=new wo;l.eventName=e.p??"",l.eventIndex=e.i??0,l.onHold=e.oH??!1,l.eventsBelong=e.EB??1,l.wantDelete=e.wD??!1,l.isVacation=e.IV??!1,l.isVacation&&l.eventName===""&&(l.eventName=$("Vacation")),l.vacationId=a??"",l.breakFatherRecurrenceId=e.BFRI??"",l.vacationAddedToDeviceCalendar=e.VATDC??!1,l.blockSchedule=e.BS??!0,l.transactionCounter=e.TC??0,l.transactionsPerUser=e.TPU??0,l.hasDebt=e.HD??!1,l.debtCounter=e.DC??0,l.treatmentId=e.TID,l.confirmArrival=e.CA??!1,l.confirmedArrivalAmount=e.CAA??0,l.durationMinutes=e.d??0,l.treatmentName=e.TN??"",l.hasInvoice=e.Hi??!1,l.invoiceCoverCounter=e.ICC??0,l.note=e.N,l.recurrenceFatherBookingId=e.RFBI,l.wantDeleteCounter=e.WDC??0,l.onHoldCounter=e.OHC??0,l.isMulti=e.IM??!1,l.currentParticipants=e.CP??0,l.breakNotificaiton=e.BN??!1,l.partOfRecurrence=e.POR??!1,l.minutesBreakNotification=e.MBN??60,l.recurrenceBreakRefInfo=e.RBRI?an.fromJson(e.RBRI):void 0,l.recurrenceBreakFatherDate=e.RBFD;const c=e.IB??!1,h=new Date(t),d=new Date(`${n}-${r}`),u=new Date(d.getFullYear(),d.getMonth(),d.getDate(),h.getHours(),h.getMinutes());return new Date(u.getTime()+l.durationMinutes*6e4),e.RE&&an.fromJson(e.RE,u),l.colorIndex=e.c??(l.isVacation?1:0),l.ids=[s],l.isHoliday=!1,l.holidayReligion=null,l.subTreatmentName="",l.totalBookingMinutes=0,l.waitingListCounter=1,l.isWaitingList=!1,l.waitingListCustomerGender=z.male,l.customerPhoneWaitingList="",c&&(l.breakIconData=o?.design.shopIconData,l.breakBusinessName=o?.shopName,l.breakBusinessId=o?.businessId),e.VE&&(l.vacationEndTemp=ir(e.VE)),l}get endOfBooking(){return new Date(this.from.getTime()+this.totalBookingMinutes*6e4)}toJson(){const e={};return e.p=this.eventName,e.d=this.durationMinutes,e.c=this.colorIndex,this.minutesBreakNotification!==60&&(e.MBN=this.minutesBreakNotification),this.breakNotificaiton&&(e.BN=this.breakNotificaiton),this.onHoldCounter>0&&(e.OHC=this.onHoldCounter),this.confirmArrival&&(e.CA=this.confirmArrival),this.confirmedArrivalAmount>0&&(e.CAA=this.confirmedArrivalAmount),this.blockSchedule||(e.BS=this.blockSchedule),this.treatmentId!==null&&(e.TID=this.treatmentId),this.wantDeleteCounter>0&&(e.WDC=this.wantDeleteCounter),this.hasDebt&&(e.HD=this.hasDebt),this.transactionCounter>0&&(e.TC=this.transactionCounter),this.transactionsPerUser>0&&(e.TPU=this.transactionsPerUser),this.debtCounter>0&&(e.DC=this.debtCounter),this.invoiceCoverCounter>0&&(e.ICC=this.invoiceCoverCounter),this.eventsBelong!==1&&(e.EB=this.eventsBelong),this.isBreak&&(e.IB=this.isBreak),this.breakId!==""&&(e.BI=this.breakId),this.eventIndex!==0&&(e.i=this.eventIndex),this.treatmentName!==""&&(e.TN=this.treatmentName),this.onHold&&(e.oH=this.onHold),this.isMulti&&(e.IM=this.isMulti),this.currentParticipants>0&&(e.CP=this.currentParticipants),this.wantDelete&&(e.wD=this.wantDelete),this.hasInvoice&&(e.Hi=this.hasInvoice),this.recurrenceEvent!=null&&(e.RE=this.recurrenceEvent.toJson({})),this.note!==null&&this.note!==""&&(e.N=this.note),this.partOfRecurrence&&(e.POR=this.partOfRecurrence),this.recurrenceFatherBookingId!=null&&(e.RFBI=this.recurrenceFatherBookingId),this.isVacation&&(e.IV=this.isVacation),this.breakFatherRecurrenceId!=null&&(e.BFRI=this.breakFatherRecurrenceId),this.vacationAddedToDeviceCalendar&&(e.VATDC=this.vacationAddedToDeviceCalendar),this.vacationCreatedAt!=null&&(e.VCA=this.vacationCreatedAt.toString()),this.breakAddedToDeviceCalendar&&(e.BATDC=this.breakAddedToDeviceCalendar),this.timeId!==null&&this.recurrenceEvent===null&&(e.RTI=this.timeId),this.recurrenceBreakFatherDate!==null&&(e.RBFD=this.recurrenceBreakFatherDate),this.recurrenceBreakRefInfo!=null&&(e.RBRI=this.recurrenceBreakRefInfo.toJson({saveStartDate:!1,saveEnd:!0,saveException:!1})),this.subTreatmentName!==""&&(e.STN=this.subTreatmentName),this.totalBookingMinutes!==this.durationMinutes&&(e.TBM=this.totalBookingMinutes),this.belongTreatments>1&&(e.BTR=this.belongTreatments),e}toString(){return JSON.stringify(this,null,2)}}class Ri{start=new Date(0);end=new Date(0);id="";createdAt;workerId="";addedToDeviceCalendar=!1;colorIndex=1;title="";recurrenceObj;constructor({end:e,start:t,title:n="",id:r="",workerId:s=""}){this.start=t,this.end=e,this.title=n,this.id=r,this.workerId=s,this.recurrenceObj=new an({start:t,endDate:e,endOption:fl.date})}isOneDay(){return Xe(this.end)===Xe(this.start)}static fromEvent(e){const t=new Ri({});return t.start=e.from,e.recurrenceEvent?.endDate&&(t.end=e.recurrenceEvent.endDate),t.title=e.eventName,t.createdAt=e.vacationCreatedAt,t.id=e.vacationId,t.recurrenceObj=e.recurrenceEvent,t.addedToDeviceCalendar=e.vacationAddedToDeviceCalendar,t.colorIndex=e.colorIndex,t.workerId=e.ids.length>0?e.ids[0]:"",t}static fromVacation(e){const t=new Ri({});return t.start=e.start,t.end=e.end,t.addedToDeviceCalendar=e.addedToDeviceCalendar,t.id=e.id,t.createdAt=e.createdAt,t.workerId=e.workerId,t.title=e.title,t.colorIndex=e.colorIndex,t}}class ux{listener;recurrenceEvents={};vacationsEvents={};constructor(){}get recurrenceEventsList(){const e=[];return Object.entries(this.recurrenceEvents).forEach(([t,n])=>{e.push(...Object.values(n))}),e}get recurrenceEventsListWithOutVacations(){const e=[];return Object.entries(this.recurrenceEvents).forEach(([t,n])=>{Object.entries(n).forEach(([r,s])=>{s.isVacation||e.push(s)})}),e}setRecurrenceEvents(e,t,n,{putBreaks:r=!0}={}){this.recurrenceEvents={},this.vacationsEvents={},Object.entries(e).forEach(([s,o])=>{this.recurrenceEvents[s]={};const a=new Date(s);Object.entries(o).forEach(([l,c])=>{let h="",d="";if(typeof l=="string"){const f=l.split("_");f.length===2&&(h=f[1]),d=f[0]}const u=wo.fromJson({json:c,timeStr:d,businessModel:n,newTimeId:h,dayString:fp(a),monthString:bs(a),workerId:t});u.isVacation&&(this.vacationsEvents[Xe(u.from)]=u),!(!r&&u.isBreak)&&(this.recurrenceEvents[s][l]=u)})})}vacationInDate(e){for(const t of Object.values(this.vacationsEvents))if(t.recurrenceEvent?.isAccureInDate({date:e}))return Ri.fromEvent(t);return null}}class dx{start;end;constructor({start:e,end:t}){this.start=e,this.end=t}}function si(i){const e=new Date(i);return e.setFullYear(1970),e.setMonth(0),e.setDate(1),e}function fx(i,e,t,n){return""}function mx(i){i.sort((r,s)=>r.start.getTime()-s.start.getTime());const e=[];let t=0;for(let r=0;r<i.length;r=t){const s=i[r];for(e.push(s),t=r+1;t<i.length;t++){const o=i[t];fx(si(s.start),si(s.end),si(o.start),si(o.end))}}const n=[];return e.forEach(r=>{n.push(DateFormat("HH:mm").format(r.start)),n.push(DateFormat("HH:mm").format(r.end))}),n}function _c(i,e){for(let t=0;t<e.length;t+=2){const n=new Date(e[t]),r=new Date(e[t+1]);i.push(new dx({start:n,end:r}))}}const px={R:"R",A:"A"},xx={R:"R",A:"A"};class Mi{start=new Date(0);end=new Date(0);operation="R";shifts=[];constructor({start:e,end:t,operation:n,shifts:r}){this.start=e,this.end=t,this.operation=n,this.shifts=r}static fromJson(e,t){const n=t.split("&"),r=new Date(n[0]),s=new Date(n[1]),o=xx[e.operation]||"R",a=e.shifts.map(l=>l);return new Mi({start:r,end:s,operation:o,shifts:a})}static fromShiftChangeRange(e){const{start:t,end:n,operation:r,shifts:s}=e;return new Mi({start:t,end:n,operation:r,shifts:[...s]})}isSameAs(e){return this.start.getTime()===e.start.getTime()&&this.end.getTime()===e.end.getTime()&&this.operation===e.operation&&this.shifts.toString()===e.shifts.toString()}toJson(){return{operation:px[this.operation],shifts:this.shifts}}combineShifts(e){if(this.operation==="R")return this.shifts;const t=[];return _c(t,e),_c(t,this.shifts),mx(t)}getKey(){const e=this.formatDate(this.start),t=this.formatDate(this.end);return`${e}&${t}`}formatDate(e){return e.toISOString().split("T")[0]}toString(){return JSON.stringify(this.toJson())}}class Li{name="";index="";treatments=new Map;constructor({name:e,treatments:t,index:n}){this.name=e,this.treatments=t,this.index=n}static fromJson(e,t,{pointerShortBookingTime:n,pointerLognestBookingTime:r}={}){const s=e.name||"",o=t,a=new Map;return e.treatments&&Object.entries(e.treatments).forEach(([l,c])=>{a.set(l,Re.fromJson(c,l)),n&&(a.get(l).totalMinutes<n[0]&&(n[0]=Math.max(a.get(l).times.get("0").workMinutes,5)),a.get(l).totalMinutes===n[0]&&(n[0]=Math.min(Math.max(a.get(l).times.get("0").workMinutes,5),n[0]))),r&&a.get(l).totalMinutes>r[0]&&(r[0]=Math.max(a.get(l).totalMinutes,5))}),new Li({name:s,treatments:a,index:o})}containTreatment(e){for(const t of Object.values(this.treatments))if(t.id===e)return!0;return!1}toJson(){const e={};return e.name=this.name,e.treatments={},Object.entries(this.treatments).forEach(([t,n])=>{e.treatments[t]=n.toJson()}),e}fromTreatmentSubject(e){return this.name=e.name,this.index=e.index,this.treatments=new Map,e.treatments.forEach((t,n)=>{this.treatments.set(n,Re.fromTreatment(t))}),this}toString(){return JSON.stringify(this.toJson(),null,2)}}class gx{bookingsTimes={};lastBookingTimeDate;duringPaymentBookingsTime={};listener;constructor(){}findLastBookingsTimesDate(){let e;return Object.entries(this.bookingsTimes).forEach(([t,n])=>{const r=new Date(t);Object.keys(n).length>0&&(!e||r>e)&&(e=r)}),e}setWorkerPublicData(e,t=!0){this.duringPaymentBookingsTime={},this.bookingsTimes={},dayLightSavingTimes.forEach(n=>{n=new Date(n.getTime()+60*60*1e3),this.bookingsTimes[Xe(n)]={[dp(n)]:60}}),e.bookingsTimes!=null&&Object.entries(e.bookingsTimes).forEach(([n,r])=>{const s=new Date(n),o=new Date;o.setDate(o.getDate()-7),s>=o&&Object.keys(r).length!=0&&(this.bookingsTimes[n]={},Object.entries(r).forEach(([a,l])=>{a.includes("00:00v")?t&&(this.bookingsTimes[n]={"00:00":1439}):(a!=="00:00"||this.bookingsTimes[n]["00:00"]!=1439)&&(this.bookingsTimes[n][a]=l)}),Object.keys(r).length>0&&s>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=s))}),e.duringPaymentBookingsTime!==null&&Object.entries(e.duringPaymentBookingsTime).forEach(([n,r])=>{const s=new Date(n),o=new Date;o.setDate(o.getDate()-7),s>=o&&Object.entries(r).forEach(([a,l])=>{l.length===2&&l[0]instanceof ct&&l[0].toDate().getTime()>Date.now()&&typeof l[1]=="number"&&(n in this.bookingsTimes?this.bookingsTimes[n][a]=l[1]:this.bookingsTimes[n]={[a]:l[1]},s>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=s),n in this.duringPaymentBookingsTime?this.duringPaymentBookingsTime[n][a]=l:this.duringPaymentBookingsTime[n]={[a]:l})})})}emptyBookingTimesDatesInMonth(e){Object.entries(this.bookingsTimes).forEach(([t,n])=>{t.includes(e)&&(this.bookingsTimes[t]={})})}toWorkerPublicDataJson(){const e={};return e.bookingsTimes={},Object.entries(this.bookingsTimes).forEach(([t,n])=>{e.bookingsTimes[t]={},Object.entries(n).forEach(([r,s])=>{e.bookingsTimes[t][r]=s})}),e.duringPaymentBookingsTime={},Object.entries(this.duringPaymentBookingsTime).forEach(([t,n])=>{e.duringPaymentBookingsTime[t]={},Object.entries(n).forEach(([r,s])=>{e.duringPaymentBookingsTime[t][r]=s})}),e}}class Wi{daysToAllowBookings=7;name="";phone="";id="";profileImg="";about="";maxTreatments=5;allowAppNotification=!0;religions=[];waitingListExceptionDays=new Set;closeScheduleOnHolidays=!1;weekendDays=[5,6];onHoldMinutes=0;cancelMinutes=0;minutesBeforeBookingToConfirm=1440;tempFcm;hasRecurrenceEvents=!1;windowSpaces=li.shortestTreatment;customWindowMinute=30;showWaitingListWhenThereIsChoises=!0;isVerifiedPhone=!1;lastCleanDate=new Date;gender=z.anonymous;deleteNeerDedlineBookingMessage;orderNeerDedlineBookingMessage;generalBookingMessage;closeCalendarDate;minDateForShowinData=new Date(0);openCalendar=!0;maxFutureBookings=4;currentClientCount=0;showVacations=!0;mustVerifyPhone=!0;allowBookingConfirmations=!0;devices=new Map;storyImages=new Map;createdAt=new Date(0);workTime=new Map([["sunday",[]],["monday",[]],["tuesday",[]],["wednesday",[]],["thursday",[]],["friday",[]],["saturday",[]]]);isCustomersNeedRecurrence=!1;specificRangeChanges=new Map;treatmentsSubjects=new Map;workerPublicData=new gx;publicCustomers=new yo;storylikesAmount=new Map;multiEventsTimes=new _o;generalBookingsCount=0;passedBookingsCount=0;shortBookingTime=999;longestBookingTime=0;recurrence=new ux;notifications=new Kt;workerDocListner;constructor({}){}static fromUserPublicData(e){const t=new Wi({});return t.phone=e.phoneNumber||"",t.currentClientCount=e.currentClientCount||0,t.id=e.id||t.phone,t.name=e.name||"",e.devices!=null&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([n,r])=>{t.devices.set(n,We.fromJson(r,n))}):e.currentFcm!=null&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),t.gender=je[e.gender]||z.anonymous,t.lastCleanDate=new Date,t.createdAt=new Date,t.notifications.remindersTypes=new Map([[dt.regular,60]]),t}static fromWorkerDocJson(e){const t=new Wi({});return t.setFromWorkerDoc(e),t}get treatmentsLength(){let e=0;return Object.values(this.treatmentsSubjects).forEach(t=>{e+=Object.values(t.treatments).length}),e}isClosingDate(e){return!this.openCalendar||this.closeCalendarDate!=null&&De(this.closeCalendarDate).getTime()===De(e).getTime()}hasTreatemnt(e){for(const t of Object.values(this.treatmentsSubjects))if(t.containTreatment(e))return!0;return!1}get useWhatsApp(){return this.notifications.notificationOption===Ie.WhatsApp||this.notifications.notificationOption===Ie.PushOrWhatsApp}setFromWorkerDoc(e){if(this.daysToAllowBookings=e.daysToAllowBookings||7,this.profileImg=e.profileImg||"",this.about=e.about||"",e.lastCleanDate instanceof ct?this.lastCleanDate=e.lastCleanDate.toDate():typeof e.lastCleanDate=="string"&&(this.lastCleanDate=new Date(e.lastCleanDate)||new Date),e.religions&&(this.religions=e.religions.map(t=>rm[t])),e.windowSpaces&&(this.windowSpaces=nm[e.windowSpaces]||li.shortestTreatment),this.isCustomersNeedRecurrence=e.isCustomersNeedRecurrence||!1,this.showWaitingListWhenThereIsChoises=e.showWaitingListWhenThereIsChoises||!0,this.customWindowMinute=e.customWindowMinute||30,this.closeScheduleOnHolidays=e.closeScheduleOnHolidays||!1,this.weekendDays=e.weekendDays||[5,6],this.mustVerifyPhone=e.mustVerifyPhone||!0,this.showVacations=e.showVacations||!0,this.gender=je[e.gender]||z.anonymous,this.allowAppNotification=e.allowAppNotification||!0,this.name=e.name||"",this.maxTreatments=e.maxTreatments||3,this.phone=e.phone||"",this.hasRecurrenceEvents=e.hasRecurrenceEvents||!1,this.id=e.id||e.phone||"",this.minutesBeforeBookingToConfirm=e.minutesBeforeBookingToConfirm||1440,this.maxFutureBookings=e.maxFutureBookings||4,this.treatmentsSubjects=new Map,this.shortBookingTime=999,e.treatmentsSubjects){let t=[this.shortBookingTime],n=[this.longestBookingTime];Object.entries(e.treatmentsSubjects).forEach(([r,s])=>{const o=Li.fromJson(s,r,{pointerShortBookingTime:t,pointerLognestBookingTime:n});this.treatmentsSubjects.set(r,o)}),this.shortBookingTime=t[0],this.longestBookingTime=n[0]}else if(e.treatments){const t=new Map;let n=0;Object.entries(e.treatments).forEach(([r,s])=>{const o=Re.fromOldJson(s,n.toString(),r,n+4);t.set(n.toString(),o),o.totalMinutes<this.shortBookingTime&&(this.shortBookingTime=Math.max(o.times.get("0").workMinutes,5)),o.totalMinutes===this.shortBookingTime&&(this.shortBookingTime=Math.min(Math.max(o.times.get("0").workMinutes,5),this.shortBookingTime)),n+=1}),this.treatmentsSubjects=new Map([["0",new Li({name:$("general"),treatments:t,index:"0"})]])}this.onHoldMinutes=e.onHoldMinutes||0,this.cancelMinutes=e.cancelMinutes||0,e.devices!=null&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,n])=>{this.devices.set(t,We.fromJson(n,t))}),this.deleteNeerDedlineBookingMessage=e.deleteNeerDedlineBookingMessage,this.orderNeerDedlineBookingMessage=e.orderNeerDedlineBookingMessage,this.generalBookingMessage=e.generalBookingMessage,this.workTime=new Map,e.workTime&&Object.entries(e.workTime).forEach(([t,n])=>{this.workTime.set(t,n.map(r=>r))}),this.waitingListExceptionDays=new Set,e.waitingListExceptionDays&&e.waitingListExceptionDays.forEach(t=>{this.waitingListExceptionDays.add(t)}),e.notifications?this.notifications=Kt.fromJson(e.notifications):(this.notifications=new Kt,this.notifications.notifyOnWaitingListEvents=e.notifyOnWaitingListEvents||!0,this.notifications.showAdressAlert=e.showAdressAlert||!1,this.notifications.showAdressMessage=e.showAdressMessage||!1,this.notifications.showPhoneAlert=e.showPhoneAlert||!1,this.notifications.showPhoneMessage=e.showPhoneMessage||!1,this.notifications.remindersTypes=new Map([[dt.regular,e.minutesBeforeNotify||60]]),this.notifications.notifyOnPayments=e.notifyOnPayments||!0,this.notifications.notifyAboutCancelNearDeadline=e.notifyAboutCancelNearDeadline||!0,this.notifications.notifyAboutOrderNearDeadline=e.notifyAboutOrderNearDeadline||!0,this.notifications.notifyWhenGettingBooking=e.notifyWhenGettingBooking||!0,e.notificationOption&&(this.notifications.notificationOption=tr[e.notificationOption]||Ie.OnlyPush),e.recurrenceNotificationsLastDate?this.notifications.recurrenceNotificationsLastDate=new Date(e.recurrenceNotificationsLastDate):this.notifications.recurrenceNotificationsLastDate=new Date),this.specificRangeChanges=new Map,e.specificRangeChanges&&Object.entries(e.specificRangeChanges).forEach(([t,n])=>{const r=Mi.fromJson(n,t);r.end>=De(new Date)&&this.specificRangeChanges.set(t,r)}),this.storyImages=new Map,e.storyImages&&Object.entries(e.storyImages).forEach(([t,n])=>{this.storyImages.set(t,n)}),e.closeCalendarDate&&(this.closeCalendarDate=new Date(e.closeCalendarDate)),e.minDateForShowinData&&(this.minDateForShowinData=ir(e.minDateForShowinData)),this.openCalendar=e.openCalendar||!0,this.allowBookingConfirmations=e.allowBookingConfirmations||!0,e.createdAt?this.createdAt=new Date(e.createdAt):this.createdAt=new Date(2023,0,1),this.id===this.phone?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1}getInvoiceWorkerInfo(){return new InvoiceWorkerInfo({workerId:this.id,workerName:this.name})}getFcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm!=null)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}toWorkerDocJson(){const e={};return e.workTime={},Object.entries(this.workTime).forEach(([t,n])=>{e.workTime[t]=n}),e.specificRangeChanges={},Object.entries(this.specificRangeChanges).forEach(([t,n])=>{e.specificRangeChanges[t]=n.toJson()}),e.religions=[],this.religions.forEach(t=>{e.religions.push(im[t])}),this.closeCalendarDate!=null&&(e.closeCalendarDate=new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}).format(this.closeCalendarDate)),this.minDateForShowinData.getFullYear()!=new Date(0).getFullYear()&&(e.minDateForShowinData=Xe(this.minDateForShowinData)),this.openCalendar||(e.openCalendar=this.openCalendar),e.allowBookingConfirmations=this.allowBookingConfirmations,this.mustVerifyPhone||(e.mustVerifyPhone=this.mustVerifyPhone),this.isCustomersNeedRecurrence&&(e.isCustomersNeedRecurrence=this.isCustomersNeedRecurrence),e.weekendDays=this.weekendDays,e.maxTreatments=this.maxTreatments,e.gender=Hn[this.gender],e.onHoldMinutes=this.onHoldMinutes,e.cancelMinutes=this.cancelMinutes,this.hasRecurrenceEvents&&(e.hasRecurrenceEvents=this.hasRecurrenceEvents),this.showVacations||(e.showVacations=this.showVacations),e.devices={},Object.entries(this.devices).forEach(([t,n])=>{e.devices[t]=n.toJson()}),e.deleteNeerDedlineBookingMessage=this.deleteNeerDedlineBookingMessage,e.orderNeerDedlineBookingMessage=this.orderNeerDedlineBookingMessage,e.generalBookingMessage=this.generalBookingMessage,e.closeScheduleOnHolidays=this.closeScheduleOnHolidays,this.customWindowMinute!=30&&(e.customWindowMinute=this.customWindowMinute),this.windowSpaces!=li.shortestTreatment&&(e.windowSpaces=tm[this.windowSpaces]),this.minutesBeforeBookingToConfirm!=1440&&(e.minutesBeforeBookingToConfirm=this.minutesBeforeBookingToConfirm),e.bookingDaysToDeleteLocal=[],e.notifications=this.notifications.toJson(),e.lastCleanDate=this.lastCleanDate.toString(),e.daysToAllowBookings=this.daysToAllowBookings,this.maxFutureBookings!=4&&(e.maxFutureBookings=this.maxFutureBookings),this.currentClientCount!=0&&(e.currentClientCount=this.currentClientCount),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),this.waitingListExceptionDays.entries.length>0&&(e.waitingListExceptionDays=Array.from(this.waitingListExceptionDays)),e.treatmentsSubjects={},Object.entries(this.treatmentsSubjects).forEach(([t,n])=>{e.treatmentsSubjects[t]=n.toJson()}),this.showWaitingListWhenThereIsChoises||(e.showWaitingListWhenThereIsChoises=this.showWaitingListWhenThereIsChoises),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.profileImg=this.profileImg,e.about=this.about,e.name=name,e.phone=this.phone,e.id=this.id,e.storyImages={},Object.entries(this.storyImages).forEach(([t,n])=>{e.storyImages[t]=n}),e.createdAt=this.createdAt.toString(),e}toString(){return JSON.stringify(this.toWorkerDocJson())+this.workerPublicData.toWorkerPublicDataJson().toString()}}class wt{static instance;constructor(){}static GI(){return wt.instance||(wt.instance=new wt),wt.instance}generalRepo=new Q0;business=new sn({businessId:"",design:new Je});workers={};businessIcon="";async initSettings(e,{fromLoading:t=!1}={}){try{this.workers={},lo.currentBusinesssId=e;const n=await Promise.all([this._loadSettingsDoc(e),this._loadBusinessWorkers(e)]);return!0}catch{return!1}}async loadBusiness(e,t,{fromLoading:n=!1,fromSearch:r=!1}={}){try{const s=await this.initSettings(e,{fromLoading:n});return!0}catch{return!1}}async _loadSettingsDoc(e){try{const t=await this.generalRepo.getDocRepo({path:rt,docId:e});return t===void 0||!t.exists||t.data()===null?(AppErrorsHelper.GI().error=Errors.notFoundBusiness,!1):(this.business=sn.fromJson(t.data(),e),!0)}catch{return!1}}async _loadBusinessWorkers(e){try{const t=`${rt}/${e}/${bn}`;console.log("eewwwwwwwww");const n=await this.generalRepo.getAllDocsInsideCollection(t);return n!==null&&n.forEach(r=>{const s=Wi.fromWorkerDocJson(r);Ee.GI().getPermission>1||(s.id,Ee.GI().user.id),this.workers[s.id]=s}),!0}catch(t){return t instanceof Error&&(Le.error(`Error while loading the business workers docs --> ${t}`),Le.error(t.stack)),!0}}}let Ix=kl();export{wt as B,Ch as E,Q0 as G,Pn as U,oi as a,ai as b,rt as c,Ex as d,lo as e,bx as f,Dx as g,Ax as h,bs as i,$f as j,Gf as k,Tx as l,Ee as m,Le as n,kx as r,fi as u,Ix as w};
