var BD=Object.defineProperty;var LD=(n,e,t)=>e in n?BD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>(LD(n,typeof e!="symbol"?e+"":e,t),t);import{d as VD,c as ae,g as iw,b as UD,$ as WD,_ as V0}from"./runtime.XCz8e1Wr.js";import{w as Eo}from"./index.ssLHv8Ot.js";import{aa as Bn}from"./scheduler.zcY2-Ylb.js";let Fg=Eo(null);function Hr(n){Fg.set(n),setTimeout(()=>{Fg.set(null)},2e3)}const U0={apiKey:"AIzaSyCSIQHCC23Z7ul639fD8JLMHu4yN77_0VA",authDomain:"managementsystemapp-c1fda.firebaseapp.com",databaseURL:"https://managementsystemapp-c1fda-default-rtdb.europe-west1.firebasedatabase.app",projectId:"managementsystemapp-c1fda",storageBucket:"managementsystemapp-c1fda.appspot.com",messagingSenderId:"670820779934",appId:"1:670820779934:web:fdcf77a952b59c3090788f",measurementId:"G-WP8J044JN9"};var Bg={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ow={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L=function(n,e){if(!n)throw Io(e)},Io=function(n){return new Error("Firebase Database ("+ow.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aw=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},HD=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},W0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,u=c?n[s+2]:0,l=i>>2,d=(i&3)<<4|a>>4;let f=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(f=64)),r.push(t[l],t[d],t[f],t[m])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(aw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):HD(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const d=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||d==null)throw new qD;const f=i<<2|a>>4;if(r.push(f),u!==64){const m=a<<4&240|u>>2;if(r.push(m),d!==64){const p=u<<6&192|d;r.push(p)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class qD extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cw=function(n){const e=aw(n);return W0.encodeByteArray(e,!0)},Su=function(n){return cw(n).replace(/\./g,"")},Pu=function(n){try{return W0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $D(n){return uw(void 0,n)}function uw(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!YD(t)||(n[t]=uw(n[t],e[t]));return n}function YD(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zD(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD=()=>zD().__FIREBASE_DEFAULTS__,JD=()=>{if(typeof process>"u"||typeof Bg>"u")return;const n=Bg.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},QD=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Pu(n[1]);return e&&JSON.parse(e)},H0=()=>{try{return GD()||JD()||QD()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},lw=n=>{var e,t;return(t=(e=H0())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},hw=n=>{const e=lw(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},dw=()=>{var n;return(n=H0())===null||n===void 0?void 0:n.config},fw=n=>{var e;return(e=H0())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Su(JSON.stringify(t)),Su(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function q0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qt())}function KD(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function pw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jD(){const n=qt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function gw(){return ow.NODE_ADMIN===!0}function XD(){try{return typeof indexedDB=="object"}catch{return!1}}function ZD(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA="FirebaseError";class Fr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=eA,Object.setPrototypeOf(this,Fr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yc.prototype.create)}}class yc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?tA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Fr(s,a,r)}}function tA(n,e){return n.replace(nA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const nA=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(n){return JSON.parse(n)}function dt(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yw=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Na(Pu(i[0])||""),t=Na(Pu(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},rA=function(n){const e=yw(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},sA=function(n){const e=yw(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ji(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Cf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ru(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Nu(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Lg(i)&&Lg(o)){if(!Nu(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Lg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function To(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)r[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)r[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const f=r[d-3]^r[d-8]^r[d-14]^r[d-16];r[d]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,l;for(let d=0;d<80;d++){d<40?d<20?(u=a^i&(o^a),l=1518500249):(u=i^o^a,l=1859775393):d<60?(u=i&o|a&(i|o),l=2400959708):(u=i^o^a,l=3395469782);const f=(s<<5|s>>>27)+u+c+l+r[d]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function oA(n,e){const t=new aA(n,e);return t.subscribe.bind(t)}class aA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");cA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Kh),s.error===void 0&&(s.error=Kh),s.complete===void 0&&(s.complete=Kh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function cA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Kh(){}function Rl(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uA=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,L(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Nl=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ee(n){return n&&n._delegate?n._delegate:n}class cs{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new gc;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(dA(e))try{this.getOrInitializeService({instanceIdentifier:As})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=As){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=As){return this.instances.has(e)}getOptions(e=As){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:hA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=As){return this.component?this.component.multipleInstances?e:As:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hA(n){return n===As?void 0:n}function dA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new lA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var de;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(de||(de={}));const mA={debug:de.DEBUG,verbose:de.VERBOSE,info:de.INFO,warn:de.WARN,error:de.ERROR,silent:de.SILENT},pA=de.INFO,gA={[de.DEBUG]:"log",[de.VERBOSE]:"log",[de.INFO]:"info",[de.WARN]:"warn",[de.ERROR]:"error"},yA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=gA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Ml=class{constructor(e){this.name=e,this._logLevel=pA,this._logHandler=yA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in de))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?mA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,de.DEBUG,...e),this._logHandler(this,de.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,de.VERBOSE,...e),this._logHandler(this,de.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,de.INFO,...e),this._logHandler(this,de.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,de.WARN,...e),this._logHandler(this,de.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,de.ERROR,...e),this._logHandler(this,de.ERROR,...e)}};const _A=(n,e)=>e.some(t=>n instanceof t);let Vg,Ug;function vA(){return Vg||(Vg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wA(){return Ug||(Ug=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _w=new WeakMap,bf=new WeakMap,vw=new WeakMap,jh=new WeakMap,$0=new WeakMap;function xA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(es(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&_w.set(t,n)}).catch(()=>{}),$0.set(e,n),e}function EA(n){if(bf.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});bf.set(n,e)}let kf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return bf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||vw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return es(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function IA(n){kf=n(kf)}function TA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Xh(this),e,...t);return vw.set(r,e.sort?e.sort():[e]),es(r)}:wA().includes(n)?function(...e){return n.apply(Xh(this),e),es(_w.get(this))}:function(...e){return es(n.apply(Xh(this),e))}}function DA(n){return typeof n=="function"?TA(n):(n instanceof IDBTransaction&&EA(n),_A(n,vA())?new Proxy(n,kf):n)}function es(n){if(n instanceof IDBRequest)return xA(n);if(jh.has(n))return jh.get(n);const e=DA(n);return e!==n&&(jh.set(n,e),$0.set(e,n)),e}const Xh=n=>$0.get(n);function AA(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=es(o);return r&&o.addEventListener("upgradeneeded",c=>{r(es(o.result),c.oldVersion,c.newVersion,es(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const CA=["get","getKey","getAll","getAllKeys","count"],bA=["put","add","delete","clear"],Zh=new Map;function Wg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Zh.get(e))return Zh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=bA.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||CA.includes(t)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&c.done]))[0]};return Zh.set(e,i),i}IA(n=>({...n,get:(e,t,r)=>Wg(e,t)||n.get(e,t,r),has:(e,t)=>!!Wg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(SA(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function SA(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Sf="@firebase/app",Hg="0.9.25";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zs=new Ml("@firebase/app"),PA="@firebase/app-compat",RA="@firebase/analytics-compat",NA="@firebase/analytics",MA="@firebase/app-check-compat",OA="@firebase/app-check",FA="@firebase/auth",BA="@firebase/auth-compat",LA="@firebase/database",VA="@firebase/database-compat",UA="@firebase/functions",WA="@firebase/functions-compat",HA="@firebase/installations",qA="@firebase/installations-compat",$A="@firebase/messaging",YA="@firebase/messaging-compat",zA="@firebase/performance",GA="@firebase/performance-compat",JA="@firebase/remote-config",QA="@firebase/remote-config-compat",KA="@firebase/storage",jA="@firebase/storage-compat",XA="@firebase/firestore",ZA="@firebase/firestore-compat",eC="firebase",tC="10.7.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pf="[DEFAULT]",nC={[Sf]:"fire-core",[PA]:"fire-core-compat",[NA]:"fire-analytics",[RA]:"fire-analytics-compat",[OA]:"fire-app-check",[MA]:"fire-app-check-compat",[FA]:"fire-auth",[BA]:"fire-auth-compat",[LA]:"fire-rtdb",[VA]:"fire-rtdb-compat",[UA]:"fire-fn",[WA]:"fire-fn-compat",[HA]:"fire-iid",[qA]:"fire-iid-compat",[$A]:"fire-fcm",[YA]:"fire-fcm-compat",[zA]:"fire-perf",[GA]:"fire-perf-compat",[JA]:"fire-rc",[QA]:"fire-rc-compat",[KA]:"fire-gcs",[jA]:"fire-gcs-compat",[XA]:"fire-fst",[ZA]:"fire-fst-compat","fire-js":"fire-js",[eC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ma=new Map,Rf=new Map;function rC(n,e){try{n.container.addComponent(e)}catch(t){zs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Gs(n){const e=n.name;if(Rf.has(e))return zs.debug(`There were multiple attempts to register component ${e}.`),!1;Rf.set(e,n);for(const t of Ma.values())rC(t,n);return!0}function Ol(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},ts=new yc("app","Firebase",sC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new cs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ts.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const si=tC;function Fl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Pf,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw ts.create("bad-app-name",{appName:String(s)});if(t||(t=dw()),!t)throw ts.create("no-options");const i=Ma.get(s);if(i){if(Nu(t,i.options)&&Nu(r,i.config))return i;throw ts.create("duplicate-app",{appName:s})}const o=new fA(s);for(const c of Rf.values())o.addComponent(c);const a=new iC(t,r,o);return Ma.set(s,a),a}function Do(n=Pf){const e=Ma.get(n);if(!e&&n===Pf&&dw())return Fl();if(!e)throw ts.create("no-app",{appName:n});return e}function Y0(){return Array.from(Ma.values())}function Yn(n,e,t){var r;let s=(r=nC[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),zs.warn(a.join(" "));return}Gs(new cs(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC="firebase-heartbeat-database",aC=1,Oa="firebase-heartbeat-store";let ed=null;function ww(){return ed||(ed=AA(oC,aC,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Oa)}}}).catch(n=>{throw ts.create("idb-open",{originalErrorMessage:n.message})})),ed}async function cC(n){try{return await(await ww()).transaction(Oa).objectStore(Oa).get(xw(n))}catch(e){if(e instanceof Fr)zs.warn(e.message);else{const t=ts.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});zs.warn(t.message)}}}async function qg(n,e){try{const r=(await ww()).transaction(Oa,"readwrite");await r.objectStore(Oa).put(e,xw(n)),await r.done}catch(t){if(t instanceof Fr)zs.warn(t.message);else{const r=ts.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});zs.warn(r.message)}}}function xw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC=1024,lC=30*24*60*60*1e3;class hC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new fC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=$g();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=lC}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=$g(),{heartbeatsToSend:r,unsentEntries:s}=dC(this._heartbeatsCache.heartbeats),i=Su(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function $g(){return new Date().toISOString().substring(0,10)}function dC(n,e=uC){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Yg(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Yg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class fC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return XD()?ZD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await cC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return qg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return qg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Yg(n){return Su(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mC(n){Gs(new cs("platform-logger",e=>new kA(e),"PRIVATE")),Gs(new cs("heartbeat",e=>new hC(e),"PRIVATE")),Yn(Sf,Hg,n),Yn(Sf,Hg,"esm2017"),Yn("fire-js","")}mC("");var pC="firebase",gC="10.7.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Yn(pC,gC,"app");const Nf={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]};function Mf(n,e,t,r=!1){const s=String(e),i=(c,u)=>`\x1B[${u[0]}m${c}\x1B[${u[1]}m`,o=(c,u)=>u!=null&&typeof u=="string"?i(c,Nf[u]):u!=null&&Array.isArray(u)?u.reduce((l,d)=>o(l,d),c):u!=null&&u[c.trim()]!=null?o(c,u[c.trim()]):u!=null&&u["*"]!=null?o(c,u["*"]):c,a=null;return s.replace(/{{(.+?)}}/g,(c,u)=>{var d;const l=t[u]!=null?String(t[u]):r?"":c;return n.stylePrettyLogs?o(l,((d=n==null?void 0:n.prettyLogStyles)==null?void 0:d[u])??a)+i("",Nf.reset):l})}function mn(n,e=2,t=0){return n!=null&&isNaN(n)?"":(n=n!=null?n+t:n,e===2?n==null?"--":n<10?"0"+n:n.toString():n==null?"---":n<10?"00"+n:n<100?"0"+n:n.toString())}function yC(n){return{href:n.href,protocol:n.protocol,username:n.username,password:n.password,host:n.host,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search,searchParams:[...n.searchParams].map(([e,t])=>({key:e,value:t})),hash:n.hash,origin:n.origin}}function Ew(n){const e=new Set;return JSON.stringify(n,(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return r})}function Mt(n,e){const t={seen:[],stylize:Iw};return e!=null&&Cw(t,e),Ai(t.showHidden)&&(t.showHidden=!1),Ai(t.depth)&&(t.depth=2),Ai(t.colors)&&(t.colors=!0),Ai(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=vC),Mu(t,n,t.depth)}Mt.colors=Nf;Mt.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function _C(n){return typeof n=="boolean"}function Ai(n){return n===void 0}function Iw(n){return n}function vC(n,e){var r,s,i,o;const t=Mt.styles[e];return t!=null&&((s=(r=Mt==null?void 0:Mt.colors)==null?void 0:r[t])==null?void 0:s[0])!=null&&((o=(i=Mt==null?void 0:Mt.colors)==null?void 0:i[t])==null?void 0:o[1])!=null?"\x1B["+Mt.colors[t][0]+"m"+n+"\x1B["+Mt.colors[t][1]+"m":n}function eu(n){return typeof n=="function"}function Tw(n){return typeof n=="string"}function wC(n){return typeof n=="number"}function Dw(n){return n===null}function Aw(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function td(n){return Bl(n)&&z0(n)==="[object RegExp]"}function Bl(n){return typeof n=="object"&&n!==null}function nd(n){return Bl(n)&&(z0(n)==="[object Error]"||n instanceof Error)}function zg(n){return Bl(n)&&z0(n)==="[object Date]"}function z0(n){return Object.prototype.toString.call(n)}function xC(n){const e={};return n.forEach(t=>{e[t]=!0}),e}function EC(n,e,t,r,s){const i=[];for(let o=0,a=e.length;o<a;++o)Aw(e,String(o))?i.push(Of(n,e,t,r,String(o),!0)):i.push("");return s.forEach(o=>{o.match(/^\d+$/)||i.push(Of(n,e,t,r,o,!0))}),i}function rd(n){return"["+Error.prototype.toString.call(n)+"]"}function Mu(n,e,t=0){if(n.customInspect&&e!=null&&eu(e)&&(e==null?void 0:e.inspect)!==Mt&&!(e!=null&&e.constructor&&(e==null?void 0:e.constructor.prototype)===e)){if(typeof e.inspect!="function"&&e.toString!=null)return e.toString();let l=e==null?void 0:e.inspect(t,n);return Tw(l)||(l=Mu(n,l,t)),l}const r=Yr(n,e);if(r)return r;let s=Object.keys(e);const i=xC(s);try{n.showHidden&&Object.getOwnPropertyNames&&(s=Object.getOwnPropertyNames(e))}catch{}if(nd(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return rd(e);if(s.length===0)if(eu(n.stylize)){if(eu(e)){const l=e.name?": "+e.name:"";return n.stylize("[Function"+l+"]","special")}if(td(e))return n.stylize(RegExp.prototype.toString.call(e),"regexp");if(zg(e))return n.stylize(Date.prototype.toISOString.call(e),"date");if(nd(e))return rd(e)}else return e;let o="",a=!1,c=[`{
`,`
}`];if(Array.isArray(e)&&(a=!0,c=[`[
`,`
]`]),eu(e)&&(o=" [Function"+(e.name?": "+e.name:"")+"]"),td(e)&&(o=" "+RegExp.prototype.toString.call(e)),zg(e)&&(o=" "+Date.prototype.toUTCString.call(e)),nd(e)&&(o=" "+rd(e)),s.length===0&&(!a||e.length==0))return c[0]+o+c[1];if(t<0)return td(e)?n.stylize(RegExp.prototype.toString.call(e),"regexp"):n.stylize("[Object]","special");n.seen.push(e);let u;return a?u=EC(n,e,t,i,s):u=s.map(l=>Of(n,e,t,i,l,a)),n.seen.pop(),IC(u,o,c)}function Of(n,e,t,r,s,i){let o,a,c={value:void 0};try{c.value=e[s]}catch{}try{Object.getOwnPropertyDescriptor&&(c=Object.getOwnPropertyDescriptor(e,s)||c)}catch{}if(c.get?c.set?a=n.stylize("[Getter/Setter]","special"):a=n.stylize("[Getter]","special"):c.set&&(a=n.stylize("[Setter]","special")),Aw(r,s)||(o="["+s+"]"),a||(n.seen.indexOf(c.value)<0?(Dw(t)?a=Mu(n,c.value,void 0):a=Mu(n,c.value,t-1),a.indexOf(`
`)>-1&&(i?a=a.split(`
`).map(u=>"  "+u).join(`
`).substr(2):a=`
`+a.split(`
`).map(u=>"   "+u).join(`
`))):a=n.stylize("[Circular]","special")),Ai(o)){if(i&&s.match(/^\d+$/))return a;o=JSON.stringify(""+s),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=n.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\\'").replace(/(^"|"$)/g,"'"),o=n.stylize(o,"string"))}return o+": "+a}function Yr(n,e){if(Ai(e))return n.stylize("undefined","undefined");if(Tw(e)){const t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\\'")+"'";return n.stylize(t,"string")}if(wC(e))return n.stylize(""+e,"number");if(_C(e))return n.stylize(""+e,"boolean");if(Dw(e))return n.stylize("null","null")}function IC(n,e,t){return t[0]+(e===""?"":e+`
`)+"  "+n.join(`,
  `)+" "+t[1]}function Cw(n,e){if(!e||!Bl(e))return n;const t={...n},r={...e},s=Object.keys(e);let i=s.length;for(;i--;)t[s[i]]=r[s[i]];return n}function TC(n,...e){const t={seen:[],stylize:Iw};n!=null&&Cw(t,n);const r=e[0];let s=0,i="",o="";if(typeof r=="string"){if(e.length===1)return r;let a,c=0;for(let u=0;u<r.length-1;u++)if(r.charCodeAt(u)===37){const l=r.charCodeAt(++u);if(s+1!==e.length){switch(l){case 115:{const d=e[++s];typeof d=="number"||typeof d=="bigint"?a=Yr(t,d):typeof d!="object"||d===null?a=String(d):a=Mt(d,{...n,compact:3,colors:!1,depth:0});break}case 106:a=Ew(e[++s]);break;case 100:{const d=e[++s];typeof d=="bigint"?a=Yr(t,d):typeof d=="symbol"?a="NaN":a=Yr(t,d);break}case 79:a=Mt(e[++s],n);break;case 111:a=Mt(e[++s],{...n,showHidden:!0,showProxy:!0,depth:4});break;case 105:{const d=e[++s];typeof d=="bigint"?a=Yr(t,d):typeof d=="symbol"?a="NaN":a=Yr(t,parseInt(a));break}case 102:{const d=e[++s];typeof d=="symbol"?a="NaN":a=Yr(t,parseInt(d));break}case 99:s+=1,a="";break;case 37:i+=r.slice(c,u),c=u+1;continue;default:continue}c!==u-1&&(i+=r.slice(c,u-1)),i+=a,c=u+1}else l===37&&(i+=r.slice(c,u),c=u+1)}c!==0&&(s++,o=" ",c<r.length&&(i+=r.slice(c)))}for(;s<e.length;){const a=e[s];i+=o,i+=typeof a!="string"?Mt(a,n):a,o=" ",s++}return i}const DC={getCallerStackFrame:bw,getErrorTrace:kw,getMeta:bC,transportJSON:PC,transportFormatted:SC,isBuffer:RC,isError:Pw,prettyFormatLogObj:kC,prettyFormatErrorObj:Rw};var sw;const AC={runtime:[typeof window,typeof document].includes("undefined")?"Generic":"Browser",browser:(sw=globalThis==null?void 0:globalThis.navigator)==null?void 0:sw.userAgent},CC=/(?:(?:file|https?|global code|[^@]+)@)?(?:file:)?((?:\/[^:/]+){2,})(?::(\d+))?(?::(\d+))?/;function bC(n,e,t,r,s,i){return Object.assign({},AC,{name:s,parentNames:i,date:new Date,logLevelId:n,logLevelName:e,path:r?void 0:bw(t)})}function bw(n,e=Error()){var t,r,s;return Sw((s=(r=(t=e==null?void 0:e.stack)==null?void 0:t.split(`
`))==null?void 0:r.filter(i=>!i.includes("Error: ")))==null?void 0:s[n])}function kw(n){var e,t,r;return(r=(t=(e=n==null?void 0:n.stack)==null?void 0:e.split(`
`))==null?void 0:t.filter(s=>!s.includes("Error: ")))==null?void 0:r.reduce((s,i)=>(s.push(Sw(i)),s),[])}function Sw(n){var r;const e=(r=globalThis==null?void 0:globalThis.location)==null?void 0:r.origin,t={fullFilePath:void 0,fileName:void 0,fileNameWithLine:void 0,fileColumn:void 0,fileLine:void 0,filePath:void 0,filePathWithLine:void 0,method:void 0};if(n!=null){const s=n.match(CC);if(s){t.filePath=s[1].replace(/\?.*$/,""),t.fullFilePath=`${e}${t.filePath}`;const i=t.filePath.split("/");t.fileName=i[i.length-1],t.fileLine=s[2],t.fileColumn=s[3],t.filePathWithLine=`${t.filePath}:${t.fileLine}`,t.fileNameWithLine=`${t.fileName}:${t.fileLine}`}}return t}function Pw(n){return n instanceof Error}function kC(n,e){return n.reduce((t,r)=>(Pw(r)?t.errors.push(Rw(r,e)):t.args.push(r),t),{args:[],errors:[]})}function Rw(n,e){const t=kw(n).map(s=>Mf(e,e.prettyErrorStackTemplate,{...s},!0)),r={errorName:` ${n.name} `,errorMessage:Object.getOwnPropertyNames(n).reduce((s,i)=>(i!=="stack"&&s.push(n[i]),s),[]).join(", "),errorStack:t.join(`
`)};return Mf(e,e.prettyErrorTemplate,r)}function SC(n,e,t,r){const s=(t.length>0&&e.length>0?`
`:"")+t.join(`
`);r.prettyInspectOptions.colors=r.stylePrettyLogs,console.log(n+TC(r.prettyInspectOptions,...e)+s)}function PC(n){console.log(Ew(n))}function RC(n){return!1}class NC{constructor(e,t,r=4){var s,i,o,a,c,u,l,d;this.logObj=t,this.stackDepthLevel=r,this.runtime=DC,this.settings={type:(e==null?void 0:e.type)??"pretty",name:e==null?void 0:e.name,parentNames:e==null?void 0:e.parentNames,minLevel:(e==null?void 0:e.minLevel)??0,argumentsArrayName:e==null?void 0:e.argumentsArrayName,hideLogPositionForProduction:(e==null?void 0:e.hideLogPositionForProduction)??!1,prettyLogTemplate:(e==null?void 0:e.prettyLogTemplate)??"{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}	{{logLevelName}}	{{filePathWithLine}}{{nameWithDelimiterPrefix}}	",prettyErrorTemplate:(e==null?void 0:e.prettyErrorTemplate)??`
{{errorName}} {{errorMessage}}
error stack:
{{errorStack}}`,prettyErrorStackTemplate:(e==null?void 0:e.prettyErrorStackTemplate)??`   {{fileName}}	{{method}}
	{{filePathWithLine}}`,prettyErrorParentNamesSeparator:(e==null?void 0:e.prettyErrorParentNamesSeparator)??":",prettyErrorLoggerNameDelimiter:(e==null?void 0:e.prettyErrorLoggerNameDelimiter)??"	",stylePrettyLogs:(e==null?void 0:e.stylePrettyLogs)??!0,prettyLogTimeZone:(e==null?void 0:e.prettyLogTimeZone)??"UTC",prettyLogStyles:(e==null?void 0:e.prettyLogStyles)??{logLevelName:{"*":["bold","black","bgWhiteBright","dim"],SILLY:["bold","white"],TRACE:["bold","whiteBright"],DEBUG:["bold","green"],INFO:["bold","blue"],WARN:["bold","yellow"],ERROR:["bold","red"],FATAL:["bold","redBright"]},dateIsoStr:"white",filePathWithLine:"white",name:["white","bold"],nameWithDelimiterPrefix:["white","bold"],nameWithDelimiterSuffix:["white","bold"],errorName:["bold","bgRedBright","whiteBright"],fileName:["yellow"],fileNameWithLine:"white"},prettyInspectOptions:(e==null?void 0:e.prettyInspectOptions)??{colors:!0,compact:!1,depth:1/0},metaProperty:(e==null?void 0:e.metaProperty)??"_meta",maskPlaceholder:(e==null?void 0:e.maskPlaceholder)??"[***]",maskValuesOfKeys:(e==null?void 0:e.maskValuesOfKeys)??["password"],maskValuesOfKeysCaseInsensitive:(e==null?void 0:e.maskValuesOfKeysCaseInsensitive)??!1,maskValuesRegEx:e==null?void 0:e.maskValuesRegEx,prefix:[...(e==null?void 0:e.prefix)??[]],attachedTransports:[...(e==null?void 0:e.attachedTransports)??[]],overwrite:{mask:(s=e==null?void 0:e.overwrite)==null?void 0:s.mask,toLogObj:(i=e==null?void 0:e.overwrite)==null?void 0:i.toLogObj,addMeta:(o=e==null?void 0:e.overwrite)==null?void 0:o.addMeta,addPlaceholders:(a=e==null?void 0:e.overwrite)==null?void 0:a.addPlaceholders,formatMeta:(c=e==null?void 0:e.overwrite)==null?void 0:c.formatMeta,formatLogObj:(u=e==null?void 0:e.overwrite)==null?void 0:u.formatLogObj,transportFormatted:(l=e==null?void 0:e.overwrite)==null?void 0:l.transportFormatted,transportJSON:(d=e==null?void 0:e.overwrite)==null?void 0:d.transportJSON}}}log(e,t,...r){var d,f,m,p,y,g,x,_,v,w,D,T,E,A;if(e<this.settings.minLevel)return;const s=[...this.settings.prefix,...r],i=((d=this.settings.overwrite)==null?void 0:d.mask)!=null?(f=this.settings.overwrite)==null?void 0:f.mask(s):this.settings.maskValuesOfKeys!=null&&this.settings.maskValuesOfKeys.length>0?this._mask(s):s,o=this.logObj!=null?this._recursiveCloneAndExecuteFunctions(this.logObj):void 0,a=((m=this.settings.overwrite)==null?void 0:m.toLogObj)!=null?(p=this.settings.overwrite)==null?void 0:p.toLogObj(i,o):this._toLogObj(i,o),c=((y=this.settings.overwrite)==null?void 0:y.addMeta)!=null?(g=this.settings.overwrite)==null?void 0:g.addMeta(a,e,t):this._addMetaToLogObj(a,e,t);let u,l;return((x=this.settings.overwrite)==null?void 0:x.formatMeta)!=null&&(u=(_=this.settings.overwrite)==null?void 0:_.formatMeta(c==null?void 0:c[this.settings.metaProperty])),((v=this.settings.overwrite)==null?void 0:v.formatLogObj)!=null&&(l=(w=this.settings.overwrite)==null?void 0:w.formatLogObj(i,this.settings)),this.settings.type==="pretty"&&(u=u??this._prettyFormatLogObjMeta(c==null?void 0:c[this.settings.metaProperty]),l=l??this.runtime.prettyFormatLogObj(i,this.settings)),u!=null&&l!=null?((D=this.settings.overwrite)==null?void 0:D.transportFormatted)!=null?(T=this.settings.overwrite)==null||T.transportFormatted(u,l.args,l.errors,this.settings):this.runtime.transportFormatted(u,l.args,l.errors,this.settings):((E=this.settings.overwrite)==null?void 0:E.transportJSON)!=null?(A=this.settings.overwrite)==null||A.transportJSON(c):this.settings.type!=="hidden"&&this.runtime.transportJSON(c),this.settings.attachedTransports!=null&&this.settings.attachedTransports.length>0&&this.settings.attachedTransports.forEach(k=>{k(c)}),c}attachTransport(e){this.settings.attachedTransports.push(e)}getSubLogger(e,t){var i,o,a;const r={...this.settings,...e,parentNames:((i=this.settings)==null?void 0:i.parentNames)!=null&&((o=this.settings)==null?void 0:o.name)!=null?[...this.settings.parentNames,this.settings.name]:((a=this.settings)==null?void 0:a.name)!=null?[this.settings.name]:void 0,prefix:[...this.settings.prefix,...(e==null?void 0:e.prefix)??[]]};return new this.constructor(r,t??this.logObj,this.stackDepthLevel)}_mask(e){const t=this.settings.maskValuesOfKeysCaseInsensitive!==!0?this.settings.maskValuesOfKeys:this.settings.maskValuesOfKeys.map(r=>r.toLowerCase());return e==null?void 0:e.map(r=>this._recursiveCloneAndMaskValuesOfKeys(r,t))}_recursiveCloneAndMaskValuesOfKeys(e,t,r=[]){var s,i;if(r.includes(e))return{...e};if(typeof e=="object"&&e!==null&&r.push(e),this.runtime.isError(e)||this.runtime.isBuffer(e))return e;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Array.isArray(e))return e.map(o=>this._recursiveCloneAndMaskValuesOfKeys(o,t,r));if(e instanceof Date)return new Date(e.getTime());if(e instanceof URL)return yC(e);if(e!==null&&typeof e=="object"){const o=this.runtime.isError(e)?this._cloneError(e):Object.create(Object.getPrototypeOf(e));return Object.getOwnPropertyNames(e).reduce((a,c)=>{var u;return a[c]=t.includes(((u=this.settings)==null?void 0:u.maskValuesOfKeysCaseInsensitive)!==!0?c:c.toLowerCase())?this.settings.maskPlaceholder:this._recursiveCloneAndMaskValuesOfKeys(e[c],t,r),a},o)}else{if(typeof e=="string"){let o=e;for(const a of((s=this.settings)==null?void 0:s.maskValuesRegEx)||[])o=o.replace(a,((i=this.settings)==null?void 0:i.maskPlaceholder)||"");return o}return e}}_recursiveCloneAndExecuteFunctions(e,t=[]){return this.isObjectOrArray(e)&&t.includes(e)?this.shallowCopy(e):(this.isObjectOrArray(e)&&t.push(e),Array.isArray(e)?e.map(r=>this._recursiveCloneAndExecuteFunctions(r,t)):e instanceof Date?new Date(e.getTime()):this.isObject(e)?Object.getOwnPropertyNames(e).reduce((r,s)=>{const i=Object.getOwnPropertyDescriptor(e,s);if(i){Object.defineProperty(r,s,i);const o=e[s];r[s]=typeof o=="function"?o():this._recursiveCloneAndExecuteFunctions(o,t)}return r},Object.create(Object.getPrototypeOf(e))):e)}isObjectOrArray(e){return typeof e=="object"&&e!==null}isObject(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null}shallowCopy(e){return Array.isArray(e)?[...e]:{...e}}_toLogObj(e,t={}){return e=e==null?void 0:e.map(r=>this.runtime.isError(r)?this._toErrorObject(r):r),this.settings.argumentsArrayName==null?e.length===1&&!Array.isArray(e[0])&&this.runtime.isBuffer(e[0])!==!0&&!(e[0]instanceof Date)?t=typeof e[0]=="object"&&e[0]!=null?{...e[0],...t}:{0:e[0],...t}:t={...t,...e}:t={...t,[this.settings.argumentsArrayName]:e},t}_cloneError(e){const t=new e.constructor;return Object.getOwnPropertyNames(e).forEach(r=>{t[r]=e[r]}),t}_toErrorObject(e){return{nativeError:e,name:e.name??"Error",message:e.message,stack:this.runtime.getErrorTrace(e)}}_addMetaToLogObj(e,t,r){return{...e,[this.settings.metaProperty]:this.runtime.getMeta(t,r,this.stackDepthLevel,this.settings.hideLogPositionForProduction,this.settings.name,this.settings.parentNames)}}_prettyFormatLogObjMeta(e){var o,a,c,u,l,d,f,m,p,y,g,x,_,v,w,D,T,E,A,k,I,C;if(e==null)return"";let t=this.settings.prettyLogTemplate;const r={};t.includes("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}")?t=t.replace("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}","{{dateIsoStr}}"):this.settings.prettyLogTimeZone==="UTC"?(r.yyyy=((o=e==null?void 0:e.date)==null?void 0:o.getUTCFullYear())??"----",r.mm=mn((a=e==null?void 0:e.date)==null?void 0:a.getUTCMonth(),2,1),r.dd=mn((c=e==null?void 0:e.date)==null?void 0:c.getUTCDate(),2),r.hh=mn((u=e==null?void 0:e.date)==null?void 0:u.getUTCHours(),2),r.MM=mn((l=e==null?void 0:e.date)==null?void 0:l.getUTCMinutes(),2),r.ss=mn((d=e==null?void 0:e.date)==null?void 0:d.getUTCSeconds(),2),r.ms=mn((f=e==null?void 0:e.date)==null?void 0:f.getUTCMilliseconds(),3)):(r.yyyy=((m=e==null?void 0:e.date)==null?void 0:m.getFullYear())??"----",r.mm=mn((p=e==null?void 0:e.date)==null?void 0:p.getMonth(),2,1),r.dd=mn((y=e==null?void 0:e.date)==null?void 0:y.getDate(),2),r.hh=mn((g=e==null?void 0:e.date)==null?void 0:g.getHours(),2),r.MM=mn((x=e==null?void 0:e.date)==null?void 0:x.getMinutes(),2),r.ss=mn((_=e==null?void 0:e.date)==null?void 0:_.getSeconds(),2),r.ms=mn((v=e==null?void 0:e.date)==null?void 0:v.getMilliseconds(),3));const s=this.settings.prettyLogTimeZone==="UTC"?e==null?void 0:e.date:new Date(((w=e==null?void 0:e.date)==null?void 0:w.getTime())-((D=e==null?void 0:e.date)==null?void 0:D.getTimezoneOffset())*6e4);r.rawIsoStr=s==null?void 0:s.toISOString(),r.dateIsoStr=s==null?void 0:s.toISOString().replace("T"," ").replace("Z",""),r.logLevelName=e==null?void 0:e.logLevelName,r.fileNameWithLine=((T=e==null?void 0:e.path)==null?void 0:T.fileNameWithLine)??"",r.filePathWithLine=((E=e==null?void 0:e.path)==null?void 0:E.filePathWithLine)??"",r.fullFilePath=((A=e==null?void 0:e.path)==null?void 0:A.fullFilePath)??"";let i=(k=this.settings.parentNames)==null?void 0:k.join(this.settings.prettyErrorParentNamesSeparator);return i=i!=null&&(e==null?void 0:e.name)!=null?i+this.settings.prettyErrorParentNamesSeparator:void 0,r.name=(e==null?void 0:e.name)!=null||i!=null?(i??"")+(e==null?void 0:e.name):"",r.nameWithDelimiterPrefix=r.name.length>0?this.settings.prettyErrorLoggerNameDelimiter+r.name:"",r.nameWithDelimiterSuffix=r.name.length>0?r.name+this.settings.prettyErrorLoggerNameDelimiter:"",((I=this.settings.overwrite)==null?void 0:I.addPlaceholders)!=null&&((C=this.settings.overwrite)==null||C.addPlaceholders(e,r)),Mf(this.settings,t,r)}}class MC extends NC{constructor(e,t){const r=typeof window<"u"&&typeof document<"u",s=r?window.chrome!==void 0&&window.CSS!==void 0&&window.CSS.supports("color","green"):!1,i=r?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1;e=e||{},e.stylePrettyLogs=e.stylePrettyLogs&&r&&!s?!1:e.stylePrettyLogs,super(e,t,i?4:5)}log(e,t,...r){return super.log(e,t,...r)}silly(...e){return super.log(0,"SILLY",...e)}trace(...e){return super.log(1,"TRACE",...e)}debug(...e){return super.log(2,"DEBUG",...e)}info(...e){return super.log(3,"INFO",...e)}warn(...e){return super.log(4,"WARN",...e)}error(...e){return super.log(5,"ERROR",...e)}fatal(...e){return super.log(6,"FATAL",...e)}getSubLogger(e,t){return super.getSubLogger(e,t)}}const Se=new MC({minLevel:4});var OC=(n=>(n.login="login",n.enter="enter",n))(OC||{});const T5={login:"login",enter:"enter"},D5=["+972-504040624","+972-525656377"],FC=new Date(2024,0,9,20,0),BC="production",Ke=`enviroments/${BC}`,Zt="Users",Nw="BookingsObjects",LC="Notifications",A5="Errors",C5="Helpers",lt="PublicData",tn="Workers",sd="Invoices",id="PaymentRequests",fa="Bookings",Fn="Phones",yi="collections",Tt="Businesses",Gg="PaymentsRequestsPreviews",b5="Reports",k5="customersData",VC="publicCustomersData",Jg="clients",en="publicData",UC="scheduleNotifications",Mw="recurrenceEvents",Ow="recurrenceBookings",Fw="multiEventsTimes",S5="BookingsEvents",Qg="LikesCollection",Kg="BusinessData",WC="Counters",HC="sasimple",qC="phone",jg="^&8@^",Xg="^&9@^";var Ff=(n=>(n[n.add=0]="add",n[n.remove=1]="remove",n))(Ff||{}),ma=(n=>(n[n.increment=0]="increment",n[n.decrement=1]="decrement",n))(ma||{}),ks=(n=>(n[n.basic=0]="basic",n[n.advanced=1]="advanced",n[n.trial=2]="trial",n[n.landingPage=3]="landingPage",n[n.golden=4]="golden",n))(ks||{}),$;let ee=($=class{constructor({days:e=0,hours:t=0,minutes:r=0,seconds:s=0,milliseconds:i=0,microseconds:o=0}){h(this,"_duration");h(this,"days",0);h(this,"hours",0);h(this,"minutes",0);h(this,"seconds",0);h(this,"milliseconds",0);h(this,"microseconds",0);this._duration=o+$.microsecondsPerMillisecond*i+$.microsecondsPerSecond*s+$.microsecondsPerMinute*r+$.microsecondsPerHour*t+$.microsecondsPerDay*e}static _microseconds(e){return new $({microseconds:e})}add(e){return $._microseconds(this._duration+e._duration)}subtract(e){return $._microseconds(this._duration-e._duration)}multiply(e){return $._microseconds(Math.round(this._duration*e))}divide(e){if(e===0)throw new Error("IntegerDivisionByZeroException");return $._microseconds(Math.floor(this._duration/e))}lessThan(e){return this._duration<e._duration}greaterThan(e){return this._duration>e._duration}lessThanOrEqual(e){return this._duration<=e._duration}greaterThanOrEqual(e){return this._duration>=e._duration}get inDays(){return Math.floor(this._duration/$.microsecondsPerDay)}get inHours(){return Math.floor(this._duration/$.microsecondsPerHour)}get inMinutes(){return Math.floor(this._duration/$.microsecondsPerMinute)}get inSeconds(){return Math.floor(this._duration/$.microsecondsPerSecond)}get inMilliseconds(){return Math.floor(this._duration/$.microsecondsPerMillisecond)}get inMicroseconds(){return this._duration}equals(e){return e instanceof $&&this._duration===e.inMicroseconds}compareTo(e){return this._duration-e._duration}},h($,"microsecondsPerMillisecond",1e3),h($,"millisecondsPerSecond",1e3),h($,"secondsPerMinute",60),h($,"minutesPerHour",60),h($,"hoursPerDay",24),h($,"microsecondsPerSecond",$.microsecondsPerMillisecond*$.millisecondsPerSecond),h($,"microsecondsPerMinute",$.microsecondsPerSecond*$.secondsPerMinute),h($,"microsecondsPerHour",$.microsecondsPerMinute*$.minutesPerHour),h($,"microsecondsPerDay",$.microsecondsPerHour*$.hoursPerDay),h($,"millisecondsPerMinute",$.millisecondsPerSecond*$.secondsPerMinute),h($,"millisecondsPerHour",$.millisecondsPerMinute*$.minutesPerHour),h($,"millisecondsPerDay",$.millisecondsPerHour*$.hoursPerDay),h($,"secondsPerHour",$.secondsPerMinute*$.minutesPerHour),h($,"secondsPerDay",$.secondsPerHour*$.hoursPerDay),h($,"minutesPerDay",$.minutesPerHour*$.hoursPerDay),h($,"zero",new $({seconds:0})),$);var Ft=(n=>(n.waiting="waiting",n.approved="approved",n))(Ft||{});const Bw={waiting:"waiting",approved:"approved"},Lw={waiting:"waiting",approved:"approved"};var pn=(n=>(n.app="app",n.web="web",n.byWorker="byWorker",n))(pn||{});const Vw={app:"app",web:"web",byWorker:"byWorker"},Uw={app:"app",web:"web",byWorker:"byWorker"};var Yt=(n=>(n.regular="regular",n.confirmArrival="confirmArrival",n))(Yt||{});const Ri={regular:"regular",confirmArrival:"confirmArrival"},Ns={regular:"regular",confirmArrival:"confirmArrival"};var K=(n=>(n[n.message=0]="message",n[n.push=1]="push",n[n.none=2]="none",n[n.whatsapp=3]="whatsapp",n))(K||{});const $C={0:"message",1:"push",2:"none",3:"whatsapp"},Ww={message:0,push:1,whatsapp:3,none:2},Zg=new ee({hours:3}),P5=new ee({minutes:5});var re=(n=>(n[n.sendSms=0]="sendSms",n[n.updateDisplayName=1]="updateDisplayName",n[n.logout=2]="logout",n[n.serverError=3]="serverError",n[n.storageError=4]="storageError",n[n.listener=5]="listener",n[n.notLogedIn=6]="notLogedIn",n[n.illegalFields=7]="illegalFields",n[n.passedLimit=8]="passedLimit",n[n.notFoundItem=9]="notFoundItem",n[n.takenBooking=10]="takenBooking",n[n.overlapWithOntherItem=11]="overlapWithOntherItem",n[n.takenMultiBooking=12]="takenMultiBooking",n[n.alreadyWorker=13]="alreadyWorker",n[n.userNotFound=14]="userNotFound",n[n.verification=15]="verification",n[n.network=16]="network",n[n.emptyField=17]="emptyField",n[n.alreadyExistItem=18]="alreadyExistItem",n[n.uploadImages=19]="uploadImages",n[n.notSelectedImages=20]="notSelectedImages",n[n.wrongOptCode=21]="wrongOptCode",n[n.expiredOpt=22]="expiredOpt",n[n.unknown=23]="unknown",n[n.timeout=24]="timeout",n[n.purchaseError=25]="purchaseError",n[n.anonymouslySignIn=26]="anonymouslySignIn",n[n.lowSubType=27]="lowSubType",n[n.coincidingEvent=28]="coincidingEvent",n[n.coincidingHoliday=29]="coincidingHoliday",n[n.realTimeServerError=30]="realTimeServerError",n[n.blockedUser=31]="blockedUser",n[n.noPermission=32]="noPermission",n[n.paymentProblem=33]="paymentProblem",n[n.currentlyOrderingForTime=34]="currentlyOrderingForTime",n[n.notFoundBusiness=35]="notFoundBusiness",n[n.savePaymentDataError=36]="savePaymentDataError",n[n.redeemDepositError=37]="redeemDepositError",n[n.saveDepositDataError=38]="saveDepositDataError",n[n.endOfWork=39]="endOfWork",n[n.invoiceCreation=40]="invoiceCreation",n[n.cantBookRecurrenceOnDates=41]="cantBookRecurrenceOnDates",n[n.cantBookRecurrenceOnEndlessDates=42]="cantBookRecurrenceOnEndlessDates",n[n.eventHasNoAccurances=43]="eventHasNoAccurances",n[n.workerDeleteTheBookingMeanwhile=44]="workerDeleteTheBookingMeanwhile",n[n.workerUpdatedTheBookingMeanwhile=45]="workerUpdatedTheBookingMeanwhile",n[n.workerDeleteEventMeanwhile=46]="workerDeleteEventMeanwhile",n[n.workerUpdatedTheBookingWhilePayment=47]="workerUpdatedTheBookingWhilePayment",n[n.blockCard=48]="blockCard",n[n.stolenCard=49]="stolenCard",n[n.callCreditCompany=50]="callCreditCompany",n[n.transactionNotConfirmed=51]="transactionNotConfirmed",n[n.fakeCard=52]="fakeCard",n[n.wrongCVV=53]="wrongCVV",n[n.worngCAVVUCAF=54]="worngCAVVUCAF",n[n.worngAvs=55]="worngAvs",n[n.networkDisconnect=56]="networkDisconnect",n[n.partlyConfirm=57]="partlyConfirm",n[n.lackOfPointsStarsMilesOtherBenefit=58]="lackOfPointsStarsMilesOtherBenefit",n[n.unauthorizedCardAtTheTerminal=59]="unauthorizedCardAtTheTerminal",n[n.invalidBalanceCode=60]="invalidBalanceCode",n[n.cardNotAssociatedWithTheNetwork=61]="cardNotAssociatedWithTheNetwork",n[n.cardIsNotValid=62]="cardIsNotValid",n[n.currencyTypeIsNotAllowed=63]="currencyTypeIsNotAllowed",n[n.thereIsNoAuthorizationForACreditTypeInTheTransaction=64]="thereIsNoAuthorizationForACreditTypeInTheTransaction",n[n.invalidId=65]="invalidId",n[n.noTreatment=66]="noTreatment",n[n.terminalNotAuthorizedToWorkWithThisMethodTheTerminalIsNotAuthorized=67]="terminalNotAuthorizedToWorkWithThisMethodTheTerminalIsNotAuthorized",n[n.authenticationErrorTerminalReference=68]="authenticationErrorTerminalReference",n[n.exceedingTheNumberOfPayments=69]="exceedingTheNumberOfPayments",n[n.communicationError=70]="communicationError",n[n.canceledTransaction=71]="canceledTransaction",n[n.invalidToken=72]="invalidToken",n[n.terminalNotAuthorizedToUseTheToken=73]="terminalNotAuthorizedToUseTheToken",n[n.deferredCharge=74]="deferredCharge",n[n.approvalWithoutCharge=75]="approvalWithoutCharge",n[n.receivingTransactionDetails=76]="receivingTransactionDetails",n[n.theCardDetailsWereNotReadInFull=77]="theCardDetailsWereNotReadInFull",n[n.theAmountOfTheItemsDoesNotMatch=78]="theAmountOfTheItemsDoesNotMatch",n[n.YouMustEnterAFirstOrLastName=79]="YouMustEnterAFirstOrLastName",n[n.transactionDescriptionMustBeEntered=80]="transactionDescriptionMustBeEntered",n[n.youCanCreditTheEntireTransactionOrASmallAmount=81]="youCanCreditTheEntireTransactionOrASmallAmount",n[n.bigDiffrentBetweenLoginAndDelete=82]="bigDiffrentBetweenLoginAndDelete",n[n.providerNotAllowed=83]="providerNotAllowed",n[n.userDisable=84]="userDisable",n[n.providerAlreadyLinked=85]="providerAlreadyLinked",n[n.credentialAlreadyInUse=86]="credentialAlreadyInUse",n[n.accountAlreadyExists=87]="accountAlreadyExists",n[n.invalidCredential=88]="invalidCredential",n[n.userMissmatch=89]="userMissmatch",n[n.noSuchProvider=90]="noSuchProvider",n[n.duplicateBusinesssName=91]="duplicateBusinesssName",n[n.alreadyExistPhone=92]="alreadyExistPhone",n[n.userExitManually=93]="userExitManually",n[n.tooManyAttempts=94]="tooManyAttempts",n[n.expiredCode=95]="expiredCode",n[n.cantUpdateEmailTooShortTimeBetween=96]="cantUpdateEmailTooShortTimeBetween",n[n.cantUpdatePhonelTooShortTimeBetween=97]="cantUpdatePhonelTooShortTimeBetween",n[n.invalidPhoneNumber=98]="invalidPhoneNumber",n))(re||{});const Pl=class Pl{constructor(){h(this,"errorCode",100);h(this,"error",re.unknown);h(this,"details","")}static GI(){return this._singleton}addError({code:e,error:t,details:r}){this.error=t||this.error,this.errorCode=e||this.errorCode,this.details=r||this.details}};h(Pl,"_singleton",new Pl);let _e=Pl;class mr{constructor({code:e="",name:t="",symbol:r=""}={}){h(this,"code","");h(this,"name","");h(this,"symbol","");this.code=e,this.name=t,this.symbol=r}static fromJson(e){return new mr({code:e.code||"",name:e.name||"",symbol:e.symbol||""})}toJson(){return{code:this.code,name:this.name,symbol:this.symbol}}isEqual(e){return e.code===this.code}toString(){return JSON.stringify(this.toJson(),null,2)}}const us=new mr({code:"USD",name:"US Dollar",symbol:"$"}),ey={ILS:new mr({code:"ILS",name:"Israel Shekel",symbol:""}),USD:new mr({code:"USD",name:"United States Dollar",symbol:"$"}),EUR:new mr({code:"EUR",name:"Euro",symbol:""}),GBP:new mr({code:"GBP",name:"British Pound",symbol:""})},yu=5,YC="https://icom.yaad.net/cgi-bin/yaadpay/yaadpay3ds.pl?Masof=MASOFNUMBER&action=PrintHesh&asm=INVOICENUMBER&type=PDF&signature=SIGNATURE";class Bt{}h(Bt,"currentBusinesssId",""),h(Bt,"hasPaddingFromTop",!1),h(Bt,"paddingFromTop",0),h(Bt,"attemptsLeftForCardPassword",yu),h(Bt,"productionVersion",!0),h(Bt,"developers",{});const Pa=class Pa{constructor(){}static GI(){return Pa._singleton}getLisksChildPath(e){const t=`${Tt}/${Bt.currentBusinesssId}/${tn}`,r=`${e}/${Qg}`;return`${t}/${r}`}getImageStorageName(e,t){const r=e.toUpperCase(),s=t.split(r);return`${r}${s[1].split(".jpg")[0]}`}getLikesChildPath(e,t,r){const s=`${Tt}/${t}/${tn}`,i=`${e}/${Qg}`;return`${s}/${i}/${r}`}getBusinessDataPath(e){return`${Tt}/${e}/${Kg}`}getWorkerCountersPath(e,t){return`${Tt}/${e}/${tn}/${t}/${WC}`}getMessageCounterPath(e){return`${Tt}/${e}/${Kg}/messagesCounter`}userBookingsPathByBooking(e){return`${Zt}/${e.customerId}/${lt}/${en}/${fa}`}userBookingsPathByUser(e){return`${Zt}/${e}/${lt}/${en}/${fa}`}workerBookingsPath(e){return`${Tt}/${e.buisnessId}/${tn}/${e.workerId}/${lt}/${en}/${Nw}`}};h(Pa,"_singleton",new Pa);let Fa=Pa;const ty="data:image/webp;base64,UklGRjgGAABXRUJQVlA4WAoAAAAQAAAAfwAAfwAAQUxQSC8DAAABoEbb1iFJehGJtm3btu1S27Zt27Zt27a7x3ZZWcyM+MYT8b77/Z6ImAD63/+y6umL+I2ZPWdM26LplZS6wa7vfOJvve/mFVJOtulfJYh/HTzOpZRsU8PFfzYOpVBIg4/CSnOcMlIujhbWJh7fNLqSSwG5TxjCzl/XF9bA5bwn7I7YXRJalqvCfvPzAA2XvsdkIETyPCesgV7B0zvfAapwuOCa2AeT65LgG1IFUptkRuKkBsh5VXBObAyoRCwrcc2JZ7rgHVkLz01mYjUc7Rdub9OiSe/jllAeTWnBfhqaJvxOoenD71s04/mZmcHM5ycaglkuwTAwKyRYAmapBFvBzJFgH5iREhwFEyTBaTDVlJfZ5HcEDP3Mbx+a6/y2gNGf8LvmwlLI5BdaHUszwd8bhKW9BL6uWBpLkByIpaIEnoZYspr8QgtioR/4vXeBOcHvIIFt6eNmtkGT/jm3Vw401DiY1691CW+bTxmZb9sS4raMTuciyJl/ZuNpRZi1LWyeZgFFbT1MjPmE2nmTybd5YJEfkzWEW3/JIrIUMPLzMTCW6chSnmDwWQmCXvk32xKHE/jxhl0nneiynrUpuCTBL/GTLbFBpMDmYTaY8x0qoH4J1p12kRL1OT6rLmYmRepDDGuuZiZl6p9b04UU+t6azsrrpJJ31nRWyVtruqnkgzXdVfKpNT1U8pnyPrGmpzK0klNjrXncJb0SnPUO/uQVFid8OjMfOC13263fGsLWpHtjamZB5Srbf/dXyYJh1NN1QXl0JFrG3IWrdZp1/GOoV7BNCn6+b1KXuiWyp9Tky9161e0Qn5DUCLsxrUZmqfSySz8zhOSxd4dllsZZ61SkQGh8MyW3JFMSBMx3fmmkaPgKh0jsJwWlXJ6AIn5rWjlID3iN4UNTnaRNt9wjn2d+epK6+E1DrpjrhUl2d8Azrzzm424uApgq6Lkhh/koIBWhbH0zkV/M9dY6AdXLLf7U4GT+tLAkwU3b8lA0l6gDrdMR5pR+u7702BX5yW6/NITcXSxw3d2fk6wxfn60LqCwixTozFKkw9Sdl599E+wxhTA8IV88u7B9UofCmdwkIwBWUDgg4gIAAPASAJ0BKoAAgAA+kUSdSaWkIyEpGAlgsBIJZw3CxcSlHkyPOhk26d2xRwWRYrXywLe8+2egAWMopyguMLJ9ZV1BQaqnj7//iRNIvo+LtU9x5ugDP7vnIlo5PLSXrhJOdyOWq+Bw+jHNKm77brKdRA9KbslKAWeeBAuw3Y2IwABVRdFp31z1AYVORUZ8cebhypTJMwr25HaP6zuhvCaZuIAA/vtAAAAjPSWfXf3X//5OXa7NBHF1z39ZDkUHadB/b5WUA/accoSgsvvE45IP83v09GbK44YxQJsK+Q/O5c5E4YAi192+zzvsh6/A8wKpB73LNYfVgjifBkCbXsawjlgdnJO9KIuCtcYAQ1jlbyD0WYZHxKshat5QwPow3oJn3tLFUVxh4TR76jOjaUwc30/cJt+Rv4/9fvG3m0K5kEGrA/scZJo2rk1eUu3Wcpq+8ni7nu72VaL3gncqrH85o4iH+rfhr3arHWFTfrSoyDmKH6FdwDexpzhAxaOC7InGD2Mf3ZKPNBR/inH+6lPzSNMbIYDzf+F5mnWwubmt0WYD4RfkvA9EgM47lMaerBBoxFPTNXHr+lBIO66//MpxuQboAGW5y/n55f1f/NXZ3JT1sS0/zP/PsP3wxsDpd0EyVnotv8JwHzQPHx7nT/jT//+yi4gDTB9g8Ah5XCMV9qzES1Fkp2BY+3gftkJDLTYuiR6w27amLzJiEM7dh+oR65grCa9BDygHbrvejEqvmV+myfwOZpyVH7ivBGNqLvP/k7MUmx70y7/fdlpIAZRl6tY12CYjzuqXJht09bh63kTdYlu8ZqTHCy/P+t3GQ1GFyItGe2iMBJwDJEiMVUnLsEQXMIgG4obGvf7CPwuLHgSmwb+LTxsJAoNB+qehoNNkrGvc3SqlRptENGUJyixGaTrqQ//dbwWUq4TQ4hgGhZjkpwhSwC5kdh7/7ODeeWhoAW37bOvhIhUQPX2X0Ji6AAAAAA==",zC="data:image/webp;base64,UklGRgwJAABXRUJQVlA4WAoAAAAQAAAAfwAAfwAAQUxQSLIDAAABoEVtmyFJisyqrLFt27Zt2/bMnda2bdvW2LbZNgqT5cqINeL76m4vImICxP83Wh3XvLj9/PWUy4c/vX9y7WRjlOr1dEpC/d3oidsbGUmk9Kx9IfXPU+6vkTTa/hRU/2ri+BAzKZS9LU/965EX6rAr233B5u8d9R/K/Z2ZVRjyzkWfo/7rtBkmK3PID2Gl5c1VLk5VHwwpXYuWm4yabnOUvt6ZhFpcUFrndqTT4LDS/GgVMuW+V7rL100q5uOOdio8iMrIsAI85iFS9ZRClCuJbEhAqOOVaNS8rDATc2jcqlB/tkiULIDxdyIxSeHeyaHkXqBzJoWOESDZhsIDCnkzg1InofaYBNqGoTKrElipoKMD8IyvsdQdeGUKwb614DpLsJRKcGsVeKQl3Kdocjpa6Uto6h60JkVwP6D1ceCuoc1V8BEP2AN4qhuW62sC87FKHCFwN1a5KwTewqqaReB7rHpeAkctqGZhAjfKQbV3CBTUgBqqCAaaQc1kEOoEtYpBfAjU7QycqVCPM1BLoV6jcDfUZxSeg9pO4QOooxS+M5EuUthlAZkpFA6VBCqZTeFkaaAKRRQulAGq5qdwpTxQTZtCSkWgOmEKmZWB6kUp5FQFqh+jkFcNqEGcQkH1ZFdUA6h+jEIxUt0oBW9NoDrhZFfDTnaVvcmubD6FohpA7nQKhUjiMoX86kjHKORWRdpKIbMK0vsUUishPU/hWnmk2yhcLIu0lMKZMkjjKBwtidTBYbDXg9TIZrDVjVQ5i8FXArnUKQZvQ7k+ZvAolNjEYC3WCInnTMFq4cWL9sAqfRmvuAmW+BjvcjmwVXhfmmCtJNztAtxKQZMd0MQTaBkG3Bi0by0sq8mCrRJM+X5Z0dANUn7QfXv9iqHM3/vwkDL6uRec8SmeMnR2mUsvo913UrHd2drQyDUrTxFOW2JoY91SrCiH73LpUu+gIp14qqImot1hUir6oKmJaHiSlDpaVhfRYpek9FNDoW+tzxn9VEPoXPkJm83NJyoJva2V6Vy8cyyhuzHwBJNjPQ0BWPLRMIvQy2UFpjn5JIdzQ00BW+5RG8++t7yAbr7dwQpsbSzQPZOPxHHkwdmWIFhq6lEHQx6YXEqwHL09ol9g62hTEDXbPXjR0Ulm3t9S0C078gO/Lr73RpcTnEtOfOOq/V95L7w5sYxg7mk25ZmdNwJx+WcyEvD5/HYoGk8kYun7n57c2BJJ0F2p0fgtr/945EaeLZ1E1Jd98dC3r2yc0LiSRyACVlA4IDQFAABwHACdASqAAIAAPpFCmkklpCKhJpYs2LASCUAaXMob29CPVjmW/qv8xttur5i/2A3nTqot5K/dL9jrMl/U0QDstlYsFdM8zpvAPRA/YBAFO5pFHJNafid1YMjvQiLMxjEgF4GBOC0mQQr6kLFcY1ytmDddQyENl//HmHZTXIGUh2kxiqBSmmsB+5/R6dHwSkFvkpePmmEVpIsTDlsuD6wuusHSAsegw/lmDPo43TV6NYqbB1WQsJMjM2GusVvmYA48MmyINoMBn3WL2x9+FDw0YtL040bJsxwsKfaaoi5pC8MAutn7kBrCCnsqKAD++/1S0+MtbekZ/OM85Fu+QyDFWBF/ZIWO1ojWq+sj6wH2f0mU1cG/WHikqy3VrJmSr9P4JT5iTv5fQJPmWGQzQAYk0HS2BtyZ+kqhlaY1XQf9zw4cRH1br6vvZ86uc2/bvHoINDSg3gGzoEexXwnkei2qmK5Hiv66YmqMh/GBqIsV4pVgn/PR3Wx8ZX9zDTvF+8SnWlEdZp9wEMaPHSzI4QcbypIrH/7RWndB7Uh5PYcISRP+fwt2A0rl1iQSoq4AhNvFatu/5rnBQ5DS74dBhswrsFYVu0XvBiNvW5tbh2adMPMcNCbe0m6T+c/owQeRNzYaYmsathvC+eDGAi6Tj5QWAkLcAuoJmoatBgs+zR2hWMyYEaC5TO9eeFEkLdyGQCC1KwnrHPydeq6dm0uGWaX4G1avJrR5jQBJYI6tOwnBJrPbH7g9QXRM39hOWO6ESdm3WZr28SLcjGLSUab8pj+0lhsNtEiWJMVo/xfAm9muYKWmELzwvlqFFxgKljXOnOLtqDBuIU4SS06Nbe6NDvQ4C+GYt0jWipm6nbx0uZcdngA4u/3GevkBWQpGHcN0r8GYrIWxq+p30Q3ObeWtvpwTUjrEw4SRUfDrB/NTXjOlooSciN3NekShQHTmkZbDKEhlbsmvwHDwhM/fYD/USMCplAftDcOrHh+aUSdyR9rlDt4XCE2W/SIb+5lygQcIiCJLZd91Wks4iLsSmFSMDSs32gzqgWuG5yStilhe9NijnIsS46zqv0DF0oqpl6CwDBGQ9OxAiHBwoZ99pIu0rMPBn0NFIxw0as5Oc3xvUA/xZtZSNEH0/vNMGUMligoUU7DVqDbBgfwjsZX/mYIxQmGhDsgo2vflmR5Mk7hkyTuSqMrp0jZcpbGIbxwYA6EkZO2yb6hV0f81ILo3h4zJzBUEL6KK6slkXY1wEK77SauOtYT2b6ZGt41mJ+6QPY3y1GNNKQQ89XyES72iMg/9TVKARAJ690/5+JRU1uGGgyOd71mi4oIGsXlw41SYa8qP6+4PDTe/m4pwEjgCnKsG3GSi7IQ9dYk3rAnvLJn2jeSN77lBX2333YWba+7czXWcYEZv6CjdmqPfxg8WRe6l1IC5wXNs6NH6b0OJ9rBnRoWmquT/Pkzhi71sHxps2Kf7R1+8kgWWBiHWRPWcyrYetmxY4WJd/C5Ktexuu7Ih/48On+IqARLONPjymxvgATJT8tBBkM+iYUrbkOiPBTotQLD4iR/3PzBIt7jc3AepvAbt4ASyaAIv9Ibwo6xCc2003f+VsRx57y9aAoJg5sZsLMUAkVazPaihX3YtxpChUGxPyXp2HoQx/q2K4ulpJYBOwkZEI1qxzDDUbIjU4PBWZuFUPvzsXTdpbGLjCHZxGA8RNc+49is2M8JIWPeFhYR654/rV59vekP8L2POM+CA8hfTtxnhp3ufOlSFcZF4rb3q7wAAAAA=";var ve=(n=>(n[n.male=0]="male",n[n.female=1]="female",n[n.anonymous=2]="anonymous",n))(ve||{});const ny={" ":" "," ":" "," ":" "," ":" "," ":" ","?":"?",:"",:""," ":" "," ":" ",:"",:"",:""," ":" "," ":" ",:"",:""," ":" "," ":" ",:"",:""," ":" ",:"",:"",:""," ":" ",:""," ":" ",:"",:""," ":" ",:""," ":" "," ":" ",:""," ":" ","  ":"  ","  ":"  ","  ":"  "," ":" ",:"",:"",:""," ":" "," ":" ",:""," ":" ",:"",:""," ":" "," ":" ",:"",:""," ":" ",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},Xi={0:"male",1:"female",2:"anonymous"},R5={0:ty,1:zC,2:ty},br={male:0,female:1,anonymous:2},N5=[0,1,2];var We=(n=>(n[n.SMS=0]="SMS",n[n.SMSOrPush=1]="SMSOrPush",n[n.WhatsAppOrPush=2]="WhatsAppOrPush",n[n.WhatsApp=3]="WhatsApp",n[n.SMSOnly=4]="SMSOnly",n[n.WhatAppOnly=5]="WhatAppOnly",n[n.Push=6]="Push",n[n.PushOrWhatsApp=7]="PushOrWhatsApp",n[n.PushOrSMS=8]="PushOrSMS",n[n.OnlyPush=9]="OnlyPush",n))(We||{});const GC={0:"SMS",4:"SMSOnly",5:"WhatAppOnly",1:"SMSOrPush",2:"WhatsAppOrPush",3:"WhatsApp",9:"OnlyPush",7:"PushOrWhatsApp",8:"PushOrSMS",6:"Push"},Ll={SMS:0,SMSOrPush:1,WhatAppOnly:5,SMSOnly:4,WhatsAppOrPush:2,WhatsApp:3,OnlyPush:9,PushOrWhatsApp:7,PushOrSMS:8,Push:6},JC=/^[a-zA-Z0-9-_.~%]{1,900}$/;var Bf=(n=>(n[n.muslim=0]="muslim",n[n.christian=1]="christian",n[n.jewish=2]="jewish",n))(Bf||{});const QC={0:"muslim",1:"christian",2:"jewish"},KC={muslim:0,christian:1,jewish:2},ry={1:{"01-01-0000":"New Year's Day","16-01-0000":"Martin Luther King Jr. Day","20-02-0000":"Presidents' Day","29-05-0000":"Memorial Day","19-06-0000":"Juneteenth","04-07-0000":"Independence Day","04-09-0000":"Labor Day","09-10-0000":"Columbus Day","11-11-0000":"Veterans Day","23-11-0000":"Thanksgiving Day","25-12-0000":"Christmas Day"},2:{"06-04-2023":"Passover (Day 1)","12-04-2023":"Passover (Day 7)","26-04-2023":"Yom HaAtzmaut","26-05-2023":"Shavuot","16-09-2023":"Rosh Hashana","17-09-2023":"Rosh Hashana (Day 2)","25-09-2023":"Yom Kippur","30-09-2023":"Sukkot","07-10-2023":"Simchat Torah","23-04-2024":"Passover (Day 1)","29-04-2024":"Passover (Day 7)","14-05-2024":"Yom HaAtzmaut","12-06-2024":"Shavuot","03-10-2024":"Rosh Hashana","04-10-2024":"Rosh Hashana (Day 2)","12-10-2024":"Yom Kippur","17-10-2024":"Sukkot","24-10-2024":"Simchat Torah","13-04-2025":"Passover (Day 1)","19-04-2025":"Passover (Day 7)","01-05-2025":"Yom HaAtzmaut","02-06-2025":"Shavuot","23-09-2025":"Rosh Hashana","24-09-2025":"Rosh Hashana (Day 2)","02-10-2025":"Yom Kippur","07-10-2025":"Sukkot","14-10-2025":"Simchat Torah"},0:{}},jC=["","monday","tuesday","wednesday","thursday","friday","saturday","sunday"];var Vs=(n=>(n[n.onHold=0]="onHold",n[n.needCancel=1]="needCancel",n[n.waitingList=2]="waitingList",n[n.withDebts=3]="withDebts",n[n.withOutRecipts=4]="withOutRecipts",n[n.withOnlinePayment=5]="withOnlinePayment",n[n.withoutConfirmArrival=6]="withoutConfirmArrival",n))(Vs||{});const sy={0:"waitingsForApproval",1:"waitingsForCancel",2:"waitingList",4:"withOutRecipts",3:"withDebts",5:"withOnlinePayment",6:"withoutConfirmArrival"};function vt(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function Ze(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}function G0(n,e){const t=vt(n);return isNaN(e)?Ze(n,NaN):(e&&t.setDate(t.getDate()+e),t)}const Hw=6048e5,XC=864e5,ZC=6e4,eb=36e5,tb=1e3;let nb={};function Ao(){return nb}function ls(n,e){var a,c,u,l;const t=Ao(),r=(e==null?void 0:e.weekStartsOn)??((c=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((l=(u=t.locale)==null?void 0:u.options)==null?void 0:l.weekStartsOn)??0,s=vt(n),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function Zi(n){return ls(n,{weekStartsOn:1})}function qw(n){const e=vt(n),t=e.getFullYear(),r=Ze(n,0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);const s=Zi(r),i=Ze(n,0);i.setFullYear(t,0,4),i.setHours(0,0,0,0);const o=Zi(i);return e.getTime()>=s.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function iy(n){const e=vt(n);return e.setHours(0,0,0,0),e}function Ou(n){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return e.setUTCFullYear(n.getFullYear()),n.getTime()-e.getTime()}function rb(n,e){const t=iy(n),r=iy(e),s=t.getTime()-Ou(t),i=r.getTime()-Ou(r);return Math.round((s-i)/XC)}function sb(n){const e=qw(n),t=Ze(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Zi(t)}function ib(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function ob(n){if(!ib(n)&&typeof n!="number")return!1;const e=vt(n);return!isNaN(Number(e))}function ab(n){const e=vt(n),t=Ze(n,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const cb={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},ub=(n,e,t)=>{let r;const s=cb[n];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function od(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const lb={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},hb={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},db={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},fb={date:od({formats:lb,defaultWidth:"full"}),time:od({formats:hb,defaultWidth:"full"}),dateTime:od({formats:db,defaultWidth:"full"})},mb={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},pb=(n,e,t,r)=>mb[n];function Ko(n){return(e,t)=>{const r=t!=null&&t.context?String(t.context):"standalone";let s;if(r==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,a=t!=null&&t.width?String(t.width):o;s=n.formattingValues[a]||n.formattingValues[o]}else{const o=n.defaultWidth,a=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[a]||n.values[o]}const i=n.argumentCallback?n.argumentCallback(e):e;return s[i]}}const gb={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},yb={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_b={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},vb={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},wb={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},xb={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Eb=(n,e)=>{const t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Ib={ordinalNumber:Eb,era:Ko({values:gb,defaultWidth:"wide"}),quarter:Ko({values:yb,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Ko({values:_b,defaultWidth:"wide"}),day:Ko({values:vb,defaultWidth:"wide"}),dayPeriod:Ko({values:wb,defaultWidth:"wide",formattingValues:xb,defaultFormattingWidth:"wide"})};function jo(n){return(e,t={})=>{const r=t.width,s=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],c=Array.isArray(a)?Db(a,d=>d.test(o)):Tb(a,d=>d.test(o));let u;u=n.valueCallback?n.valueCallback(c):c,u=t.valueCallback?t.valueCallback(u):u;const l=e.slice(o.length);return{value:u,rest:l}}}function Tb(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function Db(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function Ab(n){return(e,t={})=>{const r=e.match(n.matchPattern);if(!r)return null;const s=r[0],i=e.match(n.parsePattern);if(!i)return null;let o=n.valueCallback?n.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const Cb=/^(\d+)(th|st|nd|rd)?/i,bb=/\d+/i,kb={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Sb={any:[/^b/i,/^(a|c)/i]},Pb={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Rb={any:[/1/i,/2/i,/3/i,/4/i]},Nb={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Mb={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ob={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Fb={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Bb={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Lb={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Vb={ordinalNumber:Ab({matchPattern:Cb,parsePattern:bb,valueCallback:n=>parseInt(n,10)}),era:jo({matchPatterns:kb,defaultMatchWidth:"wide",parsePatterns:Sb,defaultParseWidth:"any"}),quarter:jo({matchPatterns:Pb,defaultMatchWidth:"wide",parsePatterns:Rb,defaultParseWidth:"any",valueCallback:n=>n+1}),month:jo({matchPatterns:Nb,defaultMatchWidth:"wide",parsePatterns:Mb,defaultParseWidth:"any"}),day:jo({matchPatterns:Ob,defaultMatchWidth:"wide",parsePatterns:Fb,defaultParseWidth:"any"}),dayPeriod:jo({matchPatterns:Bb,defaultMatchWidth:"any",parsePatterns:Lb,defaultParseWidth:"any"})},$w={code:"en-US",formatDistance:ub,formatLong:fb,formatRelative:pb,localize:Ib,match:Vb,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ub(n){const e=vt(n);return rb(e,ab(e))+1}function Yw(n){const e=vt(n),t=Zi(e).getTime()-sb(e).getTime();return Math.round(t/Hw)+1}function J0(n,e){var l,d,f,m;const t=vt(n),r=t.getFullYear(),s=Ao(),i=(e==null?void 0:e.firstWeekContainsDate)??((d=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:d.firstWeekContainsDate)??s.firstWeekContainsDate??((m=(f=s.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,o=Ze(n,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=ls(o,e),c=Ze(n,0);c.setFullYear(r,0,i),c.setHours(0,0,0,0);const u=ls(c,e);return t.getTime()>=a.getTime()?r+1:t.getTime()>=u.getTime()?r:r-1}function Wb(n,e){var a,c,u,l;const t=Ao(),r=(e==null?void 0:e.firstWeekContainsDate)??((c=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((l=(u=t.locale)==null?void 0:u.options)==null?void 0:l.firstWeekContainsDate)??1,s=J0(n,e),i=Ze(n,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),ls(i,e)}function zw(n,e){const t=vt(n),r=ls(t,e).getTime()-Wb(t,e).getTime();return Math.round(r/Hw)+1}function ke(n,e){const t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}const qr={y(n,e){const t=n.getFullYear(),r=t>0?t:1-t;return ke(e==="yy"?r%100:r,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):ke(t+1,2)},d(n,e){return ke(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return ke(n.getHours()%12||12,e.length)},H(n,e){return ke(n.getHours(),e.length)},m(n,e){return ke(n.getMinutes(),e.length)},s(n,e){return ke(n.getSeconds(),e.length)},S(n,e){const t=e.length,r=n.getMilliseconds(),s=Math.floor(r*Math.pow(10,t-3));return ke(s,e.length)}},_i={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Hb={G:function(n,e,t){const r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const r=n.getFullYear(),s=r>0?r:1-r;return t.ordinalNumber(s,{unit:"year"})}return qr.y(n,e)},Y:function(n,e,t,r){const s=J0(n,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return ke(o,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):ke(i,e.length)},R:function(n,e){const t=qw(n);return ke(t,e.length)},u:function(n,e){const t=n.getFullYear();return ke(t,e.length)},Q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return ke(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return ke(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){const r=n.getMonth();switch(e){case"M":case"MM":return qr.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){const r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return ke(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){const s=zw(n,r);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):ke(s,e.length)},I:function(n,e,t){const r=Yw(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):ke(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):qr.d(n,e)},D:function(n,e,t){const r=Ub(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):ke(r,e.length)},E:function(n,e,t){const r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){const s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return ke(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){const s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return ke(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){const r=n.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return ke(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){const s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){const r=n.getHours();let s;switch(r===12?s=_i.noon:r===0?s=_i.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){const r=n.getHours();let s;switch(r>=17?s=_i.evening:r>=12?s=_i.afternoon:r>=4?s=_i.morning:s=_i.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return qr.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):qr.H(n,e)},K:function(n,e,t){const r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):ke(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):ke(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):qr.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):qr.s(n,e)},S:function(n,e){return qr.S(n,e)},X:function(n,e,t,r){const i=(r._originalDate||n).getTimezoneOffset();if(i===0)return"Z";switch(e){case"X":return ay(i);case"XXXX":case"XX":return Cs(i);case"XXXXX":case"XXX":default:return Cs(i,":")}},x:function(n,e,t,r){const i=(r._originalDate||n).getTimezoneOffset();switch(e){case"x":return ay(i);case"xxxx":case"xx":return Cs(i);case"xxxxx":case"xxx":default:return Cs(i,":")}},O:function(n,e,t,r){const i=(r._originalDate||n).getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+oy(i,":");case"OOOO":default:return"GMT"+Cs(i,":")}},z:function(n,e,t,r){const i=(r._originalDate||n).getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+oy(i,":");case"zzzz":default:return"GMT"+Cs(i,":")}},t:function(n,e,t,r){const s=r._originalDate||n,i=Math.floor(s.getTime()/1e3);return ke(i,e.length)},T:function(n,e,t,r){const i=(r._originalDate||n).getTime();return ke(i,e.length)}};function oy(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),s=Math.floor(r/60),i=r%60;return i===0?t+String(s):t+String(s)+e+ke(i,2)}function ay(n,e){return n%60===0?(n>0?"-":"+")+ke(Math.abs(n)/60,2):Cs(n,e)}function Cs(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),s=ke(Math.floor(r/60),2),i=ke(r%60,2);return t+s+e+i}const cy=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Gw=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},qb=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],r=t[1],s=t[2];if(!s)return cy(n,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",cy(r,e)).replace("{{time}}",Gw(s,e))},Lf={p:Gw,P:qb},$b=/^D+$/,Yb=/^Y+$/,zb=["D","DD","YY","YYYY"];function Jw(n){return $b.test(n)}function Qw(n){return Yb.test(n)}function Fu(n,e,t){const r=Gb(n,e,t);if(console.warn(r),zb.includes(n))throw new RangeError(r)}function Gb(n,e,t){const r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Jb=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Qb=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Kb=/^'([^]*?)'?$/,jb=/''/g,Xb=/[a-zA-Z]/;function bt(n,e,t){var l,d,f,m,p,y,g,x;const r=Ao(),s=(t==null?void 0:t.locale)??r.locale??$w,i=(t==null?void 0:t.firstWeekContainsDate)??((d=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((m=(f=r.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,o=(t==null?void 0:t.weekStartsOn)??((y=(p=t==null?void 0:t.locale)==null?void 0:p.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((x=(g=r.locale)==null?void 0:g.options)==null?void 0:x.weekStartsOn)??0,a=vt(n);if(!ob(a))throw new RangeError("Invalid time value");const c={firstWeekContainsDate:i,weekStartsOn:o,locale:s,_originalDate:a};return e.match(Qb).map(function(_){const v=_[0];if(v==="p"||v==="P"){const w=Lf[v];return w(_,s.formatLong)}return _}).join("").match(Jb).map(function(_){if(_==="''")return"'";const v=_[0];if(v==="'")return Zb(_);const w=Hb[v];if(w)return!(t!=null&&t.useAdditionalWeekYearTokens)&&Qw(_)&&Fu(_,e,String(n)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&Jw(_)&&Fu(_,e,String(n)),w(a,_,s.localize,c);if(v.match(Xb))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return _}).join("")}function Zb(n){const e=n.match(Kb);return e?e[1].replace(jb,"'"):n}function ek(){return Object.assign({},Ao())}function tk(n){let t=vt(n).getDay();return t===0&&(t=7),t}function nk(n,e){const t=e instanceof Date?Ze(e,0):new e(0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),t}const rk=10;class Kw{constructor(){h(this,"subPriority",0)}validate(e,t){return!0}}class sk extends Kw{constructor(e,t,r,s,i){super(),this.value=e,this.validateValue=t,this.setValue=r,this.priority=s,i&&(this.subPriority=i)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,r){return this.setValue(e,t,this.value,r)}}class ik extends Kw{constructor(){super(...arguments);h(this,"priority",rk);h(this,"subPriority",-1)}set(t,r){return r.timestampIsSet?t:Ze(t,nk(t,Date))}}class De{run(e,t,r,s){const i=this.parse(e,t,r,s);return i?{setter:new sk(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}validate(e,t,r){return!0}}class ok extends De{constructor(){super(...arguments);h(this,"priority",140);h(this,"incompatibleTokens",["R","u","t","T"])}parse(t,r,s){switch(r){case"G":case"GG":case"GGG":return s.era(t,{width:"abbreviated"})||s.era(t,{width:"narrow"});case"GGGGG":return s.era(t,{width:"narrow"});case"GGGG":default:return s.era(t,{width:"wide"})||s.era(t,{width:"abbreviated"})||s.era(t,{width:"narrow"})}}set(t,r,s){return r.era=s,t.setFullYear(s,0,1),t.setHours(0,0,0,0),t}}const it={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ln={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function ot(n,e){return n&&{value:e(n.value),rest:n.rest}}function Xe(n,e){const t=e.match(n);return t?{value:parseInt(t[0],10),rest:e.slice(t[0].length)}:null}function Vn(n,e){const t=e.match(n);if(!t)return null;if(t[0]==="Z")return{value:0,rest:e.slice(1)};const r=t[1]==="+"?1:-1,s=t[2]?parseInt(t[2],10):0,i=t[3]?parseInt(t[3],10):0,o=t[5]?parseInt(t[5],10):0;return{value:r*(s*eb+i*ZC+o*tb),rest:e.slice(t[0].length)}}function jw(n){return Xe(it.anyDigitsSigned,n)}function nt(n,e){switch(n){case 1:return Xe(it.singleDigit,e);case 2:return Xe(it.twoDigits,e);case 3:return Xe(it.threeDigits,e);case 4:return Xe(it.fourDigits,e);default:return Xe(new RegExp("^\\d{1,"+n+"}"),e)}}function Bu(n,e){switch(n){case 1:return Xe(it.singleDigitSigned,e);case 2:return Xe(it.twoDigitsSigned,e);case 3:return Xe(it.threeDigitsSigned,e);case 4:return Xe(it.fourDigitsSigned,e);default:return Xe(new RegExp("^-?\\d{1,"+n+"}"),e)}}function Q0(n){switch(n){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Xw(n,e){const t=e>0,r=t?e:1-e;let s;if(r<=50)s=n||100;else{const i=r+50,o=Math.floor(i/100)*100,a=n>=i%100;s=n+o-(a?100:0)}return t?s:1-s}function Zw(n){return n%400===0||n%4===0&&n%100!==0}class ak extends De{constructor(){super(...arguments);h(this,"priority",130);h(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(t,r,s){const i=o=>({year:o,isTwoDigitYear:r==="yy"});switch(r){case"y":return ot(nt(4,t),i);case"yo":return ot(s.ordinalNumber(t,{unit:"year"}),i);default:return ot(nt(r.length,t),i)}}validate(t,r){return r.isTwoDigitYear||r.year>0}set(t,r,s){const i=t.getFullYear();if(s.isTwoDigitYear){const a=Xw(s.year,i);return t.setFullYear(a,0,1),t.setHours(0,0,0,0),t}const o=!("era"in r)||r.era===1?s.year:1-s.year;return t.setFullYear(o,0,1),t.setHours(0,0,0,0),t}}class ck extends De{constructor(){super(...arguments);h(this,"priority",130);h(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(t,r,s){const i=o=>({year:o,isTwoDigitYear:r==="YY"});switch(r){case"Y":return ot(nt(4,t),i);case"Yo":return ot(s.ordinalNumber(t,{unit:"year"}),i);default:return ot(nt(r.length,t),i)}}validate(t,r){return r.isTwoDigitYear||r.year>0}set(t,r,s,i){const o=J0(t,i);if(s.isTwoDigitYear){const c=Xw(s.year,o);return t.setFullYear(c,0,i.firstWeekContainsDate),t.setHours(0,0,0,0),ls(t,i)}const a=!("era"in r)||r.era===1?s.year:1-s.year;return t.setFullYear(a,0,i.firstWeekContainsDate),t.setHours(0,0,0,0),ls(t,i)}}class uk extends De{constructor(){super(...arguments);h(this,"priority",130);h(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(t,r){return Bu(r==="R"?4:r.length,t)}set(t,r,s){const i=Ze(t,0);return i.setFullYear(s,0,4),i.setHours(0,0,0,0),Zi(i)}}class lk extends De{constructor(){super(...arguments);h(this,"priority",130);h(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(t,r){return Bu(r==="u"?4:r.length,t)}set(t,r,s){return t.setFullYear(s,0,1),t.setHours(0,0,0,0),t}}class hk extends De{constructor(){super(...arguments);h(this,"priority",120);h(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(t,r,s){switch(r){case"Q":case"QQ":return nt(r.length,t);case"Qo":return s.ordinalNumber(t,{unit:"quarter"});case"QQQ":return s.quarter(t,{width:"abbreviated",context:"formatting"})||s.quarter(t,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(t,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(t,{width:"wide",context:"formatting"})||s.quarter(t,{width:"abbreviated",context:"formatting"})||s.quarter(t,{width:"narrow",context:"formatting"})}}validate(t,r){return r>=1&&r<=4}set(t,r,s){return t.setMonth((s-1)*3,1),t.setHours(0,0,0,0),t}}class dk extends De{constructor(){super(...arguments);h(this,"priority",120);h(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(t,r,s){switch(r){case"q":case"qq":return nt(r.length,t);case"qo":return s.ordinalNumber(t,{unit:"quarter"});case"qqq":return s.quarter(t,{width:"abbreviated",context:"standalone"})||s.quarter(t,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(t,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(t,{width:"wide",context:"standalone"})||s.quarter(t,{width:"abbreviated",context:"standalone"})||s.quarter(t,{width:"narrow",context:"standalone"})}}validate(t,r){return r>=1&&r<=4}set(t,r,s){return t.setMonth((s-1)*3,1),t.setHours(0,0,0,0),t}}class fk extends De{constructor(){super(...arguments);h(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);h(this,"priority",110)}parse(t,r,s){const i=o=>o-1;switch(r){case"M":return ot(Xe(it.month,t),i);case"MM":return ot(nt(2,t),i);case"Mo":return ot(s.ordinalNumber(t,{unit:"month"}),i);case"MMM":return s.month(t,{width:"abbreviated",context:"formatting"})||s.month(t,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(t,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(t,{width:"wide",context:"formatting"})||s.month(t,{width:"abbreviated",context:"formatting"})||s.month(t,{width:"narrow",context:"formatting"})}}validate(t,r){return r>=0&&r<=11}set(t,r,s){return t.setMonth(s,1),t.setHours(0,0,0,0),t}}class mk extends De{constructor(){super(...arguments);h(this,"priority",110);h(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(t,r,s){const i=o=>o-1;switch(r){case"L":return ot(Xe(it.month,t),i);case"LL":return ot(nt(2,t),i);case"Lo":return ot(s.ordinalNumber(t,{unit:"month"}),i);case"LLL":return s.month(t,{width:"abbreviated",context:"standalone"})||s.month(t,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(t,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(t,{width:"wide",context:"standalone"})||s.month(t,{width:"abbreviated",context:"standalone"})||s.month(t,{width:"narrow",context:"standalone"})}}validate(t,r){return r>=0&&r<=11}set(t,r,s){return t.setMonth(s,1),t.setHours(0,0,0,0),t}}function pk(n,e,t){const r=vt(n),s=zw(r,t)-e;return r.setDate(r.getDate()-s*7),r}class gk extends De{constructor(){super(...arguments);h(this,"priority",100);h(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(t,r,s){switch(r){case"w":return Xe(it.week,t);case"wo":return s.ordinalNumber(t,{unit:"week"});default:return nt(r.length,t)}}validate(t,r){return r>=1&&r<=53}set(t,r,s,i){return ls(pk(t,s,i),i)}}function yk(n,e){const t=vt(n),r=Yw(t)-e;return t.setDate(t.getDate()-r*7),t}class _k extends De{constructor(){super(...arguments);h(this,"priority",100);h(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(t,r,s){switch(r){case"I":return Xe(it.week,t);case"Io":return s.ordinalNumber(t,{unit:"week"});default:return nt(r.length,t)}}validate(t,r){return r>=1&&r<=53}set(t,r,s){return Zi(yk(t,s))}}const vk=[31,28,31,30,31,30,31,31,30,31,30,31],wk=[31,29,31,30,31,30,31,31,30,31,30,31];class xk extends De{constructor(){super(...arguments);h(this,"priority",90);h(this,"subPriority",1);h(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(t,r,s){switch(r){case"d":return Xe(it.date,t);case"do":return s.ordinalNumber(t,{unit:"date"});default:return nt(r.length,t)}}validate(t,r){const s=t.getFullYear(),i=Zw(s),o=t.getMonth();return i?r>=1&&r<=wk[o]:r>=1&&r<=vk[o]}set(t,r,s){return t.setDate(s),t.setHours(0,0,0,0),t}}class Ek extends De{constructor(){super(...arguments);h(this,"priority",90);h(this,"subpriority",1);h(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(t,r,s){switch(r){case"D":case"DD":return Xe(it.dayOfYear,t);case"Do":return s.ordinalNumber(t,{unit:"date"});default:return nt(r.length,t)}}validate(t,r){const s=t.getFullYear();return Zw(s)?r>=1&&r<=366:r>=1&&r<=365}set(t,r,s){return t.setMonth(0,s),t.setHours(0,0,0,0),t}}function K0(n,e,t){var d,f,m,p;const r=Ao(),s=(t==null?void 0:t.weekStartsOn)??((f=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:f.weekStartsOn)??r.weekStartsOn??((p=(m=r.locale)==null?void 0:m.options)==null?void 0:p.weekStartsOn)??0,i=vt(n),o=i.getDay(),c=(e%7+7)%7,u=7-s,l=e<0||e>6?e-(o+u)%7:(c+u)%7-(o+u)%7;return G0(i,l)}class Ik extends De{constructor(){super(...arguments);h(this,"priority",90);h(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(t,r,s){switch(r){case"E":case"EE":case"EEE":return s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(t,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"EEEE":default:return s.day(t,{width:"wide",context:"formatting"})||s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"})}}validate(t,r){return r>=0&&r<=6}set(t,r,s,i){return t=K0(t,s,i),t.setHours(0,0,0,0),t}}class Tk extends De{constructor(){super(...arguments);h(this,"priority",90);h(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(t,r,s,i){const o=a=>{const c=Math.floor((a-1)/7)*7;return(a+i.weekStartsOn+6)%7+c};switch(r){case"e":case"ee":return ot(nt(r.length,t),o);case"eo":return ot(s.ordinalNumber(t,{unit:"day"}),o);case"eee":return s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"eeeee":return s.day(t,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"eeee":default:return s.day(t,{width:"wide",context:"formatting"})||s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"})}}validate(t,r){return r>=0&&r<=6}set(t,r,s,i){return t=K0(t,s,i),t.setHours(0,0,0,0),t}}class Dk extends De{constructor(){super(...arguments);h(this,"priority",90);h(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(t,r,s,i){const o=a=>{const c=Math.floor((a-1)/7)*7;return(a+i.weekStartsOn+6)%7+c};switch(r){case"c":case"cc":return ot(nt(r.length,t),o);case"co":return ot(s.ordinalNumber(t,{unit:"day"}),o);case"ccc":return s.day(t,{width:"abbreviated",context:"standalone"})||s.day(t,{width:"short",context:"standalone"})||s.day(t,{width:"narrow",context:"standalone"});case"ccccc":return s.day(t,{width:"narrow",context:"standalone"});case"cccccc":return s.day(t,{width:"short",context:"standalone"})||s.day(t,{width:"narrow",context:"standalone"});case"cccc":default:return s.day(t,{width:"wide",context:"standalone"})||s.day(t,{width:"abbreviated",context:"standalone"})||s.day(t,{width:"short",context:"standalone"})||s.day(t,{width:"narrow",context:"standalone"})}}validate(t,r){return r>=0&&r<=6}set(t,r,s,i){return t=K0(t,s,i),t.setHours(0,0,0,0),t}}function Ak(n,e){const t=vt(n),r=tk(t),s=e-r;return G0(t,s)}class Ck extends De{constructor(){super(...arguments);h(this,"priority",90);h(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(t,r,s){const i=o=>o===0?7:o;switch(r){case"i":case"ii":return nt(r.length,t);case"io":return s.ordinalNumber(t,{unit:"day"});case"iii":return ot(s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"}),i);case"iiiii":return ot(s.day(t,{width:"narrow",context:"formatting"}),i);case"iiiiii":return ot(s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"}),i);case"iiii":default:return ot(s.day(t,{width:"wide",context:"formatting"})||s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"}),i)}}validate(t,r){return r>=1&&r<=7}set(t,r,s){return t=Ak(t,s),t.setHours(0,0,0,0),t}}class bk extends De{constructor(){super(...arguments);h(this,"priority",80);h(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(t,r,s){switch(r){case"a":case"aa":case"aaa":return s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(t,{width:"wide",context:"formatting"})||s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,r,s){return t.setHours(Q0(s),0,0,0),t}}class kk extends De{constructor(){super(...arguments);h(this,"priority",80);h(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(t,r,s){switch(r){case"b":case"bb":case"bbb":return s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(t,{width:"wide",context:"formatting"})||s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,r,s){return t.setHours(Q0(s),0,0,0),t}}class Sk extends De{constructor(){super(...arguments);h(this,"priority",80);h(this,"incompatibleTokens",["a","b","t","T"])}parse(t,r,s){switch(r){case"B":case"BB":case"BBB":return s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(t,{width:"wide",context:"formatting"})||s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,r,s){return t.setHours(Q0(s),0,0,0),t}}class Pk extends De{constructor(){super(...arguments);h(this,"priority",70);h(this,"incompatibleTokens",["H","K","k","t","T"])}parse(t,r,s){switch(r){case"h":return Xe(it.hour12h,t);case"ho":return s.ordinalNumber(t,{unit:"hour"});default:return nt(r.length,t)}}validate(t,r){return r>=1&&r<=12}set(t,r,s){const i=t.getHours()>=12;return i&&s<12?t.setHours(s+12,0,0,0):!i&&s===12?t.setHours(0,0,0,0):t.setHours(s,0,0,0),t}}class Rk extends De{constructor(){super(...arguments);h(this,"priority",70);h(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(t,r,s){switch(r){case"H":return Xe(it.hour23h,t);case"Ho":return s.ordinalNumber(t,{unit:"hour"});default:return nt(r.length,t)}}validate(t,r){return r>=0&&r<=23}set(t,r,s){return t.setHours(s,0,0,0),t}}class Nk extends De{constructor(){super(...arguments);h(this,"priority",70);h(this,"incompatibleTokens",["h","H","k","t","T"])}parse(t,r,s){switch(r){case"K":return Xe(it.hour11h,t);case"Ko":return s.ordinalNumber(t,{unit:"hour"});default:return nt(r.length,t)}}validate(t,r){return r>=0&&r<=11}set(t,r,s){return t.getHours()>=12&&s<12?t.setHours(s+12,0,0,0):t.setHours(s,0,0,0),t}}class Mk extends De{constructor(){super(...arguments);h(this,"priority",70);h(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(t,r,s){switch(r){case"k":return Xe(it.hour24h,t);case"ko":return s.ordinalNumber(t,{unit:"hour"});default:return nt(r.length,t)}}validate(t,r){return r>=1&&r<=24}set(t,r,s){const i=s<=24?s%24:s;return t.setHours(i,0,0,0),t}}class Ok extends De{constructor(){super(...arguments);h(this,"priority",60);h(this,"incompatibleTokens",["t","T"])}parse(t,r,s){switch(r){case"m":return Xe(it.minute,t);case"mo":return s.ordinalNumber(t,{unit:"minute"});default:return nt(r.length,t)}}validate(t,r){return r>=0&&r<=59}set(t,r,s){return t.setMinutes(s,0,0),t}}class Fk extends De{constructor(){super(...arguments);h(this,"priority",50);h(this,"incompatibleTokens",["t","T"])}parse(t,r,s){switch(r){case"s":return Xe(it.second,t);case"so":return s.ordinalNumber(t,{unit:"second"});default:return nt(r.length,t)}}validate(t,r){return r>=0&&r<=59}set(t,r,s){return t.setSeconds(s,0),t}}class Bk extends De{constructor(){super(...arguments);h(this,"priority",30);h(this,"incompatibleTokens",["t","T"])}parse(t,r){const s=i=>Math.floor(i*Math.pow(10,-r.length+3));return ot(nt(r.length,t),s)}set(t,r,s){return t.setMilliseconds(s),t}}class Lk extends De{constructor(){super(...arguments);h(this,"priority",10);h(this,"incompatibleTokens",["t","T","x"])}parse(t,r){switch(r){case"X":return Vn(Ln.basicOptionalMinutes,t);case"XX":return Vn(Ln.basic,t);case"XXXX":return Vn(Ln.basicOptionalSeconds,t);case"XXXXX":return Vn(Ln.extendedOptionalSeconds,t);case"XXX":default:return Vn(Ln.extended,t)}}set(t,r,s){return r.timestampIsSet?t:Ze(t,t.getTime()-Ou(t)-s)}}class Vk extends De{constructor(){super(...arguments);h(this,"priority",10);h(this,"incompatibleTokens",["t","T","X"])}parse(t,r){switch(r){case"x":return Vn(Ln.basicOptionalMinutes,t);case"xx":return Vn(Ln.basic,t);case"xxxx":return Vn(Ln.basicOptionalSeconds,t);case"xxxxx":return Vn(Ln.extendedOptionalSeconds,t);case"xxx":default:return Vn(Ln.extended,t)}}set(t,r,s){return r.timestampIsSet?t:Ze(t,t.getTime()-Ou(t)-s)}}class Uk extends De{constructor(){super(...arguments);h(this,"priority",40);h(this,"incompatibleTokens","*")}parse(t){return jw(t)}set(t,r,s){return[Ze(t,s*1e3),{timestampIsSet:!0}]}}class Wk extends De{constructor(){super(...arguments);h(this,"priority",20);h(this,"incompatibleTokens","*")}parse(t){return jw(t)}set(t,r,s){return[Ze(t,s),{timestampIsSet:!0}]}}const Hk={G:new ok,y:new ak,Y:new ck,R:new uk,u:new lk,Q:new hk,q:new dk,M:new fk,L:new mk,w:new gk,I:new _k,d:new xk,D:new Ek,E:new Ik,e:new Tk,c:new Dk,i:new Ck,a:new bk,b:new kk,B:new Sk,h:new Pk,H:new Rk,K:new Nk,k:new Mk,m:new Ok,s:new Fk,S:new Bk,X:new Lk,x:new Vk,t:new Uk,T:new Wk},qk=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,$k=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Yk=/^'([^]*?)'?$/,zk=/''/g,Gk=/\S/,Jk=/[a-zA-Z]/;function Qk(n,e,t,r){var y,g,x,_,v,w,D,T;const s=ek(),i=(r==null?void 0:r.locale)??s.locale??$w,o=(r==null?void 0:r.firstWeekContainsDate)??((g=(y=r==null?void 0:r.locale)==null?void 0:y.options)==null?void 0:g.firstWeekContainsDate)??s.firstWeekContainsDate??((_=(x=s.locale)==null?void 0:x.options)==null?void 0:_.firstWeekContainsDate)??1,a=(r==null?void 0:r.weekStartsOn)??((w=(v=r==null?void 0:r.locale)==null?void 0:v.options)==null?void 0:w.weekStartsOn)??s.weekStartsOn??((T=(D=s.locale)==null?void 0:D.options)==null?void 0:T.weekStartsOn)??0;if(e==="")return n===""?vt(t):Ze(t,NaN);const c={firstWeekContainsDate:o,weekStartsOn:a,locale:i},u=[new ik],l=e.match($k).map(E=>{const A=E[0];if(A in Lf){const k=Lf[A];return k(E,i.formatLong)}return E}).join("").match(qk),d=[];for(let E of l){!(r!=null&&r.useAdditionalWeekYearTokens)&&Qw(E)&&Fu(E,e,n),!(r!=null&&r.useAdditionalDayOfYearTokens)&&Jw(E)&&Fu(E,e,n);const A=E[0],k=Hk[A];if(k){const{incompatibleTokens:I}=k;if(Array.isArray(I)){const S=d.find(P=>I.includes(P.token)||P.token===A);if(S)throw new RangeError(`The format string mustn't contain \`${S.fullToken}\` and \`${E}\` at the same time`)}else if(k.incompatibleTokens==="*"&&d.length>0)throw new RangeError(`The format string mustn't contain \`${E}\` and any other token at the same time`);d.push({token:A,fullToken:E});const C=k.run(n,E,i.match,c);if(!C)return Ze(t,NaN);u.push(C.setter),n=C.rest}else{if(A.match(Jk))throw new RangeError("Format string contains an unescaped latin alphabet character `"+A+"`");if(E==="''"?E="'":A==="'"&&(E=Kk(E)),n.indexOf(E)===0)n=n.slice(E.length);else return Ze(t,NaN)}}if(n.length>0&&Gk.test(n))return Ze(t,NaN);const f=u.map(E=>E.priority).sort((E,A)=>A-E).filter((E,A,k)=>k.indexOf(E)===A).map(E=>u.filter(A=>A.priority===E).sort((A,k)=>k.subPriority-A.subPriority)).map(E=>E[0]);let m=vt(t);if(isNaN(m.getTime()))return Ze(t,NaN);const p={};for(const E of f){if(!E.validate(m,c))return Ze(t,NaN);const A=E.set(m,p,c);Array.isArray(A)?(m=A[0],Object.assign(p,A[1])):m=A}return Ze(t,m)}function Kk(n){return n.match(Yk)[1].replace(zk,"'")}function ex(n,e,t,r){const s=t<n&&!(r>n),i=!(t<e)&&r>e;return s?"BEFORE":i?"AFTER":"STRIKE"}function qe(n,e){return new Date(n.getTime()+e.inMilliseconds)}function Qr(n,e){return new Date(n.getTime()-e.inMilliseconds)}function ad(n,e){return new ee({milliseconds:new Date(n.getTime()-e.getTime()).getTime()})}//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var tx;function U(){return tx.apply(null,arguments)}function jk(n){tx=n}function Pn(n){return n instanceof Array||Object.prototype.toString.call(n)==="[object Array]"}function Us(n){return n!=null&&Object.prototype.toString.call(n)==="[object Object]"}function xe(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function j0(n){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(n).length===0;var e;for(e in n)if(xe(n,e))return!1;return!0}function Xt(n){return n===void 0}function kr(n){return typeof n=="number"||Object.prototype.toString.call(n)==="[object Number]"}function _c(n){return n instanceof Date||Object.prototype.toString.call(n)==="[object Date]"}function nx(n,e){var t=[],r,s=n.length;for(r=0;r<s;++r)t.push(e(n[r],r));return t}function Kr(n,e){for(var t in e)xe(e,t)&&(n[t]=e[t]);return xe(e,"toString")&&(n.toString=e.toString),xe(e,"valueOf")&&(n.valueOf=e.valueOf),n}function rr(n,e,t,r){return Dx(n,e,t,r,!0).utc()}function Xk(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function ie(n){return n._pf==null&&(n._pf=Xk()),n._pf}var Vf;Array.prototype.some?Vf=Array.prototype.some:Vf=function(n){var e=Object(this),t=e.length>>>0,r;for(r=0;r<t;r++)if(r in e&&n.call(this,e[r],r,e))return!0;return!1};function X0(n){var e=null,t=!1,r=n._d&&!isNaN(n._d.getTime());if(r&&(e=ie(n),t=Vf.call(e.parsedDateParts,function(s){return s!=null}),r=e.overflow<0&&!e.empty&&!e.invalidEra&&!e.invalidMonth&&!e.invalidWeekday&&!e.weekdayMismatch&&!e.nullInput&&!e.invalidFormat&&!e.userInvalidated&&(!e.meridiem||e.meridiem&&t),n._strict&&(r=r&&e.charsLeftOver===0&&e.unusedTokens.length===0&&e.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(n))n._isValid=r;else return r;return n._isValid}function Vl(n){var e=rr(NaN);return n!=null?Kr(ie(e),n):ie(e).userInvalidated=!0,e}var uy=U.momentProperties=[],cd=!1;function Z0(n,e){var t,r,s,i=uy.length;if(Xt(e._isAMomentObject)||(n._isAMomentObject=e._isAMomentObject),Xt(e._i)||(n._i=e._i),Xt(e._f)||(n._f=e._f),Xt(e._l)||(n._l=e._l),Xt(e._strict)||(n._strict=e._strict),Xt(e._tzm)||(n._tzm=e._tzm),Xt(e._isUTC)||(n._isUTC=e._isUTC),Xt(e._offset)||(n._offset=e._offset),Xt(e._pf)||(n._pf=ie(e)),Xt(e._locale)||(n._locale=e._locale),i>0)for(t=0;t<i;t++)r=uy[t],s=e[r],Xt(s)||(n[r]=s);return n}function vc(n){Z0(this,n),this._d=new Date(n._d!=null?n._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),cd===!1&&(cd=!0,U.updateOffset(this),cd=!1)}function Rn(n){return n instanceof vc||n!=null&&n._isAMomentObject!=null}function rx(n){U.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+n)}function En(n,e){var t=!0;return Kr(function(){if(U.deprecationHandler!=null&&U.deprecationHandler(null,n),t){var r=[],s,i,o,a=arguments.length;for(i=0;i<a;i++){if(s="",typeof arguments[i]=="object"){s+=`
[`+i+"] ";for(o in arguments[0])xe(arguments[0],o)&&(s+=o+": "+arguments[0][o]+", ");s=s.slice(0,-2)}else s=arguments[i];r.push(s)}rx(n+`
Arguments: `+Array.prototype.slice.call(r).join("")+`
`+new Error().stack),t=!1}return e.apply(this,arguments)},e)}var ly={};function sx(n,e){U.deprecationHandler!=null&&U.deprecationHandler(n,e),ly[n]||(rx(e),ly[n]=!0)}U.suppressDeprecationWarnings=!1;U.deprecationHandler=null;function sr(n){return typeof Function<"u"&&n instanceof Function||Object.prototype.toString.call(n)==="[object Function]"}function Zk(n){var e,t;for(t in n)xe(n,t)&&(e=n[t],sr(e)?this[t]=e:this["_"+t]=e);this._config=n,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Uf(n,e){var t=Kr({},n),r;for(r in e)xe(e,r)&&(Us(n[r])&&Us(e[r])?(t[r]={},Kr(t[r],n[r]),Kr(t[r],e[r])):e[r]!=null?t[r]=e[r]:delete t[r]);for(r in n)xe(n,r)&&!xe(e,r)&&Us(n[r])&&(t[r]=Kr({},t[r]));return t}function em(n){n!=null&&this.set(n)}var Wf;Object.keys?Wf=Object.keys:Wf=function(n){var e,t=[];for(e in n)xe(n,e)&&t.push(e);return t};var eS={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function tS(n,e,t){var r=this._calendar[n]||this._calendar.sameElse;return sr(r)?r.call(e,t):r}function Xn(n,e,t){var r=""+Math.abs(n),s=e-r.length,i=n>=0;return(i?t?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+r}var tm=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,tu=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ud={},Ni={};function G(n,e,t,r){var s=r;typeof r=="string"&&(s=function(){return this[r]()}),n&&(Ni[n]=s),e&&(Ni[e[0]]=function(){return Xn(s.apply(this,arguments),e[1],e[2])}),t&&(Ni[t]=function(){return this.localeData().ordinal(s.apply(this,arguments),n)})}function nS(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function rS(n){var e=n.match(tm),t,r;for(t=0,r=e.length;t<r;t++)Ni[e[t]]?e[t]=Ni[e[t]]:e[t]=nS(e[t]);return function(s){var i="",o;for(o=0;o<r;o++)i+=sr(e[o])?e[o].call(s,n):e[o];return i}}function _u(n,e){return n.isValid()?(e=ix(e,n.localeData()),ud[e]=ud[e]||rS(e),ud[e](n)):n.localeData().invalidDate()}function ix(n,e){var t=5;function r(s){return e.longDateFormat(s)||s}for(tu.lastIndex=0;t>=0&&tu.test(n);)n=n.replace(tu,r),tu.lastIndex=0,t-=1;return n}var sS={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function iS(n){var e=this._longDateFormat[n],t=this._longDateFormat[n.toUpperCase()];return e||!t?e:(this._longDateFormat[n]=t.match(tm).map(function(r){return r==="MMMM"||r==="MM"||r==="DD"||r==="dddd"?r.slice(1):r}).join(""),this._longDateFormat[n])}var oS="Invalid date";function aS(){return this._invalidDate}var cS="%d",uS=/\d{1,2}/;function lS(n){return this._ordinal.replace("%d",n)}var hS={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function dS(n,e,t,r){var s=this._relativeTime[t];return sr(s)?s(n,e,t,r):s.replace(/%d/i,n)}function fS(n,e){var t=this._relativeTime[n>0?"future":"past"];return sr(t)?t(e):t.replace(/%s/i,e)}var hy={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function In(n){return typeof n=="string"?hy[n]||hy[n.toLowerCase()]:void 0}function nm(n){var e={},t,r;for(r in n)xe(n,r)&&(t=In(r),t&&(e[t]=n[r]));return e}var mS={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function pS(n){var e=[],t;for(t in n)xe(n,t)&&e.push({unit:t,priority:mS[t]});return e.sort(function(r,s){return r.priority-s.priority}),e}var ox=/\d/,dn=/\d\d/,ax=/\d{3}/,rm=/\d{4}/,Ul=/[+-]?\d{6}/,ze=/\d\d?/,cx=/\d\d\d\d?/,ux=/\d\d\d\d\d\d?/,Wl=/\d{1,3}/,sm=/\d{1,4}/,Hl=/[+-]?\d{1,6}/,Co=/\d+/,ql=/[+-]?\d+/,gS=/Z|[+-]\d\d:?\d\d/gi,$l=/Z|[+-]\d\d(?::?\d\d)?/gi,yS=/[+-]?\d+(\.\d{1,3})?/,wc=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,bo=/^[1-9]\d?/,im=/^([1-9]\d|\d)/,Lu;Lu={};function W(n,e,t){Lu[n]=sr(e)?e:function(r,s){return r&&t?t:e}}function _S(n,e){return xe(Lu,n)?Lu[n](e._strict,e._locale):new RegExp(vS(n))}function vS(n){return Dr(n.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,r,s,i){return t||r||s||i}))}function Dr(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function gn(n){return n<0?Math.ceil(n)||0:Math.floor(n)}function me(n){var e=+n,t=0;return e!==0&&isFinite(e)&&(t=gn(e)),t}var Hf={};function Me(n,e){var t,r=e,s;for(typeof n=="string"&&(n=[n]),kr(e)&&(r=function(i,o){o[e]=me(i)}),s=n.length,t=0;t<s;t++)Hf[n[t]]=r}function xc(n,e){Me(n,function(t,r,s,i){s._w=s._w||{},e(t,s._w,s,i)})}function wS(n,e,t){e!=null&&xe(Hf,n)&&Hf[n](e,t._a,t,n)}function Yl(n){return n%4===0&&n%100!==0||n%400===0}var Ut=0,pr=1,Un=2,mt=3,bn=4,gr=5,Ms=6,xS=7,ES=8;G("Y",0,0,function(){var n=this.year();return n<=9999?Xn(n,4):"+"+n});G(0,["YY",2],0,function(){return this.year()%100});G(0,["YYYY",4],0,"year");G(0,["YYYYY",5],0,"year");G(0,["YYYYYY",6,!0],0,"year");W("Y",ql);W("YY",ze,dn);W("YYYY",sm,rm);W("YYYYY",Hl,Ul);W("YYYYYY",Hl,Ul);Me(["YYYYY","YYYYYY"],Ut);Me("YYYY",function(n,e){e[Ut]=n.length===2?U.parseTwoDigitYear(n):me(n)});Me("YY",function(n,e){e[Ut]=U.parseTwoDigitYear(n)});Me("Y",function(n,e){e[Ut]=parseInt(n,10)});function pa(n){return Yl(n)?366:365}U.parseTwoDigitYear=function(n){return me(n)+(me(n)>68?1900:2e3)};var lx=ko("FullYear",!0);function IS(){return Yl(this.year())}function ko(n,e){return function(t){return t!=null?(hx(this,n,t),U.updateOffset(this,e),this):Ba(this,n)}}function Ba(n,e){if(!n.isValid())return NaN;var t=n._d,r=n._isUTC;switch(e){case"Milliseconds":return r?t.getUTCMilliseconds():t.getMilliseconds();case"Seconds":return r?t.getUTCSeconds():t.getSeconds();case"Minutes":return r?t.getUTCMinutes():t.getMinutes();case"Hours":return r?t.getUTCHours():t.getHours();case"Date":return r?t.getUTCDate():t.getDate();case"Day":return r?t.getUTCDay():t.getDay();case"Month":return r?t.getUTCMonth():t.getMonth();case"FullYear":return r?t.getUTCFullYear():t.getFullYear();default:return NaN}}function hx(n,e,t){var r,s,i,o,a;if(!(!n.isValid()||isNaN(t))){switch(r=n._d,s=n._isUTC,e){case"Milliseconds":return void(s?r.setUTCMilliseconds(t):r.setMilliseconds(t));case"Seconds":return void(s?r.setUTCSeconds(t):r.setSeconds(t));case"Minutes":return void(s?r.setUTCMinutes(t):r.setMinutes(t));case"Hours":return void(s?r.setUTCHours(t):r.setHours(t));case"Date":return void(s?r.setUTCDate(t):r.setDate(t));case"FullYear":break;default:return}i=t,o=n.month(),a=n.date(),a=a===29&&o===1&&!Yl(i)?28:a,s?r.setUTCFullYear(i,o,a):r.setFullYear(i,o,a)}}function TS(n){return n=In(n),sr(this[n])?this[n]():this}function DS(n,e){if(typeof n=="object"){n=nm(n);var t=pS(n),r,s=t.length;for(r=0;r<s;r++)this[t[r].unit](n[t[r].unit])}else if(n=In(n),sr(this[n]))return this[n](e);return this}function AS(n,e){return(n%e+e)%e}var st;Array.prototype.indexOf?st=Array.prototype.indexOf:st=function(n){var e;for(e=0;e<this.length;++e)if(this[e]===n)return e;return-1};function om(n,e){if(isNaN(n)||isNaN(e))return NaN;var t=AS(e,12);return n+=(e-t)/12,t===1?Yl(n)?29:28:31-t%7%2}G("M",["MM",2],"Mo",function(){return this.month()+1});G("MMM",0,0,function(n){return this.localeData().monthsShort(this,n)});G("MMMM",0,0,function(n){return this.localeData().months(this,n)});W("M",ze,bo);W("MM",ze,dn);W("MMM",function(n,e){return e.monthsShortRegex(n)});W("MMMM",function(n,e){return e.monthsRegex(n)});Me(["M","MM"],function(n,e){e[pr]=me(n)-1});Me(["MMM","MMMM"],function(n,e,t,r){var s=t._locale.monthsParse(n,r,t._strict);s!=null?e[pr]=s:ie(t).invalidMonth=n});var CS="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),dx="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),fx=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,bS=wc,kS=wc;function SS(n,e){return n?Pn(this._months)?this._months[n.month()]:this._months[(this._months.isFormat||fx).test(e)?"format":"standalone"][n.month()]:Pn(this._months)?this._months:this._months.standalone}function PS(n,e){return n?Pn(this._monthsShort)?this._monthsShort[n.month()]:this._monthsShort[fx.test(e)?"format":"standalone"][n.month()]:Pn(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function RS(n,e,t){var r,s,i,o=n.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)i=rr([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(i,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(i,"").toLocaleLowerCase();return t?e==="MMM"?(s=st.call(this._shortMonthsParse,o),s!==-1?s:null):(s=st.call(this._longMonthsParse,o),s!==-1?s:null):e==="MMM"?(s=st.call(this._shortMonthsParse,o),s!==-1?s:(s=st.call(this._longMonthsParse,o),s!==-1?s:null)):(s=st.call(this._longMonthsParse,o),s!==-1?s:(s=st.call(this._shortMonthsParse,o),s!==-1?s:null))}function NS(n,e,t){var r,s,i;if(this._monthsParseExact)return RS.call(this,n,e,t);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(s=rr([2e3,r]),t&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),!t&&!this._monthsParse[r]&&(i="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[r]=new RegExp(i.replace(".",""),"i")),t&&e==="MMMM"&&this._longMonthsParse[r].test(n))return r;if(t&&e==="MMM"&&this._shortMonthsParse[r].test(n))return r;if(!t&&this._monthsParse[r].test(n))return r}}function mx(n,e){if(!n.isValid())return n;if(typeof e=="string"){if(/^\d+$/.test(e))e=me(e);else if(e=n.localeData().monthsParse(e),!kr(e))return n}var t=e,r=n.date();return r=r<29?r:Math.min(r,om(n.year(),t)),n._isUTC?n._d.setUTCMonth(t,r):n._d.setMonth(t,r),n}function px(n){return n!=null?(mx(this,n),U.updateOffset(this,!0),this):Ba(this,"Month")}function MS(){return om(this.year(),this.month())}function OS(n){return this._monthsParseExact?(xe(this,"_monthsRegex")||gx.call(this),n?this._monthsShortStrictRegex:this._monthsShortRegex):(xe(this,"_monthsShortRegex")||(this._monthsShortRegex=bS),this._monthsShortStrictRegex&&n?this._monthsShortStrictRegex:this._monthsShortRegex)}function FS(n){return this._monthsParseExact?(xe(this,"_monthsRegex")||gx.call(this),n?this._monthsStrictRegex:this._monthsRegex):(xe(this,"_monthsRegex")||(this._monthsRegex=kS),this._monthsStrictRegex&&n?this._monthsStrictRegex:this._monthsRegex)}function gx(){function n(c,u){return u.length-c.length}var e=[],t=[],r=[],s,i,o,a;for(s=0;s<12;s++)i=rr([2e3,s]),o=Dr(this.monthsShort(i,"")),a=Dr(this.months(i,"")),e.push(o),t.push(a),r.push(a),r.push(o);e.sort(n),t.sort(n),r.sort(n),this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+e.join("|")+")","i")}function BS(n,e,t,r,s,i,o){var a;return n<100&&n>=0?(a=new Date(n+400,e,t,r,s,i,o),isFinite(a.getFullYear())&&a.setFullYear(n)):a=new Date(n,e,t,r,s,i,o),a}function La(n){var e,t;return n<100&&n>=0?(t=Array.prototype.slice.call(arguments),t[0]=n+400,e=new Date(Date.UTC.apply(null,t)),isFinite(e.getUTCFullYear())&&e.setUTCFullYear(n)):e=new Date(Date.UTC.apply(null,arguments)),e}function Vu(n,e,t){var r=7+e-t,s=(7+La(n,0,r).getUTCDay()-e)%7;return-s+r-1}function yx(n,e,t,r,s){var i=(7+t-r)%7,o=Vu(n,r,s),a=1+7*(e-1)+i+o,c,u;return a<=0?(c=n-1,u=pa(c)+a):a>pa(n)?(c=n+1,u=a-pa(n)):(c=n,u=a),{year:c,dayOfYear:u}}function Va(n,e,t){var r=Vu(n.year(),e,t),s=Math.floor((n.dayOfYear()-r-1)/7)+1,i,o;return s<1?(o=n.year()-1,i=s+Ar(o,e,t)):s>Ar(n.year(),e,t)?(i=s-Ar(n.year(),e,t),o=n.year()+1):(o=n.year(),i=s),{week:i,year:o}}function Ar(n,e,t){var r=Vu(n,e,t),s=Vu(n+1,e,t);return(pa(n)-r+s)/7}G("w",["ww",2],"wo","week");G("W",["WW",2],"Wo","isoWeek");W("w",ze,bo);W("ww",ze,dn);W("W",ze,bo);W("WW",ze,dn);xc(["w","ww","W","WW"],function(n,e,t,r){e[r.substr(0,1)]=me(n)});function LS(n){return Va(n,this._week.dow,this._week.doy).week}var VS={dow:0,doy:6};function US(){return this._week.dow}function WS(){return this._week.doy}function HS(n){var e=this.localeData().week(this);return n==null?e:this.add((n-e)*7,"d")}function qS(n){var e=Va(this,1,4).week;return n==null?e:this.add((n-e)*7,"d")}G("d",0,"do","day");G("dd",0,0,function(n){return this.localeData().weekdaysMin(this,n)});G("ddd",0,0,function(n){return this.localeData().weekdaysShort(this,n)});G("dddd",0,0,function(n){return this.localeData().weekdays(this,n)});G("e",0,0,"weekday");G("E",0,0,"isoWeekday");W("d",ze);W("e",ze);W("E",ze);W("dd",function(n,e){return e.weekdaysMinRegex(n)});W("ddd",function(n,e){return e.weekdaysShortRegex(n)});W("dddd",function(n,e){return e.weekdaysRegex(n)});xc(["dd","ddd","dddd"],function(n,e,t,r){var s=t._locale.weekdaysParse(n,r,t._strict);s!=null?e.d=s:ie(t).invalidWeekday=n});xc(["d","e","E"],function(n,e,t,r){e[r]=me(n)});function $S(n,e){return typeof n!="string"?n:isNaN(n)?(n=e.weekdaysParse(n),typeof n=="number"?n:null):parseInt(n,10)}function YS(n,e){return typeof n=="string"?e.weekdaysParse(n)%7||7:isNaN(n)?null:n}function am(n,e){return n.slice(e,7).concat(n.slice(0,e))}var zS="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),_x="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),GS="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),JS=wc,QS=wc,KS=wc;function jS(n,e){var t=Pn(this._weekdays)?this._weekdays:this._weekdays[n&&n!==!0&&this._weekdays.isFormat.test(e)?"format":"standalone"];return n===!0?am(t,this._week.dow):n?t[n.day()]:t}function XS(n){return n===!0?am(this._weekdaysShort,this._week.dow):n?this._weekdaysShort[n.day()]:this._weekdaysShort}function ZS(n){return n===!0?am(this._weekdaysMin,this._week.dow):n?this._weekdaysMin[n.day()]:this._weekdaysMin}function eP(n,e,t){var r,s,i,o=n.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)i=rr([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(i,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(i,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(i,"").toLocaleLowerCase();return t?e==="dddd"?(s=st.call(this._weekdaysParse,o),s!==-1?s:null):e==="ddd"?(s=st.call(this._shortWeekdaysParse,o),s!==-1?s:null):(s=st.call(this._minWeekdaysParse,o),s!==-1?s:null):e==="dddd"?(s=st.call(this._weekdaysParse,o),s!==-1||(s=st.call(this._shortWeekdaysParse,o),s!==-1)?s:(s=st.call(this._minWeekdaysParse,o),s!==-1?s:null)):e==="ddd"?(s=st.call(this._shortWeekdaysParse,o),s!==-1||(s=st.call(this._weekdaysParse,o),s!==-1)?s:(s=st.call(this._minWeekdaysParse,o),s!==-1?s:null)):(s=st.call(this._minWeekdaysParse,o),s!==-1||(s=st.call(this._weekdaysParse,o),s!==-1)?s:(s=st.call(this._shortWeekdaysParse,o),s!==-1?s:null))}function tP(n,e,t){var r,s,i;if(this._weekdaysParseExact)return eP.call(this,n,e,t);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(s=rr([2e3,1]).day(r),t&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(i="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[r]=new RegExp(i.replace(".",""),"i")),t&&e==="dddd"&&this._fullWeekdaysParse[r].test(n))return r;if(t&&e==="ddd"&&this._shortWeekdaysParse[r].test(n))return r;if(t&&e==="dd"&&this._minWeekdaysParse[r].test(n))return r;if(!t&&this._weekdaysParse[r].test(n))return r}}function nP(n){if(!this.isValid())return n!=null?this:NaN;var e=Ba(this,"Day");return n!=null?(n=$S(n,this.localeData()),this.add(n-e,"d")):e}function rP(n){if(!this.isValid())return n!=null?this:NaN;var e=(this.day()+7-this.localeData()._week.dow)%7;return n==null?e:this.add(n-e,"d")}function sP(n){if(!this.isValid())return n!=null?this:NaN;if(n!=null){var e=YS(n,this.localeData());return this.day(this.day()%7?e:e-7)}else return this.day()||7}function iP(n){return this._weekdaysParseExact?(xe(this,"_weekdaysRegex")||cm.call(this),n?this._weekdaysStrictRegex:this._weekdaysRegex):(xe(this,"_weekdaysRegex")||(this._weekdaysRegex=JS),this._weekdaysStrictRegex&&n?this._weekdaysStrictRegex:this._weekdaysRegex)}function oP(n){return this._weekdaysParseExact?(xe(this,"_weekdaysRegex")||cm.call(this),n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(xe(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=QS),this._weekdaysShortStrictRegex&&n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function aP(n){return this._weekdaysParseExact?(xe(this,"_weekdaysRegex")||cm.call(this),n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(xe(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=KS),this._weekdaysMinStrictRegex&&n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function cm(){function n(l,d){return d.length-l.length}var e=[],t=[],r=[],s=[],i,o,a,c,u;for(i=0;i<7;i++)o=rr([2e3,1]).day(i),a=Dr(this.weekdaysMin(o,"")),c=Dr(this.weekdaysShort(o,"")),u=Dr(this.weekdays(o,"")),e.push(a),t.push(c),r.push(u),s.push(a),s.push(c),s.push(u);e.sort(n),t.sort(n),r.sort(n),s.sort(n),this._weekdaysRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+e.join("|")+")","i")}function um(){return this.hours()%12||12}function cP(){return this.hours()||24}G("H",["HH",2],0,"hour");G("h",["hh",2],0,um);G("k",["kk",2],0,cP);G("hmm",0,0,function(){return""+um.apply(this)+Xn(this.minutes(),2)});G("hmmss",0,0,function(){return""+um.apply(this)+Xn(this.minutes(),2)+Xn(this.seconds(),2)});G("Hmm",0,0,function(){return""+this.hours()+Xn(this.minutes(),2)});G("Hmmss",0,0,function(){return""+this.hours()+Xn(this.minutes(),2)+Xn(this.seconds(),2)});function vx(n,e){G(n,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),e)})}vx("a",!0);vx("A",!1);function wx(n,e){return e._meridiemParse}W("a",wx);W("A",wx);W("H",ze,im);W("h",ze,bo);W("k",ze,bo);W("HH",ze,dn);W("hh",ze,dn);W("kk",ze,dn);W("hmm",cx);W("hmmss",ux);W("Hmm",cx);W("Hmmss",ux);Me(["H","HH"],mt);Me(["k","kk"],function(n,e,t){var r=me(n);e[mt]=r===24?0:r});Me(["a","A"],function(n,e,t){t._isPm=t._locale.isPM(n),t._meridiem=n});Me(["h","hh"],function(n,e,t){e[mt]=me(n),ie(t).bigHour=!0});Me("hmm",function(n,e,t){var r=n.length-2;e[mt]=me(n.substr(0,r)),e[bn]=me(n.substr(r)),ie(t).bigHour=!0});Me("hmmss",function(n,e,t){var r=n.length-4,s=n.length-2;e[mt]=me(n.substr(0,r)),e[bn]=me(n.substr(r,2)),e[gr]=me(n.substr(s)),ie(t).bigHour=!0});Me("Hmm",function(n,e,t){var r=n.length-2;e[mt]=me(n.substr(0,r)),e[bn]=me(n.substr(r))});Me("Hmmss",function(n,e,t){var r=n.length-4,s=n.length-2;e[mt]=me(n.substr(0,r)),e[bn]=me(n.substr(r,2)),e[gr]=me(n.substr(s))});function uP(n){return(n+"").toLowerCase().charAt(0)==="p"}var lP=/[ap]\.?m?\.?/i,hP=ko("Hours",!0);function dP(n,e,t){return n>11?t?"pm":"PM":t?"am":"AM"}var xx={calendar:eS,longDateFormat:sS,invalidDate:oS,ordinal:cS,dayOfMonthOrdinalParse:uS,relativeTime:hS,months:CS,monthsShort:dx,week:VS,weekdays:zS,weekdaysMin:GS,weekdaysShort:_x,meridiemParse:lP},Je={},Xo={},Ua;function fP(n,e){var t,r=Math.min(n.length,e.length);for(t=0;t<r;t+=1)if(n[t]!==e[t])return t;return r}function dy(n){return n&&n.toLowerCase().replace("_","-")}function mP(n){for(var e=0,t,r,s,i;e<n.length;){for(i=dy(n[e]).split("-"),t=i.length,r=dy(n[e+1]),r=r?r.split("-"):null;t>0;){if(s=zl(i.slice(0,t).join("-")),s)return s;if(r&&r.length>=t&&fP(i,r)>=t-1)break;t--}e++}return Ua}function pP(n){return!!(n&&n.match("^[^/\\\\]*$"))}function zl(n){var e=null,t;if(Je[n]===void 0&&typeof module<"u"&&module&&module.exports&&pP(n))try{e=Ua._abbr,t=require,t("./locale/"+n),ns(e)}catch{Je[n]=null}return Je[n]}function ns(n,e){var t;return n&&(Xt(e)?t=Br(n):t=lm(n,e),t?Ua=t:typeof console<"u"&&console.warn&&console.warn("Locale "+n+" not found. Did you forget to load it?")),Ua._abbr}function lm(n,e){if(e!==null){var t,r=xx;if(e.abbr=n,Je[n]!=null)sx("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=Je[n]._config;else if(e.parentLocale!=null)if(Je[e.parentLocale]!=null)r=Je[e.parentLocale]._config;else if(t=zl(e.parentLocale),t!=null)r=t._config;else return Xo[e.parentLocale]||(Xo[e.parentLocale]=[]),Xo[e.parentLocale].push({name:n,config:e}),null;return Je[n]=new em(Uf(r,e)),Xo[n]&&Xo[n].forEach(function(s){lm(s.name,s.config)}),ns(n),Je[n]}else return delete Je[n],null}function gP(n,e){if(e!=null){var t,r,s=xx;Je[n]!=null&&Je[n].parentLocale!=null?Je[n].set(Uf(Je[n]._config,e)):(r=zl(n),r!=null&&(s=r._config),e=Uf(s,e),r==null&&(e.abbr=n),t=new em(e),t.parentLocale=Je[n],Je[n]=t),ns(n)}else Je[n]!=null&&(Je[n].parentLocale!=null?(Je[n]=Je[n].parentLocale,n===ns()&&ns(n)):Je[n]!=null&&delete Je[n]);return Je[n]}function Br(n){var e;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return Ua;if(!Pn(n)){if(e=zl(n),e)return e;n=[n]}return mP(n)}function yP(){return Wf(Je)}function hm(n){var e,t=n._a;return t&&ie(n).overflow===-2&&(e=t[pr]<0||t[pr]>11?pr:t[Un]<1||t[Un]>om(t[Ut],t[pr])?Un:t[mt]<0||t[mt]>24||t[mt]===24&&(t[bn]!==0||t[gr]!==0||t[Ms]!==0)?mt:t[bn]<0||t[bn]>59?bn:t[gr]<0||t[gr]>59?gr:t[Ms]<0||t[Ms]>999?Ms:-1,ie(n)._overflowDayOfYear&&(e<Ut||e>Un)&&(e=Un),ie(n)._overflowWeeks&&e===-1&&(e=xS),ie(n)._overflowWeekday&&e===-1&&(e=ES),ie(n).overflow=e),n}var _P=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,vP=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,wP=/Z|[+-]\d\d(?::?\d\d)?/,nu=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],ld=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],xP=/^\/?Date\((-?\d+)/i,EP=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,IP={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Ex(n){var e,t,r=n._i,s=_P.exec(r)||vP.exec(r),i,o,a,c,u=nu.length,l=ld.length;if(s){for(ie(n).iso=!0,e=0,t=u;e<t;e++)if(nu[e][1].exec(s[1])){o=nu[e][0],i=nu[e][2]!==!1;break}if(o==null){n._isValid=!1;return}if(s[3]){for(e=0,t=l;e<t;e++)if(ld[e][1].exec(s[3])){a=(s[2]||" ")+ld[e][0];break}if(a==null){n._isValid=!1;return}}if(!i&&a!=null){n._isValid=!1;return}if(s[4])if(wP.exec(s[4]))c="Z";else{n._isValid=!1;return}n._f=o+(a||"")+(c||""),fm(n)}else n._isValid=!1}function TP(n,e,t,r,s,i){var o=[DP(n),dx.indexOf(e),parseInt(t,10),parseInt(r,10),parseInt(s,10)];return i&&o.push(parseInt(i,10)),o}function DP(n){var e=parseInt(n,10);return e<=49?2e3+e:e<=999?1900+e:e}function AP(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function CP(n,e,t){if(n){var r=_x.indexOf(n),s=new Date(e[0],e[1],e[2]).getDay();if(r!==s)return ie(t).weekdayMismatch=!0,t._isValid=!1,!1}return!0}function bP(n,e,t){if(n)return IP[n];if(e)return 0;var r=parseInt(t,10),s=r%100,i=(r-s)/100;return i*60+s}function Ix(n){var e=EP.exec(AP(n._i)),t;if(e){if(t=TP(e[4],e[3],e[2],e[5],e[6],e[7]),!CP(e[1],t,n))return;n._a=t,n._tzm=bP(e[8],e[9],e[10]),n._d=La.apply(null,n._a),n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),ie(n).rfc2822=!0}else n._isValid=!1}function kP(n){var e=xP.exec(n._i);if(e!==null){n._d=new Date(+e[1]);return}if(Ex(n),n._isValid===!1)delete n._isValid;else return;if(Ix(n),n._isValid===!1)delete n._isValid;else return;n._strict?n._isValid=!1:U.createFromInputFallback(n)}U.createFromInputFallback=En("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))});function Ei(n,e,t){return n??e??t}function SP(n){var e=new Date(U.now());return n._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function dm(n){var e,t,r=[],s,i,o;if(!n._d){for(s=SP(n),n._w&&n._a[Un]==null&&n._a[pr]==null&&PP(n),n._dayOfYear!=null&&(o=Ei(n._a[Ut],s[Ut]),(n._dayOfYear>pa(o)||n._dayOfYear===0)&&(ie(n)._overflowDayOfYear=!0),t=La(o,0,n._dayOfYear),n._a[pr]=t.getUTCMonth(),n._a[Un]=t.getUTCDate()),e=0;e<3&&n._a[e]==null;++e)n._a[e]=r[e]=s[e];for(;e<7;e++)n._a[e]=r[e]=n._a[e]==null?e===2?1:0:n._a[e];n._a[mt]===24&&n._a[bn]===0&&n._a[gr]===0&&n._a[Ms]===0&&(n._nextDay=!0,n._a[mt]=0),n._d=(n._useUTC?La:BS).apply(null,r),i=n._useUTC?n._d.getUTCDay():n._d.getDay(),n._tzm!=null&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),n._nextDay&&(n._a[mt]=24),n._w&&typeof n._w.d<"u"&&n._w.d!==i&&(ie(n).weekdayMismatch=!0)}}function PP(n){var e,t,r,s,i,o,a,c,u;e=n._w,e.GG!=null||e.W!=null||e.E!=null?(i=1,o=4,t=Ei(e.GG,n._a[Ut],Va(Ye(),1,4).year),r=Ei(e.W,1),s=Ei(e.E,1),(s<1||s>7)&&(c=!0)):(i=n._locale._week.dow,o=n._locale._week.doy,u=Va(Ye(),i,o),t=Ei(e.gg,n._a[Ut],u.year),r=Ei(e.w,u.week),e.d!=null?(s=e.d,(s<0||s>6)&&(c=!0)):e.e!=null?(s=e.e+i,(e.e<0||e.e>6)&&(c=!0)):s=i),r<1||r>Ar(t,i,o)?ie(n)._overflowWeeks=!0:c!=null?ie(n)._overflowWeekday=!0:(a=yx(t,r,s,i,o),n._a[Ut]=a.year,n._dayOfYear=a.dayOfYear)}U.ISO_8601=function(){};U.RFC_2822=function(){};function fm(n){if(n._f===U.ISO_8601){Ex(n);return}if(n._f===U.RFC_2822){Ix(n);return}n._a=[],ie(n).empty=!0;var e=""+n._i,t,r,s,i,o,a=e.length,c=0,u,l;for(s=ix(n._f,n._locale).match(tm)||[],l=s.length,t=0;t<l;t++)i=s[t],r=(e.match(_S(i,n))||[])[0],r&&(o=e.substr(0,e.indexOf(r)),o.length>0&&ie(n).unusedInput.push(o),e=e.slice(e.indexOf(r)+r.length),c+=r.length),Ni[i]?(r?ie(n).empty=!1:ie(n).unusedTokens.push(i),wS(i,r,n)):n._strict&&!r&&ie(n).unusedTokens.push(i);ie(n).charsLeftOver=a-c,e.length>0&&ie(n).unusedInput.push(e),n._a[mt]<=12&&ie(n).bigHour===!0&&n._a[mt]>0&&(ie(n).bigHour=void 0),ie(n).parsedDateParts=n._a.slice(0),ie(n).meridiem=n._meridiem,n._a[mt]=RP(n._locale,n._a[mt],n._meridiem),u=ie(n).era,u!==null&&(n._a[Ut]=n._locale.erasConvertYear(u,n._a[Ut])),dm(n),hm(n)}function RP(n,e,t){var r;return t==null?e:n.meridiemHour!=null?n.meridiemHour(e,t):(n.isPM!=null&&(r=n.isPM(t),r&&e<12&&(e+=12),!r&&e===12&&(e=0)),e)}function NP(n){var e,t,r,s,i,o,a=!1,c=n._f.length;if(c===0){ie(n).invalidFormat=!0,n._d=new Date(NaN);return}for(s=0;s<c;s++)i=0,o=!1,e=Z0({},n),n._useUTC!=null&&(e._useUTC=n._useUTC),e._f=n._f[s],fm(e),X0(e)&&(o=!0),i+=ie(e).charsLeftOver,i+=ie(e).unusedTokens.length*10,ie(e).score=i,a?i<r&&(r=i,t=e):(r==null||i<r||o)&&(r=i,t=e,o&&(a=!0));Kr(n,t||e)}function MP(n){if(!n._d){var e=nm(n._i),t=e.day===void 0?e.date:e.day;n._a=nx([e.year,e.month,t,e.hour,e.minute,e.second,e.millisecond],function(r){return r&&parseInt(r,10)}),dm(n)}}function OP(n){var e=new vc(hm(Tx(n)));return e._nextDay&&(e.add(1,"d"),e._nextDay=void 0),e}function Tx(n){var e=n._i,t=n._f;return n._locale=n._locale||Br(n._l),e===null||t===void 0&&e===""?Vl({nullInput:!0}):(typeof e=="string"&&(n._i=e=n._locale.preparse(e)),Rn(e)?new vc(hm(e)):(_c(e)?n._d=e:Pn(t)?NP(n):t?fm(n):FP(n),X0(n)||(n._d=null),n))}function FP(n){var e=n._i;Xt(e)?n._d=new Date(U.now()):_c(e)?n._d=new Date(e.valueOf()):typeof e=="string"?kP(n):Pn(e)?(n._a=nx(e.slice(0),function(t){return parseInt(t,10)}),dm(n)):Us(e)?MP(n):kr(e)?n._d=new Date(e):U.createFromInputFallback(n)}function Dx(n,e,t,r,s){var i={};return(e===!0||e===!1)&&(r=e,e=void 0),(t===!0||t===!1)&&(r=t,t=void 0),(Us(n)&&j0(n)||Pn(n)&&n.length===0)&&(n=void 0),i._isAMomentObject=!0,i._useUTC=i._isUTC=s,i._l=t,i._i=n,i._f=e,i._strict=r,OP(i)}function Ye(n,e,t,r){return Dx(n,e,t,r,!1)}var BP=En("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Ye.apply(null,arguments);return this.isValid()&&n.isValid()?n<this?this:n:Vl()}),LP=En("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Ye.apply(null,arguments);return this.isValid()&&n.isValid()?n>this?this:n:Vl()});function Ax(n,e){var t,r;if(e.length===1&&Pn(e[0])&&(e=e[0]),!e.length)return Ye();for(t=e[0],r=1;r<e.length;++r)(!e[r].isValid()||e[r][n](t))&&(t=e[r]);return t}function VP(){var n=[].slice.call(arguments,0);return Ax("isBefore",n)}function UP(){var n=[].slice.call(arguments,0);return Ax("isAfter",n)}var WP=function(){return Date.now?Date.now():+new Date},Zo=["year","quarter","month","week","day","hour","minute","second","millisecond"];function HP(n){var e,t=!1,r,s=Zo.length;for(e in n)if(xe(n,e)&&!(st.call(Zo,e)!==-1&&(n[e]==null||!isNaN(n[e]))))return!1;for(r=0;r<s;++r)if(n[Zo[r]]){if(t)return!1;parseFloat(n[Zo[r]])!==me(n[Zo[r]])&&(t=!0)}return!0}function qP(){return this._isValid}function $P(){return Mn(NaN)}function Gl(n){var e=nm(n),t=e.year||0,r=e.quarter||0,s=e.month||0,i=e.week||e.isoWeek||0,o=e.day||0,a=e.hour||0,c=e.minute||0,u=e.second||0,l=e.millisecond||0;this._isValid=HP(e),this._milliseconds=+l+u*1e3+c*6e4+a*1e3*60*60,this._days=+o+i*7,this._months=+s+r*3+t*12,this._data={},this._locale=Br(),this._bubble()}function vu(n){return n instanceof Gl}function qf(n){return n<0?Math.round(-1*n)*-1:Math.round(n)}function YP(n,e,t){var r=Math.min(n.length,e.length),s=Math.abs(n.length-e.length),i=0,o;for(o=0;o<r;o++)(t&&n[o]!==e[o]||!t&&me(n[o])!==me(e[o]))&&i++;return i+s}function Cx(n,e){G(n,0,0,function(){var t=this.utcOffset(),r="+";return t<0&&(t=-t,r="-"),r+Xn(~~(t/60),2)+e+Xn(~~t%60,2)})}Cx("Z",":");Cx("ZZ","");W("Z",$l);W("ZZ",$l);Me(["Z","ZZ"],function(n,e,t){t._useUTC=!0,t._tzm=mm($l,n)});var zP=/([\+\-]|\d\d)/gi;function mm(n,e){var t=(e||"").match(n),r,s,i;return t===null?null:(r=t[t.length-1]||[],s=(r+"").match(zP)||["-",0,0],i=+(s[1]*60)+me(s[2]),i===0?0:s[0]==="+"?i:-i)}function pm(n,e){var t,r;return e._isUTC?(t=e.clone(),r=(Rn(n)||_c(n)?n.valueOf():Ye(n).valueOf())-t.valueOf(),t._d.setTime(t._d.valueOf()+r),U.updateOffset(t,!1),t):Ye(n).local()}function $f(n){return-Math.round(n._d.getTimezoneOffset())}U.updateOffset=function(){};function GP(n,e,t){var r=this._offset||0,s;if(!this.isValid())return n!=null?this:NaN;if(n!=null){if(typeof n=="string"){if(n=mm($l,n),n===null)return this}else Math.abs(n)<16&&!t&&(n=n*60);return!this._isUTC&&e&&(s=$f(this)),this._offset=n,this._isUTC=!0,s!=null&&this.add(s,"m"),r!==n&&(!e||this._changeInProgress?Sx(this,Mn(n-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,U.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?r:$f(this)}function JP(n,e){return n!=null?(typeof n!="string"&&(n=-n),this.utcOffset(n,e),this):-this.utcOffset()}function QP(n){return this.utcOffset(0,n)}function KP(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract($f(this),"m")),this}function jP(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var n=mm(gS,this._i);n!=null?this.utcOffset(n):this.utcOffset(0,!0)}return this}function XP(n){return this.isValid()?(n=n?Ye(n).utcOffset():0,(this.utcOffset()-n)%60===0):!1}function ZP(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function eR(){if(!Xt(this._isDSTShifted))return this._isDSTShifted;var n={},e;return Z0(n,this),n=Tx(n),n._a?(e=n._isUTC?rr(n._a):Ye(n._a),this._isDSTShifted=this.isValid()&&YP(n._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function tR(){return this.isValid()?!this._isUTC:!1}function nR(){return this.isValid()?this._isUTC:!1}function bx(){return this.isValid()?this._isUTC&&this._offset===0:!1}var rR=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,sR=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Mn(n,e){var t=n,r=null,s,i,o;return vu(n)?t={ms:n._milliseconds,d:n._days,M:n._months}:kr(n)||!isNaN(+n)?(t={},e?t[e]=+n:t.milliseconds=+n):(r=rR.exec(n))?(s=r[1]==="-"?-1:1,t={y:0,d:me(r[Un])*s,h:me(r[mt])*s,m:me(r[bn])*s,s:me(r[gr])*s,ms:me(qf(r[Ms]*1e3))*s}):(r=sR.exec(n))?(s=r[1]==="-"?-1:1,t={y:Is(r[2],s),M:Is(r[3],s),w:Is(r[4],s),d:Is(r[5],s),h:Is(r[6],s),m:Is(r[7],s),s:Is(r[8],s)}):t==null?t={}:typeof t=="object"&&("from"in t||"to"in t)&&(o=iR(Ye(t.from),Ye(t.to)),t={},t.ms=o.milliseconds,t.M=o.months),i=new Gl(t),vu(n)&&xe(n,"_locale")&&(i._locale=n._locale),vu(n)&&xe(n,"_isValid")&&(i._isValid=n._isValid),i}Mn.fn=Gl.prototype;Mn.invalid=$P;function Is(n,e){var t=n&&parseFloat(n.replace(",","."));return(isNaN(t)?0:t)*e}function fy(n,e){var t={};return t.months=e.month()-n.month()+(e.year()-n.year())*12,n.clone().add(t.months,"M").isAfter(e)&&--t.months,t.milliseconds=+e-+n.clone().add(t.months,"M"),t}function iR(n,e){var t;return n.isValid()&&e.isValid()?(e=pm(e,n),n.isBefore(e)?t=fy(n,e):(t=fy(e,n),t.milliseconds=-t.milliseconds,t.months=-t.months),t):{milliseconds:0,months:0}}function kx(n,e){return function(t,r){var s,i;return r!==null&&!isNaN(+r)&&(sx(e,"moment()."+e+"(period, number) is deprecated. Please use moment()."+e+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=t,t=r,r=i),s=Mn(t,r),Sx(this,s,n),this}}function Sx(n,e,t,r){var s=e._milliseconds,i=qf(e._days),o=qf(e._months);n.isValid()&&(r=r??!0,o&&mx(n,Ba(n,"Month")+o*t),i&&hx(n,"Date",Ba(n,"Date")+i*t),s&&n._d.setTime(n._d.valueOf()+s*t),r&&U.updateOffset(n,i||o))}var oR=kx(1,"add"),aR=kx(-1,"subtract");function Px(n){return typeof n=="string"||n instanceof String}function cR(n){return Rn(n)||_c(n)||Px(n)||kr(n)||lR(n)||uR(n)||n===null||n===void 0}function uR(n){var e=Us(n)&&!j0(n),t=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],s,i,o=r.length;for(s=0;s<o;s+=1)i=r[s],t=t||xe(n,i);return e&&t}function lR(n){var e=Pn(n),t=!1;return e&&(t=n.filter(function(r){return!kr(r)&&Px(n)}).length===0),e&&t}function hR(n){var e=Us(n)&&!j0(n),t=!1,r=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],s,i;for(s=0;s<r.length;s+=1)i=r[s],t=t||xe(n,i);return e&&t}function dR(n,e){var t=n.diff(e,"days",!0);return t<-6?"sameElse":t<-1?"lastWeek":t<0?"lastDay":t<1?"sameDay":t<2?"nextDay":t<7?"nextWeek":"sameElse"}function fR(n,e){arguments.length===1&&(arguments[0]?cR(arguments[0])?(n=arguments[0],e=void 0):hR(arguments[0])&&(e=arguments[0],n=void 0):(n=void 0,e=void 0));var t=n||Ye(),r=pm(t,this).startOf("day"),s=U.calendarFormat(this,r)||"sameElse",i=e&&(sr(e[s])?e[s].call(this,t):e[s]);return this.format(i||this.localeData().calendar(s,this,Ye(t)))}function mR(){return new vc(this)}function pR(n,e){var t=Rn(n)?n:Ye(n);return this.isValid()&&t.isValid()?(e=In(e)||"millisecond",e==="millisecond"?this.valueOf()>t.valueOf():t.valueOf()<this.clone().startOf(e).valueOf()):!1}function gR(n,e){var t=Rn(n)?n:Ye(n);return this.isValid()&&t.isValid()?(e=In(e)||"millisecond",e==="millisecond"?this.valueOf()<t.valueOf():this.clone().endOf(e).valueOf()<t.valueOf()):!1}function yR(n,e,t,r){var s=Rn(n)?n:Ye(n),i=Rn(e)?e:Ye(e);return this.isValid()&&s.isValid()&&i.isValid()?(r=r||"()",(r[0]==="("?this.isAfter(s,t):!this.isBefore(s,t))&&(r[1]===")"?this.isBefore(i,t):!this.isAfter(i,t))):!1}function _R(n,e){var t=Rn(n)?n:Ye(n),r;return this.isValid()&&t.isValid()?(e=In(e)||"millisecond",e==="millisecond"?this.valueOf()===t.valueOf():(r=t.valueOf(),this.clone().startOf(e).valueOf()<=r&&r<=this.clone().endOf(e).valueOf())):!1}function vR(n,e){return this.isSame(n,e)||this.isAfter(n,e)}function wR(n,e){return this.isSame(n,e)||this.isBefore(n,e)}function xR(n,e,t){var r,s,i;if(!this.isValid())return NaN;if(r=pm(n,this),!r.isValid())return NaN;switch(s=(r.utcOffset()-this.utcOffset())*6e4,e=In(e),e){case"year":i=wu(this,r)/12;break;case"month":i=wu(this,r);break;case"quarter":i=wu(this,r)/3;break;case"second":i=(this-r)/1e3;break;case"minute":i=(this-r)/6e4;break;case"hour":i=(this-r)/36e5;break;case"day":i=(this-r-s)/864e5;break;case"week":i=(this-r-s)/6048e5;break;default:i=this-r}return t?i:gn(i)}function wu(n,e){if(n.date()<e.date())return-wu(e,n);var t=(e.year()-n.year())*12+(e.month()-n.month()),r=n.clone().add(t,"months"),s,i;return e-r<0?(s=n.clone().add(t-1,"months"),i=(e-r)/(r-s)):(s=n.clone().add(t+1,"months"),i=(e-r)/(s-r)),-(t+i)||0}U.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";U.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function ER(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function IR(n){if(!this.isValid())return null;var e=n!==!0,t=e?this.clone().utc():this;return t.year()<0||t.year()>9999?_u(t,e?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):sr(Date.prototype.toISOString)?e?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",_u(t,"Z")):_u(t,e?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function TR(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var n="moment",e="",t,r,s,i;return this.isLocal()||(n=this.utcOffset()===0?"moment.utc":"moment.parseZone",e="Z"),t="["+n+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",s="-MM-DD[T]HH:mm:ss.SSS",i=e+'[")]',this.format(t+r+s+i)}function DR(n){n||(n=this.isUtc()?U.defaultFormatUtc:U.defaultFormat);var e=_u(this,n);return this.localeData().postformat(e)}function AR(n,e){return this.isValid()&&(Rn(n)&&n.isValid()||Ye(n).isValid())?Mn({to:this,from:n}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function CR(n){return this.from(Ye(),n)}function bR(n,e){return this.isValid()&&(Rn(n)&&n.isValid()||Ye(n).isValid())?Mn({from:this,to:n}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function kR(n){return this.to(Ye(),n)}function Rx(n){var e;return n===void 0?this._locale._abbr:(e=Br(n),e!=null&&(this._locale=e),this)}var Nx=En("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(n){return n===void 0?this.localeData():this.locale(n)});function Mx(){return this._locale}var Uu=1e3,Mi=60*Uu,Wu=60*Mi,Ox=(365*400+97)*24*Wu;function Oi(n,e){return(n%e+e)%e}function Fx(n,e,t){return n<100&&n>=0?new Date(n+400,e,t)-Ox:new Date(n,e,t).valueOf()}function Bx(n,e,t){return n<100&&n>=0?Date.UTC(n+400,e,t)-Ox:Date.UTC(n,e,t)}function SR(n){var e,t;if(n=In(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Bx:Fx,n){case"year":e=t(this.year(),0,1);break;case"quarter":e=t(this.year(),this.month()-this.month()%3,1);break;case"month":e=t(this.year(),this.month(),1);break;case"week":e=t(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":e=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":e=t(this.year(),this.month(),this.date());break;case"hour":e=this._d.valueOf(),e-=Oi(e+(this._isUTC?0:this.utcOffset()*Mi),Wu);break;case"minute":e=this._d.valueOf(),e-=Oi(e,Mi);break;case"second":e=this._d.valueOf(),e-=Oi(e,Uu);break}return this._d.setTime(e),U.updateOffset(this,!0),this}function PR(n){var e,t;if(n=In(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Bx:Fx,n){case"year":e=t(this.year()+1,0,1)-1;break;case"quarter":e=t(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":e=t(this.year(),this.month()+1,1)-1;break;case"week":e=t(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":e=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":e=t(this.year(),this.month(),this.date()+1)-1;break;case"hour":e=this._d.valueOf(),e+=Wu-Oi(e+(this._isUTC?0:this.utcOffset()*Mi),Wu)-1;break;case"minute":e=this._d.valueOf(),e+=Mi-Oi(e,Mi)-1;break;case"second":e=this._d.valueOf(),e+=Uu-Oi(e,Uu)-1;break}return this._d.setTime(e),U.updateOffset(this,!0),this}function RR(){return this._d.valueOf()-(this._offset||0)*6e4}function NR(){return Math.floor(this.valueOf()/1e3)}function MR(){return new Date(this.valueOf())}function OR(){var n=this;return[n.year(),n.month(),n.date(),n.hour(),n.minute(),n.second(),n.millisecond()]}function FR(){var n=this;return{years:n.year(),months:n.month(),date:n.date(),hours:n.hours(),minutes:n.minutes(),seconds:n.seconds(),milliseconds:n.milliseconds()}}function BR(){return this.isValid()?this.toISOString():null}function LR(){return X0(this)}function VR(){return Kr({},ie(this))}function UR(){return ie(this).overflow}function WR(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}G("N",0,0,"eraAbbr");G("NN",0,0,"eraAbbr");G("NNN",0,0,"eraAbbr");G("NNNN",0,0,"eraName");G("NNNNN",0,0,"eraNarrow");G("y",["y",1],"yo","eraYear");G("y",["yy",2],0,"eraYear");G("y",["yyy",3],0,"eraYear");G("y",["yyyy",4],0,"eraYear");W("N",gm);W("NN",gm);W("NNN",gm);W("NNNN",XR);W("NNNNN",ZR);Me(["N","NN","NNN","NNNN","NNNNN"],function(n,e,t,r){var s=t._locale.erasParse(n,r,t._strict);s?ie(t).era=s:ie(t).invalidEra=n});W("y",Co);W("yy",Co);W("yyy",Co);W("yyyy",Co);W("yo",eN);Me(["y","yy","yyy","yyyy"],Ut);Me(["yo"],function(n,e,t,r){var s;t._locale._eraYearOrdinalRegex&&(s=n.match(t._locale._eraYearOrdinalRegex)),t._locale.eraYearOrdinalParse?e[Ut]=t._locale.eraYearOrdinalParse(n,s):e[Ut]=parseInt(n,10)});function HR(n,e){var t,r,s,i=this._eras||Br("en")._eras;for(t=0,r=i.length;t<r;++t){switch(typeof i[t].since){case"string":s=U(i[t].since).startOf("day"),i[t].since=s.valueOf();break}switch(typeof i[t].until){case"undefined":i[t].until=1/0;break;case"string":s=U(i[t].until).startOf("day").valueOf(),i[t].until=s.valueOf();break}}return i}function qR(n,e,t){var r,s,i=this.eras(),o,a,c;for(n=n.toUpperCase(),r=0,s=i.length;r<s;++r)if(o=i[r].name.toUpperCase(),a=i[r].abbr.toUpperCase(),c=i[r].narrow.toUpperCase(),t)switch(e){case"N":case"NN":case"NNN":if(a===n)return i[r];break;case"NNNN":if(o===n)return i[r];break;case"NNNNN":if(c===n)return i[r];break}else if([o,a,c].indexOf(n)>=0)return i[r]}function $R(n,e){var t=n.since<=n.until?1:-1;return e===void 0?U(n.since).year():U(n.since).year()+(e-n.offset)*t}function YR(){var n,e,t,r=this.localeData().eras();for(n=0,e=r.length;n<e;++n)if(t=this.clone().startOf("day").valueOf(),r[n].since<=t&&t<=r[n].until||r[n].until<=t&&t<=r[n].since)return r[n].name;return""}function zR(){var n,e,t,r=this.localeData().eras();for(n=0,e=r.length;n<e;++n)if(t=this.clone().startOf("day").valueOf(),r[n].since<=t&&t<=r[n].until||r[n].until<=t&&t<=r[n].since)return r[n].narrow;return""}function GR(){var n,e,t,r=this.localeData().eras();for(n=0,e=r.length;n<e;++n)if(t=this.clone().startOf("day").valueOf(),r[n].since<=t&&t<=r[n].until||r[n].until<=t&&t<=r[n].since)return r[n].abbr;return""}function JR(){var n,e,t,r,s=this.localeData().eras();for(n=0,e=s.length;n<e;++n)if(t=s[n].since<=s[n].until?1:-1,r=this.clone().startOf("day").valueOf(),s[n].since<=r&&r<=s[n].until||s[n].until<=r&&r<=s[n].since)return(this.year()-U(s[n].since).year())*t+s[n].offset;return this.year()}function QR(n){return xe(this,"_erasNameRegex")||ym.call(this),n?this._erasNameRegex:this._erasRegex}function KR(n){return xe(this,"_erasAbbrRegex")||ym.call(this),n?this._erasAbbrRegex:this._erasRegex}function jR(n){return xe(this,"_erasNarrowRegex")||ym.call(this),n?this._erasNarrowRegex:this._erasRegex}function gm(n,e){return e.erasAbbrRegex(n)}function XR(n,e){return e.erasNameRegex(n)}function ZR(n,e){return e.erasNarrowRegex(n)}function eN(n,e){return e._eraYearOrdinalRegex||Co}function ym(){var n=[],e=[],t=[],r=[],s,i,o,a,c,u=this.eras();for(s=0,i=u.length;s<i;++s)o=Dr(u[s].name),a=Dr(u[s].abbr),c=Dr(u[s].narrow),e.push(o),n.push(a),t.push(c),r.push(o),r.push(a),r.push(c);this._erasRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+e.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+t.join("|")+")","i")}G(0,["gg",2],0,function(){return this.weekYear()%100});G(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Jl(n,e){G(0,[n,n.length],0,e)}Jl("gggg","weekYear");Jl("ggggg","weekYear");Jl("GGGG","isoWeekYear");Jl("GGGGG","isoWeekYear");W("G",ql);W("g",ql);W("GG",ze,dn);W("gg",ze,dn);W("GGGG",sm,rm);W("gggg",sm,rm);W("GGGGG",Hl,Ul);W("ggggg",Hl,Ul);xc(["gggg","ggggg","GGGG","GGGGG"],function(n,e,t,r){e[r.substr(0,2)]=me(n)});xc(["gg","GG"],function(n,e,t,r){e[r]=U.parseTwoDigitYear(n)});function tN(n){return Lx.call(this,n,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function nN(n){return Lx.call(this,n,this.isoWeek(),this.isoWeekday(),1,4)}function rN(){return Ar(this.year(),1,4)}function sN(){return Ar(this.isoWeekYear(),1,4)}function iN(){var n=this.localeData()._week;return Ar(this.year(),n.dow,n.doy)}function oN(){var n=this.localeData()._week;return Ar(this.weekYear(),n.dow,n.doy)}function Lx(n,e,t,r,s){var i;return n==null?Va(this,r,s).year:(i=Ar(n,r,s),e>i&&(e=i),aN.call(this,n,e,t,r,s))}function aN(n,e,t,r,s){var i=yx(n,e,t,r,s),o=La(i.year,0,i.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}G("Q",0,"Qo","quarter");W("Q",ox);Me("Q",function(n,e){e[pr]=(me(n)-1)*3});function cN(n){return n==null?Math.ceil((this.month()+1)/3):this.month((n-1)*3+this.month()%3)}G("D",["DD",2],"Do","date");W("D",ze,bo);W("DD",ze,dn);W("Do",function(n,e){return n?e._dayOfMonthOrdinalParse||e._ordinalParse:e._dayOfMonthOrdinalParseLenient});Me(["D","DD"],Un);Me("Do",function(n,e){e[Un]=me(n.match(ze)[0])});var Vx=ko("Date",!0);G("DDD",["DDDD",3],"DDDo","dayOfYear");W("DDD",Wl);W("DDDD",ax);Me(["DDD","DDDD"],function(n,e,t){t._dayOfYear=me(n)});function uN(n){var e=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return n==null?e:this.add(n-e,"d")}G("m",["mm",2],0,"minute");W("m",ze,im);W("mm",ze,dn);Me(["m","mm"],bn);var lN=ko("Minutes",!1);G("s",["ss",2],0,"second");W("s",ze,im);W("ss",ze,dn);Me(["s","ss"],gr);var hN=ko("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)});G(0,["SS",2],0,function(){return~~(this.millisecond()/10)});G(0,["SSS",3],0,"millisecond");G(0,["SSSS",4],0,function(){return this.millisecond()*10});G(0,["SSSSS",5],0,function(){return this.millisecond()*100});G(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});G(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});G(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});G(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});W("S",Wl,ox);W("SS",Wl,dn);W("SSS",Wl,ax);var jr,Ux;for(jr="SSSS";jr.length<=9;jr+="S")W(jr,Co);function dN(n,e){e[Ms]=me(("0."+n)*1e3)}for(jr="S";jr.length<=9;jr+="S")Me(jr,dN);Ux=ko("Milliseconds",!1);G("z",0,0,"zoneAbbr");G("zz",0,0,"zoneName");function fN(){return this._isUTC?"UTC":""}function mN(){return this._isUTC?"Coordinated Universal Time":""}var B=vc.prototype;B.add=oR;B.calendar=fR;B.clone=mR;B.diff=xR;B.endOf=PR;B.format=DR;B.from=AR;B.fromNow=CR;B.to=bR;B.toNow=kR;B.get=TS;B.invalidAt=UR;B.isAfter=pR;B.isBefore=gR;B.isBetween=yR;B.isSame=_R;B.isSameOrAfter=vR;B.isSameOrBefore=wR;B.isValid=LR;B.lang=Nx;B.locale=Rx;B.localeData=Mx;B.max=LP;B.min=BP;B.parsingFlags=VR;B.set=DS;B.startOf=SR;B.subtract=aR;B.toArray=OR;B.toObject=FR;B.toDate=MR;B.toISOString=IR;B.inspect=TR;typeof Symbol<"u"&&Symbol.for!=null&&(B[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});B.toJSON=BR;B.toString=ER;B.unix=NR;B.valueOf=RR;B.creationData=WR;B.eraName=YR;B.eraNarrow=zR;B.eraAbbr=GR;B.eraYear=JR;B.year=lx;B.isLeapYear=IS;B.weekYear=tN;B.isoWeekYear=nN;B.quarter=B.quarters=cN;B.month=px;B.daysInMonth=MS;B.week=B.weeks=HS;B.isoWeek=B.isoWeeks=qS;B.weeksInYear=iN;B.weeksInWeekYear=oN;B.isoWeeksInYear=rN;B.isoWeeksInISOWeekYear=sN;B.date=Vx;B.day=B.days=nP;B.weekday=rP;B.isoWeekday=sP;B.dayOfYear=uN;B.hour=B.hours=hP;B.minute=B.minutes=lN;B.second=B.seconds=hN;B.millisecond=B.milliseconds=Ux;B.utcOffset=GP;B.utc=QP;B.local=KP;B.parseZone=jP;B.hasAlignedHourOffset=XP;B.isDST=ZP;B.isLocal=tR;B.isUtcOffset=nR;B.isUtc=bx;B.isUTC=bx;B.zoneAbbr=fN;B.zoneName=mN;B.dates=En("dates accessor is deprecated. Use date instead.",Vx);B.months=En("months accessor is deprecated. Use month instead",px);B.years=En("years accessor is deprecated. Use year instead",lx);B.zone=En("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",JP);B.isDSTShifted=En("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",eR);function pN(n){return Ye(n*1e3)}function gN(){return Ye.apply(null,arguments).parseZone()}function Wx(n){return n}var Ie=em.prototype;Ie.calendar=tS;Ie.longDateFormat=iS;Ie.invalidDate=aS;Ie.ordinal=lS;Ie.preparse=Wx;Ie.postformat=Wx;Ie.relativeTime=dS;Ie.pastFuture=fS;Ie.set=Zk;Ie.eras=HR;Ie.erasParse=qR;Ie.erasConvertYear=$R;Ie.erasAbbrRegex=KR;Ie.erasNameRegex=QR;Ie.erasNarrowRegex=jR;Ie.months=SS;Ie.monthsShort=PS;Ie.monthsParse=NS;Ie.monthsRegex=FS;Ie.monthsShortRegex=OS;Ie.week=LS;Ie.firstDayOfYear=WS;Ie.firstDayOfWeek=US;Ie.weekdays=jS;Ie.weekdaysMin=ZS;Ie.weekdaysShort=XS;Ie.weekdaysParse=tP;Ie.weekdaysRegex=iP;Ie.weekdaysShortRegex=oP;Ie.weekdaysMinRegex=aP;Ie.isPM=uP;Ie.meridiem=dP;function Hu(n,e,t,r){var s=Br(),i=rr().set(r,e);return s[t](i,n)}function Hx(n,e,t){if(kr(n)&&(e=n,n=void 0),n=n||"",e!=null)return Hu(n,e,t,"month");var r,s=[];for(r=0;r<12;r++)s[r]=Hu(n,r,t,"month");return s}function _m(n,e,t,r){typeof n=="boolean"?(kr(e)&&(t=e,e=void 0),e=e||""):(e=n,t=e,n=!1,kr(e)&&(t=e,e=void 0),e=e||"");var s=Br(),i=n?s._week.dow:0,o,a=[];if(t!=null)return Hu(e,(t+i)%7,r,"day");for(o=0;o<7;o++)a[o]=Hu(e,(o+i)%7,r,"day");return a}function yN(n,e){return Hx(n,e,"months")}function _N(n,e){return Hx(n,e,"monthsShort")}function vN(n,e,t){return _m(n,e,t,"weekdays")}function wN(n,e,t){return _m(n,e,t,"weekdaysShort")}function xN(n,e,t){return _m(n,e,t,"weekdaysMin")}ns("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var e=n%10,t=me(n%100/10)===1?"th":e===1?"st":e===2?"nd":e===3?"rd":"th";return n+t}});U.lang=En("moment.lang is deprecated. Use moment.locale instead.",ns);U.langData=En("moment.langData is deprecated. Use moment.localeData instead.",Br);var or=Math.abs;function EN(){var n=this._data;return this._milliseconds=or(this._milliseconds),this._days=or(this._days),this._months=or(this._months),n.milliseconds=or(n.milliseconds),n.seconds=or(n.seconds),n.minutes=or(n.minutes),n.hours=or(n.hours),n.months=or(n.months),n.years=or(n.years),this}function qx(n,e,t,r){var s=Mn(e,t);return n._milliseconds+=r*s._milliseconds,n._days+=r*s._days,n._months+=r*s._months,n._bubble()}function IN(n,e){return qx(this,n,e,1)}function TN(n,e){return qx(this,n,e,-1)}function my(n){return n<0?Math.floor(n):Math.ceil(n)}function DN(){var n=this._milliseconds,e=this._days,t=this._months,r=this._data,s,i,o,a,c;return n>=0&&e>=0&&t>=0||n<=0&&e<=0&&t<=0||(n+=my(Yf(t)+e)*864e5,e=0,t=0),r.milliseconds=n%1e3,s=gn(n/1e3),r.seconds=s%60,i=gn(s/60),r.minutes=i%60,o=gn(i/60),r.hours=o%24,e+=gn(o/24),c=gn($x(e)),t+=c,e-=my(Yf(c)),a=gn(t/12),t%=12,r.days=e,r.months=t,r.years=a,this}function $x(n){return n*4800/146097}function Yf(n){return n*146097/4800}function AN(n){if(!this.isValid())return NaN;var e,t,r=this._milliseconds;if(n=In(n),n==="month"||n==="quarter"||n==="year")switch(e=this._days+r/864e5,t=this._months+$x(e),n){case"month":return t;case"quarter":return t/3;case"year":return t/12}else switch(e=this._days+Math.round(Yf(this._months)),n){case"week":return e/7+r/6048e5;case"day":return e+r/864e5;case"hour":return e*24+r/36e5;case"minute":return e*1440+r/6e4;case"second":return e*86400+r/1e3;case"millisecond":return Math.floor(e*864e5)+r;default:throw new Error("Unknown unit "+n)}}function Lr(n){return function(){return this.as(n)}}var Yx=Lr("ms"),CN=Lr("s"),bN=Lr("m"),kN=Lr("h"),SN=Lr("d"),PN=Lr("w"),RN=Lr("M"),NN=Lr("Q"),MN=Lr("y"),ON=Yx;function FN(){return Mn(this)}function BN(n){return n=In(n),this.isValid()?this[n+"s"]():NaN}function ii(n){return function(){return this.isValid()?this._data[n]:NaN}}var LN=ii("milliseconds"),VN=ii("seconds"),UN=ii("minutes"),WN=ii("hours"),HN=ii("days"),qN=ii("months"),$N=ii("years");function YN(){return gn(this.days()/7)}var ur=Math.round,Ci={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function zN(n,e,t,r,s){return s.relativeTime(e||1,!!t,n,r)}function GN(n,e,t,r){var s=Mn(n).abs(),i=ur(s.as("s")),o=ur(s.as("m")),a=ur(s.as("h")),c=ur(s.as("d")),u=ur(s.as("M")),l=ur(s.as("w")),d=ur(s.as("y")),f=i<=t.ss&&["s",i]||i<t.s&&["ss",i]||o<=1&&["m"]||o<t.m&&["mm",o]||a<=1&&["h"]||a<t.h&&["hh",a]||c<=1&&["d"]||c<t.d&&["dd",c];return t.w!=null&&(f=f||l<=1&&["w"]||l<t.w&&["ww",l]),f=f||u<=1&&["M"]||u<t.M&&["MM",u]||d<=1&&["y"]||["yy",d],f[2]=e,f[3]=+n>0,f[4]=r,zN.apply(null,f)}function JN(n){return n===void 0?ur:typeof n=="function"?(ur=n,!0):!1}function QN(n,e){return Ci[n]===void 0?!1:e===void 0?Ci[n]:(Ci[n]=e,n==="s"&&(Ci.ss=e-1),!0)}function KN(n,e){if(!this.isValid())return this.localeData().invalidDate();var t=!1,r=Ci,s,i;return typeof n=="object"&&(e=n,n=!1),typeof n=="boolean"&&(t=n),typeof e=="object"&&(r=Object.assign({},Ci,e),e.s!=null&&e.ss==null&&(r.ss=e.s-1)),s=this.localeData(),i=GN(this,!t,r,s),t&&(i=s.pastFuture(+this,i)),s.postformat(i)}var hd=Math.abs;function vi(n){return(n>0)-(n<0)||+n}function Ql(){if(!this.isValid())return this.localeData().invalidDate();var n=hd(this._milliseconds)/1e3,e=hd(this._days),t=hd(this._months),r,s,i,o,a=this.asSeconds(),c,u,l,d;return a?(r=gn(n/60),s=gn(r/60),n%=60,r%=60,i=gn(t/12),t%=12,o=n?n.toFixed(3).replace(/\.?0+$/,""):"",c=a<0?"-":"",u=vi(this._months)!==vi(a)?"-":"",l=vi(this._days)!==vi(a)?"-":"",d=vi(this._milliseconds)!==vi(a)?"-":"",c+"P"+(i?u+i+"Y":"")+(t?u+t+"M":"")+(e?l+e+"D":"")+(s||r||n?"T":"")+(s?d+s+"H":"")+(r?d+r+"M":"")+(n?d+o+"S":"")):"P0D"}var ye=Gl.prototype;ye.isValid=qP;ye.abs=EN;ye.add=IN;ye.subtract=TN;ye.as=AN;ye.asMilliseconds=Yx;ye.asSeconds=CN;ye.asMinutes=bN;ye.asHours=kN;ye.asDays=SN;ye.asWeeks=PN;ye.asMonths=RN;ye.asQuarters=NN;ye.asYears=MN;ye.valueOf=ON;ye._bubble=DN;ye.clone=FN;ye.get=BN;ye.milliseconds=LN;ye.seconds=VN;ye.minutes=UN;ye.hours=WN;ye.days=HN;ye.weeks=YN;ye.months=qN;ye.years=$N;ye.humanize=KN;ye.toISOString=Ql;ye.toString=Ql;ye.toJSON=Ql;ye.locale=Rx;ye.localeData=Mx;ye.toIsoString=En("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ql);ye.lang=Nx;G("X",0,0,"unix");G("x",0,0,"valueOf");W("x",ql);W("X",yS);Me("X",function(n,e,t){t._d=new Date(parseFloat(n)*1e3)});Me("x",function(n,e,t){t._d=new Date(me(n))});//! moment.js
U.version="2.30.1";jk(Ye);U.fn=B;U.min=VP;U.max=UP;U.now=WP;U.utc=rr;U.unix=pN;U.months=yN;U.isDate=_c;U.locale=ns;U.invalid=Vl;U.duration=Mn;U.isMoment=Rn;U.weekdays=vN;U.parseZone=gN;U.localeData=Br;U.isDuration=vu;U.monthsShort=_N;U.weekdaysMin=xN;U.defineLocale=lm;U.updateLocale=gP;U.locales=yP;U.weekdaysShort=wN;U.normalizeUnits=In;U.relativeTimeRounding=JN;U.relativeTimeThreshold=QN;U.calendarFormat=dR;U.prototype=B;U.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};const jN="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDU2LjY5MyA1Ni42OTMiIGhlaWdodD0iNTYuNjkzcHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1Ni42OTMgNTYuNjkzIiB3aWR0aD0iNTYuNjkzcHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik00MS43NzcsMzAuNTE3Yy0wLjA2Mi02LjIzMiw1LjA4Mi05LjIyMSw1LjMxMi05LjM3MmMtMi44OTEtNC4yMjctNy4zOTUtNC44MDctOC45OTgtNC44NzMgICBjLTMuODMtMC4zODktNy40NzcsMi4yNTYtOS40MiwyLjI1NmMtMS45MzksMC00Ljk0MS0yLjE5OS04LjExNy0yLjE0M2MtNC4xNzgsMC4wNjItOC4wMjksMi40My0xMC4xNzksNi4xNyAgIGMtNC4zMzksNy41MjctMS4xMSwxOC42ODIsMy4xMTgsMjQuNzkxYzIuMDY3LDIuOTg2LDQuNTMyLDYuMzQ2LDcuNzY2LDYuMjIzYzMuMTE3LTAuMTIzLDQuMjkzLTIuMDE2LDguMDYxLTIuMDE2ICAgczQuODI2LDIuMDE2LDguMTIzLDEuOTUzYzMuMzUyLTAuMDYxLDUuNDc3LTMuMDQzLDcuNTI3LTYuMDQxYzIuMzczLTMuNDY5LDMuMzUtNi44MjgsMy40MDgtNi45OTggICBDNDguMzA1LDQwLjQzMyw0MS44NDQsMzcuOTU4LDQxLjc3NywzMC41MTd6Ii8+PHBhdGggZD0iTTM1LjU4MiwxMi4yMjljMS43MTUtMi4wODIsMi44NzctNC45NzUsMi41NjEtNy44NTVjLTIuNDc1LDAuMS01LjQ3MSwxLjY0NS03LjI0OCwzLjcyNSAgIGMtMS41OTIsMS44NDYtMi45ODQsNC43ODUtMi42MTEsNy42MTNDMzEuMDQ1LDE1LjkyNiwzMy44NjEsMTQuMzA3LDM1LjU4MiwxMi4yMjl6Ii8+PC9nPjwvc3ZnPg==",XN="data:image/svg+xml,%3c?xml%20version='1.0'%20?%3e%3csvg%20id='Layer_1'%20style='enable-background:new%200%200%201000%201000;'%20version='1.1'%20viewBox='0%200%201000%201000'%20xml:space='preserve'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%233B579D;}%20.st1{fill:%23FFFFFF;}%20%3c/style%3e%3ctitle/%3e%3cg%3e%3cpath%20class='st0'%20d='M500,1000L500,1000C223.9,1000,0,776.1,0,500v0C0,223.9,223.9,0,500,0h0c276.1,0,500,223.9,500,500v0%20C1000,776.1,776.1,1000,500,1000z'/%3e%3cpath%20class='st1'%20d='M630,1000V612.7h130l19.5-150.9H630v-96.4c0-43.7,12.1-73.5,74.8-73.5l79.9,0V157%20c-13.8-1.8-61.3-5.9-116.5-5.9c-115.2,0-194.1,70.3-194.1,199.5v111.3H343.8v150.9h130.3V1000H630z'%20id='f'/%3e%3c/g%3e%3c/svg%3e",ZN="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyOCAxMjgiIGlkPSJTb2NpYWxfSWNvbnMiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnIGlkPSJfeDMxX19zdHJva2UiPjxnIGlkPSJHb29nbGUiPjxyZWN0IGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBoZWlnaHQ9IjEyOCIgd2lkdGg9IjEyOCIvPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI3LjU4NSw2NGMwLTQuMTU3LDAuNjktOC4xNDMsMS45MjMtMTEuODgxTDcuOTM4LDM1LjY0OCAgICBDMy43MzQsNDQuMTgzLDEuMzY2LDUzLjgwMSwxLjM2Niw2NGMwLDEwLjE5MSwyLjM2NiwxOS44MDIsNi41NjMsMjguMzMybDIxLjU1OC0xNi41MDNDMjguMjY2LDcyLjEwOCwyNy41ODUsNjguMTM3LDI3LjU4NSw2NCIgZmlsbD0iI0ZCQkMwNSIgZmlsbC1ydWxlPSJldmVub2RkIi8+PHBhdGggY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNjUuNDU3LDI2LjE4MmM5LjAzMSwwLDE3LjE4OCwzLjIsMjMuNTk3LDguNDM2TDEwNy42OTgsMTYgICAgQzk2LjMzNyw2LjEwOSw4MS43NzEsMCw2NS40NTcsMEM0MC4xMjksMCwxOC4zNjEsMTQuNDg0LDcuOTM4LDM1LjY0OGwyMS41NjksMTYuNDcxQzM0LjQ3NywzNy4wMzMsNDguNjQ0LDI2LjE4Miw2NS40NTcsMjYuMTgyIiBmaWxsPSIjRUE0MzM1IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik02NS40NTcsMTAxLjgxOGMtMTYuODEyLDAtMzAuOTc5LTEwLjg1MS0zNS45NDktMjUuOTM3ICAgIEw3LjkzOCw5Mi4zNDlDMTguMzYxLDExMy41MTYsNDAuMTI5LDEyOCw2NS40NTcsMTI4YzE1LjYzMiwwLDMwLjU1Ny01LjU1MSw0MS43NTgtMTUuOTUxTDg2Ljc0MSw5Ni4yMjEgICAgQzgwLjk2NCw5OS44Niw3My42ODksMTAxLjgxOCw2NS40NTcsMTAxLjgxOCIgZmlsbD0iIzM0QTg1MyIgZmlsbC1ydWxlPSJldmVub2RkIi8+PHBhdGggY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTI2LjYzNCw2NGMwLTMuNzgyLTAuNTgzLTcuODU1LTEuNDU3LTExLjYzNkg2NS40NTd2MjQuNzI3ICAgIGgzNC4zNzZjLTEuNzE5LDguNDMxLTYuMzk3LDE0LjkxMi0xMy4wOTIsMTkuMTNsMjAuNDc0LDE1LjgyOEMxMTguOTgxLDEwMS4xMjksMTI2LjYzNCw4NC44NjEsMTI2LjYzNCw2NCIgZmlsbD0iIzQyODVGNCIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9nPjwvZz48L3N2Zz4=";var zx=(n=>(n[n.Apple=0]="Apple",n[n.Google=1]="Google",n[n.Facebook=2]="Facebook",n[n.Phone=3]="Phone",n))(zx||{});const M5={0:"Apple",1:"Google",2:"Facebook",3:"Phone"},O5=[1,2,0,3],py={Apple:0,Google:1,Facebook:2,Phone:3},F5={0:jN,1:ZN,2:XN,3:"Phone"},B5={0:"apple.com",1:"google.com",2:"facebook.com",3:"phone"};var eM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},V,vm=vm||{},ne=eM||self;function Kl(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Ec(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function tM(n){return Object.prototype.hasOwnProperty.call(n,dd)&&n[dd]||(n[dd]=++nM)}var dd="closure_uid_"+(1e9*Math.random()>>>0),nM=0;function rM(n,e,t){return n.call.apply(n.bind,arguments)}function sM(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function Wt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Wt=rM:Wt=sM,Wt.apply(null,arguments)}function ru(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function xt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function vs(){this.s=this.s,this.o=this.o}var iM=0;vs.prototype.s=!1;vs.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),iM!=0)&&tM(this)};vs.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Gx=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function wm(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function gy(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Kl(r)){const s=n.length||0,i=r.length||0;n.length=s+i;for(let o=0;o<i;o++)n[s+o]=r[o]}else n.push(r)}}function Ht(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ht.prototype.h=function(){this.defaultPrevented=!0};var oM=function(){if(!ne.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};ne.addEventListener("test",t,e),ne.removeEventListener("test",t,e)}catch{}return n}();function Wa(n){return/^[\s\xa0]*$/.test(n)}function jl(){var n=ne.navigator;return n&&(n=n.userAgent)?n:""}function Wn(n){return jl().indexOf(n)!=-1}function xm(n){return xm[" "](n),n}xm[" "]=function(){};function aM(n,e){var t=ZM;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var cM=Wn("Opera"),eo=Wn("Trident")||Wn("MSIE"),Jx=Wn("Edge"),zf=Jx||eo,Qx=Wn("Gecko")&&!(jl().toLowerCase().indexOf("webkit")!=-1&&!Wn("Edge"))&&!(Wn("Trident")||Wn("MSIE"))&&!Wn("Edge"),uM=jl().toLowerCase().indexOf("webkit")!=-1&&!Wn("Edge");function Kx(){var n=ne.document;return n?n.documentMode:void 0}var Gf;e:{var fd="",md=function(){var n=jl();if(Qx)return/rv:([^\);]+)(\)|;)/.exec(n);if(Jx)return/Edge\/([\d\.]+)/.exec(n);if(eo)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(uM)return/WebKit\/(\S+)/.exec(n);if(cM)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(md&&(fd=md?md[1]:""),eo){var pd=Kx();if(pd!=null&&pd>parseFloat(fd)){Gf=String(pd);break e}}Gf=fd}var Jf;if(ne.document&&eo){var yy=Kx();Jf=yy||parseInt(Gf,10)||void 0}else Jf=void 0;var lM=Jf;function Ha(n,e){if(Ht.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Qx){e:{try{xm(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:hM[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Ha.$.h.call(this)}}xt(Ha,Ht);var hM={2:"touch",3:"pen",4:"mouse"};Ha.prototype.h=function(){Ha.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ic="closure_listenable_"+(1e6*Math.random()|0),dM=0;function fM(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=s,this.key=++dM,this.fa=this.ia=!1}function Xl(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Em(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function mM(n,e){for(const t in n)e.call(void 0,n[t],t,n)}function jx(n){const e={};for(const t in n)e[t]=n[t];return e}const _y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xx(n,e){let t,r;for(let s=1;s<arguments.length;s++){r=arguments[s];for(t in r)n[t]=r[t];for(let i=0;i<_y.length;i++)t=_y[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Zl(n){this.src=n,this.g={},this.h=0}Zl.prototype.add=function(n,e,t,r,s){var i=n.toString();n=this.g[i],n||(n=this.g[i]=[],this.h++);var o=Kf(n,e,r,s);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new fM(e,this.src,i,!!r,s),e.ia=t,n.push(e)),e};function Qf(n,e){var t=e.type;if(t in n.g){var r=n.g[t],s=Gx(r,e),i;(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Xl(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Kf(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.fa&&i.listener==e&&i.capture==!!t&&i.la==r)return s}return-1}var Im="closure_lm_"+(1e6*Math.random()|0),gd={};function Zx(n,e,t,r,s){if(r&&r.once)return tE(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Zx(n,e[i],t,r,s);return null}return t=Am(t),n&&n[Ic]?n.O(e,t,Ec(r)?!!r.capture:!!r,s):eE(n,e,t,!1,r,s)}function eE(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=Ec(s)?!!s.capture:!!s,a=Dm(n);if(a||(n[Im]=a=new Zl(n)),t=a.add(e,t,r,o,i),t.proxy)return t;if(r=pM(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)oM||(s=o),s===void 0&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(rE(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function pM(){function n(t){return e.call(n.src,n.listener,t)}const e=gM;return n}function tE(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)tE(n,e[i],t,r,s);return null}return t=Am(t),n&&n[Ic]?n.P(e,t,Ec(r)?!!r.capture:!!r,s):eE(n,e,t,!0,r,s)}function nE(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)nE(n,e[i],t,r,s);else r=Ec(r)?!!r.capture:!!r,t=Am(t),n&&n[Ic]?(n=n.i,e=String(e).toString(),e in n.g&&(i=n.g[e],t=Kf(i,t,r,s),-1<t&&(Xl(i[t]),Array.prototype.splice.call(i,t,1),i.length==0&&(delete n.g[e],n.h--)))):n&&(n=Dm(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Kf(e,t,r,s)),(t=-1<n?e[n]:null)&&Tm(t))}function Tm(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[Ic])Qf(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(rE(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Dm(e))?(Qf(t,n),t.h==0&&(t.src=null,e[Im]=null)):Xl(n)}}}function rE(n){return n in gd?gd[n]:gd[n]="on"+n}function gM(n,e){if(n.fa)n=!0;else{e=new Ha(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Tm(n),n=t.call(r,e)}return n}function Dm(n){return n=n[Im],n instanceof Zl?n:null}var yd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Am(n){return typeof n=="function"?n:(n[yd]||(n[yd]=function(e){return n.handleEvent(e)}),n[yd])}function wt(){vs.call(this),this.i=new Zl(this),this.S=this,this.J=null}xt(wt,vs);wt.prototype[Ic]=!0;wt.prototype.removeEventListener=function(n,e,t,r){nE(this,n,e,t,r)};function kt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new Ht(e,n);else if(e instanceof Ht)e.target=e.target||n;else{var s=e;e=new Ht(r,n),Xx(e,s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=su(o,r,!0,e)&&s}if(o=e.g=n,s=su(o,r,!0,e)&&s,s=su(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)o=e.g=t[i],s=su(o,r,!1,e)&&s}wt.prototype.N=function(){if(wt.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Xl(t[r]);delete n.g[e],n.h--}}this.J=null};wt.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};wt.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function su(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==t){var a=o.listener,c=o.la||o.src;o.ia&&Qf(n.i,o),s=a.call(c,r)!==!1&&s}}return s&&!r.defaultPrevented}var Cm=ne.JSON.stringify;class yM{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function _M(){var n=bm;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class vM{constructor(){this.h=this.g=null}add(e,t){const r=sE.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var sE=new yM(()=>new wM,n=>n.reset());class wM{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function xM(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function EM(n){ne.setTimeout(()=>{throw n},0)}let qa,$a=!1,bm=new vM,iE=()=>{const n=ne.Promise.resolve(void 0);qa=()=>{n.then(IM)}};var IM=()=>{for(var n;n=_M();){try{n.h.call(n.g)}catch(t){EM(t)}var e=sE;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}$a=!1};function eh(n,e){wt.call(this),this.h=n||1,this.g=e||ne,this.j=Wt(this.qb,this),this.l=Date.now()}xt(eh,wt);V=eh.prototype;V.ga=!1;V.T=null;V.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),kt(this,"tick"),this.ga&&(km(this),this.start()))}};V.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function km(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}V.N=function(){eh.$.N.call(this),km(this),delete this.g};function Sm(n,e,t){if(typeof n=="function")t&&(n=Wt(n,t));else if(n&&typeof n.handleEvent=="function")n=Wt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ne.setTimeout(n,e||0)}function oE(n){n.g=Sm(()=>{n.g=null,n.i&&(n.i=!1,oE(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class TM extends vs{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:oE(this)}N(){super.N(),this.g&&(ne.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ya(n){vs.call(this),this.h=n,this.g={}}xt(Ya,vs);var vy=[];function aE(n,e,t,r){Array.isArray(t)||(t&&(vy[0]=t.toString()),t=vy);for(var s=0;s<t.length;s++){var i=Zx(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function cE(n){Em(n.g,function(e,t){this.g.hasOwnProperty(t)&&Tm(e)},n),n.g={}}Ya.prototype.N=function(){Ya.$.N.call(this),cE(this)};Ya.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function th(){this.g=!0}th.prototype.Ea=function(){this.g=!1};function DM(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var d=l.split("_");o=2<=d.length&&d[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+`
`+t+`
`+o})}function AM(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+`
`+t+`
`+i+" "+o})}function bi(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+bM(n,t)+(r?" "+r:"")})}function CM(n,e){n.info(function(){return"TIMEOUT: "+e})}th.prototype.info=function(){};function bM(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return Cm(t)}catch{return e}}var oi={},wy=null;function nh(){return wy=wy||new wt}oi.Ta="serverreachability";function uE(n){Ht.call(this,oi.Ta,n)}xt(uE,Ht);function za(n){const e=nh();kt(e,new uE(e))}oi.STAT_EVENT="statevent";function lE(n,e){Ht.call(this,oi.STAT_EVENT,n),this.stat=e}xt(lE,Ht);function Gt(n){const e=nh();kt(e,new lE(e,n))}oi.Ua="timingevent";function hE(n,e){Ht.call(this,oi.Ua,n),this.size=e}xt(hE,Ht);function Tc(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return ne.setTimeout(function(){n()},e)}var rh={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},dE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Pm(){}Pm.prototype.h=null;function xy(n){return n.h||(n.h=n.i())}function fE(){}var Dc={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Rm(){Ht.call(this,"d")}xt(Rm,Ht);function Nm(){Ht.call(this,"c")}xt(Nm,Ht);var jf;function sh(){}xt(sh,Pm);sh.prototype.g=function(){return new XMLHttpRequest};sh.prototype.i=function(){return{}};jf=new sh;function Ac(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Ya(this),this.P=kM,n=zf?125:void 0,this.V=new eh(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new mE}function mE(){this.i=null,this.g="",this.h=!1}var kM=45e3,pE={},Xf={};V=Ac.prototype;V.setTimeout=function(n){this.P=n};function Zf(n,e,t){n.L=1,n.A=oh(Sr(e)),n.u=t,n.S=!0,gE(n,null)}function gE(n,e){n.G=Date.now(),Cc(n),n.B=Sr(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),TE(t.i,"t",r),n.o=0,t=n.l.J,n.h=new mE,n.g=YE(n.l,t?e:null,!n.u),0<n.O&&(n.M=new TM(Wt(n.Pa,n,n.g),n.O)),aE(n.U,n.g,"readystatechange",n.nb),e=n.I?jx(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),za(),DM(n.j,n.v,n.B,n.m,n.W,n.u)}V.nb=function(n){n=n.target;const e=this.M;e&&Hn(n)==3?e.l():this.Pa(n)};V.Pa=function(n){try{if(n==this.g)e:{const l=Hn(this.g);var e=this.g.Ia();const d=this.g.da();if(!(3>l)&&(l!=3||zf||this.g&&(this.h.h||this.g.ja()||Dy(this.g)))){this.J||l!=4||e==7||(e==8||0>=d?za(3):za(2)),ih(this);var t=this.g.da();this.ca=t;t:if(yE(this)){var r=Dy(this.g);n="";var s=r.length,i=Hn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Os(this),ga(this);var o="";break t}this.h.i=new ne.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,AM(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Wa(a)){var u=a;break t}}u=null}if(t=u)bi(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,e0(this,t);else{this.i=!1,this.s=3,Gt(12),Os(this),ga(this);break e}}this.S?(_E(this,l,o),zf&&this.i&&l==3&&(aE(this.U,this.V,"tick",this.mb),this.V.start())):(bi(this.j,this.m,o,null),e0(this,o)),l==4&&Os(this),this.i&&!this.J&&(l==4?WE(this.l,this):(this.i=!1,Cc(this)))}else KM(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Gt(12)):(this.s=0,Gt(13)),Os(this),ga(this)}}}catch{}finally{}};function yE(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function _E(n,e,t){let r=!0,s;for(;!n.J&&n.o<t.length;)if(s=SM(n,t),s==Xf){e==4&&(n.s=4,Gt(14),r=!1),bi(n.j,n.m,null,"[Incomplete Response]");break}else if(s==pE){n.s=4,Gt(15),bi(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else bi(n.j,n.m,s,null),e0(n,s);yE(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Gt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Vm(e),e.M=!0,Gt(11))):(bi(n.j,n.m,t,"[Invalid Chunked Response]"),Os(n),ga(n))}V.mb=function(){if(this.g){var n=Hn(this.g),e=this.g.ja();this.o<e.length&&(ih(this),_E(this,n,e),this.i&&n!=4&&Cc(this))}};function SM(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Xf:(t=Number(e.substring(t,r)),isNaN(t)?pE:(r+=1,r+t>e.length?Xf:(e=e.slice(r,r+t),n.o=r+t,e)))}V.cancel=function(){this.J=!0,Os(this)};function Cc(n){n.Y=Date.now()+n.P,vE(n,n.P)}function vE(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Tc(Wt(n.lb,n),e)}function ih(n){n.C&&(ne.clearTimeout(n.C),n.C=null)}V.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(CM(this.j,this.B),this.L!=2&&(za(),Gt(17)),Os(this),this.s=2,ga(this)):vE(this,this.Y-n)};function ga(n){n.l.H==0||n.J||WE(n.l,n)}function Os(n){ih(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,km(n.V),cE(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function e0(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||t0(t.i,n))){if(!n.K&&t0(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var s=r;if(s[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Yu(t),lh(t);else break e;Lm(t),Gt(18)}}else t.Fa=s[1],0<t.Fa-t.V&&37500>s[2]&&t.G&&t.A==0&&!t.v&&(t.v=Tc(Wt(t.ib,t),6e3));if(1>=CE(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Fs(t,11)}else if((n.K||t.g==n)&&Yu(t),!Wa(e))for(s=t.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(t.V=u[0],u=u[1],t.H==2)if(u[0]=="c"){t.K=u[1],t.pa=u[2];const l=u[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));const d=u[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));const f=u[5];f!=null&&typeof f=="number"&&0<f&&(r=1.5*f,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const m=n.g;if(m){const p=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var i=r.i;i.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(Mm(i,i.h),i.h=null))}if(r.F){const y=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;y&&(r.Da=y,$e(r.I,r.F,y))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=$E(r,r.J?r.pa:null,r.Y),o.K){bE(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(ih(a),Cc(a)),r.g=o}else VE(r);0<t.j.length&&hh(t)}else u[0]!="stop"&&u[0]!="close"||Fs(t,7);else t.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Fs(t,7):Bm(t):u[0]!="noop"&&t.h&&t.h.Aa(u),t.A=0)}}za(4)}catch{}}function PM(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Kl(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function RM(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Kl(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}function wE(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Kl(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=RM(n),r=PM(n),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}var xE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function NM(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Ws(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ws){this.h=n.h,qu(this,n.j),this.s=n.s,this.g=n.g,$u(this,n.m),this.l=n.l;var e=n.i,t=new Ga;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ey(this,t),this.o=n.o}else n&&(e=String(n).match(xE))?(this.h=!1,qu(this,e[1]||"",!0),this.s=aa(e[2]||""),this.g=aa(e[3]||"",!0),$u(this,e[4]),this.l=aa(e[5]||"",!0),Ey(this,e[6]||"",!0),this.o=aa(e[7]||"")):(this.h=!1,this.i=new Ga(null,this.h))}Ws.prototype.toString=function(){var n=[],e=this.j;e&&n.push(ca(e,Iy,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(ca(e,Iy,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(ca(t,t.charAt(0)=="/"?FM:OM,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",ca(t,LM)),n.join("")};function Sr(n){return new Ws(n)}function qu(n,e,t){n.j=t?aa(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function $u(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ey(n,e,t){e instanceof Ga?(n.i=e,VM(n.i,n.h)):(t||(e=ca(e,BM)),n.i=new Ga(e,n.h))}function $e(n,e,t){n.i.set(e,t)}function oh(n){return $e(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function aa(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ca(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,MM),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function MM(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Iy=/[#\/\?@]/g,OM=/[#\?:]/g,FM=/[#\?]/g,BM=/[#\?@]/g,LM=/#/g;function Ga(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function ws(n){n.g||(n.g=new Map,n.h=0,n.i&&NM(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}V=Ga.prototype;V.add=function(n,e){ws(this),this.i=null,n=So(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function EE(n,e){ws(n),e=So(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function IE(n,e){return ws(n),e=So(n,e),n.g.has(e)}V.forEach=function(n,e){ws(this),this.g.forEach(function(t,r){t.forEach(function(s){n.call(e,s,r,this)},this)},this)};V.ta=function(){ws(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const s=n[r];for(let i=0;i<s.length;i++)t.push(e[r])}return t};V.Z=function(n){ws(this);let e=[];if(typeof n=="string")IE(this,n)&&(e=e.concat(this.g.get(So(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};V.set=function(n,e){return ws(this),this.i=null,n=So(this,n),IE(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};V.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function TE(n,e,t){EE(n,e),0<t.length&&(n.i=null,n.g.set(So(n,e),wm(t)),n.h+=t.length)}V.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;o[r]!==""&&(s+="="+encodeURIComponent(String(o[r]))),n.push(s)}}return this.i=n.join("&")};function So(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function VM(n,e){e&&!n.j&&(ws(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(EE(this,r),TE(this,s,t))},n)),n.j=e}var UM=class{constructor(n,e){this.g=n,this.map=e}};function DE(n){this.l=n||WM,ne.PerformanceNavigationTiming?(n=ne.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(ne.g&&ne.g.Ka&&ne.g.Ka()&&ne.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var WM=10;function AE(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function CE(n){return n.h?1:n.g?n.g.size:0}function t0(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Mm(n,e){n.g?n.g.add(e):n.h=e}function bE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}DE.prototype.cancel=function(){if(this.i=kE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function kE(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return wm(n.i)}var HM=class{stringify(n){return ne.JSON.stringify(n,void 0)}parse(n){return ne.JSON.parse(n,void 0)}};function qM(){this.g=new HM}function $M(n,e,t){const r=t||"";try{wE(n,function(s,i){let o=s;Ec(s)&&(o=Cm(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function YM(n,e){const t=new th;if(ne.Image){const r=new Image;r.onload=ru(iu,t,r,"TestLoadImage: loaded",!0,e),r.onerror=ru(iu,t,r,"TestLoadImage: error",!1,e),r.onabort=ru(iu,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=ru(iu,t,r,"TestLoadImage: timeout",!1,e),ne.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function iu(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch{}}function ah(n){this.l=n.ec||null,this.j=n.ob||!1}xt(ah,Pm);ah.prototype.g=function(){return new ch(this.l,this.j)};ah.prototype.i=function(n){return function(){return n}}({});function ch(n,e){wt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Om,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}xt(ch,wt);var Om=0;V=ch.prototype;V.open=function(n,e){if(this.readyState!=Om)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ja(this)};V.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||ne).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};V.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bc(this)),this.readyState=Om};V.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ja(this)),this.g&&(this.readyState=3,Ja(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof ne.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;SE(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function SE(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}V.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?bc(this):Ja(this),this.readyState==3&&SE(this)}};V.Za=function(n){this.g&&(this.response=this.responseText=n,bc(this))};V.Ya=function(n){this.g&&(this.response=n,bc(this))};V.ka=function(){this.g&&bc(this)};function bc(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ja(n)}V.setRequestHeader=function(n,e){this.v.append(n,e)};V.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};V.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Ja(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(ch.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var zM=ne.JSON.parse;function rt(n){wt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=PE,this.L=this.M=!1}xt(rt,wt);var PE="",GM=/^https?$/i,JM=["POST","PUT"];V=rt.prototype;V.Oa=function(n){this.M=n};V.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():jf.g(),this.C=this.u?xy(this.u):xy(jf),this.g.onreadystatechange=Wt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(i){Ty(this,i);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)t.set(s,r[s]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const i of r.keys())t.set(i,r.get(i));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(i=>i.toLowerCase()=="content-type"),s=ne.FormData&&n instanceof ne.FormData,!(0<=Gx(JM,e))||r||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ME(this),0<this.B&&((this.L=QM(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Wt(this.ua,this)):this.A=Sm(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Ty(this,i)}};function QM(n){return eo&&typeof n.timeout=="number"&&n.ontimeout!==void 0}V.ua=function(){typeof vm<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,kt(this,"timeout"),this.abort(8))};function Ty(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,RE(n),uh(n)}function RE(n){n.F||(n.F=!0,kt(n,"complete"),kt(n,"error"))}V.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,kt(this,"complete"),kt(this,"abort"),uh(this))};V.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),uh(this,!0)),rt.$.N.call(this)};V.La=function(){this.s||(this.G||this.v||this.l?NE(this):this.kb())};V.kb=function(){NE(this)};function NE(n){if(n.h&&typeof vm<"u"&&(!n.C[1]||Hn(n)!=4||n.da()!=2)){if(n.v&&Hn(n)==4)Sm(n.La,0,n);else if(kt(n,"readystatechange"),Hn(n)==4){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var s=String(n.I).match(xE)[1]||null;!s&&ne.self&&ne.self.location&&(s=ne.self.location.protocol.slice(0,-1)),r=!GM.test(s?s.toLowerCase():"")}t=r}if(t)kt(n,"complete"),kt(n,"success");else{n.m=6;try{var i=2<Hn(n)?n.g.statusText:""}catch{i=""}n.j=i+" ["+n.da()+"]",RE(n)}}finally{uh(n)}}}}function uh(n,e){if(n.g){ME(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||kt(n,"ready");try{t.onreadystatechange=r}catch{}}}function ME(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(ne.clearTimeout(n.A),n.A=null)}V.isActive=function(){return!!this.g};function Hn(n){return n.g?n.g.readyState:0}V.da=function(){try{return 2<Hn(this)?this.g.status:-1}catch{return-1}};V.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};V.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),zM(e)}};function Dy(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case PE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function KM(n){const e={};n=(n.g&&2<=Hn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Wa(n[r]))continue;var t=xM(n[r]);const s=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const i=e[s]||[];e[s]=i,i.push(t)}mM(e,function(r){return r.join(", ")})}V.Ia=function(){return this.m};V.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function OE(n){let e="";return Em(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Fm(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=OE(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):$e(n,e,t))}function ea(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function FE(n){this.Ga=0,this.j=[],this.l=new th,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ea("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ea("baseRetryDelayMs",5e3,n),this.hb=ea("retryDelaySeedMs",1e4,n),this.eb=ea("forwardChannelMaxRetries",2,n),this.xa=ea("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new DE(n&&n.concurrentRequestLimit),this.Ja=new qM,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}V=FE.prototype;V.ra=8;V.H=1;function Bm(n){if(BE(n),n.H==3){var e=n.W++,t=Sr(n.I);if($e(t,"SID",n.K),$e(t,"RID",e),$e(t,"TYPE","terminate"),kc(n,t),e=new Ac(n,n.l,e),e.L=2,e.A=oh(Sr(t)),t=!1,ne.navigator&&ne.navigator.sendBeacon)try{t=ne.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&ne.Image&&(new Image().src=e.A,t=!0),t||(e.g=YE(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Cc(e)}qE(n)}function lh(n){n.g&&(Vm(n),n.g.cancel(),n.g=null)}function BE(n){lh(n),n.u&&(ne.clearTimeout(n.u),n.u=null),Yu(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&ne.clearTimeout(n.m),n.m=null)}function hh(n){if(!AE(n.i)&&!n.m){n.m=!0;var e=n.Na;qa||iE(),$a||(qa(),$a=!0),bm.add(e,n),n.C=0}}function jM(n,e){return CE(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Tc(Wt(n.Na,n,e),HE(n,n.C)),n.C++,!0)}V.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const s=new Ac(this,this.l,n);let i=this.s;if(this.U&&(i?(i=jx(i),Xx(i,this.U)):i=this.U),this.o!==null||this.O||(s.I=i,i=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=LE(this,s,e),t=Sr(this.I),$e(t,"RID",n),$e(t,"CVER",22),this.F&&$e(t,"X-HTTP-Session-Id",this.F),kc(this,t),i&&(this.O?e="headers="+encodeURIComponent(String(OE(i)))+"&"+e:this.o&&Fm(t,this.o,i)),Mm(this.i,s),this.bb&&$e(t,"TYPE","init"),this.P?($e(t,"$req",e),$e(t,"SID","null"),s.aa=!0,Zf(s,t,null)):Zf(s,t,e),this.H=2}}else this.H==3&&(n?Ay(this,n):this.j.length==0||AE(this.i)||Ay(this))};function Ay(n,e){var t;e?t=e.m:t=n.W++;const r=Sr(n.I);$e(r,"SID",n.K),$e(r,"RID",t),$e(r,"AID",n.V),kc(n,r),n.o&&n.s&&Fm(r,n.o,n.s),t=new Ac(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=LE(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Mm(n.i,t),Zf(t,r,e)}function kc(n,e){n.na&&Em(n.na,function(t,r){$e(e,r,t)}),n.h&&wE({},function(t,r){$e(e,r,t)})}function LE(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Wt(n.h.Va,n.h,n):null;e:{var s=n.j;let i=-1;for(;;){const o=["count="+t];i==-1?0<t?(i=s[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let c=0;c<t;c++){let u=s[c].g;const l=s[c].map;if(u-=i,0>u)i=Math.max(0,s[c].g-100),a=!1;else try{$M(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function VE(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;qa||iE(),$a||(qa(),$a=!0),bm.add(e,n),n.A=0}}function Lm(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Tc(Wt(n.Ma,n),HE(n,n.A)),n.A++,!0)}V.Ma=function(){if(this.u=null,UE(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Tc(Wt(this.jb,this),n)}};V.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Gt(10),lh(this),UE(this))};function Vm(n){n.B!=null&&(ne.clearTimeout(n.B),n.B=null)}function UE(n){n.g=new Ac(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=Sr(n.wa);$e(e,"RID","rpc"),$e(e,"SID",n.K),$e(e,"AID",n.V),$e(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&$e(e,"TO",n.qa),$e(e,"TYPE","xmlhttp"),kc(n,e),n.o&&n.s&&Fm(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=oh(Sr(e)),t.u=null,t.S=!0,gE(t,n)}V.ib=function(){this.v!=null&&(this.v=null,lh(this),Lm(this),Gt(19))};function Yu(n){n.v!=null&&(ne.clearTimeout(n.v),n.v=null)}function WE(n,e){var t=null;if(n.g==e){Yu(n),Vm(n),n.g=null;var r=2}else if(t0(n.i,e))t=e.F,bE(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var s=n.C;r=nh(),kt(r,new hE(r,t)),hh(n)}else VE(n);else if(s=e.s,s==3||s==0&&0<e.ca||!(r==1&&jM(n,e)||r==2&&Lm(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Fs(n,5);break;case 4:Fs(n,10);break;case 3:Fs(n,6);break;default:Fs(n,2)}}}function HE(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Fs(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Wt(n.pb,n);t||(t=new Ws("//www.google.com/images/cleardot.gif"),ne.location&&ne.location.protocol=="http"||qu(t,"https"),oh(t)),YM(t.toString(),r)}else Gt(2);n.H=0,n.h&&n.h.za(e),qE(n),BE(n)}V.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Gt(2)):(this.l.info("Failed to ping google.com"),Gt(1))};function qE(n){if(n.H=0,n.ma=[],n.h){const e=kE(n.i);(e.length!=0||n.j.length!=0)&&(gy(n.ma,e),gy(n.ma,n.j),n.i.i.length=0,wm(n.j),n.j.length=0),n.h.ya()}}function $E(n,e,t){var r=t instanceof Ws?Sr(t):new Ws(t);if(r.g!="")e&&(r.g=e+"."+r.g),$u(r,r.m);else{var s=ne.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Ws(null);r&&qu(i,r),e&&(i.g=e),s&&$u(i,s),t&&(i.l=t),r=i}return t=n.F,e=n.Da,t&&e&&$e(r,t,e),$e(r,"VER",n.ra),kc(n,r),r}function YE(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new rt(new ah({ob:t})):new rt(n.va),e.Oa(n.J),e}V.isActive=function(){return!!this.h&&this.h.isActive(this)};function zE(){}V=zE.prototype;V.Ba=function(){};V.Aa=function(){};V.za=function(){};V.ya=function(){};V.isActive=function(){return!0};V.Va=function(){};function zu(){if(eo&&!(10<=Number(lM)))throw Error("Environmental error: no available transport.")}zu.prototype.g=function(n,e){return new hn(n,e)};function hn(n,e){wt.call(this),this.g=new FE(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Wa(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Wa(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Po(this)}xt(hn,wt);hn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Gt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=$E(n,null,n.Y),hh(n)};hn.prototype.close=function(){Bm(this.g)};hn.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Cm(n),n=t);e.j.push(new UM(e.fb++,n)),e.H==3&&hh(e)};hn.prototype.N=function(){this.g.h=null,delete this.j,Bm(this.g),delete this.g,hn.$.N.call(this)};function GE(n){Rm.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}xt(GE,Rm);function JE(){Nm.call(this),this.status=1}xt(JE,Nm);function Po(n){this.g=n}xt(Po,zE);Po.prototype.Ba=function(){kt(this.g,"a")};Po.prototype.Aa=function(n){kt(this.g,new GE(n))};Po.prototype.za=function(n){kt(this.g,new JE)};Po.prototype.ya=function(){kt(this.g,"b")};function XM(){this.blockSize=-1}function Nn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}xt(Nn,XM);Nn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function _d(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var s=0;16>s;++s)r[s]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(s=0;16>s;++s)r[s]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],s=n.g[2];var i=n.g[3],o=e+(i^t&(s^i))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=i+(s^e&(t^s))+r[1]+3905402710&4294967295,i=e+(o<<12&4294967295|o>>>20),o=s+(t^i&(e^t))+r[2]+606105819&4294967295,s=i+(o<<17&4294967295|o>>>15),o=t+(e^s&(i^e))+r[3]+3250441966&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(i^t&(s^i))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=i+(s^e&(t^s))+r[5]+1200080426&4294967295,i=e+(o<<12&4294967295|o>>>20),o=s+(t^i&(e^t))+r[6]+2821735955&4294967295,s=i+(o<<17&4294967295|o>>>15),o=t+(e^s&(i^e))+r[7]+4249261313&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(i^t&(s^i))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=i+(s^e&(t^s))+r[9]+2336552879&4294967295,i=e+(o<<12&4294967295|o>>>20),o=s+(t^i&(e^t))+r[10]+4294925233&4294967295,s=i+(o<<17&4294967295|o>>>15),o=t+(e^s&(i^e))+r[11]+2304563134&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(i^t&(s^i))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=i+(s^e&(t^s))+r[13]+4254626195&4294967295,i=e+(o<<12&4294967295|o>>>20),o=s+(t^i&(e^t))+r[14]+2792965006&4294967295,s=i+(o<<17&4294967295|o>>>15),o=t+(e^s&(i^e))+r[15]+1236535329&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(s^i&(t^s))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=i+(t^s&(e^t))+r[6]+3225465664&4294967295,i=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(i^e))+r[11]+643717713&4294967295,s=i+(o<<14&4294967295|o>>>18),o=t+(i^e&(s^i))+r[0]+3921069994&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(s^i&(t^s))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=i+(t^s&(e^t))+r[10]+38016083&4294967295,i=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(i^e))+r[15]+3634488961&4294967295,s=i+(o<<14&4294967295|o>>>18),o=t+(i^e&(s^i))+r[4]+3889429448&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(s^i&(t^s))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=i+(t^s&(e^t))+r[14]+3275163606&4294967295,i=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(i^e))+r[3]+4107603335&4294967295,s=i+(o<<14&4294967295|o>>>18),o=t+(i^e&(s^i))+r[8]+1163531501&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(s^i&(t^s))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=i+(t^s&(e^t))+r[2]+4243563512&4294967295,i=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(i^e))+r[7]+1735328473&4294967295,s=i+(o<<14&4294967295|o>>>18),o=t+(i^e&(s^i))+r[12]+2368359562&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(t^s^i)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=i+(e^t^s)+r[8]+2272392833&4294967295,i=e+(o<<11&4294967295|o>>>21),o=s+(i^e^t)+r[11]+1839030562&4294967295,s=i+(o<<16&4294967295|o>>>16),o=t+(s^i^e)+r[14]+4259657740&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(t^s^i)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=i+(e^t^s)+r[4]+1272893353&4294967295,i=e+(o<<11&4294967295|o>>>21),o=s+(i^e^t)+r[7]+4139469664&4294967295,s=i+(o<<16&4294967295|o>>>16),o=t+(s^i^e)+r[10]+3200236656&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(t^s^i)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=i+(e^t^s)+r[0]+3936430074&4294967295,i=e+(o<<11&4294967295|o>>>21),o=s+(i^e^t)+r[3]+3572445317&4294967295,s=i+(o<<16&4294967295|o>>>16),o=t+(s^i^e)+r[6]+76029189&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(t^s^i)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=i+(e^t^s)+r[12]+3873151461&4294967295,i=e+(o<<11&4294967295|o>>>21),o=s+(i^e^t)+r[15]+530742520&4294967295,s=i+(o<<16&4294967295|o>>>16),o=t+(s^i^e)+r[2]+3299628645&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(s^(t|~i))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=i+(t^(e|~s))+r[7]+1126891415&4294967295,i=e+(o<<10&4294967295|o>>>22),o=s+(e^(i|~t))+r[14]+2878612391&4294967295,s=i+(o<<15&4294967295|o>>>17),o=t+(i^(s|~e))+r[5]+4237533241&4294967295,t=s+(o<<21&4294967295|o>>>11),o=e+(s^(t|~i))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=i+(t^(e|~s))+r[3]+2399980690&4294967295,i=e+(o<<10&4294967295|o>>>22),o=s+(e^(i|~t))+r[10]+4293915773&4294967295,s=i+(o<<15&4294967295|o>>>17),o=t+(i^(s|~e))+r[1]+2240044497&4294967295,t=s+(o<<21&4294967295|o>>>11),o=e+(s^(t|~i))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=i+(t^(e|~s))+r[15]+4264355552&4294967295,i=e+(o<<10&4294967295|o>>>22),o=s+(e^(i|~t))+r[6]+2734768916&4294967295,s=i+(o<<15&4294967295|o>>>17),o=t+(i^(s|~e))+r[13]+1309151649&4294967295,t=s+(o<<21&4294967295|o>>>11),o=e+(s^(t|~i))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=i+(t^(e|~s))+r[11]+3174756917&4294967295,i=e+(o<<10&4294967295|o>>>22),o=s+(e^(i|~t))+r[2]+718787259&4294967295,s=i+(o<<15&4294967295|o>>>17),o=t+(i^(s|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+s&4294967295,n.g[3]=n.g[3]+i&4294967295}Nn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(s==0)for(;i<=t;)_d(this,n,i),i+=this.blockSize;if(typeof n=="string"){for(;i<e;)if(r[s++]=n.charCodeAt(i++),s==this.blockSize){_d(this,r),s=0;break}}else for(;i<e;)if(r[s++]=n[i++],s==this.blockSize){_d(this,r),s=0;break}}this.h=s,this.i+=e};Nn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function Pe(n,e){this.h=e;for(var t=[],r=!0,s=n.length-1;0<=s;s--){var i=n[s]|0;r&&i==e||(t[s]=i,r=!1)}this.g=t}var ZM={};function Um(n){return-128<=n&&128>n?aM(n,function(e){return new Pe([e|0],0>e?-1:0)}):new Pe([n|0],0>n?-1:0)}function qn(n){if(isNaN(n)||!isFinite(n))return Fi;if(0>n)return Dt(qn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=n0;return new Pe(e,0)}function QE(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Dt(QE(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=qn(Math.pow(e,8)),r=Fi,s=0;s<n.length;s+=8){var i=Math.min(8,n.length-s),o=parseInt(n.substring(s,s+i),e);8>i?(i=qn(Math.pow(e,i)),r=r.R(i).add(qn(o))):(r=r.R(t),r=r.add(qn(o)))}return r}var n0=4294967296,Fi=Um(0),r0=Um(1),Cy=Um(16777216);V=Pe.prototype;V.ea=function(){if(yn(this))return-Dt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:n0+r)*e,e*=n0}return n};V.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(yr(this))return"0";if(yn(this))return"-"+Dt(this).toString(n);for(var e=qn(Math.pow(n,6)),t=this,r="";;){var s=Ju(t,e).g;t=Gu(t,s.R(e));var i=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=s,yr(t))return i+r;for(;6>i.length;)i="0"+i;r=i+r}};V.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function yr(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function yn(n){return n.h==-1}V.X=function(n){return n=Gu(this,n),yn(n)?-1:yr(n)?0:1};function Dt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new Pe(t,~n.h).add(r0)}V.abs=function(){return yn(this)?Dt(this):this};V.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,s=0;s<=e;s++){var i=r+(this.D(s)&65535)+(n.D(s)&65535),o=(i>>>16)+(this.D(s)>>>16)+(n.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,t[s]=o<<16|i}return new Pe(t,t[t.length-1]&-2147483648?-1:0)};function Gu(n,e){return n.add(Dt(e))}V.R=function(n){if(yr(this)||yr(n))return Fi;if(yn(this))return yn(n)?Dt(this).R(Dt(n)):Dt(Dt(this).R(n));if(yn(n))return Dt(this.R(Dt(n)));if(0>this.X(Cy)&&0>n.X(Cy))return qn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<n.g.length;s++){var i=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(s)>>>16,c=n.D(s)&65535;t[2*r+2*s]+=o*c,ou(t,2*r+2*s),t[2*r+2*s+1]+=i*c,ou(t,2*r+2*s+1),t[2*r+2*s+1]+=o*a,ou(t,2*r+2*s+1),t[2*r+2*s+2]+=i*a,ou(t,2*r+2*s+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new Pe(t,0)};function ou(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ta(n,e){this.g=n,this.h=e}function Ju(n,e){if(yr(e))throw Error("division by zero");if(yr(n))return new ta(Fi,Fi);if(yn(n))return e=Ju(Dt(n),e),new ta(Dt(e.g),Dt(e.h));if(yn(e))return e=Ju(n,Dt(e)),new ta(Dt(e.g),e.h);if(30<n.g.length){if(yn(n)||yn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=r0,r=e;0>=r.X(n);)t=by(t),r=by(r);var s=wi(t,1),i=wi(r,1);for(r=wi(r,2),t=wi(t,2);!yr(r);){var o=i.add(r);0>=o.X(n)&&(s=s.add(t),i=o),r=wi(r,1),t=wi(t,1)}return e=Gu(n,s.R(e)),new ta(s,e)}for(s=Fi;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),i=qn(t),o=i.R(e);yn(o)||0<o.X(n);)t-=r,i=qn(t),o=i.R(e);yr(i)&&(i=r0),s=s.add(i),n=Gu(n,o)}return new ta(s,n)}V.gb=function(n){return Ju(this,n).h};V.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new Pe(t,this.h&n.h)};V.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new Pe(t,this.h|n.h)};V.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new Pe(t,this.h^n.h)};function by(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new Pe(t,n.h)}function wi(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,s=[],i=0;i<r;i++)s[i]=0<e?n.D(i+t)>>>e|n.D(i+t+1)<<32-e:n.D(i+t);return new Pe(s,n.h)}zu.prototype.createWebChannel=zu.prototype.g;hn.prototype.send=hn.prototype.u;hn.prototype.open=hn.prototype.m;hn.prototype.close=hn.prototype.close;rh.NO_ERROR=0;rh.TIMEOUT=8;rh.HTTP_ERROR=6;dE.COMPLETE="complete";fE.EventType=Dc;Dc.OPEN="a";Dc.CLOSE="b";Dc.ERROR="c";Dc.MESSAGE="d";wt.prototype.listen=wt.prototype.O;rt.prototype.listenOnce=rt.prototype.P;rt.prototype.getLastError=rt.prototype.Sa;rt.prototype.getLastErrorCode=rt.prototype.Ia;rt.prototype.getStatus=rt.prototype.da;rt.prototype.getResponseJson=rt.prototype.Wa;rt.prototype.getResponseText=rt.prototype.ja;rt.prototype.send=rt.prototype.ha;rt.prototype.setWithCredentials=rt.prototype.Oa;Nn.prototype.digest=Nn.prototype.l;Nn.prototype.reset=Nn.prototype.reset;Nn.prototype.update=Nn.prototype.j;Pe.prototype.add=Pe.prototype.add;Pe.prototype.multiply=Pe.prototype.R;Pe.prototype.modulo=Pe.prototype.gb;Pe.prototype.compare=Pe.prototype.X;Pe.prototype.toNumber=Pe.prototype.ea;Pe.prototype.toString=Pe.prototype.toString;Pe.prototype.getBits=Pe.prototype.D;Pe.fromNumber=qn;Pe.fromString=QE;var e4=function(){return new zu},t4=function(){return nh()},vd=rh,n4=dE,r4=oi,ky={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},au=fE,s4=rt,i4=Nn,Bi=Pe;const Sy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ot.UNAUTHENTICATED=new Ot(null),Ot.GOOGLE_CREDENTIALS=new Ot("google-credentials-uid"),Ot.FIRST_PARTY=new Ot("first-party-uid"),Ot.MOCK_USER=new Ot("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ro="10.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Js=new Ml("@firebase/firestore");function na(){return Js.logLevel}function H(n,...e){if(Js.logLevel<=de.DEBUG){const t=e.map(Wm);Js.debug(`Firestore (${Ro}): ${n}`,...t)}}function Pr(n,...e){if(Js.logLevel<=de.ERROR){const t=e.map(Wm);Js.error(`Firestore (${Ro}): ${n}`,...t)}}function to(n,...e){if(Js.logLevel<=de.WARN){const t=e.map(Wm);Js.warn(`Firestore (${Ro}): ${n}`,...t)}}function Wm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j(n="Unexpected state"){const e=`FIRESTORE (${Ro}) INTERNAL ASSERTION FAILED: `+n;throw Pr(e),new Error(e)}function Ce(n,e){n||j()}function se(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends Fr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class o4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ot.UNAUTHENTICATED))}shutdown(){}}class a4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class c4{constructor(e){this.t=e,this.currentUser=Ot.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new zn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new zn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new zn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ce(typeof r.accessToken=="string"),new KE(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ce(e===null||typeof e=="string"),new Ot(e)}}class u4{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ot.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class l4{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new u4(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class h4{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class d4{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=i=>{i.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,H("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ce(typeof t.token=="string"),this.R=t.token,new h4(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=f4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Te(n,e){return n<e?-1:n>e?1:0}function no(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new q(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Fe.fromMillis(Date.now())}static fromDate(e){return Fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Fe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Te(this.nanoseconds,e.nanoseconds):Te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new te(e)}static min(){return new te(new Fe(0,0))}static max(){return new te(new Fe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,t,r){t===void 0?t=0:t>e.length&&j(),r===void 0?r=e.length-t:r>e.length-t&&j(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Qa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qa?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Qe extends Qa{construct(e,t,r){return new Qe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new q(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Qe(t)}static emptyPath(){return new Qe([])}}const m4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ct extends Qa{construct(e,t,r){return new Ct(e,t,r)}static isValidIdentifier(e){return m4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ct.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ct(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new q(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new q(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new q(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new q(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ct(t)}static emptyPath(){return new Ct([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.path=e}static fromPath(e){return new J(Qe.fromString(e))}static fromName(e){return new J(Qe.fromString(e).popFirst(5))}static empty(){return new J(Qe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Qe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Qe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new Qe(e.slice()))}}function p4(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=te.fromTimestamp(r===1e9?new Fe(t+1,0):new Fe(t,r));return new hs(s,J.empty(),e)}function g4(n){return new hs(n.readTime,n.key,-1)}class hs{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hs(te.min(),J.empty(),-1)}static max(){return new hs(te.max(),J.empty(),-1)}}function y4(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=J.comparator(n.documentKey,e.documentKey),t!==0?t:Te(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class v4{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sc(n){if(n.code!==R.FAILED_PRECONDITION||n.message!==_4)throw n;H("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,r)=>{t(e)})}static reject(e){return new M((t,r)=>{r(e)})}static waitFor(e){return new M((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},c=>r(c))}),o=!0,i===s&&t()})}static or(e){let t=M.resolve(!1);for(const r of e)t=t.next(s=>s?M.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new M((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let c=0;c<i;c++){const u=c;t(e[u]).next(l=>{o[u]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(e,t){return new M((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function Pc(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hm{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.se(r),this.oe=r=>t.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}Hm._e=-1;function Rc(n){return n==null}function Qu(n){return n===0&&1/n==-1/0}function w4(n){return typeof n=="number"&&Number.isInteger(n)&&!Qu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Py(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ai(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function XE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ut=class s0{constructor(e,t){this.comparator=e,this.root=t||rs.EMPTY}insert(e,t){return new s0(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rs.BLACK,null,null))}remove(e){return new s0(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cu(this.root,e,this.comparator,!1)}getReverseIterator(){return new cu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cu(this.root,e,this.comparator,!0)}},cu=class{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},rs=class ar{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??ar.RED,this.left=s??ar.EMPTY,this.right=i??ar.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ar(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ar.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return ar.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ar.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ar.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();const e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}};rs.EMPTY=null,rs.RED=!0,rs.BLACK=!1;rs.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,r,s,i){return this}insert(e,t,r){return new rs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e){this.comparator=e,this.data=new ut(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ry(this.data.getIterator())}getIteratorFrom(e){return new Ry(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof St)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new St(this.comparator);return t.data=e,t}}class Ry{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.fields=e,e.sort(Ct.comparator)}static empty(){return new un([])}unionWith(e){let t=new St(Ct.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new un(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return no(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ZE("Invalid base64 string: "+i):i}}(e);return new $t(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new $t(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$t.EMPTY_BYTE_STRING=new $t("");const x4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ds(n){if(Ce(!!n),typeof n=="string"){let e=0;const t=x4.exec(n);if(Ce(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ct(n.seconds),nanos:ct(n.nanos)}}function ct(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Qs(n){return typeof n=="string"?$t.fromBase64String(n):$t.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qm(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function $m(n){const e=n.mapValue.fields.__previous_value__;return qm(e)?$m(e):e}function Ka(n){const e=ds(n.mapValue.fields.__local_write_time__.timestampValue);return new Fe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4{constructor(e,t,r,s,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}}class ja{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ja("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ja&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ks(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qm(n)?4:I4(n)?9007199254740991:10:j()}function Zn(n,e){if(n===e)return!0;const t=Ks(n);if(t!==Ks(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ka(n).isEqual(Ka(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ds(s.timestampValue),a=ds(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Qs(s.bytesValue).isEqual(Qs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return ct(s.geoPointValue.latitude)===ct(i.geoPointValue.latitude)&&ct(s.geoPointValue.longitude)===ct(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ct(s.integerValue)===ct(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=ct(s.doubleValue),a=ct(i.doubleValue);return o===a?Qu(o)===Qu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return no(n.arrayValue.values||[],e.arrayValue.values||[],Zn);case 10:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Py(o)!==Py(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Zn(o[c],a[c])))return!1;return!0}(n,e);default:return j()}}function Xa(n,e){return(n.values||[]).find(t=>Zn(t,e))!==void 0}function ro(n,e){if(n===e)return 0;const t=Ks(n),r=Ks(e);if(t!==r)return Te(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Te(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=ct(i.integerValue||i.doubleValue),c=ct(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return Ny(n.timestampValue,e.timestampValue);case 4:return Ny(Ka(n),Ka(e));case 5:return Te(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Qs(i),c=Qs(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){const l=Te(a[u],c[u]);if(l!==0)return l}return Te(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Te(ct(i.latitude),ct(o.latitude));return a!==0?a:Te(ct(i.longitude),ct(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,o){const a=i.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){const l=ro(a[u],c[u]);if(l)return l}return Te(a.length,c.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,o){if(i===uu.mapValue&&o===uu.mapValue)return 0;if(i===uu.mapValue)return 1;if(o===uu.mapValue)return-1;const a=i.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let d=0;d<c.length&&d<l.length;++d){const f=Te(c[d],l[d]);if(f!==0)return f;const m=ro(a[c[d]],u[l[d]]);if(m!==0)return m}return Te(c.length,l.length)}(n.mapValue,e.mapValue);default:throw j()}}function Ny(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Te(n,e);const t=ds(n),r=ds(e),s=Te(t.seconds,r.seconds);return s!==0?s:Te(t.nanos,r.nanos)}function so(n){return i0(n)}function i0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ds(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Qs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return J.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=i0(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${i0(t.fields[o])}`;return s+"}"}(n.mapValue):j()}function o0(n){return!!n&&"integerValue"in n}function Ym(n){return!!n&&"arrayValue"in n}function My(n){return!!n&&"nullValue"in n}function Oy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xu(n){return!!n&&"mapValue"in n}function ya(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return ai(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ya(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ya(n.arrayValue.values[t]);return e}return Object.assign({},n)}function I4(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e){this.value=e}static empty(){return new zt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!xu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ya(t)}setAll(e){let t=Ct.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=ya(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());xu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Zn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];xu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){ai(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new zt(ya(this.value))}}function e1(n){const e=[];return ai(n.fields,(t,r)=>{const s=new Ct([t]);if(xu(r)){const i=e1(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new un(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new _t(e,0,te.min(),te.min(),te.min(),zt.empty(),0)}static newFoundDocument(e,t,r,s){return new _t(e,1,t,te.min(),r,s,0)}static newNoDocument(e,t){return new _t(e,2,t,te.min(),te.min(),zt.empty(),0)}static newUnknownDocument(e,t){return new _t(e,3,t,te.min(),te.min(),zt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e,t){this.position=e,this.inclusive=t}}function Fy(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=J.comparator(J.fromName(o.referenceValue),t.key):r=ro(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function By(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Zn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t="asc"){this.field=e,this.dir=t}}function T4(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{}class ft extends t1{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new A4(e,t,r):t==="array-contains"?new k4(e,r):t==="in"?new S4(e,r):t==="not-in"?new P4(e,r):t==="array-contains-any"?new R4(e,r):new ft(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new C4(e,r):new b4(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ro(t,this.value)):t!==null&&Ks(this.value)===Ks(t)&&this.matchesComparison(ro(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class er extends t1{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new er(e,t)}matches(e){return n1(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function n1(n){return n.op==="and"}function r1(n){return D4(n)&&n1(n)}function D4(n){for(const e of n.filters)if(e instanceof er)return!1;return!0}function a0(n){if(n instanceof ft)return n.field.canonicalString()+n.op.toString()+so(n.value);if(r1(n))return n.filters.map(e=>a0(e)).join(",");{const e=n.filters.map(t=>a0(t)).join(",");return`${n.op}(${e})`}}function s1(n,e){return n instanceof ft?function(r,s){return s instanceof ft&&r.op===s.op&&r.field.isEqual(s.field)&&Zn(r.value,s.value)}(n,e):n instanceof er?function(r,s){return s instanceof er&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&s1(o,s.filters[a]),!0):!1}(n,e):void j()}function i1(n){return n instanceof ft?function(t){return`${t.field.canonicalString()} ${t.op} ${so(t.value)}`}(n):n instanceof er?function(t){return t.op.toString()+" {"+t.getFilters().map(i1).join(" ,")+"}"}(n):"Filter"}class A4 extends ft{constructor(e,t,r){super(e,t,r),this.key=J.fromName(r.referenceValue)}matches(e){const t=J.comparator(e.key,this.key);return this.matchesComparison(t)}}class C4 extends ft{constructor(e,t){super(e,"in",t),this.keys=o1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class b4 extends ft{constructor(e,t){super(e,"not-in",t),this.keys=o1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function o1(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>J.fromName(r.referenceValue))}class k4 extends ft{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ym(t)&&Xa(t.arrayValue,this.value)}}class S4 extends ft{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Xa(this.value.arrayValue,t)}}class P4 extends ft{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Xa(this.value.arrayValue,t)}}class R4 extends ft{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ym(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xa(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ce=null}}function Ly(n,e=null,t=[],r=[],s=null,i=null,o=null){return new N4(n,e,t,r,s,i,o)}function zm(n){const e=se(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>a0(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Rc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>so(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>so(r)).join(",")),e.ce=t}return e.ce}function Gm(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!T4(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!s1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!By(n.startAt,e.startAt)&&By(n.endAt,e.endAt)}function c0(n){return J.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function M4(n,e,t,r,s,i,o,a){return new dh(n,e,t,r,s,i,o,a)}function fh(n){return new dh(n)}function Vy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function O4(n){return n.collectionGroup!==null}function _a(n){const e=se(n);if(e.le===null){e.le=[];const t=new Set;for(const i of e.explicitOrderBy)e.le.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new St(Ct.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.le.push(new ju(i,r))}),t.has(Ct.keyField().canonicalString())||e.le.push(new ju(Ct.keyField(),r))}return e.le}function Gn(n){const e=se(n);return e.he||(e.he=F4(e,_a(n))),e.he}function F4(n,e){if(n.limitType==="F")return Ly(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ju(s.field,i)});const t=n.endAt?new Ku(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ku(n.startAt.position,n.startAt.inclusive):null;return Ly(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function u0(n,e,t){return new dh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function mh(n,e){return Gm(Gn(n),Gn(e))&&n.limitType===e.limitType}function a1(n){return`${zm(Gn(n))}|lt:${n.limitType}`}function Ii(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>i1(s)).join(", ")}]`),Rc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>so(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>so(s)).join(",")),`Target(${r})`}(Gn(n))}; limitType=${n.limitType})`}function ph(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):J.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of _a(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,c){const u=Fy(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,_a(r),s)||r.endAt&&!function(o,a,c){const u=Fy(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,_a(r),s))}(n,e)}function B4(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function c1(n){return(e,t)=>{let r=!1;for(const s of _a(n)){const i=L4(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function L4(n,e,t){const r=n.field.isKeyField()?J.comparator(e.key,t.key):function(i,o,a){const c=o.data.field(i),u=a.data.field(i);return c!==null&&u!==null?ro(c,u):j()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return j()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ai(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return XE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V4=new ut(J.comparator);function Rr(){return V4}const u1=new ut(J.comparator);function ua(...n){let e=u1;for(const t of n)e=e.insert(t.key,t);return e}function l1(n){let e=u1;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Bs(){return va()}function h1(){return va()}function va(){return new No(n=>n.toString(),(n,e)=>n.isEqual(e))}const U4=new ut(J.comparator),W4=new St(J.comparator);function fe(...n){let e=W4;for(const t of n)e=e.add(t);return e}const H4=new St(Te);function q4(){return H4}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qu(e)?"-0":e}}function f1(n){return{integerValue:""+n}}function m1(n,e){return w4(e)?f1(e):d1(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(){this._=void 0}}function $4(n,e,t){return n instanceof Xu?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&qm(i)&&(i=$m(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof io?g1(n,e):n instanceof oo?y1(n,e):function(s,i){const o=p1(s,i),a=Uy(o)+Uy(s.Ie);return o0(o)&&o0(s.Ie)?f1(a):d1(s.serializer,a)}(n,e)}function Y4(n,e,t){return n instanceof io?g1(n,e):n instanceof oo?y1(n,e):t}function p1(n,e){return n instanceof Za?function(r){return o0(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Xu extends gh{}class io extends gh{constructor(e){super(),this.elements=e}}function g1(n,e){const t=_1(e);for(const r of n.elements)t.some(s=>Zn(s,r))||t.push(r);return{arrayValue:{values:t}}}class oo extends gh{constructor(e){super(),this.elements=e}}function y1(n,e){let t=_1(e);for(const r of n.elements)t=t.filter(s=>!Zn(s,r));return{arrayValue:{values:t}}}class Za extends gh{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Uy(n){return ct(n.integerValue||n.doubleValue)}function _1(n){return Ym(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e,t){this.field=e,this.transform=t}}function z4(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof io&&s instanceof io||r instanceof oo&&s instanceof oo?no(r.elements,s.elements,Zn):r instanceof Za&&s instanceof Za?Zn(r.Ie,s.Ie):r instanceof Xu&&s instanceof Xu}(n.transform,e.transform)}class G4{constructor(e,t){this.version=e,this.transformResults=t}}class Lt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Lt}static exists(e){return new Lt(void 0,e)}static updateTime(e){return new Lt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Eu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yh{}function v1(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new _h(n.key,Lt.none()):new Nc(n.key,n.data,Lt.none());{const t=n.data,r=zt.empty();let s=new St(Ct.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new xs(n.key,r,new un(s.toArray()),Lt.none())}}function J4(n,e,t){n instanceof Nc?function(s,i,o){const a=s.value.clone(),c=Hy(s.fieldTransforms,i,o.transformResults);a.setAll(c),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof xs?function(s,i,o){if(!Eu(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Hy(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(w1(s)),c.setAll(a),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function wa(n,e,t,r){return n instanceof Nc?function(i,o,a,c){if(!Eu(i.precondition,o))return a;const u=i.value.clone(),l=qy(i.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof xs?function(i,o,a,c){if(!Eu(i.precondition,o))return a;const u=qy(i.fieldTransforms,c,o),l=o.data;return l.setAll(w1(i)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(d=>d.field))}(n,e,t,r):function(i,o,a){return Eu(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function Q4(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=p1(r.transform,s||null);i!=null&&(t===null&&(t=zt.empty()),t.set(r.field,i))}return t||null}function Wy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&no(r,s,(i,o)=>z4(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Nc extends yh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class xs extends yh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function w1(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Hy(n,e,t){const r=new Map;Ce(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Y4(o,a,t[s]))}return r}function qy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,$4(i,o,e))}return r}class _h extends yh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class x1 extends yh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&J4(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=wa(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=wa(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=h1();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const c=v1(o,a);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),fe())}isEqual(e){return this.batchId===e.batchId&&no(this.mutations,e.mutations,(t,r)=>Wy(t,r))&&no(this.baseMutations,e.baseMutations,(t,r)=>Wy(t,r))}}class Qm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ce(e.mutations.length===r.length);let s=function(){return U4}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Qm(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var at,ge;function E1(n){switch(n){default:return j();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function I1(n){if(n===void 0)return Pr("GRPC error has no .code"),R.UNKNOWN;switch(n){case at.OK:return R.OK;case at.CANCELLED:return R.CANCELLED;case at.UNKNOWN:return R.UNKNOWN;case at.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case at.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case at.INTERNAL:return R.INTERNAL;case at.UNAVAILABLE:return R.UNAVAILABLE;case at.UNAUTHENTICATED:return R.UNAUTHENTICATED;case at.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case at.NOT_FOUND:return R.NOT_FOUND;case at.ALREADY_EXISTS:return R.ALREADY_EXISTS;case at.PERMISSION_DENIED:return R.PERMISSION_DENIED;case at.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case at.ABORTED:return R.ABORTED;case at.OUT_OF_RANGE:return R.OUT_OF_RANGE;case at.UNIMPLEMENTED:return R.UNIMPLEMENTED;case at.DATA_LOSS:return R.DATA_LOSS;default:return j()}}(ge=at||(at={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z4(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO=new Bi([4294967295,4294967295],0);function $y(n){const e=Z4().encode(n),t=new i4;return t.update(e),new Uint8Array(t.digest())}function Yy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Bi([t,r],0),new Bi([s,i],0)]}class Km{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new la(`Invalid padding: ${t}`);if(r<0)throw new la(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new la(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new la(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Bi.fromNumber(this.Te)}de(e,t,r){let s=e.add(t.multiply(Bi.fromNumber(r)));return s.compare(eO)===1&&(s=new Bi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=$y(e),[r,s]=Yy(t);for(let i=0;i<this.hashCount;i++){const o=this.de(r,s,i);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Km(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const t=$y(e),[r,s]=Yy(t);for(let i=0;i<this.hashCount;i++){const o=this.de(r,s,i);this.Re(o)}}Re(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class la extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Mc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new vh(te.min(),s,new ut(Te),Rr(),fe())}}class Mc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Mc(r,t,fe(),fe(),fe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e,t,r,s){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=s}}class T1{constructor(e,t){this.targetId=e,this.fe=t}}class D1{constructor(e,t,r=$t.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class zy{constructor(){this.ge=0,this.pe=Jy(),this.ye=$t.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=fe(),t=fe(),r=fe();return this.pe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:j()}}),new Mc(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Jy()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,Ce(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class tO{constructor(e){this.Le=e,this.ke=new Map,this.qe=Rr(),this.Qe=Gy(),this.Ke=new ut(Te)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,s)=>{this.je(s)&&t(s)})}Je(e){const t=e.targetId,r=e.fe.count,s=this.Ye(t);if(s){const i=s.target;if(c0(i))if(r===0){const o=new J(i.path);this.We(t,o,_t.newNoDocument(o,te.min()))}else Ce(r===1);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,u)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Qs(r).toUint8Array()}catch(c){if(c instanceof ZE)return to("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Km(o,s,i)}catch(c){return to(c instanceof la?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.We(t,i,null),s++)}),s}it(e){const t=new Map;this.ke.forEach((i,o)=>{const a=this.Ye(o);if(a){if(i.current&&c0(a.target)){const c=new J(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,_t.newNoDocument(c,e))}i.De&&(t.set(o,i.ve()),i.Fe())}});let r=fe();this.Qe.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.qe.forEach((i,o)=>o.setReadTime(e));const s=new vh(e,t,this.Ke,this.qe,r);return this.qe=Rr(),this.Qe=Gy(),this.Ke=new ut(Te),s}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const s=this.ze(e);this.st(e,t)?s.Me(t,1):s.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new zy,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new St(Te),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||H("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new zy),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Gy(){return new ut(J.comparator)}function Jy(){return new ut(J.comparator)}const nO={asc:"ASCENDING",desc:"DESCENDING"},rO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sO={and:"AND",or:"OR"};class iO{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function l0(n,e){return n.useProto3Json||Rc(e)?e:{value:e}}function Zu(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function A1(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function oO(n,e){return Zu(n,e.toTimestamp())}function ln(n){return Ce(!!n),te.fromTimestamp(function(t){const r=ds(t);return new Fe(r.seconds,r.nanos)}(n))}function jm(n,e){return function(r){return new Qe(["projects",r.projectId,"databases",r.database])}(n).child("documents").child(e).canonicalString()}function C1(n){const e=Qe.fromString(n);return Ce(R1(e)),e}function el(n,e){return jm(n.databaseId,e.path)}function xa(n,e){const t=C1(e);if(t.get(1)!==n.databaseId.projectId)throw new q(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new J(b1(t))}function h0(n,e){return jm(n.databaseId,e)}function aO(n){const e=C1(n);return e.length===4?Qe.emptyPath():b1(e)}function ec(n){return new Qe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function b1(n){return Ce(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Qy(n,e,t){return{name:el(n,e),fields:t.value.mapValue.fields}}function cO(n,e){return"found"in e?function(r,s){Ce(!!s.found),s.found.name,s.found.updateTime;const i=xa(r,s.found.name),o=ln(s.found.updateTime),a=s.found.createTime?ln(s.found.createTime):te.min(),c=new zt({mapValue:{fields:s.found.fields}});return _t.newFoundDocument(i,o,a,c)}(n,e):"missing"in e?function(r,s){Ce(!!s.missing),Ce(!!s.readTime);const i=xa(r,s.missing),o=ln(s.readTime);return _t.newNoDocument(i,o)}(n,e):j()}function uO(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:j()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,l){return u.useProto3Json?(Ce(l===void 0||typeof l=="string"),$t.fromBase64String(l||"")):(Ce(l===void 0||l instanceof Uint8Array),$t.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const l=u.code===void 0?R.UNKNOWN:I1(u.code);return new q(l,u.message||"")}(o);t=new D1(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=xa(n,r.document.name),i=ln(r.document.updateTime),o=r.document.createTime?ln(r.document.createTime):te.min(),a=new zt({mapValue:{fields:r.document.fields}}),c=_t.newFoundDocument(s,i,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];t=new Iu(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=xa(n,r.document),i=r.readTime?ln(r.readTime):te.min(),o=_t.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Iu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=xa(n,r.document),i=r.removedTargetIds||[];t=new Iu([],i,s,null)}else{if(!("filter"in e))return j();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new X4(s,i),a=r.targetId;t=new T1(a,o)}}return t}function k1(n,e){let t;if(e instanceof Nc)t={update:Qy(n,e.key,e.value)};else if(e instanceof _h)t={delete:el(n,e.key)};else if(e instanceof xs)t={update:Qy(n,e.key,e.data),updateMask:_O(e.fieldMask)};else{if(!(e instanceof x1))return j();t={verify:el(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Xu)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof io)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof oo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Za)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw j()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:oO(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:j()}(n,e.precondition)),t}function lO(n,e){return n&&n.length>0?(Ce(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?ln(s.updateTime):ln(i);return o.isEqual(te.min())&&(o=ln(i)),new G4(o,s.transformResults||[])}(t,e))):[]}function hO(n,e){return{documents:[h0(n,e.path)]}}function dO(n,e){const t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=h0(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=h0(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(c){if(c.length!==0)return P1(er.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const i=function(c){if(c.length!==0)return c.map(u=>function(d){return{field:Ti(d.field),direction:pO(d.dir)}}(u))}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=l0(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function fO(n){let e=aO(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ce(r===1);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=function(d){const f=S1(d);return f instanceof er&&r1(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(d){return d.map(f=>function(p){return new ju(Di(p.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(d){let f;return f=typeof d=="object"?d.value:d,Rc(f)?null:f}(t.limit));let c=null;t.startAt&&(c=function(d){const f=!!d.before,m=d.values||[];return new Ku(m,f)}(t.startAt));let u=null;return t.endAt&&(u=function(d){const f=!d.before,m=d.values||[];return new Ku(m,f)}(t.endAt)),M4(e,s,o,i,a,"F",c,u)}function mO(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function S1(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Di(t.unaryFilter.field);return ft.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Di(t.unaryFilter.field);return ft.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Di(t.unaryFilter.field);return ft.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Di(t.unaryFilter.field);return ft.create(o,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(n):n.fieldFilter!==void 0?function(t){return ft.create(Di(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return er.create(t.compositeFilter.filters.map(r=>S1(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return j()}}(t.compositeFilter.op))}(n):j()}function pO(n){return nO[n]}function gO(n){return rO[n]}function yO(n){return sO[n]}function Ti(n){return{fieldPath:n.canonicalString()}}function Di(n){return Ct.fromServerFormat(n.fieldPath)}function P1(n){return n instanceof ft?function(t){if(t.op==="=="){if(Oy(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NAN"}};if(My(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Oy(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NOT_NAN"}};if(My(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ti(t.field),op:gO(t.op),value:t.value}}}(n):n instanceof er?function(t){const r=t.getFilters().map(s=>P1(s));return r.length===1?r[0]:{compositeFilter:{op:yO(t.op),filters:r}}}(n):j()}function _O(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function R1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e,t,r,s,i=te.min(),o=te.min(),a=$t.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new Xr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(e){this.ut=e}}function wO(n){const e=fO({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?u0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{constructor(){this.on=new EO}addToCollectionParentIndex(e,t){return this.on.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(hs.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(hs.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class EO{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new St(Qe.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new St(Qe.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new ao(0)}static Nn(){return new ao(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(){this.changes=new No(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TO{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DO{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&wa(r.mutation,s,un.empty(),Fe.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,fe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=fe()){const s=Bs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ua();return i.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Bs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,fe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Rr();const o=va(),a=function(){return va()}();return t.forEach((c,u)=>{const l=r.get(u.key);s.has(u.key)&&(l===void 0||l.mutation instanceof xs)?i=i.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),wa(l.mutation,u,l.mutation.getFieldMask(),Fe.now())):o.set(u.key,un.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((u,l)=>o.set(u,l)),t.forEach((u,l)=>{var d;return a.set(u,new TO(l,(d=o.get(u))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){const r=va();let s=new ut((o,a)=>o-a),i=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let l=r.get(c)||un.empty();l=a.applyToLocalView(u,l),r.set(c,l);const d=(s.get(a.batchId)||fe()).add(c);s=s.insert(a.batchId,d)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,l=c.value,d=h1();l.forEach(f=>{if(!i.has(f)){const m=v1(t.get(f),r.get(f));m!==null&&d.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return J.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):O4(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):M.resolve(Bs());let a=-1,c=i;return o.next(u=>M.forEach(u,(l,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(l)?M.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{c=c.insert(l,f)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,c,u,fe())).next(l=>({batchId:a,changes:l1(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new J(t)).next(r=>{let s=ua();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=ua();return this.indexManager.getCollectionParents(e,i).next(a=>M.forEach(a,c=>{const u=function(d,f){return new dh(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(l=>{l.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((c,u)=>{const l=u.getKey();o.get(l)===null&&(o=o.insert(l,_t.newInvalidDocument(l)))});let a=ua();return o.forEach((c,u)=>{const l=i.get(c);l!==void 0&&wa(l.mutation,u,un.empty(),Fe.now()),ph(t,u)&&(a=a.insert(c,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return M.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(s){return{id:s.id,version:s.version,createTime:ln(s.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(s){return{name:s.name,query:wO(s.bundledQuery),readTime:ln(s.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(){this.overlays=new ut(J.comparator),this.lr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Bs();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.lt(e,t,i)}),M.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.lr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.lr.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){const s=Bs(),i=t.length+1,o=new J(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ut((u,l)=>u-l);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let l=i.get(u.largestBatchId);l===null&&(l=Bs(),i=i.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}const a=Bs(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=s)););return M.resolve(a)}lt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.lr.get(s.largestBatchId).delete(r.key);this.lr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new j4(t,r));let i=this.lr.get(t);i===void 0&&(i=fe(),this.lr.set(t,i)),this.lr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(){this.hr=new St(gt.Pr),this.Ir=new St(gt.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new gt(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new gt(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new J(new Qe([])),r=new gt(t,e),s=new gt(t,e+1),i=[];return this.Ir.forEachInRange([r,s],o=>{this.dr(o),i.push(o.key)}),i}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new J(new Qe([])),r=new gt(t,e),s=new gt(t,e+1);let i=fe();return this.Ir.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new gt(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class gt{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return J.comparator(e.key,t.key)||Te(e.gr,t.gr)}static Tr(e,t){return Te(e.gr,t.gr)||J.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new St(gt.Pr)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new K4(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.yr=this.yr.add(new gt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Sr(r),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new gt(t,0),s=new gt(t,Number.POSITIVE_INFINITY),i=[];return this.yr.forEachInRange([r,s],o=>{const a=this.wr(o.gr);i.push(a)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new St(Te);return t.forEach(s=>{const i=new gt(s,0),o=new gt(s,Number.POSITIVE_INFINITY);this.yr.forEachInRange([i,o],a=>{r=r.add(a.gr)})}),M.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;J.isDocumentKey(i)||(i=i.child(""));const o=new gt(new J(i),0);let a=new St(Te);return this.yr.forEachWhile(c=>{const u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.gr)),!0)},o),M.resolve(this.br(a))}br(e){const t=[];return e.forEach(r=>{const s=this.wr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ce(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return M.forEach(t.mutations,s=>{const i=new gt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new gt(t,0),s=this.yr.firstAfterOrEqual(r);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{constructor(e){this.Cr=e,this.docs=function(){return new ut(J.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let r=Rr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():_t.newInvalidDocument(s))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Rr();const o=t.path,a=new J(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||y4(g4(l),r)<=0||(s.has(l.key)||ph(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return M.resolve(i)}getAllFromCollectionGroup(e,t,r,s){j()}vr(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new SO(this)}getSize(e){return M.resolve(this.size)}}class SO extends IO{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this._r.addEntry(e,s)):this._r.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PO{constructor(e){this.persistence=e,this.Fr=new No(t=>zm(t),Gm),this.lastRemoteSnapshotVersion=te.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Xm,this.targetCount=0,this.Nr=ao.On()}forEachTarget(e,t){return this.Fr.forEach((r,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),M.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new ao(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.kn(t),M.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Fr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),M.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this.Or.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RO{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Hm(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new PO(this),this.indexManager=new xO,this.remoteDocumentCache=function(s){return new kO(s)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new vO(t),this.Kr=new AO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new CO,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new bO(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){H("MemoryPersistence","Starting transaction:",e);const s=new NO(this.Lr.next());return this.referenceDelegate.$r(),r(s).next(i=>this.referenceDelegate.Ur(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Wr(e,t){return M.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class NO extends v4{constructor(e){super(),this.currentSequenceNumber=e}}class Zm{constructor(e){this.persistence=e,this.Gr=new Xm,this.zr=null}static jr(e){return new Zm(e)}get Hr(){if(this.zr)return this.zr;throw j()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),M.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(s=>this.Hr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Hr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.Hr,r=>{const s=J.fromPath(r);return this.Jr(e,s).next(i=>{i||t.removeEntry(s,te.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return M.or([()=>M.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=s}static Qi(e,t){let r=fe(),s=fe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ep(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MO{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OO{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.zi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ji(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new MO;return this.Hi(e,t,o).next(a=>{if(i.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>i.result)}Ji(e,t,r,s){return r.documentReadCount<this.Ui?(na()<=de.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",Ii(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),M.resolve()):(na()<=de.DEBUG&&H("QueryEngine","Query:",Ii(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Wi*s?(na()<=de.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",Ii(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gn(t))):M.resolve())}zi(e,t){if(Vy(t))return M.resolve(null);let r=Gn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=u0(t,null,"F"),r=Gn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=fe(...i);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const u=this.Yi(t,a);return this.Zi(t,u,o,c.readTime)?this.zi(e,u0(t,null,"F")):this.Xi(e,u,t,c)}))})))}ji(e,t,r,s){return Vy(t)||s.isEqual(te.min())?M.resolve(null):this.Gi.getDocuments(e,r).next(i=>{const o=this.Yi(t,i);return this.Zi(t,o,r,s)?M.resolve(null):(na()<=de.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ii(t)),this.Xi(e,o,t,p4(s,-1)).next(a=>a))})}Yi(e,t){let r=new St(c1(e));return t.forEach((s,i)=>{ph(e,i)&&(r=r.add(i))}),r}Zi(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Hi(e,t,r){return na()<=de.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",Ii(t)),this.Gi.getDocumentsMatchingQuery(e,t,hs.min(),r)}Xi(e,t,r,s){return this.Gi.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FO{constructor(e,t,r,s){this.persistence=e,this.es=t,this.serializer=s,this.ts=new ut(Te),this.ns=new No(i=>zm(i),Gm),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new DO(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function BO(n,e,t,r){return new FO(n,e,t,r)}async function N1(n,e){const t=se(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let c=fe();for(const u of s){o.push(u.batchId);for(const l of u.mutations)c=c.add(l.key)}for(const u of i){a.push(u.batchId);for(const l of u.mutations)c=c.add(l.key)}return t.localDocuments.getDocuments(r,c).next(u=>({_s:u,removedBatchIds:o,addedBatchIds:a}))})})}function LO(n,e){const t=se(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){const d=u.batch,f=d.keys();let m=M.resolve();return f.forEach(p=>{m=m.next(()=>l.getEntry(c,p)).next(y=>{const g=u.docVersions.get(p);Ce(g!==null),y.version.compareTo(g)<0&&(d.applyToRemoteDocument(y,u),y.isValidDocument()&&(y.setReadTime(u.commitVersion),l.addEntry(y)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(c,d))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=fe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function M1(n){const e=se(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function VO(n,e){const t=se(n),r=e.snapshotVersion;let s=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});s=t.ts;const a=[];e.targetChanges.forEach((l,d)=>{const f=s.get(d);if(!f)return;a.push(t.qr.removeMatchingKeys(i,l.removedDocuments,d).next(()=>t.qr.addMatchingKeys(i,l.addedDocuments,d)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken($t.EMPTY_BYTE_STRING,te.min()).withLastLimboFreeSnapshotVersion(te.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),s=s.insert(d,m),function(y,g,x){return y.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(f,m,l)&&a.push(t.qr.updateTargetData(i,m))});let c=Rr(),u=fe();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(UO(i,o,e.documentUpdates).next(l=>{c=l.us,u=l.cs})),!r.isEqual(te.min())){const l=t.qr.getLastRemoteSnapshotVersion(i).next(d=>t.qr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return M.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,u)).next(()=>c)}).then(i=>(t.ts=s,i))}function UO(n,e,t){let r=fe(),s=fe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Rr();return t.forEach((a,c)=>{const u=i.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(te.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):H("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{us:o,cs:s}})}function WO(n,e){const t=se(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function HO(n,e){const t=se(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.qr.getTargetData(r,e).next(i=>i?(s=i,M.resolve(s)):t.qr.allocateTargetId(r).next(o=>(s=new Xr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.ts.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}async function d0(n,e,t){const r=se(n),s=r.ts.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Pc(o))throw o;H("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(s.target)}function Ky(n,e,t){const r=se(n);let s=te.min(),i=fe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){const d=se(c),f=d.ns.get(l);return f!==void 0?M.resolve(d.ts.get(f)):d.qr.getTargetData(u,l)}(r,o,Gn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?s:te.min(),t?i:fe())).next(a=>(qO(r,B4(e),a),{documents:a,ls:i})))}function qO(n,e,t){let r=n.rs.get(e)||te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.rs.set(e,r)}class jy{constructor(){this.activeTargetIds=q4()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $O{constructor(){this.eo=new jy,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new jy,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YO{ro(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){H("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){H("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lu=null;function wd(){return lu===null?lu=function(){return 268435456+Math.round(2147483648*Math.random())}():lu++,"0x"+lu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GO{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rt="WebChannelConnection";class JO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${s}/databases/${i}`,this.po=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get yo(){return!1}wo(t,r,s,i,o){const a=wd(),c=this.So(t,r);H("RestConnection",`Sending RPC '${t}' ${a}:`,c,s);const u={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(u,i,o),this.Do(t,c,u,s).then(l=>(H("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw to("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",c,"request:",s),l})}Co(t,r,s,i,o,a){return this.wo(t,r,s,i,o)}bo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ro}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}So(t,r){const s=zO[t];return`${this.mo}/v1/${r}:${s}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,s){const i=wd();return new Promise((o,a)=>{const c=new s4;c.setWithCredentials(!0),c.listenOnce(n4.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case vd.NO_ERROR:const l=c.getResponseJson();H(Rt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(l)),o(l);break;case vd.TIMEOUT:H(Rt,`RPC '${e}' ${i} timed out`),a(new q(R.DEADLINE_EXCEEDED,"Request time out"));break;case vd.HTTP_ERROR:const d=c.getStatus();if(H(Rt,`RPC '${e}' ${i} failed with status:`,d,"response text:",c.getResponseText()),d>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const p=function(g){const x=g.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(x)>=0?x:R.UNKNOWN}(m.status);a(new q(p,m.message))}else a(new q(R.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new q(R.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{H(Rt,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);H(Rt,`RPC '${e}' ${i} sending request:`,s),c.send(t,"POST",u,r,15)})}vo(e,t,r){const s=wd(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=e4(),a=t4(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.bo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const l=i.join("");H(Rt,`Creating RPC '${e}' stream ${s}: ${l}`,c);const d=o.createWebChannel(l,c);let f=!1,m=!1;const p=new GO({co:g=>{m?H(Rt,`Not sending because RPC '${e}' stream ${s} is closed:`,g):(f||(H(Rt,`Opening RPC '${e}' stream ${s} transport.`),d.open(),f=!0),H(Rt,`RPC '${e}' stream ${s} sending:`,g),d.send(g))},lo:()=>d.close()}),y=(g,x,_)=>{g.listen(x,v=>{try{_(v)}catch(w){setTimeout(()=>{throw w},0)}})};return y(d,au.EventType.OPEN,()=>{m||H(Rt,`RPC '${e}' stream ${s} transport opened.`)}),y(d,au.EventType.CLOSE,()=>{m||(m=!0,H(Rt,`RPC '${e}' stream ${s} transport closed`),p.Ro())}),y(d,au.EventType.ERROR,g=>{m||(m=!0,to(Rt,`RPC '${e}' stream ${s} transport errored:`,g),p.Ro(new q(R.UNAVAILABLE,"The operation could not be completed")))}),y(d,au.EventType.MESSAGE,g=>{var x;if(!m){const _=g.data[0];Ce(!!_);const v=_,w=v.error||((x=v[0])===null||x===void 0?void 0:x.error);if(w){H(Rt,`RPC '${e}' stream ${s} received error:`,w);const D=w.status;let T=function(k){const I=at[k];if(I!==void 0)return I1(I)}(D),E=w.message;T===void 0&&(T=R.INTERNAL,E="Unknown error status: "+D+" with message "+w.message),m=!0,p.Ro(new q(T,E)),d.close()}else H(Rt,`RPC '${e}' stream ${s} received:`,_),p.Vo(_)}}),y(a,r4.STAT_EVENT,g=>{g.stat===ky.PROXY?H(Rt,`RPC '${e}' stream ${s} detected buffering proxy`):g.stat===ky.NOPROXY&&H(Rt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.Ao()},0),p}}function xd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(n){return new iO(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(e,t,r=1e3,s=1.5,i=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=s,this.xo=i,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),s=Math.max(0,t-r);s>0&&H("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,s,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t,r,s,i,o,a,c){this.si=e,this.Ko=r,this.$o=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new tp(e,t)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,t){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Pr(t.toString()),Pr("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(t)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Uo===t&&this.s_(r,s)},r=>{e(()=>{const s=new q(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(s)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(s=>{r(()=>this.o_(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return H("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(H("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QO extends O1{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=uO(this.serializer,e),r=function(i){if(!("targetChange"in i))return te.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?te.min():o.readTime?ln(o.readTime):te.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=ec(this.serializer),t.addTarget=function(i,o){let a;const c=o.target;if(a=c0(c)?{documents:hO(i,c)}:{query:dO(i,c)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=A1(i,o.resumeToken);const u=l0(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(te.min())>0){a.readTime=Zu(i,o.snapshotVersion.toTimestamp());const u=l0(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=mO(this.serializer,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=ec(this.serializer),t.removeTarget=e,this.e_(t)}}class KO extends O1{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(Ce(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=lO(e.writeResults,e.commitTime),r=ln(e.commitTime);return this.listener.I_(r,t)}return Ce(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=ec(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>k1(this.serializer,r))};this.e_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jO extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.d_=!1}A_(){if(this.d_)throw new q(R.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.wo(e,t,r,s,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new q(R.UNKNOWN,s.toString())})}Co(e,t,r,s){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Co(e,t,r,i,o,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new q(R.UNKNOWN,i.toString())})}terminate(){this.d_=!0}}class XO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Pr(t),this.f_=!1):H("OnlineStateTracker",t)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZO{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=i,this.F_.ro(o=>{r.enqueueAndForget(async()=>{ci(this)&&(H("RemoteStore","Restarting streams for network reachability change."),await async function(c){const u=se(c);u.C_.add(4),await Oc(u),u.M_.set("Unknown"),u.C_.delete(4),await xh(u)}(this))})}),this.M_=new XO(r,s)}}async function xh(n){if(ci(n))for(const e of n.v_)await e(!0)}async function Oc(n){for(const e of n.v_)await e(!1)}function F1(n,e){const t=se(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),sp(t)?rp(t):Mo(t).Ho()&&np(t,e))}function B1(n,e){const t=se(n),r=Mo(t);t.D_.delete(e),r.Ho()&&L1(t,e),t.D_.size===0&&(r.Ho()?r.Zo():ci(t)&&t.M_.set("Unknown"))}function np(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Mo(n).u_(e)}function L1(n,e){n.x_.Oe(e),Mo(n).c_(e)}function rp(n){n.x_=new tO({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Mo(n).start(),n.M_.g_()}function sp(n){return ci(n)&&!Mo(n).jo()&&n.D_.size>0}function ci(n){return se(n).C_.size===0}function V1(n){n.x_=void 0}async function e2(n){n.D_.forEach((e,t)=>{np(n,e)})}async function t2(n,e){V1(n),sp(n)?(n.M_.w_(e),rp(n)):n.M_.set("Unknown")}async function n2(n,e,t){if(n.M_.set("Online"),e instanceof D1&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.D_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.D_.delete(a),s.x_.removeTarget(a))}(n,e)}catch(r){H("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await tl(n,r)}else if(e instanceof Iu?n.x_.$e(e):e instanceof T1?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(te.min()))try{const r=await M1(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.x_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const l=i.D_.get(u);l&&i.D_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{const l=i.D_.get(c);if(!l)return;i.D_.set(c,l.withResumeToken($t.EMPTY_BYTE_STRING,l.snapshotVersion)),L1(i,c);const d=new Xr(l.target,c,u,l.sequenceNumber);np(i,d)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){H("RemoteStore","Failed to raise snapshot:",r),await tl(n,r)}}async function tl(n,e,t){if(!Pc(e))throw e;n.C_.add(1),await Oc(n),n.M_.set("Offline"),t||(t=()=>M1(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{H("RemoteStore","Retrying IndexedDB access"),await t(),n.C_.delete(1),await xh(n)})}function U1(n,e){return e().catch(t=>tl(n,t,e))}async function Eh(n){const e=se(n),t=fs(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;r2(e);)try{const s=await WO(e.localStore,r);if(s===null){e.b_.length===0&&t.Zo();break}r=s.batchId,s2(e,s)}catch(s){await tl(e,s)}W1(e)&&H1(e)}function r2(n){return ci(n)&&n.b_.length<10}function s2(n,e){n.b_.push(e);const t=fs(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function W1(n){return ci(n)&&!fs(n).jo()&&n.b_.length>0}function H1(n){fs(n).start()}async function i2(n){fs(n).E_()}async function o2(n){const e=fs(n);for(const t of n.b_)e.P_(t.mutations)}async function a2(n,e,t){const r=n.b_.shift(),s=Qm.from(r,e,t);await U1(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Eh(n)}async function c2(n,e){e&&fs(n).h_&&await async function(r,s){if(function(o){return E1(o)&&o!==R.ABORTED}(s.code)){const i=r.b_.shift();fs(r).Yo(),await U1(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Eh(r)}}(n,e),W1(n)&&H1(n)}async function Zy(n,e){const t=se(n);t.asyncQueue.verifyOperationInProgress(),H("RemoteStore","RemoteStore received new credentials");const r=ci(t);t.C_.add(3),await Oc(t),r&&t.M_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),await xh(t)}async function u2(n,e){const t=se(n);e?(t.C_.delete(2),await xh(t)):e||(t.C_.add(2),await Oc(t),t.M_.set("Unknown"))}function Mo(n){return n.O_||(n.O_=function(t,r,s){const i=se(t);return i.A_(),new QO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{ho:e2.bind(null,n),Io:t2.bind(null,n),a_:n2.bind(null,n)}),n.v_.push(async e=>{e?(n.O_.Yo(),sp(n)?rp(n):n.M_.set("Unknown")):(await n.O_.stop(),V1(n))})),n.O_}function fs(n){return n.N_||(n.N_=function(t,r,s){const i=se(t);return i.A_(),new KO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{ho:i2.bind(null,n),Io:c2.bind(null,n),T_:o2.bind(null,n),I_:a2.bind(null,n)}),n.v_.push(async e=>{e?(n.N_.Yo(),await Eh(n)):(await n.N_.stop(),n.b_.length>0&&(H("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))})),n.N_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new zn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new ip(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function op(n,e){if(Pr("AsyncQueue",`${e}: ${n}`),Pc(n))return new q(R.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e){this.comparator=e?(t,r)=>e(t,r)||J.comparator(t.key,r.key):(t,r)=>J.comparator(t.key,r.key),this.keyedMap=ua(),this.sortedSet=new ut(this.comparator)}static emptySet(e){return new Li(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Li)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Li;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(){this.B_=new ut(J.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):j():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class co{constructor(e,t,r,s,i,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new co(e,t,Li.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l2{constructor(){this.k_=void 0,this.listeners=[]}}class h2{constructor(){this.queries=new No(e=>a1(e),mh),this.onlineState="Unknown",this.q_=new Set}}async function ap(n,e){const t=se(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new l2),s)try{i.k_=await t.onListen(r)}catch(o){const a=op(o,`Initialization of query '${Ii(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.Q_(t.onlineState),i.k_&&e.K_(i.k_)&&up(t)}async function cp(n,e){const t=se(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=i.listeners.length===0)}if(s)return t.queries.delete(r),t.onUnlisten(r)}function d2(n,e){const t=se(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.listeners)a.K_(s)&&(r=!0);o.k_=s}}r&&up(t)}function f2(n,e,t){const r=se(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function up(n){n.q_.forEach(e=>{e.next()})}class lp{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new co(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){if(!e.fromCache)return!0;const r=t!=="Offline";return(!this.options.J_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}z_(e){if(e.docChanges.length>0)return!0;const t=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}H_(e){e=co.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(e){this.key=e}}class $1{constructor(e){this.key=e}}class m2{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=fe(),this.mutatedKeys=fe(),this._a=c1(e),this.aa=new Li(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new e_,s=t?t.aa:this.aa;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,d)=>{const f=s.get(l),m=ph(this.query,d)?d:null,p=!!f&&this.mutatedKeys.has(f.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let g=!1;f&&m?f.data.isEqual(m.data)?p!==y&&(r.track({type:3,doc:m}),g=!0):this.ha(f,m)||(r.track({type:2,doc:m}),g=!0,(c&&this._a(m,c)>0||u&&this._a(m,u)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),g=!0):f&&!m&&(r.track({type:1,doc:f}),g=!0,(c||u)&&(a=!0)),g&&(m?(o=o.add(m),i=y?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{aa:o,la:r,Zi:a,mutatedKeys:i}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const o=e.la.L_();o.sort((l,d)=>function(m,p){const y=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return y(m)-y(p)}(l.type,d.type)||this._a(l.doc,d.doc)),this.Pa(r),s=s!=null&&s;const a=t&&!s?this.Ia():[],c=this.oa.size===0&&this.current&&!s?1:0,u=c!==this.sa;return this.sa=c,o.length!==0||u?{snapshot:new co(this.query,e.aa,i,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new e_,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=fe(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new $1(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new q1(r))}),t}da(e){this.ia=e.ls,this.oa=fe();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return co.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}}class p2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class g2{constructor(e){this.key=e,this.Ra=!1}}class y2{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new No(a=>a1(a),mh),this.fa=new Map,this.ga=new Set,this.pa=new ut(J.comparator),this.ya=new Map,this.wa=new Xm,this.Sa={},this.ba=new Map,this.Da=ao.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}}async function _2(n,e){const t=b2(n);let r,s;const i=t.ma.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.Aa();else{const o=await HO(t.localStore,Gn(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=await v2(t,e,r,a==="current",o.resumeToken),t.isPrimaryClient&&F1(t.remoteStore,o)}return s}async function v2(n,e,t,r,s){n.va=(d,f,m)=>async function(y,g,x,_){let v=g.view.ca(x);v.Zi&&(v=await Ky(y.localStore,g.query,!1).then(({documents:E})=>g.view.ca(E,v)));const w=_&&_.targetChanges.get(g.targetId),D=_&&_.targetMismatches.get(g.targetId)!=null,T=g.view.applyChanges(v,y.isPrimaryClient,w,D);return n_(y,g.targetId,T.Ta),T.snapshot}(n,d,f,m);const i=await Ky(n.localStore,e,!0),o=new m2(e,i.ls),a=o.ca(i.documents),c=Mc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,c);n_(n,t,u.Ta);const l=new p2(e,t,o);return n.ma.set(e,l),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),u.snapshot}async function w2(n,e){const t=se(n),r=t.ma.get(e),s=t.fa.get(r.targetId);if(s.length>1)return t.fa.set(r.targetId,s.filter(i=>!mh(i,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||await d0(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),B1(t.remoteStore,r.targetId),f0(t,r.targetId)}).catch(Sc)):(f0(t,r.targetId),await d0(t.localStore,r.targetId,!0))}async function x2(n,e,t){const r=k2(n);try{const s=await function(o,a){const c=se(o),u=Fe.now(),l=a.reduce((m,p)=>m.add(p.key),fe());let d,f;return c.persistence.runTransaction("Locally write mutations","readwrite",m=>{let p=Rr(),y=fe();return c.ss.getEntries(m,l).next(g=>{p=g,p.forEach((x,_)=>{_.isValidDocument()||(y=y.add(x))})}).next(()=>c.localDocuments.getOverlayedDocuments(m,p)).next(g=>{d=g;const x=[];for(const _ of a){const v=Q4(_,d.get(_.key).overlayedDocument);v!=null&&x.push(new xs(_.key,v,e1(v.value.mapValue),Lt.exists(!0)))}return c.mutationQueue.addMutationBatch(m,u,x,a)}).next(g=>{f=g;const x=g.applyToLocalDocumentSet(d,y);return c.documentOverlayCache.saveOverlays(m,g.batchId,x)})}).then(()=>({batchId:f.batchId,changes:l1(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Sa[o.currentUser.toKey()];u||(u=new ut(Te)),u=u.insert(a,c),o.Sa[o.currentUser.toKey()]=u}(r,s.batchId,t),await Fc(r,s.changes),await Eh(r.remoteStore)}catch(s){const i=op(s,"Failed to persist write");t.reject(i)}}async function Y1(n,e){const t=se(n);try{const r=await VO(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.ya.get(i);o&&(Ce(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Ra=!0:s.modifiedDocuments.size>0?Ce(o.Ra):s.removedDocuments.size>0&&(Ce(o.Ra),o.Ra=!1))}),await Fc(t,r,e)}catch(r){await Sc(r)}}function t_(n,e,t){const r=se(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.ma.forEach((i,o)=>{const a=o.view.Q_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=se(o);c.onlineState=a;let u=!1;c.queries.forEach((l,d)=>{for(const f of d.listeners)f.Q_(a)&&(u=!0)}),u&&up(c)}(r.eventManager,e),s.length&&r.Va.a_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function E2(n,e,t){const r=se(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.ya.get(e),i=s&&s.key;if(i){let o=new ut(J.comparator);o=o.insert(i,_t.newNoDocument(i,te.min()));const a=fe().add(i),c=new vh(te.min(),new Map,new ut(Te),o,a);await Y1(r,c),r.pa=r.pa.remove(i),r.ya.delete(e),hp(r)}else await d0(r.localStore,e,!1).then(()=>f0(r,e,t)).catch(Sc)}async function I2(n,e){const t=se(n),r=e.batch.batchId;try{const s=await LO(t.localStore,e);G1(t,r,null),z1(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Fc(t,s)}catch(s){await Sc(s)}}async function T2(n,e,t){const r=se(n);try{const s=await function(o,a){const c=se(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(d=>(Ce(d!==null),l=d.keys(),c.mutationQueue.removeMutationBatch(u,d))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,e);G1(r,e,t),z1(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Fc(r,s)}catch(s){await Sc(s)}}function z1(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function G1(n,e,t){const r=se(n);let s=r.Sa[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Sa[r.currentUser.toKey()]=s}}function f0(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||J1(n,r)})}function J1(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);t!==null&&(B1(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),hp(n))}function n_(n,e,t){for(const r of t)r instanceof q1?(n.wa.addReference(r.key,e),D2(n,r)):r instanceof $1?(H("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||J1(n,r.key)):j()}function D2(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(H("SyncEngine","New document in limbo: "+t),n.ga.add(r),hp(n))}function hp(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new J(Qe.fromString(e)),r=n.Da.next();n.ya.set(r,new g2(t)),n.pa=n.pa.insert(t,r),F1(n.remoteStore,new Xr(Gn(fh(t.path)),r,"TargetPurposeLimboResolution",Hm._e))}}async function Fc(n,e,t){const r=se(n),s=[],i=[],o=[];r.ma.isEmpty()||(r.ma.forEach((a,c)=>{o.push(r.va(c,e,t).then(u=>{if((u||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u!=null&&u.fromCache?"not-current":"current"),u){s.push(u);const l=ep.Qi(c.targetId,u);i.push(l)}}))}),await Promise.all(o),r.Va.a_(s),await async function(c,u){const l=se(c);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>M.forEach(u,f=>M.forEach(f.ki,m=>l.persistence.referenceDelegate.addReference(d,f.targetId,m)).next(()=>M.forEach(f.qi,m=>l.persistence.referenceDelegate.removeReference(d,f.targetId,m)))))}catch(d){if(!Pc(d))throw d;H("LocalStore","Failed to update sequence numbers: "+d)}for(const d of u){const f=d.targetId;if(!d.fromCache){const m=l.ts.get(f),p=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(p);l.ts=l.ts.insert(f,y)}}}(r.localStore,i))}async function A2(n,e){const t=se(n);if(!t.currentUser.isEqual(e)){H("SyncEngine","User change. New user:",e.toKey());const r=await N1(t.localStore,e);t.currentUser=e,function(i,o){i.ba.forEach(a=>{a.forEach(c=>{c.reject(new q(R.CANCELLED,o))})}),i.ba.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Fc(t,r._s)}}function C2(n,e){const t=se(n),r=t.ya.get(e);if(r&&r.Ra)return fe().add(r.key);{let s=fe();const i=t.fa.get(e);if(!i)return s;for(const o of i){const a=t.ma.get(o);s=s.unionWith(a.view.ua)}return s}}function b2(n){const e=se(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Y1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=C2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=E2.bind(null,e),e.Va.a_=d2.bind(null,e.eventManager),e.Va.Fa=f2.bind(null,e.eventManager),e}function k2(n){const e=se(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=I2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=T2.bind(null,e),e}class r_{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=wh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return BO(this.persistence,new OO,e.initialUser,this.serializer)}createPersistence(e){return new RO(Zm.jr,this.serializer)}createSharedClientState(e){return new $O}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class S2{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>t_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=A2.bind(null,this.syncEngine),await u2(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new h2}()}createDatastore(e){const t=wh(e.databaseInfo.databaseId),r=function(i){return new JO(i)}(e.databaseInfo);return function(i,o,a,c){return new jO(i,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new ZO(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>t_(this.syncEngine,t,0),function(){return Xy.D()?new Xy:new YO}())}createSyncEngine(e,t){return function(s,i,o,a,c,u,l){const d=new y2(s,i,o,a,c,u);return l&&(d.Ca=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const r=se(t);H("RemoteStore","RemoteStore shutting down."),r.C_.add(5),await Oc(r),r.F_.shutdown(),r.M_.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):Pr("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P2{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new q(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(s,i){const o=se(s),a=ec(o.serializer)+"/documents",c={documents:i.map(f=>el(o.serializer,f))},u=await o.Co("BatchGetDocuments",a,c,i.length),l=new Map;u.forEach(f=>{const m=cO(o.serializer,f);l.set(m.key.toString(),m)});const d=[];return i.forEach(f=>{const m=l.get(f.toString());Ce(!!m),d.push(m)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new _h(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=J.fromPath(r);this.mutations.push(new x1(s,this.precondition(s)))}),await async function(r,s){const i=se(r),o=ec(i.serializer)+"/documents",a={writes:s.map(c=>k1(i.serializer,c))};await i.wo("Commit",o,a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=te.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new q(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(te.min())?Lt.exists(!1):Lt.updateTime(t):Lt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(te.min()))throw new q(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Lt.updateTime(t)}return Lt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R2{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.Wa=r.maxAttempts,this.zo=new tp(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){this.zo.ko(async()=>{const e=new P2(this.datastore),t=this.za(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.ja(s)}))}).catch(r=>{this.ja(r)})})}za(e){try{const t=this.updateFunction(e);return!Rc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!E1(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N2{constructor(e,t,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Ot.UNAUTHENTICATED,this.clientId=jE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async i=>{H("FirestoreClient","Received user=",i.uid),await this.authCredentialListener(i),this.user=i}),this.appCheckCredentials.start(r,i=>(H("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new q(R.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=op(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ed(n,e){n.asyncQueue.verifyOperationInProgress(),H("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await N1(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function s_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await O2(n);H("FirestoreClient","Initializing OnlineComponentProvider");const r=await n.getConfiguration();await e.initialize(t,r),n.setCredentialChangeListener(s=>Zy(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>Zy(e.remoteStore,i)),n._onlineComponents=e}function M2(n){return n.name==="FirebaseError"?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function O2(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){H("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ed(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!M2(t))throw t;to("Error using user provided cache. Falling back to memory cache: "+t),await Ed(n,new r_)}}else H("FirestoreClient","Using default OfflineComponentProvider"),await Ed(n,new r_);return n._offlineComponents}async function fp(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(H("FirestoreClient","Using user provided OnlineComponentProvider"),await s_(n,n._uninitializedComponentsProvider._online)):(H("FirestoreClient","Using default OnlineComponentProvider"),await s_(n,new S2))),n._onlineComponents}function F2(n){return fp(n).then(e=>e.syncEngine)}function B2(n){return fp(n).then(e=>e.datastore)}async function nl(n){const e=await fp(n),t=e.eventManager;return t.onListen=_2.bind(null,e.syncEngine),t.onUnlisten=w2.bind(null,e.syncEngine),t}function L2(n,e,t={}){const r=new zn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const l=new dp({next:f=>{o.enqueueAndForget(()=>cp(i,d));const m=f.docs.has(a);!m&&f.fromCache?u.reject(new q(R.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&c&&c.source==="server"?u.reject(new q(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),d=new lp(fh(a.path),l,{includeMetadataChanges:!0,J_:!0});return ap(i,d)}(await nl(n),n.asyncQueue,e,t,r)),r.promise}function V2(n,e,t={}){const r=new zn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const l=new dp({next:f=>{o.enqueueAndForget(()=>cp(i,d)),f.fromCache&&c.source==="server"?u.reject(new q(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),d=new lp(a,l,{includeMetadataChanges:!0,J_:!0});return ap(i,d)}(await nl(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q1(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K1(n,e,t){if(!t)throw new q(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function U2(n,e,t,r){if(e===!0&&r===!0)throw new q(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function o_(n){if(!J.isDocumentKey(n))throw new q(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function a_(n){if(J.isDocumentKey(n))throw new q(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function mp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":j()}function Jn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=mp(n);throw new q(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new q(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new q(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}U2("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Q1((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new q(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new q(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new q(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ih{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new c_({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new q(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new q(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new c_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new o4;switch(r.type){case"firstParty":return new l4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new q(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=i_.get(t);r&&(H("ComponentProvider","Removing Datastore"),i_.delete(t),r.terminate())}(this),Promise.resolve()}}function W2(n,e,t,r={}){var s;const i=(n=Jn(n,Ih))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&to("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Ot.MOCK_USER;else{a=mw(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new q(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ot(u)}n._authCredentials=new a4(new KE(a,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Bc(this.firestore,e,this._query)}}class rn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ss(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rn(this.firestore,e,this._key)}}class ss extends Bc{constructor(e,t,r){super(e,t,fh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rn(this.firestore,null,new J(e))}withConverter(e){return new ss(this.firestore,e,this._path)}}function Nt(n,e,...t){if(n=Ee(n),K1("collection","path",e),n instanceof Ih){const r=Qe.fromString(e,...t);return a_(r),new ss(n,null,r)}{if(!(n instanceof rn||n instanceof ss))throw new q(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qe.fromString(e,...t));return a_(r),new ss(n.firestore,null,r)}}function jt(n,e,...t){if(n=Ee(n),arguments.length===1&&(e=jE.newId()),K1("doc","path",e),n instanceof Ih){const r=Qe.fromString(e,...t);return o_(r),new rn(n,null,new J(r))}{if(!(n instanceof rn||n instanceof ss))throw new q(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qe.fromString(e,...t));return o_(r),new rn(n.firestore,n instanceof ss?n.converter:null,new J(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new tp(this,"async_queue_retry"),this.iu=()=>{const t=xd();t&&H("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=xd();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=xd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new zn;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!Pc(e))throw e;H("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{this.eu=r,this.tu=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Pr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const s=ip.createAndSchedule(this,e,t,r,i=>this.au(i));return this.Xa.push(s),s}su(){this.eu&&j()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function u_(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class js extends Ih{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=function(){return new H2}(),this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||j1(this),this._firestoreClient.terminate()}}function q2(n,e){const t=typeof n=="object"?n:Do(),r=typeof n=="string"?n:e||"(default)",s=Ol(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=hw("firestore");i&&W2(s,...i)}return s}function Oo(n){return n._firestoreClient||j1(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function j1(n){var e,t,r;const s=n._freezeSettings(),i=function(a,c,u,l){return new E4(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Q1(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._firestoreClient=new N2(n._authCredentials,n._appCheckCredentials,n._queue,i),!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xs($t.fromBase64String(e))}catch(t){throw new q(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Xs($t.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ct(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Te(this._lat,e._lat)||Te(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2=/^__.*__$/;class Y2{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new xs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Nc(e,this.data,t,this.fieldTransforms)}}class X1{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new xs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Z1(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}class Th{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Pu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new Th(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Tu({path:r,du:!1});return s.Au(e),s}Ru(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Tu({path:r,du:!1});return s.Pu(),s}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return rl(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(Z1(this.Iu)&&$2.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class z2{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||wh(e)}pu(e,t,r,s=!1){return new Th({Iu:e,methodName:t,gu:r,path:Ct.emptyPath(),du:!1,fu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function eI(n){const e=n._freezeSettings(),t=wh(n._databaseId);return new z2(n._databaseId,!!e.ignoreUndefinedProperties,t)}function tI(n,e,t,r,s,i={}){const o=n.pu(i.merge||i.mergeFields?2:0,e,t,s);gp("Data must be an object, but it was:",o,r);const a=iI(r,o);let c,u;if(i.merge)c=new un(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const d of i.mergeFields){const f=m0(e,d,t);if(!o.contains(f))throw new q(R.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);aI(l,f)||l.push(f)}c=new un(l),u=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,u=o.fieldTransforms;return new Y2(new zt(a),c,u)}class Vc extends Fo{_toFieldTransform(e){if(e.Iu!==2)throw e.Iu===1?e.mu(`${this._methodName}() can only appear at the top level of your update data`):e.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Vc}}function nI(n,e,t){return new Th({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class G2 extends Fo{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=nI(this,e,!0),r=this.yu.map(i=>Bo(i,t)),s=new io(r);return new Jm(e.path,s)}isEqual(e){return this===e}}class J2 extends Fo{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=nI(this,e,!0),r=this.yu.map(i=>Bo(i,t)),s=new oo(r);return new Jm(e.path,s)}isEqual(e){return this===e}}class Q2 extends Fo{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new Za(e.serializer,m1(e.serializer,this.wu));return new Jm(e.path,t)}isEqual(e){return this===e}}function rI(n,e,t,r){const s=n.pu(1,e,t);gp("Data must be an object, but it was:",s,r);const i=[],o=zt.empty();ai(r,(c,u)=>{const l=yp(e,c,t);u=Ee(u);const d=s.Ru(l);if(u instanceof Vc)i.push(l);else{const f=Bo(u,d);f!=null&&(i.push(l),o.set(l,f))}});const a=new un(i);return new X1(o,a,s.fieldTransforms)}function sI(n,e,t,r,s,i){const o=n.pu(1,e,t),a=[m0(e,r,t)],c=[s];if(i.length%2!=0)throw new q(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(m0(e,i[f])),c.push(i[f+1]);const u=[],l=zt.empty();for(let f=a.length-1;f>=0;--f)if(!aI(u,a[f])){const m=a[f];let p=c[f];p=Ee(p);const y=o.Ru(m);if(p instanceof Vc)u.push(m);else{const g=Bo(p,y);g!=null&&(u.push(m),l.set(m,g))}}const d=new un(u);return new X1(l,d,o.fieldTransforms)}function Bo(n,e){if(oI(n=Ee(n)))return gp("Unsupported field value:",e,n),iI(n,e);if(n instanceof Fo)return function(r,s){if(!Z1(s.Iu))throw s.mu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.mu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let c=Bo(a,s.Vu(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ee(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return m1(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Fe.fromDate(r);return{timestampValue:Zu(s.serializer,i)}}if(r instanceof Fe){const i=new Fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Zu(s.serializer,i)}}if(r instanceof pp)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xs)return{bytesValue:A1(s.serializer,r._byteString)};if(r instanceof rn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:jm(r.firestore._databaseId||s.databaseId,r._key.path)}}throw s.mu(`Unsupported field value: ${mp(r)}`)}(n,e)}function iI(n,e){const t={};return XE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ai(n,(r,s)=>{const i=Bo(s,e.Eu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function oI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Fe||n instanceof pp||n instanceof Xs||n instanceof rn||n instanceof Fo)}function gp(n,e,t){if(!oI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=mp(t);throw r==="an object"?e.mu(n+" a custom object"):e.mu(n+" "+r)}}function m0(n,e,t){if((e=Ee(e))instanceof Lc)return e._internalPath;if(typeof e=="string")return yp(n,e);throw rl("Field path arguments must be of type string or ",n,!1,void 0,t)}const K2=new RegExp("[~\\*/\\[\\]]");function yp(n,e,t){if(e.search(K2)>=0)throw rl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Lc(...e.split("."))._internalPath}catch{throw rl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function rl(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new q(R.INVALID_ARGUMENT,a+n+c)}function aI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new rn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new j2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(cI("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class j2 extends sl{data(){return super.data()}}function cI(n,e){return typeof e=="string"?yp(n,e):e instanceof Lc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class lI{convertValue(e,t="none"){switch(Ks(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ct(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ai(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new pp(ct(e.latitude),ct(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=$m(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ka(e));default:return null}}convertTimestamp(e){const t=ds(e);return new Fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Qe.fromString(e);Ce(R1(r));const s=new ja(r.get(1),r.get(3)),i=new J(r.popFirst(5));return s.isEqual(t)||Pr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class X2 extends lI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xs(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _p extends sl{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Tu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(cI("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Tu extends _p{data(e={}){return super.data(e)}}class dI{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ki(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Tu(this._firestore,this._userDataWriter,r.key,r,new ki(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new Tu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ki(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const c=new Tu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ki(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Z2(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Z2(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eF(n){n=Jn(n,rn);const e=Jn(n.firestore,js);return L2(Oo(e),n._key).then(t=>fI(e,n,t))}class Dh extends lI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xs(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rn(this.firestore,null,t)}}function l_(n){n=Jn(n,Bc);const e=Jn(n.firestore,js),t=Oo(e),r=new Dh(e);return uI(n._query),V2(t,n._query).then(s=>new dI(e,r,n,s))}function tF(n,...e){var t,r,s;n=Ee(n);let i={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||u_(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(u_(e[o])){const d=e[o];e[o]=(t=d.next)===null||t===void 0?void 0:t.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(s=d.complete)===null||s===void 0?void 0:s.bind(d)}let c,u,l;if(n instanceof rn)u=Jn(n.firestore,js),l=fh(n._key.path),c={next:d=>{e[o]&&e[o](fI(u,n,d))},error:e[o+1],complete:e[o+2]};else{const d=Jn(n,Bc);u=Jn(d.firestore,js),l=d._query;const f=new Dh(u);c={next:m=>{e[o]&&e[o](new dI(u,f,d,m))},error:e[o+1],complete:e[o+2]},uI(n._query)}return function(f,m,p,y){const g=new dp(y),x=new lp(m,g,p);return f.asyncQueue.enqueueAndForget(async()=>ap(await nl(f),x)),()=>{g.Na(),f.asyncQueue.enqueueAndForget(async()=>cp(await nl(f),x))}}(Oo(u),l,a,c)}function nF(n,e){return function(r,s){const i=new zn;return r.asyncQueue.enqueueAndForget(async()=>x2(await F2(r),s,i)),i.promise}(Oo(n),e)}function fI(n,e,t){const r=t.docs.get(e._key),s=new Dh(n);return new _p(n,s,e._key,r,new ki(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rF={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=eI(e)}set(e,t,r){this._verifyNotCommitted();const s=zr(e,this._firestore),i=hI(s.converter,t,r),o=tI(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Lt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=zr(e,this._firestore);let o;return o=typeof(t=Ee(t))=="string"||t instanceof Lc?sI(this._dataReader,"WriteBatch.update",i._key,t,r,s):rI(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Lt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zr(e,this._firestore);return this._mutations=this._mutations.concat(new _h(t._key,Lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new q(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zr(n,e){if((n=Ee(n)).firestore!==e)throw new q(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=eI(t)}get(t){const r=zr(t,this._firestore),s=new X2(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return j();const o=i[0];if(o.isFoundDocument())return new sl(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new sl(this._firestore,s,r._key,null,r.converter);throw j()})}set(t,r,s){const i=zr(t,this._firestore),o=hI(i.converter,r,s),a=tI(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=zr(t,this._firestore);let a;return a=typeof(r=Ee(r))=="string"||r instanceof Lc?sI(this._dataReader,"Transaction.update",o._key,r,s,i):rI(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=zr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=zr(e,this._firestore),r=new Dh(this._firestore);return super.get(e).then(s=>new _p(this._firestore,r,t._key,s._document,new ki(!1,!1),t.converter))}}function oF(n,e,t){n=Jn(n,js);const r=Object.assign(Object.assign({},rF),t);return function(i){if(i.maxAttempts<1)throw new q(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const c=new zn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await B2(i);new R2(i.asyncQueue,u,a,o,c).run()}),c.promise}(Oo(n),s=>e(new iF(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(){return new Vc("deleteField")}function aF(...n){return new G2("arrayUnion",n)}function cF(...n){return new J2("arrayRemove",n)}function hu(n){return new Q2("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uF(n){return Oo(n=Jn(n,js)),new sF(n,e=>nF(n,e))}(function(e,t=!0){(function(s){Ro=s})(si),Gs(new cs("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new js(new c4(r.getProvider("auth-internal")),new d4(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new q(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ja(u.options.projectId,l)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Yn(Sy,"4.4.0",e),Yn(Sy,"4.4.0","esm2017")})();var Vi=(n=>(n[n.Barber=0]="Barber",n[n.Polish=1]="Polish",n[n.Beautician=2]="Beautician",n[n.ManicurePedicure=3]="ManicurePedicure",n[n.Eyelashes=4]="Eyelashes",n[n.Eyebrows=5]="Eyebrows",n[n.Braids=6]="Braids",n[n.MakeUpArtist=7]="MakeUpArtist",n[n.TattooArtist=8]="TattooArtist",n[n.HairRemoval=9]="HairRemoval",n[n.Masseur=10]="Masseur",n[n.Physiotherapy=11]="Physiotherapy",n[n.Cobblers=12]="Cobblers",n[n.Clown=13]="Clown",n[n.SocialWorker=14]="SocialWorker",n[n.Magician=15]="Magician",n[n.Doctor=16]="Doctor",n[n.Veterinarian=17]="Veterinarian",n[n.CommunicationTherapist=18]="CommunicationTherapist",n[n.DogGroomer=19]="DogGroomer",n[n.DJ=20]="DJ",n[n.Psychologist=21]="Psychologist",n[n.Tutor=22]="Tutor",n[n.WeddingDresses=23]="WeddingDresses",n[n.DanceTeacher=24]="DanceTeacher",n[n.Babysitter=25]="Babysitter",n[n.Reflexologist=26]="Reflexologist",n[n.Dietitian=27]="Dietitian",n[n.CarWash=28]="CarWash",n[n.Photographer=29]="Photographer",n[n.SwimmingTeacher=30]="SwimmingTeacher",n[n.Counselor=31]="Counselor",n[n.Mentor=32]="Mentor",n[n.TennisCoach=33]="TennisCoach",n[n.PrivateChef=34]="PrivateChef",n[n.PersonalTrainer=35]="PersonalTrainer",n[n.Lawyer=36]="Lawyer",n[n.Sales=37]="Sales",n[n.RealEstate=38]="RealEstate",n[n.DrivingTeacher=39]="DrivingTeacher",n[n.InvestmentAdvice=40]="InvestmentAdvice",n[n.Library=41]="Library",n[n.Tailor=42]="Tailor",n[n.Restaurant=43]="Restaurant",n[n.NailConstruction=44]="NailConstruction",n[n.Dentist=45]="Dentist",n[n.BeautysSalon=46]="BeautysSalon",n[n.Washer=47]="Washer",n[n.CleaningSofas=48]="CleaningSofas",n[n.Other=49]="Other",n))(Vi||{});const lF={0:"barber",1:"polish",48:"cleaningSofas",2:"beautician",3:"manicurePedicure",4:"eyelashes",5:"eyebrows",25:"babysitter",6:"braids",7:"makeUpArtist",8:"tattooArtist",9:"hairRemoval",10:"masseur",12:"cobblers",13:"clown",14:"socialWorker",15:"magician",16:"doctor",20:"dj",17:"veterinarian",18:"communicationTherapist",19:"dogGroomer",21:"psychologist",11:"physiotherapy",22:"Tutor",23:"weddingDresses",24:"danceTeacher",26:"reflexologist",27:"dietitian",28:"carWash",29:"photographer",30:"swimmingTeacher",31:"counselor",32:"mentor",33:"tennisCoach",34:"privateChef",35:"personalTrainer",36:"lawyer",37:"sales",38:"realEstate",39:"drivingTeacher",40:"investmentAdvice",41:"library",49:"other",42:"tailor",43:"restaurant",44:"nailConstruction",45:"dentist",46:"beautysSalon",47:"washer"},mI={barber:0,cleaningSofas:48,polish:1,beautician:2,manicurePedicure:3,eyelashes:4,eyebrows:5,babysitter:25,braids:6,makeUpArtist:7,tattooArtist:8,hairRemoval:9,masseur:10,cobblers:12,clown:13,socialWorker:14,magician:15,doctor:16,veterinarian:17,communicationTherapist:18,dogGroomer:19,psychologist:21,physiotherapy:11,Tutor:22,weddingDresses:23,danceTeacher:24,reflexologist:26,dietitian:27,carWash:28,photographer:29,swimmingTeacher:30,counselor:31,mentor:32,dj:20,tennisCoach:33,privateChef:34,personalTrainer:35,lawyer:36,sales:37,realEstate:38,drivingTeacher:39,investmentAdvice:40,library:41,other:49,restaurant:43,tailor:42,nailConstruction:44,dentist:45,beautysSalon:46,washer:47};function q5(n){function e(u){return u<=.03928?u/12.92:Math.pow((u+.055)/1.055,2.4)}let t=n.toString(16),r=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),i=parseInt(t.slice(6,8),16);const o=e(r/255),a=e(s/255),c=e(i/255);return .2126*o+.7152*a+.0722*c}function hF(n,e=155){console.log(n);const t=n.toString(16),r=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),i=parseInt(t.slice(6,8),16),o=(r*299+s*587+i*114)/1e3;return console.log(o),o>e}function h_(n,e){if(n===null)return e===null;if(e===null||n.size!==e.size)return!1;if(n===e)return!0;for(const t of n)if(!e.has(t))return!1;return!0}async function $5(){return!0}var p0=(n=>(n[n.light=0]="light",n[n.dark=1]="dark",n))(p0||{});class _r{constructor({background:e=0,primary:t=0,surface:r=0,inverseSurface:s=0,tertiary:i=0,id:o,fontName:a="",themeName:c=""}){h(this,"background",0);h(this,"primary",0);h(this,"surface",0);h(this,"inverseSurface",0);h(this,"tertiary",0);h(this,"id","");h(this,"fontName","");h(this,"themeName","");this.background=e,this.primary=t,this.surface=r,this.inverseSurface=s,this.tertiary=i,this.id=o,this.fontName=a,this.themeName=c}static fromJson(e,t){return new _r({background:e.background||0,primary:e.primary||0,id:t,themeName:e.themeName||"",surface:e.surface||0,tertiary:e.tertiary||0,inverseSurface:e.inverseSurface||0,fontName:e.fontName||""})}static fromBusinessTheme(e){return new _r({themeName:e.themeName,background:e.background,primary:e.primary,tertiary:e.tertiary,id:e.id,surface:e.surface,inverseSurface:e.inverseSurface,fontName:e.fontName})}isEqual(e,t=!0){const r=e.toJson();t&&(r.id=e.id);const s=this.toJson();return t&&(s.id=this.id),JSON.stringify(r)===JSON.stringify(s)}get brightness(){return hF(this.background)?1:0}toJson(){const e={};return this.fontName!==""&&(e.fontName=this.fontName),this.surface!==0&&(e.surface=this.surface),this.inverseSurface!==0&&(e.inverseSurface=this.inverseSurface),e.tertiary=this.tertiary,e.themeName=this.themeName,this.background!==0&&(e.background=this.background),this.primary!==0&&(e.primary=this.primary),e}}var cr=(n=>(n[n.Grid=0]="Grid",n[n.Carousel=1]="Carousel",n[n.EndlessCarousel=2]="EndlessCarousel",n))(cr||{});const d_={0:"grid",1:"carousel",2:"endlessCarousel"},f_={grid:0,carousel:1,endlessCarousel:2},pI={dark:new _r({fontName:"Varela Round",themeName:"Original",id:"dark",inverseSurface:4279637532,background:4280229673,surface:4280690225,tertiary:4279834916,primary:4294940672}),darkIos:new _r({fontName:"Varela Round",themeName:"Dark",id:"darkIos",inverseSurface:4281084974,background:4279637528,surface:4280361252,tertiary:4278190080,primary:4278225100}),light:new _r({fontName:"Varela Round",themeName:"Pink",id:"light",inverseSurface:4294831859,background:4294375158,surface:4294967295,tertiary:4294243315,primary:4294936498}),lightIos:new _r({fontName:"Varela Round",themeName:"Light",id:"lightIos",inverseSurface:4292664541,background:4294111991,surface:4294967295,tertiary:4293322471,primary:4278221567})};class Oe{constructor(e){h(this,"id","");h(this,"token","");e&&(this.id=e.I||"",this.token=e.T||"")}static fromShopIconUrl(e){const t=new Oe;try{const r=e.split("SHOPICON");t.id=r[1].split("?alt")[0];const s=e.split("&token=");return t.token=s[1],t}catch{return new Oe}}static fromJson(e){const t=new Oe;return t.id=e.I||"",t.token=e.T||"",t}static fromJsonStr(e){const t=JSON.parse(e),r=new Oe;return r.id=t.I||"",r.token=t.T||"",r}get isEmpty(){return this.token===""||this.id===""}get isNotEmpty(){return this.token!==""&&this.id!==""}isEqual(e){return e.id==this.id&&e.token==this.token}getShopIconPath(e){return this.token===""||this.id===""?"":`https://firebasestorage.googleapis.com/v0/b/managementsystemapp-c1fda.appspot.com/o/enviroments%2F${Ke.replace("enviroments/","")}%2F${e}%2Fimages%2Flogos%2FSHOPICON${this.id}?alt=media&token=${this.token}`}toJsonStr(){const e={I:this.id,T:this.token};return JSON.stringify(e)}toJson(){return{I:this.id,T:this.token}}}class Vt{constructor({amount:e,currency:t}){h(this,"amount",0);h(this,"currency",us);const r=parseFloat(e)||0;this.amount=parseFloat(r.toFixed(2)),this.currency=t}static fromJson(e){const t=new Vt({amount:"0.0",currency:mr.fromJson(e.currency)});return e.amount!=null&&(t.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),t}add(e){e.currency.code===this.currency.code&&(this.amount+=e.amount)}isEqual(e){return this.amount===e.amount&&this.currency.code===e.currency.code}toString(){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.currency.code}).format(this.amount).slice(0,-1)}toJson(){return{amount:this.amount,currency:this.currency.toJson()}}}let m_=class g0{constructor({name:e="",description:t="",id:r="",price:s,imageUrl:i=""}={}){h(this,"description","");h(this,"price");h(this,"imageUrl","");h(this,"id","");h(this,"name","");h(this,"createdAt",new Date);this.name=e||"",this.description=t||"",this.id=r||"",this.price=s,this.imageUrl=i||""}static fromProduct(e){const t=new g0({id:e.id,description:e.description,price:e.price,imageUrl:e.imageUrl,name:e.name});return t.createdAt=e.createdAt,t}static fromJson(e,t){const r=new g0({id:t,description:e.description,price:Vt.fromJson(e.price),imageUrl:e.imageUrl,name:e.name});return r.createdAt=e.createdAt,r}toJson(){return{description:this.description,price:this.price?this.price.toJson():null,imageUrl:this.imageUrl,name:this.name,createdAt:this.createdAt}}toString(){return JSON.stringify(this.toJson())}};class uo{constructor(e,t,r,s,i,o=!1){h(this,"title","");h(this,"content","");h(this,"lastModified","");h(this,"index","");h(this,"id","");h(this,"popOnEnter",!1);this.title=e,this.content=t,this.id=r,this.lastModified=s,this.index=i,this.popOnEnter=o}static fromJson(e,t){return new uo(e.title??"",e.content??"",e.id??"",e.lastModified??"",t,e.popOnEnter??!1)}static fromUpdate(e){return new uo(e.title,e.content,e.id,e.lastModified,e.index,e.popOnEnter)}toJson(){const e={};return e.title=this.title,e.id=this.id,e.content=this.content,this.lastModified!==""&&(e.lastModified=this.lastModified),this.popOnEnter&&(e.popOnEnter=this.popOnEnter),e}isValid(){return this.title!==""&&this.content!==""}toString(){return JSON.stringify(this,null,2)}}class vr{constructor({storyView:e=cr.Grid,productView:t=cr.Grid,changingImagesSwapSeconds:r=6,shopIconUrl:s="",pickedThemeKey:i="darkIos"}={}){h(this,"storyView",cr.Grid);h(this,"productView",cr.Grid);h(this,"changingImages",[]);h(this,"products",new Map);h(this,"updates",new Map);h(this,"storyTitle","");h(this,"shopIconUrl","");h(this,"productsTitle","");h(this,"bottomIcons",!1);h(this,"changingImagesSwapSeconds",6);h(this,"pickedThemeKey","darkIos");h(this,"lastTimeToUpdateTerm",new Date(0));h(this,"businessThemes",new Map);h(this,"term","");h(this,"mustConfirmTerm",!1);h(this,"popTermOnFirstEneter",!1);h(this,"isPrivateTheme",!1);this.changingImagesSwapSeconds=r,this.shopIconUrl=s,this.pickedThemeKey=i}static fromJson(e){const t=new vr;return Object.entries(e.products).forEach(([r,s])=>{t.products.set(r,m_.fromJson(s,r))}),e.changingImages&&(t.changingImages=e.changingImages.map(r=>r)),e.updates&&Object.entries(e.updates).forEach(([r,s])=>{t.updates.set(r,uo.fromJson(s,r))}),e.storyView&&(t.storyView=f_[e.storyView]||cr.EndlessCarousel),e.productView&&(t.productView=f_[e.productView]||cr.Grid),e.businessThemes&&Object.entries(e.businessThemes).forEach(([r,s])=>{t.businessThemes.set(r,_r.fromJson(s,r))}),e.lastTimeToUpdateTerm&&(t.lastTimeToUpdateTerm=new Date(e.lastTimeToUpdateTerm)||new Date(0)),t.pickedThemeKey=e.pickedThemeKey||"darkIoss",t.term=e.term||"",t.bottomIcons=e.bottomIcons||!1,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds||6,t.productsTitle=e.productsTitle||"",t.storyTitle=e.storyTitle||"",t.shopIconUrl=e.shopIcon||"",t.mustConfirmTerm=e.mustConfirmTerm||!1,t.popTermOnFirstEneter=e.popTermOnFirstEneter||!1,t.isPrivateTheme=e.isPrivateTheme||!1,t}get shopIconData(){return Oe.fromShopIconUrl(this.shopIconUrl)}static fromBusinessDesign(e){const t=new vr;return e.products.forEach((r,s)=>{t.products.set(s,m_.fromProduct(r))}),t.changingImages=[...e.changingImages],e.updates.forEach((r,s)=>{t.updates.set(s,uo.fromUpdate(r))}),t.storyView=e.storyView,e.businessThemes.forEach((r,s)=>{t.businessThemes.set(s,_r.fromBusinessTheme(r))}),t.shopIconUrl=e.shopIconUrl,t.pickedThemeKey=e.pickedThemeKey,t.lastTimeToUpdateTerm=e.lastTimeToUpdateTerm,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds,t.term=e.term,t.bottomIcons=e.bottomIcons,t.productsTitle=e.productsTitle,t.productView=e.productView,t.storyTitle=e.storyTitle,t.mustConfirmTerm=e.mustConfirmTerm,t.popTermOnFirstEneter=e.popTermOnFirstEneter,t.isPrivateTheme=e.isPrivateTheme,t}toJson(){const e={};return this.storyView!==cr.EndlessCarousel&&(e.storyView=d_[this.storyView]),this.productView!==cr.Grid&&(e.productView=d_[this.storyView]),e.changingImages=this.changingImages,e.products={},this.products.forEach((t,r)=>{e.products[r]=t.toJson()}),e.updates={},this.updates.forEach((t,r)=>{e.updates[r]=t.toJson()}),this.mustConfirmTerm&&(e.mustConfirmTerm=this.mustConfirmTerm),this.popTermOnFirstEneter&&(e.popTermOnFirstEneter=this.popTermOnFirstEneter),this.term!==""&&(e.term=this.term),this.lastTimeToUpdateTerm!==new Date(0)&&(e.lastTimeToUpdateTerm=Ae(this.lastTimeToUpdateTerm)),e.bottomIcons=this.bottomIcons,e.changingImagesSwapSeconds=this.changingImagesSwapSeconds,e.storyTitle=this.storyTitle,e.productsTitle=this.productsTitle,e.businessThemes={},this.businessThemes.forEach((t,r)=>{pI.hasOwnProperty(r)||(e.businessThemes[r]=t.toJson())}),e.pickedThemeKey=this.pickedThemeKey,e.shopIcon=this.shopIconUrl,e.isPrivateTheme=this.isPrivateTheme,e}}class lo{constructor({businessId:e="",businessName:t="",shopIcon:r=new Oe}={}){h(this,"businessId","");h(this,"shopIcon",new Oe);h(this,"businessName","");this.businessId=e,this.shopIcon=r,this.businessName=t}static empty(){return new lo}static fromJsonStr(e){const t=JSON.parse(e),r=lo.empty();return r.businessId=t.businessId,r.businessName=t.businessName,t.shopIcon&&(r.shopIcon=Oe.fromJsonStr(t.shopIcon)),r}toJsonStr(){const e={businessId:this.businessId,shopIcon:this.shopIcon.toJsonStr(),businessName:this.businessName};return JSON.stringify(e)}}const dF={noPayNoPayment:0,noPayNoPaymentWithReceipts:1,pay100For30WithReceipts:2,pay70For700Actiions:3},fF=15,mF=20;var p_={};const g_="@firebase/database",y_="1.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gI="";function pF(n){gI=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),dt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Na(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return nr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new gF(e)}}catch{}return new yF},Ls=yI("localStorage"),y0=yI("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui=new Ml("@firebase/database"),_F=function(){let n=1;return function(){return n++}}(),_I=function(n){const e=uA(n),t=new iA;t.update(e);const r=t.digest();return W0.encodeByteArray(r)},Uc=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Uc.apply(null,r):typeof r=="object"?e+=dt(r):e+=r,e+=" "}return e};let Hs=null,__=!0;const vF=function(n,e){L(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ui.logLevel=de.VERBOSE,Hs=Ui.log.bind(Ui),e&&y0.set("logging_enabled",!0)):typeof n=="function"?Hs=n:(Hs=null,y0.remove("logging_enabled"))},At=function(...n){if(__===!0&&(__=!1,Hs===null&&y0.get("logging_enabled")===!0&&vF(!0)),Hs){const e=Uc.apply(null,n);Hs(e)}},Wc=function(n){return function(...e){At(n,...e)}},_0=function(...n){const e="FIREBASE INTERNAL ERROR: "+Uc(...n);Ui.error(e)},Nr=function(...n){const e=`FIREBASE FATAL ERROR: ${Uc(...n)}`;throw Ui.error(e),new Error(e)},Qt=function(...n){const e="FIREBASE WARNING: "+Uc(...n);Ui.warn(e)},wF=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Qt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},vp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},xF=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ho="[MIN_NAME]",Zs="[MAX_NAME]",ui=function(n,e){if(n===e)return 0;if(n===ho||e===Zs)return-1;if(e===ho||n===Zs)return 1;{const t=v_(n),r=v_(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},EF=function(n,e){return n===e?0:n<e?-1:1},ra=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+dt(e))},wp=function(n){if(typeof n!="object"||n===null)return dt(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=dt(e[r]),t+=":",t+=wp(n[e[r]]);return t+="}",t},vI=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Pt(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const wI=function(n){L(!vp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,c;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const l=u.join("");let d="";for(c=0;c<64;c+=8){let f=parseInt(l.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},IF=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},TF=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function DF(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const AF=new RegExp("^-?(0*)\\d{1,10}$"),CF=-2147483648,bF=2147483647,v_=function(n){if(AF.test(n)){const e=Number(n);if(e>=CF&&e<=bF)return e}return null},Lo=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Qt("Exception was thrown by user callback.",t),e},Math.floor(0))}},kF=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ea=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SF{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Qt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(At("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Qt(e)}}class Wi{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Wi.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp="5",xI="v",EI="s",II="r",TI="f",DI=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,AI="ls",CI="p",v0="ac",bI="websocket",kI="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(e,t,r,s,i=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ls.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ls.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function RF(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function PI(n,e,t){L(typeof e=="string","typeof type must == string"),L(typeof t=="object","typeof params must == object");let r;if(e===bI)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===kI)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);RF(n)&&(t.ns=n.namespace);const s=[];return Pt(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(){this.counters_={}}incrementCounter(e,t=1){nr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return $D(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Td={},Dd={};function Ep(n){const e=n.toString();return Td[e]||(Td[e]=new NF),Td[e]}function MF(n,e){const t=n.toString();return Dd[t]||(Dd[t]=e()),Dd[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Lo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w_="start",FF="close",BF="pLPCommand",LF="pRTLPCB",RI="id",NI="pw",MI="ser",VF="cb",UF="seg",WF="ts",HF="d",qF="dframe",OI=1870,FI=30,$F=OI-FI,YF=25e3,zF=3e4;class Si{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Wc(e),this.stats_=Ep(t),this.urlFn=c=>(this.appCheckToken&&(c[v0]=this.appCheckToken),PI(t,kI,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new OF(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(zF)),xF(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ip((...i)=>{const[o,a,c,u,l]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===w_)this.id=a,this.password=c;else if(o===FF)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[w_]="t",r[MI]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[VF]=this.scriptTagHolder.uniqueCallbackIdentifier),r[xI]=xp,this.transportSessionId&&(r[EI]=this.transportSessionId),this.lastSessionId&&(r[AI]=this.lastSessionId),this.applicationId&&(r[CI]=this.applicationId),this.appCheckToken&&(r[v0]=this.appCheckToken),typeof location<"u"&&location.hostname&&DI.test(location.hostname)&&(r[II]=TI);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Si.forceAllow_=!0}static forceDisallow(){Si.forceDisallow_=!0}static isAvailable(){return Si.forceAllow_?!0:!Si.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!IF()&&!TF()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=dt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=cw(t),s=vI(r,$F);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[qF]="t",r[RI]=e,r[NI]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=dt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ip{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=_F(),window[BF+this.uniqueCallbackIdentifier]=e,window[LF+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ip.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){At("frame writing exception"),a.stack&&At(a.stack),At(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||At("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[RI]=this.myID,e[NI]=this.myPW,e[MI]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+FI+r.length<=OI;){const o=this.pendingSegs.shift();r=r+"&"+UF+s+"="+o.seg+"&"+WF+s+"="+o.ts+"&"+HF+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(YF)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{At("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GF=16384,JF=45e3;let il=null;typeof MozWebSocket<"u"?il=MozWebSocket:typeof WebSocket<"u"&&(il=WebSocket);class An{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Wc(this.connId),this.stats_=Ep(t),this.connURL=An.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[xI]=xp,typeof location<"u"&&location.hostname&&DI.test(location.hostname)&&(o[II]=TI),t&&(o[EI]=t),r&&(o[AI]=r),s&&(o[v0]=s),i&&(o[CI]=i),PI(e,bI,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ls.set("previous_websocket_failure",!0);try{let r;gw(),this.mySock=new il(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){An.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&il!==null&&!An.forceDisallow_}static previouslyFailed(){return Ls.isInMemoryStorage||Ls.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ls.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Na(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(L(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=dt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=vI(t,GF);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(JF))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}An.responsesRequiredToBeHealthy=2;An.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Si,An]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=An&&An.isAvailable();let r=t&&!An.previouslyFailed();if(e.webSocketOnly&&(t||Qt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[An];else{const s=this.transports_=[];for(const i of tc.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);tc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}tc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QF=6e4,KF=5e3,jF=10*1024,XF=100*1024,Ad="t",x_="d",ZF="s",E_="r",eB="e",I_="o",T_="a",D_="n",A_="p",tB="h";class nB{constructor(e,t,r,s,i,o,a,c,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Wc("c:"+this.id+":"),this.transportManager_=new tc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ea(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>XF?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>jF?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ad in e){const t=e[Ad];t===T_?this.upgradeIfSecondaryHealthy_():t===E_?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===I_&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ra("t",e),r=ra("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:A_,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:T_,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:D_,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ra("t",e),r=ra("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ra(Ad,e);if(x_ in e){const r=e[x_];if(t===tB){const s=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===D_){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ZF?this.onConnectionShutdown_(r):t===E_?this.onReset_(r):t===eB?_0("Server Error: "+r):t===I_?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_0("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),xp!==r&&Qt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Ea(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(QF))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ea(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(KF))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:A_,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ls.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BI{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LI{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol extends LI{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!q0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ol}getInitialEvent(e){return L(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_=32,b_=768;class Ne{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function we(){return new Ne("")}function ue(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ms(n){return n.pieces_.length-n.pieceNum_}function Ue(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Ne(n.pieces_,e)}function Tp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function rB(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function nc(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function VI(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Ne(e,0)}function et(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Ne)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new Ne(t,0)}function he(n){return n.pieceNum_>=n.pieces_.length}function Jt(n,e){const t=ue(n),r=ue(e);if(t===null)return e;if(t===r)return Jt(Ue(n),Ue(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function sB(n,e){const t=nc(n,0),r=nc(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=ui(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function Dp(n,e){if(ms(n)!==ms(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function _n(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(ms(n)>ms(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class iB{constructor(e,t){this.errorPrefix_=t,this.parts_=nc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Nl(this.parts_[r]);UI(this)}}function oB(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Nl(e),UI(n)}function aB(n){const e=n.parts_.pop();n.byteLength_-=Nl(e),n.parts_.length>0&&(n.byteLength_-=1)}function UI(n){if(n.byteLength_>b_)throw new Error(n.errorPrefix_+"has a key path longer than "+b_+" bytes ("+n.byteLength_+").");if(n.parts_.length>C_)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+C_+") or object contains a cycle "+bs(n))}function bs(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap extends LI{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new Ap}getInitialEvent(e){return L(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sa=1e3,cB=60*5*1e3,k_=30*1e3,uB=1.3,lB=3e4,hB="server_kill",S_=3;class Cr extends BI{constructor(e,t,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Cr.nextPersistentConnectionId_++,this.log_=Wc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=sa,this.maxReconnectDelay_=cB,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!gw())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ap.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ol.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(dt(i)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new gc,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),L(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;Cr.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&nr(e,"w")){const r=ji(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Qt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||sA(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=k_)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=rA(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),L(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+dt(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):_0("Unrecognized action received from server: "+dt(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=sa,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=sa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>lB&&(this.reconnectDelay_=sa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*uB)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Cr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(d){L(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:c,sendRequest:u};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?At("getToken() completed but was canceled"):(At("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new nB(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,m=>{Qt(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(hB)},i))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&Qt(d),c())}}}interrupt(e){At("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){At("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Cf(this.interruptReasons_)&&(this.reconnectDelay_=sa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>wp(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new Ne(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){At("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=S_&&(this.reconnectDelay_=k_,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){At("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=S_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+gI.replace(/\./g,"-")]=1,q0()?e["framework.cordova"]=1:pw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ol.getInstance().currentlyOnline();return Cf(this.interruptReasons_)&&e}}Cr.nextPersistentConnectionId_=0;Cr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new le(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new le(ho,e),s=new le(ho,t);return this.compare(r,s)!==0}minPost(){return le.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du;class WI extends Ah{static get __EMPTY_NODE(){return du}static set __EMPTY_NODE(e){du=e}compare(e,t){return ui(e.name,t.name)}isDefinedOn(e){throw Io("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return le.MIN}maxPost(){return new le(Zs,du)}makePost(e,t){return L(typeof e=="string","KeyIndex indexValue must always be a string."),new le(e,du)}toString(){return".key"}}const Hi=new WI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class yt{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??yt.RED,this.left=s??nn.EMPTY_NODE,this.right=i??nn.EMPTY_NODE}copy(e,t,r,s,i){return new yt(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return nn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return nn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}yt.RED=!0;yt.BLACK=!1;class dB{copy(e,t,r,s,i){return this}insert(e,t,r){return new yt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class nn{constructor(e,t=nn.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new nn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,yt.BLACK,null,null))}remove(e){return new nn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,yt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fu(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fu(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fu(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fu(this.root_,null,this.comparator_,!0,e)}}nn.EMPTY_NODE=new dB;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fB(n,e){return ui(n.name,e.name)}function Cp(n,e){return ui(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let w0;function mB(n){w0=n}const HI=function(n){return typeof n=="number"?"number:"+wI(n):"string:"+n},qI=function(n){if(n.isLeafNode()){const e=n.val();L(typeof e=="string"||typeof e=="number"||typeof e=="object"&&nr(e,".sv"),"Priority must be a string or number.")}else L(n===w0||n.isEmpty(),"priority of unexpected type.");L(n===w0||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let P_;class pt{constructor(e,t=pt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,L(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),qI(this.priorityNode_)}static set __childrenNodeConstructor(e){P_=e}static get __childrenNodeConstructor(){return P_}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new pt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:pt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return he(e)?this:ue(e)===".priority"?this.priorityNode_:pt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:pt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=ue(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(L(r!==".priority"||ms(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,pt.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ue(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+HI(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=wI(this.value_):e+=this.value_,this.lazyHash_=_I(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===pt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof pt.__childrenNodeConstructor?-1:(L(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=pt.VALUE_TYPE_ORDER.indexOf(t),i=pt.VALUE_TYPE_ORDER.indexOf(r);return L(s>=0,"Unknown leaf type: "+t),L(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}pt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $I,YI;function pB(n){$I=n}function gB(n){YI=n}class yB extends Ah{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?ui(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return le.MIN}maxPost(){return new le(Zs,new pt("[PRIORITY-POST]",YI))}makePost(e,t){const r=$I(e);return new le(t,new pt("[PRIORITY-POST]",r))}toString(){return".priority"}}const tt=new yB;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _B=Math.log(2);class vB{constructor(e){const t=i=>parseInt(Math.log(i)/_B,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const al=function(n,e,t,r){n.sort(e);const s=function(c,u){const l=u-c;let d,f;if(l===0)return null;if(l===1)return d=n[c],f=t?t(d):d,new yt(f,d.node,yt.BLACK,null,null);{const m=parseInt(l/2,10)+c,p=s(c,m),y=s(m+1,u);return d=n[m],f=t?t(d):d,new yt(f,d.node,yt.BLACK,p,y)}},i=function(c){let u=null,l=null,d=n.length;const f=function(p,y){const g=d-p,x=d;d-=p;const _=s(g+1,x),v=n[g],w=t?t(v):v;m(new yt(w,v.node,y,null,_))},m=function(p){u?(u.left=p,u=p):(l=p,u=p)};for(let p=0;p<c.count;++p){const y=c.nextBitIsOne(),g=Math.pow(2,c.count-(p+1));y?f(g,yt.BLACK):(f(g,yt.BLACK),f(g,yt.RED))}return l},o=new vB(n.length),a=i(o);return new nn(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cd;const xi={};class wr{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return L(xi&&tt,"ChildrenNode.ts has not been loaded"),Cd=Cd||new wr({".priority":xi},{".priority":tt}),Cd}get(e){const t=ji(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof nn?t:null}hasIndex(e){return nr(this.indexSet_,e.toString())}addIndex(e,t){L(e!==Hi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(le.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=al(r,e.getCompare()):a=xi;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const l=Object.assign({},this.indexes_);return l[c]=a,new wr(l,u)}addToIndexes(e,t){const r=Ru(this.indexes_,(s,i)=>{const o=ji(this.indexSet_,i);if(L(o,"Missing index implementation for "+i),s===xi)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(le.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),al(a,o.getCompare())}else return xi;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new le(e.name,a))),c.insert(e,e.node)}});return new wr(r,this.indexSet_)}removeFromIndexes(e,t){const r=Ru(this.indexes_,s=>{if(s===xi)return s;{const i=t.get(e.name);return i?s.remove(new le(e.name,i)):s}});return new wr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ia;class Z{constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&qI(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ia||(ia=new Z(new nn(Cp),null,wr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ia}updatePriority(e){return this.children_.isEmpty()?this:new Z(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ia:t}}getChild(e){const t=ue(e);return t===null?this:this.getImmediateChild(t).getChild(Ue(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(L(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new le(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?ia:this.priorityNode_;return new Z(s,o,i)}}updateChild(e,t){const r=ue(e);if(r===null)return t;{L(ue(e)!==".priority"||ms(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Ue(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(tt,(o,a)=>{t[o]=a.val(e),r++,i&&Z.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+HI(this.getPriority().val())+":"),this.forEachChild(tt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":_I(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new le(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new le(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new le(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,le.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,le.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Hc?-1:0}withIndex(e){if(e===Hi||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Z(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Hi||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(tt),s=t.getIterator(tt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Hi?null:this.indexMap_.get(e.toString())}}Z.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class wB extends Z{constructor(){super(new nn(Cp),Z.EMPTY_NODE,wr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Z.EMPTY_NODE}isEmpty(){return!1}}const Hc=new wB;Object.defineProperties(le,{MIN:{value:new le(ho,Z.EMPTY_NODE)},MAX:{value:new le(Zs,Hc)}});WI.__EMPTY_NODE=Z.EMPTY_NODE;pt.__childrenNodeConstructor=Z;mB(Hc);gB(Hc);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xB=!0;function ht(n,e=null){if(n===null)return Z.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),L(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new pt(t,ht(e))}if(!(n instanceof Array)&&xB){const t=[];let r=!1;if(Pt(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=ht(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new le(o,c)))}}),t.length===0)return Z.EMPTY_NODE;const i=al(t,fB,o=>o.name,Cp);if(r){const o=al(t,tt.getCompare());return new Z(i,ht(e),new wr({".priority":o},{".priority":tt}))}else return new Z(i,ht(e),wr.Default)}else{let t=Z.EMPTY_NODE;return Pt(n,(r,s)=>{if(nr(n,r)&&r.substring(0,1)!=="."){const i=ht(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(ht(e))}}pB(ht);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB extends Ah{constructor(e){super(),this.indexPath_=e,L(!he(e)&&ue(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?ui(e.name,t.name):i}makePost(e,t){const r=ht(e),s=Z.EMPTY_NODE.updateChild(this.indexPath_,r);return new le(t,s)}maxPost(){const e=Z.EMPTY_NODE.updateChild(this.indexPath_,Hc);return new le(Zs,e)}toString(){return nc(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IB extends Ah{compare(e,t){const r=e.node.compareTo(t.node);return r===0?ui(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return le.MIN}maxPost(){return le.MAX}makePost(e,t){const r=ht(e);return new le(t,r)}toString(){return".value"}}const TB=new IB;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zI(n){return{type:"value",snapshotNode:n}}function fo(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function rc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function sc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function DB(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(rc(t,a)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(fo(t,r)):o.trackChildChange(sc(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(tt,(s,i)=>{t.hasChild(s)||r.trackChildChange(rc(s,i))}),t.isLeafNode()||t.forEachChild(tt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(sc(s,i,o))}else r.trackChildChange(fo(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Z.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(e){this.indexedFilter_=new bp(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ic.getStartPost_(e),this.endPost_=ic.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new le(t,r))||(r=Z.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Z.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Z.EMPTY_NODE);const i=this;return t.forEachChild(tt,(o,a)=>{i.matches(new le(o,a))||(s=s.updateImmediateChild(o,Z.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AB{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new ic(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new le(t,r))||(r=Z.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Z.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Z.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Z.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Z.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,m)=>d(m,f)}else o=this.index_.getCompare();const a=e;L(a.numChildren()===this.limit_,"");const c=new le(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(a.hasChild(t)){const d=a.getImmediateChild(t);let f=s.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===t||a.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,c);if(l&&!r.isEmpty()&&m>=0)return i!=null&&i.trackChildChange(sc(t,r,d)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(rc(t,d));const y=a.updateImmediateChild(t,Z.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(fo(f.name,f.node)),y.updateImmediateChild(f.name,f.node)):y}}else return r.isEmpty()?e:l&&o(u,c)>=0?(i!=null&&(i.trackChildChange(rc(u.name,u.node)),i.trackChildChange(fo(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Z.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=tt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return L(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ho}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return L(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Zs}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===tt}copy(){const e=new kp;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function CB(n){return n.loadsAllData()?new bp(n.getIndex()):n.hasLimit()?new AB(n):new ic(n)}function R_(n){const e={};if(n.isDefault())return e;let t;if(n.index_===tt?t="$priority":n.index_===TB?t="$value":n.index_===Hi?t="$key":(L(n.index_ instanceof EB,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=dt(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=dt(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+dt(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=dt(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+dt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function N_(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==tt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl extends BI{constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Wc("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=cl.getListenId_(e,r),a={};this.listens_[o]=a;const c=R_(e._queryParams);this.restRequest_(i+".json",c,(u,l)=>{let d=l;if(u===404&&(d=null,u=null),u===null&&this.onDataUpdate_(i,d,!1,r),ji(this.listens_,o)===a){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",s(f,null)}})}unlisten(e,t){const r=cl.getListenId_(e,t);delete this.listens_[r]}get(e){const t=R_(e._queryParams),r=e._path.toString(),s=new gc;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+To(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Na(a.responseText)}catch{Qt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&Qt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bB{constructor(){this.rootNode_=Z.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ul(){return{value:null,children:new Map}}function GI(n,e,t){if(he(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=ue(e);n.children.has(r)||n.children.set(r,ul());const s=n.children.get(r);e=Ue(e),GI(s,e,t)}}function x0(n,e,t){n.value!==null?t(e,n.value):kB(n,(r,s)=>{const i=new Ne(e.toString()+"/"+r);x0(s,i,t)})}function kB(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SB{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Pt(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M_=10*1e3,PB=30*1e3,RB=5*60*1e3;class NB{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new SB(e);const r=M_+(PB-M_)*Math.random();Ea(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Pt(e,(s,i)=>{i>0&&nr(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Ea(this.reportStats_.bind(this),Math.floor(Math.random()*2*RB))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(kn||(kn={}));function Sp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Pp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Rp(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=kn.ACK_USER_WRITE,this.source=Sp()}operationForChild(e){if(he(this.path)){if(this.affectedTree.value!=null)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Ne(e));return new ll(we(),t,this.revert)}}else return L(ue(this.path)===e,"operationForChild called for unrelated child."),new ll(Ue(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e,t){this.source=e,this.path=t,this.type=kn.LISTEN_COMPLETE}operationForChild(e){return he(this.path)?new oc(this.source,we()):new oc(this.source,Ue(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=kn.OVERWRITE}operationForChild(e){return he(this.path)?new ei(this.source,we(),this.snap.getImmediateChild(e)):new ei(this.source,Ue(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=kn.MERGE}operationForChild(e){if(he(this.path)){const t=this.children.subtree(new Ne(e));return t.isEmpty()?null:t.value?new ei(this.source,we(),t.value):new mo(this.source,we(),t)}else return L(ue(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new mo(this.source,Ue(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(he(e))return this.isFullyInitialized()&&!this.filtered_;const t=ue(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MB{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function OB(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(DB(o.childName,o.snapshotNode))}),oa(n,s,"child_removed",e,r,t),oa(n,s,"child_added",e,r,t),oa(n,s,"child_moved",i,r,t),oa(n,s,"child_changed",e,r,t),oa(n,s,"value",e,r,t),s}function oa(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,c)=>BB(n,a,c)),o.forEach(a=>{const c=FB(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function FB(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function BB(n,e,t){if(e.childName==null||t.childName==null)throw Io("Should only compare child_ events.");const r=new le(e.childName,e.snapshotNode),s=new le(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ch(n,e){return{eventCache:n,serverCache:e}}function Ia(n,e,t,r){return Ch(new ps(e,t,r),n.serverCache)}function JI(n,e,t,r){return Ch(n.eventCache,new ps(e,t,r))}function hl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ti(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bd;const LB=()=>(bd||(bd=new nn(EF)),bd);class Ve{constructor(e,t=LB()){this.value=e,this.children=t}static fromObject(e){let t=new Ve(null);return Pt(e,(r,s)=>{t=t.set(new Ne(r),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:we(),value:this.value};if(he(e))return null;{const r=ue(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Ue(e),t);return i!=null?{path:et(new Ne(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(he(e))return this;{const t=ue(e),r=this.children.get(t);return r!==null?r.subtree(Ue(e)):new Ve(null)}}set(e,t){if(he(e))return new Ve(t,this.children);{const r=ue(e),i=(this.children.get(r)||new Ve(null)).set(Ue(e),t),o=this.children.insert(r,i);return new Ve(this.value,o)}}remove(e){if(he(e))return this.children.isEmpty()?new Ve(null):new Ve(null,this.children);{const t=ue(e),r=this.children.get(t);if(r){const s=r.remove(Ue(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new Ve(null):new Ve(this.value,i)}else return this}}get(e){if(he(e))return this.value;{const t=ue(e),r=this.children.get(t);return r?r.get(Ue(e)):null}}setTree(e,t){if(he(e))return t;{const r=ue(e),i=(this.children.get(r)||new Ve(null)).setTree(Ue(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ve(this.value,o)}}fold(e){return this.fold_(we(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(et(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,we(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(he(e))return null;{const i=ue(e),o=this.children.get(i);return o?o.findOnPath_(Ue(e),et(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,we(),t)}foreachOnPath_(e,t,r){if(he(e))return this;{this.value&&r(t,this.value);const s=ue(e),i=this.children.get(s);return i?i.foreachOnPath_(Ue(e),et(t,s),r):new Ve(null)}}foreach(e){this.foreach_(we(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(et(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.writeTree_=e}static empty(){return new Sn(new Ve(null))}}function Ta(n,e,t){if(he(e))return new Sn(new Ve(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Jt(s,e);return i=i.updateChild(o,t),new Sn(n.writeTree_.set(s,i))}else{const s=new Ve(t),i=n.writeTree_.setTree(e,s);return new Sn(i)}}}function E0(n,e,t){let r=n;return Pt(t,(s,i)=>{r=Ta(r,et(e,s),i)}),r}function O_(n,e){if(he(e))return Sn.empty();{const t=n.writeTree_.setTree(e,new Ve(null));return new Sn(t)}}function I0(n,e){return li(n,e)!=null}function li(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Jt(t.path,e)):null}function F_(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(tt,(r,s)=>{e.push(new le(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new le(r,s.value))}),e}function is(n,e){if(he(e))return n;{const t=li(n,e);return t!=null?new Sn(new Ve(t)):new Sn(n.writeTree_.subtree(e))}}function T0(n){return n.writeTree_.isEmpty()}function po(n,e){return QI(we(),n.writeTree_,e)}function QI(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(L(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=QI(et(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(et(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bh(n,e){return ZI(e,n)}function VB(n,e,t,r,s){L(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=Ta(n.visibleWrites,e,t)),n.lastWriteId=r}function UB(n,e,t,r){L(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=E0(n.visibleWrites,e,t),n.lastWriteId=r}function WB(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function HB(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);L(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&qB(a,r.path)?s=!1:_n(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return $B(n),!0;if(r.snap)n.visibleWrites=O_(n.visibleWrites,r.path);else{const a=r.children;Pt(a,c=>{n.visibleWrites=O_(n.visibleWrites,et(r.path,c))})}return!0}else return!1}function qB(n,e){if(n.snap)return _n(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&_n(et(n.path,t),e))return!0;return!1}function $B(n){n.visibleWrites=KI(n.allWrites,YB,we()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function YB(n){return n.visible}function KI(n,e,t){let r=Sn.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)_n(t,o)?(a=Jt(t,o),r=Ta(r,a,i.snap)):_n(o,t)&&(a=Jt(o,t),r=Ta(r,we(),i.snap.getChild(a)));else if(i.children){if(_n(t,o))a=Jt(t,o),r=E0(r,a,i.children);else if(_n(o,t))if(a=Jt(o,t),he(a))r=E0(r,we(),i.children);else{const c=ji(i.children,ue(a));if(c){const u=c.getChild(Ue(a));r=Ta(r,we(),u)}}}else throw Io("WriteRecord should have .snap or .children")}}return r}function jI(n,e,t,r,s){if(!r&&!s){const i=li(n.visibleWrites,e);if(i!=null)return i;{const o=is(n.visibleWrites,e);if(T0(o))return t;if(t==null&&!I0(o,we()))return null;{const a=t||Z.EMPTY_NODE;return po(o,a)}}}else{const i=is(n.visibleWrites,e);if(!s&&T0(i))return t;if(!s&&t==null&&!I0(i,we()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(_n(u.path,e)||_n(e,u.path))},a=KI(n.allWrites,o,e),c=t||Z.EMPTY_NODE;return po(a,c)}}}function zB(n,e,t){let r=Z.EMPTY_NODE;const s=li(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(tt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=is(n.visibleWrites,e);return t.forEachChild(tt,(o,a)=>{const c=po(is(i,new Ne(o)),a);r=r.updateImmediateChild(o,c)}),F_(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=is(n.visibleWrites,e);return F_(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function GB(n,e,t,r,s){L(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=et(e,t);if(I0(n.visibleWrites,i))return null;{const o=is(n.visibleWrites,i);return T0(o)?s.getChild(t):po(o,s.getChild(t))}}function JB(n,e,t,r){const s=et(e,t),i=li(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=is(n.visibleWrites,s);return po(o,r.getNode().getImmediateChild(t))}else return null}function QB(n,e){return li(n.visibleWrites,e)}function KB(n,e,t,r,s,i,o){let a;const c=is(n.visibleWrites,e),u=li(c,we());if(u!=null)a=u;else if(t!=null)a=po(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const l=[],d=o.getCompare(),f=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let m=f.getNext();for(;m&&l.length<s;)d(m,r)!==0&&l.push(m),m=f.getNext();return l}else return[]}function jB(){return{visibleWrites:Sn.empty(),allWrites:[],lastWriteId:-1}}function dl(n,e,t,r){return jI(n.writeTree,n.treePath,e,t,r)}function Np(n,e){return zB(n.writeTree,n.treePath,e)}function B_(n,e,t,r){return GB(n.writeTree,n.treePath,e,t,r)}function fl(n,e){return QB(n.writeTree,et(n.treePath,e))}function XB(n,e,t,r,s,i){return KB(n.writeTree,n.treePath,e,t,r,s,i)}function Mp(n,e,t){return JB(n.writeTree,n.treePath,e,t)}function XI(n,e){return ZI(et(n.treePath,e),n.writeTree)}function ZI(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZB{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;L(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),L(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,sc(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,rc(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,fo(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,sc(r,e.snapshotNode,s.oldSnap));else throw Io("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const eT=new e6;class Op{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new ps(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Mp(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ti(this.viewCache_),i=XB(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t6(n){return{filter:n}}function n6(n,e){L(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),L(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function r6(n,e,t,r,s){const i=new ZB;let o,a;if(t.type===kn.OVERWRITE){const u=t;u.source.fromUser?o=D0(n,e,u.path,u.snap,r,s,i):(L(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!he(u.path),o=ml(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===kn.MERGE){const u=t;u.source.fromUser?o=i6(n,e,u.path,u.children,r,s,i):(L(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=A0(n,e,u.path,u.children,r,s,a,i))}else if(t.type===kn.ACK_USER_WRITE){const u=t;u.revert?o=c6(n,e,u.path,r,s,i):o=o6(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===kn.LISTEN_COMPLETE)o=a6(n,e,t.path,r,i);else throw Io("Unknown operation type: "+t.type);const c=i.getChanges();return s6(e,o,c),{viewCache:o,changes:c}}function s6(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=hl(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(zI(hl(e)))}}function tT(n,e,t,r,s,i){const o=e.eventCache;if(fl(r,t)!=null)return e;{let a,c;if(he(t))if(L(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=ti(e),l=u instanceof Z?u:Z.EMPTY_NODE,d=Np(r,l);a=n.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const u=dl(r,ti(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=ue(t);if(u===".priority"){L(ms(t)===1,"Can't have a priority with additional path components");const l=o.getNode();c=e.serverCache.getNode();const d=B_(r,t,l,c);d!=null?a=n.filter.updatePriority(l,d):a=o.getNode()}else{const l=Ue(t);let d;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const f=B_(r,t,o.getNode(),c);f!=null?d=o.getNode().getImmediateChild(u).updateChild(l,f):d=o.getNode().getImmediateChild(u)}else d=Mp(r,u,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),u,d,l,s,i):a=o.getNode()}}return Ia(e,a,o.isFullyInitialized()||he(t),n.filter.filtersNodes())}}function ml(n,e,t,r,s,i,o,a){const c=e.serverCache;let u;const l=o?n.filter:n.filter.getIndexedFilter();if(he(t))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(t,r);u=l.updateFullNode(c.getNode(),m,null)}else{const m=ue(t);if(!c.isCompleteForPath(t)&&ms(t)>1)return e;const p=Ue(t),g=c.getNode().getImmediateChild(m).updateChild(p,r);m===".priority"?u=l.updatePriority(c.getNode(),g):u=l.updateChild(c.getNode(),m,g,p,eT,null)}const d=JI(e,u,c.isFullyInitialized()||he(t),l.filtersNodes()),f=new Op(s,d,i);return tT(n,d,t,s,f,a)}function D0(n,e,t,r,s,i,o){const a=e.eventCache;let c,u;const l=new Op(s,e,i);if(he(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Ia(e,u,!0,n.filter.filtersNodes());else{const d=ue(t);if(d===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=Ia(e,u,a.isFullyInitialized(),a.isFiltered());else{const f=Ue(t),m=a.getNode().getImmediateChild(d);let p;if(he(f))p=r;else{const y=l.getCompleteChild(d);y!=null?Tp(f)===".priority"&&y.getChild(VI(f)).isEmpty()?p=y:p=y.updateChild(f,r):p=Z.EMPTY_NODE}if(m.equals(p))c=e;else{const y=n.filter.updateChild(a.getNode(),d,p,f,l,o);c=Ia(e,y,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function L_(n,e){return n.eventCache.isCompleteForChild(e)}function i6(n,e,t,r,s,i,o){let a=e;return r.foreach((c,u)=>{const l=et(t,c);L_(e,ue(l))&&(a=D0(n,a,l,u,s,i,o))}),r.foreach((c,u)=>{const l=et(t,c);L_(e,ue(l))||(a=D0(n,a,l,u,s,i,o))}),a}function V_(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function A0(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;he(t)?u=r:u=new Ve(null).setTree(t,r);const l=e.serverCache.getNode();return u.children.inorderTraversal((d,f)=>{if(l.hasChild(d)){const m=e.serverCache.getNode().getImmediateChild(d),p=V_(n,m,f);c=ml(n,c,new Ne(d),p,s,i,o,a)}}),u.children.inorderTraversal((d,f)=>{const m=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!l.hasChild(d)&&!m){const p=e.serverCache.getNode().getImmediateChild(d),y=V_(n,p,f);c=ml(n,c,new Ne(d),y,s,i,o,a)}}),c}function o6(n,e,t,r,s,i,o){if(fl(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(he(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return ml(n,e,t,c.getNode().getChild(t),s,i,a,o);if(he(t)){let u=new Ve(null);return c.getNode().forEachChild(Hi,(l,d)=>{u=u.set(new Ne(l),d)}),A0(n,e,t,u,s,i,a,o)}else return e}else{let u=new Ve(null);return r.foreach((l,d)=>{const f=et(t,l);c.isCompleteForPath(f)&&(u=u.set(l,c.getNode().getChild(f)))}),A0(n,e,t,u,s,i,a,o)}}function a6(n,e,t,r,s){const i=e.serverCache,o=JI(e,i.getNode(),i.isFullyInitialized()||he(t),i.isFiltered());return tT(n,o,t,r,eT,s)}function c6(n,e,t,r,s,i){let o;if(fl(r,t)!=null)return e;{const a=new Op(r,e,s),c=e.eventCache.getNode();let u;if(he(t)||ue(t)===".priority"){let l;if(e.serverCache.isFullyInitialized())l=dl(r,ti(e));else{const d=e.serverCache.getNode();L(d instanceof Z,"serverChildren would be complete if leaf node"),l=Np(r,d)}l=l,u=n.filter.updateFullNode(c,l,i)}else{const l=ue(t);let d=Mp(r,l,e.serverCache);d==null&&e.serverCache.isCompleteForChild(l)&&(d=c.getImmediateChild(l)),d!=null?u=n.filter.updateChild(c,l,d,Ue(t),a,i):e.eventCache.getNode().hasChild(l)?u=n.filter.updateChild(c,l,Z.EMPTY_NODE,Ue(t),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=dl(r,ti(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||fl(r,we())!=null,Ia(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u6{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new bp(r.getIndex()),i=CB(r);this.processor_=t6(i);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(Z.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Z.EMPTY_NODE,a.getNode(),null),l=new ps(c,o.isFullyInitialized(),s.filtersNodes()),d=new ps(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ch(d,l),this.eventGenerator_=new MB(this.query_)}get query(){return this.query_}}function l6(n){return n.viewCache_.serverCache.getNode()}function h6(n){return hl(n.viewCache_)}function d6(n,e){const t=ti(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!he(e)&&!t.getImmediateChild(ue(e)).isEmpty())?t.getChild(e):null}function U_(n){return n.eventRegistrations_.length===0}function f6(n,e){n.eventRegistrations_.push(e)}function W_(n,e,t){const r=[];if(t){L(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function H_(n,e,t,r){e.type===kn.MERGE&&e.source.queryId!==null&&(L(ti(n.viewCache_),"We should always have a full cache before handling merges"),L(hl(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=r6(n.processor_,s,e,t,r);return n6(n.processor_,i.viewCache),L(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,nT(n,i.changes,i.viewCache.eventCache.getNode(),null)}function m6(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(tt,(i,o)=>{r.push(fo(i,o))}),t.isFullyInitialized()&&r.push(zI(t.getNode())),nT(n,r,t.getNode(),e)}function nT(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return OB(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pl;class rT{constructor(){this.views=new Map}}function p6(n){L(!pl,"__referenceConstructor has already been defined"),pl=n}function g6(){return L(pl,"Reference.ts has not been loaded"),pl}function y6(n){return n.views.size===0}function Fp(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return L(i!=null,"SyncTree gave us an op for an invalid query."),H_(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(H_(o,e,t,r));return i}}function sT(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=dl(t,s?r:null),c=!1;a?c=!0:r instanceof Z?(a=Np(t,r),c=!1):(a=Z.EMPTY_NODE,c=!1);const u=Ch(new ps(a,c,!1),new ps(r,s,!1));return new u6(e,u)}return o}function _6(n,e,t,r,s,i){const o=sT(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),f6(o,t),m6(o,t)}function v6(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=gs(n);if(s==="default")for(const[c,u]of n.views.entries())o=o.concat(W_(u,t,r)),U_(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=n.views.get(s);c&&(o=o.concat(W_(c,t,r)),U_(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!gs(n)&&i.push(new(g6())(e._repo,e._path)),{removed:i,events:o}}function iT(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function os(n,e){let t=null;for(const r of n.views.values())t=t||d6(r,e);return t}function oT(n,e){if(e._queryParams.loadsAllData())return kh(n);{const r=e._queryIdentifier;return n.views.get(r)}}function aT(n,e){return oT(n,e)!=null}function gs(n){return kh(n)!=null}function kh(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gl;function w6(n){L(!gl,"__referenceConstructor has already been defined"),gl=n}function x6(){return L(gl,"Reference.ts has not been loaded"),gl}let E6=1;class q_{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ve(null),this.pendingWriteTree_=jB(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cT(n,e,t,r,s){return VB(n.pendingWriteTree_,e,t,r,s),s?Vo(n,new ei(Sp(),e,t)):[]}function I6(n,e,t,r){UB(n.pendingWriteTree_,e,t,r);const s=Ve.fromObject(t);return Vo(n,new mo(Sp(),e,s))}function Zr(n,e,t=!1){const r=WB(n.pendingWriteTree_,e);if(HB(n.pendingWriteTree_,e)){let i=new Ve(null);return r.snap!=null?i=i.set(we(),!0):Pt(r.children,o=>{i=i.set(new Ne(o),!0)}),Vo(n,new ll(r.path,i,t))}else return[]}function qc(n,e,t){return Vo(n,new ei(Pp(),e,t))}function T6(n,e,t){const r=Ve.fromObject(t);return Vo(n,new mo(Pp(),e,r))}function D6(n,e){return Vo(n,new oc(Pp(),e))}function A6(n,e,t){const r=Lp(n,t);if(r){const s=Vp(r),i=s.path,o=s.queryId,a=Jt(i,e),c=new oc(Rp(o),a);return Up(n,i,c)}else return[]}function yl(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||aT(o,e))){const c=v6(o,e,t,r);y6(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const l=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(i,(f,m)=>gs(m));if(l&&!d){const f=n.syncPointTree_.subtree(i);if(!f.isEmpty()){const m=k6(f);for(let p=0;p<m.length;++p){const y=m[p],g=y.query,x=dT(n,y);n.listenProvider_.startListening(Da(g),ac(n,g),x.hashFn,x.onComplete)}}}!d&&u.length>0&&!r&&(l?n.listenProvider_.stopListening(Da(e),null):u.forEach(f=>{const m=n.queryToTagMap.get(Sh(f));n.listenProvider_.stopListening(Da(f),m)}))}S6(n,u)}return a}function uT(n,e,t,r){const s=Lp(n,r);if(s!=null){const i=Vp(s),o=i.path,a=i.queryId,c=Jt(o,e),u=new ei(Rp(a),c,t);return Up(n,o,u)}else return[]}function C6(n,e,t,r){const s=Lp(n,r);if(s){const i=Vp(s),o=i.path,a=i.queryId,c=Jt(o,e),u=Ve.fromObject(t),l=new mo(Rp(a),c,u);return Up(n,o,l)}else return[]}function C0(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(f,m)=>{const p=Jt(f,s);i=i||os(m,p),o=o||gs(m)});let a=n.syncPointTree_.get(s);a?(o=o||gs(a),i=i||os(a,we())):(a=new rT,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=Z.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((m,p)=>{const y=os(p,we());y&&(i=i.updateImmediateChild(m,y))}));const u=aT(a,e);if(!u&&!e._queryParams.loadsAllData()){const f=Sh(e);L(!n.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=P6();n.queryToTagMap.set(f,m),n.tagToQueryMap.set(m,f)}const l=bh(n.pendingWriteTree_,s);let d=_6(a,e,t,l,i,c);if(!u&&!o&&!r){const f=oT(a,e);d=d.concat(R6(n,e,f))}return d}function Bp(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=Jt(o,e),u=os(a,c);if(u)return u});return jI(s,e,i,t,!0)}function b6(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,l)=>{const d=Jt(u,t);r=r||os(l,d)});let s=n.syncPointTree_.get(t);s?r=r||os(s,we()):(s=new rT,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new ps(r,!0,!1):null,a=bh(n.pendingWriteTree_,e._path),c=sT(s,e,a,i?o.getNode():Z.EMPTY_NODE,i);return h6(c)}function Vo(n,e){return lT(e,n.syncPointTree_,null,bh(n.pendingWriteTree_,we()))}function lT(n,e,t,r){if(he(n.path))return hT(n,e,t,r);{const s=e.get(we());t==null&&s!=null&&(t=os(s,we()));let i=[];const o=ue(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,l=XI(r,o);i=i.concat(lT(a,c,u,l))}return s&&(i=i.concat(Fp(s,n,r,t))),i}}function hT(n,e,t,r){const s=e.get(we());t==null&&s!=null&&(t=os(s,we()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=XI(r,o),l=n.operationForChild(o);l&&(i=i.concat(hT(l,a,c,u)))}),s&&(i=i.concat(Fp(s,n,r,t))),i}function dT(n,e){const t=e.query,r=ac(n,t);return{hashFn:()=>(l6(e)||Z.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?A6(n,t._path,r):D6(n,t._path);{const i=DF(s,t);return yl(n,t,null,i)}}}}function ac(n,e){const t=Sh(e);return n.queryToTagMap.get(t)}function Sh(n){return n._path.toString()+"$"+n._queryIdentifier}function Lp(n,e){return n.tagToQueryMap.get(e)}function Vp(n){const e=n.indexOf("$");return L(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Ne(n.substr(0,e))}}function Up(n,e,t){const r=n.syncPointTree_.get(e);L(r,"Missing sync point for query tag that we're tracking");const s=bh(n.pendingWriteTree_,e);return Fp(r,t,s,null)}function k6(n){return n.fold((e,t,r)=>{if(t&&gs(t))return[kh(t)];{let s=[];return t&&(s=iT(t)),Pt(r,(i,o)=>{s=s.concat(o)}),s}})}function Da(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(x6())(n._repo,n._path):n}function S6(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=Sh(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function P6(){return E6++}function R6(n,e,t){const r=e._path,s=ac(n,e),i=dT(n,t),o=n.listenProvider_.startListening(Da(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)L(!gs(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,l,d)=>{if(!he(u)&&l&&gs(l))return[kh(l).query];{let f=[];return l&&(f=f.concat(iT(l).map(m=>m.query))),Pt(d,(m,p)=>{f=f.concat(p)}),f}});for(let u=0;u<c.length;++u){const l=c[u];n.listenProvider_.stopListening(Da(l),ac(n,l))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Wp(t)}node(){return this.node_}}class Hp{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=et(this.path_,e);return new Hp(this.syncTree_,t)}node(){return Bp(this.syncTree_,this.path_)}}const N6=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},$_=function(n,e,t){if(!n||typeof n!="object")return n;if(L(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return M6(n[".sv"],e,t);if(typeof n[".sv"]=="object")return O6(n[".sv"],e);L(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},M6=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:L(!1,"Unexpected server value: "+n)}},O6=function(n,e,t){n.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&L(!1,"Unexpected increment value: "+r);const s=e.node();if(L(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},fT=function(n,e,t,r){return qp(e,new Hp(t,n),r)},mT=function(n,e,t){return qp(n,new Wp(e),t)};function qp(n,e,t){const r=n.getPriority().val(),s=$_(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=$_(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new pt(a,ht(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new pt(s))),o.forEachChild(tt,(a,c)=>{const u=qp(c,e.getImmediateChild(a),t);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Yp(n,e){let t=e instanceof Ne?e:new Ne(e),r=n,s=ue(t);for(;s!==null;){const i=ji(r.node.children,s)||{children:{},childCount:0};r=new $p(s,r,i),t=Ue(t),s=ue(t)}return r}function Uo(n){return n.node.value}function pT(n,e){n.node.value=e,b0(n)}function gT(n){return n.node.childCount>0}function F6(n){return Uo(n)===void 0&&!gT(n)}function Ph(n,e){Pt(n.node.children,(t,r)=>{e(new $p(t,n,r))})}function yT(n,e,t,r){t&&!r&&e(n),Ph(n,s=>{yT(s,e,!0,r)}),t&&r&&e(n)}function B6(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function $c(n){return new Ne(n.parent===null?n.name:$c(n.parent)+"/"+n.name)}function b0(n){n.parent!==null&&L6(n.parent,n.name,n)}function L6(n,e,t){const r=F6(t),s=nr(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,b0(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,b0(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V6=/[\[\].#$\/\u0000-\u001F\u007F]/,U6=/[\[\].#$\u0000-\u001F\u007F]/,kd=10*1024*1024,zp=function(n){return typeof n=="string"&&n.length!==0&&!V6.test(n)},_T=function(n){return typeof n=="string"&&n.length!==0&&!U6.test(n)},W6=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),_T(n)},H6=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!vp(n)||n&&typeof n=="object"&&nr(n,".sv")},q6=function(n,e,t,r){r&&e===void 0||Rh(Rl(n,"value"),e,t)},Rh=function(n,e,t){const r=t instanceof Ne?new iB(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+bs(r));if(typeof e=="function")throw new Error(n+"contains a function "+bs(r)+" with contents = "+e.toString());if(vp(e))throw new Error(n+"contains "+e.toString()+" "+bs(r));if(typeof e=="string"&&e.length>kd/3&&Nl(e)>kd)throw new Error(n+"contains a string greater than "+kd+" utf8 bytes "+bs(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Pt(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!zp(o)))throw new Error(n+" contains an invalid key ("+o+") "+bs(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);oB(r,o),Rh(n,a,r),aB(r)}),s&&i)throw new Error(n+' contains ".value" child '+bs(r)+" in addition to actual children.")}},$6=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=nc(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!zp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(sB);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&_n(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},Y6=function(n,e,t,r){if(r&&e===void 0)return;const s=Rl(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Pt(e,(o,a)=>{const c=new Ne(o);if(Rh(s,a,et(t,c)),Tp(c)===".priority"&&!H6(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),$6(s,i)},vT=function(n,e,t,r){if(!(r&&t===void 0)&&!_T(t))throw new Error(Rl(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},z6=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),vT(n,e,t,r)},wT=function(n,e){if(ue(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},G6=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!zp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!W6(t))throw new Error(Rl(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J6{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Nh(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!Dp(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function xT(n,e,t){Nh(n,t),ET(n,r=>Dp(r,e))}function xn(n,e,t){Nh(n,t),ET(n,r=>_n(r,e)||_n(e,r))}function ET(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(Q6(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Q6(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Hs&&At("event: "+t.toString()),Lo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K6="repo_interrupt",j6=25;class X6{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new J6,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ul(),this.transactionQueueTree_=new $p,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Z6(n,e,t){if(n.stats_=Ep(n.repoInfo_),n.forceRestClient_||kF())n.server_=new cl(n.repoInfo_,(r,s,i,o)=>{Y_(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>z_(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{dt(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Cr(n.repoInfo_,e,(r,s,i,o)=>{Y_(n,r,s,i,o)},r=>{z_(n,r)},r=>{t3(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=MF(n.repoInfo_,()=>new NB(n.stats_,n.server_)),n.infoData_=new bB,n.infoSyncTree_=new q_({startListening:(r,s,i,o)=>{let a=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=qc(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Gp(n,"connected",!1),n.serverSyncTree_=new q_({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);xn(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function e3(n){const t=n.infoData_.getNode(new Ne(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Mh(n){return N6({timestamp:e3(n)})}function Y_(n,e,t,r,s){n.dataUpdateCount++;const i=new Ne(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const c=Ru(t,u=>ht(u));o=C6(n.serverSyncTree_,i,c,s)}else{const c=ht(t);o=uT(n.serverSyncTree_,i,c,s)}else if(r){const c=Ru(t,u=>ht(u));o=T6(n.serverSyncTree_,i,c)}else{const c=ht(t);o=qc(n.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=go(n,i)),xn(n.eventQueue_,a,o)}function z_(n,e){Gp(n,"connected",e),e===!1&&i3(n)}function t3(n,e){Pt(e,(t,r)=>{Gp(n,t,r)})}function Gp(n,e,t){const r=new Ne("/.info/"+e),s=ht(t);n.infoData_.updateSnapshot(r,s);const i=qc(n.infoSyncTree_,r,s);xn(n.eventQueue_,r,i)}function Jp(n){return n.nextWriteId_++}function n3(n,e,t){const r=b6(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=ht(s).withIndex(e._queryParams.getIndex());C0(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=qc(n.serverSyncTree_,e._path,i);else{const a=ac(n.serverSyncTree_,e);o=uT(n.serverSyncTree_,e._path,i,a)}return xn(n.eventQueue_,e._path,o),yl(n.serverSyncTree_,e,t,null,!0),i},s=>(Yc(n,"get for query "+dt(e)+" failed: "+s),Promise.reject(new Error(s))))}function r3(n,e,t,r,s){Yc(n,"set",{path:e.toString(),value:t,priority:r});const i=Mh(n),o=ht(t,r),a=Bp(n.serverSyncTree_,e),c=mT(o,a,i),u=Jp(n),l=cT(n.serverSyncTree_,e,c,u,!0);Nh(n.eventQueue_,l),n.server_.put(e.toString(),o.val(!0),(f,m)=>{const p=f==="ok";p||Qt("set at "+e+" failed: "+f);const y=Zr(n.serverSyncTree_,u,!p);xn(n.eventQueue_,e,y),k0(n,s,f,m)});const d=Kp(n,e);go(n,d),xn(n.eventQueue_,d,[])}function s3(n,e,t,r){Yc(n,"update",{path:e.toString(),value:t});let s=!0;const i=Mh(n),o={};if(Pt(t,(a,c)=>{s=!1,o[a]=fT(et(e,a),ht(c),n.serverSyncTree_,i)}),s)At("update() called with empty data.  Don't do anything."),k0(n,r,"ok",void 0);else{const a=Jp(n),c=I6(n.serverSyncTree_,e,o,a);Nh(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,l)=>{const d=u==="ok";d||Qt("update at "+e+" failed: "+u);const f=Zr(n.serverSyncTree_,a,!d),m=f.length>0?go(n,e):e;xn(n.eventQueue_,m,f),k0(n,r,u,l)}),Pt(t,u=>{const l=Kp(n,et(e,u));go(n,l)}),xn(n.eventQueue_,e,[])}}function i3(n){Yc(n,"onDisconnectEvents");const e=Mh(n),t=ul();x0(n.onDisconnect_,we(),(s,i)=>{const o=fT(s,i,n.serverSyncTree_,e);GI(t,s,o)});let r=[];x0(t,we(),(s,i)=>{r=r.concat(qc(n.serverSyncTree_,s,i));const o=Kp(n,s);go(n,o)}),n.onDisconnect_=ul(),xn(n.eventQueue_,we(),r)}function o3(n,e,t){let r;ue(e._path)===".info"?r=C0(n.infoSyncTree_,e,t):r=C0(n.serverSyncTree_,e,t),xT(n.eventQueue_,e._path,r)}function G_(n,e,t){let r;ue(e._path)===".info"?r=yl(n.infoSyncTree_,e,t):r=yl(n.serverSyncTree_,e,t),xT(n.eventQueue_,e._path,r)}function a3(n){n.persistentConnection_&&n.persistentConnection_.interrupt(K6)}function Yc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),At(t,...e)}function k0(n,e,t,r){e&&Lo(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function IT(n,e,t){return Bp(n.serverSyncTree_,e,t)||Z.EMPTY_NODE}function Qp(n,e=n.transactionQueueTree_){if(e||Oh(n,e),Uo(e)){const t=DT(n,e);L(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&c3(n,$c(e),t)}else gT(e)&&Ph(e,t=>{Qp(n,t)})}function c3(n,e,t){const r=t.map(u=>u.currentWriteId),s=IT(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const l=t[u];L(l.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;const d=Jt(e,l.path);i=i.updateChild(d,l.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Yc(n,"transaction put response",{path:c.toString(),status:u});let l=[];if(u==="ok"){const d=[];for(let f=0;f<t.length;f++)t[f].status=2,l=l.concat(Zr(n.serverSyncTree_,t[f].currentWriteId)),t[f].onComplete&&d.push(()=>t[f].onComplete(null,!0,t[f].currentOutputSnapshotResolved)),t[f].unwatcher();Oh(n,Yp(n.transactionQueueTree_,e)),Qp(n,n.transactionQueueTree_),xn(n.eventQueue_,e,l);for(let f=0;f<d.length;f++)Lo(d[f])}else{if(u==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{Qt("transaction at "+c.toString()+" failed: "+u);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=u}go(n,e)}},o)}function go(n,e){const t=TT(n,e),r=$c(t),s=DT(n,t);return u3(n,s,r),r}function u3(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=Jt(t,c.path);let l=!1,d;if(L(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)l=!0,d=c.abortReason,s=s.concat(Zr(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=j6)l=!0,d="maxretry",s=s.concat(Zr(n.serverSyncTree_,c.currentWriteId,!0));else{const f=IT(n,c.path,o);c.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){Rh("transaction failed: Data returned ",m,c.path);let p=ht(m);typeof m=="object"&&m!=null&&nr(m,".priority")||(p=p.updatePriority(f.getPriority()));const g=c.currentWriteId,x=Mh(n),_=mT(p,f,x);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=_,c.currentWriteId=Jp(n),o.splice(o.indexOf(g),1),s=s.concat(cT(n.serverSyncTree_,c.path,_,c.currentWriteId,c.applyLocally)),s=s.concat(Zr(n.serverSyncTree_,g,!0))}else l=!0,d="nodata",s=s.concat(Zr(n.serverSyncTree_,c.currentWriteId,!0))}xn(n.eventQueue_,t,s),s=[],l&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(d),!1,null))))}Oh(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Lo(r[a]);Qp(n,n.transactionQueueTree_)}function TT(n,e){let t,r=n.transactionQueueTree_;for(t=ue(e);t!==null&&Uo(r)===void 0;)r=Yp(r,t),e=Ue(e),t=ue(e);return r}function DT(n,e){const t=[];return AT(n,e,t),t.sort((r,s)=>r.order-s.order),t}function AT(n,e,t){const r=Uo(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);Ph(e,s=>{AT(n,s,t)})}function Oh(n,e){const t=Uo(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,pT(e,t.length>0?t:void 0)}Ph(e,r=>{Oh(n,r)})}function Kp(n,e){const t=$c(TT(n,e)),r=Yp(n.transactionQueueTree_,e);return B6(r,s=>{Sd(n,s)}),Sd(n,r),yT(r,s=>{Sd(n,s)}),t}function Sd(n,e){const t=Uo(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(L(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(L(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Zr(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?pT(e,void 0):t.length=i+1,xn(n.eventQueue_,$c(e),s);for(let o=0;o<r.length;o++)Lo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l3(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function h3(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Qt(`Invalid query segment '${t}' in query '${n}'`)}return e}const J_=function(n,e){const t=d3(n),r=t.namespace;t.domain==="firebase.com"&&Nr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Nr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||wF();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new SI(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new Ne(t.pathString)}},d3=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let l=n.indexOf("/");l===-1&&(l=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(l,d)),l<d&&(s=l3(n.substring(l,d)));const f=h3(n.substring(Math.min(n.length,d)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const m=e.slice(0,u);if(m.toLowerCase()==="localhost")t="localhost";else if(m.split(".").length<=2)t=m;else{const p=e.indexOf(".");r=e.substring(0,p).toLowerCase(),t=e.substring(p+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+dt(this.snapshot.exportVal())}}class bT{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kT{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return he(this._path)?null:Tp(this._path)}get ref(){return new ir(this._repo,this._path)}get _queryIdentifier(){const e=N_(this._queryParams),t=wp(e);return t==="{}"?"default":t}get _queryObject(){return N_(this._queryParams)}isEqual(e){if(e=Ee(e),!(e instanceof jp))return!1;const t=this._repo===e._repo,r=Dp(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+rB(this._path)}}class ir extends jp{constructor(e,t){super(e,t,new kp,!1)}get parent(){const e=VI(this._path);return e===null?null:new ir(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class yo{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Ne(e),r=_l(this.ref,e);return new yo(this._node.getChild(t),r,tt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new yo(s,_l(this.ref,r),tt)))}hasChild(e){const t=new Ne(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ts(n,e){return n=Ee(n),n._checkNotDeleted("ref"),e!==void 0?_l(n._root,e):n._root}function _l(n,e){return n=Ee(n),ue(n._path)===null?z6("child","path",e,!1):vT("child","path",e,!1),new ir(n._repo,et(n._path,e))}function f3(n){return wT("remove",n._path),ST(n,null)}function ST(n,e){n=Ee(n),wT("set",n._path),q6("set",e,n._path,!1);const t=new gc;return r3(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Pd(n,e){Y6("update",e,n._path,!1);const t=new gc;return s3(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function m3(n){n=Ee(n);const e=new kT(()=>{}),t=new Fh(e);return n3(n._repo,n,t).then(r=>new yo(r,new ir(n._repo,n._path),n._queryParams.getIndex()))}class Fh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new CT("value",this,new yo(e.snapshotNode,new ir(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new bT(this,e,t):null}matches(e){return e instanceof Fh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Xp{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new bT(this,e,t):null}createEvent(e,t){L(e.childName!=null,"Child events should have a childName.");const r=_l(new ir(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new CT(e.type,this,new yo(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Xp?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function p3(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const c=t,u=(l,d)=>{G_(n._repo,n,a),c(l,d)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new kT(t,i||void 0),a=e==="value"?new Fh(o):new Xp(e,o);return o3(n._repo,n,a),()=>G_(n._repo,n,a)}function g3(n,e,t,r){return p3(n,"value",e,t,r)}p6(ir);w6(ir);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y3="FIREBASE_DATABASE_EMULATOR_HOST",S0={};let _3=!1;function v3(n,e,t,r){n.repoInfo_=new SI(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function w3(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Nr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),At("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=J_(i,s),a=o.repoInfo,c,u;typeof process<"u"&&p_&&(u=p_[y3]),u?(c=!0,i=`http://${u}?ns=${a.namespace}`,o=J_(i,s),a=o.repoInfo):c=!o.repoInfo.secure;const l=s&&c?new Wi(Wi.OWNER):new PF(n.name,n.options,e);G6("Invalid Firebase Database URL",o),he(o.path)||Nr("Database URL must point to the root of a Firebase Database (not including a child path).");const d=E3(a,n,l,new SF(n.name,t));return new I3(d,n)}function x3(n,e){const t=S0[e];(!t||t[n.key]!==n)&&Nr(`Database ${e}(${n.repoInfo_}) has already been deleted.`),a3(n),delete t[n.key]}function E3(n,e,t,r){let s=S0[e.name];s||(s={},S0[e.name]=s);let i=s[n.toURLString()];return i&&Nr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new X6(n,_3,t,r),s[n.toURLString()]=i,i}class I3{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Z6(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ir(this._repo,we())),this._rootInternal}_delete(){return this._rootInternal!==null&&(x3(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Nr("Cannot call "+e+" on a deleted database.")}}function T3(n=Do(),e){const t=Ol(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=hw("database");r&&D3(t,...r)}return t}function D3(n,e,t,r={}){n=Ee(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Nr("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let i;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&Nr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new Wi(Wi.OWNER);else if(r.mockUserToken){const o=typeof r.mockUserToken=="string"?r.mockUserToken:mw(r.mockUserToken,n.app.options.projectId);i=new Wi(o)}v3(s,e,t,i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A3(n){pF(si),Gs(new cs("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return w3(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Yn(g_,y_,n),Yn(g_,y_,"esm2017")}function Q_(n){return{".sv":{increment:n}}}Cr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Cr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};A3();const C3={simpletor_golden_business_month_1:1e3,simpletor_advanced_business_month_1:200,simpletor_basic_business_month_1:0,simpletor_landing_business_month_1:0},b3={simpletor_golden_business_month_1:100,simpletor_advanced_business_month_1:20,simpletor_basic_business_month_1:10,simpletor_landing_business_month_1:10};class vl{constructor(e=0,t=0){h(this,"messagesCounter",0);h(this,"paymentRequestCounter",0);h(this,"listener");this.messagesCounter=e,this.paymentRequestCounter=t}static forNewBusiness(){return new vl(mF,fF)}static fromProductId(e){return new vl(C3[e]||0,b3[e]||0)}setBusinessData(e){this.messagesCounter=parseInt(e.val().messagesCounter.toString())||0,this.paymentRequestCounter=parseInt(e.val().paymentRequestCounter.toString())||0}toJson(){const e={};return e.messagesCounter=this.messagesCounter,e.paymentRequestCounter=this.paymentRequestCounter,e}}class wl{constructor({name:e="",description:t="",id:r="",price:s,imageUrl:i=""}={}){h(this,"description","");h(this,"price");h(this,"imageUrl","");h(this,"id","");h(this,"name","");h(this,"createdAt",new Date);this.name=e||"",this.description=t||"",this.id=r||"",this.price=s,this.imageUrl=i||""}static fromProduct(e){const t=new wl({id:e.id,description:e.description,price:e.price,imageUrl:e.imageUrl,name:e.name});return t.createdAt=e.createdAt,t}static fromJson(e,t){const r=new wl({id:t,description:e.description,price:Vt.fromJson(e.price),imageUrl:e.imageUrl,name:e.name});return r.createdAt=e.createdAt,r}toJson(){return{description:this.description,price:this.price?this.price.toJson():null,imageUrl:this.imageUrl,name:this.name,createdAt:this.createdAt}}toString(){return JSON.stringify(this.toJson())}}var k3=(n=>(n[n.scheduleSettings=0]="scheduleSettings",n[n.workSettings=1]="workSettings",n[n.customers=2]="customers",n[n.dataPermission=3]="dataPermission",n[n.waitings=4]="waitings",n[n.storyUpload=5]="storyUpload",n[n.resumePermission=6]="resumePermission",n[n.schedulePemission=7]="schedulePemission",n[n.bookingsPermission=8]="bookingsPermission",n[n.invoicesPremission=9]="invoicesPremission",n[n.paymentRequestPermmission=10]="paymentRequestPermmission",n))(k3||{});const S3={0:"scheduleSettings",1:"workSettings",2:"customers",6:"resumePermission",3:"dataPermission",9:"invoicesPremission",4:"waitings",5:"storyUpload",7:"schedulePemission",8:"bookingsPermission",10:"paymentRequestPermmission"},P3={scheduleSettings:0,workSettings:1,customers:2,resumePermission:2,dataPermission:3,invoicesPremission:9,waitings:4,storyUpload:5,schedulePermission:7,bookingsPermission:8,paymentRequestPermission:10},R3=[0,1,2,3,4,5,6,7,8,9,10];class xl{constructor(){h(this,"map",{})}static fromJson(e){const t=new xl;return t.map={},Object.entries(e).forEach(([r,s])=>{t.map[r]=new Map,R3.forEach(i=>{t.map[r].set(i,e[r][P3[i]]??!0)})}),t}toJson(){const e={};return Object.entries(this.map).forEach(([t,r])=>{r.forEach((s,i)=>{s||(e[t]??(e[t]={}),e[t][S3[i]]=s)})}),e}}class ni{constructor({shopName:e="",businessId:t,productId:r="",adress:s="",dynamicLink:i="",revenueCatId:o="",ownersName:a="",instagramAccount:c="",shopPhone:u="",design:l}){h(this,"businesseType",Vi.Other);h(this,"currency",us);h(this,"notifyOnNewCustomer",!0);h(this,"searchable",!0);h(this,"billingIssue",new Map);h(this,"isLandingPageMode",!1);h(this,"allWorkersIds",new Map);h(this,"workersIds",new Map);h(this,"hypPath");h(this,"expiredDate",new Date);h(this,"workersPermissions",new xl);h(this,"shopPhone","");h(this,"ownersName","");h(this,"companyNumber","");h(this,"ownersPhone","");h(this,"masofNumber","");h(this,"previewDoc","");h(this,"instagramAccount","");h(this,"revenueCatId","");h(this,"pendingWorkersProductsId","");h(this,"adress","");h(this,"workersProductsId","");h(this,"pendingProductId","");h(this,"dynamicLink","");h(this,"shopName","");h(this,"productId","");h(this,"businessId","");h(this,"createdAt",new Date);h(this,"blockedUsersTemp",new Map);h(this,"lastTimeConnected",new Date);h(this,"businessData",new vl);h(this,"design",new vr);this.shopName=e,this.businessId=t,this.productId=r,this.adress=s,this.dynamicLink=i,this.revenueCatId=o,this.ownersName=a,this.instagramAccount=c,this.shopPhone=u,this.design=l}static empty(){return new ni({design:new vr,businessId:""})}get businessPayLoadData(){return new lo({businessId:this.businessId,businessName:this.shopName,shopIcon:this.design.shopIconData})}static fromJson(e,t){const r=new ni({businessId:t,design:new vr});return r.setData(e,t),r}setData(e,t){if(this.businessId=t,e.currency&&(this.currency=mr.fromJson(e.currency)),e.design)this.design=vr.fromJson(e.design);else{const s=e.theme;this.design.pickedThemeKey=s,Object.entries(e.products).forEach(([i,o])=>{this.design.products.set(i,wl.fromJson(o,i))}),e.changingImages&&(this.design.changingImages=e.changingImages.map(i=>i)),e.updates&&e.updates.forEach((i,o)=>{this.design.updates.set(o.toString(),uo.fromJson(i,o.toString()))}),this.design.bottomIcons=e.bottomIcons??!1,this.design.storyTitle=e.storyTitle??"",this.design.changingImagesSwapSeconds=e.changingImagesSwapSeconds??6,this.design.shopIconUrl=e.shopIcon??""}e.workersPermissions!=null&&(this.workersPermissions=xl.fromJson(e.workersPermissions)),this.previewDoc=e.previewDoc??"",this.workersProductsId=e.workersProductsId??"",this.pendingWorkersProductsId=e.pendingWorkersProductsId??"",this.shopName=e.shopName??"",this.isLandingPageMode=e.isLandingPageMode??!1,this.searchable=e.searchable??!0,e.expiredDate!=null&&(this.expiredDate=new Date(e.expiredDate)),this.notifyOnNewCustomer=e.notifyOnNewCustomer??!0,this.companyNumber=e.companyNumber??"",e.hypPath!=null&&(this.hypPath=dF[e.hypPath]),this.allWorkersIds=new Map,e.allWorkersIds!=null&&Object.entries(e.allWorkersIds).forEach(([s,i])=>{this.allWorkersIds.set(s,i)});const r=this.businessId.split("--")[0];this.allWorkersIds.hasOwnProperty("+"+r)||this.allWorkersIds.set("+"+r,""),this.workersIds=new Map,e.workersIds!=null&&Object.entries(e.workersIds).forEach(([s,i])=>{this.workersIds.set(s,i)}),this.workersIds.hasOwnProperty(r)||this.workersIds.set(r,""),this.dynamicLink=e.dynamicLink??"",this.masofNumber=e.masofNumber??"",this.ownersName=e.ownersName??"",this.revenueCatId=e.revenueCatId??"",this.productId=e.productId??"",this.pendingProductId=e.pendingProductId??"",this.businesseType=mI[e.businesseType]??Vi.Other,this.instagramAccount=e.instagramAccount??"",this.adress=e.adress??"",this.shopPhone=e.shopPhone??"";try{e.billingIssue!=null&&Object.entries(e.billingIssue).forEach(([s,i])=>{this.billingIssue.set(s,i.toDate())})}catch{}e.createdAt instanceof Fe?this.createdAt=e.createdAt.toDate():typeof e.createdAt=="string"&&(this.createdAt=new Date(e.createdAt)||new Date),e.lastTimeConnected!=null&&(this.lastTimeConnected=new Date(e.lastTimeConnected)||new Date)}toJson(){const e={};return e.notifyOnNewCustomer=this.notifyOnNewCustomer,e.currency=this.currency.toJson(),e.searchable=this.searchable,e.workersProductsId=this.workersProductsId,e.pendingWorkersProductsId=this.pendingWorkersProductsId,e.previewDoc=this.previewDoc,e.masofNumber=this.masofNumber,e.revenueCatId=this.revenueCatId,e.pendingProductId=this.pendingProductId,e.productId=this.productId,e.shopName=this.shopName,this.hypPath&&(e.hypPath=this.hypPath),this.billingIssue.size>0&&(e.billingIssue={},this.billingIssue.forEach((t,r)=>{e.billingIssue[r]=Fe.fromDate(t)})),this.dynamicLink!==""&&(e.dynamicLink=this.dynamicLink),e.companyNumber=this.companyNumber,e.expiredDate=this.expiredDate,e.businesseType=this.businesseType,e.ownersName=this.ownersName,e.instagramAccount=this.instagramAccount,e.adress=this.adress,e.shopPhone=this.shopPhone,e.workersPermissions=this.workersPermissions.toJson(),e.workersIds=this.workersIds,e.createdAt=this.createdAt,e.lastTimeConnected=this.lastTimeConnected,this.isLandingPageMode&&(e.isLandingPageMode=this.isLandingPageMode),e.design=this.design.toJson(),e}toString(){return JSON.stringify(this.toJson())}}class Aa{constructor({businessId:e,shopPhone:t,type:r,adress:s,ownerName:i,iconUrl:o,businessName:a}){h(this,"businessName","");h(this,"iconUrl","");h(this,"businessId","");h(this,"type",Vi.Other);h(this,"adress","");h(this,"ownerName","");h(this,"shopPhone","");this.businessId=e,this.shopPhone=t,this.type=r,this.adress=s,this.ownerName=i,this.iconUrl=o,this.businessName=a}static empty(){return new Aa({businessId:"",shopPhone:"",type:Vi.Other,adress:"",ownerName:"",iconUrl:"",businessName:""})}static fromJson(e,t){const r=e.businessName||"",s=e.iconUrl||"",i=mI[e.T]||Vi.Other,o=e.ON||"",a=e.SP||"",c=e.A||"";return new Aa({businessId:t,shopPhone:a,type:i,adress:c,ownerName:o,iconUrl:s,businessName:r})}get toBusinessModel(){const e=new ni({businessId:this.businessId,design:new vr({shopIconUrl:this.iconUrl})});return e.ownersName=this.ownerName,e.shopPhone=this.shopPhone,e.shopName=this.businessName,e.adress=this.adress,e.businesseType=this.type,e}static fromBusinessInfo(e){return new Aa({businessId:e.businessId,shopPhone:e.shopPhone,type:e.type,adress:e.adress,ownerName:e.ownerName,iconUrl:e.iconUrl,businessName:e.businessName})}toJson(){const e={};return e.businessName=this.businessName,e.iconUrl=this.iconUrl,e.ON=this.ownerName,e.SP=this.shopPhone,e.A=this.adress,e.T=lF[this.type],e}isTheSame(e){return e.iconUrl===this.iconUrl&&e.ownerName===this.ownerName&&e.shopPhone===this.shopPhone&&e.adress===this.adress&&e.type===this.type&&e.businessName===this.businessName}toString(){return JSON.stringify(this.toJson())}}var PT={exports:{}};function N3(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rd={exports:{}};const M3={},O3=Object.freeze(Object.defineProperty({__proto__:null,default:M3},Symbol.toStringTag,{value:"Module"})),F3=VD(O3);var K_;function pe(){return K_||(K_=1,function(n,e){(function(t,r){n.exports=r()})(ae,function(){var t=t||function(r,s){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof ae<"u"&&ae.crypto&&(i=ae.crypto),!i&&typeof N3=="function")try{i=F3}catch{}var o=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function _(){}return function(v){var w;return _.prototype=v,w=new _,_.prototype=null,w}}(),c={},u=c.lib={},l=u.Base=function(){return{extend:function(_){var v=a(this);return _&&v.mixIn(_),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var v in _)_.hasOwnProperty(v)&&(this[v]=_[v]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=u.WordArray=l.extend({init:function(_,v){_=this.words=_||[],v!=s?this.sigBytes=v:this.sigBytes=_.length*4},toString:function(_){return(_||m).stringify(this)},concat:function(_){var v=this.words,w=_.words,D=this.sigBytes,T=_.sigBytes;if(this.clamp(),D%4)for(var E=0;E<T;E++){var A=w[E>>>2]>>>24-E%4*8&255;v[D+E>>>2]|=A<<24-(D+E)%4*8}else for(var k=0;k<T;k+=4)v[D+k>>>2]=w[k>>>2];return this.sigBytes+=T,this},clamp:function(){var _=this.words,v=this.sigBytes;_[v>>>2]&=4294967295<<32-v%4*8,_.length=r.ceil(v/4)},clone:function(){var _=l.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var v=[],w=0;w<_;w+=4)v.push(o());return new d.init(v,_)}}),f=c.enc={},m=f.Hex={stringify:function(_){for(var v=_.words,w=_.sigBytes,D=[],T=0;T<w;T++){var E=v[T>>>2]>>>24-T%4*8&255;D.push((E>>>4).toString(16)),D.push((E&15).toString(16))}return D.join("")},parse:function(_){for(var v=_.length,w=[],D=0;D<v;D+=2)w[D>>>3]|=parseInt(_.substr(D,2),16)<<24-D%8*4;return new d.init(w,v/2)}},p=f.Latin1={stringify:function(_){for(var v=_.words,w=_.sigBytes,D=[],T=0;T<w;T++){var E=v[T>>>2]>>>24-T%4*8&255;D.push(String.fromCharCode(E))}return D.join("")},parse:function(_){for(var v=_.length,w=[],D=0;D<v;D++)w[D>>>2]|=(_.charCodeAt(D)&255)<<24-D%4*8;return new d.init(w,v)}},y=f.Utf8={stringify:function(_){try{return decodeURIComponent(escape(p.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return p.parse(unescape(encodeURIComponent(_)))}},g=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=y.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var v,w=this._data,D=w.words,T=w.sigBytes,E=this.blockSize,A=E*4,k=T/A;_?k=r.ceil(k):k=r.max((k|0)-this._minBufferSize,0);var I=k*E,C=r.min(I*4,T);if(I){for(var S=0;S<I;S+=E)this._doProcessBlock(D,S);v=D.splice(0,I),w.sigBytes-=C}return new d.init(v,C)},clone:function(){var _=l.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0});u.Hasher=g.extend({cfg:l.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var v=this._doFinalize();return v},blockSize:16,_createHelper:function(_){return function(v,w){return new _.init(w).finalize(v)}},_createHmacHelper:function(_){return function(v,w){return new x.HMAC.init(_,w).finalize(v)}}});var x=c.algo={};return c}(Math);return t})}(Rd)),Rd.exports}var Nd={exports:{}},j_;function Bh(){return j_||(j_=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(r){var s=t,i=s.lib,o=i.Base,a=i.WordArray,c=s.x64={};c.Word=o.extend({init:function(u,l){this.high=u,this.low=l}}),c.WordArray=o.extend({init:function(u,l){u=this.words=u||[],l!=r?this.sigBytes=l:this.sigBytes=u.length*8},toX32:function(){for(var u=this.words,l=u.length,d=[],f=0;f<l;f++){var m=u[f];d.push(m.high),d.push(m.low)}return a.create(d,this.sigBytes)},clone:function(){for(var u=o.clone.call(this),l=u.words=this.words.slice(0),d=l.length,f=0;f<d;f++)l[f]=l[f].clone();return u}})}(),t})}(Nd)),Nd.exports}var Md={exports:{}},X_;function B3(){return X_||(X_=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,s=r.lib,i=s.WordArray,o=i.init,a=i.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var u=c.byteLength,l=[],d=0;d<u;d++)l[d>>>2]|=c[d]<<24-d%4*8;o.call(this,l,u)}else o.apply(this,arguments)};a.prototype=i}}(),t.lib.WordArray})}(Md)),Md.exports}var Od={exports:{}},Z_;function L3(){return Z_||(Z_=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Utf16=o.Utf16BE={stringify:function(c){for(var u=c.words,l=c.sigBytes,d=[],f=0;f<l;f+=2){var m=u[f>>>2]>>>16-f%4*8&65535;d.push(String.fromCharCode(m))}return d.join("")},parse:function(c){for(var u=c.length,l=[],d=0;d<u;d++)l[d>>>1]|=c.charCodeAt(d)<<16-d%2*16;return i.create(l,u*2)}},o.Utf16LE={stringify:function(c){for(var u=c.words,l=c.sigBytes,d=[],f=0;f<l;f+=2){var m=a(u[f>>>2]>>>16-f%4*8&65535);d.push(String.fromCharCode(m))}return d.join("")},parse:function(c){for(var u=c.length,l=[],d=0;d<u;d++)l[d>>>1]|=a(c.charCodeAt(d)<<16-d%2*16);return i.create(l,u*2)}};function a(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(Od)),Od.exports}var Fd={exports:{}},ev;function hi(){return ev||(ev=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Base64={stringify:function(c){var u=c.words,l=c.sigBytes,d=this._map;c.clamp();for(var f=[],m=0;m<l;m+=3)for(var p=u[m>>>2]>>>24-m%4*8&255,y=u[m+1>>>2]>>>24-(m+1)%4*8&255,g=u[m+2>>>2]>>>24-(m+2)%4*8&255,x=p<<16|y<<8|g,_=0;_<4&&m+_*.75<l;_++)f.push(d.charAt(x>>>6*(3-_)&63));var v=d.charAt(64);if(v)for(;f.length%4;)f.push(v);return f.join("")},parse:function(c){var u=c.length,l=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var f=0;f<l.length;f++)d[l.charCodeAt(f)]=f}var m=l.charAt(64);if(m){var p=c.indexOf(m);p!==-1&&(u=p)}return a(c,u,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(c,u,l){for(var d=[],f=0,m=0;m<u;m++)if(m%4){var p=l[c.charCodeAt(m-1)]<<m%4*2,y=l[c.charCodeAt(m)]>>>6-m%4*2,g=p|y;d[f>>>2]|=g<<24-f%4*8,f++}return i.create(d,f)}}(),t.enc.Base64})}(Fd)),Fd.exports}var Bd={exports:{}},tv;function V3(){return tv||(tv=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Base64url={stringify:function(c,u){u===void 0&&(u=!0);var l=c.words,d=c.sigBytes,f=u?this._safe_map:this._map;c.clamp();for(var m=[],p=0;p<d;p+=3)for(var y=l[p>>>2]>>>24-p%4*8&255,g=l[p+1>>>2]>>>24-(p+1)%4*8&255,x=l[p+2>>>2]>>>24-(p+2)%4*8&255,_=y<<16|g<<8|x,v=0;v<4&&p+v*.75<d;v++)m.push(f.charAt(_>>>6*(3-v)&63));var w=f.charAt(64);if(w)for(;m.length%4;)m.push(w);return m.join("")},parse:function(c,u){u===void 0&&(u=!0);var l=c.length,d=u?this._safe_map:this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var m=0;m<d.length;m++)f[d.charCodeAt(m)]=m}var p=d.charAt(64);if(p){var y=c.indexOf(p);y!==-1&&(l=y)}return a(c,l,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(c,u,l){for(var d=[],f=0,m=0;m<u;m++)if(m%4){var p=l[c.charCodeAt(m-1)]<<m%4*2,y=l[c.charCodeAt(m)]>>>6-m%4*2,g=p|y;d[f>>>2]|=g<<24-f%4*8,f++}return i.create(d,f)}}(),t.enc.Base64url})}(Bd)),Bd.exports}var Ld={exports:{}},nv;function di(){return nv||(nv=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,u=[];(function(){for(var y=0;y<64;y++)u[y]=r.abs(r.sin(y+1))*4294967296|0})();var l=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,g){for(var x=0;x<16;x++){var _=g+x,v=y[_];y[_]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var w=this._hash.words,D=y[g+0],T=y[g+1],E=y[g+2],A=y[g+3],k=y[g+4],I=y[g+5],C=y[g+6],S=y[g+7],P=y[g+8],Y=y[g+9],X=y[g+10],oe=y[g+11],He=y[g+12],be=y[g+13],Be=y[g+14],Re=y[g+15],b=w[0],O=w[1],F=w[2],N=w[3];b=d(b,O,F,N,D,7,u[0]),N=d(N,b,O,F,T,12,u[1]),F=d(F,N,b,O,E,17,u[2]),O=d(O,F,N,b,A,22,u[3]),b=d(b,O,F,N,k,7,u[4]),N=d(N,b,O,F,I,12,u[5]),F=d(F,N,b,O,C,17,u[6]),O=d(O,F,N,b,S,22,u[7]),b=d(b,O,F,N,P,7,u[8]),N=d(N,b,O,F,Y,12,u[9]),F=d(F,N,b,O,X,17,u[10]),O=d(O,F,N,b,oe,22,u[11]),b=d(b,O,F,N,He,7,u[12]),N=d(N,b,O,F,be,12,u[13]),F=d(F,N,b,O,Be,17,u[14]),O=d(O,F,N,b,Re,22,u[15]),b=f(b,O,F,N,T,5,u[16]),N=f(N,b,O,F,C,9,u[17]),F=f(F,N,b,O,oe,14,u[18]),O=f(O,F,N,b,D,20,u[19]),b=f(b,O,F,N,I,5,u[20]),N=f(N,b,O,F,X,9,u[21]),F=f(F,N,b,O,Re,14,u[22]),O=f(O,F,N,b,k,20,u[23]),b=f(b,O,F,N,Y,5,u[24]),N=f(N,b,O,F,Be,9,u[25]),F=f(F,N,b,O,A,14,u[26]),O=f(O,F,N,b,P,20,u[27]),b=f(b,O,F,N,be,5,u[28]),N=f(N,b,O,F,E,9,u[29]),F=f(F,N,b,O,S,14,u[30]),O=f(O,F,N,b,He,20,u[31]),b=m(b,O,F,N,I,4,u[32]),N=m(N,b,O,F,P,11,u[33]),F=m(F,N,b,O,oe,16,u[34]),O=m(O,F,N,b,Be,23,u[35]),b=m(b,O,F,N,T,4,u[36]),N=m(N,b,O,F,k,11,u[37]),F=m(F,N,b,O,S,16,u[38]),O=m(O,F,N,b,X,23,u[39]),b=m(b,O,F,N,be,4,u[40]),N=m(N,b,O,F,D,11,u[41]),F=m(F,N,b,O,A,16,u[42]),O=m(O,F,N,b,C,23,u[43]),b=m(b,O,F,N,Y,4,u[44]),N=m(N,b,O,F,He,11,u[45]),F=m(F,N,b,O,Re,16,u[46]),O=m(O,F,N,b,E,23,u[47]),b=p(b,O,F,N,D,6,u[48]),N=p(N,b,O,F,S,10,u[49]),F=p(F,N,b,O,Be,15,u[50]),O=p(O,F,N,b,I,21,u[51]),b=p(b,O,F,N,He,6,u[52]),N=p(N,b,O,F,A,10,u[53]),F=p(F,N,b,O,X,15,u[54]),O=p(O,F,N,b,T,21,u[55]),b=p(b,O,F,N,P,6,u[56]),N=p(N,b,O,F,Re,10,u[57]),F=p(F,N,b,O,C,15,u[58]),O=p(O,F,N,b,be,21,u[59]),b=p(b,O,F,N,k,6,u[60]),N=p(N,b,O,F,oe,10,u[61]),F=p(F,N,b,O,E,15,u[62]),O=p(O,F,N,b,Y,21,u[63]),w[0]=w[0]+b|0,w[1]=w[1]+O|0,w[2]=w[2]+F|0,w[3]=w[3]+N|0},_doFinalize:function(){var y=this._data,g=y.words,x=this._nDataBytes*8,_=y.sigBytes*8;g[_>>>5]|=128<<24-_%32;var v=r.floor(x/4294967296),w=x;g[(_+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,g[(_+64>>>9<<4)+14]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,y.sigBytes=(g.length+1)*4,this._process();for(var D=this._hash,T=D.words,E=0;E<4;E++){var A=T[E];T[E]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}return D},clone:function(){var y=a.clone.call(this);return y._hash=this._hash.clone(),y}});function d(y,g,x,_,v,w,D){var T=y+(g&x|~g&_)+v+D;return(T<<w|T>>>32-w)+g}function f(y,g,x,_,v,w,D){var T=y+(g&_|x&~_)+v+D;return(T<<w|T>>>32-w)+g}function m(y,g,x,_,v,w,D){var T=y+(g^x^_)+v+D;return(T<<w|T>>>32-w)+g}function p(y,g,x,_,v,w,D){var T=y+(x^(g|~_))+v+D;return(T<<w|T>>>32-w)+g}s.MD5=a._createHelper(l),s.HmacMD5=a._createHmacHelper(l)}(Math),t.MD5})}(Ld)),Ld.exports}var Vd={exports:{}},rv;function RT(){return rv||(rv=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=s.Hasher,a=r.algo,c=[],u=a.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,d){for(var f=this._hash.words,m=f[0],p=f[1],y=f[2],g=f[3],x=f[4],_=0;_<80;_++){if(_<16)c[_]=l[d+_]|0;else{var v=c[_-3]^c[_-8]^c[_-14]^c[_-16];c[_]=v<<1|v>>>31}var w=(m<<5|m>>>27)+x+c[_];_<20?w+=(p&y|~p&g)+1518500249:_<40?w+=(p^y^g)+1859775393:_<60?w+=(p&y|p&g|y&g)-1894007588:w+=(p^y^g)-899497514,x=g,g=y,y=p<<30|p>>>2,p=m,m=w}f[0]=f[0]+m|0,f[1]=f[1]+p|0,f[2]=f[2]+y|0,f[3]=f[3]+g|0,f[4]=f[4]+x|0},_doFinalize:function(){var l=this._data,d=l.words,f=this._nDataBytes*8,m=l.sigBytes*8;return d[m>>>5]|=128<<24-m%32,d[(m+64>>>9<<4)+14]=Math.floor(f/4294967296),d[(m+64>>>9<<4)+15]=f,l.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var l=o.clone.call(this);return l._hash=this._hash.clone(),l}});r.SHA1=o._createHelper(u),r.HmacSHA1=o._createHmacHelper(u)}(),t.SHA1})}(Vd)),Vd.exports}var Ud={exports:{}},sv;function Zp(){return sv||(sv=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,u=[],l=[];(function(){function m(x){for(var _=r.sqrt(x),v=2;v<=_;v++)if(!(x%v))return!1;return!0}function p(x){return(x-(x|0))*4294967296|0}for(var y=2,g=0;g<64;)m(y)&&(g<8&&(u[g]=p(r.pow(y,1/2))),l[g]=p(r.pow(y,1/3)),g++),y++})();var d=[],f=c.SHA256=a.extend({_doReset:function(){this._hash=new o.init(u.slice(0))},_doProcessBlock:function(m,p){for(var y=this._hash.words,g=y[0],x=y[1],_=y[2],v=y[3],w=y[4],D=y[5],T=y[6],E=y[7],A=0;A<64;A++){if(A<16)d[A]=m[p+A]|0;else{var k=d[A-15],I=(k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3,C=d[A-2],S=(C<<15|C>>>17)^(C<<13|C>>>19)^C>>>10;d[A]=I+d[A-7]+S+d[A-16]}var P=w&D^~w&T,Y=g&x^g&_^x&_,X=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),oe=(w<<26|w>>>6)^(w<<21|w>>>11)^(w<<7|w>>>25),He=E+oe+P+l[A]+d[A],be=X+Y;E=T,T=D,D=w,w=v+He|0,v=_,_=x,x=g,g=He+be|0}y[0]=y[0]+g|0,y[1]=y[1]+x|0,y[2]=y[2]+_|0,y[3]=y[3]+v|0,y[4]=y[4]+w|0,y[5]=y[5]+D|0,y[6]=y[6]+T|0,y[7]=y[7]+E|0},_doFinalize:function(){var m=this._data,p=m.words,y=this._nDataBytes*8,g=m.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=r.floor(y/4294967296),p[(g+64>>>9<<4)+15]=y,m.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var m=a.clone.call(this);return m._hash=this._hash.clone(),m}});s.SHA256=a._createHelper(f),s.HmacSHA256=a._createHmacHelper(f)}(Math),t.SHA256})}(Ud)),Ud.exports}var Wd={exports:{}},iv;function U3(){return iv||(iv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Zp())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.algo,a=o.SHA256,c=o.SHA224=a.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=a._doFinalize.call(this);return u.sigBytes-=4,u}});r.SHA224=a._createHelper(c),r.HmacSHA224=a._createHmacHelper(c)}(),t.SHA224})}(Wd)),Wd.exports}var Hd={exports:{}},ov;function NT(){return ov||(ov=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Bh())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.Hasher,o=r.x64,a=o.Word,c=o.WordArray,u=r.algo;function l(){return a.create.apply(a,arguments)}var d=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],f=[];(function(){for(var p=0;p<80;p++)f[p]=l()})();var m=u.SHA512=i.extend({_doReset:function(){this._hash=new c.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(p,y){for(var g=this._hash.words,x=g[0],_=g[1],v=g[2],w=g[3],D=g[4],T=g[5],E=g[6],A=g[7],k=x.high,I=x.low,C=_.high,S=_.low,P=v.high,Y=v.low,X=w.high,oe=w.low,He=D.high,be=D.low,Be=T.high,Re=T.low,b=E.high,O=E.low,F=A.high,N=A.low,Ge=k,Le=I,Kt=C,ce=S,qo=P,mi=Y,Jh=X,$o=oe,Tn=He,on=be,jc=Be,Yo=Re,Xc=b,zo=O,Qh=F,Go=N,Dn=0;Dn<80;Dn++){var fn,Ur,Zc=f[Dn];if(Dn<16)Ur=Zc.high=p[y+Dn*2]|0,fn=Zc.low=p[y+Dn*2+1]|0;else{var Tg=f[Dn-15],pi=Tg.high,Jo=Tg.low,TD=(pi>>>1|Jo<<31)^(pi>>>8|Jo<<24)^pi>>>7,Dg=(Jo>>>1|pi<<31)^(Jo>>>8|pi<<24)^(Jo>>>7|pi<<25),Ag=f[Dn-2],gi=Ag.high,Qo=Ag.low,DD=(gi>>>19|Qo<<13)^(gi<<3|Qo>>>29)^gi>>>6,Cg=(Qo>>>19|gi<<13)^(Qo<<3|gi>>>29)^(Qo>>>6|gi<<26),bg=f[Dn-7],AD=bg.high,CD=bg.low,kg=f[Dn-16],bD=kg.high,Sg=kg.low;fn=Dg+CD,Ur=TD+AD+(fn>>>0<Dg>>>0?1:0),fn=fn+Cg,Ur=Ur+DD+(fn>>>0<Cg>>>0?1:0),fn=fn+Sg,Ur=Ur+bD+(fn>>>0<Sg>>>0?1:0),Zc.high=Ur,Zc.low=fn}var kD=Tn&jc^~Tn&Xc,Pg=on&Yo^~on&zo,SD=Ge&Kt^Ge&qo^Kt&qo,PD=Le&ce^Le&mi^ce&mi,RD=(Ge>>>28|Le<<4)^(Ge<<30|Le>>>2)^(Ge<<25|Le>>>7),Rg=(Le>>>28|Ge<<4)^(Le<<30|Ge>>>2)^(Le<<25|Ge>>>7),ND=(Tn>>>14|on<<18)^(Tn>>>18|on<<14)^(Tn<<23|on>>>9),MD=(on>>>14|Tn<<18)^(on>>>18|Tn<<14)^(on<<23|Tn>>>9),Ng=d[Dn],OD=Ng.high,Mg=Ng.low,an=Go+MD,Wr=Qh+ND+(an>>>0<Go>>>0?1:0),an=an+Pg,Wr=Wr+kD+(an>>>0<Pg>>>0?1:0),an=an+Mg,Wr=Wr+OD+(an>>>0<Mg>>>0?1:0),an=an+fn,Wr=Wr+Ur+(an>>>0<fn>>>0?1:0),Og=Rg+PD,FD=RD+SD+(Og>>>0<Rg>>>0?1:0);Qh=Xc,Go=zo,Xc=jc,zo=Yo,jc=Tn,Yo=on,on=$o+an|0,Tn=Jh+Wr+(on>>>0<$o>>>0?1:0)|0,Jh=qo,$o=mi,qo=Kt,mi=ce,Kt=Ge,ce=Le,Le=an+Og|0,Ge=Wr+FD+(Le>>>0<an>>>0?1:0)|0}I=x.low=I+Le,x.high=k+Ge+(I>>>0<Le>>>0?1:0),S=_.low=S+ce,_.high=C+Kt+(S>>>0<ce>>>0?1:0),Y=v.low=Y+mi,v.high=P+qo+(Y>>>0<mi>>>0?1:0),oe=w.low=oe+$o,w.high=X+Jh+(oe>>>0<$o>>>0?1:0),be=D.low=be+on,D.high=He+Tn+(be>>>0<on>>>0?1:0),Re=T.low=Re+Yo,T.high=Be+jc+(Re>>>0<Yo>>>0?1:0),O=E.low=O+zo,E.high=b+Xc+(O>>>0<zo>>>0?1:0),N=A.low=N+Go,A.high=F+Qh+(N>>>0<Go>>>0?1:0)},_doFinalize:function(){var p=this._data,y=p.words,g=this._nDataBytes*8,x=p.sigBytes*8;y[x>>>5]|=128<<24-x%32,y[(x+128>>>10<<5)+30]=Math.floor(g/4294967296),y[(x+128>>>10<<5)+31]=g,p.sigBytes=y.length*4,this._process();var _=this._hash.toX32();return _},clone:function(){var p=i.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=i._createHelper(m),r.HmacSHA512=i._createHmacHelper(m)}(),t.SHA512})}(Hd)),Hd.exports}var qd={exports:{}},av;function W3(){return av||(av=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Bh(),NT())})(ae,function(t){return function(){var r=t,s=r.x64,i=s.Word,o=s.WordArray,a=r.algo,c=a.SHA512,u=a.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var l=c._doFinalize.call(this);return l.sigBytes-=16,l}});r.SHA384=c._createHelper(u),r.HmacSHA384=c._createHmacHelper(u)}(),t.SHA384})}(qd)),qd.exports}var $d={exports:{}},cv;function H3(){return cv||(cv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Bh())})(ae,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.x64,u=c.Word,l=s.algo,d=[],f=[],m=[];(function(){for(var g=1,x=0,_=0;_<24;_++){d[g+5*x]=(_+1)*(_+2)/2%64;var v=x%5,w=(2*g+3*x)%5;g=v,x=w}for(var g=0;g<5;g++)for(var x=0;x<5;x++)f[g+5*x]=x+(2*g+3*x)%5*5;for(var D=1,T=0;T<24;T++){for(var E=0,A=0,k=0;k<7;k++){if(D&1){var I=(1<<k)-1;I<32?A^=1<<I:E^=1<<I-32}D&128?D=D<<1^113:D<<=1}m[T]=u.create(E,A)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=u.create()})();var y=l.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],x=0;x<25;x++)g[x]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,x){for(var _=this._state,v=this.blockSize/2,w=0;w<v;w++){var D=g[x+2*w],T=g[x+2*w+1];D=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,T=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360;var E=_[w];E.high^=T,E.low^=D}for(var A=0;A<24;A++){for(var k=0;k<5;k++){for(var I=0,C=0,S=0;S<5;S++){var E=_[k+5*S];I^=E.high,C^=E.low}var P=p[k];P.high=I,P.low=C}for(var k=0;k<5;k++)for(var Y=p[(k+4)%5],X=p[(k+1)%5],oe=X.high,He=X.low,I=Y.high^(oe<<1|He>>>31),C=Y.low^(He<<1|oe>>>31),S=0;S<5;S++){var E=_[k+5*S];E.high^=I,E.low^=C}for(var be=1;be<25;be++){var I,C,E=_[be],Be=E.high,Re=E.low,b=d[be];b<32?(I=Be<<b|Re>>>32-b,C=Re<<b|Be>>>32-b):(I=Re<<b-32|Be>>>64-b,C=Be<<b-32|Re>>>64-b);var O=p[f[be]];O.high=I,O.low=C}var F=p[0],N=_[0];F.high=N.high,F.low=N.low;for(var k=0;k<5;k++)for(var S=0;S<5;S++){var be=k+5*S,E=_[be],Ge=p[be],Le=p[(k+1)%5+5*S],Kt=p[(k+2)%5+5*S];E.high=Ge.high^~Le.high&Kt.high,E.low=Ge.low^~Le.low&Kt.low}var E=_[0],ce=m[A];E.high^=ce.high,E.low^=ce.low}},_doFinalize:function(){var g=this._data,x=g.words;this._nDataBytes*8;var _=g.sigBytes*8,v=this.blockSize*32;x[_>>>5]|=1<<24-_%32,x[(r.ceil((_+1)/v)*v>>>5)-1]|=128,g.sigBytes=x.length*4,this._process();for(var w=this._state,D=this.cfg.outputLength/8,T=D/8,E=[],A=0;A<T;A++){var k=w[A],I=k.high,C=k.low;I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,E.push(C),E.push(I)}return new o.init(E,D)},clone:function(){for(var g=a.clone.call(this),x=g._state=this._state.slice(0),_=0;_<25;_++)x[_]=x[_].clone();return g}});s.SHA3=a._createHelper(y),s.HmacSHA3=a._createHmacHelper(y)}(Math),t.SHA3})}($d)),$d.exports}var Yd={exports:{}},uv;function q3(){return uv||(uv=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){/** @preserve
			(c) 2012 by Cdric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,u=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),m=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),y=c.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(T,E){for(var A=0;A<16;A++){var k=E+A,I=T[k];T[k]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360}var C=this._hash.words,S=m.words,P=p.words,Y=u.words,X=l.words,oe=d.words,He=f.words,be,Be,Re,b,O,F,N,Ge,Le,Kt;F=be=C[0],N=Be=C[1],Ge=Re=C[2],Le=b=C[3],Kt=O=C[4];for(var ce,A=0;A<80;A+=1)ce=be+T[E+Y[A]]|0,A<16?ce+=g(Be,Re,b)+S[0]:A<32?ce+=x(Be,Re,b)+S[1]:A<48?ce+=_(Be,Re,b)+S[2]:A<64?ce+=v(Be,Re,b)+S[3]:ce+=w(Be,Re,b)+S[4],ce=ce|0,ce=D(ce,oe[A]),ce=ce+O|0,be=O,O=b,b=D(Re,10),Re=Be,Be=ce,ce=F+T[E+X[A]]|0,A<16?ce+=w(N,Ge,Le)+P[0]:A<32?ce+=v(N,Ge,Le)+P[1]:A<48?ce+=_(N,Ge,Le)+P[2]:A<64?ce+=x(N,Ge,Le)+P[3]:ce+=g(N,Ge,Le)+P[4],ce=ce|0,ce=D(ce,He[A]),ce=ce+Kt|0,F=Kt,Kt=Le,Le=D(Ge,10),Ge=N,N=ce;ce=C[1]+Re+Le|0,C[1]=C[2]+b+Kt|0,C[2]=C[3]+O+F|0,C[3]=C[4]+be+N|0,C[4]=C[0]+Be+Ge|0,C[0]=ce},_doFinalize:function(){var T=this._data,E=T.words,A=this._nDataBytes*8,k=T.sigBytes*8;E[k>>>5]|=128<<24-k%32,E[(k+64>>>9<<4)+14]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,T.sigBytes=(E.length+1)*4,this._process();for(var I=this._hash,C=I.words,S=0;S<5;S++){var P=C[S];C[S]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}return I},clone:function(){var T=a.clone.call(this);return T._hash=this._hash.clone(),T}});function g(T,E,A){return T^E^A}function x(T,E,A){return T&E|~T&A}function _(T,E,A){return(T|~E)^A}function v(T,E,A){return T&A|E&~A}function w(T,E,A){return T^(E|~A)}function D(T,E){return T<<E|T>>>32-E}s.RIPEMD160=a._createHelper(y),s.HmacRIPEMD160=a._createHmacHelper(y)}(),t.RIPEMD160})}(Yd)),Yd.exports}var zd={exports:{}},lv;function eg(){return lv||(lv=1,function(n,e){(function(t,r){n.exports=r(pe())})(ae,function(t){(function(){var r=t,s=r.lib,i=s.Base,o=r.enc,a=o.Utf8,c=r.algo;c.HMAC=i.extend({init:function(u,l){u=this._hasher=new u.init,typeof l=="string"&&(l=a.parse(l));var d=u.blockSize,f=d*4;l.sigBytes>f&&(l=u.finalize(l)),l.clamp();for(var m=this._oKey=l.clone(),p=this._iKey=l.clone(),y=m.words,g=p.words,x=0;x<d;x++)y[x]^=1549556828,g[x]^=909522486;m.sigBytes=p.sigBytes=f,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var l=this._hasher,d=l.finalize(u);l.reset();var f=l.finalize(this._oKey.clone().concat(d));return f}})})()})}(zd)),zd.exports}var Gd={exports:{}},hv;function $3(){return hv||(hv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Zp(),eg())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.Base,o=s.WordArray,a=r.algo,c=a.SHA256,u=a.HMAC,l=a.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,f){for(var m=this.cfg,p=u.create(m.hasher,d),y=o.create(),g=o.create([1]),x=y.words,_=g.words,v=m.keySize,w=m.iterations;x.length<v;){var D=p.update(f).finalize(g);p.reset();for(var T=D.words,E=T.length,A=D,k=1;k<w;k++){A=p.finalize(A),p.reset();for(var I=A.words,C=0;C<E;C++)T[C]^=I[C]}y.concat(D),_[0]++}return y.sigBytes=v*4,y}});r.PBKDF2=function(d,f,m){return l.create(m).compute(d,f)}}(),t.PBKDF2})}(Gd)),Gd.exports}var Jd={exports:{}},dv;function Es(){return dv||(dv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),RT(),eg())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.Base,o=s.WordArray,a=r.algo,c=a.MD5,u=a.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,d){for(var f,m=this.cfg,p=m.hasher.create(),y=o.create(),g=y.words,x=m.keySize,_=m.iterations;g.length<x;){f&&p.update(f),f=p.update(l).finalize(d),p.reset();for(var v=1;v<_;v++)f=p.finalize(f),p.reset();y.concat(f)}return y.sigBytes=x*4,y}});r.EvpKDF=function(l,d,f){return u.create(f).compute(l,d)}}(),t.EvpKDF})}(Jd)),Jd.exports}var Qd={exports:{}},fv;function Et(){return fv||(fv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Es())})(ae,function(t){t.lib.Cipher||function(r){var s=t,i=s.lib,o=i.Base,a=i.WordArray,c=i.BufferedBlockAlgorithm,u=s.enc;u.Utf8;var l=u.Base64,d=s.algo,f=d.EvpKDF,m=i.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(I,C){return this.create(this._ENC_XFORM_MODE,I,C)},createDecryptor:function(I,C){return this.create(this._DEC_XFORM_MODE,I,C)},init:function(I,C,S){this.cfg=this.cfg.extend(S),this._xformMode=I,this._key=C,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(I){return this._append(I),this._process()},finalize:function(I){I&&this._append(I);var C=this._doFinalize();return C},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function I(C){return typeof C=="string"?k:T}return function(C){return{encrypt:function(S,P,Y){return I(P).encrypt(C,S,P,Y)},decrypt:function(S,P,Y){return I(P).decrypt(C,S,P,Y)}}}}()});i.StreamCipher=m.extend({_doFinalize:function(){var I=this._process(!0);return I},blockSize:1});var p=s.mode={},y=i.BlockCipherMode=o.extend({createEncryptor:function(I,C){return this.Encryptor.create(I,C)},createDecryptor:function(I,C){return this.Decryptor.create(I,C)},init:function(I,C){this._cipher=I,this._iv=C}}),g=p.CBC=function(){var I=y.extend();I.Encryptor=I.extend({processBlock:function(S,P){var Y=this._cipher,X=Y.blockSize;C.call(this,S,P,X),Y.encryptBlock(S,P),this._prevBlock=S.slice(P,P+X)}}),I.Decryptor=I.extend({processBlock:function(S,P){var Y=this._cipher,X=Y.blockSize,oe=S.slice(P,P+X);Y.decryptBlock(S,P),C.call(this,S,P,X),this._prevBlock=oe}});function C(S,P,Y){var X,oe=this._iv;oe?(X=oe,this._iv=r):X=this._prevBlock;for(var He=0;He<Y;He++)S[P+He]^=X[He]}return I}(),x=s.pad={},_=x.Pkcs7={pad:function(I,C){for(var S=C*4,P=S-I.sigBytes%S,Y=P<<24|P<<16|P<<8|P,X=[],oe=0;oe<P;oe+=4)X.push(Y);var He=a.create(X,P);I.concat(He)},unpad:function(I){var C=I.words[I.sigBytes-1>>>2]&255;I.sigBytes-=C}};i.BlockCipher=m.extend({cfg:m.cfg.extend({mode:g,padding:_}),reset:function(){var I;m.reset.call(this);var C=this.cfg,S=C.iv,P=C.mode;this._xformMode==this._ENC_XFORM_MODE?I=P.createEncryptor:(I=P.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==I?this._mode.init(this,S&&S.words):(this._mode=I.call(P,this,S&&S.words),this._mode.__creator=I)},_doProcessBlock:function(I,C){this._mode.processBlock(I,C)},_doFinalize:function(){var I,C=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(C.pad(this._data,this.blockSize),I=this._process(!0)):(I=this._process(!0),C.unpad(I)),I},blockSize:128/32});var v=i.CipherParams=o.extend({init:function(I){this.mixIn(I)},toString:function(I){return(I||this.formatter).stringify(this)}}),w=s.format={},D=w.OpenSSL={stringify:function(I){var C,S=I.ciphertext,P=I.salt;return P?C=a.create([1398893684,1701076831]).concat(P).concat(S):C=S,C.toString(l)},parse:function(I){var C,S=l.parse(I),P=S.words;return P[0]==1398893684&&P[1]==1701076831&&(C=a.create(P.slice(2,4)),P.splice(0,4),S.sigBytes-=16),v.create({ciphertext:S,salt:C})}},T=i.SerializableCipher=o.extend({cfg:o.extend({format:D}),encrypt:function(I,C,S,P){P=this.cfg.extend(P);var Y=I.createEncryptor(S,P),X=Y.finalize(C),oe=Y.cfg;return v.create({ciphertext:X,key:S,iv:oe.iv,algorithm:I,mode:oe.mode,padding:oe.padding,blockSize:I.blockSize,formatter:P.format})},decrypt:function(I,C,S,P){P=this.cfg.extend(P),C=this._parse(C,P.format);var Y=I.createDecryptor(S,P).finalize(C.ciphertext);return Y},_parse:function(I,C){return typeof I=="string"?C.parse(I,this):I}}),E=s.kdf={},A=E.OpenSSL={execute:function(I,C,S,P,Y){if(P||(P=a.random(64/8)),Y)var X=f.create({keySize:C+S,hasher:Y}).compute(I,P);else var X=f.create({keySize:C+S}).compute(I,P);var oe=a.create(X.words.slice(C),S*4);return X.sigBytes=C*4,v.create({key:X,iv:oe,salt:P})}},k=i.PasswordBasedCipher=T.extend({cfg:T.cfg.extend({kdf:A}),encrypt:function(I,C,S,P){P=this.cfg.extend(P);var Y=P.kdf.execute(S,I.keySize,I.ivSize,P.salt,P.hasher);P.iv=Y.iv;var X=T.encrypt.call(this,I,C,Y.key,P);return X.mixIn(Y),X},decrypt:function(I,C,S,P){P=this.cfg.extend(P),C=this._parse(C,P.format);var Y=P.kdf.execute(S,I.keySize,I.ivSize,C.salt,P.hasher);P.iv=Y.iv;var X=T.decrypt.call(this,I,C,Y.key,P);return X}})}()})}(Qd)),Qd.exports}var Kd={exports:{}},mv;function Y3(){return mv||(mv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize;s.call(this,i,o,c,a),this._prevBlock=i.slice(o,o+c)}}),r.Decryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,u=i.slice(o,o+c);s.call(this,i,o,c,a),this._prevBlock=u}});function s(i,o,a,c){var u,l=this._iv;l?(u=l.slice(0),this._iv=void 0):u=this._prevBlock,c.encryptBlock(u,0);for(var d=0;d<a;d++)i[o+d]^=u[d]}return r}(),t.mode.CFB})}(Kd)),Kd.exports}var jd={exports:{}},pv;function z3(){return pv||(pv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,u=this._iv,l=this._counter;u&&(l=this._counter=u.slice(0),this._iv=void 0);var d=l.slice(0);a.encryptBlock(d,0),l[c-1]=l[c-1]+1|0;for(var f=0;f<c;f++)i[o+f]^=d[f]}});return r.Decryptor=s,r}(),t.mode.CTR})}(jd)),jd.exports}var Xd={exports:{}},gv;function G3(){return gv||(gv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function s(a){if((a>>24&255)===255){var c=a>>16&255,u=a>>8&255,l=a&255;c===255?(c=0,u===255?(u=0,l===255?l=0:++l):++u):++c,a=0,a+=c<<16,a+=u<<8,a+=l}else a+=1<<24;return a}function i(a){return(a[0]=s(a[0]))===0&&(a[1]=s(a[1])),a}var o=r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,l=u.blockSize,d=this._iv,f=this._counter;d&&(f=this._counter=d.slice(0),this._iv=void 0),i(f);var m=f.slice(0);u.encryptBlock(m,0);for(var p=0;p<l;p++)a[c+p]^=m[p]}});return r.Decryptor=o,r}(),t.mode.CTRGladman})}(Xd)),Xd.exports}var Zd={exports:{}},yv;function J3(){return yv||(yv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,u=this._iv,l=this._keystream;u&&(l=this._keystream=u.slice(0),this._iv=void 0),a.encryptBlock(l,0);for(var d=0;d<c;d++)i[o+d]^=l[d]}});return r.Decryptor=s,r}(),t.mode.OFB})}(Zd)),Zd.exports}var ef={exports:{}},_v;function Q3(){return _v||(_v=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(s,i){this._cipher.encryptBlock(s,i)}}),r.Decryptor=r.extend({processBlock:function(s,i){this._cipher.decryptBlock(s,i)}}),r}(),t.mode.ECB})}(ef)),ef.exports}var tf={exports:{}},vv;function K3(){return vv||(vv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.pad.AnsiX923={pad:function(r,s){var i=r.sigBytes,o=s*4,a=o-i%o,c=i+a-1;r.clamp(),r.words[c>>>2]|=a<<24-c%4*8,r.sigBytes+=a},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},t.pad.Ansix923})}(tf)),tf.exports}var nf={exports:{}},wv;function j3(){return wv||(wv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.pad.Iso10126={pad:function(r,s){var i=s*4,o=i-r.sigBytes%i;r.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},t.pad.Iso10126})}(nf)),nf.exports}var rf={exports:{}},xv;function X3(){return xv||(xv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.pad.Iso97971={pad:function(r,s){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,s)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(rf)),rf.exports}var sf={exports:{}},Ev;function Z3(){return Ev||(Ev=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.pad.ZeroPadding={pad:function(r,s){var i=s*4;r.clamp(),r.sigBytes+=i-(r.sigBytes%i||i)},unpad:function(r){for(var s=r.words,i=r.sigBytes-1,i=r.sigBytes-1;i>=0;i--)if(s[i>>>2]>>>24-i%4*8&255){r.sigBytes=i+1;break}}},t.pad.ZeroPadding})}(sf)),sf.exports}var of={exports:{}},Iv;function e8(){return Iv||(Iv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(of)),of.exports}var af={exports:{}},Tv;function t8(){return Tv||(Tv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),Et())})(ae,function(t){return function(r){var s=t,i=s.lib,o=i.CipherParams,a=s.enc,c=a.Hex,u=s.format;u.Hex={stringify:function(l){return l.ciphertext.toString(c)},parse:function(l){var d=c.parse(l);return o.create({ciphertext:d})}}}(),t.format.Hex})}(af)),af.exports}var cf={exports:{}},Dv;function n8(){return Dv||(Dv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),hi(),di(),Es(),Et())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.BlockCipher,o=r.algo,a=[],c=[],u=[],l=[],d=[],f=[],m=[],p=[],y=[],g=[];(function(){for(var v=[],w=0;w<256;w++)w<128?v[w]=w<<1:v[w]=w<<1^283;for(var D=0,T=0,w=0;w<256;w++){var E=T^T<<1^T<<2^T<<3^T<<4;E=E>>>8^E&255^99,a[D]=E,c[E]=D;var A=v[D],k=v[A],I=v[k],C=v[E]*257^E*16843008;u[D]=C<<24|C>>>8,l[D]=C<<16|C>>>16,d[D]=C<<8|C>>>24,f[D]=C;var C=I*16843009^k*65537^A*257^D*16843008;m[E]=C<<24|C>>>8,p[E]=C<<16|C>>>16,y[E]=C<<8|C>>>24,g[E]=C,D?(D=A^v[v[v[I^A]]],T^=v[v[T]]):D=T=1}})();var x=[0,1,2,4,8,16,32,64,128,27,54],_=o.AES=i.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var w=this._keyPriorReset=this._key,D=w.words,T=w.sigBytes/4,E=this._nRounds=T+6,A=(E+1)*4,k=this._keySchedule=[],I=0;I<A;I++)I<T?k[I]=D[I]:(v=k[I-1],I%T?T>6&&I%T==4&&(v=a[v>>>24]<<24|a[v>>>16&255]<<16|a[v>>>8&255]<<8|a[v&255]):(v=v<<8|v>>>24,v=a[v>>>24]<<24|a[v>>>16&255]<<16|a[v>>>8&255]<<8|a[v&255],v^=x[I/T|0]<<24),k[I]=k[I-T]^v);for(var C=this._invKeySchedule=[],S=0;S<A;S++){var I=A-S;if(S%4)var v=k[I];else var v=k[I-4];S<4||I<=4?C[S]=v:C[S]=m[a[v>>>24]]^p[a[v>>>16&255]]^y[a[v>>>8&255]]^g[a[v&255]]}}},encryptBlock:function(v,w){this._doCryptBlock(v,w,this._keySchedule,u,l,d,f,a)},decryptBlock:function(v,w){var D=v[w+1];v[w+1]=v[w+3],v[w+3]=D,this._doCryptBlock(v,w,this._invKeySchedule,m,p,y,g,c);var D=v[w+1];v[w+1]=v[w+3],v[w+3]=D},_doCryptBlock:function(v,w,D,T,E,A,k,I){for(var C=this._nRounds,S=v[w]^D[0],P=v[w+1]^D[1],Y=v[w+2]^D[2],X=v[w+3]^D[3],oe=4,He=1;He<C;He++){var be=T[S>>>24]^E[P>>>16&255]^A[Y>>>8&255]^k[X&255]^D[oe++],Be=T[P>>>24]^E[Y>>>16&255]^A[X>>>8&255]^k[S&255]^D[oe++],Re=T[Y>>>24]^E[X>>>16&255]^A[S>>>8&255]^k[P&255]^D[oe++],b=T[X>>>24]^E[S>>>16&255]^A[P>>>8&255]^k[Y&255]^D[oe++];S=be,P=Be,Y=Re,X=b}var be=(I[S>>>24]<<24|I[P>>>16&255]<<16|I[Y>>>8&255]<<8|I[X&255])^D[oe++],Be=(I[P>>>24]<<24|I[Y>>>16&255]<<16|I[X>>>8&255]<<8|I[S&255])^D[oe++],Re=(I[Y>>>24]<<24|I[X>>>16&255]<<16|I[S>>>8&255]<<8|I[P&255])^D[oe++],b=(I[X>>>24]<<24|I[S>>>16&255]<<16|I[P>>>8&255]<<8|I[Y&255])^D[oe++];v[w]=be,v[w+1]=Be,v[w+2]=Re,v[w+3]=b},keySize:256/32});r.AES=i._createHelper(_)}(),t.AES})}(cf)),cf.exports}var uf={exports:{}},Av;function r8(){return Av||(Av=1,function(n,e){(function(t,r,s){n.exports=r(pe(),hi(),di(),Es(),Et())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=s.BlockCipher,a=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],m=a.DES=o.extend({_doReset:function(){for(var x=this._key,_=x.words,v=[],w=0;w<56;w++){var D=c[w]-1;v[w]=_[D>>>5]>>>31-D%32&1}for(var T=this._subKeys=[],E=0;E<16;E++){for(var A=T[E]=[],k=l[E],w=0;w<24;w++)A[w/6|0]|=v[(u[w]-1+k)%28]<<31-w%6,A[4+(w/6|0)]|=v[28+(u[w+24]-1+k)%28]<<31-w%6;A[0]=A[0]<<1|A[0]>>>31;for(var w=1;w<7;w++)A[w]=A[w]>>>(w-1)*4+3;A[7]=A[7]<<5|A[7]>>>27}for(var I=this._invSubKeys=[],w=0;w<16;w++)I[w]=T[15-w]},encryptBlock:function(x,_){this._doCryptBlock(x,_,this._subKeys)},decryptBlock:function(x,_){this._doCryptBlock(x,_,this._invSubKeys)},_doCryptBlock:function(x,_,v){this._lBlock=x[_],this._rBlock=x[_+1],p.call(this,4,252645135),p.call(this,16,65535),y.call(this,2,858993459),y.call(this,8,16711935),p.call(this,1,1431655765);for(var w=0;w<16;w++){for(var D=v[w],T=this._lBlock,E=this._rBlock,A=0,k=0;k<8;k++)A|=d[k][((E^D[k])&f[k])>>>0];this._lBlock=E,this._rBlock=T^A}var I=this._lBlock;this._lBlock=this._rBlock,this._rBlock=I,p.call(this,1,1431655765),y.call(this,8,16711935),y.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),x[_]=this._lBlock,x[_+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(x,_){var v=(this._lBlock>>>x^this._rBlock)&_;this._rBlock^=v,this._lBlock^=v<<x}function y(x,_){var v=(this._rBlock>>>x^this._lBlock)&_;this._lBlock^=v,this._rBlock^=v<<x}r.DES=o._createHelper(m);var g=a.TripleDES=o.extend({_doReset:function(){var x=this._key,_=x.words;if(_.length!==2&&_.length!==4&&_.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var v=_.slice(0,2),w=_.length<4?_.slice(0,2):_.slice(2,4),D=_.length<6?_.slice(0,2):_.slice(4,6);this._des1=m.createEncryptor(i.create(v)),this._des2=m.createEncryptor(i.create(w)),this._des3=m.createEncryptor(i.create(D))},encryptBlock:function(x,_){this._des1.encryptBlock(x,_),this._des2.decryptBlock(x,_),this._des3.encryptBlock(x,_)},decryptBlock:function(x,_){this._des3.decryptBlock(x,_),this._des2.encryptBlock(x,_),this._des1.decryptBlock(x,_)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=o._createHelper(g)}(),t.TripleDES})}(uf)),uf.exports}var lf={exports:{}},Cv;function s8(){return Cv||(Cv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),hi(),di(),Es(),Et())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=o.RC4=i.extend({_doReset:function(){for(var l=this._key,d=l.words,f=l.sigBytes,m=this._S=[],p=0;p<256;p++)m[p]=p;for(var p=0,y=0;p<256;p++){var g=p%f,x=d[g>>>2]>>>24-g%4*8&255;y=(y+m[p]+x)%256;var _=m[p];m[p]=m[y],m[y]=_}this._i=this._j=0},_doProcessBlock:function(l,d){l[d]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var l=this._S,d=this._i,f=this._j,m=0,p=0;p<4;p++){d=(d+1)%256,f=(f+l[d])%256;var y=l[d];l[d]=l[f],l[f]=y,m|=l[(l[d]+l[f])%256]<<24-p*8}return this._i=d,this._j=f,m}r.RC4=i._createHelper(a);var u=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var l=this.cfg.drop;l>0;l--)c.call(this)}});r.RC4Drop=i._createHelper(u)}(),t.RC4})}(lf)),lf.exports}var hf={exports:{}},bv;function i8(){return bv||(bv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),hi(),di(),Es(),Et())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=[],c=[],u=[],l=o.Rabbit=i.extend({_doReset:function(){for(var f=this._key.words,m=this.cfg.iv,p=0;p<4;p++)f[p]=(f[p]<<8|f[p]>>>24)&16711935|(f[p]<<24|f[p]>>>8)&4278255360;var y=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],g=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var p=0;p<4;p++)d.call(this);for(var p=0;p<8;p++)g[p]^=y[p+4&7];if(m){var x=m.words,_=x[0],v=x[1],w=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,D=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,T=w>>>16|D&4294901760,E=D<<16|w&65535;g[0]^=w,g[1]^=T,g[2]^=D,g[3]^=E,g[4]^=w,g[5]^=T,g[6]^=D,g[7]^=E;for(var p=0;p<4;p++)d.call(this)}},_doProcessBlock:function(f,m){var p=this._X;d.call(this),a[0]=p[0]^p[5]>>>16^p[3]<<16,a[1]=p[2]^p[7]>>>16^p[5]<<16,a[2]=p[4]^p[1]>>>16^p[7]<<16,a[3]=p[6]^p[3]>>>16^p[1]<<16;for(var y=0;y<4;y++)a[y]=(a[y]<<8|a[y]>>>24)&16711935|(a[y]<<24|a[y]>>>8)&4278255360,f[m+y]^=a[y]},blockSize:128/32,ivSize:64/32});function d(){for(var f=this._X,m=this._C,p=0;p<8;p++)c[p]=m[p];m[0]=m[0]+1295307597+this._b|0,m[1]=m[1]+3545052371+(m[0]>>>0<c[0]>>>0?1:0)|0,m[2]=m[2]+886263092+(m[1]>>>0<c[1]>>>0?1:0)|0,m[3]=m[3]+1295307597+(m[2]>>>0<c[2]>>>0?1:0)|0,m[4]=m[4]+3545052371+(m[3]>>>0<c[3]>>>0?1:0)|0,m[5]=m[5]+886263092+(m[4]>>>0<c[4]>>>0?1:0)|0,m[6]=m[6]+1295307597+(m[5]>>>0<c[5]>>>0?1:0)|0,m[7]=m[7]+3545052371+(m[6]>>>0<c[6]>>>0?1:0)|0,this._b=m[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var y=f[p]+m[p],g=y&65535,x=y>>>16,_=((g*g>>>17)+g*x>>>15)+x*x,v=((y&4294901760)*y|0)+((y&65535)*y|0);u[p]=_^v}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.Rabbit=i._createHelper(l)}(),t.Rabbit})}(hf)),hf.exports}var df={exports:{}},kv;function o8(){return kv||(kv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),hi(),di(),Es(),Et())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=[],c=[],u=[],l=o.RabbitLegacy=i.extend({_doReset:function(){var f=this._key.words,m=this.cfg.iv,p=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],y=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var g=0;g<4;g++)d.call(this);for(var g=0;g<8;g++)y[g]^=p[g+4&7];if(m){var x=m.words,_=x[0],v=x[1],w=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,D=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,T=w>>>16|D&4294901760,E=D<<16|w&65535;y[0]^=w,y[1]^=T,y[2]^=D,y[3]^=E,y[4]^=w,y[5]^=T,y[6]^=D,y[7]^=E;for(var g=0;g<4;g++)d.call(this)}},_doProcessBlock:function(f,m){var p=this._X;d.call(this),a[0]=p[0]^p[5]>>>16^p[3]<<16,a[1]=p[2]^p[7]>>>16^p[5]<<16,a[2]=p[4]^p[1]>>>16^p[7]<<16,a[3]=p[6]^p[3]>>>16^p[1]<<16;for(var y=0;y<4;y++)a[y]=(a[y]<<8|a[y]>>>24)&16711935|(a[y]<<24|a[y]>>>8)&4278255360,f[m+y]^=a[y]},blockSize:128/32,ivSize:64/32});function d(){for(var f=this._X,m=this._C,p=0;p<8;p++)c[p]=m[p];m[0]=m[0]+1295307597+this._b|0,m[1]=m[1]+3545052371+(m[0]>>>0<c[0]>>>0?1:0)|0,m[2]=m[2]+886263092+(m[1]>>>0<c[1]>>>0?1:0)|0,m[3]=m[3]+1295307597+(m[2]>>>0<c[2]>>>0?1:0)|0,m[4]=m[4]+3545052371+(m[3]>>>0<c[3]>>>0?1:0)|0,m[5]=m[5]+886263092+(m[4]>>>0<c[4]>>>0?1:0)|0,m[6]=m[6]+1295307597+(m[5]>>>0<c[5]>>>0?1:0)|0,m[7]=m[7]+3545052371+(m[6]>>>0<c[6]>>>0?1:0)|0,this._b=m[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var y=f[p]+m[p],g=y&65535,x=y>>>16,_=((g*g>>>17)+g*x>>>15)+x*x,v=((y&4294901760)*y|0)+((y&65535)*y|0);u[p]=_^v}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}r.RabbitLegacy=i._createHelper(l)}(),t.RabbitLegacy})}(df)),df.exports}var ff={exports:{}},Sv;function a8(){return Sv||(Sv=1,function(n,e){(function(t,r,s){n.exports=r(pe(),hi(),di(),Es(),Et())})(ae,function(t){return function(){var r=t,s=r.lib,i=s.BlockCipher,o=r.algo;const a=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],u=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var l={pbox:[],sbox:[]};function d(g,x){let _=x>>24&255,v=x>>16&255,w=x>>8&255,D=x&255,T=g.sbox[0][_]+g.sbox[1][v];return T=T^g.sbox[2][w],T=T+g.sbox[3][D],T}function f(g,x,_){let v=x,w=_,D;for(let T=0;T<a;++T)v=v^g.pbox[T],w=d(g,v)^w,D=v,v=w,w=D;return D=v,v=w,w=D,w=w^g.pbox[a],v=v^g.pbox[a+1],{left:v,right:w}}function m(g,x,_){let v=x,w=_,D;for(let T=a+1;T>1;--T)v=v^g.pbox[T],w=d(g,v)^w,D=v,v=w,w=D;return D=v,v=w,w=D,w=w^g.pbox[1],v=v^g.pbox[0],{left:v,right:w}}function p(g,x,_){for(let E=0;E<4;E++){g.sbox[E]=[];for(let A=0;A<256;A++)g.sbox[E][A]=u[E][A]}let v=0;for(let E=0;E<a+2;E++)g.pbox[E]=c[E]^x[v],v++,v>=_&&(v=0);let w=0,D=0,T=0;for(let E=0;E<a+2;E+=2)T=f(g,w,D),w=T.left,D=T.right,g.pbox[E]=w,g.pbox[E+1]=D;for(let E=0;E<4;E++)for(let A=0;A<256;A+=2)T=f(g,w,D),w=T.left,D=T.right,g.sbox[E][A]=w,g.sbox[E][A+1]=D;return!0}var y=o.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,x=g.words,_=g.sigBytes/4;p(l,x,_)}},encryptBlock:function(g,x){var _=f(l,g[x],g[x+1]);g[x]=_.left,g[x+1]=_.right},decryptBlock:function(g,x){var _=m(l,g[x],g[x+1]);g[x]=_.left,g[x+1]=_.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=i._createHelper(y)}(),t.Blowfish})}(ff)),ff.exports}(function(n,e){(function(t,r,s){n.exports=r(pe(),Bh(),B3(),L3(),hi(),V3(),di(),RT(),Zp(),U3(),NT(),W3(),H3(),q3(),eg(),$3(),Es(),Et(),Y3(),z3(),G3(),J3(),Q3(),K3(),j3(),X3(),Z3(),e8(),t8(),n8(),r8(),s8(),i8(),o8(),a8())})(ae,function(t){return t})})(PT);var c8=PT.exports;const u8=iw(c8),{AES:l8,enc:cc,SHA256:tg}=u8,h8="16charactersiv!";function d8(n,e){const t=f8(e),r=cc.Utf8.parse(h8);return l8.encrypt(n,t,{iv:r}).toString()}function f8(n){let e="htr;lmn;rkmnkryemnkrmnbavsdbshtg6437";return e=tg(n+e).toString(cc.Hex).substring(0,32),cc.Utf8.parse(e)}function Y5(n,e="simpleCode"){return n===""?"":tg(n+e).toString(cc.Hex)}function m8({id:n}){if(n.length<7)return"";const e=n.substring(3,6),t=tg(n+e).toString(cc.Hex);return t.substring(0,Math.min(10,t.length)).replace(/[/.*]/g,"")}function ri(n){return d8(n+qC,HC).replace("/","").replace("*","").replace(".","")}var Du=(n=>(n[n.shortestTreatment=0]="shortestTreatment",n[n.longestTreatment=1]="longestTreatment",n[n.custom=2]="custom",n[n.first=3]="first",n[n.last=4]="last",n[n.edges=5]="edges",n))(Du||{});const p8={3:"first",4:"last",5:"edges",0:"shortestTreatment",1:"longestTreatment",2:"custom"},g8={first:3,last:4,edges:5,shortestTreatment:0,longestTreatment:1,custom:2};class MT{constructor({start:e,end:t}){h(this,"start");h(this,"end");this.start=e,this.end=t}}function OT(n){n.sort((s,i)=>s.start.getTime()-i.start.getTime());const e=[];let t=0;for(let s=0;s<n.length;s=t){const i=n[s];for(e.push(i),t=s+1;t<n.length;t++){const o=n[t],a=ex(pu(i.start),pu(i.end),pu(o.start),pu(o.end));if(a==="AFTER")if(i.end.toUTCString()===o.start.toUTCString())i.end=o.end;else break;a==="STRIKE"&&(o.start.getTime()<i.start.getTime()&&(i.start=o.start),o.end.getTime()>i.end.getTime()&&(i.end=o.end))}}const r=[];return e.forEach(s=>{r.push(Cn(s.start)),r.push(Cn(s.end))}),r}function y8(n){const e=[];for(let t=0;t<n.length;t+=2){const r=dc(n[t]),s=dc(n[t+1]);e.push(new MT({start:r,end:s}))}return e}function Pv(n,e){for(let t=0;t<e.length;t+=2){const r=new Date(e[t]),s=new Date(e[t+1]);n.push(new MT({start:r,end:s}))}}class Qn{constructor({token:e="",joinDate:t,id:r="",activeNotifications:s=!0}){h(this,"token");h(this,"joinDate");h(this,"id");h(this,"activeNotifications");this.token=e,this.joinDate=t,this.id=r,this.activeNotifications=s}static fromJson(e,t){const r=new Qn({joinDate:new Date(0)});return r.id=t,r.activeNotifications=e.activeNotifications??!0,r.token=e.token??"",r}toJson(){const e={};return this.activeNotifications||(e.activeNotifications=this.activeNotifications),e.token=this.token,e.joinDate=sn(this.joinDate),e}static fromDevice(e){return new Qn({joinDate:e.joinDate,id:e.id,activeNotifications:e.activeNotifications,token:e.token})}}function ha(n,e=-1){let t="",r="",s="",i="",o="",a="",c=n.days;Math.floor(c/30)>0&&(Math.floor(c/30)===1&&(a=z("month")),Math.floor(c/30)===2&&(a=z("twoMonths")),Math.floor(c/30)>2&&(a=`${Math.floor(c/30)} `+z("months"))),c-=Math.floor(c/30)*30,Math.floor(c/7)>0&&(Math.floor(c/7)===1&&(o=z("week")),Math.floor(c/7)===2&&(o=z("twoWeeks")),Math.floor(c/7)>2&&(o=`${Math.floor(c/7)} `+z("weeks"))),c-=Math.floor(c/7)*7,c===1&&(i=z("day")),c===2&&(i=z("twoDays")),c>2&&(i=`${c} `+z("days"));let u=n.hours-n.days*24;u===1&&(t=z("hour")),u===2&&(t=z("twoHours")),u>2&&(t=`${u}`+z("hoursChar"));let l=n.minutes-n.hours*60;r=l>0?`${l}`+z("minutesChar"):"";let d=n.seconds-n.minutes*60;d===1&&(s=z("second",!1)),d>1&&(s=`${d} `+z("seconds"));let f="";return n.days===365?f=z("year"):n.days%365===0&&n.days>365?f=(n.days/365).toFixed(0)+" "+z("years"):o===""&&a!==""&&i===""?f=a:o!==""&&a===""&&i===""?f=o:o!==""&&a!==""&&i===""?f=a+" "+z("and")+o:o!==""&&a===""&&i!==""?f=o+" "+z("and")+i:o===""&&a!==""&&i!==""?f=a+" "+z("and")+i:o!==""&&a!==""&&i!==""?f=a+" ,"+o+" "+z("and")+i:r===""&&t===""&&i!==""?f=i:r!==""&&t===""&&i===""?f=r:r===""&&t!==""&&i===""?f=t:r!==""&&t!==""&&i===""?f=t+" "+z("and")+r:r!==""&&t===""&&i!==""?f=i+" "+z("and")+r:r===""&&t!==""&&i!==""?f=i+" "+z("and")+t:r!==""&&t!==""&&i!==""?f=i+" ,"+t+" "+z("and")+r:s!==""&&(f=s),f.length===0?"":e===-1||e>f.length?f:f.slice(0,e)+".."+f.slice(e)}function z5(n){const e=r=>r.toString().padStart(2,"0"),t=e(n.minutes%60);return`${e(n.hours)}:${t}`}function G5(n,e=""){let t="";bt(n,"dd-MM-yyyy")===bt(G0(new Date,1),"dd-MM-yyyy")&&(t=z("tomorrow")),bt(n,"dd-MM-yyyy")===bt(new Date,"dd-MM-yyyy")&&(t=z("today"));const r=jC[n.getDay()];return`${t!==""?t:e+z(r)}`}function _8(n){try{const e=n.indexOf("-");let t=n.substring(e+1,n.length);return t="0"+t,t.substring(0,3)+"-"+t.substring(3,t.length)}catch{return n}}var hr=(n=>(n[n.deposit=0]="deposit",n[n.payment=1]="payment",n))(hr||{});const P0={0:"deposit",1:"payment"},R0={deposit:0,payment:1};class qs{constructor({type:e=1,amount:t=0,id:r="",hypId:s="",createdAt:i=new Date(0)}){h(this,"type",1);h(this,"amount",0);h(this,"createdAt",new Date(0));h(this,"id","");h(this,"hypId","");this.type=e,this.amount=parseFloat(t.toFixed(2)),this.id=r,this.hypId=s,this.createdAt=i}static fromJson(e,t){const r=new qs({});return e.amount!=null&&(r.amount=e.amount),r.hypId=e.hypId||"",r.id=t,r.type=R0[e.type]||1,r.createdAt=e.createdAt?new Date(e.createdAt):new Date(0),r}static fromTransaction(e){const t=new qs({});return t.type=e.type,t.amount=e.amount,t.id=e.id,t.hypId=e.hypId,t.createdAt=e.createdAt,t}toJson(){const e={};return e.amount=this.amount,e.hypId=this.hypId,e.type=P0[this.type],e.createdAt=Ae(this.createdAt),e}toString(){return JSON.stringify(this.toJson(),null,2)}}class qi{constructor({workMinutes:e=0,breakMinutes:t=0,title:r=""}){h(this,"workMinutes",0);h(this,"breakMinutes",0);h(this,"title","");this.workMinutes=e,this.breakMinutes=t,this.title=r}get wholeMinutes(){return this.workMinutes+this.breakMinutes}static fromTreatmentTime(e){return new qi({breakMinutes:e.breakMinutes,workMinutes:e.workMinutes,title:e.title})}static fromJson(e){return new qi({breakMinutes:e.break||0,workMinutes:e.duration||0,title:e.title||""})}toJson(){const e={};return e.break=this.breakMinutes,e.duration=this.workMinutes,e.title=this.title,e}toString(){return JSON.stringify(this,null,2)}}class vn{constructor({times:e=new Map,id:t="",price:r,count:s=1,name:i="",isMulti:o=!1,maxTicketsForUser:a=1,index:c="",amountInAdvance:u=0,colorIndex:l=-2,hide:d=!1,paymentType:f,note:m="",maxParticipants:p=1,showPrice:y=!0,showParticipants:g=!0,showTime:x=!0}={}){h(this,"totalMinutes",0);h(this,"index","");h(this,"id","");h(this,"note","");h(this,"price");h(this,"amountInAdvance",0);h(this,"paymentType");h(this,"isMulti",!1);h(this,"showPrice",!0);h(this,"showTime",!0);h(this,"count",1);h(this,"name","");h(this,"colorIndex",-2);h(this,"maxParticipants",1);h(this,"maxTicketsForUser",1);h(this,"tempMaxParticipants");h(this,"hide",!1);h(this,"showParticipants",!0);h(this,"times",new Map);h(this,"priceChangingNote");this.times=e,this.id=t,this.price=r,this.count=s,this.name=i,this.isMulti=o,this.maxTicketsForUser=a,this.index=c,this.amountInAdvance=u,this.colorIndex=l,this.hide=d,this.paymentType=f,this.note=m,this.maxParticipants=p,this.showPrice=y,this.showParticipants=g,this.showTime=x,this.totalMinutes=this.totalTotalMinutes}isEqual(e){return!0}get totalTotalMinutes(){let e=0;return this.times.forEach((t,r)=>{e+=t.wholeMinutes}),e}get totalWorkMinutes(){let e=0;return this.times.forEach((t,r)=>{e+=t.workMinutes}),e}get totalMinutesForBooking(){return this.totalMinutes*this.count}get amountInAdvanceForBooking(){return this.amountInAdvance*this.count}get totalPriceForBooking(){return this.price.amount*this.count}get nameForBooking(){return this.count===1?this.name:`${this.name} X${this.count}`}static fromTreatment(e){const t=new vn({times:new Map,showTime:e.showTime,paymentType:e.paymentType,id:e.id,hide:e.hide,showPrice:e.showPrice,price:e.price,index:e.index,maxTicketsForUser:e.maxTicketsForUser,colorIndex:e.colorIndex,name:e.name,isMulti:e.isMulti,note:e.note,count:e.count,maxParticipants:e.maxParticipants,amountInAdvance:e.amountInAdvance});return t.priceChangingNote=e.priceChangingNote,t.tempMaxParticipants=e.tempMaxParticipants,t.totalMinutes=e.totalMinutes,e.times.forEach((r,s)=>{t.times.set(s,qi.fromTreatmentTime(r))}),t}static fromTreatmentsMap(e){let t=0;const r=new vn({price:new Vt({amount:"0",currency:us})});return e.forEach((s,i)=>{for(let o=0;o<s.count;o++)s.times.forEach((a,c)=>{r.times.set(t.toString(),a),t++}),s.price&&(r.price.amount+=s.price.amount,r.price.currency=s.price.currency),r.name===""?r.name=s.name:r.name+=` + ${s.name}`,r.showTime=r.showTime&&s.showTime,r.showPrice=r.showPrice&&s.showPrice,r.paymentType=s.paymentType,r.amountInAdvance+=s.amountInAdvance,r.totalMinutes+=s.totalMinutes}),r}get participants(){return this.tempMaxParticipants!==void 0?this.tempMaxParticipants:this.maxParticipants}priceToString(){return this.price.toString()}minutesToString(){return ha(new ee({minutes:this.totalMinutes}))}static fromJson(e,t){const r=new vn({times:new Map,id:e.id||"",colorIndex:e.colorIndex||-2,maxTicketsForUser:e.maxTicketsForUser||1,index:t,hide:e.hide||!1,name:e.name||"",isMulti:e.isMulti||!1,note:e.note||"",count:e.count||1,price:e.price?Vt.fromJson(e.price):void 0,amountInAdvance:e.amountInAdvance!==void 0?typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance):0,maxParticipants:e.maxParticipants||1,paymentType:R0[e.paymentType],showPrice:e.showPrice||!1,showTime:e.showTime||!1,showParticipants:e.showParticipants||!0});if(r.priceChangingNote=e.priceChangingNote,r.tempMaxParticipants=e.tempMaxParticipants,e.times)for(const s in e.times)r.times.set(s,qi.fromJson(e.times[s]));return r}toJson(){const e={};return e.times={},this.times.forEach((t,r)=>{e.times[r]=t.toJson()}),e.name=this.name,this.note!==""&&(e.note=this.note),this.id!==""&&(e.id=this.id),this.hide&&(e.hide=this.hide),this.maxTicketsForUser>1&&(e.maxTicketsForUser=this.maxTicketsForUser),this.colorIndex!==-2&&(e.colorIndex=this.colorIndex),this.priceChangingNote!==void 0&&(e.priceChangingNote=this.priceChangingNote),e.price=this.price?this.price.toJson():void 0,this.amountInAdvance!==0&&(e.amountInAdvance=this.amountInAdvance),this.paymentType!=null&&P0[this.paymentType]!=null&&(e.paymentType=P0[this.paymentType]),this.isMulti&&(e.isMulti=this.isMulti),this.tempMaxParticipants!==void 0&&(e.tempMaxParticipants=this.tempMaxParticipants),this.count!==1&&(e.count=this.count),this.maxParticipants!==1&&(e.maxParticipants=this.maxParticipants),this.showParticipants||(e.showParticipants=this.showParticipants),e.showPrice=this.showPrice,e.showTime=this.showTime,e}static fromOldJson(e,t,r,s){const i=new vn({});if(e.times)for(const o in e.times)e.times.hasOwnProperty(o)&&i.times.set(o,qi.fromJson(e.times[o]));return i.id="",i.colorIndex=s,i.index=t,i.name=i.parseNameFromDbField(r),e.price&&(i.price=Vt.fromJson(e.price)),e.amountInAdvance!==void 0&&(i.amountInAdvance=typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance)),i.paymentType=R0[e.paymentType],i.showPrice=e.showPrice||!1,i.showTime=e.showTime||!1,i.totalMinutes=i.totalTotalMinutes,i}parseNameFromDbField(e){return e.replace(jg,"/").replace(Xg,"*")}parseNameToDbField(e){return e.replace("/",jg).replace("*",Xg)}toString(){return JSON.stringify(this,null,2)}}class $i{constructor({treatmentId:e,minutes:t,maxParticipants:r,paymentRequestId:s,showWaitingList:i=!0,currentParticipants:o=0,expiredDate:a,index:c=0}){h(this,"treatmentId","");h(this,"currentParticipants",0);h(this,"maxParticipants");h(this,"minutes",0);h(this,"index",0);h(this,"showWaitingList",!0);h(this,"expiredDate");h(this,"paymentRequestId");this.treatmentId=e,this.currentParticipants=o,this.minutes=t,this.showWaitingList=i,this.maxParticipants=r,this.expiredDate=a,this.paymentRequestId=s,this.index=c}static fromMultiBookingTime(e){return new $i({treatmentId:e.treatmentId,currentParticipants:e.currentParticipants,minutes:e.minutes,showWaitingList:e.showWaitingList,maxParticipants:e.maxParticipants,expiredDate:e.expiredDate,paymentRequestId:e.paymentRequestId,index:e.index})}static fromJson(e){const t=e.TI||"",r=e.CP||0,s=e.M||0,i=e.PRI,o=e.SWL||!0,a=e.ED,c=e.MP,u=e.I||0,l=a?new Date(a):void 0;return new $i({treatmentId:t,currentParticipants:r,minutes:s,maxParticipants:c,paymentRequestId:i,showWaitingList:o,expiredDate:l,index:u})}toJson(){const e={};return this.treatmentId!==""&&(e.TI=this.treatmentId),this.currentParticipants!==0&&(e.CP=this.currentParticipants),this.maxParticipants!==void 0&&(e.MP=this.maxParticipants),this.paymentRequestId!==void 0&&(e.PRI=this.paymentRequestId),e.M=this.minutes,this.index!==0&&(e.I=this.index),this.showWaitingList||(e.SWL=this.showWaitingList),this.expiredDate!==void 0&&(e.ED=Ae(this.expiredDate)),e}}class ng{constructor(){h(this,"times",{});h(this,"duringPaymentsTimes",{});h(this,"listener");h(this,"lastBookingTimeDate")}static fromJson(e){const t=new ng;return t.setData(e),t}setData(e,t=!0){this.times={},e.eventsTimes!==null&&Object.entries(e.eventsTimes).forEach(([r,s])=>{const i=new Date(r),o=new Date;o.setDate(o.getDate()-7),i>=o&&s instanceof Object&&Object.keys(s).length>0&&(this.times[r]={},Object.entries(s).forEach(([a,c])=>{this.times[r][a]=$i.fromJson(c)}))}),e.eventsTimeDuringPayment!==null&&t&&Object.entries(e.eventsTimeDuringPayment).forEach(([r,s])=>{const i=new Date(r),o=new Date;o.setDate(o.getDate()-7),i>=o&&Object.entries(s).forEach(([a,c])=>{var l,d;const u=$i.fromJson(c);if(u.expiredDate!==null&&u.expiredDate.getTime()>Date.now()){if((l=this.times)[r]??(l[r]={}),this.times[r][a]===null){const f=$i.fromMultiBookingTime(u);f.expiredDate=void 0,this.times[r][a]=f}else this.times[r][a].currentParticipants+=u.currentParticipants;i>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=i),(d=this.duringPaymentsTimes)[r]??(d[r]={}),this.duringPaymentsTimes[r][a]=u}})})}toJson(){const e={};return e.eventsTimes={},Object.entries(this.times).forEach(([t,r])=>{e.eventsTimes[t]={},Object.entries(r).forEach(([s,i])=>{e.eventsTimes[t][s]=i.toJson()})}),e}}class Yi{constructor(){h(this,"showAdressAlert",!1);h(this,"showAdressMessage",!1);h(this,"showPhoneAlert",!1);h(this,"showPhoneMessage",!1);h(this,"recurrenceNotificationsLastDate");h(this,"notifyOnPayments",!0);h(this,"notifyOnWaitingListEvents",!0);h(this,"notifyAboutCancelNearDeadline",!0);h(this,"notifyOnClientConfirmArrival",!0);h(this,"notifyAboutOrderNearDeadline",!0);h(this,"notificationOption",We.PushOrSMS);h(this,"notifyWhenGettingBooking",!0);h(this,"remindersTypes",new Map)}static fromJson(e){const t=new Yi;if(t.notifyOnWaitingListEvents=e.notifyOnWaitingListEvents??!0,e.notificationOption!==void 0&&(t.notificationOption=Ll[e.notificationOption]??We.PushOrSMS),t.recurrenceNotificationsLastDate=e.recurrenceNotificationsLastDate?new Date(e.recurrenceNotificationsLastDate):void 0,t.remindersTypes=new Map,e.remindersTypes!==void 0)for(const[r,s]of Object.entries(e.remindersTypes)){const i=Ns[r];i!==void 0&&t.remindersTypes.set(i,s)}else t.remindersTypes.set(Yt.regular,e.minutesBeforeNotify??60);return t.notifyOnClientConfirmArrival=e.notifyOnClientConfirmArrival??!0,t.showAdressAlert=e.showAdressAlert??!1,t.showAdressMessage=e.showAdressMessage??!1,t.showPhoneAlert=e.showPhoneAlert??!1,t.showPhoneMessage=e.showPhoneMessage??!1,t.notifyOnPayments=e.notifyOnPayments??!0,t.notifyAboutCancelNearDeadline=e.notifyAboutCancelNearDeadline??!0,t.notifyAboutOrderNearDeadline=e.notifyAboutOrderNearDeadline??!0,t.notifyWhenGettingBooking=e.notifyWhenGettingBooking??!0,t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}static fromWorkerNotificatiosSettings(e){return Yi.fromJson(e.toJson())}toJson(){const e={};return this.notifyOnWaitingListEvents||(e.notifyOnWaitingListEvents=this.notifyOnWaitingListEvents),this.notificationOption!==We.PushOrSMS&&(e.notificationOption=We[this.notificationOption]),this.recurrenceNotificationsLastDate!=null&&(e.recurrenceNotificationsLastDate=Ae(this.recurrenceNotificationsLastDate)),this.notifyOnClientConfirmArrival||(e.notifyOnClientConfirmArrival=this.notifyOnClientConfirmArrival),this.notifyOnPayments||(e.notifyOnPayments=this.notifyOnPayments),e.remindersTypes={},this.remindersTypes.forEach((t,r)=>{e.remindersTypes[Yt[r]]=t}),this.notifyAboutCancelNearDeadline||(e.notifyAboutCancelNearDeadline=this.notifyAboutCancelNearDeadline),this.notifyAboutOrderNearDeadline||(e.notifyAboutOrderNearDeadline=this.notifyAboutOrderNearDeadline),this.notifyWhenGettingBooking||(e.notifyWhenGettingBooking=this.notifyWhenGettingBooking),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showAdressMessage&&(e.showAdressMessage=this.showAdressMessage),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.showPhoneMessage&&(e.showPhoneMessage=this.showPhoneMessage),e}toString(){return JSON.stringify(this.toJson())}}class zi{constructor({freeFromPayments:e=!1,hashNumber:t="",blocked:r=!1}={}){h(this,"freeFromPayments");h(this,"hashNumber");h(this,"blocked");this.freeFromPayments=e,this.hashNumber=t,this.blocked=r}static fromJson(e,t){return new zi({freeFromPayments:e.freeFromPayments,hashNumber:t})}static fromMinimalJson(e,t){return new zi({blocked:e.B??!1,freeFromPayments:e.FP,hashNumber:t})}static fromCustomerData(e){return new zi({blocked:e.blocked,freeFromPayments:e.freeFromPayments,hashNumber:e.hashNumber})}toJson(){const e={};return e.freeFromPayments=this.freeFromPayments,e.blocked=this.blocked,e}toMinimalJson(){const e={};return e.FP=this.freeFromPayments,e.B=this.blocked,e}toString(){return JSON.stringify(this.toJson(),null,2)}}class rg{constructor({publicCustomersData:e}={}){h(this,"publicCustomersData");this.publicCustomersData=e}static fromJson(e){return new rg().setPublicCustomersDataJson(e)}setPublicCustomersDataJson(e){return e.data??(e.data={}),this.publicCustomersData={},Object.entries(e.data).forEach(([t,r])=>{const s=zi.fromMinimalJson(r,t);this.publicCustomersData[t]=s}),this}toMinimalJson(){const e={};return e.data={},this.publicCustomersData??(this.publicCustomersData={}),Object.entries(this.publicCustomersData).forEach(([t,r])=>{e.data[t]=r.toMinimalJson()}),e}}class Ss extends Set{constructor(e,t){super(e),t&&this.sort(t)}sort(e){this.clear(),Array.from(this).sort(e).forEach(t=>this.add(t))}get last(){if(this.size===0)return;const e=Array.from(this);return e[e.length-1]}get isEmpty(){return this.size===0}elementAt(e){if(!(e<0||e>=this.size))return Array.from(this)[e]}intersection(e){const t=new Ss;return this.forEach(r=>{e.has(r)&&t.add(r)}),t}}const v8={0:"years",1:"months",2:"weeks",3:"days"},w8={years:0,months:1,weeks:2,days:3},x8={0:"YEARLY",1:"MONTHLY",2:"WEEKLY",3:"DAILY"};var FT=(n=>(n[n.endless=0]="endless",n[n.date=1]="date",n[n.repeats=2]="repeats",n))(FT||{});const mf=["SU","MO","TU","WE","TH","FR","SA"],pf={0:new ee({days:365}),1:new ee({days:30}),2:new ee({days:7}),3:new ee({days:1})};class $n{constructor({start:e,endOption:t=2,endDate:r,repeats:s=10,interval:i=1,weekDays:o=new Ss,customEndDate:a,freqRecurrence:c=3,exceptionDates:u=new Set}){h(this,"start");h(this,"endDate");h(this,"repeats",10);h(this,"interval",1);h(this,"freqRecurrence",3);h(this,"weekDays",new Ss);h(this,"endOption",2);h(this,"exceptionDates",new Set);h(this,"customEndDate");this.start=e,this.weekDays=o,this.endOption=t,this.endDate=r,this.repeats=s,this.interval=i,this.customEndDate=a,this.freqRecurrence=c,this.exceptionDates=u}static fromJson(e,t){const r=new $n({});return r.start=t,r.endDate=e.ED?new Date(e.ED):void 0,r.repeats=e.R||10,r.interval=e.I||1,r.weekDays=new Ss(e.WD||[]),r.exceptionDates=new Set(Object.keys(e.EDA||{}).map(zc)),r.freqRecurrence=w8[e.FR]||3,r}toJson({saveStartDate:e=!1,saveEnd:t=!0,saveException:r=!0}){const s={};return t&&this.endDate&&this.endOption===1&&(s.ED=sn(this.endDate)),t&&this.endOption===2&&(s.R=this.repeats),this.interval!==1&&(s.I=this.interval),this.weekDays.size>0&&this.freqRecurrence===2&&(s.WD=[...this.weekDays]),r&&this.exceptionDates.size>0&&(s.EDA={},this.exceptionDates.forEach(i=>{s.EDA[sn(i)]=""})),e&&this.start&&(s.SD=Ae(this.start)),s.FR=v8[this.freqRecurrence],s}static fromRecurrenceEvent(e){return new $n({start:e.start,endDate:e.endDate,repeats:e.repeats,interval:e.interval,freqRecurrence:e.freqRecurrence,weekDays:new Ss(e.weekDays),endOption:e.endOption,exceptionDates:new Set(e.exceptionDates)})}isEqual(e){var t,r;return!this.start||!e.start||this.start.getTime()!==e.start.getTime()||(((t=this.endDate)==null?void 0:t.getTime())||0)!==(((r=e.endDate)==null?void 0:r.getTime())||0)?!1:this.repeats===e.repeats&&this.interval===e.interval&&this.freqRecurrence===e.freqRecurrence&&h_(e.weekDays,this.weekDays)&&h_(e.exceptionDates,this.exceptionDates)&&this.endOption===e.endOption}get syncfuString(){var t,r,s,i;let e=`FREQ=${x8[this.freqRecurrence]};`;if(this.freqRecurrence===1&&this.start&&(e+=`BYMONTHDAY=${this.start.getDate()};`),this.freqRecurrence===0&&this.start&&(e+=`BYMONTHDAY=${this.start.getDate()};BYMONTH=${this.start.getMonth()+1};`),e+=`INTERVAL=${this.interval};`,this.freqRecurrence===2&&this.weekDays.size>0&&(e+="BYDAY=",this.weekDays.forEach(o=>{o<mf.length&&(e+=mf[o]+",")}),e=e.slice(0,-1)+";"),this.customEndDate&&(this.endOption===0||this.endOfTheEvent&&this.endOfTheEvent>new Date)){const o=new Date(this.customEndDate.getFullYear(),this.customEndDate.getMonth(),this.customEndDate.getDate(),((t=this.start)==null?void 0:t.getHours())??0,((r=this.start)==null?void 0:r.getMinutes())??0);e+=`UNTIL=${bt(o,"yyyyMMdd'T'HHmmss'Z'")}`}else switch(this.endOption){case 0:break;case 1:if(this.endDate){const o=new Date(this.endDate.getFullYear(),this.endDate.getMonth(),this.endDate.getDate(),((s=this.start)==null?void 0:s.getHours())??0,((i=this.start)==null?void 0:i.getMinutes())??0);e+=`UNTIL=${bt(o,"yyyyMMdd'T'HHmmss'Z'")}`}break;case 2:e+=`COUNT=${this.repeats}`;break}return e}get accurances(){if(this.start&&this.endOption!==0){if(this.endOption===2)return this.repeats-this.exceptionDates.size;if(this.endOption===1&&this.endDate){let e=0;if(this.exceptionDates.forEach(t=>{t<=this.endDate&&e++}),this.freqRecurrence===2){let t=0;const r=Ds(this.start);this.weekDays.forEach(u=>{this.isAccureInDate({date:qe(r,new ee({days:u})),considerException:!1})&&t++});const s=Math.abs(qe(r,new ee({days:6})).getTime()-Ds(this.endDate).getTime()),i=Math.floor(s/this.rangeBetweenInterval.inMilliseconds),o=Ds(this.endDate);let a=0;return cn(o).getTime()!==cn(r).getTime()&&this.weekDays.forEach(u=>{this.isAccureInDate({date:qe(o,new ee({days:u})),considerException:!1})&&a++}),i*this.weekDays.size+a+t-e}else if(this.freqRecurrence===1){const t=Lv(this.start,this.endDate);return Math.floor(t/this.interval)-e}else{const t=this.start.getTime()-this.endDate.getTime();return Math.floor(Math.abs(t)/this.rangeBetweenInterval.inDays)-e}}}}get rangeBetweenInterval(){return new ee({minutes:pf[this.freqRecurrence].inMinutes*this.interval})}get endOfTheEvent(){const e=this.rangeBetweenInterval;if(this.endOption===1&&this.endDate!==void 0)return this.endDate??void 0;if(this.endOption===2)if(this.freqRecurrence===2){let t=0;const r=this.start.getDay()===7?0:this.start.getDay();this.weekDays.forEach(u=>{u>=r&&t++});const s=this.repeats-t,i=Math.ceil(s/this.weekDays.size),o=s%this.weekDays.size,a=new Date(this.start.getTime()+new ee({minutes:e.inMinutes*i}).milliseconds),c=Ds(a);this.weekDays=new Ss(this.weekDays,(u,l)=>u-l);try{return new Date(c.getTime()+new ee({days:o-1<0?this.weekDays.last:this.weekDays.elementAt(o-1)}).inMilliseconds)}catch{return}}else return this.freqRecurrence===1?Bv(this.start,(this.repeats-1)*this.interval):new Date(this.start.getTime()+new ee({minutes:e.inMinutes*(this.repeats-1)}).inMilliseconds)}get explainText(){if(this.start===void 0)return"";let e="";const t=new ee({minutes:pf[this.freqRecurrence].inMinutes*this.interval});switch(this.freqRecurrence){case 0:e+=z("yearTamplate").replaceAll("DURATION",ha(t)).replaceAll("DATE",bt(this.start,"dd/MM"));break;case 1:e+=z("monthTemplate").replaceAll("DURATION",ha(t)).replaceAll("DATE",this.start.getDate().toString());break;case 2:let s="";this.weekDays.forEach(i=>{s+=z(mf[i])+", "}),s=s.substring(0,s.length-2),e+=z("weekTemplate").replaceAll("DURATION",ha(t)).replaceAll("DAYS",s).replaceAll("AMOUNT",z(Object.keys(this.weekDays).length===1?"onDay":"onDays"));break;case 3:e+=z("dayTemplate").replaceAll("DURATION",ha(t));break}const r=this.endOfTheEvent;return r!==void 0&&(e+=` ${z("until")} ${sn(r)}`),e}isAccureInDate({date:e,considerException:t=!0}){if(this.start===void 0||cn(this.start)>e)return!1;const r=this.endOfTheEvent;if(r!==void 0&&r<cn(e)||t&&this.exceptionDates.has(cn(e)))return!1;const s=new ee({minutes:pf[this.freqRecurrence].inMinutes*this.interval}),i=new ee({milliseconds:e.getTime()-cn(this.start).getTime()}),o=this.start.getDay()===7?0:this.start.getDay(),a=e.getDay()===7?0:e.getDay();if(this.freqRecurrence===2){const c=7-o,u=s.inDays-o,l=(i.inDays+s.inDays)%s.inDays;return(l<c||l>=u)&&this.weekDays.has(a)}if(this.freqRecurrence===1){const c=Lv(this.start,e);return this.start.getDate()===e.getDate()&&c%this.interval===0}return i.inDays%s.inDays===0}addRangeBetween(e){const t=new Date(e.getUTCDate());return this.freqRecurrence===1?Bv(t,this.interval):qe(t,new ee({minutes:this.rangeBetweenInterval.inMinutes}))}overlapingDatesWith(e){if(this.start===void 0||e.start===void 0)return new Set([new Date(0)]);if(this.endOfTheEvent===void 0&&e.endOfTheEvent===void 0)return new Set([new Date(0)]);const t=new Set,r=this._getOptimalEventToPassOver(this,e),s=r[0],i=r[1];let o=s.start;for(;cn(o)<=cn(s.endOfTheEvent);){if(s.freqRecurrence===2){const a=Ds(o);s.weekDays.forEach(c=>{const u=qe(a,new ee({days:c}));i.isAccureInDate({date:u})&&s.isAccureInDate({date:u})&&t.add(cn(u))})}else i.isAccureInDate({date:o})&&s.isAccureInDate({date:o})&&t.add(cn(o));o=this.addRangeBetween(o)}return t}get isRelevant(){return this.endOfTheEvent===void 0||this.endOfTheEvent>new Date}nearestFutureAccurenceDate(e,{needToBeAfterStart:t=!0}={}){if(this.endOfTheEvent!==void 0&&e>this.endOfTheEvent)return;if(this.start===void 0||e<this.start&&t&&this.isAccureInDate({date:this.start}))return this.start??void 0;const r=new ee({milliseconds:e.getTime()-this.start.getTime()}).inDays;if(this.freqRecurrence===2){const a=Math.floor(r/this.rangeBetweenInterval.inDays);let c=qe(this.start,new ee({days:a*this.rangeBetweenInterval.inDays})),u=Ds(c);for(const l of this.weekDays){const d=new Date(u.getTime()+new ee({days:l}).inMilliseconds);if(d>=e&&(this.endOfTheEvent===void 0||c<=this.endOfTheEvent))return d}c=qe(c,this.rangeBetweenInterval),u=Ds(c);for(const l of this.weekDays){const d=qe(u,new ee({days:l}));if(d>=e&&(this.endOfTheEvent===void 0||c<=this.endOfTheEvent))return d}return}const s=Math.ceil(r/this.rangeBetweenInterval.inDays);let i=qe(this.start,new ee({days:s*this.rangeBetweenInterval.inDays}));i<e&&(i=this.addRangeBetween(i));const o=this.endOfTheEvent;for(;!this.isAccureInDate({date:i})&&(o===void 0||i<o);)i=this.addRangeBetween(i);if(o===void 0||i<=o)return i}_getOptimalEventToPassOver(e,t){return e.endOfTheEvent===void 0&&t.endOfTheEvent!==void 0?[t,e]:e.endOfTheEvent!==void 0&&t.endOfTheEvent===void 0?[e,t]:(t.jumps??99999)<(e.jumps??99999)?[t,e]:[e,t]}get jumps(){if(this.start===void 0||this.endOfTheEvent===void 0)return;const t=new ee({milliseconds:this.start.getTime()-this.endOfTheEvent.getTime()}).inMinutes/this.rangeBetweenInterval.inMinutes;return Math.ceil(t*Math.max(this.weekDays.size,1))}toString(){return JSON.stringify(this,void 0,2)}}class El{constructor({end:e,start:t,title:r="",id:s="",workerId:i=""}){h(this,"start",new Date(0));h(this,"end",new Date(0));h(this,"id","");h(this,"createdAt");h(this,"workerId","");h(this,"addedToDeviceCalendar",!1);h(this,"colorIndex",1);h(this,"title","");h(this,"recurrenceObj");this.start=t,this.end=e,this.title=r,this.id=s,this.workerId=i,this.recurrenceObj=new $n({start:t,endDate:e,endOption:FT.date})}isOneDay(){return sn(this.end)===sn(this.start)}static fromEvent(e){var r;const t=new El({});return t.start=e.from,(r=e.recurrenceEvent)!=null&&r.endDate&&(t.end=e.recurrenceEvent.endDate),t.title=e.eventName,t.createdAt=e.vacationCreatedAt,t.id=e.vacationId,t.recurrenceObj=e.recurrenceEvent,t.addedToDeviceCalendar=e.vacationAddedToDeviceCalendar,t.colorIndex=e.colorIndex,t.workerId=e.ids.length>0?e.ids[0]:"",t}static fromVacation(e){const t=new El({});return t.start=e.start,t.end=e.end,t.addedToDeviceCalendar=e.addedToDeviceCalendar,t.id=e.id,t.createdAt=e.createdAt,t.workerId=e.workerId,t.title=e.title,t.colorIndex=e.colorIndex,t}}class E8{constructor(){h(this,"listener");h(this,"recurrenceEvents",{});h(this,"vacationsEvents",{})}get recurrenceEventsList(){const e=[];return Object.entries(this.recurrenceEvents).forEach(([t,r])=>{e.push(...Object.values(r))}),e}get recurrenceEventsListWithOutVacations(){const e=[];return Object.entries(this.recurrenceEvents).forEach(([t,r])=>{Object.entries(r).forEach(([s,i])=>{i.isVacation||e.push(i)})}),e}setRecurrenceEvents(e,t,r,{putBreaks:s=!0}={}){this.recurrenceEvents={},this.vacationsEvents={},Object.entries(e).forEach(([i,o])=>{this.recurrenceEvents[i]={};const a=zc(i);Object.entries(o).forEach(([c,u])=>{let l="",d="";if(typeof c=="string"){const m=c.split("_");m.length===2&&(l=m[1]),d=m[0]}const f=hc.fromJson({json:u,timeStr:d,businessModel:r,newTimeId:l,dayString:O0(a),monthString:_s(a),workerId:t});f.isVacation&&(this.vacationsEvents[sn(f.from)]=f),!(!s&&f.isBreak)&&(this.recurrenceEvents[i][c]=f)})})}vacationInDate(e){var t;for(const r of Object.values(this.vacationsEvents))if((t=r.recurrenceEvent)!=null&&t.isAccureInDate({date:e}))return El.fromEvent(r)}}const I8={R:"R",A:"A"},T8={R:"R",A:"A"};class Il{constructor({start:e,end:t,operation:r,shifts:s}){h(this,"start",new Date(0));h(this,"end",new Date(0));h(this,"operation","R");h(this,"shifts",[]);this.start=e,this.end=t,this.operation=r,this.shifts=s}static fromJson(e,t){const r=t.split("&"),s=new Date(r[0]),i=new Date(r[1]),o=T8[e.operation]||"R",a=e.shifts.map(c=>c);return new Il({start:s,end:i,operation:o,shifts:a})}static fromShiftChangeRange(e){const{start:t,end:r,operation:s,shifts:i}=e;return new Il({start:t,end:r,operation:s,shifts:[...i]})}isSameAs(e){return this.start.getTime()===e.start.getTime()&&this.end.getTime()===e.end.getTime()&&this.operation===e.operation&&this.shifts.toString()===e.shifts.toString()}toJson(){return{operation:I8[this.operation],shifts:this.shifts}}combineShifts(e){if(this.operation==="R")return this.shifts;const t=[];return Pv(t,e),Pv(t,this.shifts),OT(t)}getKey(){const e=sn(this.start),t=sn(this.end);return`${e}&${t}`}toString(){return JSON.stringify(this.toJson())}}class Tl{constructor({name:e,treatments:t,index:r}){h(this,"name","");h(this,"index","");h(this,"treatments",new Map);this.name=e,this.treatments=t,this.index=r}static fromJson(e,t,{pointerShortBookingTime:r,pointerLognestBookingTime:s}={}){const i=e.name||"",o=t,a=new Map;return e.treatments&&Object.entries(e.treatments).forEach(([c,u])=>{a.set(c,vn.fromJson(u,c)),r&&(a.get(c).totalMinutes<r[0]&&(r[0]=Math.max(a.get(c).times.get("0").workMinutes,5)),a.get(c).totalMinutes===r[0]&&(r[0]=Math.min(Math.max(a.get(c).times.get("0").workMinutes,5),r[0]))),s&&a.get(c).totalMinutes>s[0]&&(s[0]=Math.max(a.get(c).totalMinutes,5))}),new Tl({name:i,treatments:a,index:o})}containTreatment(e){for(const[t,r]of this.treatments)if(r.id===e)return!0;return!1}toJson(){const e={};return e.name=this.name,e.treatments={},Object.entries(this.treatments).forEach(([t,r])=>{e.treatments[t]=r.toJson()}),e}fromTreatmentSubject(e){return this.name=e.name,this.index=e.index,this.treatments=new Map,e.treatments.forEach((t,r)=>{this.treatments.set(r,vn.fromTreatment(t))}),this}toString(){return JSON.stringify(this.toJson(),null,2)}}const D8=new Set([new Date(2023,10,29)]);class A8{constructor(){h(this,"bookingsTimes",{});h(this,"lastBookingTimeDate");h(this,"duringPaymentBookingsTime",{});h(this,"listener")}findLastBookingsTimesDate(){let e;return Object.entries(this.bookingsTimes).forEach(([t,r])=>{const s=new Date(t);Object.keys(r).length>0&&(!e||s>e)&&(e=s)}),e}setWorkerPublicData(e,t=!0){this.duringPaymentBookingsTime={},this.bookingsTimes={},D8.forEach(r=>{r=new Date(r.getTime()+60*60*1e3),this.bookingsTimes[sn(r)]={[Cn(r)]:60}}),e.bookingsTimes!=null&&Object.entries(e.bookingsTimes).forEach(([r,s])=>{const i=new Date(r),o=new Date;o.setDate(o.getDate()-7),i>=o&&Object.keys(s).length!=0&&(this.bookingsTimes[r]={},Object.entries(s).forEach(([a,c])=>{a.includes("00:00v")?t&&(this.bookingsTimes[r]={"00:00":1439}):(a!=="00:00"||this.bookingsTimes[r]["00:00"]!=1439)&&(this.bookingsTimes[r][a]=c)}),Object.keys(s).length>0&&i>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=i))}),e.duringPaymentBookingsTime!==null&&Object.entries(e.duringPaymentBookingsTime).forEach(([r,s])=>{const i=new Date(r),o=new Date;o.setDate(o.getDate()-7),i>=o&&Object.entries(s).forEach(([a,c])=>{c.length===2&&c[0]instanceof Fe&&c[0].toDate().getTime()>Date.now()&&typeof c[1]=="number"&&(r in this.bookingsTimes?this.bookingsTimes[r][a]=c[1]:this.bookingsTimes[r]={[a]:c[1]},i>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=i),r in this.duringPaymentBookingsTime?this.duringPaymentBookingsTime[r][a]=c:this.duringPaymentBookingsTime[r]={[a]:c})})})}emptyBookingTimesDatesInMonth(e){Object.entries(this.bookingsTimes).forEach(([t,r])=>{t.includes(e)&&(this.bookingsTimes[t]={})})}toWorkerPublicDataJson(){const e={};return e.bookingsTimes={},Object.entries(this.bookingsTimes).forEach(([t,r])=>{e.bookingsTimes[t]={},Object.entries(r).forEach(([s,i])=>{e.bookingsTimes[t][s]=i})}),e.duringPaymentBookingsTime={},Object.entries(this.duringPaymentBookingsTime).forEach(([t,r])=>{e.duringPaymentBookingsTime[t]={},Object.entries(r).forEach(([s,i])=>{e.duringPaymentBookingsTime[t][s]=i})}),e}}class uc{constructor({}){h(this,"daysToAllowBookings",7);h(this,"name","");h(this,"phone","");h(this,"id","");h(this,"profileImg","");h(this,"about","");h(this,"maxTreatments",5);h(this,"allowAppNotification",!0);h(this,"religions",[]);h(this,"waitingListExceptionDays",new Set);h(this,"closeScheduleOnHolidays",!1);h(this,"weekendDays",[5,6]);h(this,"onHoldMinutes",0);h(this,"cancelMinutes",0);h(this,"minutesBeforeBookingToConfirm",1440);h(this,"tempFcm");h(this,"hasRecurrenceEvents",!1);h(this,"windowSpaces",Du.shortestTreatment);h(this,"customWindowMinute",30);h(this,"showWaitingListWhenThereIsChoises",!0);h(this,"isVerifiedPhone",!1);h(this,"lastCleanDate",new Date);h(this,"gender",ve.anonymous);h(this,"deleteNeerDedlineBookingMessage");h(this,"orderNeerDedlineBookingMessage");h(this,"generalBookingMessage");h(this,"closeCalendarDate");h(this,"minDateForShowinData",new Date(0));h(this,"openCalendar",!0);h(this,"maxFutureBookings",4);h(this,"currentClientCount",0);h(this,"showVacations",!0);h(this,"mustVerifyPhone",!0);h(this,"allowBookingConfirmations",!0);h(this,"devices",new Map);h(this,"storyImages",new Map);h(this,"createdAt",new Date(0));h(this,"workTime",new Map([["sunday",[]],["monday",[]],["tuesday",[]],["wednesday",[]],["thursday",[]],["friday",[]],["saturday",[]]]));h(this,"isCustomersNeedRecurrence",!1);h(this,"specificRangeChanges",new Map);h(this,"treatmentsSubjects",new Map);h(this,"workerPublicData",new A8);h(this,"publicCustomers",new rg);h(this,"storylikesAmount",{});h(this,"multiEventsTimes",new ng);h(this,"generalBookingsCount",0);h(this,"passedBookingsCount",0);h(this,"shortBookingTime",999);h(this,"longestBookingTime",0);h(this,"recurrence",new E8);h(this,"notifications",new Yi);h(this,"workerDocListner")}static fromUserPublicData(e){const t=new uc({});return t.phone=e.phoneNumber||"",t.currentClientCount=e.currentClientCount||0,t.id=e.id||t.phone,t.name=e.name||"",e.devices!=null&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([r,s])=>{t.devices.set(r,Qn.fromJson(s,r))}):e.currentFcm!=null&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),t.gender=br[e.gender]||ve.anonymous,t.lastCleanDate=new Date,t.createdAt=new Date,t.notifications.remindersTypes=new Map([[Yt.regular,60]]),t}static fromWorkerDocJson(e){const t=new uc({});return t.setFromWorkerDoc(e),t}get treatmentsLength(){let e=0;return Object.values(this.treatmentsSubjects).forEach(t=>{e+=Object.values(t.treatments).length}),e}shiftsFor({day:e}){const t=this.workTime.get(bt(e,"EEEE").toLowerCase())||[];console.log("this.workTime",this.workTime),console.log("format(day, EEEE).toLowerCase()",bt(e,"EEEE").toLowerCase()),console.log("defaultShifts",t);for(const r of Object.values(this.specificRangeChanges))if(ex(r.start,new Date(r.end.getTime()+23*60*60*1e3+59*60*1e3),e,e)==="STRIKE")return r.combineShifts(t);return OT(y8(t))}get fcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm!=null)return new Set([this.tempFcm]);const e=new Set;for(const t of Object.values(this.devices))t.activeNotifications&&e.add(t.token);return e}isClosingDate(e){return!this.openCalendar||this.closeCalendarDate!=null&&cn(this.closeCalendarDate).getTime()===cn(e).getTime()}hasTreatemnt(e){for(const[t,r]of this.treatmentsSubjects)if(r.containTreatment(e))return!0;return!1}get useWhatsApp(){return this.notifications.notificationOption===We.WhatsApp||this.notifications.notificationOption===We.PushOrWhatsApp}setFromWorkerDoc(e){if(this.daysToAllowBookings=e.daysToAllowBookings||7,this.profileImg=e.profileImg||"",this.about=e.about||"",e.lastCleanDate instanceof Fe?this.lastCleanDate=e.lastCleanDate.toDate():typeof e.lastCleanDate=="string"&&(this.lastCleanDate=new Date(e.lastCleanDate)||new Date),e.religions&&(this.religions=e.religions.map(t=>KC[t])),e.windowSpaces&&(this.windowSpaces=g8[e.windowSpaces]||Du.shortestTreatment),this.isCustomersNeedRecurrence=e.isCustomersNeedRecurrence||!1,this.showWaitingListWhenThereIsChoises=e.showWaitingListWhenThereIsChoises||!0,this.customWindowMinute=e.customWindowMinute||30,this.closeScheduleOnHolidays=e.closeScheduleOnHolidays||!1,this.weekendDays=e.weekendDays||[5,6],this.mustVerifyPhone=e.mustVerifyPhone||!0,this.showVacations=e.showVacations||!0,this.gender=br[e.gender]||ve.anonymous,this.allowAppNotification=e.allowAppNotification||!0,this.name=e.name||"",this.maxTreatments=e.maxTreatments||3,this.phone=e.phone||"",this.hasRecurrenceEvents=e.hasRecurrenceEvents||!1,this.id=e.id||e.phone||"",this.minutesBeforeBookingToConfirm=e.minutesBeforeBookingToConfirm||1440,this.maxFutureBookings=e.maxFutureBookings||4,this.treatmentsSubjects=new Map,this.shortBookingTime=999,e.treatmentsSubjects){let t=[this.shortBookingTime],r=[this.longestBookingTime];Object.entries(e.treatmentsSubjects).forEach(([s,i])=>{const o=Tl.fromJson(i,s,{pointerShortBookingTime:t,pointerLognestBookingTime:r});this.treatmentsSubjects.set(s,o)}),this.shortBookingTime=t[0],this.longestBookingTime=r[0]}else if(e.treatments){const t=new Map;let r=0;Object.entries(e.treatments).forEach(([s,i])=>{const o=vn.fromOldJson(i,r.toString(),s,r+4);t.set(r.toString(),o),o.totalMinutes<this.shortBookingTime&&(this.shortBookingTime=Math.max(o.times.get("0").workMinutes,5)),o.totalMinutes===this.shortBookingTime&&(this.shortBookingTime=Math.min(Math.max(o.times.get("0").workMinutes,5),this.shortBookingTime)),r+=1}),this.treatmentsSubjects=new Map([["0",new Tl({name:z("general"),treatments:t,index:"0"})]])}this.onHoldMinutes=e.onHoldMinutes||0,this.cancelMinutes=e.cancelMinutes||0,e.devices!=null&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,r])=>{this.devices.set(t,Qn.fromJson(r,t))}),this.deleteNeerDedlineBookingMessage=e.deleteNeerDedlineBookingMessage,this.orderNeerDedlineBookingMessage=e.orderNeerDedlineBookingMessage,this.generalBookingMessage=e.generalBookingMessage,this.workTime=new Map,e.workTime&&Object.entries(e.workTime).forEach(([t,r])=>{this.workTime.set(t,r.map(s=>s))}),this.waitingListExceptionDays=new Set,e.waitingListExceptionDays&&e.waitingListExceptionDays.forEach(t=>{this.waitingListExceptionDays.add(t)}),e.notifications?this.notifications=Yi.fromJson(e.notifications):(this.notifications=new Yi,this.notifications.notifyOnWaitingListEvents=e.notifyOnWaitingListEvents||!0,this.notifications.showAdressAlert=e.showAdressAlert||!1,this.notifications.showAdressMessage=e.showAdressMessage||!1,this.notifications.showPhoneAlert=e.showPhoneAlert||!1,this.notifications.showPhoneMessage=e.showPhoneMessage||!1,this.notifications.remindersTypes=new Map([[Yt.regular,e.minutesBeforeNotify||60]]),this.notifications.notifyOnPayments=e.notifyOnPayments||!0,this.notifications.notifyAboutCancelNearDeadline=e.notifyAboutCancelNearDeadline||!0,this.notifications.notifyAboutOrderNearDeadline=e.notifyAboutOrderNearDeadline||!0,this.notifications.notifyWhenGettingBooking=e.notifyWhenGettingBooking||!0,e.notificationOption&&(this.notifications.notificationOption=Ll[e.notificationOption]||We.OnlyPush),e.recurrenceNotificationsLastDate?this.notifications.recurrenceNotificationsLastDate=new Date(e.recurrenceNotificationsLastDate):this.notifications.recurrenceNotificationsLastDate=new Date),this.specificRangeChanges=new Map,e.specificRangeChanges&&Object.entries(e.specificRangeChanges).forEach(([t,r])=>{const s=Il.fromJson(r,t);s.end>=cn(new Date)&&this.specificRangeChanges.set(t,s)}),this.storyImages=new Map,e.storyImages&&Object.entries(e.storyImages).forEach(([t,r])=>{this.storyImages.set(t,r)}),e.closeCalendarDate&&(this.closeCalendarDate=new Date(e.closeCalendarDate)),e.minDateForShowinData&&(this.minDateForShowinData=zc(e.minDateForShowinData)),this.openCalendar=e.openCalendar||!0,this.allowBookingConfirmations=e.allowBookingConfirmations||!0,e.createdAt?this.createdAt=new Date(e.createdAt):this.createdAt=new Date(2023,0,1),this.id===this.phone?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1}getInvoiceWorkerInfo(){return new InvoiceWorkerInfo({workerId:this.id,workerName:this.name})}getFcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm!=null)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}toWorkerDocJson(){const e={};return e.workTime={},Object.entries(this.workTime).forEach(([t,r])=>{e.workTime[t]=r}),e.specificRangeChanges={},Object.entries(this.specificRangeChanges).forEach(([t,r])=>{e.specificRangeChanges[t]=r.toJson()}),e.religions=[],this.religions.forEach(t=>{e.religions.push(QC[t])}),this.closeCalendarDate!=null&&(e.closeCalendarDate=new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}).format(this.closeCalendarDate)),this.minDateForShowinData.getFullYear()!=new Date(0).getFullYear()&&(e.minDateForShowinData=sn(this.minDateForShowinData)),this.openCalendar||(e.openCalendar=this.openCalendar),e.allowBookingConfirmations=this.allowBookingConfirmations,this.mustVerifyPhone||(e.mustVerifyPhone=this.mustVerifyPhone),this.isCustomersNeedRecurrence&&(e.isCustomersNeedRecurrence=this.isCustomersNeedRecurrence),e.weekendDays=this.weekendDays,e.maxTreatments=this.maxTreatments,e.gender=Xi[this.gender],e.onHoldMinutes=this.onHoldMinutes,e.cancelMinutes=this.cancelMinutes,this.hasRecurrenceEvents&&(e.hasRecurrenceEvents=this.hasRecurrenceEvents),this.showVacations||(e.showVacations=this.showVacations),e.devices={},Object.entries(this.devices).forEach(([t,r])=>{e.devices[t]=r.toJson()}),e.deleteNeerDedlineBookingMessage=this.deleteNeerDedlineBookingMessage,e.orderNeerDedlineBookingMessage=this.orderNeerDedlineBookingMessage,e.generalBookingMessage=this.generalBookingMessage,e.closeScheduleOnHolidays=this.closeScheduleOnHolidays,this.customWindowMinute!=30&&(e.customWindowMinute=this.customWindowMinute),this.windowSpaces!=Du.shortestTreatment&&(e.windowSpaces=p8[this.windowSpaces]),this.minutesBeforeBookingToConfirm!=1440&&(e.minutesBeforeBookingToConfirm=this.minutesBeforeBookingToConfirm),e.bookingDaysToDeleteLocal=[],e.notifications=this.notifications.toJson(),e.lastCleanDate=this.lastCleanDate.toString(),e.daysToAllowBookings=this.daysToAllowBookings,this.maxFutureBookings!=4&&(e.maxFutureBookings=this.maxFutureBookings),this.currentClientCount!=0&&(e.currentClientCount=this.currentClientCount),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),this.waitingListExceptionDays.entries.length>0&&(e.waitingListExceptionDays=Array.from(this.waitingListExceptionDays)),e.treatmentsSubjects={},Object.entries(this.treatmentsSubjects).forEach(([t,r])=>{e.treatmentsSubjects[t]=r.toJson()}),this.showWaitingListWhenThereIsChoises||(e.showWaitingListWhenThereIsChoises=this.showWaitingListWhenThereIsChoises),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.profileImg=this.profileImg,e.about=this.about,e.name=name,e.phone=this.phone,e.id=this.id,e.storyImages={},Object.entries(this.storyImages).forEach(([t,r])=>{e.storyImages[t]=r}),e.createdAt=this.createdAt.toString(),e}toString(){return JSON.stringify(this.toWorkerDocJson())+this.workerPublicData.toWorkerPublicDataJson().toString()}}function BT({booking:n,worker:e,notificationOption:t,customHsEnoughMessages:r}){if(t=t||(e==null?void 0:e.notifications.notificationOption),!t)return K.none;const s=r||je.GI().business.businessData.messagesCounter>1;switch(t){case We.OnlyPush:return Object.values(n.userFcms).length===0?K.none:K.push;case We.SMSOnly:return!n.canSendMessage||!s?K.none:K.message;case We.WhatAppOnly:return!n.canSendMessage||!s?K.none:K.whatsapp;case We.PushOrSMS:return Object.values(n.userFcms).length>0?K.push:!n.canSendMessage||!s?K.none:K.message;case We.PushOrWhatsApp:return Object.values(n.userFcms).length>0?K.push:!n.canSendMessage||!s?K.none:K.whatsapp;case We.SMSOrPush:return n.canSendMessage&&s?K.message:Object.values(n.userFcms).length>0?K.push:K.none;case We.WhatsAppOrPush:return n.canSendMessage&&s?K.whatsapp:Object.values(n.userFcms).length>0?K.push:K.none;default:return K.none}}function C8(n,e){const t=je.GI().business.businessData.messagesCounter>1;switch(e.notifications.notificationOption){case We.OnlyPush:return Object.keys(n.userFcms).length===0?K.none:K.push;case We.SMSOnly:return!n.canSendMessage||!t?K.none:K.message;case We.WhatAppOnly:return!n.canSendMessage||!t?K.none:K.whatsapp;case We.PushOrSMS:return Object.values(n.userFcms).length>0?K.push:!n.canSendMessage||!t?K.none:K.message;case We.PushOrWhatsApp:return Object.values(n.userFcms).length>0?K.push:!n.canSendMessage||!t?K.none:K.whatsapp;case We.SMSOrPush:return n.canSendMessage&&t?K.message:Object.values(n.userFcms).length>0?K.push:K.none;case We.WhatsAppOrPush:return n.canSendMessage&&t?K.whatsapp:Object.values(n.userFcms).length>0?K.push:K.none;default:return K.none}}var N0={exports:{}},Rv=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Rv){var Nv=new Uint8Array(16);N0.exports=function(){return Rv(Nv),Nv}}else{var Mv=new Array(16);N0.exports=function(){for(var e=0,t;e<16;e++)e&3||(t=Math.random()*4294967296),Mv[e]=t>>>((e&3)<<3)&255;return Mv}}var LT=N0.exports,VT=[];for(var mu=0;mu<256;++mu)VT[mu]=(mu+256).toString(16).substr(1);function b8(n,e){var t=e||0,r=VT;return[r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]]].join("")}var UT=b8,k8=LT,S8=UT,Ov,gf,yf=0,_f=0;function P8(n,e,t){var r=e&&t||0,s=e||[];n=n||{};var i=n.node||Ov,o=n.clockseq!==void 0?n.clockseq:gf;if(i==null||o==null){var a=k8();i==null&&(i=Ov=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=gf=(a[6]<<8|a[7])&16383)}var c=n.msecs!==void 0?n.msecs:new Date().getTime(),u=n.nsecs!==void 0?n.nsecs:_f+1,l=c-yf+(u-_f)/1e4;if(l<0&&n.clockseq===void 0&&(o=o+1&16383),(l<0||c>yf)&&n.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");yf=c,_f=u,gf=o,c+=122192928e5;var d=((c&268435455)*1e4+u)%4294967296;s[r++]=d>>>24&255,s[r++]=d>>>16&255,s[r++]=d>>>8&255,s[r++]=d&255;var f=c/4294967296*1e4&268435455;s[r++]=f>>>8&255,s[r++]=f&255,s[r++]=f>>>24&15|16,s[r++]=f>>>16&255,s[r++]=o>>>8|128,s[r++]=o&255;for(var m=0;m<6;++m)s[r+m]=i[m];return e||S8(s)}var R8=P8,N8=LT,M8=UT;function O8(n,e,t){var r=e&&t||0;typeof n=="string"&&(e=n==="binary"?new Array(16):null,n=null),n=n||{};var s=n.random||(n.rng||N8)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e)for(var i=0;i<16;++i)e[r+i]=s[i];return e||M8(s)}var F8=O8,B8=R8,WT=F8,sg=WT;sg.v1=B8;sg.v4=WT;var L8=sg;const HT=iw(L8);class ys{constructor({monthStr:e,invoiceId:t,docId:r,amount:s,issuedBy:i}){h(this,"invoiceId","");h(this,"docId","");h(this,"monthStr","");h(this,"issuedBy","");h(this,"amount",0);this.monthStr=e,this.invoiceId=t,this.docId=r,this.amount=s,this.issuedBy=i}toJson(){const e={};return e.monthStr=this.monthStr,e.docId=this.docId,e.issuedBy=this.issuedBy,e.amount=this.amount,e}static fromJson(e,t,r){const s=new ys({});return s.invoiceId=t,s.docId=e.docId??"",s.monthStr=e.monthStr??"",s.issuedBy=e.issuedBy??r,e.amount!=null&&(s.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),s}static fromBookingInvoiceData(e){const t=new ys({});return t.invoiceId=e.invoiceId,t.docId=e.docId,t.monthStr=e.monthStr,t.issuedBy=e.issuedBy,t.amount=e.amount,t}toString(){return JSON.stringify(this.toJson(),null,2)}}class fi{constructor({userId:e="",name:t="",gender:r=ve.male,isVerifiedPhone:s=!1,phone:i="",isExist:o=!0,userDecline:a=!1}){h(this,"userId","");h(this,"name","");h(this,"gender",ve.male);h(this,"phone","");h(this,"payments",{});h(this,"isExist",!1);h(this,"fcmTokens");h(this,"isVerifiedPhone",!1);h(this,"userDecline",!1);this.userId=e,this.name=t,this.gender=r,this.isVerifiedPhone=s,this.phone=i,this.isExist=o,this.userDecline=a}get customerHashPhone(){return ri(this.phone)}get customerPhoneAsCollection(){return this.phone.replaceAll("-","")}get isPaid(){return Object.keys(this.payments).length>0}static fromJson(e,t){const r=new fi({userId:t,name:e.N??"",gender:e.G?br[e.G]:ve.male,isVerifiedPhone:e.IVP??!1,phone:e.P??"",isExist:e.IE??!0,userDecline:e.UD??!1});return e.PY!=null&&typeof e.PY=="object"&&Object.entries(e.PY).forEach(([s,i])=>{r.payments[s]=i?new Date(i):new Date(0)}),r}toJson(){const e={};return e.N=this.name,this.isVerifiedPhone&&(e.IVP=this.isVerifiedPhone),this.isExist||(e.IE=this.isExist),e.P=this.phone,this.gender!==ve.male&&(e.G=ve[this.gender]),Object.keys(this.payments).length>0&&(e.PY={},Object.entries(this.payments).forEach(([t,r])=>{e.PY[t]=r.toString()})),this.userDecline&&(e.UD=this.userDecline),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class _o{constructor({createdAt:e,amount:t,id:r,showUser:s,description:i=""}){h(this,"createdAt",new Date(0));h(this,"id","");h(this,"amount",0);h(this,"description","");h(this,"showUser",!1);this.createdAt=e,this.amount=t,this.id=r,this.showUser=s,this.description=i}static fromJson(e,t){return new _o({createdAt:e.createdAt?new Date(e.createdAt):new Date(0),amount:e.amount!=null?typeof e.amount=="number"?e.amount:parseFloat(e.amount):0,id:t,showUser:e.showUser??!1,description:e.description??""})}static fromDebt(e){return new _o({createdAt:e.createdAt,amount:e.amount,id:e.id,showUser:e.showUser,description:e.description})}isEqual(e){return e.id===this.id&&e.description===this.description&&e.showUser===this.showUser&&e.createdAt.toString()===this.createdAt.toString()&&this.amount===e.amount}toJson(){const e={};return e.createdAt=Ae(this.createdAt),e.amount=this.amount,this.showUser&&(e.showUser=this.showUser),this.description!==""&&(e.description=this.description),e}}const{v4:V8}=HT;class ig{constructor(){h(this,"customerName","");h(this,"customerPhone","");h(this,"isVerifiedPhone",!1);h(this,"notificationType",K.none);h(this,"workerNotificationOption",We.PushOrSMS);h(this,"workerRemindersTypes",new Map);h(this,"customerId","");h(this,"orderingOptions",pn.app);h(this,"remindersTypes",new Map);h(this,"isUserExist",!0);h(this,"signOnDeviceCalendar",!1);h(this,"lastTimeNotifyOnDebt",null);h(this,"clientMail","");h(this,"finishInvoices",!1);h(this,"showAdressAlert",!1);h(this,"userBookingId","");h(this,"showPhoneAlert",!1);h(this,"cancelDate",null);h(this,"wasWaiting",!1);h(this,"createdAt",new Date(0));h(this,"needCancel",!1);h(this,"userGender",ve.anonymous);h(this,"status",Ft.approved);h(this,"confirmedArrival",!1);h(this,"userFcms",new Set);h(this,"clientNote","");h(this,"invoices",new Map);h(this,"transactions",new Map);h(this,"debts",new Map);h(this,"addToClientAt",!1);h(this,"userDeleted",!1)}copyDataToOrder({worker:e,needToHoldOn:t,workerAction:r,bookingDate:s,addToCalendar:i,business:o,user:a,noteText:c=""}){this.clientNote=c,t?this.status=Ft.waiting:this.status=Ft.approved,this.showAdressAlert=e.notifications.showAdressAlert,this.showPhoneAlert=e.notifications.showPhoneAlert,!r&&!t&&s.getTime()-Date.now()<60*60*1e3&&(this.confirmedArrival=!0),this.signOnDeviceCalendar=i,this.workerNotificationOption=e.notifications.notificationOption,this.workerRemindersTypes=new Map(e.notifications.remindersTypes),e.notifications.remindersTypes.forEach((l,d)=>{s.getTime()<Date.now()||d===Yt.confirmArrival&&this.confirmedArrival||(s.getTime()-l*60*1e3<Date.now()+1e3?(this.remindersTypes.set(d,Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))-Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))%5),this.remindersTypes.get(d)<10&&this.remindersTypes.delete(d)):this.remindersTypes.set(d,l))}),this.orderingOptions=pn.web,this.isUserExist=!0,this.userFcms=new Set(a.userPublicData.fcmsTokens),this.isVerifiedPhone=a.isVerifiedPhone;const u=a.userPublicData.clientAt;this.addToClientAt=!u.has(o.businessId)||!u.get(o.businessId).has(e.id),this.createdAt.getTime()===new Date(0).getTime()&&(this.createdAt=new Date),this.userBookingId===""&&(this.userBookingId=V8()),this.notificationType=C8(this,e)}get isDepositTransaction(){let e=!1;return this.transactions.forEach((t,r)=>{e=t.type===hr.deposit}),e}get transactionsTotalPaymentAmount(){let e=0;return this.transactions.forEach((t,r)=>{t.type===hr.payment&&(e+=t.amount)}),e}get canSendMessage(){return this.isVerifiedPhone||this.orderingOptions===pn.byWorker}get totalDebtAmount(){let e=0;return this.debts.forEach((t,r)=>{e+=t.amount}),e}get invoicePriceAmount(){return Array.from(this.invoices.values()).reduce((e,t)=>e+t.amount,0)}invoicesCoverPrice(e){const{totalAmount:t}=e;return this.finishInvoices||this.invoices.size>0&&Array.from(this.invoices.values()).reduce((r,s)=>r+s.amount,0)>=t}get transactionsTotalDepositAmount(){let e=0;return this.transactions.forEach((t,r)=>{t.type===hr.deposit&&(e+=t.amount)}),e}get customerHashPhone(){return ri(this.customerPhone)}get customerPhoneAsCollection(){return this.customerPhone.replace(/-/g,"")}reminderId(e){return this.userBookingId+"__"+Ri[e]}get toPaymentRequestUser(){return new fi({name:this.customerName,userId:this.customerId,gender:this.userGender,isExist:this.isUserExist,isVerifiedPhone:this.isVerifiedPhone,phone:this.customerPhone})}get typesOfEvents(){const e=new Map;return this.needCancel&&e.set(Vs.needCancel,1),this.debts.size>0&&e.set(Vs.withDebts,1),this.status===Ft.waiting&&e.set(Vs.onHold,1),e}static fromJson(e,t,r){const s=new ig;return s.customerName=e.customerName||"",s.customerId=e.customerId||"",s.customerPhone=e.customerPhone||s.customerId,s.needCancel=e.needCancel||!1,s.remindersTypes=e.remindersTypes?new Map(Object.entries(e.remindersTypes).map(([i,o])=>[Ns[i],o])):new Map([[Yt.regular,e.minutesBeforeNotify||60]]),s.workerRemindersTypes=e.workerRemindersTypes?new Map(Object.entries(e.workerRemindersTypes).map(([i,o])=>[Ns[i],o])):new Map,s.signOnDeviceCalendar=e.signOnDeviceCalendar||!1,s.userDeleted=e.userDeleted||!1,s.isVerifiedPhone=e.isVerifiedPhone||!1,s.clientMail=e.clientMail||"",s.clientNote=e.clientNote||"",s.userBookingId=t,s.orderingOptions=Uw[e.orderingOptions]||pn.app,s.debts=e.debts?new Map(Object.entries(e.debts).map(([i,o])=>[i,_o.fromJson(o,i)])):new Map,s.finishInvoices=e.finishInvoices||!1,s.cancelDate=e.cancelDate?new Date(e.cancelDate):null,s.wasWaiting=e.wasWaiting||!1,s.isUserExist=e.isUserExist||!0,s.lastTimeNotifyOnDebt=e.lastTimeNotifyOnDebt?new Date(e.lastTimeNotifyOnDebt):null,s.invoices=e.invoices?new Map(Object.entries(e.invoices).map(([i,o])=>[i,ys.fromJson(o,i,r)])):new Map,s.userGender=br[e.userGender]||ve.anonymous,s.status=Lw[e.status.toString()]||Ft.approved,s.confirmedArrival=e.confirmedArrival||!1,s.showAdressAlert=e.showAdressAlert||!1,s.showPhoneAlert=e.showPhoneAlert||!1,s.notificationType=Ww[e.notificationType]||K.none,s.workerNotificationOption=Ll[e.workerNotificationOption]||We.PushOrSMS,s.userFcms=e.userFcms?new Set(e.userFcms):e.deviceFCM&&e.deviceFCM!==""?new Set([e.deviceFCM]):new Set,s.createdAt=e.createdAt?new Date(e.createdAt):new Date(0),s.transactions=e.transactions?new Map(Object.entries(e.transactions).map(([i,o])=>[i,qs.fromJson(o,i)])):new Map,s}toJson(){const e={};return e.customerName=this.customerName,e.customerId=this.customerId,this.wasWaiting&&(e.wasWaiting=this.wasWaiting),this.cancelDate&&(e.cancelDate=Ae(this.cancelDate)),e.remindersTypes={},this.remindersTypes.forEach((t,r)=>{e.remindersTypes[Ri[r]]=t}),e.workerRemindersTypes={},this.workerRemindersTypes.forEach((t,r)=>{e.workerRemindersTypes[Ri[r]]=t}),this.userDeleted&&(e.userDeleted=this.userDeleted),this.signOnDeviceCalendar&&(e.signOnDeviceCalendar=this.signOnDeviceCalendar),this.clientNote!==""&&(e.clientNote=this.clientNote),this.needCancel&&(e.needCancel=this.needCancel),this.finishInvoices&&(e.finishInvoices=this.finishInvoices),e.userGender=Xi[this.userGender],this.invoices.size>0&&(e.invoices={},this.invoices.forEach((t,r)=>{e.invoices[r]=t.toJson()})),this.debts.size>0&&(e.debts={},this.debts.forEach((t,r)=>{e.debts[r]=t.toJson()})),this.lastTimeNotifyOnDebt&&(e.lastTimeNotifyOnDebt=Ae(this.lastTimeNotifyOnDebt)),this.isUserExist||(e.isUserExist=this.isUserExist),this.orderingOptions!==pn.app&&(e.orderingOptions=Vw[this.orderingOptions]),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.clientMail!==""&&(e.clientMail=this.clientMail),e.customerPhone=this.customerPhone,this.status!==Ft.approved&&(e.status=Bw[this.status]),this.confirmedArrival&&(e.confirmedArrival=this.confirmedArrival),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.userFcms.size>0&&(e.userFcms=Array.from(this.userFcms)),e.createdAt=Ae(this.createdAt),this.transactions.size>0&&(e.transactions={},this.transactions.forEach((t,r)=>{e.transactions[r]=t.toJson()})),e}toString(){return JSON.stringify(this,null,"  ")}}class as{constructor({name:e="",amoutOfBookings:t=0,gender:r=ve.male,email:s="",id:i="",freeFromPayments:o=!1,addedManually:a=!1,customerUuid:c="",isVerifiedPhone:u=!1,workerNaming:l="",blocked:d=!1,phoneNumber:f="",firstBookingsDate:m,userFirstBookingsDate:p,lastBookingsDate:y}){h(this,"name","");h(this,"workerNaming","");h(this,"phoneNumber","");h(this,"freeFromPayments",!1);h(this,"isExapmle",!1);h(this,"id","");h(this,"customerUuid","");h(this,"blocked",!1);h(this,"isVerifiedPhone",!1);h(this,"email","");h(this,"addedManually",!1);h(this,"gender",ve.male);h(this,"amoutOfBookings",0);h(this,"firstBookingsDate");h(this,"userFirstBookingsDate");h(this,"lastBookingsDate");h(this,"belongings",new Set);h(this,"isDeleted",!1);this.name=e,this.amoutOfBookings=t,this.gender=r,this.email=s,this.id=i,this.freeFromPayments=o,this.addedManually=a,this.customerUuid=c,this.isVerifiedPhone=u,this.workerNaming=l,this.blocked=d,this.phoneNumber=f,this.firstBookingsDate=m,this.userFirstBookingsDate=p,this.lastBookingsDate=y}static fromJson(e,t){const r=new as({});return r.name=e.name??"",e.gender!=null&&(r.gender=r.getGenderFromStr(e.gender)),r.isVerifiedPhone=e.isVerifiedPhone??!1,r.freeFromPayments=e.freeFromPayments??!1,r.customerUuid=t,r.phoneNumber=e.phoneNumber??(t.length<20&&t.includes("-")?t:""),e.firstBookingsDate!=""&&e.firstBookingsDate!=null&&(r.firstBookingsDate=new Date(e.firstBookingsDate)),e.userFirstBookingsDate!=""&&e.userFirstBookingsDate!=null&&(r.userFirstBookingsDate=new Date(e.userFirstBookingsDate),(r.firstBookingsDate==null||r.userFirstBookingsDate<r.firstBookingsDate)&&(r.firstBookingsDate=r.userFirstBookingsDate)),e.lastBookingsDate!=null&&(r.lastBookingsDate=new Date(e.lastBookingsDate)),r.workerNaming=e.workerNaming??"",r.amoutOfBookings=e.amoutOfBookings??0,r.blocked=e.blocked??!1,r.email=e.email??"",r.id=e.id??"",r.addedManually=e.AM??!1,r}fromCustomerData(e){return this.name=e.name,this.gender=e.gender,this.isVerifiedPhone=e.isVerifiedPhone,this.phoneNumber=e.phoneNumber,this.belongings=e.belongings,this.email=e.email,this.isDeleted=e.isDeleted,this.blocked=e.blocked,this.id=e.id,this.addedManually=e.addedManually,this.freeFromPayments=e.freeFromPayments,this.customerUuid=e.customerUuid,this.workerNaming=e.workerNaming,this.firstBookingsDate=e.firstBookingsDate,this.lastBookingsDate=e.lastBookingsDate,this.amoutOfBookings=e.amoutOfBookings,this.userFirstBookingsDate=e.userFirstBookingsDate,this}get nameForWorker(){return this.workerNaming==""?this.name:this.workerNaming}get getFirstDate(){return this.firstBookingsDate==null||this.userFirstBookingsDate!=null&&this.userFirstBookingsDate<this.firstBookingsDate?this.userFirstBookingsDate:this.firstBookingsDate}get customerHashPhone(){return ri(this.phoneNumber)}get customerPhoneAsCollection(){return this.phoneNumber.replaceAll("-","")}isTheSameAs(e,{withId:t=!1}={}){const r=this.toJson();t&&(r.id=e.customerUuid);const s=e.toJson();return t&&(s.id=this.customerUuid),JSON.stringify(s)===JSON.stringify(r)}getGenderFromStr(e){return e==null||e=="A"?ve.anonymous:e=="F"?ve.female:ve.male}getStrFromGender(e){return{[ve.anonymous]:"A",[ve.male]:"M",[ve.female]:"F"}[e]||"A"}get toMultiBookingUser(){const e=new ig;return e.customerName=this.name!=""?this.name:this.workerNaming,e.customerPhone=this.phoneNumber,e.customerId=this.customerUuid,e.userGender=this.gender,e}get toPaymentRequestUser(){return new fi({userId:this.customerUuid,name:this.nameForWorker,gender:this.gender,isExist:!this.addedManually,isVerifiedPhone:this.isVerifiedPhone,phone:this.phoneNumber})}isMissing(e){return this.lastBookingsDate==null?!1:(new Date().getTime()-this.lastBookingsDate.getTime())/(1e3*3600*24)>e}amountOfBookingsInMonth(){if(this.firstBookingsDate==null)return-1;if(this.lastBookingsDate==null)return 0;const e=this.lastBookingsDate>new Date?new Date:this.lastBookingsDate,t=Math.max((e.getTime()-this.firstBookingsDate.getTime())/(1e3*3600*24),1);return this.amoutOfBookings/t*30}toJson(){const e={};return this.name!==""&&(e.name=this.name),this.gender!==ve.male&&(e.gender=this.getStrFromGender(this.gender)),this.phoneNumber!==this.id&&(e.phoneNumber=this.phoneNumber),this.firstBookingsDate!=null&&(e.firstBookingsDate=Ae(this.firstBookingsDate)),this.userFirstBookingsDate!=null&&(e.userFirstBookingsDate=Ae(this.userFirstBookingsDate)),this.lastBookingsDate!=null&&(e.lastBookingsDate=Ae(this.lastBookingsDate)),this.amoutOfBookings!==0&&(e.amoutOfBookings=this.amoutOfBookings),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.freeFromPayments=this.freeFromPayments,this.email!==""&&(e.email=this.email),e.blocked=this.blocked,this.id!==""&&(e.id=this.id),this.addedManually&&(e.AM=this.addedManually),this.workerNaming!==""&&(e.workerNaming=this.workerNaming),e}toMinimalJson(){const e={};return e.N=this.name!==""?this.name:this.workerNaming,e.G=this.getStrFromGender(this.gender),e.P=this.phoneNumber,this.phoneNumber!==this.customerUuid&&(e.CU=this.customerUuid),this.email!==""&&(e.E=this.email),this.id!==""&&(e.ID=this.id),e}static fromMinimalJson(e){const t=new as({});return t.workerNaming=e.N??"",t.name=e.N??"",e.G!=null&&(t.gender=t.getGenderFromStr(e.gender)),t.addedManually=e.AM??!1,t.phoneNumber=e.P??"",t.customerUuid=e.CU??e.P??"",t.email=e.E??"",t.id=e.ID??"",t}get publicCustomer(){return new zi({freeFromPayments:this.freeFromPayments,blocked:this.blocked,hashNumber:m8({id:this.customerUuid})})}get forUpdate(){const e=new as({});return e.name=this.name,e.gender=this.gender,e.isVerifiedPhone=this.isVerifiedPhone,e.phoneNumber=this.phoneNumber,e.belongings=this.belongings,e.email=this.email,e.isDeleted=this.isDeleted,e.blocked=this.blocked,e.id=this.id,e.addedManually=this.addedManually,e.freeFromPayments=this.freeFromPayments,e.customerUuid=this.customerUuid,e.workerNaming=this.workerNaming,e.firstBookingsDate=null,e.userFirstBookingsDate=null,e.amoutOfBookings=0,e.lastBookingsDate=null,e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}const Fv="~.9.~",U8="..",vf="_";class lc{constructor({workerName:e="",date:t="",workerId:r="",timeStr:s="",treatmentId:i="",treatmentName:o="",businessId:a=""}){h(this,"id","");h(this,"businessId","");h(this,"workerName","");h(this,"date","");h(this,"workerId","");h(this,"timeStr","");h(this,"treatmentId","");h(this,"treatmentName","");this.workerName=e,this.date=t,this.workerId=r,this.timeStr=s,this.treatmentId=i,this.treatmentName=o,this.businessId=a}fixEmptyAttributes(){this.workerName=this.workerName===""?"E":this.workerName,this.date=this.date===""?"E":this.date,this.businessId=this.businessId===""?"E":this.businessId,this.workerId=this.workerId===""?"E":this.workerId}static fromJson(e,t){const r=new lc({});return r.id=t,r.workerName=e.workerName??"",r.date=e.date??"",r.timeStr=e.timeStr??"",r.treatmentId=e.treatmentId??"",r.treatmentName=e.treatmentName??"",r.businessId=e.businessId??"",r.workerId=e.workerId??"",r}get isMulti(){return this.timeStr!==""}static fromTopicStr(e){const t=new lc({}),r=e.split(U8),s=r[0].split(vf),i=r[1].split(vf);return t.businessId=s[0],t.workerId=s[1].replaceAll(Fv,"+"),t.date=s[2],t.workerName=i[1],t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}toTopicStr(){this.fixEmptyAttributes();const e=this.workerId.replaceAll("+",Fv);return[this.businessId,e,this.date,this.timeStr,this.treatmentId].join(vf).split("").filter(s=>JC.test(s)).join("")}get dateTime(){const e=zc(this.date),t=this.timeStr===""?new Date(0):dc(this.timeStr);return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes())}toJson(){const e={};return e.businessId=this.businessId,this.workerName!==""&&(e.workerName=this.workerName),this.workerId!==""&&(e.workerId=this.workerId),this.date!==""&&(e.date=this.date),this.timeStr!==""&&(e.timeStr=this.timeStr),this.treatmentName!==""&&(e.treatmentName=this.treatmentName),this.treatmentId!==""&&(e.treatmentId=this.treatmentId),e}toString(){return JSON.stringify(this.toJson())}}const W8={1:"PL",2:"MasterCard",3:"Visa",4:"Maestro",5:"Isracard"},H8={PL:"1",MasterCard:"2",Visa:"3",Maestro:"4",Isracard:"5"},q8={1:"Isracard",2:"Visa Cal",3:"Diners",4:"Amex",6:"Leumi Card"},$8={Isracard:"1","Visa Cal":"2",Diners:"3",Amex:"4","Leumi Card":"6"};class Ca{constructor({brand:e="",token:t="",validityMonth:r="",validityYear:s="",name:i="",userId:o="",bankName:a="",l4Digits:c="",cardId:u="",businessId:l="",attemptsLeft:d=yu}={}){h(this,"brand","");h(this,"token","");h(this,"validityMonth","");h(this,"validityYear","");h(this,"name","");h(this,"bankName","");h(this,"l4Digits","");h(this,"userId","");h(this,"attemptsLeft",yu);h(this,"cardId","");h(this,"businessId","");this.brand=e,this.token=t,this.validityMonth=r,this.validityYear=s,this.name=i,this.userId=o,this.bankName=a,this.l4Digits=c,this.cardId=u,this.businessId=l,this.attemptsLeft=d}static fromJson(e,t,r){const s=new Ca;return s.cardId=t,s.brand=W8[e.brand]||"Card",s.token=e.token||"",s.userId=e.userId||"",s.attemptsLeft=e.attemptsLeft||yu,s.validityMonth=e.validityMonth||"",s.validityYear=e.validityYear||"",s.businessId=r,s.name=e.name||"",s.bankName=e.bankName||"",s.bankName=q8[e.bankName]||"Bank",s.l4Digits=e.l4Digits||"",s}fromPaymentCard(e){this.brand=e.brand,this.token=e.token,this.userId=e.userId,this.businessId=e.businessId,this.cardId=e.cardId,this.attemptsLeft=e.attemptsLeft,this.validityMonth=e.validityMonth,this.validityYear=e.validityYear,this.name=e.name,this.bankName=e.bankName,this.l4Digits=e.l4Digits}toJson(){const e={};return e.brand=H8[this.brand]||"",e.token=this.token,e.userId=this.userId,e.attemptsLeft=this.attemptsLeft,e.validityMonth=this.validityMonth,e.validityYear=this.validityYear,e.name=this.name,e.bankName=this.bankName,e.bankName=$8[this.bankName]||"",e.l4Digits=this.l4Digits,e}decryptCard(e){return new Ca({cardId:this.cardId,brand:this.brand,token:decryptText({encryption:this.token,password:e}),validityMonth:decryptText({encryption:this.validityMonth,password:e}),validityYear:decryptText({encryption:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}encryptCard(e){return new Ca({cardId:this.cardId,brand:this.brand,token:encryptText({text:this.token,password:e}),validityMonth:encryptText({text:this.validityMonth,password:e}),validityYear:encryptText({text:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}isTheSameAs(e){return this.bankName===e.bankName&&this.brand===e.brand&&this.name===e.name&&this.l4Digits===e.l4Digits&&this.userId===e.userId&&this.validityMonth===e.validityMonth&&this.validityYear===e.validityYear}toString(){return JSON.stringify(this,null,"  ")}}class Y8{constructor(){h(this,"futureBookings",{});h(this,"passedBookings",{});h(this,"recurrence")}setMonth(e,t){const r=qT(t),s=$T(new Date);r.getTime()===s.getTime()?(this.passedBookings[t]={},this.futureBookings[t]={}):r.getTime()>s.getTime()?this.futureBookings[t]={}:r.getTime()<s.getTime()&&(this.passedBookings[t]={}),Object.entries(e).forEach(([i,o])=>{const a=wn.fromJson(o,i);a.cancelDate==null&&(a.isPassed?this.passedBookings[t][i]=a:this.futureBookings[t][i]=a)})}setRecurrence(e){this.recurrence={},Object.entries(e).forEach(([t,r])=>{const s=wn.fromJson(r,t);s.cancelDate===null&&(this.recurrence[t]=s)})}get all(){const e={};return Object.values(this.futureBookings).forEach(t=>{Object.entries(t).forEach(([r,s])=>{e[s.bookingId]=s})}),Object.values(this.passedBookings).forEach(t=>{Object.entries(t).forEach(([r,s])=>{e[s.bookingId]=s})}),this.recurrence!==void 0&&Object.entries(this.recurrence).forEach(([t,r])=>{e[t]=r}),e}addBooking(e){var t,r;if(e.recurrenceEvent!==null)this.recurrence??(this.recurrence={}),this.recurrence[e.bookingId]=e;else{const s=_s(e.bookingDate);e.isPassed?((t=this.passedBookings)[s]??(t[s]={}),this.passedBookings[s][e.bookingId]=e):((r=this.futureBookings)[s]??(r[s]={}),this.futureBookings[s][e.bookingId]=e)}}deleteBooking(e){var t,r,s;if(e.recurrenceEvent!==null)(t=this.recurrence)==null||delete t[e.bookingId];else{const i=_s(e.bookingDate);(r=this.passedBookings[i])==null||delete r[e.bookingId],(s=this.futureBookings[i])==null||delete s[e.bookingId]}}lastBookingForBusiness({businessId:e,workerId:t,includePast:r=!1,initDate:s,exclude:i}){let o=s;return Object.entries(this.futureBookings).forEach(([a,c])=>{Object.entries(c).forEach(([u,l])=>{e!==l.buisnessId||t!==l.workerId||i!=null&&i.getTime()===l.bookingDate.getTime()||(o===void 0||l.bookingDate.getTime()>o.getTime())&&(o=l.bookingDate)})}),o}firstBookingForBusiness({businessId:e,workerId:t,includePast:r,initDate:s,exclude:i}){let o=s;for(const[a,c]of Object.entries(this.futureBookings))for(const[u,l]of Object.entries(c))e!==l.buisnessId||t!==l.workerId||i!=null&&i.getTime()===l.bookingDate.getTime()||(o===void 0||l.bookingDate.getTime()<o.getTime())&&(o=l.bookingDate);if(o===void 0&&r)for(const[a,c]of Object.entries(this.passedBookings))for(const[u,l]of Object.entries(c))e!==l.buisnessId||t!==l.workerId||i!==void 0&&i.getTime()===l.bookingDate.getTime()||(o===void 0||l.bookingDate.getTime()<o.getTime())&&(o=l.bookingDate);return o}}class og{constructor(e,t){h(this,"docId","");h(this,"path","");this.docId=e,this.path=t}toJson(){const e={};return e.docId=this.docId,e.path=this.path,e}static fromJson(e){const t=new og("","");return t.docId=e.docId||"",t.path=e.path||"",t}toString(){return JSON.stringify(this,null,2)}}class Lh{constructor({docId:e=""}){h(this,"bookingCount",0);h(this,"lastUpdateTime",new Date(0));h(this,"docId","");this.docId=e}static fromJson(e,t){const r=new Lh({});return e!==void 0&&t!==void 0&&(r.docId=t,r.bookingCount=e.bookingCount??0,r.lastUpdateTime=e.lastUpdateTime?new Date(e.lastUpdateTime):new Date(0)),r}toJson(){const e={};return this.lastUpdateTime.getTime()!==new Date(0).getTime()&&(e.lastUpdateTime=Ae(this.lastUpdateTime)),this.bookingCount>0&&(e.bookingCount=this.bookingCount),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class ba{constructor({email:e="",isVerifiedPhone:t=!1,isVerifiedEmail:r=!1,name:s="",phoneNumber:i="",id:o="",gender:a=ve.anonymous,devices:c=new Map}){h(this,"email","");h(this,"name","");h(this,"phoneNumber","");h(this,"id","");h(this,"devices",new Map);h(this,"gender",ve.anonymous);h(this,"myBuisnessesIds",[]);h(this,"reminders");h(this,"clientAt",new Map);h(this,"hasNotificationPermission",!0);h(this,"permission",new Map);h(this,"tempFcm");h(this,"allowAppNotification",!0);h(this,"isVerifiedPhone",!1);h(this,"isVerifiedEmail",!1);h(this,"invoiceCounter");h(this,"newWorkerWelcomes",new Set);h(this,"bookings",new Map);h(this,"bookingsPreviews",new Map);h(this,"bookingsDocsToLoad",new Set);h(this,"localDocsToDelete",new Set);this.email=e,this.isVerifiedPhone=t,this.isVerifiedEmail=r,this.name=s,this.phoneNumber=i,this.id=o,this.gender=a,this.devices=c}static fromJson(e,t){const r=new ba({email:e.email,isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:e.isVerifiedEmail,name:e.name,phoneNumber:e.phoneNumber,id:e.id,gender:e.gender});return r.setUserPublicData(e,t),r}get customerData(){return new as({customerUuid:this.id,name:this.name,email:this.email,isVerifiedPhone:this.isVerifiedPhone,gender:this.gender,phoneNumber:this.phoneNumber})}setUserPublicData(e,t){if(this.permission=new Map,this.myBuisnessesIds=[],this.isVerifiedEmail=e.isVerifiedEmail||!1,this.email=e.email||"",this.allowAppNotification=e.allowAppNotification||!0,this.email=e.email||"",this.name=e.name||"",this.clientAt=new Map,e.clientAt&&Object.entries(e.clientAt).forEach(([r,s])=>{Object.keys(s).length!==0&&(this.clientAt.set(r,new Set),Object.keys(s).forEach(i=>{this.clientAt.set(r,this.clientAt.get(r).add(i))}))}),e.localDocsToDelete&&(this.localDocsToDelete=new Set,e.localDocsToDelete.forEach(r=>{this.localDocsToDelete.add(og.fromJson(r))})),this.invoiceCounter=e.invoiceCounter,this.devices=new Map,e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([r,s])=>{this.devices.set(r,Qn.fromJson(s,r))}):e.currentFcm&&e.currentFcm!==""&&(this.tempFcm=e.currentFcm),this.hasNotificationPermission=e.hasNotificationPermission||!0,e.gender&&(this.gender=br[e.gender]||ve.anonymous),this.phoneNumber=e.phoneNumber||"",this.id=e.id||e.phoneNumber||"",e.permission&&Object.entries(e.permission).forEach(([r,s])=>{s===2&&this.myBuisnessesIds.push(r),this.permission.set(r,s)}),e.bookings&&(this.bookings=new Map,Object.entries(e.bookings).forEach(([r,s])=>{const i=wn.fromJson(s,r);i.cancelDate||this.bookings.set(r,i)})),this.bookingsDocsToLoad=new Set,e.bookingsPreviews){const r=new Map;Object.entries(e.bookingsPreviews).forEach(([s,i])=>{r.set(s,Lh.fromJson(i,s))}),r.forEach((s,i)=>{var o,a;((o=this.bookingsPreviews.get(i))==null?void 0:o.lastUpdateTime)!==s.lastUpdateTime&&(i===Ow||qT(i)>=$T(new Date)||(((a=t==null?void 0:t.passedBookings)==null?void 0:a.hasOwnProperty(i))??!1))&&this.bookingsDocsToLoad.add(i)}),this.bookingsPreviews=r}this.id===this.phoneNumber?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1,this.newWorkerWelcomes=new Set,e.newWorkerWelcomes&&Object.keys(e.newWorkerWelcomes).forEach(r=>{this.newWorkerWelcomes.add(r)})}get fcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm)return new Set(this.tempFcm);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDevicesByToken(e){const t=[];return Object.values(this.devices).forEach(r=>{r.token===e&&t.push(Qn.fromDevice(r))}),t}toJson(){const e={};return this.hasNotificationPermission||(e.hasNotificationPermission=this.hasNotificationPermission),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.isVerifiedEmail&&(e.isVerifiedEmail=this.isVerifiedEmail),this.email!==""&&(e.email=this.email),Object.keys(this.bookingsPreviews).length>0&&(e.bookingsPreviews={},Object.entries(this.bookingsPreviews).forEach(([t,r])=>{e.bookingsPreviews[t]=r.toJson()})),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),e.permission={},Object.entries(this.permission).forEach(([t,r])=>{e.permission[t]=r}),this.localDocsToDelete.size>0&&(e.localDocsToDelete=[],this.localDocsToDelete.forEach(t=>{e.localDocsToDelete.push(t.toJson())})),e.email=this.email,e.name=this.name,e.devices={},this.devices.forEach((t,r)=>{e.devices[r]=t.toJson()}),e.clientAt={},this.clientAt.forEach((t,r)=>{e.clientAt[r]={},t.forEach(s=>{e.clientAt[r][s]=""})}),e.gender=Xi[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,this.newWorkerWelcomes.size>0&&(e.newWorkerWelcomes={},this.newWorkerWelcomes.forEach(t=>{e.newWorkerWelcomes[t]=""})),e}}class ag{constructor(e,t,r){h(this,"businessId","");h(this,"date");h(this,"productId","");this.businessId=e,this.date=t,this.productId=r}static fromJson(e,t){const r=new ag(t,null,"");return r.businessId=e.businessId||"",e.date instanceof Fe&&(r.date=e.date),r}toJson(){const e={};return e.businessId=this.businessId,this.date!==null&&this.date!==void 0&&(e.date=this.date),e}}class Gi{constructor({name:e="",phoneNumber:t="",id:r="",productsIds:s={},myBuisnessesIds:i=[],revenueCatId:o="",limitOfBuisnesses:a=1,gender:c=ve.anonymous,lastVisitedBuisnesses:u=[],lastVisitedBuisnessesRemoved:l=[],paymentCards:d={},isVerifiedPhone:f=!1,isVerifiedEmail:m=!1,email:p="",lastCleanDate:y=Fe.fromDate(new Date),createdAt:g=new Date}){h(this,"productsIds",{});h(this,"pendingProductsIds",{});h(this,"id","");h(this,"revenueCatId","");h(this,"limitOfBuisnesses",1);h(this,"preferdTipPercentage",0);h(this,"cardPaymentsPass","");h(this,"lastTimeUpdatePhone",new Date(0));h(this,"lastTimeUpdateEmail",new Date(0));h(this,"authProviders",new Map);h(this,"businessesInfo",{});h(this,"storyLikes",[]);h(this,"paymentCards",{});h(this,"lastVisitedBuisnesses",[]);h(this,"lastVisitedBuisnessesRemoved",[]);h(this,"lastCleanDate",Fe.fromDate(new Date));h(this,"businessTopics",new Set);h(this,"waitingListTopics",{});h(this,"tempFcm");h(this,"termsApprovals",{});h(this,"seenUpdates",{});h(this,"createdAt",new Date);h(this,"userPublicData",new ba({}));h(this,"name","");h(this,"isVerifiedPhone",!1);h(this,"phoneNumber","");h(this,"gender",ve.anonymous);h(this,"lastTimeConnect",new Date);h(this,"userPublicDataListener");h(this,"connectedGoogleEmail","");h(this,"currentMonthInvoices");h(this,"currentMonthPaymentRequest");h(this,"currentMonthPayments");h(this,"existInvoicesDocs",new Set);h(this,"existPaymentsDocs",new Set);h(this,"existPaymentRequestsDocs",new Set);h(this,"invoices",{});h(this,"devices",{});h(this,"bookings",new Y8);h(this,"hasOldNotification",!1);this.userPublicData=new ba({email:p,isVerifiedEmail:m,isVerifiedPhone:f,name:e,phoneNumber:t,id:r,gender:c}),this.name=e,this.phoneNumber=t,this.id=r,this.productsIds=s,this.revenueCatId=o,this.limitOfBuisnesses=a,this.gender=c,this.lastVisitedBuisnesses=u,this.lastVisitedBuisnessesRemoved=l,this.paymentCards=d,this.isVerifiedPhone=f,this.cardPaymentsPass="",this.lastCleanDate=y,this.createdAt=g}get toPaymentRequestUser(){return new fi({userId:this.id,name:this.name,gender:this.gender,isVerifiedPhone:this.isVerifiedPhone,isExist:!0,phone:this.phoneNumber,userDecline:!1})}customerDataFromBooking({booking:e,exclude:t,needDelete:r=!1,initDate:s}){return new as({name:this.name,email:this.userPublicData.email,gender:this.gender,customerUuid:this.id,phoneNumber:this.phoneNumber,isVerifiedPhone:this.isVerifiedPhone,userFirstBookingsDate:this.bookings.firstBookingForBusiness({businessId:e.buisnessId,workerId:e.workerId,exclude:r?e.bookingDate:t,initDate:r?s:e.bookingDate}),lastBookingsDate:this.bookings.lastBookingForBusiness({businessId:e.buisnessId,workerId:e.workerId,exclude:r?e.bookingDate:t,initDate:r?s:e.bookingDate})})}get fcmsTokens(){if(!this.userPublicData.allowAppNotification)return new Set;if(this.tempFcm)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDeviceByToken(e){let t;return Object.values(this.devices).forEach(r=>{r.token===e&&(t=Qn.fromDevice(r))}),t}static fromUserDocJson(e){const t=new Gi({name:e.name,phoneNumber:e.phoneNumber,id:e.id,productsIds:{},myBuisnessesIds:[],revenueCatId:e.revenueCatId,limitOfBuisnesses:e.limitOfBuisnesses,gender:br[e.gender],lastVisitedBuisnesses:e.lastVisitedBuisnesses,lastVisitedBuisnessesRemoved:e.lastVisitedBuisnessesRemoved,paymentCards:{},isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:!1,email:"",lastCleanDate:e.lastCleanDate,createdAt:new Date(e.createdAt)});return e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([r,s])=>{t.devices[r]=Qn.fromJson(s,r)}):e.currentFcm&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),e.termsApprovals&&Object.entries(e.termsApprovals).forEach(([r,s])=>{t.termsApprovals[r]=new Date(s)||new Date(0)}),t.seenUpdates={},e.seenUpdates&&Object.entries(e.seenUpdates).forEach(([r,s])=>{t.seenUpdates[r]=new Set(s)}),t.phoneNumber=e.phoneNumber||"0",t.id=e.id||e.phoneNumber,t.preferdTipPercentage=0,e.preferdTipPercentage&&(t.preferdTipPercentage=Number.isInteger(e.preferdTipPercentage)?e.preferdTipPercentage:Math.floor(e.preferdTipPercentage)),t.cardPaymentsPass=e.cardPaymentsPass||"",e.storyLikes&&e.storyLikes.forEach(r=>t.storyLikes.push(r)),e.lastTimeUpdatePhone&&(t.lastTimeUpdatePhone=new Date(e.lastTimeUpdatePhone)||new Date(0)),e.lastTimeUpdateEmail&&(t.lastTimeUpdateEmail=new Date(e.lastTimeUpdateEmail)||new Date(0)),t.productsIds={},e.productsIds&&Object.entries(e.productsIds).forEach(([r,s])=>{t.productsIds[r]=ag.fromJson(s,r)}),e.pendingProductsIds&&Object.entries(e.pendingProductsIds).forEach(([r,s])=>{t.pendingProductsIds[r]=s}),t.revenueCatId=e.revenueCatId||"",t.lastCleanDate=e.lastCleanDate,e.lastVisitedBuisnesses.forEach(r=>t.lastVisitedBuisnesses.push(r)),e.lastVisitedBuisnessesRemoved&&e.lastVisitedBuisnessesRemoved.forEach(r=>t.lastVisitedBuisnessesRemoved.push(r)),t.businessesInfo={},e.businessesInfo&&Object.entries(e.businessesInfo).forEach(([r,s])=>{t.businessesInfo[r]=Aa.fromJson(s,r)}),e.businessTopics&&e.businessTopics.forEach(r=>{t.businessTopics.add(r)}),e.waitingListTopics&&(t.waitingListTopics={},Object.entries(e.waitingListTopics).forEach(([r,s])=>{const i=lc.fromJson(s,r);i.date===""?t.businessTopics.add(r):t.waitingListTopics[r]=i})),t.paymentCards={},e.paymentCards&&Object.entries(e.paymentCards).forEach(([r,s])=>{t.paymentCards[r]={},Object.entries(s).forEach(([i,o])=>{t.paymentCards[r][i]=Ca.fromJson(o,i,r)})}),t.createdAt=new Date(e.createdAt),t.limitOfBuisnesses=e.limitOfBuisnesses||1,e.authProviders?Object.entries(e.authProviders).forEach(([r,s])=>{if(py[r]){const i=py[r];t.authProviders.set(i,new Date(s)||new Date(2023))}}):t.authProviders=new Map([[zx.Phone,t.createdAt]]),t.id===t.phoneNumber?t.isVerifiedPhone=!0:t.isVerifiedPhone=e.isVerifiedPhone||!1,e.lastTimeConnect&&(t.lastTimeConnect=new Date(e.lastTimeConnect)||new Date),t.userPublicData=new ba({isVerifiedPhone:t.isVerifiedPhone,phoneNumber:t.phoneNumber}),t}setUserPublicData(e){this.name=e.name||"",e.devices&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,r])=>{this.devices[t]=Qn.fromJson(r,t)}),this.gender=br[e.gender],this.phoneNumber=e.phoneNumber,this.id=e.id||e.phoneNumber,this.userPublicData.setUserPublicData(e,this.bookings)}firstEnterance(e){return!new Set([...this.lastVisitedBuisnesses,...this.lastVisitedBuisnessesRemoved]).has(e)}toUserDocJson(){const e={};return e.name=this.name,e.devices={},Object.entries(this.devices).forEach(([t,r])=>{e.devices[t]=r.toJson()}),this.lastTimeUpdateEmail.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdateEmail=Ae(this.lastTimeUpdateEmail)),this.lastTimeUpdatePhone.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdatePhone=Ae(this.lastTimeUpdatePhone)),e.gender=Xi[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,Object.keys(this.termsApprovals).length>0&&(e.termsApprovals={},Object.entries(this.termsApprovals).forEach(([t,r])=>{e.termsApprovals[t]=Ae(r)})),Object.keys(this.seenUpdates).length>0&&(e.seenUpdates={},Object.entries(this.seenUpdates).forEach(([t,r])=>{e.seenUpdates[t]=Array.from(r)})),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.preferdTipPercentage=this.preferdTipPercentage,e.revenueCatId=this.revenueCatId,Object.keys(this.productsIds).length>0&&(e.productsIds={},Object.entries(this.productsIds).forEach(([t,r])=>{e.productsIds[t]=r.toJson()})),e.pendingProductsIds=this.pendingProductsIds,e.lastCleanDate=this.lastCleanDate,e.limitOfBuisnesses=this.limitOfBuisnesses,e.lastVisitedBuisnesses=this.lastVisitedBuisnesses,e.lastVisitedBuisnessesRemoved=this.lastVisitedBuisnessesRemoved,e.businessesInfo={},this.cardPaymentsPass!==""&&(e.cardPaymentsPass=this.cardPaymentsPass),Object.entries(this.businessesInfo).forEach(([t,r])=>{e.businessesInfo[t]=r.toJson()}),e.storyLikes=this.storyLikes,e.waitingListTopics={},Object.entries(this.waitingListTopics).forEach(([t,r])=>{e.waitingListTopics[t]=r.toJson()}),e.businessTopics=Array.from(this.businessTopics),e.authProviders={},this.authProviders.forEach((t,r)=>{e.authProviders[r]=Ae(t)}),e.paymentCards={},Object.entries(this.paymentCards).forEach(([t,r])=>{e.paymentCards[t]={},Object.entries(r).forEach(([s,i])=>{e.paymentCards[t][s]=i.toJson()})}),e.createdAt=Ae(this.createdAt),e}get developerId(){return this.id.replace("+","")}toString(){return JSON.stringify(this.toUserDocJson())+JSON.stringify(this.userPublicData.toJson())}}let M0=Eo(new Gi({})),wf=Eo(!1);function z(n,e=Bn(WD),t=!0){const r=e(n);return Bn(UD)==="he"&&t?z8(r):r}function z8(n){const e=Bn(M0).gender;return e===ve.male||e===ve.anonymous||Object.keys(ny).forEach(r=>{n=n.replaceAll(r,ny[r])}),n}class hc{constructor(){h(this,"eventName","");h(this,"from",new Date(0));h(this,"to",new Date(0));h(this,"colorIndex",-1);h(this,"isBreak",!1);h(this,"eventIndex",0);h(this,"eventsBelong",1);h(this,"partOfRecurrence",!1);h(this,"treatmentName","");h(this,"transactionCounter",0);h(this,"wantDelete",!1);h(this,"onHold",!1);h(this,"hasInvoice",!1);h(this,"durationMinutes",0);h(this,"breakNotificaiton",!1);h(this,"minutesBreakNotification",60);h(this,"extraData");h(this,"note");h(this,"ids",[]);h(this,"recurrenceEvent");h(this,"timeId");h(this,"hasDebt",!1);h(this,"confirmArrival",!1);h(this,"treatmentId");h(this,"isMulti",!1);h(this,"currentParticipants",0);h(this,"debtCounter",0);h(this,"onHoldCounter",0);h(this,"invoiceCoverCounter",0);h(this,"transactionsPerUser",0);h(this,"wantDeleteCounter",0);h(this,"confirmedArrivalAmount",0);h(this,"recurrenceFatherBookingId");h(this,"recurrenceBreakFatherDate");h(this,"blockSchedule",!0);h(this,"recurrenceBreakRefInfo");h(this,"breakIconData");h(this,"breakBusinessName");h(this,"breakFatherRecurrenceId");h(this,"breakBusinessId");h(this,"breakAddedToDeviceCalendar",!1);h(this,"breakId","");h(this,"vacationId","");h(this,"belongTreatments",1);h(this,"vacationCreatedAt");h(this,"isVacation",!1);h(this,"vacationAddedToDeviceCalendar",!1);h(this,"vacationEndTemp");h(this,"isHoliday",!1);h(this,"holidayReligion");h(this,"subTreatmentName","");h(this,"totalBookingMinutes",0);h(this,"waitingListCounter",1);h(this,"isWaitingList",!1);h(this,"waitingListCustomerGender",ve.male);h(this,"customerPhoneWaitingList","")}static fromJson({json:e,timeStr:t,dayString:r,monthString:s,workerId:i,businessModel:o,newTimeId:a}){const c=new hc;c.eventName=e.p??"",c.eventIndex=e.i??0,c.onHold=e.oH??!1,c.eventsBelong=e.EB??1,c.wantDelete=e.wD??!1,c.isVacation=e.IV??!1,c.isVacation&&c.eventName===""&&(c.eventName=z("Vacation")),c.vacationId=a??"",c.breakFatherRecurrenceId=e.BFRI??"",c.vacationAddedToDeviceCalendar=e.VATDC??!1,c.blockSchedule=e.BS??!0,c.transactionCounter=e.TC??0,c.transactionsPerUser=e.TPU??0,c.hasDebt=e.HD??!1,c.debtCounter=e.DC??0,c.treatmentId=e.TID,c.confirmArrival=e.CA??!1,c.confirmedArrivalAmount=e.CAA??0,c.durationMinutes=e.d??0,c.treatmentName=e.TN??"",c.hasInvoice=e.Hi??!1,c.invoiceCoverCounter=e.ICC??0,c.note=e.N,c.recurrenceFatherBookingId=e.RFBI,c.wantDeleteCounter=e.WDC??0,c.onHoldCounter=e.OHC??0,c.isMulti=e.IM??!1,c.currentParticipants=e.CP??0,c.breakNotificaiton=e.BN??!1,c.partOfRecurrence=e.POR??!1,c.minutesBreakNotification=e.MBN??60,c.recurrenceBreakRefInfo=e.RBRI?$n.fromJson(e.RBRI):void 0,c.recurrenceBreakFatherDate=e.RBFD;const u=e.IB??!1,l=new Date(t),d=new Date(`${r}-${s}`),f=new Date(d.getFullYear(),d.getMonth(),d.getDate(),l.getHours(),l.getMinutes());return c.to=qe(f,new ee({minutes:c.durationMinutes})),c.recurrenceEvent=e.RE?$n.fromJson(e.RE,f):void 0,c.colorIndex=e.c??(c.isVacation?1:0),c.ids=[i],c.isHoliday=!1,c.subTreatmentName="",c.totalBookingMinutes=0,c.waitingListCounter=1,c.isWaitingList=!1,c.waitingListCustomerGender=ve.male,c.customerPhoneWaitingList="",u&&(c.breakIconData=o==null?void 0:o.design.shopIconData,c.breakBusinessName=o==null?void 0:o.shopName,c.breakBusinessId=o==null?void 0:o.businessId),e.VE&&(c.vacationEndTemp=zc(e.VE)),c}get endOfBooking(){return qe(this.from,new ee({minutes:this.totalBookingMinutes}))}toJson(){const e={};return e.p=this.eventName,e.d=this.durationMinutes,e.c=this.colorIndex,this.minutesBreakNotification!==60&&(e.MBN=this.minutesBreakNotification),this.breakNotificaiton&&(e.BN=this.breakNotificaiton),this.onHoldCounter>0&&(e.OHC=this.onHoldCounter),this.confirmArrival&&(e.CA=this.confirmArrival),this.confirmedArrivalAmount>0&&(e.CAA=this.confirmedArrivalAmount),this.blockSchedule||(e.BS=this.blockSchedule),this.treatmentId!==void 0&&(e.TID=this.treatmentId),this.wantDeleteCounter>0&&(e.WDC=this.wantDeleteCounter),this.hasDebt&&(e.HD=this.hasDebt),this.transactionCounter>0&&(e.TC=this.transactionCounter),this.transactionsPerUser>0&&(e.TPU=this.transactionsPerUser),this.debtCounter>0&&(e.DC=this.debtCounter),this.invoiceCoverCounter>0&&(e.ICC=this.invoiceCoverCounter),this.eventsBelong!==1&&(e.EB=this.eventsBelong),this.isBreak&&(e.IB=this.isBreak),this.breakId!==""&&(e.BI=this.breakId),this.eventIndex!==0&&(e.i=this.eventIndex),this.treatmentName!==""&&(e.TN=this.treatmentName),this.onHold&&(e.oH=this.onHold),this.isMulti&&(e.IM=this.isMulti),this.currentParticipants>0&&(e.CP=this.currentParticipants),this.wantDelete&&(e.wD=this.wantDelete),this.hasInvoice&&(e.Hi=this.hasInvoice),this.recurrenceEvent!=null&&(e.RE=this.recurrenceEvent.toJson({})),this.note!==void 0&&this.note!==""&&(e.N=this.note),this.partOfRecurrence&&(e.POR=this.partOfRecurrence),this.recurrenceFatherBookingId!=null&&(e.RFBI=this.recurrenceFatherBookingId),this.isVacation&&(e.IV=this.isVacation),this.breakFatherRecurrenceId!=null&&(e.BFRI=this.breakFatherRecurrenceId),this.vacationAddedToDeviceCalendar&&(e.VATDC=this.vacationAddedToDeviceCalendar),this.vacationCreatedAt!=null&&(e.VCA=this.vacationCreatedAt.toString()),this.breakAddedToDeviceCalendar&&(e.BATDC=this.breakAddedToDeviceCalendar),this.timeId!==void 0&&this.recurrenceEvent===void 0&&(e.RTI=this.timeId),this.recurrenceBreakFatherDate!==void 0&&(e.RBFD=this.recurrenceBreakFatherDate),this.recurrenceBreakRefInfo!=null&&(e.RBRI=this.recurrenceBreakRefInfo.toJson({saveStartDate:!1,saveEnd:!0,saveException:!1})),this.subTreatmentName!==""&&(e.STN=this.subTreatmentName),this.totalBookingMinutes!==this.durationMinutes&&(e.TBM=this.totalBookingMinutes),this.belongTreatments>1&&(e.BTR=this.belongTreatments),e}toString(){return JSON.stringify(this,void 0,2)}}function J5(n,e){const t=qe(e.bookingDate,new ee({minutes:e.totalMinutes}));return n.getTime()===dc("23:59").getTime()&&t.getHours()===0&&t.getMinutes()===0}function Q5(n,e){const t=[];for(let r=0;r<n.length;r+=2)n[r+1]>=e&&t.push(n[r],n[r+1]);return t}function Cn(n){return bt(n,"HH:mm")}function K5(n,e){return bt(n,e,{})}function O0(n){return bt(n,"dd")}function _s(n){return bt(n,"MM-yyyy")}function sn(n){return bt(n,"dd-MM-yyyy")}function dc(n){const e=U(n,"HH:mm").toDate();return e.setFullYear(1970),e.setMonth(0),e.setDate(1),e}function zc(n){return U(n,"dd-MM-yyyy").toDate()}function qT(n){return U(n,"MM-yyyy").toDate()}function j5(n){return n.getHours()>=19&&n.getHours()<=23||n.getHours()>=0&&n.getHours()<=2?z("night"):n.getHours()>=3&&n.getHours()<=4?z("beforeMorning"):n.getHours()>=5&&n.getHours()<=11?z("morning"):z("noon")}function $T(n){return new Date(n.getFullYear(),n.getMonth(),1)}function cn(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate())}function pu(n){return new Date(1970,0,1,n.getHours(),n.getMinutes())}function Bv(n,e){return new Date(n.getFullYear(),n.getMonth()+e,n.getDate(),n.getHours(),n.getMinutes())}function X5(n){const e=[];for(let t=0;t<n.length;t++)e.push(dc(n[t]));return e}function Ds(n){const e=n.getDay(),t=n.getDate()-e+(e===0?-6:1);return new Date(n.setDate(t))}function Z5(n,e){let t=!1;return n.religions.forEach(r=>{var i,o;console.log(e);let s=sn(e);switch(r){case Bf.christian:s=s.substring(0,s.length-4)+"0000",t=(t||((i=ry[Bf.christian])==null?void 0:i[s])!=null)??!1;break;default:t=(t||((o=ry[r])==null?void 0:o[s])!=null)??!1;break}}),t}function Ae(n){return`${bt(n,"yyyy-MM-dd")}T${bt(n,"HH:mm:ss")}.000Z`}function G8(n){return Qk(bt(n,"dd-MM-yyyy"),"dd-MM-yyyy",new Date)}function Lv(n,e){let t=n.getFullYear()-e.getFullYear(),r=n.getMonth()-e.getMonth();return r<0&&(t-=1,r+=12),Math.abs(t*12+r)}function xf(n,e){return Qr(n.bookingDate,new ee({minutes:e}))}function eV(n){var e=n.getDay(),t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],r=t[e];return r}class Gc{constructor({businessId:e="",date:t,id:r="",workerId:s="",businessName:i="",shopIcon:o=new Oe}={}){h(this,"businessId","");h(this,"businessName","");h(this,"date");h(this,"id","");h(this,"workerId","");h(this,"shopIcon",new Oe);this.businessId=e,this.date=t||null,this.id=r,this.workerId=s,this.businessName=i,this.shopIcon=o}static fromJsonStr(e){const t=JSON.parse(e),r=t.date?new Date(t.date):null,s=t.shopIcon?Oe.fromJsonStr(t.shopIcon):new Oe,i=new Gc({businessId:t.businessId,date:r,id:t.id,workerId:t.workerId,businessName:t.businessName});return i.shopIcon=s,i}toJsonStr(){var t;const e={businessId:this.businessId,date:(t=this.date)==null?void 0:t.toString(),id:this.id,workerId:this.workerId,businessName:this.businessName,shopIcon:this.shopIcon.toJsonStr()};return JSON.stringify(e)}toString(){return this.toJsonStr()}}class cg extends Gc{constructor({businessId:t,date:r,id:s,workerId:i,businessName:o,totalMinutes:a,isRecurrence:c,shopIcon:u}){super({businessId:t,date:r,id:s,workerId:i,businessName:o,shopIcon:u});h(this,"isRecurrence",!1);h(this,"totalMinutes",0);this.totalMinutes=a,this.isRecurrence=c}static fromJsonStr(t){const r=JSON.parse(t),s=r.businessId||"",i=r.businessName||"",o=r.date?new Date(r.date):void 0,a=r.workerId||"",c=r.id||"",u=r.isRecurrence||!1,l=r.totalMinutes||0,d=r.shopIcon?Oe.fromJsonStr(r.shopIcon):void 0;return new cg({businessId:s,date:o,id:c,workerId:a,businessName:i,totalMinutes:l,isRecurrence:u,shopIcon:d})}toJsonStr(){var r;const t={};return t.businessId=this.businessId,t.isRecurrence=this.isRecurrence,t.totalMinutes=this.totalMinutes,this.date!==void 0&&(t.date=Ae(this.date)),t.businessName=this.businessName,t.id=this.id,t.workerId=this.workerId,t.shopIcon=((r=this.shopIcon)==null?void 0:r.toJsonStr())||null,JSON.stringify(t)}toString(){return this.toJsonStr()}}class ug{constructor({businessId:e,id:t,businessName:r,type:s,dateToNotify:i,isMulti:o,minutesToAdd:a,address:c,phoneToContact:u,shopIcon:l,fcms:d,totalEventMinutes:f=0,isRecurrence:m=!1}){h(this,"id","");h(this,"businessId","");h(this,"shopIcon",new Oe);h(this,"businessName","");h(this,"dateToNotify",new Date(0));h(this,"fcms",new Set);h(this,"minutesToAdd",0);h(this,"address","");h(this,"phoneToContact","");h(this,"isMulti",!1);h(this,"isRecurrence",!1);h(this,"totalEventMinutes",0);h(this,"type","");this.businessId=e,this.id=t,this.businessName=r,this.type=s,this.dateToNotify=i,this.isMulti=o,this.minutesToAdd=a,this.address=c,this.phoneToContact=u,this.shopIcon=l,this.fcms=d,this.totalEventMinutes=f,this.isRecurrence=m}isEqual(e){return e.businessId===this.businessId&&e.businessName===this.businessName&&JSON.stringify([...e.fcms])===JSON.stringify([...this.fcms])&&e.shopIcon.isEqual(this.shopIcon)&&e.totalEventMinutes===this.totalEventMinutes&&e.isMulti===this.isMulti&&e.minutesToAdd===this.minutesToAdd&&e.isRecurrence===this.isRecurrence&&e.type===this.type}static fromJson(e){const t=Oe.fromJson(e.SI),r=new Set(e.FS||[]),s=new Date(e.dateToNotify);return new ug({businessId:e.I,id:e.ID,businessName:e.B,type:e.T,dateToNotify:s,isMulti:e.IM,minutesToAdd:e.MTA,address:e.A,phoneToContact:e.P,shopIcon:t,fcms:r,totalEventMinutes:e.TEM,isRecurrence:e.IR})}get dbPath(){return`/${LC}/${UC}/1/${this.dateToNotify.getFullYear()}/${this.dateToNotify.getMonth()}/${this.dateToNotify.getDay()}/${this.dateToNotify.getHours()}`}toJson(){const e={};return this.phoneToContact!==""&&(e.P=this.phoneToContact),this.address!==""&&(e.A=this.address),this.type!==""&&(e.T=this.type),this.businessName!==""&&(e.B=this.businessName),this.fcms.size>0&&(e.FS=Array.from(this.fcms)),this.businessId!==""&&(e.I=this.businessId),this.isMulti&&(e.IM=this.isMulti),this.minutesToAdd!==3&&(e.MTA=this.minutesToAdd),this.isRecurrence&&(e.IR=this.isRecurrence),this.totalEventMinutes>0&&(e.TEM=this.totalEventMinutes),e.SI=this.shopIcon.toJson(),e}toString(){return JSON.stringify(this.toJson(),null,2)}}class Vh{constructor({id:e,date:t,isMultiBooking:r,workerId:s,signNewMultiBookingUsers:i=!1}){h(this,"id","");h(this,"date",new Date(0));h(this,"isMultiBooking",!1);h(this,"workerId","");h(this,"signNewMultiBookingUsers",!1);this.id=e,this.date=t,this.isMultiBooking=r,this.workerId=s,this.signNewMultiBookingUsers=i}toJson(){const e={};return e.I=this.id,e.D=Ae(this.date),e.WI=this.workerId,this.isMultiBooking&&(e.IMB=this.isMultiBooking),this.signNewMultiBookingUsers&&(e.SNMBU=this.signNewMultiBookingUsers),e}static fromJson(e){const t=e.D?new Date(e.D):new Date(0),r=e.I||"",s=e.IMB||!1,i=e.WI||"",o=e.SNMBU||!1;return new Vh({id:r,date:t,isMultiBooking:s,workerId:i,signNewMultiBookingUsers:o})}toString(){return JSON.stringify(this,null,2)}}class J8{constructor({workerId:e="",workerName:t="",businessName:r="",buisnessId:s="",workerPhone:i=""}={}){h(this,"date",new Date(0));h(this,"workerId","");h(this,"workerName","");h(this,"workerPhone","");h(this,"buisnessId","");h(this,"businessName","");h(this,"recurrenceEvent");h(this,"recurrenceRef");h(this,"recurrenceFatherDate");h(this,"recurrenceEventRefInfo");h(this,"recurrenceNotificationsLastDate");h(this,"recurrenceChildDate");this.workerId=e,this.workerName=t,this.businessName=r,this.buisnessId=s,this.workerPhone=i}}const lg="simpletor.officialsimplecode.com",tV="businesses?BusinessId=BUISNESS_ID",hg="?PaymentId=PAYMENT_ID";class Uh{constructor({id:e,workerId:t}){h(this,"id","");h(this,"workerId","");h(this,"createdAt",new Date(0));h(this,"signNewMultiBookingUsers",!0);this.id=e,this.workerId=t}get link(){return`https://${lg}/${hg}`.replace("PAYMENT_ID",this.id)}static fromJson(e){const t=new Uh({});return t.id=e.id??"",e.createdAt!=null&&(t.createdAt=new Date(e.createdAt)||new Date(0)),t.workerId=e.workerId??"",t.signNewMultiBookingUsers=e.signNewMultiBookingUsers??!0,t}toJson(){const e={};return this.createdAt.getTime()!==new Date(0).getTime()&&(e.createdAt=Ae(this.createdAt)),this.signNewMultiBookingUsers||(e.signNewMultiBookingUsers=this.signNewMultiBookingUsers),e.id=this.id,e.workerId=this.workerId,e}toString(){return JSON.stringify(this.toJson(),null,2)}}const{v4:Vv}=HT;class wn extends J8{constructor({workerId:t,workerName:r,businessName:s,buisnessId:i,workerPhone:o}){super({workerId:t,workerName:r,businessName:s,buisnessId:i,workerPhone:o});h(this,"customerName","");h(this,"customerPhone","");h(this,"customerId","");h(this,"orderingOptions",pn.app);h(this,"isVerifiedPhone",!1);h(this,"isUserExist",!0);h(this,"notificationType",K.none);h(this,"workerNotificationOption",We.PushOrSMS);h(this,"remindersTypes",new Map);h(this,"workerRemindersTypes",new Map);h(this,"workerDeleted",!1);h(this,"clientMail","");h(this,"showAdressAlert",!1);h(this,"showPhoneAlert",!1);h(this,"signOnDeviceCalendar",!1);h(this,"isMultiRef",!1);h(this,"cancelDate");h(this,"lastTimeNotifyOnDebt");h(this,"adress","");h(this,"wasWaiting",!1);h(this,"bookingDate",new Date(0));h(this,"note","");h(this,"needCancel",!1);h(this,"treatments",new Map);h(this,"userGender",ve.anonymous);h(this,"workerGender",ve.anonymous);h(this,"status",Ft.approved);h(this,"confirmedArrival",!1);h(this,"bookingId","");h(this,"userFcms",new Set);h(this,"clientNote","");h(this,"shopIcon",new Oe);h(this,"createdAt",new Date);h(this,"finishInvoices",!1);h(this,"invoices",new Map);h(this,"transactions",new Map);h(this,"recurrenceTimeId");h(this,"recurreneFatherDate");h(this,"debts",new Map);h(this,"addToClientAt",!1);h(this,"paymentRequest");h(this,"userDeleted",!1);h(this,"fatherMultiBooking");h(this,"fatherRecurrenceBooking")}static empty(){return new wn({})}static fromBooking(t){const r=new wn({});return r.customerName=t.customerName,r.customerPhone=t.customerPhone,r.customerId=t.customerId,r.workerPhone=t.workerPhone,r.workerGender=t.workerGender,r.userGender=t.userGender,r.businessName=t.businessName,r.buisnessId=t.buisnessId,r.bookingId=t.bookingId,r.workerGender=t.workerGender,r.shopIcon=t.shopIcon,r.recurrenceTimeId=t.recurrenceTimeId,r.note=t.note,r.workerRemindersTypes={...t.workerRemindersTypes},r.signOnDeviceCalendar=t.signOnDeviceCalendar,r.userDeleted=t.userDeleted,r.workerNotificationOption=t.workerNotificationOption,r.paymentRequest=t.paymentRequest,r.remindersTypes={...t.remindersTypes},r.isVerifiedPhone=t.isVerifiedPhone,r.workerDeleted=t.workerDeleted,r.finishInvoices=t.finishInvoices,r.adress=t.adress,r.addToClientAt=t.addToClientAt,r.showAdressAlert=t.showAdressAlert,r.showPhoneAlert=t.showPhoneAlert,r.orderingOptions=t.orderingOptions,r.isUserExist=t.isUserExist,r.isMultiRef=t.isMultiRef,r.needCancel=t.needCancel,r.userGender=t.userGender,r.bookingDate=t.bookingDate,t.recurrenceEventRefInfo!==void 0&&(r.recurrenceEventRefInfo=$n.fromRecurrenceEvent(t.recurrenceEventRefInfo)),t.recurrenceEvent!==void 0&&(r.recurrenceEvent=$n.fromRecurrenceEvent(t.recurrenceEvent)),r.recurrenceNotificationsLastDate=t.recurrenceNotificationsLastDate,r.cancelDate=t.cancelDate,r.customerId=t.customerId,r.workerPhone=t.workerPhone,r.lastTimeNotifyOnDebt=t.lastTimeNotifyOnDebt,t.debts.forEach((s,i)=>{r.debts.set(i,_o.fromDebt(s))}),r.treatments=new Map,t.treatments.forEach((s,i)=>{const o=vn.fromTreatment(s);o.index=i,r.treatments.set(i,s)}),r.invoices=new Map,t.invoices.forEach((s,i)=>{r.invoices.set(i,ys.fromBookingInvoiceData(s))}),r.clientNote=t.clientNote,r.status=t.status,r.confirmedArrival=t.confirmedArrival,r.createdAt=t.createdAt,r.clientMail=t.clientMail,r.workerName=t.workerName,r.buisnessId=t.buisnessId,r.notificationType=t.notificationType,r.userFcms=new Set(t.userFcms),r.recurreneFatherDate=t.recurreneFatherDate,r.recurrenceRef=t.recurrenceRef,r.transactions=new Map,t.transactions.forEach((s,i)=>{r.transactions.set(i,qs.fromTransaction(s))}),r}static fromJson(t,r){try{const s=new wn({});if(s.workerGender=br[t.workerGender]||ve.anonymous,s.customerName=t.customerName||"",s.note=t.note||"",s.bookingId=r,s.signOnDeviceCalendar=t.signOnDeviceCalendar||!1,s.userDeleted=t.userDeleted||!1,s.workerDeleted=t.workerDeleted||!1,s.customerId=t.customerId||t.customerPhone||"",s.workerPhone=t.workerPhone||"",s.customerPhone=t.customerPhone||"",s.recurrenceTimeId=t.recurrenceTimeId,s.workerId=t.workerId||t.workerPhone||"",s.adress=t.adress||"",t.shopIcon!=null&&(s.shopIcon=Oe.fromJson(t.shopIcon)),s.isVerifiedPhone=t.isVerifiedPhone||!1,s.customerId==s.customerPhone&&s.customerId.length==14&&(s.isVerifiedPhone=!0),s.isMultiRef=t.isMultiRef||!1,s.needCancel=t.needCancel||!1,t.lastTimeNotifyOnDebt!=null&&(s.lastTimeNotifyOnDebt=new Date(t.lastTimeNotifyOnDebt)),s.finishInvoices=t.finishInvoices||!1,t.remindersTypes!=null?Object.entries(t.remindersTypes).forEach(([i,o])=>{Ns[i]!=null&&s.remindersTypes.set(Ns[i],o)}):s.remindersTypes=new Map([Yt.regular,t.minutesBeforeNotify||60]),t.workerRemindersTypes!=null&&Object.entries(t.workerRemindersTypes).forEach(([i,o])=>{Ns[i]!=null&&s.workerRemindersTypes.set(Ns[i],o)}),s.clientMail=t.clientMail||"",t.recurrenceNotificationsLastDate!=null&&(s.recurrenceNotificationsLastDate=new Date(t.recurrenceNotificationsLastDate)),s.clientNote=t.clientNote||"",s.recurreneFatherDate=t.recurreneFatherDate,s.recurrenceRef=t.recurrenceRef,t.orderingOptions!=null&&(s.orderingOptions=Uw[t.orderingOptions]||pn.app),t.debts!=null&&Object.entries(t.debts).forEach(([i,o])=>{s.debts.set(i,_o.fromJson(o,i))}),t.cancelDate!=null&&(s.cancelDate=new Date(t.cancelDate)),s.wasWaiting=t.wasWaiting||!1,s.isUserExist=t.isUserExist||!0,t.invoices!=null&&Object.entries(t.invoices).forEach(([i,o])=>{s.invoices.set(i,ys.fromJson(o,i,s.workerId))}),t.userGender!=null&&(s.userGender=br[t.userGender]||ve.anonymous),s.status=Lw[t.status.toString()]||Ft.approved,s.confirmedArrival=t.confirmedArrival||!1,t.bookingDate!=null&&(s.bookingDate=new Date(t.bookingDate)||new Date(0)),t.treatments!=null){s.treatments=new Map;let i=0;Object.entries(t.treatments).forEach(([o,a])=>{const c=t.treatments[i.toString()];s.treatments.set(i.toString(),vn.fromJson(c,i.toString())),i+=1})}else if(t.treatment!=null){const i=vn.fromJson(t.treatment,"0");s.treatments.set("0",i)}return s.showAdressAlert=t.showAdressAlert||!1,s.showPhoneAlert=t.showPhoneAlert||!1,s.workerName=t.workerName||"",s.businessName=t.businessName||"",s.buisnessId=t.buisnessId||"",t.notificationType!=null?s.notificationType=Ww[t.notificationType]||K.push:t.withMessage?s.notificationType=K.message:s.notificationType=K.push,t.workerNotificationOption!=null&&(s.workerNotificationOption=Ll[t.workerNotificationOption]||We.PushOrSMS),t.userFcms!=null?t.userFcms.forEach(i=>{s.userFcms.add(i)}):t.deviceFCM!=null&&t.deviceFCM!=""&&(s.userFcms=new Set([t.deviceFCM])),t.createdAt!=null&&(s.createdAt=new Date(t.createdAt)||new Date(0)),t.RE!=null&&(s.recurrenceEvent=$n.fromJson(t.RE,s.bookingDate)),t.RERI!=null&&(s.recurrenceEventRefInfo=$n.fromJson(t.RERI)),s.transactions=new Map,t.transactions!=null&&Object.entries(t.transactions).forEach(([i,o])=>{s.transactions.set(i,qs.fromJson(o,i))}),t.paymentRequest!=null&&(s.paymentRequest=Uh.fromJson(t.paymentRequest)),s}catch(s){return Se.error(`Error loading booking doc ${r}: ${s}`),new wn({})}}get treatmentLength(){return Array.from(this.treatments.values()).reduce((t,r)=>r.count+t,0)}get canSendMessage(){return this.isVerifiedPhone||this.orderingOptions===pn.byWorker}get treatmentsToStringNotDetailed(){return this.treatmentLength===1?this.treatments.values().next().value.name:this.treatments.size===1?`${this.treatments.values().next().value.name}x${this.treatmentLength}`:`${this.treatments.values().next().value.name}+${this.treatmentLength-1}`}get isPassed(){if(this.recurrenceEvent!=null){if(this.recurrenceChildDate!=null)return qe(this.recurrenceChildDate,new ee({minutes:this.totalMinutes+2}))<new Date;const t=this.recurrenceEvent.endOfTheEvent;return t!=null&&t<G8(new Date)}else return qe(this.bookingDate,new ee({minutes:this.totalMinutes+2}))<new Date}get isRightNow(){return qe(this.recurrenceChildDate??this.bookingDate,new ee({minutes:this.totalMinutes}))>new Date&&(this.recurrenceChildDate??this.bookingDate)<new Date}get currentDisplayDate(){return this.recurrenceChildDate??this.bookingDate}get totalMinutes(){let t=0;return this.treatments.forEach((r,s)=>{t+=r.totalMinutesForBooking}),t}get customerHashPhone(){return ri(this.customerPhone)}get bookingWorkTimes(){const t=new Map;let r=this.bookingDate;return this.treatments.forEach((s,i)=>{Array.from({length:s.count}).forEach(()=>{s.times.forEach((o,a)=>{r=qe(r,new ee({minutes:o.breakMinutes})),t.set(Cn(r),o.workMinutes),r=qe(r,new ee({minutes:o.workMinutes}))})})}),t}get totalEventsCount(){let t=0;return Object.values(this.treatments).forEach(r=>{t+=r.times.length*r.count}),t}get invoicesCoverPrice(){const t=Object.values(this.invoices).reduce((r,s)=>r+s.amount,0);return this.finishInvoices||this.invoices.size>0&&t>=this.totalPrice.amount}get totalPrice(){let t=new Vt({amount:"0",currency:us});return Object.values(this.treatments).forEach(r=>{t.amount+=r.totalPriceForBooking,t.currency=r.price.currency}),t}get typesOfEvents(){const t=new Map;return this.recurrenceEvent!==null?new Map:(this.needCancel&&t.set(Vs.needCancel,1),this.debts.size>0&&t.set(Vs.withDebts,1),this.status===Ft.waiting&&t.set(Vs.onHold,1),t)}get remindersToFutureNotifications(){const t=[];for(const[r,s]of this.remindersTypes){const i=this.reminder(r);i!==null&&t.push(i)}return t}reminder(t){if(this.notificationType!==K.push)return null;const r=this.remindersTypes.get(t);if(r===void 0||r===0)return null;const s=xf(this,r);return s<new Date||this.userFcms.size===0?null:new ug({businessName:this.businessName,shopIcon:this.shopIcon,address:this.showAdressAlert?this.adress:"",isMulti:this.isMultiRef,isRecurrence:this.recurrenceEvent!==null||this.recurrenceRef!==null,id:this.reminderId(t),dateToNotify:s,phoneToContact:this.showPhoneAlert?_8(this.workerPhone):"",businessId:this.buisnessId,type:this.treatmentsToStringNotDetailed,minutesToAdd:this.utcDeltaMinutes()+r,totalEventMinutes:this.totalMinutes,fcms:{...this.userFcms}})}utcDeltaMinutes(){const t=new Date,r=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes());return Math.floor((Date.now()-r.getTime())/(60*1e3))}get remindersOnBooking(){const t={};return this.cancelDate!==null?{}:this.userFcms.size===0?{}:this.notificationType===K.message?{}:(this.remindersTypes.forEach((r,s)=>{var o;if(r<=0)return;const i=xf(this,r);i>=new Date&&(t[o=Ae(i)]??(t[o]={}),t[Ae(i)]={[this.reminderId(s)]:null})}),t)}get bookingsEventsAsJson(){const t=new Map;let r=this.bookingDate,s=this.totalEventsCount,i=0;return this.invoicesCoverPrice,this.treatments.forEach((o,a)=>{Array.from({length:o.count}).forEach(()=>{o.times.forEach((c,u)=>{r=qe(r,new ee({minutes:c.breakMinutes}));const l=this.recurrenceTimeId!=null&&this.recurrenceEvent!=null?`${Cn(r)}_${this.recurrenceTimeId}`:Cn(r),d=new hc;d.eventIndex=i,d.treatmentId=o.id,d.subTreatmentName=c.title,d.totalBookingMinutes=this.totalMinutes,d.belongTreatments=this.treatmentLength,d.onHold=this.status==="waiting",d.wantDelete=this.needCancel,d.ids=[this.workerId],d.confirmArrival=this.confirmedArrival,d.hasDebt=this.debts.size>0,d.timeId=this.recurrenceEvent!=null?this.recurrenceTimeId:void 0,d.treatmentName=o.name,d.transactionCounter=this.transactions.size,d.eventsBelong=s,d.isBreak=!1,d.partOfRecurrence=this.recurrenceRef!=null,d.hasInvoice,d.recurrenceEvent=this.recurrenceEvent,d.eventName=this.customerId,d.from=r,d.durationMinutes=c.workMinutes,d.colorIndex=o.colorIndex,t.set(l,d.toJson()),r=qe(r,new ee({minutes:c.workMinutes})),i+=1})})}),t}get monthStr(){return _s(this.bookingDate)}get toBookingReferencePaymentObj(){return new Vh({id:this.bookingId,isMultiBooking:!1,date:this.bookingDate,workerId:this.workerId})}async copyDataToOrder({user:t,worker:r,needToHoldOn:s,business:i,clientNoteText:o=""}){var c;this.customerName=t.name,this.customerId=t.id,this.customerPhone=t.phoneNumber,this.userGender=t.gender,this.isVerifiedPhone=t.isVerifiedPhone,this.clientMail=t.userPublicData.email;const a=t.userPublicData.clientAt;this.addToClientAt=!a.hasOwnProperty(i.businessId)||!((c=a.get(i.businessId))!=null&&c.has(r.id)),this.userFcms=t.fcmsTokens,this.isVerifiedPhone=t.isVerifiedPhone,this.orderingOptions=pn.web,this.adress=i.adress,this.clientNote=o,this.wasWaiting=!1,this.shopIcon=i.design.shopIconData,ad(this.bookingDate,new Date).inMinutes<60&&!s&&(this.confirmedArrival=!0),this.workerNotificationOption=r.notifications.notificationOption,this.workerRemindersTypes=new Map(r.notifications.remindersTypes);for(const[u,l]of r.notifications.remindersTypes)this.isPassed||u===Yt.confirmArrival&&this.confirmedArrival||(Qr(this.bookingDate,new ee({minutes:l}))<qe(new Date,new ee({seconds:1}))&&this.recurrenceEvent===void 0?(this.remindersTypes.set(u,this.remindersTypes.get(u)-this.remindersTypes.get(u)%5),this.remindersTypes.get(u)<10&&this.remindersTypes.delete(u)):this.remindersTypes.set(u,l));this.workerId=r.id,this.workerPhone=r.phone,this.workerName=r.name,this.workerGender=r.gender,this.showPhoneAlert=r.notifications.showPhoneAlert,this.showAdressAlert=r.notifications.showAdressAlert,this.businessName=i.shopName,this.bookingId=this.bookingId===""?Vv():this.bookingId,this.buisnessId=i.businessId,s?this.status=Ft.waiting:this.status=Ft.approved,this.notificationType=BT({booking:this,worker:r})}updateBookingByBooking({oldBooking:t,worker:r,needToHoldOn:s,business:i,newClientNote:o,keepRecurrence:a=!1}){if(this.customerName=t.customerName,this.customerPhone=t.customerPhone,this.userGender=t.userGender,this.clientMail=t.clientMail,this.customerId=t.customerId,this.note=t.note,t.treatments.size>this.treatments.size){const u=new Map;let l=0;for(const[d,f]of Object.entries(this.treatments))u.set(l.toString(),f),l+=1;this.treatments=u}const c=new Map([...t.treatments.entries()].sort((u,l)=>u[0].localeCompare(l[0])));t.treatments=c,t.customerPhone!=this.customerPhone?this.orderingOptions=pn.byWorker:this.orderingOptions=t.orderingOptions,o!=null?this.clientNote=o:this.clientNote=t.clientNote,this.workerNotificationOption=r.notifications.notificationOption,this.workerRemindersTypes=new Map(r.notifications.remindersTypes),r.notifications.remindersTypes.forEach((u,l)=>{Qr(this.bookingDate,new ee({minutes:u}))<qe(new Date,new ee({minutes:1}))&&(this.remindersTypes.set(l,Math.abs(Math.floor(ad(new Date,this.bookingDate).inMinutes/2))),this.remindersTypes.set(l,this.remindersTypes.get(l)-this.remindersTypes.get(l)%5),this.remindersTypes.get(l)<10&&this.remindersTypes.delete(l))}),this.debts={...t.debts},this.isUserExist=t.isUserExist,this.createdAt=t.createdAt,this.lastTimeNotifyOnDebt=t.lastTimeNotifyOnDebt,this.cancelDate=t.cancelDate,this.wasWaiting=t.wasWaiting,this.signOnDeviceCalendar=t.signOnDeviceCalendar,this.recurrenceEvent=void 0,this.recurrenceNotificationsLastDate=void 0,this.recurrenceTimeId=void 0,a||(this.recurrenceRef=void 0,this.recurreneFatherDate=void 0,this.recurrenceEventRefInfo=void 0),this.userDeleted=t.userDeleted,this.paymentRequest=t.paymentRequest,this.shopIcon=i.design.shopIconData,this.workerName=r.name,this.workerGender=r.gender,this.workerId=r.id,this.workerPhone=r.phone,this.showPhoneAlert=r.notifications.showPhoneAlert,this.showAdressAlert=r.notifications.showAdressAlert,this.adress=i.adress,this.invoices={...t.invoices},this.businessName=i.shopName,this.bookingId=t.bookingId===""||t.recurrenceEvent!=null?Vv():t.bookingId,this.buisnessId=t.buisnessId,this.notificationType=t.notificationType,this.bookingDate===t.bookingDate?this.status=t.status:this.status=s?Ft.waiting:Ft.approved,this.confirmedArrival=!1,s||ad(this.bookingDate,new Date).inMinutes<60&&(this.confirmedArrival=!0),this.needCancel=t.needCancel,this.finishInvoices=t.finishInvoices,this.transactions=new Map;for(const[u,l]of Object.entries(t.transactions))this.transactions.set(u,qs.fromTransaction(l))}sameTreatments(t){let r=!0;return this.treatmentLength!==t.treatmentLength?!1:(Object.entries(this.treatments).forEach(([s,i])=>{let o=!1;Object.entries(t.treatments).forEach(([a,c])=>{i.id===c.id&&i.count===c.count&&(o=!0)}),r=r&&o}),r)}get businessPayloadData(){return new lo({businessName:this.businessName,businessId:this.buisnessId,shopIcon:this.shopIcon})}get notificationTopic(){return new lc({date:sn(this.bookingDate),businessId:this.buisnessId,workerId:this.workerId,workerName:this.workerName})}get remindersToScheduleMessages(){const t=[];return this.remindersTypes.forEach((r,s)=>{const i=this.reminderMessage(s);i!=null&&t.push(i)}),t}reminderMessage(t){const r=this.remindersTypes.get(t);r==null||r===0||Qr(this.bookingDate,new ee({minutes:r}))<new Date}get toBookingNotificationPayload(){return new cg({businessId:this.buisnessId,id:this.bookingId,businessName:this.businessName,totalMinutes:this.totalMinutes,isRecurrence:this.recurrenceEvent!=null,date:this.bookingDate,workerId:this.workerId,shopIcon:this.shopIcon})}get transactionsTotalPaymentPrice(){let t=new Vt({amount:"0",currency:this.totalPrice.currency});for(const r of Object.values(this.transactions))r.type===hr.payment&&(t.amount+=r.amount);return t}get isDepositTransaction(){return Object.keys(this.transactions).length===1?Object.values(this.transactions)[0].type===hr.deposit:!1}get totalDebtAmount(){let t=0;for(const r of Object.values(this.debts))t+=r.amount;return t}get treatmentsToStringDetailed(){let t="";for(const r of Object.values(this.treatments))t+=r.nameForBooking+" + ";return t.length>0?t.substring(0,t.length-3):""}get priceInAdvance(){const t=new Vt({amount:"0",currency:us});for(const r of Object.values(this.treatments))t.amount+=r.amountInAdvanceForBooking,t.currency=r.price.currency;return t}get messageRemindersOnBooking(){const t=[];if(this.cancelDate!==null||this.userFcms.size===0||this.notificationType===K.push)return t;for(const[r,s]of this.remindersTypes){if(s<=0)continue;xf(this,s).toUTCString()>=new Date().toUTCString()&&t.push(this.reminderId(r))}return t}get invoiceItem(){return new InvoiceItem({code:0,information:this.treatmentsToStringDetailed,amountPerItem:this.totalPrice.amount,quantity:1})}get toPaymentRequestUser(){return new fi({name:this.customerName,userId:this.customerId,gender:this.userGender,isVerifiedPhone:this.isVerifiedPhone,isExist:this.isUserExist,phone:this.customerPhone})}get invoiceItems(){const t=new Map;let r=0;for(const s of Object.values(this.treatments)){let i=s.name;s.priceChangingNote!==null&&s.priceChangingNote!==""&&(i+=`: ${s.priceChangingNote}.`),Array.from({length:s.count},o=>{t.set(r,new InvoiceItem({code:r,information:i,amountPerItem:s.price.amount,quantity:1})),r++})}return t}get transactionsTotalDepositPrice(){let t=new Vt({amount:"0",currency:this.totalPrice.currency});for(const r of Object.values(this.transactions))r.type===hr.deposit&&(t.amount+=r.amount);return t}get transactionDepositLength(){let t=0;for(const r of Object.values(this.transactions))r.type===hr.deposit&&(t+=1);return t}get transactionPaymentLength(){let t=0;for(const r of Object.values(this.transactions))r.type===hr.payment&&(t+=1);return t}reminderId(t){return this.createdAt<FC?this.bookingId:`${this.bookingId}__${Ri[t]}`}get bookingsEventsAsEvents(){const t=new Map;let r=this.bookingDate,s=this.totalEventsCount,i=0;return this.invoicesCoverPrice,this.treatments.forEach((o,a)=>{Array.from({length:o.count}).forEach(()=>{o.times.forEach((c,u)=>{r=qe(r,new ee({minutes:c.breakMinutes}));const l=this.recurrenceTimeId!=null&&this.recurrenceEvent!=null?`${Cn(r)}_${this.recurrenceTimeId}`:Cn(r),d=new hc;d.eventIndex=i,d.treatmentId=o.id,d.subTreatmentName=c.title,d.totalBookingMinutes=this.totalMinutes,d.belongTreatments=this.treatmentLength,d.onHold=this.status==="waiting",d.wantDelete=this.needCancel,d.ids=[this.workerId],d.confirmArrival=this.confirmedArrival,d.hasDebt=this.debts.size>0,d.timeId=this.recurrenceEvent!=null?this.recurrenceTimeId:void 0,d.treatmentName=o.name,d.transactionCounter=this.transactions.size,d.eventsBelong=s,d.isBreak=!1,d.partOfRecurrence=this.recurrenceRef!=null,d.hasInvoice,d.recurrenceEvent=this.recurrenceEvent,d.eventName=this.customerId,d.from=r,d.durationMinutes=c.workMinutes,d.colorIndex=o.colorIndex,t.set(l,d),r=qe(r,new ee({minutes:c.workMinutes})),i+=1})})}),t}isTheSameAs({booking:t,customerId:r,note:s}){var o,a;let i=!0;if(this.treatments.size!==t.treatments.size)return!1;for(const[c,u]of this.treatments)if(((o=t.treatments.get(c))==null?void 0:o.id)!=u.id||((a=t.treatments.get(c))==null?void 0:a.count)!=u.count){i=!1;break}return i&&t.customerId===r&&t.clientNote===this.clientNote&&t.note===s&&this.bookingDate.getTime()===t.bookingDate.getTime()&&this.workerId===t.workerId}toJson(){const t={};return t.workerGender=Xi[this.workerGender],t.customerName=this.customerName,t.note=this.note,t.customerId=this.customerId,this.wasWaiting&&(t.wasWaiting=this.wasWaiting),this.workerDeleted&&(t.workerDeleted=this.workerDeleted),this.cancelDate!=null&&(t.cancelDate=this.cancelDate.toString()),t.remindersTypes={},this.remindersTypes.forEach((r,s)=>{t.remindersTypes[Ri[s]]=r}),t.workerRemindersTypes={},this.workerRemindersTypes.forEach((r,s)=>{t.workerRemindersTypes[Ri[s]]=r}),this.clientNote!=""&&(t.clientNote=this.clientNote),this.finishInvoices&&(t.finishInvoices=this.finishInvoices),this.debts.size>0&&(t.debts={},this.debts.forEach((r,s)=>{t.debts[s]=r.toJson()})),this.lastTimeNotifyOnDebt!=null&&(t.lastTimeNotifyOnDebt=this.lastTimeNotifyOnDebt.toString()),this.isVerifiedPhone&&(t.isVerifiedPhone=this.isVerifiedPhone),this.userDeleted&&(t.userDeleted=this.userDeleted),t.bookingId=this.bookingId,t.needCancel=this.needCancel,t.userGender=Xi[this.userGender],t.businessName=this.businessName,this.signOnDeviceCalendar&&(t.signOnDeviceCalendar=this.signOnDeviceCalendar),this.recurrenceTimeId!=null&&(t.recurrenceTimeId=this.recurrenceTimeId),t.treatments={},this.recurrenceRef!=null&&(t.recurrenceRef=this.recurrenceRef),this.recurreneFatherDate!=null&&(t.recurreneFatherDate=this.recurreneFatherDate),this.treatments.forEach((r,s)=>{t.treatments[s.toString()]=r.toJson()}),t.invoices={},this.invoices.forEach((r,s)=>{t.invoices[s]=r.toJson()}),this.isMultiRef&&(t.isMultiRef=this.isMultiRef),this.isUserExist||(t.isUserExist=this.isUserExist),this.orderingOptions!=pn.app&&(t.orderingOptions=Vw[this.orderingOptions]),this.showAdressAlert&&(t.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(t.showPhoneAlert=this.showPhoneAlert),this.adress!=""&&(t.adress=this.adress),this.clientMail!=""&&(t.clientMail=this.clientMail),t.customerPhone=this.customerPhone,t.status=Bw[this.status],t.confirmedArrival=this.confirmedArrival,t.bookingDate=Ae(this.bookingDate),t.workerId=this.workerId.toString(),t.workerName=this.workerName,t.buisnessId=this.buisnessId,t.shopIcon=this.shopIcon.toJson(),this.recurrenceNotificationsLastDate!=null&&(t.recurrenceNotificationsLastDate=this.recurrenceNotificationsLastDate.toString()),t.notificationType=$C[this.notificationType],t.workerNotificationOption=GC[this.workerNotificationOption],t.userFcms=Array.from(this.userFcms),t.createdAt=Ae(this.createdAt),this.recurrenceEvent!=null&&(t.RE=this.recurrenceEvent.toJson({})),this.recurrenceEventRefInfo!=null&&(t.RERI=this.recurrenceEventRefInfo.toJson({saveStartDate:!0,saveException:!1,saveEnd:!1})),t.transactions={},this.transactions.forEach((r,s)=>{t.transactions[s]=r.toJson()}),this.paymentRequest!=null&&(t.paymentRequest=this.paymentRequest.toJson()),t}}class dg extends Gc{constructor({businessId:e="",date:t,id:r="",workerId:s="",businessName:i="",shopIcon:o}={}){super({businessId:e,date:t,id:r,workerId:s,businessName:i,shopIcon:o})}static fromJsonStr(e){const t=JSON.parse(e),r=t.date?new Date(t.date):null,s=t.shopIcon?Oe.fromJsonStr(t.shopIcon):new Oe,i=new dg({businessId:t.businessId,date:r,id:t.id,workerId:t.workerId,businessName:t.businessName});return i.shopIcon=s,i}toJsonStr(){var t;const e={businessId:this.businessId,date:(t=this.date)==null?void 0:t.toString(),businessName:this.businessName,id:this.id,workerId:this.workerId,shopIcon:this.shopIcon.toJsonStr()};return JSON.stringify(e)}toString(){return this.toJsonStr()}}class fg{constructor(){h(this,"price",new Vt({amount:"0",currency:us}));h(this,"id","");h(this,"createdAt",new Date(0))}}class vo{constructor({masofNumber:e="",businessName:t="",adress:r="",businessId:s="",shopIcon:i,businessNumber:o=""}={}){h(this,"masofNumber","");h(this,"businessName","");h(this,"adress","");h(this,"businessNumber","");h(this,"businessId","");h(this,"shopIcon");this.masofNumber=e||"",this.businessName=t||"",this.adress=r||"",this.businessNumber=o||"",this.businessId=s||"",this.shopIcon=i}toJson(){const e={};return e.MN=this.masofNumber,this.shopIcon!==void 0&&(e.SI=this.shopIcon.toJson()),e.BNA=this.businessName,e.BID=this.businessId,e.A=this.adress,e.BNU=this.businessNumber,e}static fromJson(e){const t=e.SI!==void 0?Oe.fromJson(e.SI):void 0;return new vo({masofNumber:e.MN||"",businessName:e.BNA||"",businessId:e.BID||"",shopIcon:t,adress:e.A||"",businessNumber:e.BNU||""})}}class Uv{constructor(e=0){h(this,"amount");this.amount=e}addAmount(e){this.amount+=e}removeAmount(e){this.amount-=e}}class Dl{constructor(e,t,r,s,i,o){h(this,"accountNumber","");h(this,"bankBranch","");h(this,"bankNumber","");h(this,"checkNumber","");h(this,"amount",0);h(this,"repaymentDate",new Date(0));this.accountNumber=e,this.bankBranch=t,this.bankNumber=r,this.checkNumber=s,this.amount=i,this.repaymentDate=o}toJson(){const e={};return e.AN=this.accountNumber,e.BB=this.bankBranch,e.BN=this.bankNumber,e.CN=this.checkNumber,e.A=this.amount,e.RD=Ae(this.repaymentDate),e}static fromJson(e){return new Dl(e.AN||"",e.BB||"",e.BN||"",e.CN||"",e.A||0,new Date(e.RD||"1970-01-01T00:00:00.000Z"))}toString(){return JSON.stringify(this,null,2)}}class Al{constructor({amount:e=0,currency:t,onlinePayment:r,cash:s}={}){h(this,"checks",[]);h(this,"onlinePayment");h(this,"cash");h(this,"applicationPayments",[]);h(this,"amount",0);h(this,"currency");this.amount=e,this.currency=t,this.onlinePayment=r,this.cash=s}addCheck(e){this.checks.push(e),this.amount+=e.amount}removeCheck(e){const t=this.checks.indexOf(e);t!==-1&&(this.checks.splice(t,1),this.amount-=e.amount)}addCashAmount(e){this.cash||(this.cash=new Uv),this.cash.addAmount(e),this.amount+=e}removeCashAmount(e){this.cash&&(this.cash.removeAmount(e),this.amount-=e)}get cashAmount(){return this.cash?this.cash.amount:0}get allChecks(){return new MultipleChecks({checks:this.checks})}get allPaymentsAsChecks(){const e=new MultipleChecks({checks:this.checks});if(this.cash||this.applicationPayments.length>0){let t=0;this.cash&&(t+=this.cash.amount),this.applicationPayments.length>0&&this.applicationPayments.forEach(r=>{t+=r.amount}),e.addCheck(new Dl({accountNumber:"",bankBranch:"",bankNumber:"",checkNumber:"",amount:t,repaymentDate:new Date(0)}))}return e}toJson(){const e={};return this.checks.length>0&&(e.Ch=this.checks.map(t=>t.toJson())),this.applicationPayments.length>0&&(e.AP=this.applicationPayments.map(t=>t.toJson())),this.cash&&this.cash.amount>0&&(e.CA=this.cash.amount),this.onlinePayment&&(e.OP=this.onlinePayment.amount),e.A=this.amount,e.C=this.currency,e}static fromJson(e){const t=new Al;if(t.checks=[],e.Ch&&e.Ch.forEach(r=>{t.checks.push(Dl.fromJson(r))}),e.AP&&e.AP.forEach(r=>{t.applicationPayments.push(ApplicationPayment.fromJson(r))}),e.CA){const r=typeof e.CA=="number"?e.CA:parseFloat(e.CA);t.cash=new Uv({amount:r})}return e.OP&&(t.onlinePayment=new OnlinePayment({amount:e.OP})),e.A&&(t.amount=typeof e.A=="number"?e.A:parseFloat(e.A)),t.currency=e.C||"",t}}class mg extends fg{constructor({customerData:t,createdAt:r,paymentsMethods:s,items:i,businessInfo:o,workerInfo:a,invoiceNumber:c,invoiceId:u=""}){super();h(this,"customerData",new as({}));h(this,"invoiceNumber");h(this,"workerInfo",new InvoiceWorkerInfo);h(this,"businessInfo",new vo);h(this,"invoiceId","");h(this,"signature");h(this,"items",{});h(this,"paymentsMethods",new Al);this.customerData=t,this.createdAt=r,this.paymentsMethods=s,this.items=i,this.businessInfo=o,this.workerInfo=a,this.invoiceNumber=c,this.invoiceId=u||"",this.price=new Vt({amount:this.paymentsMethods.amount.toString(),currency:ey[this.paymentsMethods.currency??""]||us})}get itemsAsString(){let t="";for(const r in this.items)t+=this.items[r].toItemFormat();return t}get itemsTotalAmount(){let t=0;for(const r in this.items)t+=this.items[r].totalAmount;return t}get toBookingInvoiceData(){return new ys({issuedBy:this.workerInfo.workerId,docId:this.getInvoiceDocIndexByDate(this.createdAt).toString(),monthStr:_s(this.createdAt),invoiceId:this.invoiceId,amount:this.paymentsMethods.amount})}getInvoiceDocIndexByDate(t){return(parseInt(O0(t),10)||0)>16?2:1}static fromJson(t,r){const s=new mg({});return s.invoiceId=r,t.CD!==void 0&&(s.customerData=as.fromMinimalJson(t.CD)),t.RD!==void 0&&(s.createdAt=new Date(t.RD)),t.BI!==void 0&&(s.businessInfo=vo.fromJson(t.BI)),t.WIN!==void 0&&(s.workerInfo=InvoiceWorkerInfo.fromJson(t.WIN)),s.items={},Object.entries(t.I).forEach(([i,o])=>{s.items[parseInt(i,10)]=InvoiceItem.fromJson(o,parseInt(i,10))}),t.PM!==void 0&&(s.paymentsMethods=Al.fromJson(t.PM)),t.IN!==void 0&&(s.invoiceNumber=parseInt(t.IN,10)),s.price=new Vt({amount:s.paymentsMethods.amount.toString(),currency:ey[s.paymentsMethods.currency??""]||us}),s.signature=t.Sig,s}toJson(){const t={};this.invoiceNumber!==void 0&&(t.IN=this.invoiceNumber.toString()),this.signature!==void 0&&(t.Sig=this.signature),t.BI=this.businessInfo.toJson(),t.WIN=this.workerInfo.toJson(),t.RD=Ae(this.createdAt),t.CD=this.customerData.toMinimalJson(),t.I={};for(const r in this.items)t.I[r]=this.items[r].toJson();return t.PM=this.paymentsMethods.toJson(),t}get customerHashPhone(){return ri(this.customerData.phoneNumber)}get customerPhoneAsCollection(){return this.customerData.phoneNumber.replace(/-/g,"")}get bookingInvoiceData(){return new ys({docId:this.docId.toString(),amount:this.paymentsMethods.amount,monthStr:_s(this.createdAt),issuedBy:this.workerInfo.workerId,invoiceId:this.invoiceId})}get link(){let t="";return this.signature===void 0?"":(this.invoiceNumber!==void 0&&(t=YC.replace("MASOFNUMBER",this.businessInfo.masofNumber).replace("INVOICENUMBER",this.invoiceNumber.toString()).replace("SIGNATURE",this.signature)),t)}get toInvoiceNoticaficationPayload(){return new dg({businessId:this.businessInfo.businessId,businessName:this.businessInfo.businessName,date:this.createdAt,id:this.invoiceId})}get docId(){return(parseInt(O0(this.createdAt),10)||0)>16?2:1}toString(){return JSON.stringify(this,null,2)}}class Wh extends Gc{constructor({businessId:e,date:t,id:r,workerId:s,businessName:i,shopIcon:o}){super({businessId:e,date:t,id:r,workerId:s,businessName:i})}static fromJsonStr(e){const t=JSON.parse(e),r=t.businessId||"",s=t.businessName||"",i=t.date?new Date(t.date):void 0,o=t.workerId||"",a=t.id||"",c=t.shopIcon?Oe.fromJsonStr(t.shopIcon):void 0;return new Wh({businessId:r,date:i,id:a,workerId:o,businessName:s,shopIcon:c})}toJsonStr(){var t;const e={};return e.businessId=this.businessId,this.date!==void 0&&(e.date=Ae(this.date)),e.businessName=this.businessName,e.id=this.id,e.workerId=this.workerId,e.shopIcon=((t=this.shopIcon)==null?void 0:t.toJsonStr())||null,JSON.stringify(e)}toString(){return this.toJsonStr()}}class fc extends fg{constructor({id:t,price:r,createdAt:s,summary:i="",businessName:o,shopIcon:a,oneTime:c=!1,closeForAll:u=!1,workerName:l,workerId:d,businessId:f}){super();h(this,"id","");h(this,"summary","");h(this,"workerId","");h(this,"businessName","");h(this,"workerName","");h(this,"businessId");h(this,"multi",!1);h(this,"closeForAll",!0);h(this,"users",{});h(this,"oneTime",!0);h(this,"userPayments",{});h(this,"userDecline",!1);h(this,"canceled",!1);h(this,"bookingReference");h(this,"shopIcon",new Oe);this.id=t,this.price=r,this.createdAt=s,this.summary=i,this.workerId=d,this.businessId=f,this.businessName=o,this.workerName=l,this.users={},this.closeForAll=u,this.oneTime=c,this.bookingReference=void 0,this.shopIcon=new Oe}static empty(){return new fc({})}get link(){return`https://${lg}/${hg}`.replaceAll("PAYMENT_ID",this.id)}get payers(){let t=0;return Object.values(this.users).forEach(r=>{t+=Object.keys(r.payments).length}),t}get docId(){return _s(this.createdAt)}toPaymentRequest(t,r){const s=new Hh({id:this.id,price:this.price,oneTime:this.oneTime,shopIcon:this.shopIcon,multi:Object.keys(this.users).length>1,workerInfo:t,businessInfo:r,summary:this.summary,closeForAll:this.closeForAll});return s.createdAt=this.createdAt,s}get toPaymentRequestNotificationPayload(){return new Wh({businessId:this.businessId,businessName:this.businessName,id:this.id,date:this.createdAt,workerId:this.workerId,shopIcon:this.shopIcon})}static fromJson(t,r){const s=new fc({});return s.id=r,t.price!=null&&(s.price=Vt.fromJson(t.price)),s.closeForAll=t.closeForAll??!0,s.summary=t.summary??"",t.shopIcon!=null&&(s.shopIcon=Oe.fromJson(t.shopIcon)),t.createdAt!=null&&(s.createdAt=new Date(t.createdAt)??new Date(0)),s.oneTime=t.oneTime??!0,s.businessName=t.businessName??"",s.workerId=t.workerId??"",s.businessId=t.businessId??"",s.workerName=t.workerName??"",s.users={},t.users!=null&&Object.entries(t.users).forEach(([i,o])=>{s.users[i]=fi.fromJson(o,i)}),t.bookingReference!=null&&(s.bookingReference=Vh.fromJson(t.bookingReference)),s}toJson(){const t={};return this.createdAt!=new Date(0)&&(t.createdAt=this.createdAt.toString()),this.summary!==""&&(t.summary=this.summary),this.oneTime||(t.oneTime=this.oneTime),this.closeForAll||(t.closeForAll=this.closeForAll),t.price=this.price.toJson(),t.workerId=this.workerId,t.businessName=this.businessName,t.businessId=this.businessId,t.workerName=this.workerName,Object.keys(this.users).length>0&&(t.users={},Object.entries(this.users).forEach(([r,s])=>{t.users[r]=s.toJson()})),this.bookingReference!=null&&(t.bookingReference=this.bookingReference.toJson()),t.shopIcon=this.shopIcon.toJson(),t}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class Hh extends fg{constructor({id:t,price:r,createdAt:s,summary:i="",multi:o=!1,userDecline:a=!1,canceled:c=!1,oneTime:u,shopIcon:l,closeForAll:d,workerInfo:f,businessInfo:m}){super();h(this,"id","");h(this,"summary","");h(this,"workerInfo",new InvoiceWorkerInfo);h(this,"businessInfo",new vo);h(this,"payers",0);h(this,"multi",!1);h(this,"closeForAll",!0);h(this,"users",{});h(this,"oneTime",!0);h(this,"userPayments",{});h(this,"userDecline",!1);h(this,"canceled",!1);h(this,"shopIcon",new Oe);this.price=r,this.createdAt=s,this.id=t,this.summary=i,this.multi=o,this.userDecline=a,this.canceled=c,this.oneTime=u,this.shopIcon=l,this.closeForAll=d,this.workerInfo=f,this.businessInfo=m}get link(){return`https://${lg}/${hg}`.replace("PAYMENT_ID",this.id)}get toPaymentRequestPreview(){const t=new fc({id:this.id,businessName:this.businessInfo.businessName,shopIcon:this.shopIcon,businessId:this.businessInfo.businessId,workerId:this.workerInfo.workerId,price:this.price,oneTime:this.oneTime,workerName:this.workerInfo.workerName,summary:this.summary,closeForAll:this.closeForAll});return t.users=this.users,t.createdAt=this.createdAt,t}get toPaymentRequestNotificationPayload(){const t=new Wh({businessId:this.businessInfo.businessId,id:this.id,businessName:this.businessInfo.businessName,date:this.createdAt,workerId:this.workerInfo.workerId,shopIcon:this.shopIcon});return t.shopIcon=this.shopIcon,t}get businessPayloadData(){return new lo({businessName:this.businessInfo.businessName,businessId:this.businessInfo.businessId,shopIcon:this.shopIcon})}get docId(){return _s(this.createdAt)}get toBookingPaymentRequestData(){const t=new Uh({});return t.createdAt=this.createdAt,t.id=this.id,t.workerId=this.workerInfo.workerId,t}get userPay(){return Object.keys(this.userPayments).length>0}static fromJson(t,r){const s=new Hh({});return s.id=r,t.businessInfo!=null&&(s.businessInfo=vo.fromJson(t.businessInfo)),s.closeForAll=t.closeForAll??!0,t.workerInfo!=null&&(s.workerInfo=InvoiceWorkerInfo.fromJson(t.workerInfo)),t.shopIcon!=null&&(s.shopIcon=Oe.fromJson(t.shopIcon)),s.canceled=t.canceled??!1,s.oneTime=t.oneTime??!0,t.price!=null&&(s.price=Vt.fromJson(t.price)),s.multi=t.multi??!1,s.userDecline=t.userDecline??!1,t.userPayments!=null&&typeof t.userPayments=="object"&&Object.entries(t.userPayments).forEach(([i,o])=>{s.userPayments[i]=o!=null?new Date(o):new Date(0)}),s.summary=t.summary??"",t.createdAt!=null&&(s.createdAt=t.createdAt!=null?new Date(t.createdAt):new Date(0)),s.payers=t.payers??0,s}toJson(){const t={};return this.createdAt!=null&&this.createdAt.getTime()!==new Date(0).getTime()&&(t.createdAt=Ae(this.createdAt)),this.oneTime||(t.oneTime=this.oneTime),this.canceled&&(t.canceled=this.canceled),this.summary!==""&&(t.summary=this.summary),this.closeForAll||(t.closeForAll=this.closeForAll),Object.keys(this.userPayments).length>0&&(t.userPayments={},Object.entries(this.userPayments).forEach(([r,s])=>{t.userPayments[r]=Ae(s)})),this.payers>0&&(t.payers=this.payers),this.userDecline&&(t.userDecline=this.userDecline),this.multi&&(t.multi=this.multi),t.price=this.price.toJson(),t.workerInfo=this.workerInfo.toJson(),t.businessInfo=this.businessInfo.toJson(),t.shopIcon=this.shopIcon.toJson(),t}toString(){return JSON.stringify(this,null,"  ")}}class Q8{constructor(){h(this,"bookings",{});h(this,"invoices",{});h(this,"paymentsRequests",{});h(this,"clientAt",{})}get isEmpty(){return this.bookingCount===0&&this.invoicesCount===0&&this.paymentsRequestCount===0}get bookingCount(){let e=0;for(const t of Object.values(this.bookings))e+=Object.keys(t).length;return e}get invoicesCount(){let e=0;for(const t of Object.values(this.invoices))e+=Object.keys(t).length;return e}get paymentsRequestCount(){let e=0;for(const t of Object.values(this.paymentsRequests))e+=Object.keys(t).length;return e}get clientAtJson(){const e={};for(const[t,r]of Object.entries(this.clientAt)){e[t]={};for(const s of r)e[t][s]=""}return e}get bookingsJson(){const e={};for(const[t,r]of Object.entries(this.bookings)){e[t]={};for(const[s,i]of Object.entries(r))e[t][s]=i.toJson()}return e}get invoicesJson(){const e={};for(const[t,r]of Object.entries(this.invoices)){e[t]={};for(const[s,i]of Object.entries(r))e[t][s]=i.toJson()}return e}get paymentRequestJson(){const e={};for(const[t,r]of Object.entries(this.paymentsRequests)){e[t]={};for(const[s,i]of Object.entries(r))e[t][s]=i.toJson()}return e}get bookingsPreviewsJson(){const e={};for(const[t,r]of Object.entries(this.bookings)){const s=new Lh({});for(const[i,o]of Object.entries(r))o.cancelDate===null&&(s.bookingCount=s.bookingCount+1);s.lastUpdateTime=new Date,e[t]=s.toJson()}return e}get whatWeFoundStr(){let e=z("weFound");const t=[];return this.bookingCount>0&&t.push(z("foundBookings").replace("COUNTER",this.bookingCount.toString())),this.invoicesCount>0&&t.push(z("foundInvoices").replace("COUNTER",this.invoicesCount.toString())),this.paymentsRequestCount>0&&t.push(z("foundPaymentsRequests").replace("COUNTER",this.paymentsRequestCount.toString())),t.forEach((r,s)=>{if(s===0){e+=r;return}if(s===t.length-1){e+=" ",e+=z("and")+r;return}e+=", "+r}),e+=", "+z("thatAutoMaticllyAdded"),e}}class K8{constructor(){h(this,"_db");Y0().length===0?Fl(U0):Do(),this._db=T3()}async getChild({childPath:e}){try{const t=Ts(this._db,`${Ke}/${e}`);return await m3(t)}catch(t){throw t}}async updateChild({childPath:e,data:t}){try{const r=Ts(this._db,`${Ke}/${e}`);return await Pd(r,t),!0}catch{return!1}}async removeChild({childPath:e}){try{const t=Ts(this._db,`${Ke}/${e}`);return await f3(t),!0}catch{return!1}}async incrementNumberChild({childPath:e,valueId:t,delta:r,command:s}){try{s===ma.decrement&&(r=-r);const i={[t]:Q_(r)},o=Ts(this._db,`${Ke}/${e}`);return await Pd(o,i),!0}catch{return!1}}async incrementMultipleNumberChild({childPath:e,data:t}){try{const r={};for(const[i,o]of Object.entries(t))r[i]=Q_(o);const s=Ts(this._db,`${Ke}/${e}`);return await Pd(s,r),!0}catch{return!1}}listenToChild({childPath:e,callback:t}){const r=Ts(this._db,`${Ke}/${e}`);return g3(r,t)}async setChild({childPath:e,data:t}){try{const r=Ts(this._db,`${Ke}/${e}`);return await ST(r,t),!0}catch{return!1}}}class j8 extends K8{constructor(){Y0().length===0?Fl(U0):Do();super();h(this,"_firestore");this._firestore=q2()}get getBatch(){return uF(this._firestore)}async getDocSRV({path:t,docId:r,insideEnviroments:s=!0}){try{const i=Nt(this._firestore,s?`${Ke}/${t}`:t),o=jt(i,r);return await eF(o)}catch(i){throw i instanceof Error&&(Se.error(i.message),_e.GI().addError({error:re.serverError,details:i.message})),i}}async getAllDocsInsideCollection(t){try{const r=Nt(this._firestore,`${Ke}/${t}`);return(await l_(r)).docs.map(i=>i.data())}catch(r){if(r instanceof Error)throw _e.GI().addError({error:re.serverError,details:r.toString()}),r;return[]}}async commmitBatch(t){try{return await t.commit(),!0}catch(r){throw Se.error("Error while commit batch -->",r),r instanceof Error&&_e.GI().addError({error:re.serverError,details:r.toString()}),new Error(`Server Error: ${r}`)}}async runTransaction(t){try{return await oF(this._firestore,async s=>{try{return await t(s)}catch(i){return i instanceof Error&&(Se.error(`Error while run transaction -> ${i} ${i.stack}`),_e.GI().addError({error:re.serverError,details:i.toString()})),!1}})}catch(r){throw console.error("Error while run transaction -->",r),r instanceof Error&&_e.GI().addError({error:re.serverError,details:r.toString()}),new Error(`Server Error: ${r}`)}}async transactionGet(t,r,s){try{const i=Nt(this._firestore,`${Ke}/${r}`),o=jt(i,s);return await t.get(o)}catch(i){throw console.error("Error while getting document in transaction -->",i),i instanceof Error&&_e.GI().addError({error:re.serverError,details:i.toString()}),new Error(`Server Error: ${i}`)}}async transactionUpdateAsMap({transaction:t,path:r,docId:s,fieldName:i,value:o}){try{const a=Nt(this._firestore,`${Ke}/${r}`),c=jt(a,s),u={[i]:o||Id()};t.update(c,u)}catch(a){throw Se.error("Error while updating document in transaction -->",a),a instanceof Error&&_e.GI().addError({error:re.serverError,details:a.toString()}),new Error(`Server Error: ${a}`)}}async setAsMap({batch:t,path:r,docId:s,data:i,insideEnviroments:o=!0}){try{const a=Nt(this._firestore,o?`${Ke}/${r}`:r),c=jt(a,s);t.set(c,i,{merge:!0})}catch(a){throw a instanceof Error&&_e.GI().addError({error:re.serverError,details:a.toString()}),a}}async getAllDocsAndIdsInsideCollection({path:t}){try{const r=Nt(this._firestore,`$envKey/${t}`),s=await l_(r),i={};return s.docs.forEach(o=>{i[o.id]=o.data()}),i}catch(r){throw r instanceof Error&&_e.GI().addError({error:re.serverError,details:r.toString()}),r}}async transactionUpdateMultipleFieldsAsMap({transaction:t,path:r,docId:s,data:i,insideEnvironments:o=!0}){try{const a=Nt(this._firestore,o?`${Ke}/${r}`:r),c=jt(a,s),u=this.organizeData(i);t.update(c,u)}catch(a){throw console.error("Error while updating multiple fields in transaction -->",a),a instanceof Error&&_e.GI().addError({error:re.serverError,details:a.toString()}),new Error(`Server Error: ${a}`)}}async transactionCreateDoc({transaction:t,path:r,docId:s,value:i}){try{const o=Nt(this._firestore,`${Ke}/${r}`),a=jt(o,s);t.set(a,i)}catch(o){throw Se.error("Error while creating document in transaction -->",o),o instanceof Error&&_e.GI().addError({error:re.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async transactionSetAsMap({transaction:t,path:r,docId:s,data:i}){try{const o=Nt(this._firestore,`${Ke}/${r}`),a=jt(o,s),c=this.organizeData(i);console.log(c),t.set(a,c,{merge:!0})}catch(o){throw Se.error("Error while setting document as map in transaction -->",o),o instanceof Error&&_e.GI().addError({error:re.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async deleteDoc({batch:t,path:r,docId:s}){try{const i=Nt(this._firestore,`${Ke}/${r}`),o=jt(i,s);t.delete(o)}catch(i){throw i instanceof Error&&_e.GI().addError({error:re.serverError,details:i.toString()}),i}}async setDoc({batch:t,path:r,docId:s,valueToSet:i,insideEnviroments:o=!0}){try{const a=Nt(this._firestore,o?`${Ke}/${r}`:r),c=jt(a,s);t.set(c,i)}catch(a){throw a instanceof Error&&_e.GI().addError({error:re.serverError,details:a.toString()}),a}}async createDoc({batch:t,path:r,docId:s,valueAsJson:i,insideEnviroments:o=!0,mergeIfExist:a=!1}){try{const c=Nt(this._firestore,o?`${Ke}/${r}`:r),u=jt(c,s);t.set(u,i,{merge:a})}catch(c){throw c instanceof Error&&_e.GI().addError({error:re.serverError,details:c.toString()}),c}}async updateFieldInsideDocAsMap({batch:t,path:r,docId:s,value:i,fieldName:o,command:a,insideEnviroments:c=!0}){try{const u=Nt(this._firestore,c?`${Ke}/${r}`:r),l=jt(u,s);a===void 0?t.update(l,{[o]:i??Id()}):t.update(l,{[o]:a===ma.increment?hu(1):hu(-1)})}catch(u){throw u instanceof Error&&_e.GI().addError({error:re.serverError,details:u.toString()}),u}}async updateMultipleFieldsInsideDocAsMap({batch:t,path:r,docId:s,data:i,insideEnviroments:o=!0}){try{const a=Nt(this._firestore,o?`${Ke}/${r}`:r),c=jt(a,s);t.update(c,this.organizeData(i))}catch(a){throw Se.error("Error while updating the batch -->",a),a instanceof Error&&_e.GI().addError({error:re.serverError,details:a.toString()}),new Error(`Server Error: ${a}`)}}updateFieldInsideDocAsArray({batch:t,path:r,docId:s,fieldName:i,value:o,command:a=Ff.add}){try{const c=Nt(this._firestore,`${Ke}/${r}`),u=jt(c,s);t.update(u,{[i]:a===Ff.remove?cF([o]):aF([o])})}catch(c){throw c instanceof Error&&_e.GI().addError({error:re.serverError,details:c.toString()}),new Error(`Server Error: ${c}`)}}docListener({path:t,docId:r,onChanged:s}){try{const i=Nt(this._firestore,`${Ke}/${t}`),o=jt(i,r);return tF(o,s)}catch(i){throw i instanceof Error&&_e.GI().addError({error:re.serverError,details:i.message}),i}}organizeData(t){var r={};return Object.entries(t).forEach(([s,i])=>{let o=i;o===void 0&&(o=Id()),o===ma.increment&&(o=hu(1)),o===ma.decrement&&(o=hu(-1)),r[s]=o}),r}get currentTimestamp(){return Fe.now()}}class YT extends j8{constructor(){super()}async getDocRepo({path:e,docId:t,insideEnviroments:r=!0}){return await super.getDocSRV({path:e,docId:t,insideEnviroments:r})}async createDocRepo({path:e,docId:t,valueAsJson:r,insideEnviroments:s=!0,mergeIfExist:i=!1}){const o=this.getBatch;return super.createDoc({batch:o,path:e,docId:t,valueAsJson:r,insideEnviroments:s,mergeIfExist:i}),await this.commmitBatch(o)}async updateFieldInsideDocAsArrayRepo({path:e,docId:t,fieldName:r,value:s,command:i}){const o=this.getBatch;return super.updateFieldInsideDocAsArray({batch:o,path:e,docId:t,fieldName:r,value:s,command:i}),await this.commmitBatch(o)}async updateFieldInsideDocAsMapRepo({path:e,docId:t,fieldName:r,value:s,insideEnviroments:i=!0,command:o=null}){const a=this.getBatch;return this.updateFieldInsideDocAsMap({batch:a,path:e,docId:t,fieldName:r,value:s,command:o,insideEnviroments:i}),await this.commmitBatch(a)}async updateMultipleFieldsInsideDocAsMapRepo({path:e,docId:t,data:r,insideEnviroments:s=!0}){const i=this.getBatch;return super.updateMultipleFieldsInsideDocAsMap({batch:i,path:e,docId:t,data:r,insideEnviroments:s}),await this.commmitBatch(i)}async deleteDocRepo({path:e,docId:t}){const r=this.getBatch;return super.deleteDoc({batch:r,path:e,docId:t}),await this.commmitBatch(r)}async setDocRepo({path:e,docId:t,valueAsJson:r,insideEnviroments:s=!0}){const i=this.getBatch;return super.setDoc({batch:i,path:e,docId:t,valueToSet:r,insideEnviroments:s}),await this.commmitBatch(i)}async setAsMapWithMergeRepo({path:e,docId:t,valueAsJson:r,insideEnviroments:s=!0}){const i=this.getBatch;return super.setAsMap({batch:i,path:e,docId:t,data:r,insideEnviroments:s}),await this.commmitBatch(i)}docListenerRepo({path:e,docId:t,onChanged:r}){return super.docListener({path:e,docId:t,onChanged:r})}async getWorkerFromTransactionRepo({transaction:e,workerId:t,businessModel:r,needMultiDoc:s=!1}){const i=`${Tt}/${Bt.currentBusinesssId}/${tn}`,o=await this.transactionGet(e,i,t);if(!o.exists())return;const a=uc.fromWorkerDocJson(o.data());return await super.transactionGet(e,`${i}/${t}/${lt}`,en).then(c=>{c.exists()&&a.workerPublicData.setWorkerPublicData(c.data())}),a.hasRecurrenceEvents&&a.isCustomersNeedRecurrence&&await super.transactionGet(e,`${i}/${t}/${lt}`,Mw).then(c=>{c.exists()&&c.data()!=null&&a.recurrence.setRecurrenceEvents(c.data(),t,r??ni.empty())}),s&&await super.transactionGet(e,`${i}/${t}/${lt}`,Fw).then(c=>{c.exists()&&a.multiEventsTimes.setData(c.data())}),a}toFormatedCustomerData({amountOfBookingsCommand:e,useUserFirstBookingsDate:t=!1,saveExtraData:r=!1}){return{}}async realTimeEventsCounterHandler({businessId:e,workerId:t,types:r,increment:s}){if(r.size===0)return!0;const i=Fa.GI().getWorkerCountersPath(e,t),o={};return r.forEach((a,c)=>{sy[c]!==null&&a!==0&&(o[sy[c]]=(s?1:-1)*a)}),Object.keys(o).length===0?!0:await this.incrementMultipleNumberChild({childPath:i,data:o})}}class X8 extends YT{constructor(){super()}async updatePublicUserField({userId:e,businessesIds:t,fieldName:r,cangeUserDoc:s=!0,value:i}){console.log(i);const o=this.getBatch;return s&&this.updateFieldInsideDocAsMap({batch:o,path:Zt,docId:e,fieldName:r,value:i}),this.updateFieldInsideDocAsMap({batch:o,path:`${Zt}/${e}/${lt}`,docId:en,fieldName:r,value:i}),t.forEach(a=>{this.updateFieldInsideDocAsMap({batch:o,path:`${Tt}/${a}/${tn}`,docId:e,fieldName:r,value:i})}),await this.commmitBatch(o)}async updatePublicUserFields({userId:e,businessesIds:t,cangeUserDoc:r=!0,dataForWorker:s,data:i}){const o=this.getBatch;return r&&this.updateMultipleFieldsInsideDocAsMap({batch:o,path:Zt,docId:e,data:i}),this.updateMultipleFieldsInsideDocAsMap({batch:o,path:`${Zt}/${e}/${lt}`,docId:en,data:i}),t.forEach(a=>{this.updateMultipleFieldsInsideDocAsMap({batch:o,path:`${Tt}/${a}/${tn}`,docId:e,data:s||i})}),await this.commmitBatch(o)}async createUser({user:e}){const t=this.getBatch;return this.createDoc({batch:t,path:Zt,docId:e.id,valueAsJson:e.toUserDocJson()}),this.setAsMap({batch:t,path:`${Zt}/${e.id}/${lt}`,docId:en,data:e.userPublicData.toJson()}),await this.commmitBatch(t)}async mergePhoneDataWithUser({phone:e,userId:t,name:r}){const s=new Q8,i=ri(e),o=e.replaceAll("-",""),a=async c=>{const u=await this.transactionGet(c,Fn,i);if(u.exists()&&u.data().userId!=t)return _e.GI().error=re.alreadyExistPhone,!1;const l=await this.transactionGet(c,`${Fn}/${i}/${o}`,Jg);l.exists()&&l.data()!=null&&Object.entries(l.data().clientAt).forEach(([p,y])=>{Object.keys(y).length!==0&&(s.clientAt[p]=new Set,Object.entries(y).forEach(([g,x])=>{s.clientAt[p].add(g)}))});const d=await this.getAllDocsAndIdsInsideCollection({path:`${Fn}/${i}/${o}/${yi}/${fa}`});Object.entries(d).forEach(([p,y])=>{var g;(g=s.bookings)[p]??(g[p]={}),Object.entries(y).forEach(([x,_])=>{const v=wn.fromJson(_,x);v.customerId=t,v.isUserExist=!0,s.bookings[p][x]=v})});const f=await this.getAllDocsAndIdsInsideCollection({path:`${Fn}/${i}/${o}/${yi}/${sd}`});Object.entries(f).forEach(([p,y])=>{var g;(g=s.invoices)[p]??(g[p]={}),Object.entries(y).forEach(([x,_])=>{const v=mg.fromJson(_,x);s.invoices[p][x]=v})});const m=await this.getAllDocsAndIdsInsideCollection({path:`${Fn}/${i}/${o}/${yi}/${id}`});return Object.entries(m).forEach(([p,y])=>{var g;(g=s.paymentsRequests)[p]??(g[p]={}),Object.entries(y).forEach(([x,_])=>{const v=Hh.fromJson(_,x);s.paymentsRequests[p][x]=v})}),(s.clientAt.isNotEmpty||s.bookingCount>0)&&this.transactionSetAsMap({transaction:c,path:`${Zt}/${t}/${lt}`,docId:en,data:{clientAt:s.clientAtJson,bookingsPreviews:s.bookingsPreviewsJson}}),this.transactionCreateDoc({transaction:c,path:Fn,docId:ri(e),value:{userId:t,name:r}}),Object.entries(s.bookingsJson).forEach(([p,y])=>{this.transactionSetAsMap({transaction:c,path:`${Zt}/${t}/${lt}/${en}/${fa}`,docId:p,data:y})}),Object.entries(s.invoicesJson).forEach(([p,y])=>{this.transactionSetAsMap({transaction:c,path:`${Zt}/${t}/${lt}/${en}/${sd}`,docId:p,data:y})}),Object.entries(s.paymentRequestJson).forEach(([p,y])=>{this.transactionSetAsMap({transaction:c,path:`${Zt}/${t}/${lt}/${en}/${id}`,docId:p,data:y})}),!0};return await this.runTransaction(a).then(async c=>{if(c){const u=[];return s.clientAt.isNotEmpty&&u.push(this.deleteDoc({batch:this.getBatch,path:`${Fn}/${i}/${o}`,docId:Jg})),Object.entries(s.invoices).forEach(([l,d])=>{u.push(this.deleteDoc({batch:this.getBatch,path:`${Fn}/${i}/${o}/${yi}/${sd}`,docId:l}))}),Object.entries(s.paymentsRequests).forEach(([l,d])=>{u.push(this.deleteDoc({batch:this.getBatch,path:`${Fn}/${i}/${o}/${yi}/${id}`,docId:l}))}),Object.entries(s.bookings).forEach(([l,d])=>{u.push(this.deleteDoc({batch:this.getBatch,path:`${Fn}/${i}/${o}/${yi}/${fa}`,docId:l}))}),s.bookings.isNotEmpty&&Object.entries(s.bookings).forEach(([l,d])=>{Object.entries(d).forEach(([f,m])=>{u.push(this.updateMultipleFieldsInsideDocAsMapRepo({path:`${Tt}/${m.buisnessId}/${tn}/${m.workerId}/${lt}/${en}/${Nw}`,docId:sn(m.bookingDate),data:m.isMultiRef?{[`${Cn(m.bookingDate)}.users.${f}.customerId`]:t,[`${Cn(m.bookingDate)}.users.${f}.isUserExist`]:!0,[`${Cn(m.bookingDate)}.users.${f}.isVerifiedPhone`]:!0}:{[`${f}.customerId`]:t,[`${f}.isUserExist`]:!0,[`${f}.isVerifiedPhone`]:!0}}))})}),s.paymentsRequests.isNotEmpty&&Object.entries(s.paymentsRequests).forEach(([l,d])=>{Object.entries(d).forEach(([f,m])=>{u.push(new Promise(async()=>{const p=await this.getDocSRV({path:Gg,docId:f});if(p.data()===void 0||!p.exists())return;const g=fc.fromJson(p.data(),f).users[e];g!=null&&(g.isExist=!0,g.isVerifiedPhone=!0,g.userId=t,await this.updateMultipleFieldsInsideDocAsMapRepo({path:Gg,docId:f,data:{[`users.${e}`]:void 0,[`users.${t}`]:g.toJson()}}))}))})}),u.length>0&&await Promise.all(u),s}})}}function zT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Z8=zT,GT=new yc("auth","Firebase",zT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl=new Ml("@firebase/auth");function eL(n,...e){Cl.logLevel<=de.WARN&&Cl.warn(`Auth (${si}): ${n}`,...e)}function Au(n,...e){Cl.logLevel<=de.ERROR&&Cl.error(`Auth (${si}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tr(n,...e){throw gg(n,...e)}function Kn(n,...e){return gg(n,...e)}function JT(n,e,t){const r=Object.assign(Object.assign({},Z8()),{[e]:t});return new yc("auth","Firebase",r).create(e,{appName:n.name})}function pg(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&tr(n,"argument-error"),JT(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function gg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return GT.create(n,...e)}function Q(n,e,...t){if(!n)throw gg(e,...t)}function xr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Au(e),new Error(e)}function Mr(n,e){n||xr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function tL(){return Wv()==="http:"||Wv()==="https:"}function Wv(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tL()||KD()||"connection"in navigator)?navigator.onLine:!0}function rL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Mr(t>e,"Short delay should be less than long delay!"),this.isMobile=q0()||pw()}get(){return nL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yg(n,e){Mr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL=new Jc(3e4,6e4);function Vr(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function On(n,e,t,r,s={}){return KT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=To(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),QT.fetch()(jT(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},i))})}async function KT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},sL),e);try{const s=new oL(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw da(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw da(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw da(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw da(n,"user-disabled",o);const l=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw JT(n,l,u);tr(n,l)}}catch(s){if(s instanceof Fr)throw s;tr(n,"network-request-failed",{message:String(s)})}}async function qh(n,e,t,r,s={}){const i=await On(n,e,t,r,s);return"mfaPendingCredential"in i&&tr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function jT(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?yg(n.config,s):`${n.config.apiScheme}://${s}`}class oL{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Kn(this.auth,"network-request-failed")),iL.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function da(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Kn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aL(n,e){return On(n,"POST","/v1/accounts:delete",e)}async function cL(n,e){return On(n,"POST","/v1/accounts:update",e)}async function uL(n,e){return On(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function lL(n,e=!1){const t=Ee(n),r=await t.getIdToken(e),s=_g(r);Q(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:ka(Ef(s.auth_time)),issuedAtTime:ka(Ef(s.iat)),expirationTime:ka(Ef(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Ef(n){return Number(n)*1e3}function _g(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Au("JWT malformed, contained fewer than 3 sections"),null;try{const s=Pu(t);return s?JSON.parse(s):(Au("Failed to decode base64 JWT payload"),null)}catch(s){return Au("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function hL(n){const e=_g(n);return Q(e,"internal-error"),Q(typeof e.exp<"u","internal-error"),Q(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wo(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Fr&&dL(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function dL({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ka(this.lastLoginAt),this.creationTime=ka(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await wo(n,uL(t,{idToken:r}));Q(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?gL(i.providerUserInfo):[],a=pL(n.providerData,o),c=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),l=c?u:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new XT(i.createdAt,i.lastLoginAt),isAnonymous:l};Object.assign(n,d)}async function mL(n){const e=Ee(n);await mc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function pL(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function gL(n){return n.map(e=>{var{providerId:t}=e,r=V0(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yL(n,e){const t=await KT(n,{},async()=>{const r=To({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=jT(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",QT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function _L(n,e){return On(n,"POST","/v2/accounts:revokeToken",Vr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Q(e.idToken,"internal-error"),Q(typeof e.idToken<"u","internal-error"),Q(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):hL(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Q(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await yL(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new pc;return r&&(Q(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Q(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Q(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new pc,this.toJSON())}_performRefresh(){return xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(n,e){Q(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class $s{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=V0(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new XT(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await wo(this,this.stsTokenManager.getToken(this.auth,e));return Q(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return lL(this,e)}reload(){return mL(this)}_assign(e){this!==e&&(Q(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new $s(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Q(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await mc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await wo(this,aL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,c,u,l;const d=(r=t.displayName)!==null&&r!==void 0?r:void 0,f=(s=t.email)!==null&&s!==void 0?s:void 0,m=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,y=(a=t.tenantId)!==null&&a!==void 0?a:void 0,g=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,x=(u=t.createdAt)!==null&&u!==void 0?u:void 0,_=(l=t.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:v,emailVerified:w,isAnonymous:D,providerData:T,stsTokenManager:E}=t;Q(v&&E,e,"internal-error");const A=pc.fromJSON(this.name,E);Q(typeof v=="string",e,"internal-error"),$r(d,e.name),$r(f,e.name),Q(typeof w=="boolean",e,"internal-error"),Q(typeof D=="boolean",e,"internal-error"),$r(m,e.name),$r(p,e.name),$r(y,e.name),$r(g,e.name),$r(x,e.name),$r(_,e.name);const k=new $s({uid:v,auth:e,email:f,emailVerified:w,displayName:d,isAnonymous:D,photoURL:p,phoneNumber:m,tenantId:y,stsTokenManager:A,createdAt:x,lastLoginAt:_});return T&&Array.isArray(T)&&(k.providerData=T.map(I=>Object.assign({},I))),g&&(k._redirectEventId=g),k}static async _fromIdTokenResponse(e,t,r=!1){const s=new pc;s.updateFromServerResponse(t);const i=new $s({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await mc(i),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hv=new Map;function Er(n){Mr(n instanceof Function,"Expected a class definition");let e=Hv.get(n);return e?(Mr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Hv.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ZT.type="NONE";const qv=ZT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cu(n,e,t){return`firebase:${n}:${e}:${t}`}class Ji{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Cu(this.userKey,s.apiKey,i),this.fullPersistenceKey=Cu("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?$s._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ji(Er(qv),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Er(qv);const o=Cu(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const l=await u._get(o);if(l){const d=$s._fromJSON(e,l);u!==i&&(a=d),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Ji(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Ji(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(nD(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eD(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sD(e))return"Blackberry";if(iD(e))return"Webos";if(vg(e))return"Safari";if((e.includes("chrome/")||tD(e))&&!e.includes("edge/"))return"Chrome";if(rD(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function eD(n=qt()){return/firefox\//i.test(n)}function vg(n=qt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tD(n=qt()){return/crios\//i.test(n)}function nD(n=qt()){return/iemobile/i.test(n)}function rD(n=qt()){return/android/i.test(n)}function sD(n=qt()){return/blackberry/i.test(n)}function iD(n=qt()){return/webos/i.test(n)}function $h(n=qt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function vL(n=qt()){var e;return $h(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function wL(){return jD()&&document.documentMode===10}function oD(n=qt()){return $h(n)||rD(n)||iD(n)||sD(n)||/windows phone/i.test(n)||nD(n)}function xL(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(n,e=[]){let t;switch(n){case"Browser":t=$v(qt());break;case"Worker":t=`${$v(qt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${si}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const c=e(i);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IL(n,e={}){return On(n,"GET","/v2/passwordPolicy",Vr(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL=6;class DL{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:TL,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yv(this),this.idTokenSubscription=new Yv(this),this.beforeStateQueue=new EL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=GT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Er(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ji.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Q(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=rL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Ee(e):null;return t&&Q(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Q(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Er(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await IL(this),t=new DL(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new yc("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await _L(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Er(e)||this._popupRedirectResolver;Q(t,this,"argument-error"),this.redirectPersistenceManager=await Ji.create(this,[Er(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Q(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Q(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=aD(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&eL(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Wo(n){return Ee(n)}class Yv{constructor(e){this.auth=e,this.observer=null,this.addObserver=oA(t=>this.observer=t)}get next(){return Q(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CL(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function bL(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Kn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",CL().appendChild(r)})}function kL(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SL(n,e){const t=Ol(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Nu(i,e??{}))return s;tr(s,"already-initialized")}return t.initialize({options:e})}function PL(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Er);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function RL(n,e,t){const r=Wo(n);Q(r._canInitEmulator,r,"emulator-config-failed"),Q(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=cD(e),{host:o,port:a}=NL(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||ML()}function cD(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function NL(n){const e=cD(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:zv(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:zv(o)}}}function zv(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function ML(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xr("not implemented")}_getIdTokenResponse(e){return xr("not implemented")}_linkToIdToken(e,t){return xr("not implemented")}_getReauthenticationResolver(e){return xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qi(n,e){return qh(n,"POST","/v1/accounts:signInWithIdp",Vr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OL="http://localhost";class Or extends wg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Or(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=V0(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Or(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Qi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Qi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Qi(e,t)}buildRequest(){const e={requestUri:OL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=To(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FL(n,e){return On(n,"POST","/v1/accounts:sendVerificationCode",Vr(n,e))}async function BL(n,e){return qh(n,"POST","/v1/accounts:signInWithPhoneNumber",Vr(n,e))}async function LL(n,e){const t=await qh(n,"POST","/v1/accounts:signInWithPhoneNumber",Vr(n,e));if(t.temporaryProof)throw da(n,"account-exists-with-different-credential",t);return t}const VL={USER_NOT_FOUND:"user-not-found"};async function UL(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return qh(n,"POST","/v1/accounts:signInWithPhoneNumber",Vr(n,t),VL)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki extends wg{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ki({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ki({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return BL(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return LL(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return UL(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Ki({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho extends Qc{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Sa extends Ho{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Q("providerId"in t&&"signInMethod"in t,"argument-error"),Or._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Q(e.idToken||e.accessToken,"argument-error"),Or._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Sa.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Sa.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Sa(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr extends Ho{constructor(){super("facebook.com")}static credential(e){return Or._fromParams({providerId:dr.PROVIDER_ID,signInMethod:dr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dr.credentialFromTaggedObject(e)}static credentialFromError(e){return dr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return dr.credential(e.oauthAccessToken)}catch{return null}}}dr.FACEBOOK_SIGN_IN_METHOD="facebook.com";dr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr extends Ho{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Or._fromParams({providerId:fr.PROVIDER_ID,signInMethod:fr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fr.credentialFromTaggedObject(e)}static credentialFromError(e){return fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return fr.credential(t,r)}catch{return null}}}fr.GOOGLE_SIGN_IN_METHOD="google.com";fr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr extends Ho{constructor(){super("github.com")}static credential(e){return Or._fromParams({providerId:Gr.PROVIDER_ID,signInMethod:Gr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gr.credentialFromTaggedObject(e)}static credentialFromError(e){return Gr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Gr.credential(e.oauthAccessToken)}catch{return null}}}Gr.GITHUB_SIGN_IN_METHOD="github.com";Gr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr extends Ho{constructor(){super("twitter.com")}static credential(e,t){return Or._fromParams({providerId:Jr.PROVIDER_ID,signInMethod:Jr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Jr.credentialFromTaggedObject(e)}static credentialFromError(e){return Jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Jr.credential(t,r)}catch{return null}}}Jr.TWITTER_SIGN_IN_METHOD="twitter.com";Jr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await $s._fromIdTokenResponse(e,r,s),o=Gv(r);return new xo({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Gv(r);return new xo({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Gv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl extends Fr{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,bl.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new bl(e,t,r,s)}}function uD(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?bl._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lD(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WL(n,e){const t=Ee(n);await hD(!0,t,e);const{providerUserInfo:r}=await cL(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=lD(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function xg(n,e,t=!1){const r=await wo(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return xo._forOperation(n,"link",r)}async function hD(n,e,t){await mc(e);const r=lD(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Q(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dD(n,e,t=!1){const{auth:r}=n,s="reauthenticate";try{const i=await wo(n,uD(r,s,e,n),t);Q(i.idToken,r,"internal-error");const o=_g(i.idToken);Q(o,r,"internal-error");const{sub:a}=o;return Q(n.uid===a,r,"user-mismatch"),xo._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&tr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fD(n,e,t=!1){const r="signIn",s=await uD(n,r,e),i=await xo._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function HL(n,e){return fD(Wo(n),e)}async function qL(n,e){const t=Ee(n);return await hD(!1,t,e.providerId),xg(t,e)}async function $L(n,e){return dD(Ee(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YL(n,e){return On(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zL(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ee(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await wo(r,YL(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function GL(n,e,t,r){return Ee(n).onIdTokenChanged(e,t,r)}function JL(n,e,t){return Ee(n).beforeAuthStateChanged(e,t)}function QL(n,e,t,r){return Ee(n).onAuthStateChanged(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KL(n,e){return On(n,"POST","/v2/accounts/mfaEnrollment:start",Vr(n,e))}const kl="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kl,"1"),this.storage.removeItem(kl),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(){const n=qt();return vg(n)||$h(n)}const XL=1e3,ZL=10;class pD extends mD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=jL()&&xL(),this.fallbackToPolling=oD(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(r);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);wL()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,ZL):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},XL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}pD.type="LOCAL";const e9=pD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD extends mD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}gD.type="SESSION";const yD=gD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t9(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Yh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),c=await t9(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Yh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{const u=Eg("",20);s.port1.start();const l=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(d){const f=d;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(l),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(l),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(){return window}function r9(n){jn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _D(){return typeof jn().WorkerGlobalScope<"u"&&typeof jn().importScripts=="function"}async function s9(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function i9(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function o9(){return _D()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD="firebaseLocalStorageDb",a9=1,Sl="firebaseLocalStorage",wD="fbase_key";class Kc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zh(n,e){return n.transaction([Sl],e?"readwrite":"readonly").objectStore(Sl)}function c9(){const n=indexedDB.deleteDatabase(vD);return new Kc(n).toPromise()}function B0(){const n=indexedDB.open(vD,a9);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Sl,{keyPath:wD})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Sl)?e(r):(r.close(),await c9(),e(await B0()))})})}async function Jv(n,e,t){const r=zh(n,!0).put({[wD]:e,value:t});return new Kc(r).toPromise()}async function u9(n,e){const t=zh(n,!1).get(e),r=await new Kc(t).toPromise();return r===void 0?null:r.value}function Qv(n,e){const t=zh(n,!0).delete(e);return new Kc(t).toPromise()}const l9=800,h9=3;class xD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await B0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>h9)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _D()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Yh._getInstance(o9()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await s9(),!this.activeServiceWorker)return;this.sender=new n9(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||i9()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await B0();return await Jv(e,kl,"1"),await Qv(e,kl),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Jv(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>u9(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Qv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=zh(s,!1).getAll();return new Kc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),l9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}xD.type="LOCAL";const d9=xD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f9(n,e){return On(n,"POST","/v2/accounts/mfaSignIn:start",Vr(n,e))}new Jc(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m9="recaptcha";async function p9(n,e,t){var r;const s=await t.verify();try{Q(typeof s=="string",n,"argument-error"),Q(t.type===m9,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Q(o.type==="enroll",n,"internal-error"),(await KL(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Q(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Q(a,n,"missing-multi-factor-info"),(await f9(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await FL(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function g9(n,e){await xg(Ee(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e){this.providerId=Ys.PROVIDER_ID,this.auth=Wo(e)}verifyPhoneNumber(e,t){return p9(this.auth,e,Ee(t))}static credential(e,t){return Ki._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ys.credentialFromTaggedObject(t)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Ki._fromTokenResponse(t,r):null}}Ys.PROVIDER_ID="phone";Ys.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gh(n,e){return e?Er(e):(Q(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig extends wg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function y9(n){return fD(n.auth,new Ig(n),n.bypassAuthState)}function _9(n){const{auth:e,user:t}=n;return Q(t,e,"internal-error"),dD(t,new Ig(n),n.bypassAuthState)}async function v9(n){const{auth:e,user:t}=n;return Q(t,e,"internal-error"),xg(t,new Ig(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return y9;case"linkViaPopup":case"linkViaRedirect":return v9;case"reauthViaPopup":case"reauthViaRedirect":return _9;default:tr(this.auth,"internal-error")}}resolve(e){Mr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Mr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w9=new Jc(2e3,1e4);async function If(n,e,t){const r=Wo(n);pg(n,e,Qc);const s=Gh(r,t);return new Ir(r,"signInViaPopup",e,s).executeNotNull()}async function Tf(n,e,t){const r=Ee(n);pg(r.auth,e,Qc);const s=Gh(r.auth,t);return new Ir(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function Df(n,e,t){const r=Ee(n);pg(r.auth,e,Qc);const s=Gh(r.auth,t);return new Ir(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ir extends ED{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ir.currentPopupAction&&Ir.currentPopupAction.cancel(),Ir.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Q(e,this.auth,"internal-error"),e}async onExecution(){Mr(this.filter.length===1,"Popup operations only handle one event");const e=Eg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Kn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Kn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ir.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Kn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,w9.get())};e()}}Ir.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x9="pendingRedirect",bu=new Map;class E9 extends ED{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=bu.get(this.auth._key());if(!e){try{const r=await I9(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}bu.set(this.auth._key(),e)}return this.bypassAuthState||bu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function I9(n,e){const t=A9(e),r=D9(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function T9(n,e){bu.set(n._key(),e)}function D9(n){return Er(n._redirectPersistence)}function A9(n){return Cu(x9,n.config.apiKey,n.name)}async function C9(n,e,t=!1){const r=Wo(n),s=Gh(r,e),o=await new E9(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b9=10*60*1e3;class k9{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!S9(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ID(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Kn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=b9&&this.cachedEventUids.clear(),this.cachedEventUids.has(Kv(e))}saveEventToCache(e){this.cachedEventUids.add(Kv(e)),this.lastProcessedEventTime=Date.now()}}function Kv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ID({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function S9(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ID(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P9(n,e={}){return On(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R9=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,N9=/^https?/;async function M9(n){if(n.config.emulator)return;const{authorizedDomains:e}=await P9(n);for(const t of e)try{if(O9(t))return}catch{}tr(n,"unauthorized-domain")}function O9(n){const e=F0(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!N9.test(t))return!1;if(R9.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F9=new Jc(3e4,6e4);function jv(){const n=jn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function B9(n){return new Promise((e,t)=>{var r,s,i;function o(){jv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{jv(),t(Kn(n,"network-request-failed"))},timeout:F9.get()})}if(!((s=(r=jn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=jn().gapi)===null||i===void 0)&&i.load)o();else{const a=kL("iframefcb");return jn()[a]=()=>{gapi.load?o():t(Kn(n,"network-request-failed"))},bL(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw ku=null,e})}let ku=null;function L9(n){return ku=ku||B9(n),ku}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V9=new Jc(5e3,15e3),U9="__/auth/iframe",W9="emulator/auth/iframe",H9={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},q9=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $9(n){const e=n.config;Q(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?yg(e,W9):`https://${n.config.authDomain}/${U9}`,r={apiKey:e.apiKey,appName:n.name,v:si},s=q9.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${To(r).slice(1)}`}async function Y9(n){const e=await L9(n),t=jn().gapi;return Q(t,n,"internal-error"),e.open({where:document.body,url:$9(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:H9,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Kn(n,"network-request-failed"),a=jn().setTimeout(()=>{i(o)},V9.get());function c(){jn().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z9={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},G9=500,J9=600,Q9="_blank",K9="http://localhost";class Xv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j9(n,e,t,r=G9,s=J9){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},z9),{width:r.toString(),height:s.toString(),top:i,left:o}),u=qt().toLowerCase();t&&(a=tD(u)?Q9:t),eD(u)&&(e=e||K9,c.scrollbars="yes");const l=Object.entries(c).reduce((f,[m,p])=>`${f}${m}=${p},`,"");if(vL(u)&&a!=="_self")return X9(e||"",a),new Xv(null);const d=window.open(e||"",a,l);Q(d,n,"popup-blocked");try{d.focus()}catch{}return new Xv(d)}function X9(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z9="__/auth/handler",e5="emulator/auth/handler",t5=encodeURIComponent("fac");async function Zv(n,e,t,r,s,i){Q(n.config.authDomain,n,"auth-domain-config-required"),Q(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:si,eventId:s};if(e instanceof Qc){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Cf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[l,d]of Object.entries(i||{}))o[l]=d}if(e instanceof Ho){const l=e.getScopes().filter(d=>d!=="");l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const l of Object.keys(a))a[l]===void 0&&delete a[l];const c=await n._getAppCheckToken(),u=c?`#${t5}=${encodeURIComponent(c)}`:"";return`${n5(n)}?${To(a).slice(1)}${u}`}function n5({config:n}){return n.emulator?yg(n,e5):`https://${n.authDomain}/${Z9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Af="webStorageSupport";class r5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yD,this._completeRedirectFn=C9,this._overrideRedirectResult=T9}async _openPopup(e,t,r,s){var i;Mr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Zv(e,t,r,F0(),s);return j9(e,o,Eg())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Zv(e,t,r,F0(),s);return r9(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Mr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Y9(e),r=new k9(e);return t.register("authEvent",s=>(Q(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Af,{type:Af},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Af];o!==void 0&&t(!!o),tr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=M9(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oD()||vg()||$h()}}const s5=r5;var ew="@firebase/auth",tw="1.5.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Q(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o5(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function a5(n){Gs(new cs("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Q(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:aD(n)},u=new AL(r,s,i,c);return PL(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Gs(new cs("auth-internal",e=>{const t=Wo(e.getProvider("auth").getImmediate());return(r=>new i5(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Yn(ew,tw,o5(n)),Yn(ew,tw,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c5=5*60,u5=fw("authIdTokenMaxAge")||c5;let nw=null;const l5=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>u5)return;const s=t==null?void 0:t.token;nw!==s&&(nw=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function h5(n=Do()){const e=Ol(n,"auth");if(e.isInitialized())return e.getImmediate();const t=SL(n,{popupRedirectResolver:s5,persistence:[d9,e9,yD]}),r=fw("authTokenSyncURL");if(r){const i=l5(r);JL(t,i,()=>i(t.currentUser)),GL(t,o=>i(o))}const s=lw("auth");return s&&RL(t,`http://${s}`),t}a5("Browser");const gu={"operation-not-allowed":re.providerNotAllowed,"user-disabled":re.userDisable,"provider-already-linked":re.providerAlreadyLinked,"credential-already-in-use":re.credentialAlreadyInUse,"invalid-verification-code":re.wrongOptCode,"invalid-verification-id":re.verification,"invalid-credential":re.invalidCredential,"user-mismatch":re.userMissmatch,"user-not-found":re.userNotFound,"no-such-provider":re.noSuchProvider,canceled:re.userExitManually,"too-many-requests":re.tooManyAttempts,"too-many-attempts":re.tooManyAttempts,"expired-code":re.expiredCode,"account-exists-with-different-credential":re.credentialAlreadyInUse,"invalid-phone-number":re.invalidPhoneNumber};var d5=(n=>(n[n.login=0]="login",n[n.link=1]="link",n[n.reauthenticate=2]="reauthenticate",n[n.phoneUpdate=3]="phoneUpdate",n))(d5||{});class f5{constructor(){h(this,"_auth");Y0().length===0?Fl(U0):Do(),this._auth=h5()}async signInWithFacebookSRV(e){try{return await this.signInWithFacebookWebSRV(e),!0}catch(t){return t instanceof Error&&(console.error(`Error: ${t}`),Se.error(`it was an error the error is --> ${t}`),Se.error(t.name),_e.GI().details=t.name,_e.GI().error=gu[t.name]??re.unknown),!1}}async signInWithFacebookWebSRV(e){const t=new dr;switch(t.addScope("email"),t.setCustomParameters({display:"popup"}),e){case 0:await If(this._auth,t);break;case 1:await Df(this._auth.currentUser,t);break;case 2:await Tf(this._auth.currentUser,t);break}}async signInWithGoogleSRV(e){try{return await this.signInWithGoogleWebSRV(e),!0}catch(t){return t instanceof Error&&(console.error(`Error: ${t}`),Se.error(`it was an error the error is --> ${t}`),Se.error(t.name),_e.GI().details=t.name,_e.GI().error=gu[t.name]??re.unknown),!1}}async signInWithGoogleWebSRV(e){const t=new fr;switch(t.addScope("email"),t.addScope("profile"),t.setCustomParameters({login_hint:"user@example.com"}),e){case 0:await If(this._auth,t);break;case 1:await Df(this._auth.currentUser,t);break;case 2:await Tf(this._auth.currentUser,t);break}}async signInWithAppleSRV(e){try{return await this.signInWithAppleWebSRV(e),!0}catch(t){return t instanceof Error&&(console.error(`Error: ${t}`),Se.error(`it was an error the error is --> ${t}`),Se.error(t.name),_e.GI().details=t.name,_e.GI().error=gu[t.name]??re.unknown),!1}}async signInWithAppleWebSRV(e){const t=new Sa("apple.com");switch(t.addScope("email"),t.addScope("name"),e){case 0:await If(this._auth,t);break;case 1:await Df(this._auth.currentUser,t);break;case 2:await Tf(this._auth.currentUser,t);break}}async signInWithOtpSRV({loginType:e,verificationId:t,otp:r,autocredential:s}){const i=s??Ys.credential(t,r);try{switch(e){case 0:await HL(this._auth,i);break;case 1:await qL(this._auth.currentUser,i);break;case 2:await $L(this._auth.currentUser,i);break;case 3:await g9(this._auth.currentUser,i);break}return!0}catch(o){return console.error(`Error: ${o}`),o instanceof Error&&(console.error(`Error: ${o}`),Se.error(`it was an error the error is --> ${o}`),Se.error(o.name),_e.GI().details=o.name,_e.GI().error=gu[o.name]??re.unknown),!1}}get isLoggedInSRV(){return this._auth.currentUser!=null}onAuthUserStateChangedSRV(e){return QL(this._auth,e)}async updateUserNameSRV(e){try{await zL(this._auth.currentUser,{displayName:e}),await this._auth.currentUser.reload()}catch(t){throw t instanceof Error&&_e.GI().addError({error:re.updateDisplayName,details:t.toString()}),t}}userConnectedOnlyLocallySRV(){return this.isLoggedInSRV&&this._auth.currentUser.displayName===null}get lastLoginDateSRV(){var e;return(e=this._auth.currentUser)==null?void 0:e.metadata.lastSignInTime}get userIdSRV(){if(this._auth.currentUser!=null){const e=this._auth.currentUser.displayName;return e!==null&&e.includes("&&")&&e.includes("+")?this.userPhoneSRV:this._auth.currentUser.uid}return""}get userDataSRV(){return this._auth.currentUser}async userClaimsSRV(){return this._auth.currentUser===null?null:(await this._auth.currentUser.getIdToken(!0),(await this._auth.currentUser.getIdTokenResult()).claims)}get userPhoneSRV(){if(this._auth.currentUser!==null){const t=this._auth.currentUser.displayName.split("&&")[1];return this._auth.currentUser.phoneNumber.replace(t,`${t}-`)}return""}get existsProvidersSRV(){if(this._auth.currentUser===null)return new Set;const e=new Set;return this._auth.currentUser.providerData.forEach(t=>{e.add(t.providerId)}),e}async deleteUserSRV(){if(this._auth.currentUser===null)return!1;try{return await this._auth.currentUser.delete(),!0}catch{return!1}}async unlinkProviderSRV({providerId:e}){try{return WL(this._auth.currentUser,e),!0}catch{return!1}}async reloadUserSRV(){this._auth.currentUser!==null&&await this._auth.currentUser.reload()}async logoutSRV(){try{return await this._auth.signOut(),!this.isLoggedInSRV}catch{return!1}}}class m5 extends f5{constructor(){super()}async signInWithGoogle(e){return await this.signInWithGoogleSRV(e)}async signInWithApple(e){return await this.signInWithAppleSRV(e)}async signInWithFacebook(e){return await this.signInWithFacebookSRV(e)}onAuthUserStateChanged(e){return this.onAuthUserStateChangedSRV(e)}async signInWithOtp({loginType:e,verificationId:t,otp:r,autocredential:s}){return await this.signInWithOtpSRV({loginType:e,verificationId:t,otp:r,autocredential:s})}async logout(){return await this.logoutSRV()}async unlinkProvider({providerId:e}){return await this.unlinkProviderSRV({providerId:e})}async deleteUser(){return await this.deleteUserSRV()}async reloadUser(){await this.reloadUserSRV()}userConnectedOnlyLocally(){return this.userConnectedOnlyLocallySRV()}async updateUserName({name:e}){try{return await this.updateUserNameSRV(e),!0}catch(t){return console.error(`Error occurred while saving user name --> ${t}`),!1}}get isLoggedIn(){return this.isLoggedInSRV}get existsProviders(){return this.existsProvidersSRV}get userData(){return this.userDataSRV}get userId(){return this.userIdSRV}get lastLoginDate(){return this.lastLoginDateSRV}async userClaims(){return await this.userClaimsSRV}}async function p5(){var s,i;if(Bt.currentBusinesssId!==""){let o=0;for(;je.GI().workers.isEmpty&&o<10;)o++,await new Promise(a=>setTimeout(a,100))}const n={},e=Tr.GI().user,t=new Map,r=e.bookings.recurrence||{};for(const o of Object.values(e.bookings.futureBookings))for(const[a,c]of Object.entries(o))t.set(a,c);for(const[o,a]of Object.entries(r)){if(a.buisnessId!==je.GI().business.businessId||a.status!==Ft.approved||a.recurrenceEvent==null)continue;const c=je.GI().workers[a.workerId];if(c==null)continue;const u=c.notifications.remindersTypes.size===0?0:Math.max(...Object.values(c.notifications.remindersTypes));let l=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDay(),a.bookingDate.getHours(),a.bookingDate.getMinutes());for(;l<qe(new Date,new ee({minutes:u}));){if(l<new Date){l=new Date(l.getTime()+24*60*60*1e3);continue}if(!a.recurrenceEvent.isAccureInDate({date:l})){l=new Date(l.getTime()+24*60*60*1e3);continue}const d=wn.fromBooking(a);d.bookingDate=l;let f=!1;Qr(l,Zg)<new Date&&(f=!0,n[s=Yt.regular]??(n[s]=[]),n[Yt.regular].push(d));for(const[m,p]of a.remindersTypes)Yt.regular===m&&f||c.notifications.remindersTypes.get(m)!=null&&(Qr(l,new ee({minutes:c.notifications.remindersTypes.get(m)}))<new Date||(n[m]||(n[m]=[]),n[m].push(d)));l=qe(l,new ee({days:1}))}}for(const[o,a]of t){if(a.buisnessId!==je.GI().business.businessId||a.status!==Ft.approved)continue;const c=je.GI().workers[a.workerId];if(c==null||a.bookingDate<new Date)continue;let u=!1;Qr(a.bookingDate,Zg)<new Date&&(u=!0,n[i=Yt.regular]||(n[i]=[]),n[Yt.regular].push(a));for(const[l,d]of a.remindersTypes)c.notifications.remindersTypes.get(l)!=null&&(Yt.regular===l&&u||Qr(a.bookingDate,new ee({minutes:c.notifications.remindersTypes.get(l)}))>=new Date)}return n}function nV(n,e){const t=new Date;return t.setMinutes(t.getMinutes()+e.onHoldMinutes),t.getTime()>n.getTime()}const Ps=class Ps{constructor(){h(this,"user",new Gi({}));h(this,"verificationRepo",new m5);h(this,"userRepo",new X8);h(this,"userDoc")}static GI(){return Ps.instance||(Ps.instance=new Ps),Ps.instance}get getPermission(){return 0}isDeveloper(){return this.isConnected?Bt.developers.hasOwnProperty(this.user.id.replace("+","")):!1}get isConnected(){return this.verificationRepo.isLoggedIn}get userId(){try{return this.verificationRepo.userId}catch{return""}}async setupUser({newUserId:e="",logoutIfDosentExist:t=!1}){var r;try{return wf.set(!1),Se.info(`The user id is -> ${e}`),e.length<5?(await this.verificationRepo.logout(),!0):(this.userDoc===void 0&&(this.userDoc=await this.userRepo.getDocSRV({path:Zt,docId:e})),!t&&(this.userDoc===void 0||!this.userDoc.exists())?(this.userDoc=void 0,!0):(this.user=Gi.fromUserDocJson((r=this.userDoc)==null?void 0:r.data()),this.startPublicDataListening(),M0.set(this.user),wf.set(!0),!0))}catch(s){return this.userDoc=void 0,s instanceof Error&&(Se.error(`Error while setting up the user --> ${s}`),_e.GI().addError({details:s.toString()})),!1}}async startPublicDataListening(){this.isConnected&&(this.user.userPublicDataListener=this.userRepo.docListener({path:`${Zt}/${this.user.id}/${lt}`,docId:en,onChanged:async e=>{try{e.exists()&&(this.user.setUserPublicData(e.data()),await this.loadBookingsDocs(this.user.userPublicData.bookingsDocsToLoad),Se.info("Getting new user data from database"),this.user.userPublicData.reminders={},Bt.currentBusinesssId!==""&&(this.user.userPublicData.reminders=await p5()))}catch(t){console.error(`Error in startPublicDataListening: ${t}`)}}}))}async loadBookingsDocs(e){const t=[];e.forEach(r=>{t.push(this.loadBookingDoc(r))}),await Promise.all(t)}async logout(){return this.verificationRepo.logout().then(async e=>(e&&(this.user=new Gi({}),M0.set(this.user),wf.set(!1)),e))}async loadBookingDoc(e){try{const t=await this.userRepo.getDocSRV({path:Fa.GI().userBookingsPathByUser(this.user.id),docId:e});e===Ow?this.user.bookings.setRecurrence((t==null?void 0:t.data())||{}):this.user.bookings.setMonth((t==null?void 0:t.data())||{},e)}catch(t){Se.error(`Error loading booking doc ${e}: ${t}`)}}};h(Ps,"instance");let Tr=Ps;const It=Eo(),Rs=class Rs{static initializeBookingMaker({isUpdate:e=!1}){const t={workerId:void 0,showVerificationAlert:!1,services:{},date:void 0,isUpdate:e,currentPaymentType:void 0,currentCurrencyCode:void 0,pickMultipleServices:!1,hasMultiTreatment:!1,isBookingWithPaymentUpdate:!1,currentStep:1,isMultiEvent:!1};It.set(t)}static get worker(){const e=Bn(It);return je.GI().workers[e.workerId??""]}static setWorkerId(e){const t=Bn(It);if(e===t.workerId){t.currentStep+=1,It.set(t);return}je.GI().cancelAllWorkersRegularListenings();const r=je.GI().workers[e];r!=null&&je.GI().startWorkerListening(r);const s=je.GI().workers[e];s!=null&&(t.showVerificationAlert=rw(s)),t.workerId=e,t.currentStep+=1,It.set(t)}static updateWorkerData(e){const t=Bn(It);Se.debug("Getting new data for the worker");const r={...t.services};Object.keys(r).forEach(i=>{e.hasTreatemnt(i)||delete t.services[i]}),e.treatmentsSubjects.forEach((i,o)=>{i.treatments.forEach((a,c)=>{if(t.services.hasOwnProperty(a.id)){const u=t.services[a.id].count,l=vn.fromTreatment(a);l.count=u,t.services[a.id]=l}})});const s=je.GI().workers[t.workerId];s!==null&&(t.showVerificationAlert=rw(s)),It.set(t)}static get bookingFromValues(){const e=Bn(It),t=new wn({workerId:e.workerId});t.bookingDate=e.date??new Date(0);const r=je.GI().workers[e.workerId??""];if(r==null)return t;const s=new Map;let i=0;return Object.entries(e.services).forEach(([o,a])=>{s.set(i.toString(),a),i+=1}),t.treatments=s,t}static onTapService(e){const t=Bn(It);if(t.isBookingWithPaymentUpdate&&!t.services.hasOwnProperty(e.id)){Hr({text:z("cantEditTreatmentOnPaymentBooking"),status:"warning"});return}if(t.isUpdate&&e.amountInAdvance>0){Hr({text:z("cantChoosePaymentServiceOnBookingUpdate"),status:"warning"});return}t.services.hasOwnProperty(e.id)?t.pickMultipleServices?this.removeService(t,e):(t.currentStep+=1,It.set(t)):e.isMulti?this.addMultiService(t,e):this.addService(t,e)}static addMultiService(e,t){if(e.pickMultipleServices&&Object.keys(e.services).length>0){Hr({text:z(e.hasMultiTreatment?"noMultiWithMulti":"noMultiWithRegular",void 0,!1),status:"warning"});return}e.services={[t.id]:t};const r=je.GI().workers[e.workerId??""];r!==void 0&&(je.GI().startTimesListening(r,t.isMulti,t.amountInAdvance>0),e.currentStep+=1,It.set(e))}static removeService(e,t){Object.keys(e.services).length===1&&(e.currentCurrencyCode=void 0,e.currentPaymentType=void 0),e.services[t.id].count=1,delete e.services[t.id],It.set(e)}static addService(e,t){console.log("addService");let r=0;Object.values(e.services).forEach(i=>{r+=i.count});const s=je.GI().workers[e.workerId??""];if(s!==void 0){if(e.pickMultipleServices&&e.hasMultiTreatment){Hr({text:z("noMultiWithRegular"),status:"warning"});return}if(r>=s.maxTreatments){Hr({text:z("userMaxTreatments").replace("AMOUNT",s.maxTreatments.toString()),status:"warning"});return}if(e.pickMultipleServices&&t.amountInAdvance>0&&t.paymentType!=null&&t.paymentType!=e.currentPaymentType&&e.currentPaymentType!=null){Hr({text:z("cantPickDiffrentPaymentType"),status:"warning"});return}if(e.pickMultipleServices&&t.price.currency.code!=e.currentCurrencyCode&&e.currentCurrencyCode!=null){Hr({text:z("cantPickDiffrentCurrencies"),status:"warning"});return}je.GI().startTimesListening(s,t.isMulti,t.amountInAdvance>0),e.currentCurrencyCode=t.price.currency.code,t.amountInAdvance>0&&(e.currentPaymentType=t.paymentType),e.pickMultipleServices||(e.services={},e.currentStep+=1),e.services[t.id]=t,It.set(e)}}static onRemoveTreatmentCount(e){var r;const t=Bn(It);t.services[e.id]!==void 0&&(((r=t.services[e.id])==null?void 0:r.count)===1?this.removeService(t,e):(t.services[e.id].count=-1,It.set(t)))}static onAddTreatmentCount(e){const t=Bn(It);if(t.services[e.id]!=null)return;let r=0;if(Object.entries(t.services).forEach(([s,i])=>{if(t.services.value.hasOwnProperty(s)){const o=t.services[s];r+=o.count}}),r>=Rs.worker.maxTreatments){Hr({text:z("userMaxTreatments").replaceAll("AMOUNT",Rs.worker.maxTreatments.toString()),status:"warning"});return}It.set(t)}};h(Rs,"timePickerObjects",[]),h(Rs,"visibleDates",[]),h(Rs,"firstDateToShow");let Pi=Rs;function rw(n){const e=new wn({});return e.userFcms=Tr.GI().user.fcmsTokens,e.isVerifiedPhone=!0,(BT({booking:e,worker:n})==K.message||n.mustVerifyPhone)&&!Tr.GI().user.isVerifiedPhone}const Ra=class Ra{constructor(){h(this,"defaultTheme","darkIos");h(this,"currentKeyTheme",null);h(this,"themeCauseMainBuilt",!1);h(this,"currentThemes",{...pI});h(this,"currentBusinessTheme",null)}static GI(){return Ra._singleton}async changeTheme(e,{needOverlayHandling:t=!0,ovveride:r=!1,needWaitOverlay:s=!1}={}){var o;const i=this.currentThemes[e];if(i==null||this.currentBusinessTheme==null||!i.isEqual(this.currentBusinessTheme)||r){switch((o=this.currentThemes[e])==null?void 0:o.brightness){case p0.light:je.GI().businessIcon="darkShopIcon";break;case p0.dark:je.GI().businessIcon="lightShopIcon";break;default:je.GI().businessIcon="lightShopIcon";break}return this.themeCauseMainBuilt=!0,this.currentKeyTheme=e,this.currentThemes.hasOwnProperty(e)&&(this.currentBusinessTheme=this.currentThemes[e]),!0}return!1}};h(Ra,"_singleton",new Ra);let L0=Ra,g5=Eo(),y5=Eo();function _5(n,e){const t=e.split("--")[0];return Bt.developers.hasOwnProperty(t)&&(n=Bt.developers[t].businessProductId),n.includes("basic")?ks.basic:n.includes("landing")?ks.landingPage:n.includes("advanced")?ks.advanced:n.includes("golden")?ks.golden:ks.trial}const lr=class lr{constructor(){h(this,"generalRepo",new YT);h(this,"business",new ni({businessId:"",design:new vr}));h(this,"workers",{});h(this,"businessIcon","");h(this,"businessSubtype",ks.trial)}static GI(){return lr.instance||(lr.instance=new lr),lr.instance}async initSettings(e,{fromLoading:t=!1}={}){try{this.workers={},Bt.currentBusinesssId=e;const r=await Promise.all([this._loadSettingsDoc(e),this._loadBusinessWorkers(e)]);return this.businessSubtype=_5(this.business.productId,e),r.length>0&&r[0]===!1?!1:(this.makeBusinessDataListener(),!0)}catch(r){return Se.error(`Error while initializing settings --> ${r}`),!1}}async loadBusiness(e,t,{fromLoading:r=!1,fromSearch:s=!1}={}){try{const i=await this.initSettings(e,{fromLoading:r});return L0.GI().themeCauseMainBuilt,y5.set(lr.GI().workers),g5.set(lr.GI().business),!0}catch{return!1}}async _loadSettingsDoc(e){try{const t=await this.generalRepo.getDocRepo({path:Tt,docId:e});return t===void 0||!t.exists||t.data()===null?(_e.GI().error=re.notFoundBusiness,!1):(this.business=ni.fromJson(t.data(),e),!0)}catch{return!1}}async _loadBusinessWorkers(e){try{const t=`${Tt}/${e}/${tn}`,r=await this.generalRepo.getAllDocsInsideCollection(t);return r!==null&&r.forEach(s=>{const i=uc.fromWorkerDocJson(s);Tr.GI().getPermission>1||(i.id,Tr.GI().user.id),this.workers[i.id]=i}),!0}catch(t){return t instanceof Error&&(Se.error(`Error while loading the business workers docs --> ${t}`),Se.error(t.stack)),!0}}async makeBusinessDataListener(){const e=Fa.GI().getBusinessDataPath(Bt.currentBusinesssId);this.business.businessData.listener=this.generalRepo.listenToChild({childPath:e,callback:t=>{t.exists()&&this.business.businessData.setBusinessData(t)}})}startWorkerListening(e){try{e.workerDocListner||(e.workerDocListner=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${tn}`,docId:e.id,onChanged:t=>{this.updateWorkerObj(t,e.id)}})),e.publicCustomers.publicCustomersData===null&&this.generalRepo.getDocRepo({path:`${Tt}/${Bt.currentBusinesssId}/${tn}/${e.id}/${lt}`,docId:VC}).then(t=>{t.exists()&&t.data()!==null&&e.publicCustomers.setPublicCustomersDataJson(t.data())})}catch(t){console.error(`Error while resuming the Worker listener --> ${t}`)}}updateWorkerObj(e,t){if(e.exists()){if(!Object.keys(this.workers).includes(t))return;this.workers[t].setFromWorkerDoc(e.data()),Pi.updateWorkerData(this.workers[t])}else{delete this.workers[t];return}Se.info(`Get new worker for the current worker updateWorkerObj--> ${t}`)}cancelAllWorkersRegularListenings(e=!1){Object.values(this.workers).map(async t=>{try{(e||t.id!==Tr.GI().user.id&&Tr.GI().getPermission<2)&&(t.workerDocListner!=null&&(t.workerDocListner(),t.workerDocListner=void 0),t.recurrence.listener!=null&&(t.recurrence.listener(),t.recurrence.listener=void 0)),t.workerPublicData.listener!=null&&(t.workerPublicData.listener(),t.workerPublicData.listener=void 0),t.multiEventsTimes.listener!=null&&(t.multiEventsTimes.listener(),t.multiEventsTimes.listener=void 0),Se.info("Workers Listenings have canceled")}catch{console.error("Error while canceling the Workers listeners")}})}startTimesListening(e,t,r){e.workerPublicData.listener===void 0&&(e.workerPublicData.listener=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${tn}/${e.id}/${lt}`,docId:en,onChanged:s=>{this.updateWorkerPublicData(s,e.id)}})),e.recurrence.listener===void 0&&e.hasRecurrenceEvents&&e.isCustomersNeedRecurrence&&(e.recurrence.listener=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${tn}/${e.id}/${lt}`,docId:Mw,onChanged:s=>{this.updateReccurenceEvents(s,e.id)}})),e.multiEventsTimes.listener===void 0&&t&&(e.multiEventsTimes.listener=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${tn}/${e.id}/${lt}`,docId:Fw,onChanged:s=>{this.updateMultiEventsTimes(s,e.id)}}))}updateWorkerPublicData(e,t){this.workers[t]!==void 0&&(!e.exists()||e.data()===void 0||(this.workers[t].workerPublicData.setWorkerPublicData(e.data()),Pi.updateWorkerData(this.workers[t]),Se.debug(`Get new workerData for the current worker updateWorkerPublicData--> ${t}`)))}updateReccurenceEvents(e,t){this.workers[t]!==void 0&&(!e.exists()||e.data()===void 0||(this.workers[t].recurrence.setRecurrenceEvents(e.data()??{},t,this.business),Pi.updateWorkerData(this.workers[t]),Se.debug(`Get new workerData for the current worker updateReccurenceEvents --> ${t}`)))}updateMultiEventsTimes(e,t){this.workers[t]!==void 0&&(!e.exists()||e.data()===void 0||(this.workers[t].multiEventsTimes.setData(e.data()),Pi.updateWorkerData(this.workers[t]),Se.debug(`Get new workerData for the current worker updateReccurenceEvents --> ${t}`)))}};h(lr,"instance");let je=lr;export{U0 as $,zx as A,je as B,Fg as C,ee as D,re as E,YT as F,ve as G,D5 as H,ba as I,C5 as J,A5 as K,d5 as L,T5 as M,ma as N,_s as O,Q8 as P,b5 as Q,L0 as R,Hr as S,Fe as T,Tr as U,m5 as V,$5 as W,Se as X,OC as Y,Y0 as Z,Fl as _,M5 as a,Do as a0,sn as a1,ZN as a2,wn as a3,G8 as a4,Ft as a5,G5 as a6,K5 as a7,Cn as a8,j5 as a9,Vs as aA,tn as aB,k5 as aC,Ae as aD,Mw as aE,S5 as aF,Gg as aG,Nw as aH,BT as aI,uc as aJ,nV as aK,Pi as aL,eV as aM,It as aN,Qr as aO,zC as aP,ty as aQ,k3 as aR,z5 as aa,jC as ab,bt as ac,ha as ad,$n as ae,pI as af,lg as ag,tV as ah,y5 as ai,q5 as aj,ex as ak,ad as al,zc as am,dc as an,cn as ao,pu as ap,vn as aq,Q5 as ar,Z5 as as,X5 as at,J5 as au,fa as av,Ow as aw,O0 as ax,P5 as ay,hu as az,F5 as b,B5 as c,g5 as d,R5 as e,N5 as f,O5 as g,X8 as h,wf as i,ri as j,_e as k,Gi as l,Zt as m,Y5 as n,qe as o,Fn as p,lt as q,en as r,Xi as s,z as t,M0 as u,Tt as v,Bt as w,Ff as x,Fa as y,HT as z};
