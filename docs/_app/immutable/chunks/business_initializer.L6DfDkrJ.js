var UD=Object.defineProperty;var WD=(n,e,t)=>e in n?UD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var d=(n,e,t)=>(WD(n,typeof e!="symbol"?e+"":e,t),t);import{d as HD,c as le,g as ow,b as aw,$ as $D,_ as F0}from"./runtime.oGXtuNGk.js";import{w as Io}from"./index.z5D7rKNM.js";import{af as yn}from"./scheduler.C3TCnZHI.js";let Ng=Io(null);function Gi(n){Ng.set(n),setTimeout(()=>{Ng.set(null)},2e3)}const B0={apiKey:"AIzaSyCSIQHCC23Z7ul639fD8JLMHu4yN77_0VA",authDomain:"managementsystemapp-c1fda.firebaseapp.com",databaseURL:"https://managementsystemapp-c1fda-default-rtdb.europe-west1.firebasedatabase.app",projectId:"managementsystemapp-c1fda",storageBucket:"managementsystemapp-c1fda.appspot.com",messagingSenderId:"670820779934",appId:"1:670820779934:web:fdcf77a952b59c3090788f",measurementId:"G-WP8J044JN9"};var Mg={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L=function(n,e){if(!n)throw To(e)},To=function(n){return new Error("Firebase Database ("+cw.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},qD=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[t++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const r=n[t++],o=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},L0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,u=c?n[s+2]:0,l=r>>2,h=(r&3)<<4|a>>4;let f=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(f=64)),i.push(t[l],t[h],t[f],t[m])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(uw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qD(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,r==null||a==null||u==null||h==null)throw new zD;const f=r<<2|a>>4;if(i.push(f),u!==64){const m=a<<4&240|u>>2;if(i.push(m),h!==64){const p=u<<6&192|h;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class zD extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const lw=function(n){const e=uw(n);return L0.encodeByteArray(e,!0)},bu=function(n){return lw(n).replace(/\./g,"")},ku=function(n){try{return L0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GD(n){return hw(void 0,n)}function hw(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!YD(t)||(n[t]=hw(n[t],e[t]));return n}function YD(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JD(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KD=()=>JD().__FIREBASE_DEFAULTS__,QD=()=>{if(typeof process>"u"||typeof Mg>"u")return;const n=Mg.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},jD=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ku(n[1]);return e&&JSON.parse(e)},V0=()=>{try{return KD()||QD()||jD()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},dw=n=>{var e,t;return(t=(e=V0())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},fw=n=>{const e=dw(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},mw=()=>{var n;return(n=V0())===null||n===void 0?void 0:n.config},pw=n=>{var e;return(e=V0())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[bu(JSON.stringify(t)),bu(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $t(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function U0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($t())}function XD(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function yw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ZD(){const n=$t();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function _w(){return cw.NODE_ADMIN===!0}function eA(){try{return typeof indexedDB=="object"}catch{return!1}}function tA(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var r;e(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nA="FirebaseError";class Ui extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=nA,Object.setPrototypeOf(this,Ui.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yc.prototype.create)}}class yc{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?iA(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ui(s,a,i)}}function iA(n,e){return n.replace(sA,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const sA=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(n){return JSON.parse(n)}function ut(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw=function(n){let e={},t={},i={},s="";try{const r=n.split(".");e=Na(ku(r[0])||""),t=Na(ku(r[1])||""),s=r[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},rA=function(n){const e=vw(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},oA=function(n){const e=vw(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ri(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Zr(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Tf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Su(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function Pu(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const r=n[s],o=e[s];if(Og(r)&&Og(o)){if(!Pu(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function Og(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function or(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const f=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,l;for(let h=0;h<80;h++){h<40?h<20?(u=a^r&(o^a),l=1518500249):(u=r^o^a,l=1859775393):h<60?(u=r&o|a&(r|o),l=2400959708):(u=r^o^a,l=3395469782);const f=(s<<5|s>>>27)+u+c+l+i[h]&4294967295;c=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const r=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<t;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function cA(n,e){const t=new uA(n,e);return t.subscribe.bind(t)}class uA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");lA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=Yh),s.error===void 0&&(s.error=Yh),s.complete===void 0&&(s.complete=Yh);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function lA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Yh(){}function bl(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hA=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,L(i<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kl=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Te(n){return n&&n._delegate?n._delegate:n}class hs{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new gc;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(mA(e))try{this.getOrInitializeService({instanceIdentifier:Cs})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=Cs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Cs){return this.instances.has(e)}getOptions(e=Cs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:fA(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Cs){return this.component?this.component.multipleInstances?e:Cs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function fA(n){return n===Cs?void 0:n}function mA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new dA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ge||(ge={}));const gA={debug:ge.DEBUG,verbose:ge.VERBOSE,info:ge.INFO,warn:ge.WARN,error:ge.ERROR,silent:ge.SILENT},yA=ge.INFO,_A={[ge.DEBUG]:"log",[ge.VERBOSE]:"log",[ge.INFO]:"info",[ge.WARN]:"warn",[ge.ERROR]:"error"},vA=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=_A[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Sl=class{constructor(e){this.name=e,this._logLevel=yA,this._logHandler=vA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?gA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ge.DEBUG,...e),this._logHandler(this,ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ge.VERBOSE,...e),this._logHandler(this,ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ge.INFO,...e),this._logHandler(this,ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ge.WARN,...e),this._logHandler(this,ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ge.ERROR,...e),this._logHandler(this,ge.ERROR,...e)}};const wA=(n,e)=>e.some(t=>n instanceof t);let Fg,Bg;function xA(){return Fg||(Fg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function EA(){return Bg||(Bg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ww=new WeakMap,Df=new WeakMap,xw=new WeakMap,Jh=new WeakMap,W0=new WeakMap;function IA(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(is(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ww.set(t,n)}).catch(()=>{}),W0.set(e,n),e}function TA(n){if(Df.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});Df.set(n,e)}let Af={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Df.get(n);if(e==="objectStoreNames")return n.objectStoreNames||xw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return is(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function DA(n){Af=n(Af)}function AA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Kh(this),e,...t);return xw.set(i,e.sort?e.sort():[e]),is(i)}:EA().includes(n)?function(...e){return n.apply(Kh(this),e),is(ww.get(this))}:function(...e){return is(n.apply(Kh(this),e))}}function CA(n){return typeof n=="function"?AA(n):(n instanceof IDBTransaction&&TA(n),wA(n,xA())?new Proxy(n,Af):n)}function is(n){if(n instanceof IDBRequest)return IA(n);if(Jh.has(n))return Jh.get(n);const e=CA(n);return e!==n&&(Jh.set(n,e),W0.set(e,n)),e}const Kh=n=>W0.get(n);function bA(n,e,{blocked:t,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,e),a=is(o);return i&&o.addEventListener("upgradeneeded",c=>{i(is(o.result),c.oldVersion,c.newVersion,is(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{r&&c.addEventListener("close",()=>r()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const kA=["get","getKey","getAll","getAllKeys","count"],SA=["put","add","delete","clear"],Qh=new Map;function Lg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Qh.get(e))return Qh.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=SA.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||kA.includes(t)))return;const r=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return i&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&c.done]))[0]};return Qh.set(e,r),r}DA(n=>({...n,get:(e,t,i)=>Lg(e,t)||n.get(e,t,i),has:(e,t)=>!!Lg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(RA(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function RA(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Cf="@firebase/app",Vg="0.9.25";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Js=new Sl("@firebase/app"),NA="@firebase/app-compat",MA="@firebase/analytics-compat",OA="@firebase/analytics",FA="@firebase/app-check-compat",BA="@firebase/app-check",LA="@firebase/auth",VA="@firebase/auth-compat",UA="@firebase/database",WA="@firebase/database-compat",HA="@firebase/functions",$A="@firebase/functions-compat",qA="@firebase/installations",zA="@firebase/installations-compat",GA="@firebase/messaging",YA="@firebase/messaging-compat",JA="@firebase/performance",KA="@firebase/performance-compat",QA="@firebase/remote-config",jA="@firebase/remote-config-compat",XA="@firebase/storage",ZA="@firebase/storage-compat",eC="@firebase/firestore",tC="@firebase/firestore-compat",nC="firebase",iC="10.7.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bf="[DEFAULT]",sC={[Cf]:"fire-core",[NA]:"fire-core-compat",[OA]:"fire-analytics",[MA]:"fire-analytics-compat",[BA]:"fire-app-check",[FA]:"fire-app-check-compat",[LA]:"fire-auth",[VA]:"fire-auth-compat",[UA]:"fire-rtdb",[WA]:"fire-rtdb-compat",[HA]:"fire-fn",[$A]:"fire-fn-compat",[qA]:"fire-iid",[zA]:"fire-iid-compat",[GA]:"fire-fcm",[YA]:"fire-fcm-compat",[JA]:"fire-perf",[KA]:"fire-perf-compat",[QA]:"fire-rc",[jA]:"fire-rc-compat",[XA]:"fire-gcs",[ZA]:"fire-gcs-compat",[eC]:"fire-fst",[tC]:"fire-fst-compat","fire-js":"fire-js",[nC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ma=new Map,kf=new Map;function rC(n,e){try{n.container.addComponent(e)}catch(t){Js.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ks(n){const e=n.name;if(kf.has(e))return Js.debug(`There were multiple attempts to register component ${e}.`),!1;kf.set(e,n);for(const t of Ma.values())rC(t,n);return!0}function Pl(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},ss=new yc("app","Firebase",oC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new hs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ss.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar=iC;function Rl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:bf,automaticDataCollectionEnabled:!1},e),s=i.name;if(typeof s!="string"||!s)throw ss.create("bad-app-name",{appName:String(s)});if(t||(t=mw()),!t)throw ss.create("no-options");const r=Ma.get(s);if(r){if(Pu(t,r.options)&&Pu(i,r.config))return r;throw ss.create("duplicate-app",{appName:s})}const o=new pA(s);for(const c of kf.values())o.addComponent(c);const a=new aC(t,i,o);return Ma.set(s,a),a}function Do(n=bf){const e=Ma.get(n);if(!e&&n===bf&&mw())return Rl();if(!e)throw ss.create("no-app",{appName:n});return e}function H0(){return Array.from(Ma.values())}function Kn(n,e,t){var i;let s=(i=sC[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Js.warn(a.join(" "));return}Ks(new hs(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC="firebase-heartbeat-database",uC=1,Oa="firebase-heartbeat-store";let jh=null;function Ew(){return jh||(jh=bA(cC,uC,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Oa)}}}).catch(n=>{throw ss.create("idb-open",{originalErrorMessage:n.message})})),jh}async function lC(n){try{return await(await Ew()).transaction(Oa).objectStore(Oa).get(Iw(n))}catch(e){if(e instanceof Ui)Js.warn(e.message);else{const t=ss.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Js.warn(t.message)}}}async function Ug(n,e){try{const i=(await Ew()).transaction(Oa,"readwrite");await i.objectStore(Oa).put(e,Iw(n)),await i.done}catch(t){if(t instanceof Ui)Js.warn(t.message);else{const i=ss.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Js.warn(i.message)}}}function Iw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC=1024,dC=30*24*60*60*1e3;class fC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new pC(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Wg();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=dC}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Wg(),{heartbeatsToSend:i,unsentEntries:s}=mC(this._heartbeatsCache.heartbeats),r=bu(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Wg(){return new Date().toISOString().substring(0,10)}function mC(n,e=hC){const t=[];let i=n.slice();for(const s of n){const r=t.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),Hg(t)>e){r.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Hg(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class pC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return eA()?tA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await lC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ug(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ug(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Hg(n){return bu(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(n){Ks(new hs("platform-logger",e=>new PA(e),"PRIVATE")),Ks(new hs("heartbeat",e=>new fC(e),"PRIVATE")),Kn(Cf,Vg,n),Kn(Cf,Vg,"esm2017"),Kn("fire-js","")}gC("");var yC="firebase",_C="10.7.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kn(yC,_C,"app");const Sf={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]};function Pf(n,e,t,i=!1){const s=String(e),r=(c,u)=>`\x1B[${u[0]}m${c}\x1B[${u[1]}m`,o=(c,u)=>u!=null&&typeof u=="string"?r(c,Sf[u]):u!=null&&Array.isArray(u)?u.reduce((l,h)=>o(l,h),c):u!=null&&u[c.trim()]!=null?o(c,u[c.trim()]):u!=null&&u["*"]!=null?o(c,u["*"]):c,a=null;return s.replace(/{{(.+?)}}/g,(c,u)=>{var h;const l=t[u]!=null?String(t[u]):i?"":c;return n.stylePrettyLogs?o(l,((h=n==null?void 0:n.prettyLogStyles)==null?void 0:h[u])??a)+r("",Sf.reset):l})}function gn(n,e=2,t=0){return n!=null&&isNaN(n)?"":(n=n!=null?n+t:n,e===2?n==null?"--":n<10?"0"+n:n.toString():n==null?"---":n<10?"00"+n:n<100?"0"+n:n.toString())}function vC(n){return{href:n.href,protocol:n.protocol,username:n.username,password:n.password,host:n.host,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search,searchParams:[...n.searchParams].map(([e,t])=>({key:e,value:t})),hash:n.hash,origin:n.origin}}function Tw(n){const e=new Set;return JSON.stringify(n,(t,i)=>{if(typeof i=="object"&&i!==null){if(e.has(i))return"[Circular]";e.add(i)}return i})}function Ot(n,e){const t={seen:[],stylize:Dw};return e!=null&&kw(t,e),Sr(t.showHidden)&&(t.showHidden=!1),Sr(t.depth)&&(t.depth=2),Sr(t.colors)&&(t.colors=!0),Sr(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=xC),Ru(t,n,t.depth)}Ot.colors=Sf;Ot.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function wC(n){return typeof n=="boolean"}function Sr(n){return n===void 0}function Dw(n){return n}function xC(n,e){var i,s,r,o;const t=Ot.styles[e];return t!=null&&((s=(i=Ot==null?void 0:Ot.colors)==null?void 0:i[t])==null?void 0:s[0])!=null&&((o=(r=Ot==null?void 0:Ot.colors)==null?void 0:r[t])==null?void 0:o[1])!=null?"\x1B["+Ot.colors[t][0]+"m"+n+"\x1B["+Ot.colors[t][1]+"m":n}function eu(n){return typeof n=="function"}function Aw(n){return typeof n=="string"}function EC(n){return typeof n=="number"}function Cw(n){return n===null}function bw(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Xh(n){return Nl(n)&&$0(n)==="[object RegExp]"}function Nl(n){return typeof n=="object"&&n!==null}function Zh(n){return Nl(n)&&($0(n)==="[object Error]"||n instanceof Error)}function $g(n){return Nl(n)&&$0(n)==="[object Date]"}function $0(n){return Object.prototype.toString.call(n)}function IC(n){const e={};return n.forEach(t=>{e[t]=!0}),e}function TC(n,e,t,i,s){const r=[];for(let o=0,a=e.length;o<a;++o)bw(e,String(o))?r.push(Rf(n,e,t,i,String(o),!0)):r.push("");return s.forEach(o=>{o.match(/^\d+$/)||r.push(Rf(n,e,t,i,o,!0))}),r}function ed(n){return"["+Error.prototype.toString.call(n)+"]"}function Ru(n,e,t=0){if(n.customInspect&&e!=null&&eu(e)&&(e==null?void 0:e.inspect)!==Ot&&!(e!=null&&e.constructor&&(e==null?void 0:e.constructor.prototype)===e)){if(typeof e.inspect!="function"&&e.toString!=null)return e.toString();let l=e==null?void 0:e.inspect(t,n);return Aw(l)||(l=Ru(n,l,t)),l}const i=Ki(n,e);if(i)return i;let s=Object.keys(e);const r=IC(s);try{n.showHidden&&Object.getOwnPropertyNames&&(s=Object.getOwnPropertyNames(e))}catch{}if(Zh(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return ed(e);if(s.length===0)if(eu(n.stylize)){if(eu(e)){const l=e.name?": "+e.name:"";return n.stylize("[Function"+l+"]","special")}if(Xh(e))return n.stylize(RegExp.prototype.toString.call(e),"regexp");if($g(e))return n.stylize(Date.prototype.toISOString.call(e),"date");if(Zh(e))return ed(e)}else return e;let o="",a=!1,c=[`{
`,`
}`];if(Array.isArray(e)&&(a=!0,c=[`[
`,`
]`]),eu(e)&&(o=" [Function"+(e.name?": "+e.name:"")+"]"),Xh(e)&&(o=" "+RegExp.prototype.toString.call(e)),$g(e)&&(o=" "+Date.prototype.toUTCString.call(e)),Zh(e)&&(o=" "+ed(e)),s.length===0&&(!a||e.length==0))return c[0]+o+c[1];if(t<0)return Xh(e)?n.stylize(RegExp.prototype.toString.call(e),"regexp"):n.stylize("[Object]","special");n.seen.push(e);let u;return a?u=TC(n,e,t,r,s):u=s.map(l=>Rf(n,e,t,r,l,a)),n.seen.pop(),DC(u,o,c)}function Rf(n,e,t,i,s,r){let o,a,c={value:void 0};try{c.value=e[s]}catch{}try{Object.getOwnPropertyDescriptor&&(c=Object.getOwnPropertyDescriptor(e,s)||c)}catch{}if(c.get?c.set?a=n.stylize("[Getter/Setter]","special"):a=n.stylize("[Getter]","special"):c.set&&(a=n.stylize("[Setter]","special")),bw(i,s)||(o="["+s+"]"),a||(n.seen.indexOf(c.value)<0?(Cw(t)?a=Ru(n,c.value,void 0):a=Ru(n,c.value,t-1),a.indexOf(`
`)>-1&&(r?a=a.split(`
`).map(u=>"  "+u).join(`
`).substr(2):a=`
`+a.split(`
`).map(u=>"   "+u).join(`
`))):a=n.stylize("[Circular]","special")),Sr(o)){if(r&&s.match(/^\d+$/))return a;o=JSON.stringify(""+s),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=n.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\\'").replace(/(^"|"$)/g,"'"),o=n.stylize(o,"string"))}return o+": "+a}function Ki(n,e){if(Sr(e))return n.stylize("undefined","undefined");if(Aw(e)){const t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\\'")+"'";return n.stylize(t,"string")}if(EC(e))return n.stylize(""+e,"number");if(wC(e))return n.stylize(""+e,"boolean");if(Cw(e))return n.stylize("null","null")}function DC(n,e,t){return t[0]+(e===""?"":e+`
`)+"  "+n.join(`,
  `)+" "+t[1]}function kw(n,e){if(!e||!Nl(e))return n;const t={...n},i={...e},s=Object.keys(e);let r=s.length;for(;r--;)t[s[r]]=i[s[r]];return n}function AC(n,...e){const t={seen:[],stylize:Dw};n!=null&&kw(t,n);const i=e[0];let s=0,r="",o="";if(typeof i=="string"){if(e.length===1)return i;let a,c=0;for(let u=0;u<i.length-1;u++)if(i.charCodeAt(u)===37){const l=i.charCodeAt(++u);if(s+1!==e.length){switch(l){case 115:{const h=e[++s];typeof h=="number"||typeof h=="bigint"?a=Ki(t,h):typeof h!="object"||h===null?a=String(h):a=Ot(h,{...n,compact:3,colors:!1,depth:0});break}case 106:a=Tw(e[++s]);break;case 100:{const h=e[++s];typeof h=="bigint"?a=Ki(t,h):typeof h=="symbol"?a="NaN":a=Ki(t,h);break}case 79:a=Ot(e[++s],n);break;case 111:a=Ot(e[++s],{...n,showHidden:!0,showProxy:!0,depth:4});break;case 105:{const h=e[++s];typeof h=="bigint"?a=Ki(t,h):typeof h=="symbol"?a="NaN":a=Ki(t,parseInt(a));break}case 102:{const h=e[++s];typeof h=="symbol"?a="NaN":a=Ki(t,parseInt(h));break}case 99:s+=1,a="";break;case 37:r+=i.slice(c,u),c=u+1;continue;default:continue}c!==u-1&&(r+=i.slice(c,u-1)),r+=a,c=u+1}else l===37&&(r+=i.slice(c,u),c=u+1)}c!==0&&(s++,o=" ",c<i.length&&(r+=i.slice(c)))}for(;s<e.length;){const a=e[s];r+=o,r+=typeof a!="string"?Ot(a,n):a,o=" ",s++}return r}const CC={getCallerStackFrame:Sw,getErrorTrace:Pw,getMeta:SC,transportJSON:NC,transportFormatted:RC,isBuffer:MC,isError:Nw,prettyFormatLogObj:PC,prettyFormatErrorObj:Mw};var rw;const bC={runtime:[typeof window,typeof document].includes("undefined")?"Generic":"Browser",browser:(rw=globalThis==null?void 0:globalThis.navigator)==null?void 0:rw.userAgent},kC=/(?:(?:file|https?|global code|[^@]+)@)?(?:file:)?((?:\/[^:/]+){2,})(?::(\d+))?(?::(\d+))?/;function SC(n,e,t,i,s,r){return Object.assign({},bC,{name:s,parentNames:r,date:new Date,logLevelId:n,logLevelName:e,path:i?void 0:Sw(t)})}function Sw(n,e=Error()){var t,i,s;return Rw((s=(i=(t=e==null?void 0:e.stack)==null?void 0:t.split(`
`))==null?void 0:i.filter(r=>!r.includes("Error: ")))==null?void 0:s[n])}function Pw(n){var e,t,i;return(i=(t=(e=n==null?void 0:n.stack)==null?void 0:e.split(`
`))==null?void 0:t.filter(s=>!s.includes("Error: ")))==null?void 0:i.reduce((s,r)=>(s.push(Rw(r)),s),[])}function Rw(n){var i;const e=(i=globalThis==null?void 0:globalThis.location)==null?void 0:i.origin,t={fullFilePath:void 0,fileName:void 0,fileNameWithLine:void 0,fileColumn:void 0,fileLine:void 0,filePath:void 0,filePathWithLine:void 0,method:void 0};if(n!=null){const s=n.match(kC);if(s){t.filePath=s[1].replace(/\?.*$/,""),t.fullFilePath=`${e}${t.filePath}`;const r=t.filePath.split("/");t.fileName=r[r.length-1],t.fileLine=s[2],t.fileColumn=s[3],t.filePathWithLine=`${t.filePath}:${t.fileLine}`,t.fileNameWithLine=`${t.fileName}:${t.fileLine}`}}return t}function Nw(n){return n instanceof Error}function PC(n,e){return n.reduce((t,i)=>(Nw(i)?t.errors.push(Mw(i,e)):t.args.push(i),t),{args:[],errors:[]})}function Mw(n,e){const t=Pw(n).map(s=>Pf(e,e.prettyErrorStackTemplate,{...s},!0)),i={errorName:` ${n.name} `,errorMessage:Object.getOwnPropertyNames(n).reduce((s,r)=>(r!=="stack"&&s.push(n[r]),s),[]).join(", "),errorStack:t.join(`
`)};return Pf(e,e.prettyErrorTemplate,i)}function RC(n,e,t,i){const s=(t.length>0&&e.length>0?`
`:"")+t.join(`
`);i.prettyInspectOptions.colors=i.stylePrettyLogs,console.log(n+AC(i.prettyInspectOptions,...e)+s)}function NC(n){console.log(Tw(n))}function MC(n){return!1}class OC{constructor(e,t,i=4){var s,r,o,a,c,u,l,h;this.logObj=t,this.stackDepthLevel=i,this.runtime=CC,this.settings={type:(e==null?void 0:e.type)??"pretty",name:e==null?void 0:e.name,parentNames:e==null?void 0:e.parentNames,minLevel:(e==null?void 0:e.minLevel)??0,argumentsArrayName:e==null?void 0:e.argumentsArrayName,hideLogPositionForProduction:(e==null?void 0:e.hideLogPositionForProduction)??!1,prettyLogTemplate:(e==null?void 0:e.prettyLogTemplate)??"{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}	{{logLevelName}}	{{filePathWithLine}}{{nameWithDelimiterPrefix}}	",prettyErrorTemplate:(e==null?void 0:e.prettyErrorTemplate)??`
{{errorName}} {{errorMessage}}
error stack:
{{errorStack}}`,prettyErrorStackTemplate:(e==null?void 0:e.prettyErrorStackTemplate)??`   {{fileName}}	{{method}}
	{{filePathWithLine}}`,prettyErrorParentNamesSeparator:(e==null?void 0:e.prettyErrorParentNamesSeparator)??":",prettyErrorLoggerNameDelimiter:(e==null?void 0:e.prettyErrorLoggerNameDelimiter)??"	",stylePrettyLogs:(e==null?void 0:e.stylePrettyLogs)??!0,prettyLogTimeZone:(e==null?void 0:e.prettyLogTimeZone)??"UTC",prettyLogStyles:(e==null?void 0:e.prettyLogStyles)??{logLevelName:{"*":["bold","black","bgWhiteBright","dim"],SILLY:["bold","white"],TRACE:["bold","whiteBright"],DEBUG:["bold","green"],INFO:["bold","blue"],WARN:["bold","yellow"],ERROR:["bold","red"],FATAL:["bold","redBright"]},dateIsoStr:"white",filePathWithLine:"white",name:["white","bold"],nameWithDelimiterPrefix:["white","bold"],nameWithDelimiterSuffix:["white","bold"],errorName:["bold","bgRedBright","whiteBright"],fileName:["yellow"],fileNameWithLine:"white"},prettyInspectOptions:(e==null?void 0:e.prettyInspectOptions)??{colors:!0,compact:!1,depth:1/0},metaProperty:(e==null?void 0:e.metaProperty)??"_meta",maskPlaceholder:(e==null?void 0:e.maskPlaceholder)??"[***]",maskValuesOfKeys:(e==null?void 0:e.maskValuesOfKeys)??["password"],maskValuesOfKeysCaseInsensitive:(e==null?void 0:e.maskValuesOfKeysCaseInsensitive)??!1,maskValuesRegEx:e==null?void 0:e.maskValuesRegEx,prefix:[...(e==null?void 0:e.prefix)??[]],attachedTransports:[...(e==null?void 0:e.attachedTransports)??[]],overwrite:{mask:(s=e==null?void 0:e.overwrite)==null?void 0:s.mask,toLogObj:(r=e==null?void 0:e.overwrite)==null?void 0:r.toLogObj,addMeta:(o=e==null?void 0:e.overwrite)==null?void 0:o.addMeta,addPlaceholders:(a=e==null?void 0:e.overwrite)==null?void 0:a.addPlaceholders,formatMeta:(c=e==null?void 0:e.overwrite)==null?void 0:c.formatMeta,formatLogObj:(u=e==null?void 0:e.overwrite)==null?void 0:u.formatLogObj,transportFormatted:(l=e==null?void 0:e.overwrite)==null?void 0:l.transportFormatted,transportJSON:(h=e==null?void 0:e.overwrite)==null?void 0:h.transportJSON}}}log(e,t,...i){var h,f,m,p,y,g,x,_,v,w,I,T,D,C;if(e<this.settings.minLevel)return;const s=[...this.settings.prefix,...i],r=((h=this.settings.overwrite)==null?void 0:h.mask)!=null?(f=this.settings.overwrite)==null?void 0:f.mask(s):this.settings.maskValuesOfKeys!=null&&this.settings.maskValuesOfKeys.length>0?this._mask(s):s,o=this.logObj!=null?this._recursiveCloneAndExecuteFunctions(this.logObj):void 0,a=((m=this.settings.overwrite)==null?void 0:m.toLogObj)!=null?(p=this.settings.overwrite)==null?void 0:p.toLogObj(r,o):this._toLogObj(r,o),c=((y=this.settings.overwrite)==null?void 0:y.addMeta)!=null?(g=this.settings.overwrite)==null?void 0:g.addMeta(a,e,t):this._addMetaToLogObj(a,e,t);let u,l;return((x=this.settings.overwrite)==null?void 0:x.formatMeta)!=null&&(u=(_=this.settings.overwrite)==null?void 0:_.formatMeta(c==null?void 0:c[this.settings.metaProperty])),((v=this.settings.overwrite)==null?void 0:v.formatLogObj)!=null&&(l=(w=this.settings.overwrite)==null?void 0:w.formatLogObj(r,this.settings)),this.settings.type==="pretty"&&(u=u??this._prettyFormatLogObjMeta(c==null?void 0:c[this.settings.metaProperty]),l=l??this.runtime.prettyFormatLogObj(r,this.settings)),u!=null&&l!=null?((I=this.settings.overwrite)==null?void 0:I.transportFormatted)!=null?(T=this.settings.overwrite)==null||T.transportFormatted(u,l.args,l.errors,this.settings):this.runtime.transportFormatted(u,l.args,l.errors,this.settings):((D=this.settings.overwrite)==null?void 0:D.transportJSON)!=null?(C=this.settings.overwrite)==null||C.transportJSON(c):this.settings.type!=="hidden"&&this.runtime.transportJSON(c),this.settings.attachedTransports!=null&&this.settings.attachedTransports.length>0&&this.settings.attachedTransports.forEach(R=>{R(c)}),c}attachTransport(e){this.settings.attachedTransports.push(e)}getSubLogger(e,t){var r,o,a;const i={...this.settings,...e,parentNames:((r=this.settings)==null?void 0:r.parentNames)!=null&&((o=this.settings)==null?void 0:o.name)!=null?[...this.settings.parentNames,this.settings.name]:((a=this.settings)==null?void 0:a.name)!=null?[this.settings.name]:void 0,prefix:[...this.settings.prefix,...(e==null?void 0:e.prefix)??[]]};return new this.constructor(i,t??this.logObj,this.stackDepthLevel)}_mask(e){const t=this.settings.maskValuesOfKeysCaseInsensitive!==!0?this.settings.maskValuesOfKeys:this.settings.maskValuesOfKeys.map(i=>i.toLowerCase());return e==null?void 0:e.map(i=>this._recursiveCloneAndMaskValuesOfKeys(i,t))}_recursiveCloneAndMaskValuesOfKeys(e,t,i=[]){var s,r;if(i.includes(e))return{...e};if(typeof e=="object"&&e!==null&&i.push(e),this.runtime.isError(e)||this.runtime.isBuffer(e))return e;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Array.isArray(e))return e.map(o=>this._recursiveCloneAndMaskValuesOfKeys(o,t,i));if(e instanceof Date)return new Date(e.getTime());if(e instanceof URL)return vC(e);if(e!==null&&typeof e=="object"){const o=this.runtime.isError(e)?this._cloneError(e):Object.create(Object.getPrototypeOf(e));return Object.getOwnPropertyNames(e).reduce((a,c)=>{var u;return a[c]=t.includes(((u=this.settings)==null?void 0:u.maskValuesOfKeysCaseInsensitive)!==!0?c:c.toLowerCase())?this.settings.maskPlaceholder:this._recursiveCloneAndMaskValuesOfKeys(e[c],t,i),a},o)}else{if(typeof e=="string"){let o=e;for(const a of((s=this.settings)==null?void 0:s.maskValuesRegEx)||[])o=o.replace(a,((r=this.settings)==null?void 0:r.maskPlaceholder)||"");return o}return e}}_recursiveCloneAndExecuteFunctions(e,t=[]){return this.isObjectOrArray(e)&&t.includes(e)?this.shallowCopy(e):(this.isObjectOrArray(e)&&t.push(e),Array.isArray(e)?e.map(i=>this._recursiveCloneAndExecuteFunctions(i,t)):e instanceof Date?new Date(e.getTime()):this.isObject(e)?Object.getOwnPropertyNames(e).reduce((i,s)=>{const r=Object.getOwnPropertyDescriptor(e,s);if(r){Object.defineProperty(i,s,r);const o=e[s];i[s]=typeof o=="function"?o():this._recursiveCloneAndExecuteFunctions(o,t)}return i},Object.create(Object.getPrototypeOf(e))):e)}isObjectOrArray(e){return typeof e=="object"&&e!==null}isObject(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null}shallowCopy(e){return Array.isArray(e)?[...e]:{...e}}_toLogObj(e,t={}){return e=e==null?void 0:e.map(i=>this.runtime.isError(i)?this._toErrorObject(i):i),this.settings.argumentsArrayName==null?e.length===1&&!Array.isArray(e[0])&&this.runtime.isBuffer(e[0])!==!0&&!(e[0]instanceof Date)?t=typeof e[0]=="object"&&e[0]!=null?{...e[0],...t}:{0:e[0],...t}:t={...t,...e}:t={...t,[this.settings.argumentsArrayName]:e},t}_cloneError(e){const t=new e.constructor;return Object.getOwnPropertyNames(e).forEach(i=>{t[i]=e[i]}),t}_toErrorObject(e){return{nativeError:e,name:e.name??"Error",message:e.message,stack:this.runtime.getErrorTrace(e)}}_addMetaToLogObj(e,t,i){return{...e,[this.settings.metaProperty]:this.runtime.getMeta(t,i,this.stackDepthLevel,this.settings.hideLogPositionForProduction,this.settings.name,this.settings.parentNames)}}_prettyFormatLogObjMeta(e){var o,a,c,u,l,h,f,m,p,y,g,x,_,v,w,I,T,D,C,R,E,A;if(e==null)return"";let t=this.settings.prettyLogTemplate;const i={};t.includes("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}")?t=t.replace("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}","{{dateIsoStr}}"):this.settings.prettyLogTimeZone==="UTC"?(i.yyyy=((o=e==null?void 0:e.date)==null?void 0:o.getUTCFullYear())??"----",i.mm=gn((a=e==null?void 0:e.date)==null?void 0:a.getUTCMonth(),2,1),i.dd=gn((c=e==null?void 0:e.date)==null?void 0:c.getUTCDate(),2),i.hh=gn((u=e==null?void 0:e.date)==null?void 0:u.getUTCHours(),2),i.MM=gn((l=e==null?void 0:e.date)==null?void 0:l.getUTCMinutes(),2),i.ss=gn((h=e==null?void 0:e.date)==null?void 0:h.getUTCSeconds(),2),i.ms=gn((f=e==null?void 0:e.date)==null?void 0:f.getUTCMilliseconds(),3)):(i.yyyy=((m=e==null?void 0:e.date)==null?void 0:m.getFullYear())??"----",i.mm=gn((p=e==null?void 0:e.date)==null?void 0:p.getMonth(),2,1),i.dd=gn((y=e==null?void 0:e.date)==null?void 0:y.getDate(),2),i.hh=gn((g=e==null?void 0:e.date)==null?void 0:g.getHours(),2),i.MM=gn((x=e==null?void 0:e.date)==null?void 0:x.getMinutes(),2),i.ss=gn((_=e==null?void 0:e.date)==null?void 0:_.getSeconds(),2),i.ms=gn((v=e==null?void 0:e.date)==null?void 0:v.getMilliseconds(),3));const s=this.settings.prettyLogTimeZone==="UTC"?e==null?void 0:e.date:new Date(((w=e==null?void 0:e.date)==null?void 0:w.getTime())-((I=e==null?void 0:e.date)==null?void 0:I.getTimezoneOffset())*6e4);i.rawIsoStr=s==null?void 0:s.toISOString(),i.dateIsoStr=s==null?void 0:s.toISOString().replace("T"," ").replace("Z",""),i.logLevelName=e==null?void 0:e.logLevelName,i.fileNameWithLine=((T=e==null?void 0:e.path)==null?void 0:T.fileNameWithLine)??"",i.filePathWithLine=((D=e==null?void 0:e.path)==null?void 0:D.filePathWithLine)??"",i.fullFilePath=((C=e==null?void 0:e.path)==null?void 0:C.fullFilePath)??"";let r=(R=this.settings.parentNames)==null?void 0:R.join(this.settings.prettyErrorParentNamesSeparator);return r=r!=null&&(e==null?void 0:e.name)!=null?r+this.settings.prettyErrorParentNamesSeparator:void 0,i.name=(e==null?void 0:e.name)!=null||r!=null?(r??"")+(e==null?void 0:e.name):"",i.nameWithDelimiterPrefix=i.name.length>0?this.settings.prettyErrorLoggerNameDelimiter+i.name:"",i.nameWithDelimiterSuffix=i.name.length>0?i.name+this.settings.prettyErrorLoggerNameDelimiter:"",((E=this.settings.overwrite)==null?void 0:E.addPlaceholders)!=null&&((A=this.settings.overwrite)==null||A.addPlaceholders(e,i)),Pf(this.settings,t,i)}}class FC extends OC{constructor(e,t){const i=typeof window<"u"&&typeof document<"u",s=i?window.chrome!==void 0&&window.CSS!==void 0&&window.CSS.supports("color","green"):!1,r=i?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1;e=e||{},e.stylePrettyLogs=e.stylePrettyLogs&&i&&!s?!1:e.stylePrettyLogs,super(e,t,r?4:5)}log(e,t,...i){return super.log(e,t,...i)}silly(...e){return super.log(0,"SILLY",...e)}trace(...e){return super.log(1,"TRACE",...e)}debug(...e){return super.log(2,"DEBUG",...e)}info(...e){return super.log(3,"INFO",...e)}warn(...e){return super.log(4,"WARN",...e)}error(...e){return super.log(5,"ERROR",...e)}fatal(...e){return super.log(6,"FATAL",...e)}getSubLogger(e,t){return super.getSubLogger(e,t)}}const de=new FC({minLevel:4});var BC=(n=>(n.login="login",n.enter="enter",n))(BC||{});const o5={login:"login",enter:"enter"},a5=["+972-504040624","+972-525656377"],LC=new Date(2024,0,9,20,0),VC="production",je=`enviroments/${VC}`,en="Users",Ow="BookingsObjects",UC="Notifications",c5="Errors",u5="Helpers",at="PublicData",sn="Workers",td="Invoices",nd="PaymentRequests",da="Bookings",Hn="Phones",wr="collections",Tt="Businesses",qg="PaymentsRequestsPreviews",l5="Reports",h5="customersData",WC="publicCustomersData",zg="clients",nn="publicData",HC="scheduleNotifications",Fw="recurrenceEvents",Bw="recurrenceBookings",Lw="multiEventsTimes",d5="BookingsEvents",Gg="LikesCollection",Yg="BusinessData",$C="Counters",qC="sasimple",zC="phone",Jg="^&8@^",Kg="^&9@^";var Nf=(n=>(n[n.add=0]="add",n[n.remove=1]="remove",n))(Nf||{}),fa=(n=>(n[n.increment=0]="increment",n[n.decrement=1]="decrement",n))(fa||{}),Ss=(n=>(n[n.basic=0]="basic",n[n.advanced=1]="advanced",n[n.trial=2]="trial",n[n.landingPage=3]="landingPage",n[n.golden=4]="golden",n))(Ss||{}),Y;let V=(Y=class{constructor({days:e=0,hours:t=0,minutes:i=0,seconds:s=0,milliseconds:r=0,microseconds:o=0}){d(this,"_duration");d(this,"days",0);d(this,"hours",0);d(this,"minutes",0);d(this,"seconds",0);d(this,"milliseconds",0);d(this,"microseconds",0);this._duration=o+Y.microsecondsPerMillisecond*r+Y.microsecondsPerSecond*s+Y.microsecondsPerMinute*i+Y.microsecondsPerHour*t+Y.microsecondsPerDay*e}static _microseconds(e){return new Y({microseconds:e})}add(e){return Y._microseconds(this._duration+e._duration)}subtract(e){return Y._microseconds(this._duration-e._duration)}multiply(e){return Y._microseconds(Math.round(this._duration*e))}divide(e){if(e===0)throw new Error("IntegerDivisionByZeroException");return Y._microseconds(Math.floor(this._duration/e))}lessThan(e){return this._duration<e._duration}greaterThan(e){return this._duration>e._duration}lessThanOrEqual(e){return this._duration<=e._duration}greaterThanOrEqual(e){return this._duration>=e._duration}get inDays(){return Math.floor(this._duration/Y.microsecondsPerDay)}get inHours(){return Math.floor(this._duration/Y.microsecondsPerHour)}get inMinutes(){return Math.floor(this._duration/Y.microsecondsPerMinute)}get inSeconds(){return Math.floor(this._duration/Y.microsecondsPerSecond)}get inMilliseconds(){return Math.floor(this._duration/Y.microsecondsPerMillisecond)}get inMicroseconds(){return this._duration}equals(e){return e instanceof Y&&this._duration===e.inMicroseconds}compareTo(e){return this._duration-e._duration}},d(Y,"microsecondsPerMillisecond",1e3),d(Y,"millisecondsPerSecond",1e3),d(Y,"secondsPerMinute",60),d(Y,"minutesPerHour",60),d(Y,"hoursPerDay",24),d(Y,"microsecondsPerSecond",Y.microsecondsPerMillisecond*Y.millisecondsPerSecond),d(Y,"microsecondsPerMinute",Y.microsecondsPerSecond*Y.secondsPerMinute),d(Y,"microsecondsPerHour",Y.microsecondsPerMinute*Y.minutesPerHour),d(Y,"microsecondsPerDay",Y.microsecondsPerHour*Y.hoursPerDay),d(Y,"millisecondsPerMinute",Y.millisecondsPerSecond*Y.secondsPerMinute),d(Y,"millisecondsPerHour",Y.millisecondsPerMinute*Y.minutesPerHour),d(Y,"millisecondsPerDay",Y.millisecondsPerHour*Y.hoursPerDay),d(Y,"secondsPerHour",Y.secondsPerMinute*Y.minutesPerHour),d(Y,"secondsPerDay",Y.secondsPerHour*Y.hoursPerDay),d(Y,"minutesPerDay",Y.minutesPerHour*Y.hoursPerDay),d(Y,"zero",new Y({seconds:0})),Y);var Bt=(n=>(n.waiting="waiting",n.approved="approved",n))(Bt||{});const Vw={waiting:"waiting",approved:"approved"},Uw={waiting:"waiting",approved:"approved"};var _n=(n=>(n.app="app",n.web="web",n.byWorker="byWorker",n))(_n||{});const Ww={app:"app",web:"web",byWorker:"byWorker"},Hw={app:"app",web:"web",byWorker:"byWorker"};var Gt=(n=>(n.regular="regular",n.confirmArrival="confirmArrival",n))(Gt||{});const Or={regular:"regular",confirmArrival:"confirmArrival"},Ns={regular:"regular",confirmArrival:"confirmArrival"};var Z=(n=>(n[n.message=0]="message",n[n.push=1]="push",n[n.none=2]="none",n[n.whatsapp=3]="whatsapp",n))(Z||{});const GC={0:"message",1:"push",2:"none",3:"whatsapp"},$w={message:0,push:1,whatsapp:3,none:2},Qg=new V({hours:3}),f5=new V({minutes:5});var ie=(n=>(n[n.sendSms=0]="sendSms",n[n.updateDisplayName=1]="updateDisplayName",n[n.logout=2]="logout",n[n.serverError=3]="serverError",n[n.storageError=4]="storageError",n[n.listener=5]="listener",n[n.notLogedIn=6]="notLogedIn",n[n.illegalFields=7]="illegalFields",n[n.passedLimit=8]="passedLimit",n[n.notFoundItem=9]="notFoundItem",n[n.takenBooking=10]="takenBooking",n[n.overlapWithOntherItem=11]="overlapWithOntherItem",n[n.takenMultiBooking=12]="takenMultiBooking",n[n.alreadyWorker=13]="alreadyWorker",n[n.userNotFound=14]="userNotFound",n[n.verification=15]="verification",n[n.network=16]="network",n[n.emptyField=17]="emptyField",n[n.alreadyExistItem=18]="alreadyExistItem",n[n.uploadImages=19]="uploadImages",n[n.notSelectedImages=20]="notSelectedImages",n[n.wrongOptCode=21]="wrongOptCode",n[n.expiredOpt=22]="expiredOpt",n[n.unknown=23]="unknown",n[n.timeout=24]="timeout",n[n.purchaseError=25]="purchaseError",n[n.anonymouslySignIn=26]="anonymouslySignIn",n[n.lowSubType=27]="lowSubType",n[n.coincidingEvent=28]="coincidingEvent",n[n.coincidingHoliday=29]="coincidingHoliday",n[n.realTimeServerError=30]="realTimeServerError",n[n.blockedUser=31]="blockedUser",n[n.noPermission=32]="noPermission",n[n.paymentProblem=33]="paymentProblem",n[n.currentlyOrderingForTime=34]="currentlyOrderingForTime",n[n.notFoundBusiness=35]="notFoundBusiness",n[n.savePaymentDataError=36]="savePaymentDataError",n[n.redeemDepositError=37]="redeemDepositError",n[n.saveDepositDataError=38]="saveDepositDataError",n[n.endOfWork=39]="endOfWork",n[n.invoiceCreation=40]="invoiceCreation",n[n.cantBookRecurrenceOnDates=41]="cantBookRecurrenceOnDates",n[n.cantBookRecurrenceOnEndlessDates=42]="cantBookRecurrenceOnEndlessDates",n[n.eventHasNoAccurances=43]="eventHasNoAccurances",n[n.workerDeleteTheBookingMeanwhile=44]="workerDeleteTheBookingMeanwhile",n[n.workerUpdatedTheBookingMeanwhile=45]="workerUpdatedTheBookingMeanwhile",n[n.workerDeleteEventMeanwhile=46]="workerDeleteEventMeanwhile",n[n.workerUpdatedTheBookingWhilePayment=47]="workerUpdatedTheBookingWhilePayment",n[n.blockCard=48]="blockCard",n[n.stolenCard=49]="stolenCard",n[n.callCreditCompany=50]="callCreditCompany",n[n.transactionNotConfirmed=51]="transactionNotConfirmed",n[n.fakeCard=52]="fakeCard",n[n.wrongCVV=53]="wrongCVV",n[n.worngCAVVUCAF=54]="worngCAVVUCAF",n[n.worngAvs=55]="worngAvs",n[n.networkDisconnect=56]="networkDisconnect",n[n.partlyConfirm=57]="partlyConfirm",n[n.lackOfPointsStarsMilesOtherBenefit=58]="lackOfPointsStarsMilesOtherBenefit",n[n.unauthorizedCardAtTheTerminal=59]="unauthorizedCardAtTheTerminal",n[n.invalidBalanceCode=60]="invalidBalanceCode",n[n.cardNotAssociatedWithTheNetwork=61]="cardNotAssociatedWithTheNetwork",n[n.cardIsNotValid=62]="cardIsNotValid",n[n.currencyTypeIsNotAllowed=63]="currencyTypeIsNotAllowed",n[n.thereIsNoAuthorizationForACreditTypeInTheTransaction=64]="thereIsNoAuthorizationForACreditTypeInTheTransaction",n[n.invalidId=65]="invalidId",n[n.noTreatment=66]="noTreatment",n[n.terminalNotAuthorizedToWorkWithThisMethodTheTerminalIsNotAuthorized=67]="terminalNotAuthorizedToWorkWithThisMethodTheTerminalIsNotAuthorized",n[n.authenticationErrorTerminalReference=68]="authenticationErrorTerminalReference",n[n.exceedingTheNumberOfPayments=69]="exceedingTheNumberOfPayments",n[n.communicationError=70]="communicationError",n[n.canceledTransaction=71]="canceledTransaction",n[n.invalidToken=72]="invalidToken",n[n.terminalNotAuthorizedToUseTheToken=73]="terminalNotAuthorizedToUseTheToken",n[n.deferredCharge=74]="deferredCharge",n[n.approvalWithoutCharge=75]="approvalWithoutCharge",n[n.receivingTransactionDetails=76]="receivingTransactionDetails",n[n.theCardDetailsWereNotReadInFull=77]="theCardDetailsWereNotReadInFull",n[n.theAmountOfTheItemsDoesNotMatch=78]="theAmountOfTheItemsDoesNotMatch",n[n.YouMustEnterAFirstOrLastName=79]="YouMustEnterAFirstOrLastName",n[n.transactionDescriptionMustBeEntered=80]="transactionDescriptionMustBeEntered",n[n.youCanCreditTheEntireTransactionOrASmallAmount=81]="youCanCreditTheEntireTransactionOrASmallAmount",n[n.bigDiffrentBetweenLoginAndDelete=82]="bigDiffrentBetweenLoginAndDelete",n[n.providerNotAllowed=83]="providerNotAllowed",n[n.userDisable=84]="userDisable",n[n.providerAlreadyLinked=85]="providerAlreadyLinked",n[n.credentialAlreadyInUse=86]="credentialAlreadyInUse",n[n.accountAlreadyExists=87]="accountAlreadyExists",n[n.invalidCredential=88]="invalidCredential",n[n.userMissmatch=89]="userMissmatch",n[n.noSuchProvider=90]="noSuchProvider",n[n.duplicateBusinesssName=91]="duplicateBusinesssName",n[n.alreadyExistPhone=92]="alreadyExistPhone",n[n.userExitManually=93]="userExitManually",n[n.tooManyAttempts=94]="tooManyAttempts",n[n.expiredCode=95]="expiredCode",n[n.cantUpdateEmailTooShortTimeBetween=96]="cantUpdateEmailTooShortTimeBetween",n[n.cantUpdatePhonelTooShortTimeBetween=97]="cantUpdatePhonelTooShortTimeBetween",n[n.invalidPhoneNumber=98]="invalidPhoneNumber",n))(ie||{});const Cl=class Cl{constructor(){d(this,"errorCode",100);d(this,"error",ie.unknown);d(this,"details","")}static GI(){return this._singleton}addError({code:e,error:t,details:i}){this.error=t||this.error,this.errorCode=e||this.errorCode,this.details=i||this.details}};d(Cl,"_singleton",new Cl);let ve=Cl;class gi{constructor({code:e="",name:t="",symbol:i=""}={}){d(this,"code","");d(this,"name","");d(this,"symbol","");this.code=e,this.name=t,this.symbol=i}static fromJson(e){return new gi({code:e.code||"",name:e.name||"",symbol:e.symbol||""})}toJson(){return{code:this.code,name:this.name,symbol:this.symbol}}isEqual(e){return e.code===this.code}toString(){return JSON.stringify(this.toJson(),null,2)}}const Ci=new gi({code:"USD",name:"US Dollar",symbol:"$"}),jg={ILS:new gi({code:"ILS",name:"Israel Shekel",symbol:""}),USD:new gi({code:"USD",name:"United States Dollar",symbol:"$"}),EUR:new gi({code:"EUR",name:"Euro",symbol:""}),GBP:new gi({code:"GBP",name:"British Pound",symbol:""})},gu=5,YC="https://icom.yaad.net/cgi-bin/yaadpay/yaadpay3ds.pl?Masof=MASOFNUMBER&action=PrintHesh&asm=INVOICENUMBER&type=PDF&signature=SIGNATURE";class gt{}d(gt,"currentBusinesssId",""),d(gt,"hasPaddingFromTop",!1),d(gt,"paddingFromTop",0),d(gt,"attemptsLeftForCardPassword",gu),d(gt,"productionVersion",!0),d(gt,"developers",{});const Pa=class Pa{constructor(){}static GI(){return Pa._singleton}getLisksChildPath(e){const t=`${Tt}/${gt.currentBusinesssId}/${sn}`,i=`${e}/${Gg}`;return`${t}/${i}`}getImageStorageName(e,t){const i=e.toUpperCase(),s=t.split(i);return`${i}${s[1].split(".jpg")[0]}`}getLikesChildPath(e,t,i){const s=`${Tt}/${t}/${sn}`,r=`${e}/${Gg}`;return`${s}/${r}/${i}`}getBusinessDataPath(e){return`${Tt}/${e}/${Yg}`}getWorkerCountersPath(e,t){return`${Tt}/${e}/${sn}/${t}/${$C}`}getMessageCounterPath(e){return`${Tt}/${e}/${Yg}/messagesCounter`}userBookingsPathByBooking(e){return`${en}/${e.customerId}/${at}/${nn}/${da}`}userBookingsPathByUser(e){return`${en}/${e}/${at}/${nn}/${da}`}workerBookingsPath(e){return`${Tt}/${e.buisnessId}/${sn}/${e.workerId}/${at}/${nn}/${Ow}`}};d(Pa,"_singleton",new Pa);let Fa=Pa;const Xg="data:image/webp;base64,UklGRjgGAABXRUJQVlA4WAoAAAAQAAAAfwAAfwAAQUxQSC8DAAABoEbb1iFJehGJtm3btu1S27Zt27Zt27a7x3ZZWcyM+MYT8b77/Z6ImAD63/+y6umL+I2ZPWdM26LplZS6wa7vfOJvve/mFVJOtulfJYh/HTzOpZRsU8PFfzYOpVBIg4/CSnOcMlIujhbWJh7fNLqSSwG5TxjCzl/XF9bA5bwn7I7YXRJalqvCfvPzAA2XvsdkIETyPCesgV7B0zvfAapwuOCa2AeT65LgG1IFUptkRuKkBsh5VXBObAyoRCwrcc2JZ7rgHVkLz01mYjUc7Rdub9OiSe/jllAeTWnBfhqaJvxOoenD71s04/mZmcHM5ycaglkuwTAwKyRYAmapBFvBzJFgH5iREhwFEyTBaTDVlJfZ5HcEDP3Mbx+a6/y2gNGf8LvmwlLI5BdaHUszwd8bhKW9BL6uWBpLkByIpaIEnoZYspr8QgtioR/4vXeBOcHvIIFt6eNmtkGT/jm3Vw401DiY1691CW+bTxmZb9sS4raMTuciyJl/ZuNpRZi1LWyeZgFFbT1MjPmE2nmTybd5YJEfkzWEW3/JIrIUMPLzMTCW6chSnmDwWQmCXvk32xKHE/jxhl0nneiynrUpuCTBL/GTLbFBpMDmYTaY8x0qoH4J1p12kRL1OT6rLmYmRepDDGuuZiZl6p9b04UU+t6azsrrpJJ31nRWyVtruqnkgzXdVfKpNT1U8pnyPrGmpzK0klNjrXncJb0SnPUO/uQVFid8OjMfOC13263fGsLWpHtjamZB5Srbf/dXyYJh1NN1QXl0JFrG3IWrdZp1/GOoV7BNCn6+b1KXuiWyp9Tky9161e0Qn5DUCLsxrUZmqfSySz8zhOSxd4dllsZZ61SkQGh8MyW3JFMSBMx3fmmkaPgKh0jsJwWlXJ6AIn5rWjlID3iN4UNTnaRNt9wjn2d+epK6+E1DrpjrhUl2d8Azrzzm424uApgq6Lkhh/koIBWhbH0zkV/M9dY6AdXLLf7U4GT+tLAkwU3b8lA0l6gDrdMR5pR+u7702BX5yW6/NITcXSxw3d2fk6wxfn60LqCwixTozFKkw9Sdl599E+wxhTA8IV88u7B9UofCmdwkIwBWUDgg4gIAAPASAJ0BKoAAgAA+kUSdSaWkIyEpGAlgsBIJZw3CxcSlHkyPOhk26d2xRwWRYrXywLe8+2egAWMopyguMLJ9ZV1BQaqnj7//iRNIvo+LtU9x5ugDP7vnIlo5PLSXrhJOdyOWq+Bw+jHNKm77brKdRA9KbslKAWeeBAuw3Y2IwABVRdFp31z1AYVORUZ8cebhypTJMwr25HaP6zuhvCaZuIAA/vtAAAAjPSWfXf3X//5OXa7NBHF1z39ZDkUHadB/b5WUA/accoSgsvvE45IP83v09GbK44YxQJsK+Q/O5c5E4YAi192+zzvsh6/A8wKpB73LNYfVgjifBkCbXsawjlgdnJO9KIuCtcYAQ1jlbyD0WYZHxKshat5QwPow3oJn3tLFUVxh4TR76jOjaUwc30/cJt+Rv4/9fvG3m0K5kEGrA/scZJo2rk1eUu3Wcpq+8ni7nu72VaL3gncqrH85o4iH+rfhr3arHWFTfrSoyDmKH6FdwDexpzhAxaOC7InGD2Mf3ZKPNBR/inH+6lPzSNMbIYDzf+F5mnWwubmt0WYD4RfkvA9EgM47lMaerBBoxFPTNXHr+lBIO66//MpxuQboAGW5y/n55f1f/NXZ3JT1sS0/zP/PsP3wxsDpd0EyVnotv8JwHzQPHx7nT/jT//+yi4gDTB9g8Ah5XCMV9qzES1Fkp2BY+3gftkJDLTYuiR6w27amLzJiEM7dh+oR65grCa9BDygHbrvejEqvmV+myfwOZpyVH7ivBGNqLvP/k7MUmx70y7/fdlpIAZRl6tY12CYjzuqXJht09bh63kTdYlu8ZqTHCy/P+t3GQ1GFyItGe2iMBJwDJEiMVUnLsEQXMIgG4obGvf7CPwuLHgSmwb+LTxsJAoNB+qehoNNkrGvc3SqlRptENGUJyixGaTrqQ//dbwWUq4TQ4hgGhZjkpwhSwC5kdh7/7ODeeWhoAW37bOvhIhUQPX2X0Ji6AAAAAA==",JC="data:image/webp;base64,UklGRgwJAABXRUJQVlA4WAoAAAAQAAAAfwAAfwAAQUxQSLIDAAABoEVtmyFJisyqrLFt27Zt2/bMnda2bdvW2LbZNgqT5cqINeL76m4vImICxP83Wh3XvLj9/PWUy4c/vX9y7WRjlOr1dEpC/d3oidsbGUmk9Kx9IfXPU+6vkTTa/hRU/2ri+BAzKZS9LU/965EX6rAr233B5u8d9R/K/Z2ZVRjyzkWfo/7rtBkmK3PID2Gl5c1VLk5VHwwpXYuWm4yabnOUvt6ZhFpcUFrndqTT4LDS/GgVMuW+V7rL100q5uOOdio8iMrIsAI85iFS9ZRClCuJbEhAqOOVaNS8rDATc2jcqlB/tkiULIDxdyIxSeHeyaHkXqBzJoWOESDZhsIDCnkzg1InofaYBNqGoTKrElipoKMD8IyvsdQdeGUKwb614DpLsJRKcGsVeKQl3Kdocjpa6Uto6h60JkVwP6D1ceCuoc1V8BEP2AN4qhuW62sC87FKHCFwN1a5KwTewqqaReB7rHpeAkctqGZhAjfKQbV3CBTUgBqqCAaaQc1kEOoEtYpBfAjU7QycqVCPM1BLoV6jcDfUZxSeg9pO4QOooxS+M5EuUthlAZkpFA6VBCqZTeFkaaAKRRQulAGq5qdwpTxQTZtCSkWgOmEKmZWB6kUp5FQFqh+jkFcNqEGcQkH1ZFdUA6h+jEIxUt0oBW9NoDrhZFfDTnaVvcmubD6FohpA7nQKhUjiMoX86kjHKORWRdpKIbMK0vsUUishPU/hWnmk2yhcLIu0lMKZMkjjKBwtidTBYbDXg9TIZrDVjVQ5i8FXArnUKQZvQ7k+ZvAolNjEYC3WCInnTMFq4cWL9sAqfRmvuAmW+BjvcjmwVXhfmmCtJNztAtxKQZMd0MQTaBkG3Bi0by0sq8mCrRJM+X5Z0dANUn7QfXv9iqHM3/vwkDL6uRec8SmeMnR2mUsvo913UrHd2drQyDUrTxFOW2JoY91SrCiH73LpUu+gIp14qqImot1hUir6oKmJaHiSlDpaVhfRYpek9FNDoW+tzxn9VEPoXPkJm83NJyoJva2V6Vy8cyyhuzHwBJNjPQ0BWPLRMIvQy2UFpjn5JIdzQ00BW+5RG8++t7yAbr7dwQpsbSzQPZOPxHHkwdmWIFhq6lEHQx6YXEqwHL09ol9g62hTEDXbPXjR0Ulm3t9S0C078gO/Lr73RpcTnEtOfOOq/V95L7w5sYxg7mk25ZmdNwJx+WcyEvD5/HYoGk8kYun7n57c2BJJ0F2p0fgtr/945EaeLZ1E1Jd98dC3r2yc0LiSRyACVlA4IDQFAABwHACdASqAAIAAPpFCmkklpCKhJpYs2LASCUAaXMob29CPVjmW/qv8xttur5i/2A3nTqot5K/dL9jrMl/U0QDstlYsFdM8zpvAPRA/YBAFO5pFHJNafid1YMjvQiLMxjEgF4GBOC0mQQr6kLFcY1ytmDddQyENl//HmHZTXIGUh2kxiqBSmmsB+5/R6dHwSkFvkpePmmEVpIsTDlsuD6wuusHSAsegw/lmDPo43TV6NYqbB1WQsJMjM2GusVvmYA48MmyINoMBn3WL2x9+FDw0YtL040bJsxwsKfaaoi5pC8MAutn7kBrCCnsqKAD++/1S0+MtbekZ/OM85Fu+QyDFWBF/ZIWO1ojWq+sj6wH2f0mU1cG/WHikqy3VrJmSr9P4JT5iTv5fQJPmWGQzQAYk0HS2BtyZ+kqhlaY1XQf9zw4cRH1br6vvZ86uc2/bvHoINDSg3gGzoEexXwnkei2qmK5Hiv66YmqMh/GBqIsV4pVgn/PR3Wx8ZX9zDTvF+8SnWlEdZp9wEMaPHSzI4QcbypIrH/7RWndB7Uh5PYcISRP+fwt2A0rl1iQSoq4AhNvFatu/5rnBQ5DS74dBhswrsFYVu0XvBiNvW5tbh2adMPMcNCbe0m6T+c/owQeRNzYaYmsathvC+eDGAi6Tj5QWAkLcAuoJmoatBgs+zR2hWMyYEaC5TO9eeFEkLdyGQCC1KwnrHPydeq6dm0uGWaX4G1avJrR5jQBJYI6tOwnBJrPbH7g9QXRM39hOWO6ESdm3WZr28SLcjGLSUab8pj+0lhsNtEiWJMVo/xfAm9muYKWmELzwvlqFFxgKljXOnOLtqDBuIU4SS06Nbe6NDvQ4C+GYt0jWipm6nbx0uZcdngA4u/3GevkBWQpGHcN0r8GYrIWxq+p30Q3ObeWtvpwTUjrEw4SRUfDrB/NTXjOlooSciN3NekShQHTmkZbDKEhlbsmvwHDwhM/fYD/USMCplAftDcOrHh+aUSdyR9rlDt4XCE2W/SIb+5lygQcIiCJLZd91Wks4iLsSmFSMDSs32gzqgWuG5yStilhe9NijnIsS46zqv0DF0oqpl6CwDBGQ9OxAiHBwoZ99pIu0rMPBn0NFIxw0as5Oc3xvUA/xZtZSNEH0/vNMGUMligoUU7DVqDbBgfwjsZX/mYIxQmGhDsgo2vflmR5Mk7hkyTuSqMrp0jZcpbGIbxwYA6EkZO2yb6hV0f81ILo3h4zJzBUEL6KK6slkXY1wEK77SauOtYT2b6ZGt41mJ+6QPY3y1GNNKQQ89XyES72iMg/9TVKARAJ690/5+JRU1uGGgyOd71mi4oIGsXlw41SYa8qP6+4PDTe/m4pwEjgCnKsG3GSi7IQ9dYk3rAnvLJn2jeSN77lBX2333YWba+7czXWcYEZv6CjdmqPfxg8WRe6l1IC5wXNs6NH6b0OJ9rBnRoWmquT/Pkzhi71sHxps2Kf7R1+8kgWWBiHWRPWcyrYetmxY4WJd/C5Ktexuu7Ih/48On+IqARLONPjymxvgATJT8tBBkM+iYUrbkOiPBTotQLD4iR/3PzBIt7jc3AepvAbt4ASyaAIv9Ibwo6xCc2003f+VsRx57y9aAoJg5sZsLMUAkVazPaihX3YtxpChUGxPyXp2HoQx/q2K4ulpJYBOwkZEI1qxzDDUbIjU4PBWZuFUPvzsXTdpbGLjCHZxGA8RNc+49is2M8JIWPeFhYR654/rV59vekP8L2POM+CA8hfTtxnhp3ufOlSFcZF4rb3q7wAAAAA=";var Ie=(n=>(n[n.male=0]="male",n[n.female=1]="female",n[n.anonymous=2]="anonymous",n))(Ie||{});const Zg={" ":" "," ":" "," ":" "," ":" "," ":" ","?":"?",:"",:""," ":" "," ":" ",:"",:"",:""," ":" "," ":" ",:"",:""," ":" "," ":" ",:"",:""," ":" ",:"",:"",:""," ":" ",:""," ":" ",:"",:""," ":" ",:""," ":" "," ":" ",:""," ":" ","  ":"  ","  ":"  ","  ":"  "," ":" ",:"",:"",:""," ":" "," ":" ",:""," ":" ",:"",:""," ":" "," ":" ",:"",:""," ":" ",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},eo={0:"male",1:"female",2:"anonymous"},m5={0:Xg,1:JC,2:Xg},Ri={male:0,female:1,anonymous:2},p5=[0,1,2];var $e=(n=>(n[n.SMS=0]="SMS",n[n.SMSOrPush=1]="SMSOrPush",n[n.WhatsAppOrPush=2]="WhatsAppOrPush",n[n.WhatsApp=3]="WhatsApp",n[n.SMSOnly=4]="SMSOnly",n[n.WhatAppOnly=5]="WhatAppOnly",n[n.Push=6]="Push",n[n.PushOrWhatsApp=7]="PushOrWhatsApp",n[n.PushOrSMS=8]="PushOrSMS",n[n.OnlyPush=9]="OnlyPush",n))($e||{});const KC={0:"SMS",4:"SMSOnly",5:"WhatAppOnly",1:"SMSOrPush",2:"WhatsAppOrPush",3:"WhatsApp",9:"OnlyPush",7:"PushOrWhatsApp",8:"PushOrSMS",6:"Push"},Ml={SMS:0,SMSOrPush:1,WhatAppOnly:5,SMSOnly:4,WhatsAppOrPush:2,WhatsApp:3,OnlyPush:9,PushOrWhatsApp:7,PushOrSMS:8,Push:6},QC=/^[a-zA-Z0-9-_.~%]{1,900}$/;var Mf=(n=>(n[n.muslim=0]="muslim",n[n.christian=1]="christian",n[n.jewish=2]="jewish",n))(Mf||{});const jC={0:"muslim",1:"christian",2:"jewish"},XC={muslim:0,christian:1,jewish:2},ey={1:{"01-01-0000":"New Year's Day","16-01-0000":"Martin Luther King Jr. Day","20-02-0000":"Presidents' Day","29-05-0000":"Memorial Day","19-06-0000":"Juneteenth","04-07-0000":"Independence Day","04-09-0000":"Labor Day","09-10-0000":"Columbus Day","11-11-0000":"Veterans Day","23-11-0000":"Thanksgiving Day","25-12-0000":"Christmas Day"},2:{"06-04-2023":"Passover (Day 1)","12-04-2023":"Passover (Day 7)","26-04-2023":"Yom HaAtzmaut","26-05-2023":"Shavuot","16-09-2023":"Rosh Hashana","17-09-2023":"Rosh Hashana (Day 2)","25-09-2023":"Yom Kippur","30-09-2023":"Sukkot","07-10-2023":"Simchat Torah","23-04-2024":"Passover (Day 1)","29-04-2024":"Passover (Day 7)","14-05-2024":"Yom HaAtzmaut","12-06-2024":"Shavuot","03-10-2024":"Rosh Hashana","04-10-2024":"Rosh Hashana (Day 2)","12-10-2024":"Yom Kippur","17-10-2024":"Sukkot","24-10-2024":"Simchat Torah","13-04-2025":"Passover (Day 1)","19-04-2025":"Passover (Day 7)","01-05-2025":"Yom HaAtzmaut","02-06-2025":"Shavuot","23-09-2025":"Rosh Hashana","24-09-2025":"Rosh Hashana (Day 2)","02-10-2025":"Yom Kippur","07-10-2025":"Sukkot","14-10-2025":"Simchat Torah"},0:{}},ZC=["","monday","tuesday","wednesday","thursday","friday","saturday","sunday"];var Vs=(n=>(n[n.onHold=0]="onHold",n[n.needCancel=1]="needCancel",n[n.waitingList=2]="waitingList",n[n.withDebts=3]="withDebts",n[n.withOutRecipts=4]="withOutRecipts",n[n.withOnlinePayment=5]="withOnlinePayment",n[n.withoutConfirmArrival=6]="withoutConfirmArrival",n))(Vs||{});const ty={0:"waitingsForApproval",1:"waitingsForCancel",2:"waitingList",4:"withOutRecipts",3:"withDebts",5:"withOnlinePayment",6:"withoutConfirmArrival"};function Dn(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function ei(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}function Nu(n,e){const t=Dn(n);return isNaN(e)?ei(n,NaN):(e&&t.setDate(t.getDate()+e),t)}function ny(n,e){const t=Dn(n);if(isNaN(e))return ei(n,NaN);if(!e)return t;const i=t.getDate(),s=ei(n,t.getTime());s.setMonth(t.getMonth()+e+1,0);const r=s.getDate();return i>=r?s:(t.setFullYear(s.getFullYear(),s.getMonth(),i),t)}const qw=6048e5,eb=864e5;let tb={};function Ol(){return tb}function Ba(n,e){var a,c,u,l;const t=Ol(),i=(e==null?void 0:e.weekStartsOn)??((c=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((l=(u=t.locale)==null?void 0:u.options)==null?void 0:l.weekStartsOn)??0,s=Dn(n),r=s.getDay(),o=(r<i?7:0)+r-i;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function Mu(n){return Ba(n,{weekStartsOn:1})}function zw(n){const e=Dn(n),t=e.getFullYear(),i=ei(n,0);i.setFullYear(t+1,0,4),i.setHours(0,0,0,0);const s=Mu(i),r=ei(n,0);r.setFullYear(t,0,4),r.setHours(0,0,0,0);const o=Mu(r);return e.getTime()>=s.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function iy(n){const e=Dn(n);return e.setHours(0,0,0,0),e}function sy(n){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return e.setUTCFullYear(n.getFullYear()),n.getTime()-e.getTime()}function nb(n,e){const t=iy(n),i=iy(e),s=t.getTime()-sy(t),r=i.getTime()-sy(i);return Math.round((s-r)/eb)}function ib(n){const e=zw(n),t=ei(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Mu(t)}function sb(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function rb(n){if(!sb(n)&&typeof n!="number")return!1;const e=Dn(n);return!isNaN(Number(e))}function ob(n){const e=Dn(n),t=ei(n,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const ab={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},cb=(n,e,t)=>{let i;const s=ab[n];return typeof s=="string"?i=s:e===1?i=s.one:i=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+i:i+" ago":i};function id(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const ub={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lb={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},hb={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},db={date:id({formats:ub,defaultWidth:"full"}),time:id({formats:lb,defaultWidth:"full"}),dateTime:id({formats:hb,defaultWidth:"full"})},fb={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},mb=(n,e,t,i)=>fb[n];function Jo(n){return(e,t)=>{const i=t!=null&&t.context?String(t.context):"standalone";let s;if(i==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,a=t!=null&&t.width?String(t.width):o;s=n.formattingValues[a]||n.formattingValues[o]}else{const o=n.defaultWidth,a=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[a]||n.values[o]}const r=n.argumentCallback?n.argumentCallback(e):e;return s[r]}}const pb={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},gb={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},yb={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},_b={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},vb={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},wb={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xb=(n,e)=>{const t=Number(n),i=t%100;if(i>20||i<10)switch(i%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Eb={ordinalNumber:xb,era:Jo({values:pb,defaultWidth:"wide"}),quarter:Jo({values:gb,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Jo({values:yb,defaultWidth:"wide"}),day:Jo({values:_b,defaultWidth:"wide"}),dayPeriod:Jo({values:vb,defaultWidth:"wide",formattingValues:wb,defaultFormattingWidth:"wide"})};function Ko(n){return(e,t={})=>{const i=t.width,s=i&&n.matchPatterns[i]||n.matchPatterns[n.defaultMatchWidth],r=e.match(s);if(!r)return null;const o=r[0],a=i&&n.parsePatterns[i]||n.parsePatterns[n.defaultParseWidth],c=Array.isArray(a)?Tb(a,h=>h.test(o)):Ib(a,h=>h.test(o));let u;u=n.valueCallback?n.valueCallback(c):c,u=t.valueCallback?t.valueCallback(u):u;const l=e.slice(o.length);return{value:u,rest:l}}}function Ib(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function Tb(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function Db(n){return(e,t={})=>{const i=e.match(n.matchPattern);if(!i)return null;const s=i[0],r=e.match(n.parsePattern);if(!r)return null;let o=n.valueCallback?n.valueCallback(r[0]):r[0];o=t.valueCallback?t.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const Ab=/^(\d+)(th|st|nd|rd)?/i,Cb=/\d+/i,bb={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},kb={any:[/^b/i,/^(a|c)/i]},Sb={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Pb={any:[/1/i,/2/i,/3/i,/4/i]},Rb={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Nb={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Mb={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ob={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Fb={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Bb={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Lb={ordinalNumber:Db({matchPattern:Ab,parsePattern:Cb,valueCallback:n=>parseInt(n,10)}),era:Ko({matchPatterns:bb,defaultMatchWidth:"wide",parsePatterns:kb,defaultParseWidth:"any"}),quarter:Ko({matchPatterns:Sb,defaultMatchWidth:"wide",parsePatterns:Pb,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Ko({matchPatterns:Rb,defaultMatchWidth:"wide",parsePatterns:Nb,defaultParseWidth:"any"}),day:Ko({matchPatterns:Mb,defaultMatchWidth:"wide",parsePatterns:Ob,defaultParseWidth:"any"}),dayPeriod:Ko({matchPatterns:Fb,defaultMatchWidth:"any",parsePatterns:Bb,defaultParseWidth:"any"})},Vb={code:"en-US",formatDistance:cb,formatLong:db,formatRelative:mb,localize:Eb,match:Lb,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ub(n){const e=Dn(n);return nb(e,ob(e))+1}function Wb(n){const e=Dn(n),t=Mu(e).getTime()-ib(e).getTime();return Math.round(t/qw)+1}function Gw(n,e){var l,h,f,m;const t=Dn(n),i=t.getFullYear(),s=Ol(),r=(e==null?void 0:e.firstWeekContainsDate)??((h=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:h.firstWeekContainsDate)??s.firstWeekContainsDate??((m=(f=s.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,o=ei(n,0);o.setFullYear(i+1,0,r),o.setHours(0,0,0,0);const a=Ba(o,e),c=ei(n,0);c.setFullYear(i,0,r),c.setHours(0,0,0,0);const u=Ba(c,e);return t.getTime()>=a.getTime()?i+1:t.getTime()>=u.getTime()?i:i-1}function Hb(n,e){var a,c,u,l;const t=Ol(),i=(e==null?void 0:e.firstWeekContainsDate)??((c=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((l=(u=t.locale)==null?void 0:u.options)==null?void 0:l.firstWeekContainsDate)??1,s=Gw(n,e),r=ei(n,0);return r.setFullYear(s,0,i),r.setHours(0,0,0,0),Ba(r,e)}function $b(n,e){const t=Dn(n),i=Ba(t,e).getTime()-Hb(t,e).getTime();return Math.round(i/qw)+1}function Pe(n,e){const t=n<0?"-":"",i=Math.abs(n).toString().padStart(e,"0");return t+i}const Yi={y(n,e){const t=n.getFullYear(),i=t>0?t:1-t;return Pe(e==="yy"?i%100:i,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):Pe(t+1,2)},d(n,e){return Pe(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return Pe(n.getHours()%12||12,e.length)},H(n,e){return Pe(n.getHours(),e.length)},m(n,e){return Pe(n.getMinutes(),e.length)},s(n,e){return Pe(n.getSeconds(),e.length)},S(n,e){const t=e.length,i=n.getMilliseconds(),s=Math.floor(i*Math.pow(10,t-3));return Pe(s,e.length)}},xr={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},qb={G:function(n,e,t){const i=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(i,{width:"abbreviated"});case"GGGGG":return t.era(i,{width:"narrow"});case"GGGG":default:return t.era(i,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const i=n.getFullYear(),s=i>0?i:1-i;return t.ordinalNumber(s,{unit:"year"})}return Yi.y(n,e)},Y:function(n,e,t,i){const s=Gw(n,i),r=s>0?s:1-s;if(e==="YY"){const o=r%100;return Pe(o,2)}return e==="Yo"?t.ordinalNumber(r,{unit:"year"}):Pe(r,e.length)},R:function(n,e){const t=zw(n);return Pe(t,e.length)},u:function(n,e){const t=n.getFullYear();return Pe(t,e.length)},Q:function(n,e,t){const i=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(i);case"QQ":return Pe(i,2);case"Qo":return t.ordinalNumber(i,{unit:"quarter"});case"QQQ":return t.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(i,{width:"wide",context:"formatting"})}},q:function(n,e,t){const i=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(i);case"qq":return Pe(i,2);case"qo":return t.ordinalNumber(i,{unit:"quarter"});case"qqq":return t.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(i,{width:"wide",context:"standalone"})}},M:function(n,e,t){const i=n.getMonth();switch(e){case"M":case"MM":return Yi.M(n,e);case"Mo":return t.ordinalNumber(i+1,{unit:"month"});case"MMM":return t.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(i,{width:"wide",context:"formatting"})}},L:function(n,e,t){const i=n.getMonth();switch(e){case"L":return String(i+1);case"LL":return Pe(i+1,2);case"Lo":return t.ordinalNumber(i+1,{unit:"month"});case"LLL":return t.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(i,{width:"wide",context:"standalone"})}},w:function(n,e,t,i){const s=$b(n,i);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):Pe(s,e.length)},I:function(n,e,t){const i=Wb(n);return e==="Io"?t.ordinalNumber(i,{unit:"week"}):Pe(i,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):Yi.d(n,e)},D:function(n,e,t){const i=Ub(n);return e==="Do"?t.ordinalNumber(i,{unit:"dayOfYear"}):Pe(i,e.length)},E:function(n,e,t){const i=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(i,{width:"short",context:"formatting"});case"EEEE":default:return t.day(i,{width:"wide",context:"formatting"})}},e:function(n,e,t,i){const s=n.getDay(),r=(s-i.weekStartsOn+8)%7||7;switch(e){case"e":return String(r);case"ee":return Pe(r,2);case"eo":return t.ordinalNumber(r,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,i){const s=n.getDay(),r=(s-i.weekStartsOn+8)%7||7;switch(e){case"c":return String(r);case"cc":return Pe(r,e.length);case"co":return t.ordinalNumber(r,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){const i=n.getDay(),s=i===0?7:i;switch(e){case"i":return String(s);case"ii":return Pe(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(i,{width:"short",context:"formatting"});case"iiii":default:return t.day(i,{width:"wide",context:"formatting"})}},a:function(n,e,t){const s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){const i=n.getHours();let s;switch(i===12?s=xr.noon:i===0?s=xr.midnight:s=i/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){const i=n.getHours();let s;switch(i>=17?s=xr.evening:i>=12?s=xr.afternoon:i>=4?s=xr.morning:s=xr.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let i=n.getHours()%12;return i===0&&(i=12),t.ordinalNumber(i,{unit:"hour"})}return Yi.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):Yi.H(n,e)},K:function(n,e,t){const i=n.getHours()%12;return e==="Ko"?t.ordinalNumber(i,{unit:"hour"}):Pe(i,e.length)},k:function(n,e,t){let i=n.getHours();return i===0&&(i=24),e==="ko"?t.ordinalNumber(i,{unit:"hour"}):Pe(i,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):Yi.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):Yi.s(n,e)},S:function(n,e){return Yi.S(n,e)},X:function(n,e,t,i){const r=(i._originalDate||n).getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return oy(r);case"XXXX":case"XX":return bs(r);case"XXXXX":case"XXX":default:return bs(r,":")}},x:function(n,e,t,i){const r=(i._originalDate||n).getTimezoneOffset();switch(e){case"x":return oy(r);case"xxxx":case"xx":return bs(r);case"xxxxx":case"xxx":default:return bs(r,":")}},O:function(n,e,t,i){const r=(i._originalDate||n).getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+ry(r,":");case"OOOO":default:return"GMT"+bs(r,":")}},z:function(n,e,t,i){const r=(i._originalDate||n).getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+ry(r,":");case"zzzz":default:return"GMT"+bs(r,":")}},t:function(n,e,t,i){const s=i._originalDate||n,r=Math.floor(s.getTime()/1e3);return Pe(r,e.length)},T:function(n,e,t,i){const r=(i._originalDate||n).getTime();return Pe(r,e.length)}};function ry(n,e=""){const t=n>0?"-":"+",i=Math.abs(n),s=Math.floor(i/60),r=i%60;return r===0?t+String(s):t+String(s)+e+Pe(r,2)}function oy(n,e){return n%60===0?(n>0?"-":"+")+Pe(Math.abs(n)/60,2):bs(n,e)}function bs(n,e=""){const t=n>0?"-":"+",i=Math.abs(n),s=Pe(Math.floor(i/60),2),r=Pe(i%60,2);return t+s+e+r}const ay=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Yw=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},zb=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],i=t[1],s=t[2];if(!s)return ay(n,e);let r;switch(i){case"P":r=e.dateTime({width:"short"});break;case"PP":r=e.dateTime({width:"medium"});break;case"PPP":r=e.dateTime({width:"long"});break;case"PPPP":default:r=e.dateTime({width:"full"});break}return r.replace("{{date}}",ay(i,e)).replace("{{time}}",Yw(s,e))},Gb={p:Yw,P:zb},Yb=/^D+$/,Jb=/^Y+$/,Kb=["D","DD","YY","YYYY"];function Qb(n){return Yb.test(n)}function jb(n){return Jb.test(n)}function cy(n,e,t){const i=Xb(n,e,t);if(console.warn(i),Kb.includes(n))throw new RangeError(i)}function Xb(n,e,t){const i=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${i} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Zb=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ek=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,tk=/^'([^]*?)'?$/,nk=/''/g,ik=/[a-zA-Z]/;function In(n,e,t){var l,h,f,m,p,y,g,x;const i=Ol(),s=(t==null?void 0:t.locale)??i.locale??Vb,r=(t==null?void 0:t.firstWeekContainsDate)??((h=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:h.firstWeekContainsDate)??i.firstWeekContainsDate??((m=(f=i.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,o=(t==null?void 0:t.weekStartsOn)??((y=(p=t==null?void 0:t.locale)==null?void 0:p.options)==null?void 0:y.weekStartsOn)??i.weekStartsOn??((x=(g=i.locale)==null?void 0:g.options)==null?void 0:x.weekStartsOn)??0,a=Dn(n);if(!rb(a))throw new RangeError("Invalid time value");const c={firstWeekContainsDate:r,weekStartsOn:o,locale:s,_originalDate:a};return e.match(ek).map(function(_){const v=_[0];if(v==="p"||v==="P"){const w=Gb[v];return w(_,s.formatLong)}return _}).join("").match(Zb).map(function(_){if(_==="''")return"'";const v=_[0];if(v==="'")return sk(_);const w=qb[v];if(w)return!(t!=null&&t.useAdditionalWeekYearTokens)&&jb(_)&&cy(_,e,String(n)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&Qb(_)&&cy(_,e,String(n)),w(a,_,s.localize,c);if(v.match(ik))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return _}).join("")}function sk(n){const e=n.match(tk);return e?e[1].replace(nk,"'"):n}function _c(n,e,t,i){const s=t<n&&!(i>n),r=!(t<e)&&i>e;return s?"BEFORE":r?"AFTER":"STRIKE"}function Q(n,e){return new Date(n.getTime()+e.inMilliseconds)}function Rn(n,e){return new Date(n.getTime()-e.inMilliseconds)}function Us(n,e){return new V({milliseconds:new Date(n.getTime()-e.getTime()).getTime()})}//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var Jw;function W(){return Jw.apply(null,arguments)}function rk(n){Jw=n}function Ln(n){return n instanceof Array||Object.prototype.toString.call(n)==="[object Array]"}function Ws(n){return n!=null&&Object.prototype.toString.call(n)==="[object Object]"}function Ae(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function q0(n){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(n).length===0;var e;for(e in n)if(Ae(n,e))return!1;return!0}function Zt(n){return n===void 0}function Ni(n){return typeof n=="number"||Object.prototype.toString.call(n)==="[object Number]"}function vc(n){return n instanceof Date||Object.prototype.toString.call(n)==="[object Date]"}function Kw(n,e){var t=[],i,s=n.length;for(i=0;i<s;++i)t.push(e(n[i],i));return t}function Zi(n,e){for(var t in e)Ae(e,t)&&(n[t]=e[t]);return Ae(e,"toString")&&(n.toString=e.toString),Ae(e,"valueOf")&&(n.valueOf=e.valueOf),n}function oi(n,e,t,i){return _x(n,e,t,i,!0).utc()}function ok(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function ce(n){return n._pf==null&&(n._pf=ok()),n._pf}var Of;Array.prototype.some?Of=Array.prototype.some:Of=function(n){var e=Object(this),t=e.length>>>0,i;for(i=0;i<t;i++)if(i in e&&n.call(this,e[i],i,e))return!0;return!1};function z0(n){var e=null,t=!1,i=n._d&&!isNaN(n._d.getTime());if(i&&(e=ce(n),t=Of.call(e.parsedDateParts,function(s){return s!=null}),i=e.overflow<0&&!e.empty&&!e.invalidEra&&!e.invalidMonth&&!e.invalidWeekday&&!e.weekdayMismatch&&!e.nullInput&&!e.invalidFormat&&!e.userInvalidated&&(!e.meridiem||e.meridiem&&t),n._strict&&(i=i&&e.charsLeftOver===0&&e.unusedTokens.length===0&&e.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(n))n._isValid=i;else return i;return n._isValid}function Fl(n){var e=oi(NaN);return n!=null?Zi(ce(e),n):ce(e).userInvalidated=!0,e}var uy=W.momentProperties=[],sd=!1;function G0(n,e){var t,i,s,r=uy.length;if(Zt(e._isAMomentObject)||(n._isAMomentObject=e._isAMomentObject),Zt(e._i)||(n._i=e._i),Zt(e._f)||(n._f=e._f),Zt(e._l)||(n._l=e._l),Zt(e._strict)||(n._strict=e._strict),Zt(e._tzm)||(n._tzm=e._tzm),Zt(e._isUTC)||(n._isUTC=e._isUTC),Zt(e._offset)||(n._offset=e._offset),Zt(e._pf)||(n._pf=ce(e)),Zt(e._locale)||(n._locale=e._locale),r>0)for(t=0;t<r;t++)i=uy[t],s=e[i],Zt(s)||(n[i]=s);return n}function wc(n){G0(this,n),this._d=new Date(n._d!=null?n._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),sd===!1&&(sd=!0,W.updateOffset(this),sd=!1)}function Vn(n){return n instanceof wc||n!=null&&n._isAMomentObject!=null}function Qw(n){W.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+n)}function An(n,e){var t=!0;return Zi(function(){if(W.deprecationHandler!=null&&W.deprecationHandler(null,n),t){var i=[],s,r,o,a=arguments.length;for(r=0;r<a;r++){if(s="",typeof arguments[r]=="object"){s+=`
[`+r+"] ";for(o in arguments[0])Ae(arguments[0],o)&&(s+=o+": "+arguments[0][o]+", ");s=s.slice(0,-2)}else s=arguments[r];i.push(s)}Qw(n+`
Arguments: `+Array.prototype.slice.call(i).join("")+`
`+new Error().stack),t=!1}return e.apply(this,arguments)},e)}var ly={};function jw(n,e){W.deprecationHandler!=null&&W.deprecationHandler(n,e),ly[n]||(Qw(e),ly[n]=!0)}W.suppressDeprecationWarnings=!1;W.deprecationHandler=null;function ai(n){return typeof Function<"u"&&n instanceof Function||Object.prototype.toString.call(n)==="[object Function]"}function ak(n){var e,t;for(t in n)Ae(n,t)&&(e=n[t],ai(e)?this[t]=e:this["_"+t]=e);this._config=n,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Ff(n,e){var t=Zi({},n),i;for(i in e)Ae(e,i)&&(Ws(n[i])&&Ws(e[i])?(t[i]={},Zi(t[i],n[i]),Zi(t[i],e[i])):e[i]!=null?t[i]=e[i]:delete t[i]);for(i in n)Ae(n,i)&&!Ae(e,i)&&Ws(n[i])&&(t[i]=Zi({},t[i]));return t}function Y0(n){n!=null&&this.set(n)}var Bf;Object.keys?Bf=Object.keys:Bf=function(n){var e,t=[];for(e in n)Ae(n,e)&&t.push(e);return t};var ck={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function uk(n,e,t){var i=this._calendar[n]||this._calendar.sameElse;return ai(i)?i.call(e,t):i}function ti(n,e,t){var i=""+Math.abs(n),s=e-i.length,r=n>=0;return(r?t?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+i}var J0=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,tu=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,rd={},Fr={};function K(n,e,t,i){var s=i;typeof i=="string"&&(s=function(){return this[i]()}),n&&(Fr[n]=s),e&&(Fr[e[0]]=function(){return ti(s.apply(this,arguments),e[1],e[2])}),t&&(Fr[t]=function(){return this.localeData().ordinal(s.apply(this,arguments),n)})}function lk(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function hk(n){var e=n.match(J0),t,i;for(t=0,i=e.length;t<i;t++)Fr[e[t]]?e[t]=Fr[e[t]]:e[t]=lk(e[t]);return function(s){var r="",o;for(o=0;o<i;o++)r+=ai(e[o])?e[o].call(s,n):e[o];return r}}function yu(n,e){return n.isValid()?(e=Xw(e,n.localeData()),rd[e]=rd[e]||hk(e),rd[e](n)):n.localeData().invalidDate()}function Xw(n,e){var t=5;function i(s){return e.longDateFormat(s)||s}for(tu.lastIndex=0;t>=0&&tu.test(n);)n=n.replace(tu,i),tu.lastIndex=0,t-=1;return n}var dk={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function fk(n){var e=this._longDateFormat[n],t=this._longDateFormat[n.toUpperCase()];return e||!t?e:(this._longDateFormat[n]=t.match(J0).map(function(i){return i==="MMMM"||i==="MM"||i==="DD"||i==="dddd"?i.slice(1):i}).join(""),this._longDateFormat[n])}var mk="Invalid date";function pk(){return this._invalidDate}var gk="%d",yk=/\d{1,2}/;function _k(n){return this._ordinal.replace("%d",n)}var vk={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function wk(n,e,t,i){var s=this._relativeTime[t];return ai(s)?s(n,e,t,i):s.replace(/%d/i,n)}function xk(n,e){var t=this._relativeTime[n>0?"future":"past"];return ai(t)?t(e):t.replace(/%s/i,e)}var hy={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function Cn(n){return typeof n=="string"?hy[n]||hy[n.toLowerCase()]:void 0}function K0(n){var e={},t,i;for(i in n)Ae(n,i)&&(t=Cn(i),t&&(e[t]=n[i]));return e}var Ek={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function Ik(n){var e=[],t;for(t in n)Ae(n,t)&&e.push({unit:t,priority:Ek[t]});return e.sort(function(i,s){return i.priority-s.priority}),e}var Zw=/\d/,mn=/\d\d/,ex=/\d{3}/,Q0=/\d{4}/,Bl=/[+-]?\d{6}/,Ye=/\d\d?/,tx=/\d\d\d\d?/,nx=/\d\d\d\d\d\d?/,Ll=/\d{1,3}/,j0=/\d{1,4}/,Vl=/[+-]?\d{1,6}/,Ao=/\d+/,Ul=/[+-]?\d+/,Tk=/Z|[+-]\d\d:?\d\d/gi,Wl=/Z|[+-]\d\d(?::?\d\d)?/gi,Dk=/[+-]?\d+(\.\d{1,3})?/,xc=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Co=/^[1-9]\d?/,X0=/^([1-9]\d|\d)/,Ou;Ou={};function H(n,e,t){Ou[n]=ai(e)?e:function(i,s){return i&&t?t:e}}function Ak(n,e){return Ae(Ou,n)?Ou[n](e._strict,e._locale):new RegExp(Ck(n))}function Ck(n){return bi(n.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,s,r){return t||i||s||r}))}function bi(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function vn(n){return n<0?Math.ceil(n)||0:Math.floor(n)}function _e(n){var e=+n,t=0;return e!==0&&isFinite(e)&&(t=vn(e)),t}var Lf={};function Fe(n,e){var t,i=e,s;for(typeof n=="string"&&(n=[n]),Ni(e)&&(i=function(r,o){o[e]=_e(r)}),s=n.length,t=0;t<s;t++)Lf[n[t]]=i}function Ec(n,e){Fe(n,function(t,i,s,r){s._w=s._w||{},e(t,s._w,s,r)})}function bk(n,e,t){e!=null&&Ae(Lf,n)&&Lf[n](e,t._a,t,n)}function Hl(n){return n%4===0&&n%100!==0||n%400===0}var Ut=0,yi=1,$n=2,ht=3,Nn=4,_i=5,Ms=6,kk=7,Sk=8;K("Y",0,0,function(){var n=this.year();return n<=9999?ti(n,4):"+"+n});K(0,["YY",2],0,function(){return this.year()%100});K(0,["YYYY",4],0,"year");K(0,["YYYYY",5],0,"year");K(0,["YYYYYY",6,!0],0,"year");H("Y",Ul);H("YY",Ye,mn);H("YYYY",j0,Q0);H("YYYYY",Vl,Bl);H("YYYYYY",Vl,Bl);Fe(["YYYYY","YYYYYY"],Ut);Fe("YYYY",function(n,e){e[Ut]=n.length===2?W.parseTwoDigitYear(n):_e(n)});Fe("YY",function(n,e){e[Ut]=W.parseTwoDigitYear(n)});Fe("Y",function(n,e){e[Ut]=parseInt(n,10)});function ma(n){return Hl(n)?366:365}W.parseTwoDigitYear=function(n){return _e(n)+(_e(n)>68?1900:2e3)};var ix=bo("FullYear",!0);function Pk(){return Hl(this.year())}function bo(n,e){return function(t){return t!=null?(sx(this,n,t),W.updateOffset(this,e),this):La(this,n)}}function La(n,e){if(!n.isValid())return NaN;var t=n._d,i=n._isUTC;switch(e){case"Milliseconds":return i?t.getUTCMilliseconds():t.getMilliseconds();case"Seconds":return i?t.getUTCSeconds():t.getSeconds();case"Minutes":return i?t.getUTCMinutes():t.getMinutes();case"Hours":return i?t.getUTCHours():t.getHours();case"Date":return i?t.getUTCDate():t.getDate();case"Day":return i?t.getUTCDay():t.getDay();case"Month":return i?t.getUTCMonth():t.getMonth();case"FullYear":return i?t.getUTCFullYear():t.getFullYear();default:return NaN}}function sx(n,e,t){var i,s,r,o,a;if(!(!n.isValid()||isNaN(t))){switch(i=n._d,s=n._isUTC,e){case"Milliseconds":return void(s?i.setUTCMilliseconds(t):i.setMilliseconds(t));case"Seconds":return void(s?i.setUTCSeconds(t):i.setSeconds(t));case"Minutes":return void(s?i.setUTCMinutes(t):i.setMinutes(t));case"Hours":return void(s?i.setUTCHours(t):i.setHours(t));case"Date":return void(s?i.setUTCDate(t):i.setDate(t));case"FullYear":break;default:return}r=t,o=n.month(),a=n.date(),a=a===29&&o===1&&!Hl(r)?28:a,s?i.setUTCFullYear(r,o,a):i.setFullYear(r,o,a)}}function Rk(n){return n=Cn(n),ai(this[n])?this[n]():this}function Nk(n,e){if(typeof n=="object"){n=K0(n);var t=Ik(n),i,s=t.length;for(i=0;i<s;i++)this[t[i].unit](n[t[i].unit])}else if(n=Cn(n),ai(this[n]))return this[n](e);return this}function Mk(n,e){return(n%e+e)%e}var nt;Array.prototype.indexOf?nt=Array.prototype.indexOf:nt=function(n){var e;for(e=0;e<this.length;++e)if(this[e]===n)return e;return-1};function Z0(n,e){if(isNaN(n)||isNaN(e))return NaN;var t=Mk(e,12);return n+=(e-t)/12,t===1?Hl(n)?29:28:31-t%7%2}K("M",["MM",2],"Mo",function(){return this.month()+1});K("MMM",0,0,function(n){return this.localeData().monthsShort(this,n)});K("MMMM",0,0,function(n){return this.localeData().months(this,n)});H("M",Ye,Co);H("MM",Ye,mn);H("MMM",function(n,e){return e.monthsShortRegex(n)});H("MMMM",function(n,e){return e.monthsRegex(n)});Fe(["M","MM"],function(n,e){e[yi]=_e(n)-1});Fe(["MMM","MMMM"],function(n,e,t,i){var s=t._locale.monthsParse(n,i,t._strict);s!=null?e[yi]=s:ce(t).invalidMonth=n});var Ok="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),rx="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),ox=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Fk=xc,Bk=xc;function Lk(n,e){return n?Ln(this._months)?this._months[n.month()]:this._months[(this._months.isFormat||ox).test(e)?"format":"standalone"][n.month()]:Ln(this._months)?this._months:this._months.standalone}function Vk(n,e){return n?Ln(this._monthsShort)?this._monthsShort[n.month()]:this._monthsShort[ox.test(e)?"format":"standalone"][n.month()]:Ln(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function Uk(n,e,t){var i,s,r,o=n.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)r=oi([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(r,"").toLocaleLowerCase();return t?e==="MMM"?(s=nt.call(this._shortMonthsParse,o),s!==-1?s:null):(s=nt.call(this._longMonthsParse,o),s!==-1?s:null):e==="MMM"?(s=nt.call(this._shortMonthsParse,o),s!==-1?s:(s=nt.call(this._longMonthsParse,o),s!==-1?s:null)):(s=nt.call(this._longMonthsParse,o),s!==-1?s:(s=nt.call(this._shortMonthsParse,o),s!==-1?s:null))}function Wk(n,e,t){var i,s,r;if(this._monthsParseExact)return Uk.call(this,n,e,t);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(s=oi([2e3,i]),t&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),!t&&!this._monthsParse[i]&&(r="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[i]=new RegExp(r.replace(".",""),"i")),t&&e==="MMMM"&&this._longMonthsParse[i].test(n))return i;if(t&&e==="MMM"&&this._shortMonthsParse[i].test(n))return i;if(!t&&this._monthsParse[i].test(n))return i}}function ax(n,e){if(!n.isValid())return n;if(typeof e=="string"){if(/^\d+$/.test(e))e=_e(e);else if(e=n.localeData().monthsParse(e),!Ni(e))return n}var t=e,i=n.date();return i=i<29?i:Math.min(i,Z0(n.year(),t)),n._isUTC?n._d.setUTCMonth(t,i):n._d.setMonth(t,i),n}function cx(n){return n!=null?(ax(this,n),W.updateOffset(this,!0),this):La(this,"Month")}function Hk(){return Z0(this.year(),this.month())}function $k(n){return this._monthsParseExact?(Ae(this,"_monthsRegex")||ux.call(this),n?this._monthsShortStrictRegex:this._monthsShortRegex):(Ae(this,"_monthsShortRegex")||(this._monthsShortRegex=Fk),this._monthsShortStrictRegex&&n?this._monthsShortStrictRegex:this._monthsShortRegex)}function qk(n){return this._monthsParseExact?(Ae(this,"_monthsRegex")||ux.call(this),n?this._monthsStrictRegex:this._monthsRegex):(Ae(this,"_monthsRegex")||(this._monthsRegex=Bk),this._monthsStrictRegex&&n?this._monthsStrictRegex:this._monthsRegex)}function ux(){function n(c,u){return u.length-c.length}var e=[],t=[],i=[],s,r,o,a;for(s=0;s<12;s++)r=oi([2e3,s]),o=bi(this.monthsShort(r,"")),a=bi(this.months(r,"")),e.push(o),t.push(a),i.push(a),i.push(o);e.sort(n),t.sort(n),i.sort(n),this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+e.join("|")+")","i")}function zk(n,e,t,i,s,r,o){var a;return n<100&&n>=0?(a=new Date(n+400,e,t,i,s,r,o),isFinite(a.getFullYear())&&a.setFullYear(n)):a=new Date(n,e,t,i,s,r,o),a}function Va(n){var e,t;return n<100&&n>=0?(t=Array.prototype.slice.call(arguments),t[0]=n+400,e=new Date(Date.UTC.apply(null,t)),isFinite(e.getUTCFullYear())&&e.setUTCFullYear(n)):e=new Date(Date.UTC.apply(null,arguments)),e}function Fu(n,e,t){var i=7+e-t,s=(7+Va(n,0,i).getUTCDay()-e)%7;return-s+i-1}function lx(n,e,t,i,s){var r=(7+t-i)%7,o=Fu(n,i,s),a=1+7*(e-1)+r+o,c,u;return a<=0?(c=n-1,u=ma(c)+a):a>ma(n)?(c=n+1,u=a-ma(n)):(c=n,u=a),{year:c,dayOfYear:u}}function Ua(n,e,t){var i=Fu(n.year(),e,t),s=Math.floor((n.dayOfYear()-i-1)/7)+1,r,o;return s<1?(o=n.year()-1,r=s+ki(o,e,t)):s>ki(n.year(),e,t)?(r=s-ki(n.year(),e,t),o=n.year()+1):(o=n.year(),r=s),{week:r,year:o}}function ki(n,e,t){var i=Fu(n,e,t),s=Fu(n+1,e,t);return(ma(n)-i+s)/7}K("w",["ww",2],"wo","week");K("W",["WW",2],"Wo","isoWeek");H("w",Ye,Co);H("ww",Ye,mn);H("W",Ye,Co);H("WW",Ye,mn);Ec(["w","ww","W","WW"],function(n,e,t,i){e[i.substr(0,1)]=_e(n)});function Gk(n){return Ua(n,this._week.dow,this._week.doy).week}var Yk={dow:0,doy:6};function Jk(){return this._week.dow}function Kk(){return this._week.doy}function Qk(n){var e=this.localeData().week(this);return n==null?e:this.add((n-e)*7,"d")}function jk(n){var e=Ua(this,1,4).week;return n==null?e:this.add((n-e)*7,"d")}K("d",0,"do","day");K("dd",0,0,function(n){return this.localeData().weekdaysMin(this,n)});K("ddd",0,0,function(n){return this.localeData().weekdaysShort(this,n)});K("dddd",0,0,function(n){return this.localeData().weekdays(this,n)});K("e",0,0,"weekday");K("E",0,0,"isoWeekday");H("d",Ye);H("e",Ye);H("E",Ye);H("dd",function(n,e){return e.weekdaysMinRegex(n)});H("ddd",function(n,e){return e.weekdaysShortRegex(n)});H("dddd",function(n,e){return e.weekdaysRegex(n)});Ec(["dd","ddd","dddd"],function(n,e,t,i){var s=t._locale.weekdaysParse(n,i,t._strict);s!=null?e.d=s:ce(t).invalidWeekday=n});Ec(["d","e","E"],function(n,e,t,i){e[i]=_e(n)});function Xk(n,e){return typeof n!="string"?n:isNaN(n)?(n=e.weekdaysParse(n),typeof n=="number"?n:null):parseInt(n,10)}function Zk(n,e){return typeof n=="string"?e.weekdaysParse(n)%7||7:isNaN(n)?null:n}function em(n,e){return n.slice(e,7).concat(n.slice(0,e))}var eS="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),hx="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),tS="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),nS=xc,iS=xc,sS=xc;function rS(n,e){var t=Ln(this._weekdays)?this._weekdays:this._weekdays[n&&n!==!0&&this._weekdays.isFormat.test(e)?"format":"standalone"];return n===!0?em(t,this._week.dow):n?t[n.day()]:t}function oS(n){return n===!0?em(this._weekdaysShort,this._week.dow):n?this._weekdaysShort[n.day()]:this._weekdaysShort}function aS(n){return n===!0?em(this._weekdaysMin,this._week.dow):n?this._weekdaysMin[n.day()]:this._weekdaysMin}function cS(n,e,t){var i,s,r,o=n.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)r=oi([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(r,"").toLocaleLowerCase();return t?e==="dddd"?(s=nt.call(this._weekdaysParse,o),s!==-1?s:null):e==="ddd"?(s=nt.call(this._shortWeekdaysParse,o),s!==-1?s:null):(s=nt.call(this._minWeekdaysParse,o),s!==-1?s:null):e==="dddd"?(s=nt.call(this._weekdaysParse,o),s!==-1||(s=nt.call(this._shortWeekdaysParse,o),s!==-1)?s:(s=nt.call(this._minWeekdaysParse,o),s!==-1?s:null)):e==="ddd"?(s=nt.call(this._shortWeekdaysParse,o),s!==-1||(s=nt.call(this._weekdaysParse,o),s!==-1)?s:(s=nt.call(this._minWeekdaysParse,o),s!==-1?s:null)):(s=nt.call(this._minWeekdaysParse,o),s!==-1||(s=nt.call(this._weekdaysParse,o),s!==-1)?s:(s=nt.call(this._shortWeekdaysParse,o),s!==-1?s:null))}function uS(n,e,t){var i,s,r;if(this._weekdaysParseExact)return cS.call(this,n,e,t);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(s=oi([2e3,1]).day(i),t&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[i]||(r="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[i]=new RegExp(r.replace(".",""),"i")),t&&e==="dddd"&&this._fullWeekdaysParse[i].test(n))return i;if(t&&e==="ddd"&&this._shortWeekdaysParse[i].test(n))return i;if(t&&e==="dd"&&this._minWeekdaysParse[i].test(n))return i;if(!t&&this._weekdaysParse[i].test(n))return i}}function lS(n){if(!this.isValid())return n!=null?this:NaN;var e=La(this,"Day");return n!=null?(n=Xk(n,this.localeData()),this.add(n-e,"d")):e}function hS(n){if(!this.isValid())return n!=null?this:NaN;var e=(this.day()+7-this.localeData()._week.dow)%7;return n==null?e:this.add(n-e,"d")}function dS(n){if(!this.isValid())return n!=null?this:NaN;if(n!=null){var e=Zk(n,this.localeData());return this.day(this.day()%7?e:e-7)}else return this.day()||7}function fS(n){return this._weekdaysParseExact?(Ae(this,"_weekdaysRegex")||tm.call(this),n?this._weekdaysStrictRegex:this._weekdaysRegex):(Ae(this,"_weekdaysRegex")||(this._weekdaysRegex=nS),this._weekdaysStrictRegex&&n?this._weekdaysStrictRegex:this._weekdaysRegex)}function mS(n){return this._weekdaysParseExact?(Ae(this,"_weekdaysRegex")||tm.call(this),n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(Ae(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=iS),this._weekdaysShortStrictRegex&&n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function pS(n){return this._weekdaysParseExact?(Ae(this,"_weekdaysRegex")||tm.call(this),n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(Ae(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=sS),this._weekdaysMinStrictRegex&&n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function tm(){function n(l,h){return h.length-l.length}var e=[],t=[],i=[],s=[],r,o,a,c,u;for(r=0;r<7;r++)o=oi([2e3,1]).day(r),a=bi(this.weekdaysMin(o,"")),c=bi(this.weekdaysShort(o,"")),u=bi(this.weekdays(o,"")),e.push(a),t.push(c),i.push(u),s.push(a),s.push(c),s.push(u);e.sort(n),t.sort(n),i.sort(n),s.sort(n),this._weekdaysRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+e.join("|")+")","i")}function nm(){return this.hours()%12||12}function gS(){return this.hours()||24}K("H",["HH",2],0,"hour");K("h",["hh",2],0,nm);K("k",["kk",2],0,gS);K("hmm",0,0,function(){return""+nm.apply(this)+ti(this.minutes(),2)});K("hmmss",0,0,function(){return""+nm.apply(this)+ti(this.minutes(),2)+ti(this.seconds(),2)});K("Hmm",0,0,function(){return""+this.hours()+ti(this.minutes(),2)});K("Hmmss",0,0,function(){return""+this.hours()+ti(this.minutes(),2)+ti(this.seconds(),2)});function dx(n,e){K(n,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),e)})}dx("a",!0);dx("A",!1);function fx(n,e){return e._meridiemParse}H("a",fx);H("A",fx);H("H",Ye,X0);H("h",Ye,Co);H("k",Ye,Co);H("HH",Ye,mn);H("hh",Ye,mn);H("kk",Ye,mn);H("hmm",tx);H("hmmss",nx);H("Hmm",tx);H("Hmmss",nx);Fe(["H","HH"],ht);Fe(["k","kk"],function(n,e,t){var i=_e(n);e[ht]=i===24?0:i});Fe(["a","A"],function(n,e,t){t._isPm=t._locale.isPM(n),t._meridiem=n});Fe(["h","hh"],function(n,e,t){e[ht]=_e(n),ce(t).bigHour=!0});Fe("hmm",function(n,e,t){var i=n.length-2;e[ht]=_e(n.substr(0,i)),e[Nn]=_e(n.substr(i)),ce(t).bigHour=!0});Fe("hmmss",function(n,e,t){var i=n.length-4,s=n.length-2;e[ht]=_e(n.substr(0,i)),e[Nn]=_e(n.substr(i,2)),e[_i]=_e(n.substr(s)),ce(t).bigHour=!0});Fe("Hmm",function(n,e,t){var i=n.length-2;e[ht]=_e(n.substr(0,i)),e[Nn]=_e(n.substr(i))});Fe("Hmmss",function(n,e,t){var i=n.length-4,s=n.length-2;e[ht]=_e(n.substr(0,i)),e[Nn]=_e(n.substr(i,2)),e[_i]=_e(n.substr(s))});function yS(n){return(n+"").toLowerCase().charAt(0)==="p"}var _S=/[ap]\.?m?\.?/i,vS=bo("Hours",!0);function wS(n,e,t){return n>11?t?"pm":"PM":t?"am":"AM"}var mx={calendar:ck,longDateFormat:dk,invalidDate:mk,ordinal:gk,dayOfMonthOrdinalParse:yk,relativeTime:vk,months:Ok,monthsShort:rx,week:Yk,weekdays:eS,weekdaysMin:tS,weekdaysShort:hx,meridiemParse:_S},Ke={},Qo={},Wa;function xS(n,e){var t,i=Math.min(n.length,e.length);for(t=0;t<i;t+=1)if(n[t]!==e[t])return t;return i}function dy(n){return n&&n.toLowerCase().replace("_","-")}function ES(n){for(var e=0,t,i,s,r;e<n.length;){for(r=dy(n[e]).split("-"),t=r.length,i=dy(n[e+1]),i=i?i.split("-"):null;t>0;){if(s=$l(r.slice(0,t).join("-")),s)return s;if(i&&i.length>=t&&xS(r,i)>=t-1)break;t--}e++}return Wa}function IS(n){return!!(n&&n.match("^[^/\\\\]*$"))}function $l(n){var e=null,t;if(Ke[n]===void 0&&typeof module<"u"&&module&&module.exports&&IS(n))try{e=Wa._abbr,t=require,t("./locale/"+n),rs(e)}catch{Ke[n]=null}return Ke[n]}function rs(n,e){var t;return n&&(Zt(e)?t=Wi(n):t=im(n,e),t?Wa=t:typeof console<"u"&&console.warn&&console.warn("Locale "+n+" not found. Did you forget to load it?")),Wa._abbr}function im(n,e){if(e!==null){var t,i=mx;if(e.abbr=n,Ke[n]!=null)jw("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),i=Ke[n]._config;else if(e.parentLocale!=null)if(Ke[e.parentLocale]!=null)i=Ke[e.parentLocale]._config;else if(t=$l(e.parentLocale),t!=null)i=t._config;else return Qo[e.parentLocale]||(Qo[e.parentLocale]=[]),Qo[e.parentLocale].push({name:n,config:e}),null;return Ke[n]=new Y0(Ff(i,e)),Qo[n]&&Qo[n].forEach(function(s){im(s.name,s.config)}),rs(n),Ke[n]}else return delete Ke[n],null}function TS(n,e){if(e!=null){var t,i,s=mx;Ke[n]!=null&&Ke[n].parentLocale!=null?Ke[n].set(Ff(Ke[n]._config,e)):(i=$l(n),i!=null&&(s=i._config),e=Ff(s,e),i==null&&(e.abbr=n),t=new Y0(e),t.parentLocale=Ke[n],Ke[n]=t),rs(n)}else Ke[n]!=null&&(Ke[n].parentLocale!=null?(Ke[n]=Ke[n].parentLocale,n===rs()&&rs(n)):Ke[n]!=null&&delete Ke[n]);return Ke[n]}function Wi(n){var e;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return Wa;if(!Ln(n)){if(e=$l(n),e)return e;n=[n]}return ES(n)}function DS(){return Bf(Ke)}function sm(n){var e,t=n._a;return t&&ce(n).overflow===-2&&(e=t[yi]<0||t[yi]>11?yi:t[$n]<1||t[$n]>Z0(t[Ut],t[yi])?$n:t[ht]<0||t[ht]>24||t[ht]===24&&(t[Nn]!==0||t[_i]!==0||t[Ms]!==0)?ht:t[Nn]<0||t[Nn]>59?Nn:t[_i]<0||t[_i]>59?_i:t[Ms]<0||t[Ms]>999?Ms:-1,ce(n)._overflowDayOfYear&&(e<Ut||e>$n)&&(e=$n),ce(n)._overflowWeeks&&e===-1&&(e=kk),ce(n)._overflowWeekday&&e===-1&&(e=Sk),ce(n).overflow=e),n}var AS=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,CS=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,bS=/Z|[+-]\d\d(?::?\d\d)?/,nu=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],od=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],kS=/^\/?Date\((-?\d+)/i,SS=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,PS={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function px(n){var e,t,i=n._i,s=AS.exec(i)||CS.exec(i),r,o,a,c,u=nu.length,l=od.length;if(s){for(ce(n).iso=!0,e=0,t=u;e<t;e++)if(nu[e][1].exec(s[1])){o=nu[e][0],r=nu[e][2]!==!1;break}if(o==null){n._isValid=!1;return}if(s[3]){for(e=0,t=l;e<t;e++)if(od[e][1].exec(s[3])){a=(s[2]||" ")+od[e][0];break}if(a==null){n._isValid=!1;return}}if(!r&&a!=null){n._isValid=!1;return}if(s[4])if(bS.exec(s[4]))c="Z";else{n._isValid=!1;return}n._f=o+(a||"")+(c||""),om(n)}else n._isValid=!1}function RS(n,e,t,i,s,r){var o=[NS(n),rx.indexOf(e),parseInt(t,10),parseInt(i,10),parseInt(s,10)];return r&&o.push(parseInt(r,10)),o}function NS(n){var e=parseInt(n,10);return e<=49?2e3+e:e<=999?1900+e:e}function MS(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function OS(n,e,t){if(n){var i=hx.indexOf(n),s=new Date(e[0],e[1],e[2]).getDay();if(i!==s)return ce(t).weekdayMismatch=!0,t._isValid=!1,!1}return!0}function FS(n,e,t){if(n)return PS[n];if(e)return 0;var i=parseInt(t,10),s=i%100,r=(i-s)/100;return r*60+s}function gx(n){var e=SS.exec(MS(n._i)),t;if(e){if(t=RS(e[4],e[3],e[2],e[5],e[6],e[7]),!OS(e[1],t,n))return;n._a=t,n._tzm=FS(e[8],e[9],e[10]),n._d=Va.apply(null,n._a),n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),ce(n).rfc2822=!0}else n._isValid=!1}function BS(n){var e=kS.exec(n._i);if(e!==null){n._d=new Date(+e[1]);return}if(px(n),n._isValid===!1)delete n._isValid;else return;if(gx(n),n._isValid===!1)delete n._isValid;else return;n._strict?n._isValid=!1:W.createFromInputFallback(n)}W.createFromInputFallback=An("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))});function Ar(n,e,t){return n??e??t}function LS(n){var e=new Date(W.now());return n._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function rm(n){var e,t,i=[],s,r,o;if(!n._d){for(s=LS(n),n._w&&n._a[$n]==null&&n._a[yi]==null&&VS(n),n._dayOfYear!=null&&(o=Ar(n._a[Ut],s[Ut]),(n._dayOfYear>ma(o)||n._dayOfYear===0)&&(ce(n)._overflowDayOfYear=!0),t=Va(o,0,n._dayOfYear),n._a[yi]=t.getUTCMonth(),n._a[$n]=t.getUTCDate()),e=0;e<3&&n._a[e]==null;++e)n._a[e]=i[e]=s[e];for(;e<7;e++)n._a[e]=i[e]=n._a[e]==null?e===2?1:0:n._a[e];n._a[ht]===24&&n._a[Nn]===0&&n._a[_i]===0&&n._a[Ms]===0&&(n._nextDay=!0,n._a[ht]=0),n._d=(n._useUTC?Va:zk).apply(null,i),r=n._useUTC?n._d.getUTCDay():n._d.getDay(),n._tzm!=null&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),n._nextDay&&(n._a[ht]=24),n._w&&typeof n._w.d<"u"&&n._w.d!==r&&(ce(n).weekdayMismatch=!0)}}function VS(n){var e,t,i,s,r,o,a,c,u;e=n._w,e.GG!=null||e.W!=null||e.E!=null?(r=1,o=4,t=Ar(e.GG,n._a[Ut],Ua(Ge(),1,4).year),i=Ar(e.W,1),s=Ar(e.E,1),(s<1||s>7)&&(c=!0)):(r=n._locale._week.dow,o=n._locale._week.doy,u=Ua(Ge(),r,o),t=Ar(e.gg,n._a[Ut],u.year),i=Ar(e.w,u.week),e.d!=null?(s=e.d,(s<0||s>6)&&(c=!0)):e.e!=null?(s=e.e+r,(e.e<0||e.e>6)&&(c=!0)):s=r),i<1||i>ki(t,r,o)?ce(n)._overflowWeeks=!0:c!=null?ce(n)._overflowWeekday=!0:(a=lx(t,i,s,r,o),n._a[Ut]=a.year,n._dayOfYear=a.dayOfYear)}W.ISO_8601=function(){};W.RFC_2822=function(){};function om(n){if(n._f===W.ISO_8601){px(n);return}if(n._f===W.RFC_2822){gx(n);return}n._a=[],ce(n).empty=!0;var e=""+n._i,t,i,s,r,o,a=e.length,c=0,u,l;for(s=Xw(n._f,n._locale).match(J0)||[],l=s.length,t=0;t<l;t++)r=s[t],i=(e.match(Ak(r,n))||[])[0],i&&(o=e.substr(0,e.indexOf(i)),o.length>0&&ce(n).unusedInput.push(o),e=e.slice(e.indexOf(i)+i.length),c+=i.length),Fr[r]?(i?ce(n).empty=!1:ce(n).unusedTokens.push(r),bk(r,i,n)):n._strict&&!i&&ce(n).unusedTokens.push(r);ce(n).charsLeftOver=a-c,e.length>0&&ce(n).unusedInput.push(e),n._a[ht]<=12&&ce(n).bigHour===!0&&n._a[ht]>0&&(ce(n).bigHour=void 0),ce(n).parsedDateParts=n._a.slice(0),ce(n).meridiem=n._meridiem,n._a[ht]=US(n._locale,n._a[ht],n._meridiem),u=ce(n).era,u!==null&&(n._a[Ut]=n._locale.erasConvertYear(u,n._a[Ut])),rm(n),sm(n)}function US(n,e,t){var i;return t==null?e:n.meridiemHour!=null?n.meridiemHour(e,t):(n.isPM!=null&&(i=n.isPM(t),i&&e<12&&(e+=12),!i&&e===12&&(e=0)),e)}function WS(n){var e,t,i,s,r,o,a=!1,c=n._f.length;if(c===0){ce(n).invalidFormat=!0,n._d=new Date(NaN);return}for(s=0;s<c;s++)r=0,o=!1,e=G0({},n),n._useUTC!=null&&(e._useUTC=n._useUTC),e._f=n._f[s],om(e),z0(e)&&(o=!0),r+=ce(e).charsLeftOver,r+=ce(e).unusedTokens.length*10,ce(e).score=r,a?r<i&&(i=r,t=e):(i==null||r<i||o)&&(i=r,t=e,o&&(a=!0));Zi(n,t||e)}function HS(n){if(!n._d){var e=K0(n._i),t=e.day===void 0?e.date:e.day;n._a=Kw([e.year,e.month,t,e.hour,e.minute,e.second,e.millisecond],function(i){return i&&parseInt(i,10)}),rm(n)}}function $S(n){var e=new wc(sm(yx(n)));return e._nextDay&&(e.add(1,"d"),e._nextDay=void 0),e}function yx(n){var e=n._i,t=n._f;return n._locale=n._locale||Wi(n._l),e===null||t===void 0&&e===""?Fl({nullInput:!0}):(typeof e=="string"&&(n._i=e=n._locale.preparse(e)),Vn(e)?new wc(sm(e)):(vc(e)?n._d=e:Ln(t)?WS(n):t?om(n):qS(n),z0(n)||(n._d=null),n))}function qS(n){var e=n._i;Zt(e)?n._d=new Date(W.now()):vc(e)?n._d=new Date(e.valueOf()):typeof e=="string"?BS(n):Ln(e)?(n._a=Kw(e.slice(0),function(t){return parseInt(t,10)}),rm(n)):Ws(e)?HS(n):Ni(e)?n._d=new Date(e):W.createFromInputFallback(n)}function _x(n,e,t,i,s){var r={};return(e===!0||e===!1)&&(i=e,e=void 0),(t===!0||t===!1)&&(i=t,t=void 0),(Ws(n)&&q0(n)||Ln(n)&&n.length===0)&&(n=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=s,r._l=t,r._i=n,r._f=e,r._strict=i,$S(r)}function Ge(n,e,t,i){return _x(n,e,t,i,!1)}var zS=An("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Ge.apply(null,arguments);return this.isValid()&&n.isValid()?n<this?this:n:Fl()}),GS=An("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Ge.apply(null,arguments);return this.isValid()&&n.isValid()?n>this?this:n:Fl()});function vx(n,e){var t,i;if(e.length===1&&Ln(e[0])&&(e=e[0]),!e.length)return Ge();for(t=e[0],i=1;i<e.length;++i)(!e[i].isValid()||e[i][n](t))&&(t=e[i]);return t}function YS(){var n=[].slice.call(arguments,0);return vx("isBefore",n)}function JS(){var n=[].slice.call(arguments,0);return vx("isAfter",n)}var KS=function(){return Date.now?Date.now():+new Date},jo=["year","quarter","month","week","day","hour","minute","second","millisecond"];function QS(n){var e,t=!1,i,s=jo.length;for(e in n)if(Ae(n,e)&&!(nt.call(jo,e)!==-1&&(n[e]==null||!isNaN(n[e]))))return!1;for(i=0;i<s;++i)if(n[jo[i]]){if(t)return!1;parseFloat(n[jo[i]])!==_e(n[jo[i]])&&(t=!0)}return!0}function jS(){return this._isValid}function XS(){return Wn(NaN)}function ql(n){var e=K0(n),t=e.year||0,i=e.quarter||0,s=e.month||0,r=e.week||e.isoWeek||0,o=e.day||0,a=e.hour||0,c=e.minute||0,u=e.second||0,l=e.millisecond||0;this._isValid=QS(e),this._milliseconds=+l+u*1e3+c*6e4+a*1e3*60*60,this._days=+o+r*7,this._months=+s+i*3+t*12,this._data={},this._locale=Wi(),this._bubble()}function _u(n){return n instanceof ql}function Vf(n){return n<0?Math.round(-1*n)*-1:Math.round(n)}function ZS(n,e,t){var i=Math.min(n.length,e.length),s=Math.abs(n.length-e.length),r=0,o;for(o=0;o<i;o++)(t&&n[o]!==e[o]||!t&&_e(n[o])!==_e(e[o]))&&r++;return r+s}function wx(n,e){K(n,0,0,function(){var t=this.utcOffset(),i="+";return t<0&&(t=-t,i="-"),i+ti(~~(t/60),2)+e+ti(~~t%60,2)})}wx("Z",":");wx("ZZ","");H("Z",Wl);H("ZZ",Wl);Fe(["Z","ZZ"],function(n,e,t){t._useUTC=!0,t._tzm=am(Wl,n)});var eP=/([\+\-]|\d\d)/gi;function am(n,e){var t=(e||"").match(n),i,s,r;return t===null?null:(i=t[t.length-1]||[],s=(i+"").match(eP)||["-",0,0],r=+(s[1]*60)+_e(s[2]),r===0?0:s[0]==="+"?r:-r)}function cm(n,e){var t,i;return e._isUTC?(t=e.clone(),i=(Vn(n)||vc(n)?n.valueOf():Ge(n).valueOf())-t.valueOf(),t._d.setTime(t._d.valueOf()+i),W.updateOffset(t,!1),t):Ge(n).local()}function Uf(n){return-Math.round(n._d.getTimezoneOffset())}W.updateOffset=function(){};function tP(n,e,t){var i=this._offset||0,s;if(!this.isValid())return n!=null?this:NaN;if(n!=null){if(typeof n=="string"){if(n=am(Wl,n),n===null)return this}else Math.abs(n)<16&&!t&&(n=n*60);return!this._isUTC&&e&&(s=Uf(this)),this._offset=n,this._isUTC=!0,s!=null&&this.add(s,"m"),i!==n&&(!e||this._changeInProgress?Ix(this,Wn(n-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,W.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?i:Uf(this)}function nP(n,e){return n!=null?(typeof n!="string"&&(n=-n),this.utcOffset(n,e),this):-this.utcOffset()}function iP(n){return this.utcOffset(0,n)}function sP(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract(Uf(this),"m")),this}function rP(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var n=am(Tk,this._i);n!=null?this.utcOffset(n):this.utcOffset(0,!0)}return this}function oP(n){return this.isValid()?(n=n?Ge(n).utcOffset():0,(this.utcOffset()-n)%60===0):!1}function aP(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function cP(){if(!Zt(this._isDSTShifted))return this._isDSTShifted;var n={},e;return G0(n,this),n=yx(n),n._a?(e=n._isUTC?oi(n._a):Ge(n._a),this._isDSTShifted=this.isValid()&&ZS(n._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function uP(){return this.isValid()?!this._isUTC:!1}function lP(){return this.isValid()?this._isUTC:!1}function xx(){return this.isValid()?this._isUTC&&this._offset===0:!1}var hP=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,dP=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Wn(n,e){var t=n,i=null,s,r,o;return _u(n)?t={ms:n._milliseconds,d:n._days,M:n._months}:Ni(n)||!isNaN(+n)?(t={},e?t[e]=+n:t.milliseconds=+n):(i=hP.exec(n))?(s=i[1]==="-"?-1:1,t={y:0,d:_e(i[$n])*s,h:_e(i[ht])*s,m:_e(i[Nn])*s,s:_e(i[_i])*s,ms:_e(Vf(i[Ms]*1e3))*s}):(i=dP.exec(n))?(s=i[1]==="-"?-1:1,t={y:Ts(i[2],s),M:Ts(i[3],s),w:Ts(i[4],s),d:Ts(i[5],s),h:Ts(i[6],s),m:Ts(i[7],s),s:Ts(i[8],s)}):t==null?t={}:typeof t=="object"&&("from"in t||"to"in t)&&(o=fP(Ge(t.from),Ge(t.to)),t={},t.ms=o.milliseconds,t.M=o.months),r=new ql(t),_u(n)&&Ae(n,"_locale")&&(r._locale=n._locale),_u(n)&&Ae(n,"_isValid")&&(r._isValid=n._isValid),r}Wn.fn=ql.prototype;Wn.invalid=XS;function Ts(n,e){var t=n&&parseFloat(n.replace(",","."));return(isNaN(t)?0:t)*e}function fy(n,e){var t={};return t.months=e.month()-n.month()+(e.year()-n.year())*12,n.clone().add(t.months,"M").isAfter(e)&&--t.months,t.milliseconds=+e-+n.clone().add(t.months,"M"),t}function fP(n,e){var t;return n.isValid()&&e.isValid()?(e=cm(e,n),n.isBefore(e)?t=fy(n,e):(t=fy(e,n),t.milliseconds=-t.milliseconds,t.months=-t.months),t):{milliseconds:0,months:0}}function Ex(n,e){return function(t,i){var s,r;return i!==null&&!isNaN(+i)&&(jw(e,"moment()."+e+"(period, number) is deprecated. Please use moment()."+e+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),r=t,t=i,i=r),s=Wn(t,i),Ix(this,s,n),this}}function Ix(n,e,t,i){var s=e._milliseconds,r=Vf(e._days),o=Vf(e._months);n.isValid()&&(i=i??!0,o&&ax(n,La(n,"Month")+o*t),r&&sx(n,"Date",La(n,"Date")+r*t),s&&n._d.setTime(n._d.valueOf()+s*t),i&&W.updateOffset(n,r||o))}var mP=Ex(1,"add"),pP=Ex(-1,"subtract");function Tx(n){return typeof n=="string"||n instanceof String}function gP(n){return Vn(n)||vc(n)||Tx(n)||Ni(n)||_P(n)||yP(n)||n===null||n===void 0}function yP(n){var e=Ws(n)&&!q0(n),t=!1,i=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],s,r,o=i.length;for(s=0;s<o;s+=1)r=i[s],t=t||Ae(n,r);return e&&t}function _P(n){var e=Ln(n),t=!1;return e&&(t=n.filter(function(i){return!Ni(i)&&Tx(n)}).length===0),e&&t}function vP(n){var e=Ws(n)&&!q0(n),t=!1,i=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],s,r;for(s=0;s<i.length;s+=1)r=i[s],t=t||Ae(n,r);return e&&t}function wP(n,e){var t=n.diff(e,"days",!0);return t<-6?"sameElse":t<-1?"lastWeek":t<0?"lastDay":t<1?"sameDay":t<2?"nextDay":t<7?"nextWeek":"sameElse"}function xP(n,e){arguments.length===1&&(arguments[0]?gP(arguments[0])?(n=arguments[0],e=void 0):vP(arguments[0])&&(e=arguments[0],n=void 0):(n=void 0,e=void 0));var t=n||Ge(),i=cm(t,this).startOf("day"),s=W.calendarFormat(this,i)||"sameElse",r=e&&(ai(e[s])?e[s].call(this,t):e[s]);return this.format(r||this.localeData().calendar(s,this,Ge(t)))}function EP(){return new wc(this)}function IP(n,e){var t=Vn(n)?n:Ge(n);return this.isValid()&&t.isValid()?(e=Cn(e)||"millisecond",e==="millisecond"?this.valueOf()>t.valueOf():t.valueOf()<this.clone().startOf(e).valueOf()):!1}function TP(n,e){var t=Vn(n)?n:Ge(n);return this.isValid()&&t.isValid()?(e=Cn(e)||"millisecond",e==="millisecond"?this.valueOf()<t.valueOf():this.clone().endOf(e).valueOf()<t.valueOf()):!1}function DP(n,e,t,i){var s=Vn(n)?n:Ge(n),r=Vn(e)?e:Ge(e);return this.isValid()&&s.isValid()&&r.isValid()?(i=i||"()",(i[0]==="("?this.isAfter(s,t):!this.isBefore(s,t))&&(i[1]===")"?this.isBefore(r,t):!this.isAfter(r,t))):!1}function AP(n,e){var t=Vn(n)?n:Ge(n),i;return this.isValid()&&t.isValid()?(e=Cn(e)||"millisecond",e==="millisecond"?this.valueOf()===t.valueOf():(i=t.valueOf(),this.clone().startOf(e).valueOf()<=i&&i<=this.clone().endOf(e).valueOf())):!1}function CP(n,e){return this.isSame(n,e)||this.isAfter(n,e)}function bP(n,e){return this.isSame(n,e)||this.isBefore(n,e)}function kP(n,e,t){var i,s,r;if(!this.isValid())return NaN;if(i=cm(n,this),!i.isValid())return NaN;switch(s=(i.utcOffset()-this.utcOffset())*6e4,e=Cn(e),e){case"year":r=vu(this,i)/12;break;case"month":r=vu(this,i);break;case"quarter":r=vu(this,i)/3;break;case"second":r=(this-i)/1e3;break;case"minute":r=(this-i)/6e4;break;case"hour":r=(this-i)/36e5;break;case"day":r=(this-i-s)/864e5;break;case"week":r=(this-i-s)/6048e5;break;default:r=this-i}return t?r:vn(r)}function vu(n,e){if(n.date()<e.date())return-vu(e,n);var t=(e.year()-n.year())*12+(e.month()-n.month()),i=n.clone().add(t,"months"),s,r;return e-i<0?(s=n.clone().add(t-1,"months"),r=(e-i)/(i-s)):(s=n.clone().add(t+1,"months"),r=(e-i)/(s-i)),-(t+r)||0}W.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";W.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function SP(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function PP(n){if(!this.isValid())return null;var e=n!==!0,t=e?this.clone().utc():this;return t.year()<0||t.year()>9999?yu(t,e?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):ai(Date.prototype.toISOString)?e?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",yu(t,"Z")):yu(t,e?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function RP(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var n="moment",e="",t,i,s,r;return this.isLocal()||(n=this.utcOffset()===0?"moment.utc":"moment.parseZone",e="Z"),t="["+n+'("]',i=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",s="-MM-DD[T]HH:mm:ss.SSS",r=e+'[")]',this.format(t+i+s+r)}function NP(n){n||(n=this.isUtc()?W.defaultFormatUtc:W.defaultFormat);var e=yu(this,n);return this.localeData().postformat(e)}function MP(n,e){return this.isValid()&&(Vn(n)&&n.isValid()||Ge(n).isValid())?Wn({to:this,from:n}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function OP(n){return this.from(Ge(),n)}function FP(n,e){return this.isValid()&&(Vn(n)&&n.isValid()||Ge(n).isValid())?Wn({from:this,to:n}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function BP(n){return this.to(Ge(),n)}function Dx(n){var e;return n===void 0?this._locale._abbr:(e=Wi(n),e!=null&&(this._locale=e),this)}var Ax=An("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(n){return n===void 0?this.localeData():this.locale(n)});function Cx(){return this._locale}var Bu=1e3,Br=60*Bu,Lu=60*Br,bx=(365*400+97)*24*Lu;function Lr(n,e){return(n%e+e)%e}function kx(n,e,t){return n<100&&n>=0?new Date(n+400,e,t)-bx:new Date(n,e,t).valueOf()}function Sx(n,e,t){return n<100&&n>=0?Date.UTC(n+400,e,t)-bx:Date.UTC(n,e,t)}function LP(n){var e,t;if(n=Cn(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Sx:kx,n){case"year":e=t(this.year(),0,1);break;case"quarter":e=t(this.year(),this.month()-this.month()%3,1);break;case"month":e=t(this.year(),this.month(),1);break;case"week":e=t(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":e=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":e=t(this.year(),this.month(),this.date());break;case"hour":e=this._d.valueOf(),e-=Lr(e+(this._isUTC?0:this.utcOffset()*Br),Lu);break;case"minute":e=this._d.valueOf(),e-=Lr(e,Br);break;case"second":e=this._d.valueOf(),e-=Lr(e,Bu);break}return this._d.setTime(e),W.updateOffset(this,!0),this}function VP(n){var e,t;if(n=Cn(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Sx:kx,n){case"year":e=t(this.year()+1,0,1)-1;break;case"quarter":e=t(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":e=t(this.year(),this.month()+1,1)-1;break;case"week":e=t(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":e=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":e=t(this.year(),this.month(),this.date()+1)-1;break;case"hour":e=this._d.valueOf(),e+=Lu-Lr(e+(this._isUTC?0:this.utcOffset()*Br),Lu)-1;break;case"minute":e=this._d.valueOf(),e+=Br-Lr(e,Br)-1;break;case"second":e=this._d.valueOf(),e+=Bu-Lr(e,Bu)-1;break}return this._d.setTime(e),W.updateOffset(this,!0),this}function UP(){return this._d.valueOf()-(this._offset||0)*6e4}function WP(){return Math.floor(this.valueOf()/1e3)}function HP(){return new Date(this.valueOf())}function $P(){var n=this;return[n.year(),n.month(),n.date(),n.hour(),n.minute(),n.second(),n.millisecond()]}function qP(){var n=this;return{years:n.year(),months:n.month(),date:n.date(),hours:n.hours(),minutes:n.minutes(),seconds:n.seconds(),milliseconds:n.milliseconds()}}function zP(){return this.isValid()?this.toISOString():null}function GP(){return z0(this)}function YP(){return Zi({},ce(this))}function JP(){return ce(this).overflow}function KP(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}K("N",0,0,"eraAbbr");K("NN",0,0,"eraAbbr");K("NNN",0,0,"eraAbbr");K("NNNN",0,0,"eraName");K("NNNNN",0,0,"eraNarrow");K("y",["y",1],"yo","eraYear");K("y",["yy",2],0,"eraYear");K("y",["yyy",3],0,"eraYear");K("y",["yyyy",4],0,"eraYear");H("N",um);H("NN",um);H("NNN",um);H("NNNN",oR);H("NNNNN",aR);Fe(["N","NN","NNN","NNNN","NNNNN"],function(n,e,t,i){var s=t._locale.erasParse(n,i,t._strict);s?ce(t).era=s:ce(t).invalidEra=n});H("y",Ao);H("yy",Ao);H("yyy",Ao);H("yyyy",Ao);H("yo",cR);Fe(["y","yy","yyy","yyyy"],Ut);Fe(["yo"],function(n,e,t,i){var s;t._locale._eraYearOrdinalRegex&&(s=n.match(t._locale._eraYearOrdinalRegex)),t._locale.eraYearOrdinalParse?e[Ut]=t._locale.eraYearOrdinalParse(n,s):e[Ut]=parseInt(n,10)});function QP(n,e){var t,i,s,r=this._eras||Wi("en")._eras;for(t=0,i=r.length;t<i;++t){switch(typeof r[t].since){case"string":s=W(r[t].since).startOf("day"),r[t].since=s.valueOf();break}switch(typeof r[t].until){case"undefined":r[t].until=1/0;break;case"string":s=W(r[t].until).startOf("day").valueOf(),r[t].until=s.valueOf();break}}return r}function jP(n,e,t){var i,s,r=this.eras(),o,a,c;for(n=n.toUpperCase(),i=0,s=r.length;i<s;++i)if(o=r[i].name.toUpperCase(),a=r[i].abbr.toUpperCase(),c=r[i].narrow.toUpperCase(),t)switch(e){case"N":case"NN":case"NNN":if(a===n)return r[i];break;case"NNNN":if(o===n)return r[i];break;case"NNNNN":if(c===n)return r[i];break}else if([o,a,c].indexOf(n)>=0)return r[i]}function XP(n,e){var t=n.since<=n.until?1:-1;return e===void 0?W(n.since).year():W(n.since).year()+(e-n.offset)*t}function ZP(){var n,e,t,i=this.localeData().eras();for(n=0,e=i.length;n<e;++n)if(t=this.clone().startOf("day").valueOf(),i[n].since<=t&&t<=i[n].until||i[n].until<=t&&t<=i[n].since)return i[n].name;return""}function eR(){var n,e,t,i=this.localeData().eras();for(n=0,e=i.length;n<e;++n)if(t=this.clone().startOf("day").valueOf(),i[n].since<=t&&t<=i[n].until||i[n].until<=t&&t<=i[n].since)return i[n].narrow;return""}function tR(){var n,e,t,i=this.localeData().eras();for(n=0,e=i.length;n<e;++n)if(t=this.clone().startOf("day").valueOf(),i[n].since<=t&&t<=i[n].until||i[n].until<=t&&t<=i[n].since)return i[n].abbr;return""}function nR(){var n,e,t,i,s=this.localeData().eras();for(n=0,e=s.length;n<e;++n)if(t=s[n].since<=s[n].until?1:-1,i=this.clone().startOf("day").valueOf(),s[n].since<=i&&i<=s[n].until||s[n].until<=i&&i<=s[n].since)return(this.year()-W(s[n].since).year())*t+s[n].offset;return this.year()}function iR(n){return Ae(this,"_erasNameRegex")||lm.call(this),n?this._erasNameRegex:this._erasRegex}function sR(n){return Ae(this,"_erasAbbrRegex")||lm.call(this),n?this._erasAbbrRegex:this._erasRegex}function rR(n){return Ae(this,"_erasNarrowRegex")||lm.call(this),n?this._erasNarrowRegex:this._erasRegex}function um(n,e){return e.erasAbbrRegex(n)}function oR(n,e){return e.erasNameRegex(n)}function aR(n,e){return e.erasNarrowRegex(n)}function cR(n,e){return e._eraYearOrdinalRegex||Ao}function lm(){var n=[],e=[],t=[],i=[],s,r,o,a,c,u=this.eras();for(s=0,r=u.length;s<r;++s)o=bi(u[s].name),a=bi(u[s].abbr),c=bi(u[s].narrow),e.push(o),n.push(a),t.push(c),i.push(o),i.push(a),i.push(c);this._erasRegex=new RegExp("^("+i.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+e.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+t.join("|")+")","i")}K(0,["gg",2],0,function(){return this.weekYear()%100});K(0,["GG",2],0,function(){return this.isoWeekYear()%100});function zl(n,e){K(0,[n,n.length],0,e)}zl("gggg","weekYear");zl("ggggg","weekYear");zl("GGGG","isoWeekYear");zl("GGGGG","isoWeekYear");H("G",Ul);H("g",Ul);H("GG",Ye,mn);H("gg",Ye,mn);H("GGGG",j0,Q0);H("gggg",j0,Q0);H("GGGGG",Vl,Bl);H("ggggg",Vl,Bl);Ec(["gggg","ggggg","GGGG","GGGGG"],function(n,e,t,i){e[i.substr(0,2)]=_e(n)});Ec(["gg","GG"],function(n,e,t,i){e[i]=W.parseTwoDigitYear(n)});function uR(n){return Px.call(this,n,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function lR(n){return Px.call(this,n,this.isoWeek(),this.isoWeekday(),1,4)}function hR(){return ki(this.year(),1,4)}function dR(){return ki(this.isoWeekYear(),1,4)}function fR(){var n=this.localeData()._week;return ki(this.year(),n.dow,n.doy)}function mR(){var n=this.localeData()._week;return ki(this.weekYear(),n.dow,n.doy)}function Px(n,e,t,i,s){var r;return n==null?Ua(this,i,s).year:(r=ki(n,i,s),e>r&&(e=r),pR.call(this,n,e,t,i,s))}function pR(n,e,t,i,s){var r=lx(n,e,t,i,s),o=Va(r.year,0,r.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}K("Q",0,"Qo","quarter");H("Q",Zw);Fe("Q",function(n,e){e[yi]=(_e(n)-1)*3});function gR(n){return n==null?Math.ceil((this.month()+1)/3):this.month((n-1)*3+this.month()%3)}K("D",["DD",2],"Do","date");H("D",Ye,Co);H("DD",Ye,mn);H("Do",function(n,e){return n?e._dayOfMonthOrdinalParse||e._ordinalParse:e._dayOfMonthOrdinalParseLenient});Fe(["D","DD"],$n);Fe("Do",function(n,e){e[$n]=_e(n.match(Ye)[0])});var Rx=bo("Date",!0);K("DDD",["DDDD",3],"DDDo","dayOfYear");H("DDD",Ll);H("DDDD",ex);Fe(["DDD","DDDD"],function(n,e,t){t._dayOfYear=_e(n)});function yR(n){var e=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return n==null?e:this.add(n-e,"d")}K("m",["mm",2],0,"minute");H("m",Ye,X0);H("mm",Ye,mn);Fe(["m","mm"],Nn);var _R=bo("Minutes",!1);K("s",["ss",2],0,"second");H("s",Ye,X0);H("ss",Ye,mn);Fe(["s","ss"],_i);var vR=bo("Seconds",!1);K("S",0,0,function(){return~~(this.millisecond()/100)});K(0,["SS",2],0,function(){return~~(this.millisecond()/10)});K(0,["SSS",3],0,"millisecond");K(0,["SSSS",4],0,function(){return this.millisecond()*10});K(0,["SSSSS",5],0,function(){return this.millisecond()*100});K(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});K(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});K(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});K(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});H("S",Ll,Zw);H("SS",Ll,mn);H("SSS",Ll,ex);var es,Nx;for(es="SSSS";es.length<=9;es+="S")H(es,Ao);function wR(n,e){e[Ms]=_e(("0."+n)*1e3)}for(es="S";es.length<=9;es+="S")Fe(es,wR);Nx=bo("Milliseconds",!1);K("z",0,0,"zoneAbbr");K("zz",0,0,"zoneName");function xR(){return this._isUTC?"UTC":""}function ER(){return this._isUTC?"Coordinated Universal Time":""}var B=wc.prototype;B.add=mP;B.calendar=xP;B.clone=EP;B.diff=kP;B.endOf=VP;B.format=NP;B.from=MP;B.fromNow=OP;B.to=FP;B.toNow=BP;B.get=Rk;B.invalidAt=JP;B.isAfter=IP;B.isBefore=TP;B.isBetween=DP;B.isSame=AP;B.isSameOrAfter=CP;B.isSameOrBefore=bP;B.isValid=GP;B.lang=Ax;B.locale=Dx;B.localeData=Cx;B.max=GS;B.min=zS;B.parsingFlags=YP;B.set=Nk;B.startOf=LP;B.subtract=pP;B.toArray=$P;B.toObject=qP;B.toDate=HP;B.toISOString=PP;B.inspect=RP;typeof Symbol<"u"&&Symbol.for!=null&&(B[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});B.toJSON=zP;B.toString=SP;B.unix=WP;B.valueOf=UP;B.creationData=KP;B.eraName=ZP;B.eraNarrow=eR;B.eraAbbr=tR;B.eraYear=nR;B.year=ix;B.isLeapYear=Pk;B.weekYear=uR;B.isoWeekYear=lR;B.quarter=B.quarters=gR;B.month=cx;B.daysInMonth=Hk;B.week=B.weeks=Qk;B.isoWeek=B.isoWeeks=jk;B.weeksInYear=fR;B.weeksInWeekYear=mR;B.isoWeeksInYear=hR;B.isoWeeksInISOWeekYear=dR;B.date=Rx;B.day=B.days=lS;B.weekday=hS;B.isoWeekday=dS;B.dayOfYear=yR;B.hour=B.hours=vS;B.minute=B.minutes=_R;B.second=B.seconds=vR;B.millisecond=B.milliseconds=Nx;B.utcOffset=tP;B.utc=iP;B.local=sP;B.parseZone=rP;B.hasAlignedHourOffset=oP;B.isDST=aP;B.isLocal=uP;B.isUtcOffset=lP;B.isUtc=xx;B.isUTC=xx;B.zoneAbbr=xR;B.zoneName=ER;B.dates=An("dates accessor is deprecated. Use date instead.",Rx);B.months=An("months accessor is deprecated. Use month instead",cx);B.years=An("years accessor is deprecated. Use year instead",ix);B.zone=An("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",nP);B.isDSTShifted=An("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",cP);function IR(n){return Ge(n*1e3)}function TR(){return Ge.apply(null,arguments).parseZone()}function Mx(n){return n}var Ce=Y0.prototype;Ce.calendar=uk;Ce.longDateFormat=fk;Ce.invalidDate=pk;Ce.ordinal=_k;Ce.preparse=Mx;Ce.postformat=Mx;Ce.relativeTime=wk;Ce.pastFuture=xk;Ce.set=ak;Ce.eras=QP;Ce.erasParse=jP;Ce.erasConvertYear=XP;Ce.erasAbbrRegex=sR;Ce.erasNameRegex=iR;Ce.erasNarrowRegex=rR;Ce.months=Lk;Ce.monthsShort=Vk;Ce.monthsParse=Wk;Ce.monthsRegex=qk;Ce.monthsShortRegex=$k;Ce.week=Gk;Ce.firstDayOfYear=Kk;Ce.firstDayOfWeek=Jk;Ce.weekdays=rS;Ce.weekdaysMin=aS;Ce.weekdaysShort=oS;Ce.weekdaysParse=uS;Ce.weekdaysRegex=fS;Ce.weekdaysShortRegex=mS;Ce.weekdaysMinRegex=pS;Ce.isPM=yS;Ce.meridiem=wS;function Vu(n,e,t,i){var s=Wi(),r=oi().set(i,e);return s[t](r,n)}function Ox(n,e,t){if(Ni(n)&&(e=n,n=void 0),n=n||"",e!=null)return Vu(n,e,t,"month");var i,s=[];for(i=0;i<12;i++)s[i]=Vu(n,i,t,"month");return s}function hm(n,e,t,i){typeof n=="boolean"?(Ni(e)&&(t=e,e=void 0),e=e||""):(e=n,t=e,n=!1,Ni(e)&&(t=e,e=void 0),e=e||"");var s=Wi(),r=n?s._week.dow:0,o,a=[];if(t!=null)return Vu(e,(t+r)%7,i,"day");for(o=0;o<7;o++)a[o]=Vu(e,(o+r)%7,i,"day");return a}function DR(n,e){return Ox(n,e,"months")}function AR(n,e){return Ox(n,e,"monthsShort")}function CR(n,e,t){return hm(n,e,t,"weekdays")}function bR(n,e,t){return hm(n,e,t,"weekdaysShort")}function kR(n,e,t){return hm(n,e,t,"weekdaysMin")}rs("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var e=n%10,t=_e(n%100/10)===1?"th":e===1?"st":e===2?"nd":e===3?"rd":"th";return n+t}});W.lang=An("moment.lang is deprecated. Use moment.locale instead.",rs);W.langData=An("moment.langData is deprecated. Use moment.localeData instead.",Wi);var ui=Math.abs;function SR(){var n=this._data;return this._milliseconds=ui(this._milliseconds),this._days=ui(this._days),this._months=ui(this._months),n.milliseconds=ui(n.milliseconds),n.seconds=ui(n.seconds),n.minutes=ui(n.minutes),n.hours=ui(n.hours),n.months=ui(n.months),n.years=ui(n.years),this}function Fx(n,e,t,i){var s=Wn(e,t);return n._milliseconds+=i*s._milliseconds,n._days+=i*s._days,n._months+=i*s._months,n._bubble()}function PR(n,e){return Fx(this,n,e,1)}function RR(n,e){return Fx(this,n,e,-1)}function my(n){return n<0?Math.floor(n):Math.ceil(n)}function NR(){var n=this._milliseconds,e=this._days,t=this._months,i=this._data,s,r,o,a,c;return n>=0&&e>=0&&t>=0||n<=0&&e<=0&&t<=0||(n+=my(Wf(t)+e)*864e5,e=0,t=0),i.milliseconds=n%1e3,s=vn(n/1e3),i.seconds=s%60,r=vn(s/60),i.minutes=r%60,o=vn(r/60),i.hours=o%24,e+=vn(o/24),c=vn(Bx(e)),t+=c,e-=my(Wf(c)),a=vn(t/12),t%=12,i.days=e,i.months=t,i.years=a,this}function Bx(n){return n*4800/146097}function Wf(n){return n*146097/4800}function MR(n){if(!this.isValid())return NaN;var e,t,i=this._milliseconds;if(n=Cn(n),n==="month"||n==="quarter"||n==="year")switch(e=this._days+i/864e5,t=this._months+Bx(e),n){case"month":return t;case"quarter":return t/3;case"year":return t/12}else switch(e=this._days+Math.round(Wf(this._months)),n){case"week":return e/7+i/6048e5;case"day":return e+i/864e5;case"hour":return e*24+i/36e5;case"minute":return e*1440+i/6e4;case"second":return e*86400+i/1e3;case"millisecond":return Math.floor(e*864e5)+i;default:throw new Error("Unknown unit "+n)}}function Hi(n){return function(){return this.as(n)}}var Lx=Hi("ms"),OR=Hi("s"),FR=Hi("m"),BR=Hi("h"),LR=Hi("d"),VR=Hi("w"),UR=Hi("M"),WR=Hi("Q"),HR=Hi("y"),$R=Lx;function qR(){return Wn(this)}function zR(n){return n=Cn(n),this.isValid()?this[n+"s"]():NaN}function cr(n){return function(){return this.isValid()?this._data[n]:NaN}}var GR=cr("milliseconds"),YR=cr("seconds"),JR=cr("minutes"),KR=cr("hours"),QR=cr("days"),jR=cr("months"),XR=cr("years");function ZR(){return vn(this.days()/7)}var di=Math.round,Pr={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function eN(n,e,t,i,s){return s.relativeTime(e||1,!!t,n,i)}function tN(n,e,t,i){var s=Wn(n).abs(),r=di(s.as("s")),o=di(s.as("m")),a=di(s.as("h")),c=di(s.as("d")),u=di(s.as("M")),l=di(s.as("w")),h=di(s.as("y")),f=r<=t.ss&&["s",r]||r<t.s&&["ss",r]||o<=1&&["m"]||o<t.m&&["mm",o]||a<=1&&["h"]||a<t.h&&["hh",a]||c<=1&&["d"]||c<t.d&&["dd",c];return t.w!=null&&(f=f||l<=1&&["w"]||l<t.w&&["ww",l]),f=f||u<=1&&["M"]||u<t.M&&["MM",u]||h<=1&&["y"]||["yy",h],f[2]=e,f[3]=+n>0,f[4]=i,eN.apply(null,f)}function nN(n){return n===void 0?di:typeof n=="function"?(di=n,!0):!1}function iN(n,e){return Pr[n]===void 0?!1:e===void 0?Pr[n]:(Pr[n]=e,n==="s"&&(Pr.ss=e-1),!0)}function sN(n,e){if(!this.isValid())return this.localeData().invalidDate();var t=!1,i=Pr,s,r;return typeof n=="object"&&(e=n,n=!1),typeof n=="boolean"&&(t=n),typeof e=="object"&&(i=Object.assign({},Pr,e),e.s!=null&&e.ss==null&&(i.ss=e.s-1)),s=this.localeData(),r=tN(this,!t,i,s),t&&(r=s.pastFuture(+this,r)),s.postformat(r)}var ad=Math.abs;function Er(n){return(n>0)-(n<0)||+n}function Gl(){if(!this.isValid())return this.localeData().invalidDate();var n=ad(this._milliseconds)/1e3,e=ad(this._days),t=ad(this._months),i,s,r,o,a=this.asSeconds(),c,u,l,h;return a?(i=vn(n/60),s=vn(i/60),n%=60,i%=60,r=vn(t/12),t%=12,o=n?n.toFixed(3).replace(/\.?0+$/,""):"",c=a<0?"-":"",u=Er(this._months)!==Er(a)?"-":"",l=Er(this._days)!==Er(a)?"-":"",h=Er(this._milliseconds)!==Er(a)?"-":"",c+"P"+(r?u+r+"Y":"")+(t?u+t+"M":"")+(e?l+e+"D":"")+(s||i||n?"T":"")+(s?h+s+"H":"")+(i?h+i+"M":"")+(n?h+o+"S":"")):"P0D"}var Ee=ql.prototype;Ee.isValid=jS;Ee.abs=SR;Ee.add=PR;Ee.subtract=RR;Ee.as=MR;Ee.asMilliseconds=Lx;Ee.asSeconds=OR;Ee.asMinutes=FR;Ee.asHours=BR;Ee.asDays=LR;Ee.asWeeks=VR;Ee.asMonths=UR;Ee.asQuarters=WR;Ee.asYears=HR;Ee.valueOf=$R;Ee._bubble=NR;Ee.clone=qR;Ee.get=zR;Ee.milliseconds=GR;Ee.seconds=YR;Ee.minutes=JR;Ee.hours=KR;Ee.days=QR;Ee.weeks=ZR;Ee.months=jR;Ee.years=XR;Ee.humanize=sN;Ee.toISOString=Gl;Ee.toString=Gl;Ee.toJSON=Gl;Ee.locale=Dx;Ee.localeData=Cx;Ee.toIsoString=An("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Gl);Ee.lang=Ax;K("X",0,0,"unix");K("x",0,0,"valueOf");H("x",Ul);H("X",Dk);Fe("X",function(n,e,t){t._d=new Date(parseFloat(n)*1e3)});Fe("x",function(n,e,t){t._d=new Date(_e(n))});//! moment.js
W.version="2.30.1";rk(Ge);W.fn=B;W.min=YS;W.max=JS;W.now=KS;W.utc=oi;W.unix=IR;W.months=DR;W.isDate=vc;W.locale=rs;W.invalid=Fl;W.duration=Wn;W.isMoment=Vn;W.weekdays=CR;W.parseZone=TR;W.localeData=Wi;W.isDuration=_u;W.monthsShort=AR;W.weekdaysMin=kR;W.defineLocale=im;W.updateLocale=TS;W.locales=DS;W.weekdaysShort=bR;W.normalizeUnits=Cn;W.relativeTimeRounding=nN;W.relativeTimeThreshold=iN;W.calendarFormat=wP;W.prototype=B;W.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};const rN="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDU2LjY5MyA1Ni42OTMiIGhlaWdodD0iNTYuNjkzcHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1Ni42OTMgNTYuNjkzIiB3aWR0aD0iNTYuNjkzcHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik00MS43NzcsMzAuNTE3Yy0wLjA2Mi02LjIzMiw1LjA4Mi05LjIyMSw1LjMxMi05LjM3MmMtMi44OTEtNC4yMjctNy4zOTUtNC44MDctOC45OTgtNC44NzMgICBjLTMuODMtMC4zODktNy40NzcsMi4yNTYtOS40MiwyLjI1NmMtMS45MzksMC00Ljk0MS0yLjE5OS04LjExNy0yLjE0M2MtNC4xNzgsMC4wNjItOC4wMjksMi40My0xMC4xNzksNi4xNyAgIGMtNC4zMzksNy41MjctMS4xMSwxOC42ODIsMy4xMTgsMjQuNzkxYzIuMDY3LDIuOTg2LDQuNTMyLDYuMzQ2LDcuNzY2LDYuMjIzYzMuMTE3LTAuMTIzLDQuMjkzLTIuMDE2LDguMDYxLTIuMDE2ICAgczQuODI2LDIuMDE2LDguMTIzLDEuOTUzYzMuMzUyLTAuMDYxLDUuNDc3LTMuMDQzLDcuNTI3LTYuMDQxYzIuMzczLTMuNDY5LDMuMzUtNi44MjgsMy40MDgtNi45OTggICBDNDguMzA1LDQwLjQzMyw0MS44NDQsMzcuOTU4LDQxLjc3NywzMC41MTd6Ii8+PHBhdGggZD0iTTM1LjU4MiwxMi4yMjljMS43MTUtMi4wODIsMi44NzctNC45NzUsMi41NjEtNy44NTVjLTIuNDc1LDAuMS01LjQ3MSwxLjY0NS03LjI0OCwzLjcyNSAgIGMtMS41OTIsMS44NDYtMi45ODQsNC43ODUtMi42MTEsNy42MTNDMzEuMDQ1LDE1LjkyNiwzMy44NjEsMTQuMzA3LDM1LjU4MiwxMi4yMjl6Ii8+PC9nPjwvc3ZnPg==",oN="data:image/svg+xml,%3c?xml%20version='1.0'%20?%3e%3csvg%20id='Layer_1'%20style='enable-background:new%200%200%201000%201000;'%20version='1.1'%20viewBox='0%200%201000%201000'%20xml:space='preserve'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%233B579D;}%20.st1{fill:%23FFFFFF;}%20%3c/style%3e%3ctitle/%3e%3cg%3e%3cpath%20class='st0'%20d='M500,1000L500,1000C223.9,1000,0,776.1,0,500v0C0,223.9,223.9,0,500,0h0c276.1,0,500,223.9,500,500v0%20C1000,776.1,776.1,1000,500,1000z'/%3e%3cpath%20class='st1'%20d='M630,1000V612.7h130l19.5-150.9H630v-96.4c0-43.7,12.1-73.5,74.8-73.5l79.9,0V157%20c-13.8-1.8-61.3-5.9-116.5-5.9c-115.2,0-194.1,70.3-194.1,199.5v111.3H343.8v150.9h130.3V1000H630z'%20id='f'/%3e%3c/g%3e%3c/svg%3e",aN="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyOCAxMjgiIGlkPSJTb2NpYWxfSWNvbnMiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnIGlkPSJfeDMxX19zdHJva2UiPjxnIGlkPSJHb29nbGUiPjxyZWN0IGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBoZWlnaHQ9IjEyOCIgd2lkdGg9IjEyOCIvPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI3LjU4NSw2NGMwLTQuMTU3LDAuNjktOC4xNDMsMS45MjMtMTEuODgxTDcuOTM4LDM1LjY0OCAgICBDMy43MzQsNDQuMTgzLDEuMzY2LDUzLjgwMSwxLjM2Niw2NGMwLDEwLjE5MSwyLjM2NiwxOS44MDIsNi41NjMsMjguMzMybDIxLjU1OC0xNi41MDNDMjguMjY2LDcyLjEwOCwyNy41ODUsNjguMTM3LDI3LjU4NSw2NCIgZmlsbD0iI0ZCQkMwNSIgZmlsbC1ydWxlPSJldmVub2RkIi8+PHBhdGggY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNjUuNDU3LDI2LjE4MmM5LjAzMSwwLDE3LjE4OCwzLjIsMjMuNTk3LDguNDM2TDEwNy42OTgsMTYgICAgQzk2LjMzNyw2LjEwOSw4MS43NzEsMCw2NS40NTcsMEM0MC4xMjksMCwxOC4zNjEsMTQuNDg0LDcuOTM4LDM1LjY0OGwyMS41NjksMTYuNDcxQzM0LjQ3NywzNy4wMzMsNDguNjQ0LDI2LjE4Miw2NS40NTcsMjYuMTgyIiBmaWxsPSIjRUE0MzM1IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik02NS40NTcsMTAxLjgxOGMtMTYuODEyLDAtMzAuOTc5LTEwLjg1MS0zNS45NDktMjUuOTM3ICAgIEw3LjkzOCw5Mi4zNDlDMTguMzYxLDExMy41MTYsNDAuMTI5LDEyOCw2NS40NTcsMTI4YzE1LjYzMiwwLDMwLjU1Ny01LjU1MSw0MS43NTgtMTUuOTUxTDg2Ljc0MSw5Ni4yMjEgICAgQzgwLjk2NCw5OS44Niw3My42ODksMTAxLjgxOCw2NS40NTcsMTAxLjgxOCIgZmlsbD0iIzM0QTg1MyIgZmlsbC1ydWxlPSJldmVub2RkIi8+PHBhdGggY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTI2LjYzNCw2NGMwLTMuNzgyLTAuNTgzLTcuODU1LTEuNDU3LTExLjYzNkg2NS40NTd2MjQuNzI3ICAgIGgzNC4zNzZjLTEuNzE5LDguNDMxLTYuMzk3LDE0LjkxMi0xMy4wOTIsMTkuMTNsMjAuNDc0LDE1LjgyOEMxMTguOTgxLDEwMS4xMjksMTI2LjYzNCw4NC44NjEsMTI2LjYzNCw2NCIgZmlsbD0iIzQyODVGNCIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9nPjwvZz48L3N2Zz4=";var Vx=(n=>(n[n.Apple=0]="Apple",n[n.Google=1]="Google",n[n.Facebook=2]="Facebook",n[n.Phone=3]="Phone",n))(Vx||{});const g5={0:"Apple",1:"Google",2:"Facebook",3:"Phone"},y5=[1,2,0,3],py={Apple:0,Google:1,Facebook:2,Phone:3},_5={0:rN,1:aN,2:oN,3:"Phone"},v5={0:"apple.com",1:"google.com",2:"facebook.com",3:"phone"};var cN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},U,dm=dm||{},se=cN||self;function Yl(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Ic(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function uN(n){return Object.prototype.hasOwnProperty.call(n,cd)&&n[cd]||(n[cd]=++lN)}var cd="closure_uid_"+(1e9*Math.random()>>>0),lN=0;function hN(n,e,t){return n.call.apply(n.bind,arguments)}function dN(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,i),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function Wt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Wt=hN:Wt=dN,Wt.apply(null,arguments)}function iu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function xt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(i,s,r){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(i,o)}}function vs(){this.s=this.s,this.o=this.o}var fN=0;vs.prototype.s=!1;vs.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),fN!=0)&&uN(this)};vs.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ux=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function fm(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function gy(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(Yl(i)){const s=n.length||0,r=i.length||0;n.length=s+r;for(let o=0;o<r;o++)n[s+o]=i[o]}else n.push(i)}}function Ht(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ht.prototype.h=function(){this.defaultPrevented=!0};var mN=function(){if(!se.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};se.addEventListener("test",t,e),se.removeEventListener("test",t,e)}catch{}return n}();function Ha(n){return/^[\s\xa0]*$/.test(n)}function Jl(){var n=se.navigator;return n&&(n=n.userAgent)?n:""}function qn(n){return Jl().indexOf(n)!=-1}function mm(n){return mm[" "](n),n}mm[" "]=function(){};function pN(n,e){var t=aM;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var gN=qn("Opera"),to=qn("Trident")||qn("MSIE"),Wx=qn("Edge"),Hf=Wx||to,Hx=qn("Gecko")&&!(Jl().toLowerCase().indexOf("webkit")!=-1&&!qn("Edge"))&&!(qn("Trident")||qn("MSIE"))&&!qn("Edge"),yN=Jl().toLowerCase().indexOf("webkit")!=-1&&!qn("Edge");function $x(){var n=se.document;return n?n.documentMode:void 0}var $f;e:{var ud="",ld=function(){var n=Jl();if(Hx)return/rv:([^\);]+)(\)|;)/.exec(n);if(Wx)return/Edge\/([\d\.]+)/.exec(n);if(to)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(yN)return/WebKit\/(\S+)/.exec(n);if(gN)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(ld&&(ud=ld?ld[1]:""),to){var hd=$x();if(hd!=null&&hd>parseFloat(ud)){$f=String(hd);break e}}$f=ud}var qf;if(se.document&&to){var yy=$x();qf=yy||parseInt($f,10)||void 0}else qf=void 0;var _N=qf;function $a(n,e){if(Ht.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Hx){e:{try{mm(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:vN[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&$a.$.h.call(this)}}xt($a,Ht);var vN={2:"touch",3:"pen",4:"mouse"};$a.prototype.h=function(){$a.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Tc="closure_listenable_"+(1e6*Math.random()|0),wN=0;function xN(n,e,t,i,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.la=s,this.key=++wN,this.fa=this.ia=!1}function Kl(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function pm(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function EN(n,e){for(const t in n)e.call(void 0,n[t],t,n)}function qx(n){const e={};for(const t in n)e[t]=n[t];return e}const _y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zx(n,e){let t,i;for(let s=1;s<arguments.length;s++){i=arguments[s];for(t in i)n[t]=i[t];for(let r=0;r<_y.length;r++)t=_y[r],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function Ql(n){this.src=n,this.g={},this.h=0}Ql.prototype.add=function(n,e,t,i,s){var r=n.toString();n=this.g[r],n||(n=this.g[r]=[],this.h++);var o=Gf(n,e,i,s);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new xN(e,this.src,r,!!i,s),e.ia=t,n.push(e)),e};function zf(n,e){var t=e.type;if(t in n.g){var i=n.g[t],s=Ux(i,e),r;(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Kl(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Gf(n,e,t,i){for(var s=0;s<n.length;++s){var r=n[s];if(!r.fa&&r.listener==e&&r.capture==!!t&&r.la==i)return s}return-1}var gm="closure_lm_"+(1e6*Math.random()|0),dd={};function Gx(n,e,t,i,s){if(i&&i.once)return Jx(n,e,t,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)Gx(n,e[r],t,i,s);return null}return t=vm(t),n&&n[Tc]?n.O(e,t,Ic(i)?!!i.capture:!!i,s):Yx(n,e,t,!1,i,s)}function Yx(n,e,t,i,s,r){if(!e)throw Error("Invalid event type");var o=Ic(s)?!!s.capture:!!s,a=_m(n);if(a||(n[gm]=a=new Ql(n)),t=a.add(e,t,i,o,r),t.proxy)return t;if(i=IN(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)mN||(s=o),s===void 0&&(s=!1),n.addEventListener(e.toString(),i,s);else if(n.attachEvent)n.attachEvent(Qx(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function IN(){function n(t){return e.call(n.src,n.listener,t)}const e=TN;return n}function Jx(n,e,t,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)Jx(n,e[r],t,i,s);return null}return t=vm(t),n&&n[Tc]?n.P(e,t,Ic(i)?!!i.capture:!!i,s):Yx(n,e,t,!0,i,s)}function Kx(n,e,t,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)Kx(n,e[r],t,i,s);else i=Ic(i)?!!i.capture:!!i,t=vm(t),n&&n[Tc]?(n=n.i,e=String(e).toString(),e in n.g&&(r=n.g[e],t=Gf(r,t,i,s),-1<t&&(Kl(r[t]),Array.prototype.splice.call(r,t,1),r.length==0&&(delete n.g[e],n.h--)))):n&&(n=_m(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Gf(e,t,i,s)),(t=-1<n?e[n]:null)&&ym(t))}function ym(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[Tc])zf(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(Qx(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=_m(e))?(zf(t,n),t.h==0&&(t.src=null,e[gm]=null)):Kl(n)}}}function Qx(n){return n in dd?dd[n]:dd[n]="on"+n}function TN(n,e){if(n.fa)n=!0;else{e=new $a(e,this);var t=n.listener,i=n.la||n.src;n.ia&&ym(n),n=t.call(i,e)}return n}function _m(n){return n=n[gm],n instanceof Ql?n:null}var fd="__closure_events_fn_"+(1e9*Math.random()>>>0);function vm(n){return typeof n=="function"?n:(n[fd]||(n[fd]=function(e){return n.handleEvent(e)}),n[fd])}function wt(){vs.call(this),this.i=new Ql(this),this.S=this,this.J=null}xt(wt,vs);wt.prototype[Tc]=!0;wt.prototype.removeEventListener=function(n,e,t,i){Kx(this,n,e,t,i)};function St(n,e){var t,i=n.J;if(i)for(t=[];i;i=i.J)t.push(i);if(n=n.S,i=e.type||e,typeof e=="string")e=new Ht(e,n);else if(e instanceof Ht)e.target=e.target||n;else{var s=e;e=new Ht(i,n),zx(e,s)}if(s=!0,t)for(var r=t.length-1;0<=r;r--){var o=e.g=t[r];s=su(o,i,!0,e)&&s}if(o=e.g=n,s=su(o,i,!0,e)&&s,s=su(o,i,!1,e)&&s,t)for(r=0;r<t.length;r++)o=e.g=t[r],s=su(o,i,!1,e)&&s}wt.prototype.N=function(){if(wt.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)Kl(t[i]);delete n.g[e],n.h--}}this.J=null};wt.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};wt.prototype.P=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function su(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.fa&&o.capture==t){var a=o.listener,c=o.la||o.src;o.ia&&zf(n.i,o),s=a.call(c,i)!==!1&&s}}return s&&!i.defaultPrevented}var wm=se.JSON.stringify;class DN{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function AN(){var n=xm;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class CN{constructor(){this.h=this.g=null}add(e,t){const i=jx.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}}var jx=new DN(()=>new bN,n=>n.reset());class bN{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function kN(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function SN(n){se.setTimeout(()=>{throw n},0)}let qa,za=!1,xm=new CN,Xx=()=>{const n=se.Promise.resolve(void 0);qa=()=>{n.then(PN)}};var PN=()=>{for(var n;n=AN();){try{n.h.call(n.g)}catch(t){SN(t)}var e=jx;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}za=!1};function jl(n,e){wt.call(this),this.h=n||1,this.g=e||se,this.j=Wt(this.qb,this),this.l=Date.now()}xt(jl,wt);U=jl.prototype;U.ga=!1;U.T=null;U.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),St(this,"tick"),this.ga&&(Em(this),this.start()))}};U.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Em(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}U.N=function(){jl.$.N.call(this),Em(this),delete this.g};function Im(n,e,t){if(typeof n=="function")t&&(n=Wt(n,t));else if(n&&typeof n.handleEvent=="function")n=Wt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:se.setTimeout(n,e||0)}function Zx(n){n.g=Im(()=>{n.g=null,n.i&&(n.i=!1,Zx(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class RN extends vs{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Zx(this)}N(){super.N(),this.g&&(se.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ga(n){vs.call(this),this.h=n,this.g={}}xt(Ga,vs);var vy=[];function eE(n,e,t,i){Array.isArray(t)||(t&&(vy[0]=t.toString()),t=vy);for(var s=0;s<t.length;s++){var r=Gx(e,t[s],i||n.handleEvent,!1,n.h||n);if(!r)break;n.g[r.key]=r}}function tE(n){pm(n.g,function(e,t){this.g.hasOwnProperty(t)&&ym(e)},n),n.g={}}Ga.prototype.N=function(){Ga.$.N.call(this),tE(this)};Ga.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Xl(){this.g=!0}Xl.prototype.Ea=function(){this.g=!1};function NN(n,e,t,i,s,r){n.info(function(){if(n.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+`
`+t+`
`+o})}function MN(n,e,t,i,s,r,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+`
`+t+`
`+r+" "+o})}function Rr(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+FN(n,t)+(i?" "+i:"")})}function ON(n,e){n.info(function(){return"TIMEOUT: "+e})}Xl.prototype.info=function(){};function FN(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if(r!="noop"&&r!="stop"&&r!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return wm(t)}catch{return e}}var ur={},wy=null;function Zl(){return wy=wy||new wt}ur.Ta="serverreachability";function nE(n){Ht.call(this,ur.Ta,n)}xt(nE,Ht);function Ya(n){const e=Zl();St(e,new nE(e))}ur.STAT_EVENT="statevent";function iE(n,e){Ht.call(this,ur.STAT_EVENT,n),this.stat=e}xt(iE,Ht);function Jt(n){const e=Zl();St(e,new iE(e,n))}ur.Ua="timingevent";function sE(n,e){Ht.call(this,ur.Ua,n),this.size=e}xt(sE,Ht);function Dc(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return se.setTimeout(function(){n()},e)}var eh={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},rE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Tm(){}Tm.prototype.h=null;function xy(n){return n.h||(n.h=n.i())}function oE(){}var Ac={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Dm(){Ht.call(this,"d")}xt(Dm,Ht);function Am(){Ht.call(this,"c")}xt(Am,Ht);var Yf;function th(){}xt(th,Tm);th.prototype.g=function(){return new XMLHttpRequest};th.prototype.i=function(){return{}};Yf=new th;function Cc(n,e,t,i){this.l=n,this.j=e,this.m=t,this.W=i||1,this.U=new Ga(this),this.P=BN,n=Hf?125:void 0,this.V=new jl(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new aE}function aE(){this.i=null,this.g="",this.h=!1}var BN=45e3,cE={},Jf={};U=Cc.prototype;U.setTimeout=function(n){this.P=n};function Kf(n,e,t){n.L=1,n.A=ih(Mi(e)),n.u=t,n.S=!0,uE(n,null)}function uE(n,e){n.G=Date.now(),bc(n),n.B=Mi(n.A);var t=n.B,i=n.W;Array.isArray(i)||(i=[String(i)]),yE(t.i,"t",i),n.o=0,t=n.l.J,n.h=new aE,n.g=LE(n.l,t?e:null,!n.u),0<n.O&&(n.M=new RN(Wt(n.Pa,n,n.g),n.O)),eE(n.U,n.g,"readystatechange",n.nb),e=n.I?qx(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Ya(),NN(n.j,n.v,n.B,n.m,n.W,n.u)}U.nb=function(n){n=n.target;const e=this.M;e&&Yn(n)==3?e.l():this.Pa(n)};U.Pa=function(n){try{if(n==this.g)e:{const l=Yn(this.g);var e=this.g.Ia();const h=this.g.da();if(!(3>l)&&(l!=3||Hf||this.g&&(this.h.h||this.g.ja()||Dy(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?Ya(3):Ya(2)),nh(this);var t=this.g.da();this.ca=t;t:if(lE(this)){var i=Dy(this.g);n="";var s=i.length,r=Yn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Os(this),pa(this);var o="";break t}this.h.i=new se.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,MN(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ha(a)){var u=a;break t}}u=null}if(t=u)Rr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qf(this,t);else{this.i=!1,this.s=3,Jt(12),Os(this),pa(this);break e}}this.S?(hE(this,l,o),Hf&&this.i&&l==3&&(eE(this.U,this.V,"tick",this.mb),this.V.start())):(Rr(this.j,this.m,o,null),Qf(this,o)),l==4&&Os(this),this.i&&!this.J&&(l==4?ME(this.l,this):(this.i=!1,bc(this)))}else sM(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Jt(12)):(this.s=0,Jt(13)),Os(this),pa(this)}}}catch{}finally{}};function lE(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function hE(n,e,t){let i=!0,s;for(;!n.J&&n.o<t.length;)if(s=LN(n,t),s==Jf){e==4&&(n.s=4,Jt(14),i=!1),Rr(n.j,n.m,null,"[Incomplete Response]");break}else if(s==cE){n.s=4,Jt(15),Rr(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else Rr(n.j,n.m,s,null),Qf(n,s);lE(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Jt(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Rm(e),e.M=!0,Jt(11))):(Rr(n.j,n.m,t,"[Invalid Chunked Response]"),Os(n),pa(n))}U.mb=function(){if(this.g){var n=Yn(this.g),e=this.g.ja();this.o<e.length&&(nh(this),hE(this,n,e),this.i&&n!=4&&bc(this))}};function LN(n,e){var t=n.o,i=e.indexOf(`
`,t);return i==-1?Jf:(t=Number(e.substring(t,i)),isNaN(t)?cE:(i+=1,i+t>e.length?Jf:(e=e.slice(i,i+t),n.o=i+t,e)))}U.cancel=function(){this.J=!0,Os(this)};function bc(n){n.Y=Date.now()+n.P,dE(n,n.P)}function dE(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Dc(Wt(n.lb,n),e)}function nh(n){n.C&&(se.clearTimeout(n.C),n.C=null)}U.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(ON(this.j,this.B),this.L!=2&&(Ya(),Jt(17)),Os(this),this.s=2,pa(this)):dE(this,this.Y-n)};function pa(n){n.l.H==0||n.J||ME(n.l,n)}function Os(n){nh(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Em(n.V),tE(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Qf(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||jf(t.i,n))){if(!n.K&&jf(t.i,n)&&t.H==3){try{var i=t.Ja.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var s=i;if(s[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Hu(t),ah(t);else break e;Pm(t),Jt(18)}}else t.Fa=s[1],0<t.Fa-t.V&&37500>s[2]&&t.G&&t.A==0&&!t.v&&(t.v=Dc(Wt(t.ib,t),6e3));if(1>=wE(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Fs(t,11)}else if((n.K||t.g==n)&&Hu(t),!Ha(e))for(s=t.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(t.V=u[0],u=u[1],t.H==2)if(u[0]=="c"){t.K=u[1],t.pa=u[2];const l=u[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));const h=u[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));const f=u[5];f!=null&&typeof f=="number"&&0<f&&(i=1.5*f,t.L=i,t.l.info("backChannelRequestTimeoutMs_="+i)),i=t;const m=n.g;if(m){const p=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var r=i.i;r.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(r.j=r.l,r.g=new Set,r.h&&(Cm(r,r.h),r.h=null))}if(i.F){const y=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;y&&(i.Da=y,ze(i.I,i.F,y))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),i=t;var o=n;if(i.wa=BE(i,i.J?i.pa:null,i.Y),o.K){xE(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.C&&(nh(a),bc(a)),i.g=o}else RE(i);0<t.j.length&&ch(t)}else u[0]!="stop"&&u[0]!="close"||Fs(t,7);else t.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Fs(t,7):Sm(t):u[0]!="noop"&&t.h&&t.h.Aa(u),t.A=0)}}Ya(4)}catch{}}function VN(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Yl(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function UN(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Yl(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}function fE(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Yl(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=UN(n),i=VN(n),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],t&&t[r],n)}var mE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function WN(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),s=null;if(0<=i){var r=n[t].substring(0,i);s=n[t].substring(i+1)}else r=n[t];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Hs(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Hs){this.h=n.h,Uu(this,n.j),this.s=n.s,this.g=n.g,Wu(this,n.m),this.l=n.l;var e=n.i,t=new Ja;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ey(this,t),this.o=n.o}else n&&(e=String(n).match(mE))?(this.h=!1,Uu(this,e[1]||"",!0),this.s=ra(e[2]||""),this.g=ra(e[3]||"",!0),Wu(this,e[4]),this.l=ra(e[5]||"",!0),Ey(this,e[6]||"",!0),this.o=ra(e[7]||"")):(this.h=!1,this.i=new Ja(null,this.h))}Hs.prototype.toString=function(){var n=[],e=this.j;e&&n.push(oa(e,Iy,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(oa(e,Iy,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(oa(t,t.charAt(0)=="/"?qN:$N,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",oa(t,GN)),n.join("")};function Mi(n){return new Hs(n)}function Uu(n,e,t){n.j=t?ra(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Wu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ey(n,e,t){e instanceof Ja?(n.i=e,YN(n.i,n.h)):(t||(e=oa(e,zN)),n.i=new Ja(e,n.h))}function ze(n,e,t){n.i.set(e,t)}function ih(n){return ze(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function ra(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function oa(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,HN),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function HN(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Iy=/[#\/\?@]/g,$N=/[#\?:]/g,qN=/[#\?]/g,zN=/[#\?@]/g,GN=/#/g;function Ja(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function ws(n){n.g||(n.g=new Map,n.h=0,n.i&&WN(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}U=Ja.prototype;U.add=function(n,e){ws(this),this.i=null,n=ko(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function pE(n,e){ws(n),e=ko(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function gE(n,e){return ws(n),e=ko(n,e),n.g.has(e)}U.forEach=function(n,e){ws(this),this.g.forEach(function(t,i){t.forEach(function(s){n.call(e,s,i,this)},this)},this)};U.ta=function(){ws(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const s=n[i];for(let r=0;r<s.length;r++)t.push(e[i])}return t};U.Z=function(n){ws(this);let e=[];if(typeof n=="string")gE(this,n)&&(e=e.concat(this.g.get(ko(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};U.set=function(n,e){return ws(this),this.i=null,n=ko(this,n),gE(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};U.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function yE(n,e,t){pE(n,e),0<t.length&&(n.i=null,n.g.set(ko(n,e),fm(t)),n.h+=t.length)}U.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const r=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var s=r;o[i]!==""&&(s+="="+encodeURIComponent(String(o[i]))),n.push(s)}}return this.i=n.join("&")};function ko(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function YN(n,e){e&&!n.j&&(ws(n),n.i=null,n.g.forEach(function(t,i){var s=i.toLowerCase();i!=s&&(pE(this,i),yE(this,s,t))},n)),n.j=e}var JN=class{constructor(n,e){this.g=n,this.map=e}};function _E(n){this.l=n||KN,se.PerformanceNavigationTiming?(n=se.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(se.g&&se.g.Ka&&se.g.Ka()&&se.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var KN=10;function vE(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function wE(n){return n.h?1:n.g?n.g.size:0}function jf(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Cm(n,e){n.g?n.g.add(e):n.h=e}function xE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}_E.prototype.cancel=function(){if(this.i=EE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function EE(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return fm(n.i)}var QN=class{stringify(n){return se.JSON.stringify(n,void 0)}parse(n){return se.JSON.parse(n,void 0)}};function jN(){this.g=new QN}function XN(n,e,t){const i=t||"";try{fE(n,function(s,r){let o=s;Ic(s)&&(o=wm(s)),e.push(i+r+"="+encodeURIComponent(o))})}catch(s){throw e.push(i+"type="+encodeURIComponent("_badmap")),s}}function ZN(n,e){const t=new Xl;if(se.Image){const i=new Image;i.onload=iu(ru,t,i,"TestLoadImage: loaded",!0,e),i.onerror=iu(ru,t,i,"TestLoadImage: error",!1,e),i.onabort=iu(ru,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=iu(ru,t,i,"TestLoadImage: timeout",!1,e),se.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function ru(n,e,t,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch{}}function sh(n){this.l=n.ec||null,this.j=n.ob||!1}xt(sh,Tm);sh.prototype.g=function(){return new rh(this.l,this.j)};sh.prototype.i=function(n){return function(){return n}}({});function rh(n,e){wt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=bm,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}xt(rh,wt);var bm=0;U=rh.prototype;U.open=function(n,e){if(this.readyState!=bm)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ka(this)};U.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||se).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};U.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,kc(this)),this.readyState=bm};U.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ka(this)),this.g&&(this.readyState=3,Ka(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof se.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;IE(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function IE(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}U.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?kc(this):Ka(this),this.readyState==3&&IE(this)}};U.Za=function(n){this.g&&(this.response=this.responseText=n,kc(this))};U.Ya=function(n){this.g&&(this.response=n,kc(this))};U.ka=function(){this.g&&kc(this)};function kc(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ka(n)}U.setRequestHeader=function(n,e){this.v.append(n,e)};U.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};U.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Ka(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(rh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var eM=se.JSON.parse;function tt(n){wt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=TE,this.L=this.M=!1}xt(tt,wt);var TE="",tM=/^https?$/i,nM=["POST","PUT"];U=tt.prototype;U.Oa=function(n){this.M=n};U.ha=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Yf.g(),this.C=this.u?xy(this.u):xy(Yf),this.g.onreadystatechange=Wt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(r){Ty(this,r);return}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)t.set(s,i[s]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(const r of i.keys())t.set(r,i.get(r));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(t.keys()).find(r=>r.toLowerCase()=="content-type"),s=se.FormData&&n instanceof se.FormData,!(0<=Ux(nM,e))||i||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of t)this.g.setRequestHeader(r,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{CE(this),0<this.B&&((this.L=iM(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Wt(this.ua,this)):this.A=Im(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(r){Ty(this,r)}};function iM(n){return to&&typeof n.timeout=="number"&&n.ontimeout!==void 0}U.ua=function(){typeof dm<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,St(this,"timeout"),this.abort(8))};function Ty(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,DE(n),oh(n)}function DE(n){n.F||(n.F=!0,St(n,"complete"),St(n,"error"))}U.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,St(this,"complete"),St(this,"abort"),oh(this))};U.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),oh(this,!0)),tt.$.N.call(this)};U.La=function(){this.s||(this.G||this.v||this.l?AE(this):this.kb())};U.kb=function(){AE(this)};function AE(n){if(n.h&&typeof dm<"u"&&(!n.C[1]||Yn(n)!=4||n.da()!=2)){if(n.v&&Yn(n)==4)Im(n.La,0,n);else if(St(n,"readystatechange"),Yn(n)==4){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=o===0){var s=String(n.I).match(mE)[1]||null;!s&&se.self&&se.self.location&&(s=se.self.location.protocol.slice(0,-1)),i=!tM.test(s?s.toLowerCase():"")}t=i}if(t)St(n,"complete"),St(n,"success");else{n.m=6;try{var r=2<Yn(n)?n.g.statusText:""}catch{r=""}n.j=r+" ["+n.da()+"]",DE(n)}}finally{oh(n)}}}}function oh(n,e){if(n.g){CE(n);const t=n.g,i=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||St(n,"ready");try{t.onreadystatechange=i}catch{}}}function CE(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(se.clearTimeout(n.A),n.A=null)}U.isActive=function(){return!!this.g};function Yn(n){return n.g?n.g.readyState:0}U.da=function(){try{return 2<Yn(this)?this.g.status:-1}catch{return-1}};U.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};U.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),eM(e)}};function Dy(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case TE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function sM(n){const e={};n=(n.g&&2<=Yn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let i=0;i<n.length;i++){if(Ha(n[i]))continue;var t=kN(n[i]);const s=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const r=e[s]||[];e[s]=r,r.push(t)}EN(e,function(i){return i.join(", ")})}U.Ia=function(){return this.m};U.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function bE(n){let e="";return pm(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function km(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=bE(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):ze(n,e,t))}function Xo(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function kE(n){this.Ga=0,this.j=[],this.l=new Xl,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Xo("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Xo("baseRetryDelayMs",5e3,n),this.hb=Xo("retryDelaySeedMs",1e4,n),this.eb=Xo("forwardChannelMaxRetries",2,n),this.xa=Xo("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new _E(n&&n.concurrentRequestLimit),this.Ja=new jN,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}U=kE.prototype;U.ra=8;U.H=1;function Sm(n){if(SE(n),n.H==3){var e=n.W++,t=Mi(n.I);if(ze(t,"SID",n.K),ze(t,"RID",e),ze(t,"TYPE","terminate"),Sc(n,t),e=new Cc(n,n.l,e),e.L=2,e.A=ih(Mi(t)),t=!1,se.navigator&&se.navigator.sendBeacon)try{t=se.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&se.Image&&(new Image().src=e.A,t=!0),t||(e.g=LE(e.l,null),e.g.ha(e.A)),e.G=Date.now(),bc(e)}FE(n)}function ah(n){n.g&&(Rm(n),n.g.cancel(),n.g=null)}function SE(n){ah(n),n.u&&(se.clearTimeout(n.u),n.u=null),Hu(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&se.clearTimeout(n.m),n.m=null)}function ch(n){if(!vE(n.i)&&!n.m){n.m=!0;var e=n.Na;qa||Xx(),za||(qa(),za=!0),xm.add(e,n),n.C=0}}function rM(n,e){return wE(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Dc(Wt(n.Na,n,e),OE(n,n.C)),n.C++,!0)}U.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const s=new Cc(this,this.l,n);let r=this.s;if(this.U&&(r?(r=qx(r),zx(r,this.U)):r=this.U),this.o!==null||this.O||(s.I=r,r=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var i=this.j[t];if("__data__"in i.map&&(i=i.map.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=PE(this,s,e),t=Mi(this.I),ze(t,"RID",n),ze(t,"CVER",22),this.F&&ze(t,"X-HTTP-Session-Id",this.F),Sc(this,t),r&&(this.O?e="headers="+encodeURIComponent(String(bE(r)))+"&"+e:this.o&&km(t,this.o,r)),Cm(this.i,s),this.bb&&ze(t,"TYPE","init"),this.P?(ze(t,"$req",e),ze(t,"SID","null"),s.aa=!0,Kf(s,t,null)):Kf(s,t,e),this.H=2}}else this.H==3&&(n?Ay(this,n):this.j.length==0||vE(this.i)||Ay(this))};function Ay(n,e){var t;e?t=e.m:t=n.W++;const i=Mi(n.I);ze(i,"SID",n.K),ze(i,"RID",t),ze(i,"AID",n.V),Sc(n,i),n.o&&n.s&&km(i,n.o,n.s),t=new Cc(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=PE(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Cm(n.i,t),Kf(t,i,e)}function Sc(n,e){n.na&&pm(n.na,function(t,i){ze(e,i,t)}),n.h&&fE({},function(t,i){ze(e,i,t)})}function PE(n,e,t){t=Math.min(n.j.length,t);var i=n.h?Wt(n.h.Va,n.h,n):null;e:{var s=n.j;let r=-1;for(;;){const o=["count="+t];r==-1?0<t?(r=s[0].g,o.push("ofs="+r)):r=0:o.push("ofs="+r);let a=!0;for(let c=0;c<t;c++){let u=s[c].g;const l=s[c].map;if(u-=r,0>u)r=Math.max(0,s[c].g-100),a=!1;else try{XN(l,o,"req"+u+"_")}catch{i&&i(l)}}if(a){i=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,i}function RE(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;qa||Xx(),za||(qa(),za=!0),xm.add(e,n),n.A=0}}function Pm(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Dc(Wt(n.Ma,n),OE(n,n.A)),n.A++,!0)}U.Ma=function(){if(this.u=null,NE(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Dc(Wt(this.jb,this),n)}};U.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Jt(10),ah(this),NE(this))};function Rm(n){n.B!=null&&(se.clearTimeout(n.B),n.B=null)}function NE(n){n.g=new Cc(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=Mi(n.wa);ze(e,"RID","rpc"),ze(e,"SID",n.K),ze(e,"AID",n.V),ze(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ze(e,"TO",n.qa),ze(e,"TYPE","xmlhttp"),Sc(n,e),n.o&&n.s&&km(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=ih(Mi(e)),t.u=null,t.S=!0,uE(t,n)}U.ib=function(){this.v!=null&&(this.v=null,ah(this),Pm(this),Jt(19))};function Hu(n){n.v!=null&&(se.clearTimeout(n.v),n.v=null)}function ME(n,e){var t=null;if(n.g==e){Hu(n),Rm(n),n.g=null;var i=2}else if(jf(n.i,e))t=e.F,xE(n.i,e),i=1;else return;if(n.H!=0){if(e.i)if(i==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var s=n.C;i=Zl(),St(i,new sE(i,t)),ch(n)}else RE(n);else if(s=e.s,s==3||s==0&&0<e.ca||!(i==1&&rM(n,e)||i==2&&Pm(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Fs(n,5);break;case 4:Fs(n,10);break;case 3:Fs(n,6);break;default:Fs(n,2)}}}function OE(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Fs(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var i=Wt(n.pb,n);t||(t=new Hs("//www.google.com/images/cleardot.gif"),se.location&&se.location.protocol=="http"||Uu(t,"https"),ih(t)),ZN(t.toString(),i)}else Jt(2);n.H=0,n.h&&n.h.za(e),FE(n),SE(n)}U.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Jt(2)):(this.l.info("Failed to ping google.com"),Jt(1))};function FE(n){if(n.H=0,n.ma=[],n.h){const e=EE(n.i);(e.length!=0||n.j.length!=0)&&(gy(n.ma,e),gy(n.ma,n.j),n.i.i.length=0,fm(n.j),n.j.length=0),n.h.ya()}}function BE(n,e,t){var i=t instanceof Hs?Mi(t):new Hs(t);if(i.g!="")e&&(i.g=e+"."+i.g),Wu(i,i.m);else{var s=se.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new Hs(null);i&&Uu(r,i),e&&(r.g=e),s&&Wu(r,s),t&&(r.l=t),i=r}return t=n.F,e=n.Da,t&&e&&ze(i,t,e),ze(i,"VER",n.ra),Sc(n,i),i}function LE(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new tt(new sh({ob:t})):new tt(n.va),e.Oa(n.J),e}U.isActive=function(){return!!this.h&&this.h.isActive(this)};function VE(){}U=VE.prototype;U.Ba=function(){};U.Aa=function(){};U.za=function(){};U.ya=function(){};U.isActive=function(){return!0};U.Va=function(){};function $u(){if(to&&!(10<=Number(_N)))throw Error("Environmental error: no available transport.")}$u.prototype.g=function(n,e){return new fn(n,e)};function fn(n,e){wt.call(this),this.g=new kE(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Ha(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ha(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new So(this)}xt(fn,wt);fn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Jt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=BE(n,null,n.Y),ch(n)};fn.prototype.close=function(){Sm(this.g)};fn.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=wm(n),n=t);e.j.push(new JN(e.fb++,n)),e.H==3&&ch(e)};fn.prototype.N=function(){this.g.h=null,delete this.j,Sm(this.g),delete this.g,fn.$.N.call(this)};function UE(n){Dm.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}xt(UE,Dm);function WE(){Am.call(this),this.status=1}xt(WE,Am);function So(n){this.g=n}xt(So,VE);So.prototype.Ba=function(){St(this.g,"a")};So.prototype.Aa=function(n){St(this.g,new UE(n))};So.prototype.za=function(n){St(this.g,new WE)};So.prototype.ya=function(){St(this.g,"b")};function oM(){this.blockSize=-1}function Un(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}xt(Un,oM);Un.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function md(n,e,t){t||(t=0);var i=Array(16);if(typeof e=="string")for(var s=0;16>s;++s)i[s]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(s=0;16>s;++s)i[s]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],s=n.g[2];var r=n.g[3],o=e+(r^t&(s^r))+i[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=r+(s^e&(t^s))+i[1]+3905402710&4294967295,r=e+(o<<12&4294967295|o>>>20),o=s+(t^r&(e^t))+i[2]+606105819&4294967295,s=r+(o<<17&4294967295|o>>>15),o=t+(e^s&(r^e))+i[3]+3250441966&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(r^t&(s^r))+i[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=r+(s^e&(t^s))+i[5]+1200080426&4294967295,r=e+(o<<12&4294967295|o>>>20),o=s+(t^r&(e^t))+i[6]+2821735955&4294967295,s=r+(o<<17&4294967295|o>>>15),o=t+(e^s&(r^e))+i[7]+4249261313&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(r^t&(s^r))+i[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=r+(s^e&(t^s))+i[9]+2336552879&4294967295,r=e+(o<<12&4294967295|o>>>20),o=s+(t^r&(e^t))+i[10]+4294925233&4294967295,s=r+(o<<17&4294967295|o>>>15),o=t+(e^s&(r^e))+i[11]+2304563134&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(r^t&(s^r))+i[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=r+(s^e&(t^s))+i[13]+4254626195&4294967295,r=e+(o<<12&4294967295|o>>>20),o=s+(t^r&(e^t))+i[14]+2792965006&4294967295,s=r+(o<<17&4294967295|o>>>15),o=t+(e^s&(r^e))+i[15]+1236535329&4294967295,t=s+(o<<22&4294967295|o>>>10),o=e+(s^r&(t^s))+i[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=r+(t^s&(e^t))+i[6]+3225465664&4294967295,r=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(r^e))+i[11]+643717713&4294967295,s=r+(o<<14&4294967295|o>>>18),o=t+(r^e&(s^r))+i[0]+3921069994&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(s^r&(t^s))+i[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=r+(t^s&(e^t))+i[10]+38016083&4294967295,r=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(r^e))+i[15]+3634488961&4294967295,s=r+(o<<14&4294967295|o>>>18),o=t+(r^e&(s^r))+i[4]+3889429448&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(s^r&(t^s))+i[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=r+(t^s&(e^t))+i[14]+3275163606&4294967295,r=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(r^e))+i[3]+4107603335&4294967295,s=r+(o<<14&4294967295|o>>>18),o=t+(r^e&(s^r))+i[8]+1163531501&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(s^r&(t^s))+i[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=r+(t^s&(e^t))+i[2]+4243563512&4294967295,r=e+(o<<9&4294967295|o>>>23),o=s+(e^t&(r^e))+i[7]+1735328473&4294967295,s=r+(o<<14&4294967295|o>>>18),o=t+(r^e&(s^r))+i[12]+2368359562&4294967295,t=s+(o<<20&4294967295|o>>>12),o=e+(t^s^r)+i[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=r+(e^t^s)+i[8]+2272392833&4294967295,r=e+(o<<11&4294967295|o>>>21),o=s+(r^e^t)+i[11]+1839030562&4294967295,s=r+(o<<16&4294967295|o>>>16),o=t+(s^r^e)+i[14]+4259657740&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(t^s^r)+i[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=r+(e^t^s)+i[4]+1272893353&4294967295,r=e+(o<<11&4294967295|o>>>21),o=s+(r^e^t)+i[7]+4139469664&4294967295,s=r+(o<<16&4294967295|o>>>16),o=t+(s^r^e)+i[10]+3200236656&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(t^s^r)+i[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=r+(e^t^s)+i[0]+3936430074&4294967295,r=e+(o<<11&4294967295|o>>>21),o=s+(r^e^t)+i[3]+3572445317&4294967295,s=r+(o<<16&4294967295|o>>>16),o=t+(s^r^e)+i[6]+76029189&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(t^s^r)+i[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=r+(e^t^s)+i[12]+3873151461&4294967295,r=e+(o<<11&4294967295|o>>>21),o=s+(r^e^t)+i[15]+530742520&4294967295,s=r+(o<<16&4294967295|o>>>16),o=t+(s^r^e)+i[2]+3299628645&4294967295,t=s+(o<<23&4294967295|o>>>9),o=e+(s^(t|~r))+i[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=r+(t^(e|~s))+i[7]+1126891415&4294967295,r=e+(o<<10&4294967295|o>>>22),o=s+(e^(r|~t))+i[14]+2878612391&4294967295,s=r+(o<<15&4294967295|o>>>17),o=t+(r^(s|~e))+i[5]+4237533241&4294967295,t=s+(o<<21&4294967295|o>>>11),o=e+(s^(t|~r))+i[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=r+(t^(e|~s))+i[3]+2399980690&4294967295,r=e+(o<<10&4294967295|o>>>22),o=s+(e^(r|~t))+i[10]+4293915773&4294967295,s=r+(o<<15&4294967295|o>>>17),o=t+(r^(s|~e))+i[1]+2240044497&4294967295,t=s+(o<<21&4294967295|o>>>11),o=e+(s^(t|~r))+i[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=r+(t^(e|~s))+i[15]+4264355552&4294967295,r=e+(o<<10&4294967295|o>>>22),o=s+(e^(r|~t))+i[6]+2734768916&4294967295,s=r+(o<<15&4294967295|o>>>17),o=t+(r^(s|~e))+i[13]+1309151649&4294967295,t=s+(o<<21&4294967295|o>>>11),o=e+(s^(t|~r))+i[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=r+(t^(e|~s))+i[11]+3174756917&4294967295,r=e+(o<<10&4294967295|o>>>22),o=s+(e^(r|~t))+i[2]+718787259&4294967295,s=r+(o<<15&4294967295|o>>>17),o=t+(r^(s|~e))+i[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+s&4294967295,n.g[3]=n.g[3]+r&4294967295}Un.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,i=this.m,s=this.h,r=0;r<e;){if(s==0)for(;r<=t;)md(this,n,r),r+=this.blockSize;if(typeof n=="string"){for(;r<e;)if(i[s++]=n.charCodeAt(r++),s==this.blockSize){md(this,i),s=0;break}}else for(;r<e;)if(i[s++]=n[r++],s==this.blockSize){md(this,i),s=0;break}}this.h=s,this.i+=e};Un.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var i=0;32>i;i+=8)n[t++]=this.g[e]>>>i&255;return n};function Re(n,e){this.h=e;for(var t=[],i=!0,s=n.length-1;0<=s;s--){var r=n[s]|0;i&&r==e||(t[s]=r,i=!1)}this.g=t}var aM={};function Nm(n){return-128<=n&&128>n?pN(n,function(e){return new Re([e|0],0>e?-1:0)}):new Re([n|0],0>n?-1:0)}function Jn(n){if(isNaN(n)||!isFinite(n))return Vr;if(0>n)return Dt(Jn(-n));for(var e=[],t=1,i=0;n>=t;i++)e[i]=n/t|0,t*=Xf;return new Re(e,0)}function HE(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Dt(HE(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Jn(Math.pow(e,8)),i=Vr,s=0;s<n.length;s+=8){var r=Math.min(8,n.length-s),o=parseInt(n.substring(s,s+r),e);8>r?(r=Jn(Math.pow(e,r)),i=i.R(r).add(Jn(o))):(i=i.R(t),i=i.add(Jn(o)))}return i}var Xf=4294967296,Vr=Nm(0),Zf=Nm(1),Cy=Nm(16777216);U=Re.prototype;U.ea=function(){if(wn(this))return-Dt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var i=this.D(t);n+=(0<=i?i:Xf+i)*e,e*=Xf}return n};U.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(vi(this))return"0";if(wn(this))return"-"+Dt(this).toString(n);for(var e=Jn(Math.pow(n,6)),t=this,i="";;){var s=zu(t,e).g;t=qu(t,s.R(e));var r=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=s,vi(t))return r+i;for(;6>r.length;)r="0"+r;i=r+i}};U.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function vi(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function wn(n){return n.h==-1}U.X=function(n){return n=qu(this,n),wn(n)?-1:vi(n)?0:1};function Dt(n){for(var e=n.g.length,t=[],i=0;i<e;i++)t[i]=~n.g[i];return new Re(t,~n.h).add(Zf)}U.abs=function(){return wn(this)?Dt(this):this};U.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0,s=0;s<=e;s++){var r=i+(this.D(s)&65535)+(n.D(s)&65535),o=(r>>>16)+(this.D(s)>>>16)+(n.D(s)>>>16);i=o>>>16,r&=65535,o&=65535,t[s]=o<<16|r}return new Re(t,t[t.length-1]&-2147483648?-1:0)};function qu(n,e){return n.add(Dt(e))}U.R=function(n){if(vi(this)||vi(n))return Vr;if(wn(this))return wn(n)?Dt(this).R(Dt(n)):Dt(Dt(this).R(n));if(wn(n))return Dt(this.R(Dt(n)));if(0>this.X(Cy)&&0>n.X(Cy))return Jn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],i=0;i<2*e;i++)t[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<n.g.length;s++){var r=this.D(i)>>>16,o=this.D(i)&65535,a=n.D(s)>>>16,c=n.D(s)&65535;t[2*i+2*s]+=o*c,ou(t,2*i+2*s),t[2*i+2*s+1]+=r*c,ou(t,2*i+2*s+1),t[2*i+2*s+1]+=o*a,ou(t,2*i+2*s+1),t[2*i+2*s+2]+=r*a,ou(t,2*i+2*s+2)}for(i=0;i<e;i++)t[i]=t[2*i+1]<<16|t[2*i];for(i=e;i<2*e;i++)t[i]=0;return new Re(t,0)};function ou(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Zo(n,e){this.g=n,this.h=e}function zu(n,e){if(vi(e))throw Error("division by zero");if(vi(n))return new Zo(Vr,Vr);if(wn(n))return e=zu(Dt(n),e),new Zo(Dt(e.g),Dt(e.h));if(wn(e))return e=zu(n,Dt(e)),new Zo(Dt(e.g),e.h);if(30<n.g.length){if(wn(n)||wn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Zf,i=e;0>=i.X(n);)t=by(t),i=by(i);var s=Ir(t,1),r=Ir(i,1);for(i=Ir(i,2),t=Ir(t,2);!vi(i);){var o=r.add(i);0>=o.X(n)&&(s=s.add(t),r=o),i=Ir(i,1),t=Ir(t,1)}return e=qu(n,s.R(e)),new Zo(s,e)}for(s=Vr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),i=Math.ceil(Math.log(t)/Math.LN2),i=48>=i?1:Math.pow(2,i-48),r=Jn(t),o=r.R(e);wn(o)||0<o.X(n);)t-=i,r=Jn(t),o=r.R(e);vi(r)&&(r=Zf),s=s.add(r),n=qu(n,o)}return new Zo(s,n)}U.gb=function(n){return zu(this,n).h};U.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)&n.D(i);return new Re(t,this.h&n.h)};U.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)|n.D(i);return new Re(t,this.h|n.h)};U.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)^n.D(i);return new Re(t,this.h^n.h)};function by(n){for(var e=n.g.length+1,t=[],i=0;i<e;i++)t[i]=n.D(i)<<1|n.D(i-1)>>>31;return new Re(t,n.h)}function Ir(n,e){var t=e>>5;e%=32;for(var i=n.g.length-t,s=[],r=0;r<i;r++)s[r]=0<e?n.D(r+t)>>>e|n.D(r+t+1)<<32-e:n.D(r+t);return new Re(s,n.h)}$u.prototype.createWebChannel=$u.prototype.g;fn.prototype.send=fn.prototype.u;fn.prototype.open=fn.prototype.m;fn.prototype.close=fn.prototype.close;eh.NO_ERROR=0;eh.TIMEOUT=8;eh.HTTP_ERROR=6;rE.COMPLETE="complete";oE.EventType=Ac;Ac.OPEN="a";Ac.CLOSE="b";Ac.ERROR="c";Ac.MESSAGE="d";wt.prototype.listen=wt.prototype.O;tt.prototype.listenOnce=tt.prototype.P;tt.prototype.getLastError=tt.prototype.Sa;tt.prototype.getLastErrorCode=tt.prototype.Ia;tt.prototype.getStatus=tt.prototype.da;tt.prototype.getResponseJson=tt.prototype.Wa;tt.prototype.getResponseText=tt.prototype.ja;tt.prototype.send=tt.prototype.ha;tt.prototype.setWithCredentials=tt.prototype.Oa;Un.prototype.digest=Un.prototype.l;Un.prototype.reset=Un.prototype.reset;Un.prototype.update=Un.prototype.j;Re.prototype.add=Re.prototype.add;Re.prototype.multiply=Re.prototype.R;Re.prototype.modulo=Re.prototype.gb;Re.prototype.compare=Re.prototype.X;Re.prototype.toNumber=Re.prototype.ea;Re.prototype.toString=Re.prototype.toString;Re.prototype.getBits=Re.prototype.D;Re.fromNumber=Jn;Re.fromString=HE;var cM=function(){return new $u},uM=function(){return Zl()},pd=eh,lM=rE,hM=ur,ky={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},au=oE,dM=tt,fM=Un,Ur=Re;const Sy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ft.UNAUTHENTICATED=new Ft(null),Ft.GOOGLE_CREDENTIALS=new Ft("google-credentials-uid"),Ft.FIRST_PARTY=new Ft("first-party-uid"),Ft.MOCK_USER=new Ft("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Po="10.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs=new Sl("@firebase/firestore");function ea(){return Qs.logLevel}function q(n,...e){if(Qs.logLevel<=ge.DEBUG){const t=e.map(Mm);Qs.debug(`Firestore (${Po}): ${n}`,...t)}}function Oi(n,...e){if(Qs.logLevel<=ge.ERROR){const t=e.map(Mm);Qs.error(`Firestore (${Po}): ${n}`,...t)}}function no(n,...e){if(Qs.logLevel<=ge.WARN){const t=e.map(Mm);Qs.warn(`Firestore (${Po}): ${n}`,...t)}}function Mm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(n="Unexpected state"){const e=`FIRESTORE (${Po}) INTERNAL ASSERTION FAILED: `+n;throw Oi(e),new Error(e)}function ke(n,e){n||ee()}function re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends Ui{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class mM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ft.UNAUTHENTICATED))}shutdown(){}}class pM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class gM{constructor(e){this.t=e,this.currentUser=Ft.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let r=new Qn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Qn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=r;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Qn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ke(typeof i.accessToken=="string"),new $E(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ke(e===null||typeof e=="string"),new Ft(e)}}class yM{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Ft.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class _M{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new yM(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ft.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vM{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class wM{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const i=r=>{r.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.R;return this.R=r.token,q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>i(r))};const s=r=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.appCheck.addTokenListener(this.o)};this.A.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){const r=this.A.getImmediate({optional:!0});r?s(r):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ke(typeof t.token=="string"),this.R=t.token,new vM(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xM(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const s=xM(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<t&&(i+=e.charAt(s[r]%e.length))}return i}}function be(n,e){return n<e?-1:n>e?1:0}function io(n,e,t){return n.length===e.length&&n.every((i,s)=>t(i,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new z(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Le.fromMillis(Date.now())}static fromDate(e){return Le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new Le(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?be(this.nanoseconds,e.nanoseconds):be(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ne(e)}static min(){return new ne(new Le(0,0))}static max(){return new ne(new Le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,t,i){t===void 0?t=0:t>e.length&&ee(),i===void 0?i=e.length-t:i>e.length-t&&ee(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Qa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qa?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const r=e.get(s),o=t.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Qe extends Qa{construct(e,t,i){return new Qe(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new z(S.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(s=>s.length>0))}return new Qe(t)}static emptyPath(){return new Qe([])}}const EM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ct extends Qa{construct(e,t,i){return new Ct(e,t,i)}static isValidIdentifier(e){return EM.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ct.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ct(["__name__"])}static fromServerFormat(e){const t=[];let i="",s=0;const r=()=>{if(i.length===0)throw new z(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new z(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new z(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(i+=a,s++):(r(),s++)}if(r(),o)throw new z(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ct(t)}static emptyPath(){return new Ct([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X{constructor(e){this.path=e}static fromPath(e){return new X(Qe.fromString(e))}static fromName(e){return new X(Qe.fromString(e).popFirst(5))}static empty(){return new X(Qe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Qe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Qe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new X(new Qe(e.slice()))}}function IM(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=ne.fromTimestamp(i===1e9?new Le(t+1,0):new Le(t,i));return new ds(s,X.empty(),e)}function TM(n){return new ds(n.readTime,n.key,-1)}class ds{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new ds(ne.min(),X.empty(),-1)}static max(){return new ds(ne.max(),X.empty(),-1)}}function DM(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=X.comparator(n.documentKey,e.documentKey),t!==0?t:be(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class CM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pc(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==AM)throw n;q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ee(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(i,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,i)=>{t(e)})}static reject(e){return new M((t,i)=>{i(e)})}static waitFor(e){return new M((t,i)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&t()},c=>i(c))}),o=!0,r===s&&t()})}static or(e){let t=M.resolve(!1);for(const i of e)t=t.next(s=>s?M.resolve(s):i());return t}static forEach(e,t){const i=[];return e.forEach((s,r)=>{i.push(t.call(this,s,r))}),this.waitFor(i)}static mapArray(e,t){return new M((i,s)=>{const r=e.length,o=new Array(r);let a=0;for(let c=0;c<r;c++){const u=c;t(e[u]).next(l=>{o[u]=l,++a,a===r&&i(o)},l=>s(l))}})}static doWhile(e,t){return new M((i,s)=>{const r=()=>{e()===!0?t().next(()=>{r()},s):i()};r()})}}function Rc(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.se(i),this.oe=i=>t.writeSequenceNumber(i))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}Om._e=-1;function Nc(n){return n==null}function Gu(n){return n===0&&1/n==-1/0}function bM(n){return typeof n=="number"&&Number.isInteger(n)&&!Gu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Py(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function lr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function zE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ot=class e0{constructor(e,t){this.comparator=e,this.root=t||os.EMPTY}insert(e,t){return new e0(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,os.BLACK,null,null))}remove(e){return new e0(this.comparator,this.root.remove(e,this.comparator).copy(null,null,os.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cu(this.root,e,this.comparator,!1)}getReverseIterator(){return new cu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cu(this.root,e,this.comparator,!0)}},cu=class{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?i(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},os=class li{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i??li.RED,this.left=s??li.EMPTY,this.right=r??li.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,r){return new li(e??this.key,t??this.value,i??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return li.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return li.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,li.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,li.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ee();const e=this.left.check();if(e!==this.right.check())throw ee();return e+(this.isRed()?0:1)}};os.EMPTY=null,os.RED=!0,os.BLACK=!1;os.EMPTY=new class{constructor(){this.size=0}get key(){throw ee()}get value(){throw ee()}get color(){throw ee()}get left(){throw ee()}get right(){throw ee()}copy(e,t,i,s,r){return this}insert(e,t,i){return new os(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this.comparator=e,this.data=new ot(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ry(this.data.getIterator())}getIteratorFrom(e){return new Ry(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Pt)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Pt(this.comparator);return t.data=e,t}}class Ry{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.fields=e,e.sort(Ct.comparator)}static empty(){return new ln([])}unionWith(e){let t=new Pt(Ct.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new ln(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return io(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new GE("Invalid base64 string: "+r):r}}(e);return new qt(t)}static fromUint8Array(e){const t=function(s){let r="";for(let o=0;o<s.length;++o)r+=String.fromCharCode(s[o]);return r}(e);return new qt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return be(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qt.EMPTY_BYTE_STRING=new qt("");const kM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fs(n){if(ke(!!n),typeof n=="string"){let e=0;const t=kM.exec(n);if(ke(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:rt(n.seconds),nanos:rt(n.nanos)}}function rt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function js(n){return typeof n=="string"?qt.fromBase64String(n):qt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fm(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Bm(n){const e=n.mapValue.fields.__previous_value__;return Fm(e)?Bm(e):e}function ja(n){const e=fs(n.mapValue.fields.__local_write_time__.timestampValue);return new Le(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SM{constructor(e,t,i,s,r,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}}class Xa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Xa("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Xa&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Xs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Fm(n)?4:PM(n)?9007199254740991:10:ee()}function ni(n,e){if(n===e)return!0;const t=Xs(n);if(t!==Xs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ja(n).isEqual(ja(e));case 3:return function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const o=fs(s.timestampValue),a=fs(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,r){return js(s.bytesValue).isEqual(js(r.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,r){return rt(s.geoPointValue.latitude)===rt(r.geoPointValue.latitude)&&rt(s.geoPointValue.longitude)===rt(r.geoPointValue.longitude)}(n,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return rt(s.integerValue)===rt(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const o=rt(s.doubleValue),a=rt(r.doubleValue);return o===a?Gu(o)===Gu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return io(n.arrayValue.values||[],e.arrayValue.values||[],ni);case 10:return function(s,r){const o=s.mapValue.fields||{},a=r.mapValue.fields||{};if(Py(o)!==Py(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!ni(o[c],a[c])))return!1;return!0}(n,e);default:return ee()}}function Za(n,e){return(n.values||[]).find(t=>ni(t,e))!==void 0}function so(n,e){if(n===e)return 0;const t=Xs(n),i=Xs(e);if(t!==i)return be(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return be(n.booleanValue,e.booleanValue);case 2:return function(r,o){const a=rt(r.integerValue||r.doubleValue),c=rt(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return Ny(n.timestampValue,e.timestampValue);case 4:return Ny(ja(n),ja(e));case 5:return be(n.stringValue,e.stringValue);case 6:return function(r,o){const a=js(r),c=js(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(r,o){const a=r.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){const l=be(a[u],c[u]);if(l!==0)return l}return be(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,o){const a=be(rt(r.latitude),rt(o.latitude));return a!==0?a:be(rt(r.longitude),rt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,o){const a=r.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){const l=so(a[u],c[u]);if(l)return l}return be(a.length,c.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,o){if(r===uu.mapValue&&o===uu.mapValue)return 0;if(r===uu.mapValue)return 1;if(o===uu.mapValue)return-1;const a=r.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){const f=be(c[h],l[h]);if(f!==0)return f;const m=so(a[c[h]],u[l[h]]);if(m!==0)return m}return be(c.length,l.length)}(n.mapValue,e.mapValue);default:throw ee()}}function Ny(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return be(n,e);const t=fs(n),i=fs(e),s=be(t.seconds,i.seconds);return s!==0?s:be(t.nanos,i.nanos)}function ro(n){return t0(n)}function t0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=fs(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return js(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return X.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",s=!0;for(const r of t.values||[])s?s=!1:i+=",",i+=t0(r);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let s="{",r=!0;for(const o of i)r?r=!1:s+=",",s+=`${o}:${t0(t.fields[o])}`;return s+"}"}(n.mapValue):ee()}function n0(n){return!!n&&"integerValue"in n}function Lm(n){return!!n&&"arrayValue"in n}function My(n){return!!n&&"nullValue"in n}function Oy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function wu(n){return!!n&&"mapValue"in n}function ga(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return lr(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=ga(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ga(n.arrayValue.values[t]);return e}return Object.assign({},n)}function PM(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.value=e}static empty(){return new Yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!wu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ga(t)}setAll(e){let t=Ct.emptyPath(),i={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,s),i={},s=[],t=a.popLast()}o?i[a.lastSegment()]=ga(o):s.push(a.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,i,s)}delete(e){const t=this.field(e.popLast());wu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ni(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];wu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){lr(t,(s,r)=>e[s]=r);for(const s of i)delete e[s]}clone(){return new Yt(ga(this.value))}}function YE(n){const e=[];return lr(n.fields,(t,i)=>{const s=new Ct([t]);if(wu(i)){const r=YE(i.mapValue).fields;if(r.length===0)e.push(s);else for(const o of r)e.push(s.child(o))}else e.push(s)}),new ln(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,t,i,s,r,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new yt(e,0,ne.min(),ne.min(),ne.min(),Yt.empty(),0)}static newFoundDocument(e,t,i,s){return new yt(e,1,t,ne.min(),i,s,0)}static newNoDocument(e,t){return new yt(e,2,t,ne.min(),ne.min(),Yt.empty(),0)}static newUnknownDocument(e,t){return new yt(e,3,t,ne.min(),ne.min(),Yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ne.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ne.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof yt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e,t){this.position=e,this.inclusive=t}}function Fy(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const r=e[s],o=n.position[s];if(r.field.isKeyField()?i=X.comparator(X.fromName(o.referenceValue),t.key):i=so(o,t.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function By(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ni(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e,t="asc"){this.field=e,this.dir=t}}function RM(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{}class lt extends JE{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new MM(e,t,i):t==="array-contains"?new BM(e,i):t==="in"?new LM(e,i):t==="not-in"?new VM(e,i):t==="array-contains-any"?new UM(e,i):new lt(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new OM(e,i):new FM(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(so(t,this.value)):t!==null&&Xs(this.value)===Xs(t)&&this.matchesComparison(so(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ee()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ii extends JE{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new ii(e,t)}matches(e){return KE(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function KE(n){return n.op==="and"}function QE(n){return NM(n)&&KE(n)}function NM(n){for(const e of n.filters)if(e instanceof ii)return!1;return!0}function i0(n){if(n instanceof lt)return n.field.canonicalString()+n.op.toString()+ro(n.value);if(QE(n))return n.filters.map(e=>i0(e)).join(",");{const e=n.filters.map(t=>i0(t)).join(",");return`${n.op}(${e})`}}function jE(n,e){return n instanceof lt?function(i,s){return s instanceof lt&&i.op===s.op&&i.field.isEqual(s.field)&&ni(i.value,s.value)}(n,e):n instanceof ii?function(i,s){return s instanceof ii&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce((r,o,a)=>r&&jE(o,s.filters[a]),!0):!1}(n,e):void ee()}function XE(n){return n instanceof lt?function(t){return`${t.field.canonicalString()} ${t.op} ${ro(t.value)}`}(n):n instanceof ii?function(t){return t.op.toString()+" {"+t.getFilters().map(XE).join(" ,")+"}"}(n):"Filter"}class MM extends lt{constructor(e,t,i){super(e,t,i),this.key=X.fromName(i.referenceValue)}matches(e){const t=X.comparator(e.key,this.key);return this.matchesComparison(t)}}class OM extends lt{constructor(e,t){super(e,"in",t),this.keys=ZE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class FM extends lt{constructor(e,t){super(e,"not-in",t),this.keys=ZE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ZE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>X.fromName(i.referenceValue))}class BM extends lt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Lm(t)&&Za(t.arrayValue,this.value)}}class LM extends lt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Za(this.value.arrayValue,t)}}class VM extends lt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Za(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Za(this.value.arrayValue,t)}}class UM extends lt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Lm(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Za(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WM{constructor(e,t=null,i=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ce=null}}function Ly(n,e=null,t=[],i=[],s=null,r=null,o=null){return new WM(n,e,t,i,s,r,o)}function Vm(n){const e=re(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>i0(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(r){return r.field.canonicalString()+r.dir}(i)).join(","),Nc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>ro(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>ro(i)).join(",")),e.ce=t}return e.ce}function Um(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!RM(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!jE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!By(n.startAt,e.startAt)&&By(n.endAt,e.endAt)}function s0(n){return X.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,t=null,i=[],s=[],r=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function HM(n,e,t,i,s,r,o,a){return new uh(n,e,t,i,s,r,o,a)}function lh(n){return new uh(n)}function Vy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function $M(n){return n.collectionGroup!==null}function ya(n){const e=re(n);if(e.le===null){e.le=[];const t=new Set;for(const r of e.explicitOrderBy)e.le.push(r),t.add(r.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Pt(Ct.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new Ju(r,i))}),t.has(Ct.keyField().canonicalString())||e.le.push(new Ju(Ct.keyField(),i))}return e.le}function jn(n){const e=re(n);return e.he||(e.he=qM(e,ya(n))),e.he}function qM(n,e){if(n.limitType==="F")return Ly(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const r=s.dir==="desc"?"asc":"desc";return new Ju(s.field,r)});const t=n.endAt?new Yu(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Yu(n.startAt.position,n.startAt.inclusive):null;return Ly(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function r0(n,e,t){return new uh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function hh(n,e){return Um(jn(n),jn(e))&&n.limitType===e.limitType}function eI(n){return`${Vm(jn(n))}|lt:${n.limitType}`}function Cr(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(s=>XE(s)).join(", ")}]`),Nc(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(s=>ro(s)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(s=>ro(s)).join(",")),`Target(${i})`}(jn(n))}; limitType=${n.limitType})`}function dh(n,e){return e.isFoundDocument()&&function(i,s){const r=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(r):X.isDocumentKey(i.path)?i.path.isEqual(r):i.path.isImmediateParentOf(r)}(n,e)&&function(i,s){for(const r of ya(i))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0}(n,e)&&function(i,s){for(const r of i.filters)if(!r.matches(s))return!1;return!0}(n,e)&&function(i,s){return!(i.startAt&&!function(o,a,c){const u=Fy(o,a,c);return o.inclusive?u<=0:u<0}(i.startAt,ya(i),s)||i.endAt&&!function(o,a,c){const u=Fy(o,a,c);return o.inclusive?u>=0:u>0}(i.endAt,ya(i),s))}(n,e)}function zM(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function tI(n){return(e,t)=>{let i=!1;for(const s of ya(n)){const r=GM(s,e,t);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function GM(n,e,t){const i=n.field.isKeyField()?X.comparator(e.key,t.key):function(r,o,a){const c=o.data.field(r),u=a.data.field(r);return c!==null&&u!==null?so(c,u):ee()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return ee()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){lr(this.inner,(t,i)=>{for(const[s,r]of i)e(s,r)})}isEmpty(){return zE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YM=new ot(X.comparator);function Fi(){return YM}const nI=new ot(X.comparator);function aa(...n){let e=nI;for(const t of n)e=e.insert(t.key,t);return e}function iI(n){let e=nI;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Bs(){return _a()}function sI(){return _a()}function _a(){return new Ro(n=>n.toString(),(n,e)=>n.isEqual(e))}const JM=new ot(X.comparator),KM=new Pt(X.comparator);function ye(...n){let e=KM;for(const t of n)e=e.add(t);return e}const QM=new Pt(be);function jM(){return QM}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gu(e)?"-0":e}}function oI(n){return{integerValue:""+n}}function aI(n,e){return bM(e)?oI(e):rI(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(){this._=void 0}}function XM(n,e,t){return n instanceof Ku?function(s,r){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&Fm(r)&&(r=Bm(r)),r&&(o.fields.__previous_value__=r),{mapValue:o}}(t,e):n instanceof oo?uI(n,e):n instanceof ao?lI(n,e):function(s,r){const o=cI(s,r),a=Uy(o)+Uy(s.Ie);return n0(o)&&n0(s.Ie)?oI(a):rI(s.serializer,a)}(n,e)}function ZM(n,e,t){return n instanceof oo?uI(n,e):n instanceof ao?lI(n,e):t}function cI(n,e){return n instanceof ec?function(i){return n0(i)||function(r){return!!r&&"doubleValue"in r}(i)}(e)?e:{integerValue:0}:null}class Ku extends fh{}class oo extends fh{constructor(e){super(),this.elements=e}}function uI(n,e){const t=hI(e);for(const i of n.elements)t.some(s=>ni(s,i))||t.push(i);return{arrayValue:{values:t}}}class ao extends fh{constructor(e){super(),this.elements=e}}function lI(n,e){let t=hI(e);for(const i of n.elements)t=t.filter(s=>!ni(s,i));return{arrayValue:{values:t}}}class ec extends fh{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Uy(n){return rt(n.integerValue||n.doubleValue)}function hI(n){return Lm(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e,t){this.field=e,this.transform=t}}function e4(n,e){return n.field.isEqual(e.field)&&function(i,s){return i instanceof oo&&s instanceof oo||i instanceof ao&&s instanceof ao?io(i.elements,s.elements,ni):i instanceof ec&&s instanceof ec?ni(i.Ie,s.Ie):i instanceof Ku&&s instanceof Ku}(n.transform,e.transform)}class t4{constructor(e,t){this.version=e,this.transformResults=t}}class Lt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Lt}static exists(e){return new Lt(void 0,e)}static updateTime(e){return new Lt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class mh{}function dI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ph(n.key,Lt.none()):new Mc(n.key,n.data,Lt.none());{const t=n.data,i=Yt.empty();let s=new Pt(Ct.comparator);for(let r of e.fields)if(!s.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?i.delete(r):i.set(r,o),s=s.add(r)}return new xs(n.key,i,new ln(s.toArray()),Lt.none())}}function n4(n,e,t){n instanceof Mc?function(s,r,o){const a=s.value.clone(),c=Hy(s.fieldTransforms,r,o.transformResults);a.setAll(c),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof xs?function(s,r,o){if(!xu(s.precondition,r))return void r.convertToUnknownDocument(o.version);const a=Hy(s.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(fI(s)),c.setAll(a),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(s,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function va(n,e,t,i){return n instanceof Mc?function(r,o,a,c){if(!xu(r.precondition,o))return a;const u=r.value.clone(),l=$y(r.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof xs?function(r,o,a,c){if(!xu(r.precondition,o))return a;const u=$y(r.fieldTransforms,c,o),l=o.data;return l.setAll(fI(r)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(h=>h.field))}(n,e,t,i):function(r,o,a){return xu(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function i4(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),r=cI(i.transform,s||null);r!=null&&(t===null&&(t=Yt.empty()),t.set(i.field,r))}return t||null}function Wy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&io(i,s,(r,o)=>e4(r,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Mc extends mh{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class xs extends mh{constructor(e,t,i,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function fI(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function Hy(n,e,t){const i=new Map;ke(n.length===t.length);for(let s=0;s<t.length;s++){const r=n[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,ZM(o,a,t[s]))}return i}function $y(n,e,t){const i=new Map;for(const s of n){const r=s.transform,o=t.data.field(s.field);i.set(s.field,XM(r,o,e))}return i}class ph extends mh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class mI extends mh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(e.key)&&n4(r,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=va(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=va(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=sI();return this.mutations.forEach(s=>{const r=e.get(s.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=t.has(s.key)?null:a;const c=dI(o,a);c!==null&&i.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(ne.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ye())}isEqual(e){return this.batchId===e.batchId&&io(this.mutations,e.mutations,(t,i)=>Wy(t,i))&&io(this.baseMutations,e.baseMutations,(t,i)=>Wy(t,i))}}class Hm{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){ke(e.mutations.length===i.length);let s=function(){return JM}();const r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,i[o].version);return new Hm(e,t,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var it,xe;function pI(n){switch(n){default:return ee();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function gI(n){if(n===void 0)return Oi("GRPC error has no .code"),S.UNKNOWN;switch(n){case it.OK:return S.OK;case it.CANCELLED:return S.CANCELLED;case it.UNKNOWN:return S.UNKNOWN;case it.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case it.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case it.INTERNAL:return S.INTERNAL;case it.UNAVAILABLE:return S.UNAVAILABLE;case it.UNAUTHENTICATED:return S.UNAUTHENTICATED;case it.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case it.NOT_FOUND:return S.NOT_FOUND;case it.ALREADY_EXISTS:return S.ALREADY_EXISTS;case it.PERMISSION_DENIED:return S.PERMISSION_DENIED;case it.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case it.ABORTED:return S.ABORTED;case it.OUT_OF_RANGE:return S.OUT_OF_RANGE;case it.UNIMPLEMENTED:return S.UNIMPLEMENTED;case it.DATA_LOSS:return S.DATA_LOSS;default:return ee()}}(xe=it||(it={}))[xe.OK=0]="OK",xe[xe.CANCELLED=1]="CANCELLED",xe[xe.UNKNOWN=2]="UNKNOWN",xe[xe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xe[xe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xe[xe.NOT_FOUND=5]="NOT_FOUND",xe[xe.ALREADY_EXISTS=6]="ALREADY_EXISTS",xe[xe.PERMISSION_DENIED=7]="PERMISSION_DENIED",xe[xe.UNAUTHENTICATED=16]="UNAUTHENTICATED",xe[xe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xe[xe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xe[xe.ABORTED=10]="ABORTED",xe[xe.OUT_OF_RANGE=11]="OUT_OF_RANGE",xe[xe.UNIMPLEMENTED=12]="UNIMPLEMENTED",xe[xe.INTERNAL=13]="INTERNAL",xe[xe.UNAVAILABLE=14]="UNAVAILABLE",xe[xe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a4(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c4=new Ur([4294967295,4294967295],0);function qy(n){const e=a4().encode(n),t=new fM;return t.update(e),new Uint8Array(t.digest())}function zy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new Ur([t,i],0),new Ur([s,r],0)]}class $m{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new ca(`Invalid padding: ${t}`);if(i<0)throw new ca(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new ca(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new ca(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Ur.fromNumber(this.Te)}de(e,t,i){let s=e.add(t.multiply(Ur.fromNumber(i)));return s.compare(c4)===1&&(s=new Ur([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=qy(e),[i,s]=zy(t);for(let r=0;r<this.hashCount;r++){const o=this.de(i,s,r);if(!this.Ae(o))return!1}return!0}static create(e,t,i){const s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new $m(r,s,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const t=qy(e),[i,s]=zy(t);for(let r=0;r<this.hashCount;r++){const o=this.de(i,s,r);this.Re(o)}}Re(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class ca extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e,t,i,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const s=new Map;return s.set(e,Oc.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new gh(ne.min(),s,new ot(be),Fi(),ye())}}class Oc{constructor(e,t,i,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Oc(i,t,ye(),ye(),ye())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e,t,i,s){this.Ve=e,this.removedTargetIds=t,this.key=i,this.me=s}}class yI{constructor(e,t){this.targetId=e,this.fe=t}}class _I{constructor(e,t,i=qt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=s}}class Gy{constructor(){this.ge=0,this.pe=Jy(),this.ye=qt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=ye(),t=ye(),i=ye();return this.pe.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:i=i.add(s);break;default:ee()}}),new Oc(this.ye,this.we,e,t,i)}Fe(){this.Se=!1,this.pe=Jy()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,ke(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class u4{constructor(e){this.Le=e,this.ke=new Map,this.qe=Fi(),this.Qe=Yy(),this.Ke=new ot(be)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const i=this.ze(t);switch(e.state){case 0:this.je(t)&&i.Ce(e.resumeToken);break;case 1:i.Ne(),i.be||i.Fe(),i.Ce(e.resumeToken);break;case 2:i.Ne(),i.be||this.removeTarget(t);break;case 3:this.je(t)&&(i.Be(),i.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),i.Ce(e.resumeToken));break;default:ee()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((i,s)=>{this.je(s)&&t(s)})}Je(e){const t=e.targetId,i=e.fe.count,s=this.Ye(t);if(s){const r=s.target;if(s0(r))if(i===0){const o=new X(r.path);this.We(t,o,yt.newNoDocument(o,ne.min()))}else ke(i===1);else{const o=this.Ze(t);if(o!==i){const a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,u)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:s=0},hashCount:r=0}=t;let o,a;try{o=js(i).toUint8Array()}catch(c){if(c instanceof GE)return no("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new $m(o,s,r)}catch(c){return no(c instanceof ca?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,t,i){return t.fe.count===i-this.rt(e,t.targetId)?0:2}rt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let s=0;return i.forEach(r=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(a)||(this.We(t,r,null),s++)}),s}it(e){const t=new Map;this.ke.forEach((r,o)=>{const a=this.Ye(o);if(a){if(r.current&&s0(a.target)){const c=new X(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,yt.newNoDocument(c,e))}r.De&&(t.set(o,r.ve()),r.Fe())}});let i=ye();this.Qe.forEach((r,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(r))}),this.qe.forEach((r,o)=>o.setReadTime(e));const s=new gh(e,t,this.Ke,this.qe,i);return this.qe=Fi(),this.Qe=Yy(),this.Ke=new ot(be),s}Ue(e,t){if(!this.je(e))return;const i=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,i),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,i){if(!this.je(e))return;const s=this.ze(e);this.st(e,t)?s.Me(t,1):s.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),i&&(this.qe=this.qe.insert(t,i))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Gy,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Pt(be),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||q("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Gy),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Yy(){return new ot(X.comparator)}function Jy(){return new ot(X.comparator)}const l4={asc:"ASCENDING",desc:"DESCENDING"},h4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},d4={and:"AND",or:"OR"};class f4{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function o0(n,e){return n.useProto3Json||Nc(e)?e:{value:e}}function Qu(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function m4(n,e){return Qu(n,e.toTimestamp())}function hn(n){return ke(!!n),ne.fromTimestamp(function(t){const i=fs(t);return new Le(i.seconds,i.nanos)}(n))}function qm(n,e){return function(i){return new Qe(["projects",i.projectId,"databases",i.database])}(n).child("documents").child(e).canonicalString()}function wI(n){const e=Qe.fromString(n);return ke(DI(e)),e}function ju(n,e){return qm(n.databaseId,e.path)}function wa(n,e){const t=wI(e);if(t.get(1)!==n.databaseId.projectId)throw new z(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new z(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new X(xI(t))}function a0(n,e){return qm(n.databaseId,e)}function p4(n){const e=wI(n);return e.length===4?Qe.emptyPath():xI(e)}function tc(n){return new Qe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xI(n){return ke(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Ky(n,e,t){return{name:ju(n,e),fields:t.value.mapValue.fields}}function g4(n,e){return"found"in e?function(i,s){ke(!!s.found),s.found.name,s.found.updateTime;const r=wa(i,s.found.name),o=hn(s.found.updateTime),a=s.found.createTime?hn(s.found.createTime):ne.min(),c=new Yt({mapValue:{fields:s.found.fields}});return yt.newFoundDocument(r,o,a,c)}(n,e):"missing"in e?function(i,s){ke(!!s.missing),ke(!!s.readTime);const r=wa(i,s.missing),o=hn(s.readTime);return yt.newNoDocument(r,o)}(n,e):ee()}function y4(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ee()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(u,l){return u.useProto3Json?(ke(l===void 0||typeof l=="string"),qt.fromBase64String(l||"")):(ke(l===void 0||l instanceof Uint8Array),qt.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const l=u.code===void 0?S.UNKNOWN:gI(u.code);return new z(l,u.message||"")}(o);t=new _I(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=wa(n,i.document.name),r=hn(i.document.updateTime),o=i.document.createTime?hn(i.document.createTime):ne.min(),a=new Yt({mapValue:{fields:i.document.fields}}),c=yt.newFoundDocument(s,r,o,a),u=i.targetIds||[],l=i.removedTargetIds||[];t=new Eu(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=wa(n,i.document),r=i.readTime?hn(i.readTime):ne.min(),o=yt.newNoDocument(s,r),a=i.removedTargetIds||[];t=new Eu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=wa(n,i.document),r=i.removedTargetIds||[];t=new Eu([],r,s,null)}else{if(!("filter"in e))return ee();{e.filter;const i=e.filter;i.targetId;const{count:s=0,unchangedNames:r}=i,o=new o4(s,r),a=i.targetId;t=new yI(a,o)}}return t}function EI(n,e){let t;if(e instanceof Mc)t={update:Ky(n,e.key,e.value)};else if(e instanceof ph)t={delete:ju(n,e.key)};else if(e instanceof xs)t={update:Ky(n,e.key,e.data),updateMask:A4(e.fieldMask)};else{if(!(e instanceof mI))return ee();t={verify:ju(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,o){const a=o.transform;if(a instanceof Ku)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof oo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ao)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ec)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw ee()}(0,i))),e.precondition.isNone||(t.currentDocument=function(s,r){return r.updateTime!==void 0?{updateTime:m4(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:ee()}(n,e.precondition)),t}function _4(n,e){return n&&n.length>0?(ke(e!==void 0),n.map(t=>function(s,r){let o=s.updateTime?hn(s.updateTime):hn(r);return o.isEqual(ne.min())&&(o=hn(r)),new t4(o,s.transformResults||[])}(t,e))):[]}function v4(n,e){return{documents:[a0(n,e.path)]}}function w4(n,e){const t={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(t.parent=a0(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=a0(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(c){if(c.length!==0)return TI(ii.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const r=function(c){if(c.length!==0)return c.map(u=>function(h){return{field:br(h.field),direction:I4(h.dir)}}(u))}(e.orderBy);r&&(t.structuredQuery.orderBy=r);const o=o0(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function x4(n){let e=p4(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){ke(i===1);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let r=[];t.where&&(r=function(h){const f=II(h);return f instanceof ii&&QE(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(f=>function(p){return new Ju(kr(p.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,Nc(f)?null:f}(t.limit));let c=null;t.startAt&&(c=function(h){const f=!!h.before,m=h.values||[];return new Yu(m,f)}(t.startAt));let u=null;return t.endAt&&(u=function(h){const f=!h.before,m=h.values||[];return new Yu(m,f)}(t.endAt)),HM(e,s,o,r,a,"F",c,u)}function E4(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ee()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function II(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=kr(t.unaryFilter.field);return lt.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=kr(t.unaryFilter.field);return lt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=kr(t.unaryFilter.field);return lt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=kr(t.unaryFilter.field);return lt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ee()}}(n):n.fieldFilter!==void 0?function(t){return lt.create(kr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ee()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ii.create(t.compositeFilter.filters.map(i=>II(i)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ee()}}(t.compositeFilter.op))}(n):ee()}function I4(n){return l4[n]}function T4(n){return h4[n]}function D4(n){return d4[n]}function br(n){return{fieldPath:n.canonicalString()}}function kr(n){return Ct.fromServerFormat(n.fieldPath)}function TI(n){return n instanceof lt?function(t){if(t.op==="=="){if(Oy(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NAN"}};if(My(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Oy(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NOT_NAN"}};if(My(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:br(t.field),op:T4(t.op),value:t.value}}}(n):n instanceof ii?function(t){const i=t.getFilters().map(s=>TI(s));return i.length===1?i[0]:{compositeFilter:{op:D4(t.op),filters:i}}}(n):ee()}function A4(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function DI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e,t,i,s,r=ne.min(),o=ne.min(),a=qt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new ts(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ts(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ts(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ts(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4{constructor(e){this.ut=e}}function b4(n){const e=x4({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?r0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4{constructor(){this.on=new S4}addToCollectionParentIndex(e,t){return this.on.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(ds.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(ds.min())}updateCollectionGroup(e,t,i){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class S4{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new Pt(Qe.comparator),r=!s.has(i);return this.index[t]=s.add(i),r}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new Pt(Qe.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new co(0)}static Nn(){return new co(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4{constructor(){this.changes=new Ro(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?M.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(i=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(i!==null&&va(i.mutation,s,ln.empty(),Le.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,ye()).next(()=>i))}getLocalViewOfDocuments(e,t,i=ye()){const s=Bs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,i).next(r=>{let o=aa();return r.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const i=Bs();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,ye()))}populateOverlays(e,t,i){const s=[];return i.forEach(r=>{t.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,s){let r=Fi();const o=_a(),a=function(){return _a()}();return t.forEach((c,u)=>{const l=i.get(u.key);s.has(u.key)&&(l===void 0||l.mutation instanceof xs)?r=r.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),va(l.mutation,u,l.mutation.getFieldMask(),Le.now())):o.set(u.key,ln.empty())}),this.recalculateAndSaveOverlays(e,r).next(c=>(c.forEach((u,l)=>o.set(u,l)),t.forEach((u,l)=>{var h;return a.set(u,new R4(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const i=_a();let s=new ot((o,a)=>o-a),r=ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let l=i.get(c)||ln.empty();l=a.applyToLocalView(u,l),i.set(c,l);const h=(s.get(a.batchId)||ye()).add(c);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,l=c.value,h=sI();l.forEach(f=>{if(!r.has(f)){const m=dI(t.get(f),i.get(f));m!==null&&h.set(f,m),r=r.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return M.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,s){return function(o){return X.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):$M(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,s):this.getDocumentsMatchingCollectionQuery(e,t,i,s)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next(r=>{const o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-r.size):M.resolve(Bs());let a=-1,c=r;return o.next(u=>M.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),r.get(l)?M.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{c=c.insert(l,f)}))).next(()=>this.populateOverlays(e,u,r)).next(()=>this.computeViews(e,c,u,ye())).next(l=>({batchId:a,changes:iI(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new X(t)).next(i=>{let s=aa();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,i,s){const r=t.collectionGroup;let o=aa();return this.indexManager.getCollectionParents(e,r).next(a=>M.forEach(a,c=>{const u=function(h,f){return new uh(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,i,s).next(l=>{l.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,r,s))).next(o=>{r.forEach((c,u)=>{const l=u.getKey();o.get(l)===null&&(o=o.insert(l,yt.newInvalidDocument(l)))});let a=aa();return o.forEach((c,u)=>{const l=r.get(c);l!==void 0&&va(l.mutation,u,ln.empty(),Le.now()),dh(t,u)&&(a=a.insert(c,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return M.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(s){return{id:s.id,version:s.version,createTime:hn(s.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(s){return{name:s.name,query:b4(s.bundledQuery),readTime:hn(s.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{constructor(){this.overlays=new ot(X.comparator),this.lr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Bs();return M.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((s,r)=>{this.lt(e,t,r)}),M.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.lr.get(i);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.lr.delete(i)),M.resolve()}getOverlaysForCollection(e,t,i){const s=Bs(),r=t.length+1,o=new X(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===r&&c.largestBatchId>i&&s.set(c.getKey(),c)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let r=new ot((u,l)=>u-l);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let l=r.get(u.largestBatchId);l===null&&(l=Bs(),r=r.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}const a=Bs(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=s)););return M.resolve(a)}lt(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const o=this.lr.get(s.largestBatchId).delete(i.key);this.lr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new r4(t,i));let r=this.lr.get(t);r===void 0&&(r=ye(),this.lr.set(t,r)),this.lr.set(t,r.add(i.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(){this.hr=new Pt(mt.Pr),this.Ir=new Pt(mt.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const i=new mt(e,t);this.hr=this.hr.add(i),this.Ir=this.Ir.add(i)}Er(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.dr(new mt(e,t))}Ar(e,t){e.forEach(i=>this.removeReference(i,t))}Rr(e){const t=new X(new Qe([])),i=new mt(t,e),s=new mt(t,e+1),r=[];return this.Ir.forEachInRange([i,s],o=>{this.dr(o),r.push(o.key)}),r}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new X(new Qe([])),i=new mt(t,e),s=new mt(t,e+1);let r=ye();return this.Ir.forEachInRange([i,s],o=>{r=r.add(o.key)}),r}containsKey(e){const t=new mt(e,0),i=this.hr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class mt{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return X.comparator(e.key,t.key)||be(e.gr,t.gr)}static Tr(e,t){return be(e.gr,t.gr)||X.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new Pt(mt.Pr)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const r=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new s4(r,t,i,s);this.mutationQueue.push(o);for(const a of s)this.yr=this.yr.add(new mt(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.Sr(i),r=s<0?0:s;return M.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new mt(t,0),s=new mt(t,Number.POSITIVE_INFINITY),r=[];return this.yr.forEachInRange([i,s],o=>{const a=this.wr(o.gr);r.push(a)}),M.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Pt(be);return t.forEach(s=>{const r=new mt(s,0),o=new mt(s,Number.POSITIVE_INFINITY);this.yr.forEachInRange([r,o],a=>{i=i.add(a.gr)})}),M.resolve(this.br(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let r=i;X.isDocumentKey(r)||(r=r.child(""));const o=new mt(new X(r),0);let a=new Pt(be);return this.yr.forEachWhile(c=>{const u=c.key.path;return!!i.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.gr)),!0)},o),M.resolve(this.br(a))}br(e){const t=[];return e.forEach(i=>{const s=this.wr(i);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ke(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.yr;return M.forEach(t.mutations,s=>{const r=new mt(s.key,t.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.yr=i})}Fn(e){}containsKey(e,t){const i=new mt(t,0),s=this.yr.firstAfterOrEqual(i);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4{constructor(e){this.Cr=e,this.docs=function(){return new ot(X.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),r=s?s.size:0,o=this.Cr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return M.resolve(i?i.document.mutableCopy():yt.newInvalidDocument(t))}getEntries(e,t){let i=Fi();return t.forEach(s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():yt.newInvalidDocument(s))}),M.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let r=Fi();const o=t.path,a=new X(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||DM(TM(l),i)<=0||(s.has(l.key)||dh(t,l))&&(r=r.insert(l.key,l.mutableCopy()))}return M.resolve(r)}getAllFromCollectionGroup(e,t,i,s){ee()}vr(e,t){return M.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new L4(this)}getSize(e){return M.resolve(this.size)}}class L4 extends P4{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?t.push(this._r.addEntry(e,s)):this._r.removeEntry(i)}),M.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4{constructor(e){this.persistence=e,this.Fr=new Ro(t=>Vm(t),Um),this.lastRemoteSnapshotVersion=ne.min(),this.highestTargetId=0,this.Mr=0,this.Or=new zm,this.targetCount=0,this.Nr=co.On()}forEachTarget(e,t){return this.Fr.forEach((i,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Mr&&(this.Mr=t),M.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new co(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.kn(t),M.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,i){let s=0;const r=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Fr.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),M.waitFor(r).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const i=this.Fr.get(t)||null;return M.resolve(i)}addMatchingKeys(e,t,i){return this.Or.Er(t,i),M.resolve()}removeMatchingKeys(e,t,i){this.Or.Ar(t,i);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Or.mr(t);return M.resolve(i)}containsKey(e,t){return M.resolve(this.Or.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U4{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Om(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new V4(this),this.indexManager=new k4,this.remoteDocumentCache=function(s){return new B4(s)}(i=>this.referenceDelegate.Qr(i)),this.serializer=new C4(t),this.Kr=new M4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new O4,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Br[e.toKey()];return i||(i=new F4(t,this.referenceDelegate),this.Br[e.toKey()]=i),i}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,i){q("MemoryPersistence","Starting transaction:",e);const s=new W4(this.Lr.next());return this.referenceDelegate.$r(),i(s).next(r=>this.referenceDelegate.Ur(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Wr(e,t){return M.or(Object.values(this.Br).map(i=>()=>i.containsKey(e,t)))}}class W4 extends CM{constructor(e){super(),this.currentSequenceNumber=e}}class Gm{constructor(e){this.persistence=e,this.Gr=new zm,this.zr=null}static jr(e){return new Gm(e)}get Hr(){if(this.zr)return this.zr;throw ee()}addReference(e,t,i){return this.Gr.addReference(i,t),this.Hr.delete(i.toString()),M.resolve()}removeReference(e,t,i){return this.Gr.removeReference(i,t),this.Hr.add(i.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),M.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(s=>this.Hr.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(r=>this.Hr.add(r.toString()))}).next(()=>i.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.Hr,i=>{const s=X.fromPath(i);return this.Jr(e,s).next(r=>{r||t.removeEntry(s,ne.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(i=>{i?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return M.or([()=>M.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.ki=i,this.qi=s}static Qi(e,t){let i=ye(),s=ye();for(const r of t.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Ym(e,t.fromCache,i,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,i,s){const r={result:null};return this.zi(e,t).next(o=>{r.result=o}).next(()=>{if(!r.result)return this.ji(e,t,s,i).next(o=>{r.result=o})}).next(()=>{if(r.result)return;const o=new H4;return this.Hi(e,t,o).next(a=>{if(r.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>r.result)}Ji(e,t,i,s){return i.documentReadCount<this.Ui?(ea()<=ge.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",Cr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),M.resolve()):(ea()<=ge.DEBUG&&q("QueryEngine","Query:",Cr(t),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.Wi*s?(ea()<=ge.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",Cr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jn(t))):M.resolve())}zi(e,t){if(Vy(t))return M.resolve(null);let i=jn(t);return this.indexManager.getIndexType(e,i).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=r0(t,null,"F"),i=jn(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(r=>{const o=ye(...r);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{const u=this.Yi(t,a);return this.Zi(t,u,o,c.readTime)?this.zi(e,r0(t,null,"F")):this.Xi(e,u,t,c)}))})))}ji(e,t,i,s){return Vy(t)||s.isEqual(ne.min())?M.resolve(null):this.Gi.getDocuments(e,i).next(r=>{const o=this.Yi(t,r);return this.Zi(t,o,i,s)?M.resolve(null):(ea()<=ge.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Cr(t)),this.Xi(e,o,t,IM(s,-1)).next(a=>a))})}Yi(e,t){let i=new Pt(tI(e));return t.forEach((s,r)=>{dh(e,r)&&(i=i.add(r))}),i}Zi(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Hi(e,t,i){return ea()<=ge.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",Cr(t)),this.Gi.getDocumentsMatchingQuery(e,t,ds.min(),i)}Xi(e,t,i,s){return this.Gi.getDocumentsMatchingQuery(e,i,s).next(r=>(t.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q4{constructor(e,t,i,s){this.persistence=e,this.es=t,this.serializer=s,this.ts=new ot(be),this.ns=new Ro(r=>Vm(r),Um),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(i)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new N4(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function z4(n,e,t,i){return new q4(n,e,t,i)}async function AI(n,e){const t=re(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(r=>(s=r,t.os(e),t.mutationQueue.getAllMutationBatches(i))).next(r=>{const o=[],a=[];let c=ye();for(const u of s){o.push(u.batchId);for(const l of u.mutations)c=c.add(l.key)}for(const u of r){a.push(u.batchId);for(const l of u.mutations)c=c.add(l.key)}return t.localDocuments.getDocuments(i,c).next(u=>({_s:u,removedBatchIds:o,addedBatchIds:a}))})})}function G4(n,e){const t=re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=e.batch.keys(),r=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){const h=u.batch,f=h.keys();let m=M.resolve();return f.forEach(p=>{m=m.next(()=>l.getEntry(c,p)).next(y=>{const g=u.docVersions.get(p);ke(g!==null),y.version.compareTo(g)<0&&(h.applyToRemoteDocument(y,u),y.isValidDocument()&&(y.setReadTime(u.commitVersion),l.addEntry(y)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(t,i,e,r).next(()=>r.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=ye();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(i,s))})}function CI(n){const e=re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function Y4(n,e){const t=re(n),i=e.snapshotVersion;let s=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});s=t.ts;const a=[];e.targetChanges.forEach((l,h)=>{const f=s.get(h);if(!f)return;a.push(t.qr.removeMatchingKeys(r,l.removedDocuments,h).next(()=>t.qr.addMatchingKeys(r,l.addedDocuments,h)));let m=f.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(qt.EMPTY_BYTE_STRING,ne.min()).withLastLimboFreeSnapshotVersion(ne.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,i)),s=s.insert(h,m),function(y,g,x){return y.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(f,m,l)&&a.push(t.qr.updateTargetData(r,m))});let c=Fi(),u=ye();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(r,l))}),a.push(J4(r,o,e.documentUpdates).next(l=>{c=l.us,u=l.cs})),!i.isEqual(ne.min())){const l=t.qr.getLastRemoteSnapshotVersion(r).next(h=>t.qr.setTargetsMetadata(r,r.currentSequenceNumber,i));a.push(l)}return M.waitFor(a).next(()=>o.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,c,u)).next(()=>c)}).then(r=>(t.ts=s,r))}function J4(n,e,t){let i=ye(),s=ye();return t.forEach(r=>i=i.add(r)),e.getEntries(n,i).next(r=>{let o=Fi();return t.forEach((a,c)=>{const u=r.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(ne.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):q("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{us:o,cs:s}})}function K4(n,e){const t=re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Q4(n,e){const t=re(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let s;return t.qr.getTargetData(i,e).next(r=>r?(s=r,M.resolve(s)):t.qr.allocateTargetId(i).next(o=>(s=new ts(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.qr.addTargetData(i,s).next(()=>s))))}).then(i=>{const s=t.ts.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.ts=t.ts.insert(i.targetId,i),t.ns.set(e,i.targetId)),i})}async function c0(n,e,t){const i=re(n),s=i.ts.get(e),r=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",r,o=>i.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Rc(o))throw o;q("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.ts=i.ts.remove(e),i.ns.delete(s.target)}function Qy(n,e,t){const i=re(n);let s=ne.min(),r=ye();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){const h=re(c),f=h.ns.get(l);return f!==void 0?M.resolve(h.ts.get(f)):h.qr.getTargetData(u,l)}(i,o,jn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,i.qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{r=c})}).next(()=>i.es.getDocumentsMatchingQuery(o,e,t?s:ne.min(),t?r:ye())).next(a=>(j4(i,zM(e),a),{documents:a,ls:r})))}function j4(n,e,t){let i=n.rs.get(e)||ne.min();t.forEach((s,r)=>{r.readTime.compareTo(i)>0&&(i=r.readTime)}),n.rs.set(e,i)}class jy{constructor(){this.activeTargetIds=jM()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class X4{constructor(){this.eo=new jy,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,i){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new jy,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{ro(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){q("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){q("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lu=null;function gd(){return lu===null?lu=function(){return 268435456+Math.round(2147483648*Math.random())}():lu++,"0x"+lu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="WebChannelConnection";class nO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.mo=i+"://"+t.host,this.fo=`projects/${s}/databases/${r}`,this.po=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${r}`}get yo(){return!1}wo(t,i,s,r,o){const a=gd(),c=this.So(t,i);q("RestConnection",`Sending RPC '${t}' ${a}:`,c,s);const u={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(u,r,o),this.Do(t,c,u,s).then(l=>(q("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw no("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",c,"request:",s),l})}Co(t,i,s,r,o,a){return this.wo(t,i,s,r,o)}bo(t,i,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Po}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((r,o)=>t[o]=r),s&&s.headers.forEach((r,o)=>t[o]=r)}So(t,i){const s=eO[t];return`${this.mo}/v1/${i}:${s}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,i,s){const r=gd();return new Promise((o,a)=>{const c=new dM;c.setWithCredentials(!0),c.listenOnce(lM.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case pd.NO_ERROR:const l=c.getResponseJson();q(Nt,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(l)),o(l);break;case pd.TIMEOUT:q(Nt,`RPC '${e}' ${r} timed out`),a(new z(S.DEADLINE_EXCEEDED,"Request time out"));break;case pd.HTTP_ERROR:const h=c.getStatus();if(q(Nt,`RPC '${e}' ${r} failed with status:`,h,"response text:",c.getResponseText()),h>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const p=function(g){const x=g.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(x)>=0?x:S.UNKNOWN}(m.status);a(new z(p,m.message))}else a(new z(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new z(S.UNAVAILABLE,"Connection failed."));break;default:ee()}}finally{q(Nt,`RPC '${e}' ${r} completed.`)}});const u=JSON.stringify(s);q(Nt,`RPC '${e}' ${r} sending request:`,s),c.send(t,"POST",u,i,15)})}vo(e,t,i){const s=gd(),r=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=cM(),a=uM(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.bo(c.initMessageHeaders,t,i),c.encodeInitMessageHeaders=!0;const l=r.join("");q(Nt,`Creating RPC '${e}' stream ${s}: ${l}`,c);const h=o.createWebChannel(l,c);let f=!1,m=!1;const p=new tO({co:g=>{m?q(Nt,`Not sending because RPC '${e}' stream ${s} is closed:`,g):(f||(q(Nt,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),q(Nt,`RPC '${e}' stream ${s} sending:`,g),h.send(g))},lo:()=>h.close()}),y=(g,x,_)=>{g.listen(x,v=>{try{_(v)}catch(w){setTimeout(()=>{throw w},0)}})};return y(h,au.EventType.OPEN,()=>{m||q(Nt,`RPC '${e}' stream ${s} transport opened.`)}),y(h,au.EventType.CLOSE,()=>{m||(m=!0,q(Nt,`RPC '${e}' stream ${s} transport closed`),p.Ro())}),y(h,au.EventType.ERROR,g=>{m||(m=!0,no(Nt,`RPC '${e}' stream ${s} transport errored:`,g),p.Ro(new z(S.UNAVAILABLE,"The operation could not be completed")))}),y(h,au.EventType.MESSAGE,g=>{var x;if(!m){const _=g.data[0];ke(!!_);const v=_,w=v.error||((x=v[0])===null||x===void 0?void 0:x.error);if(w){q(Nt,`RPC '${e}' stream ${s} received error:`,w);const I=w.status;let T=function(R){const E=it[R];if(E!==void 0)return gI(E)}(I),D=w.message;T===void 0&&(T=S.INTERNAL,D="Unknown error status: "+I+" with message "+w.message),m=!0,p.Ro(new z(T,D)),h.close()}else q(Nt,`RPC '${e}' stream ${s} received:`,_),p.Vo(_)}}),y(a,hM.STAT_EVENT,g=>{g.stat===ky.PROXY?q(Nt,`RPC '${e}' stream ${s} detected buffering proxy`):g.stat===ky.NOPROXY&&q(Nt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.Ao()},0),p}}function yd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yh(n){return new f4(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e,t,i=1e3,s=1.5,r=6e4){this.si=e,this.timerId=t,this.Fo=i,this.Mo=s,this.xo=r,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),i=Math.max(0,Date.now()-this.Bo),s=Math.max(0,t-i);s>0&&q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,s,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e,t,i,s,r,o,a,c){this.si=e,this.Ko=i,this.$o=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Jm(e,t)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,t){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(Oi(t.toString()),Oi("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(t)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.Uo===t&&this.s_(i,s)},i=>{e(()=>{const s=new z(S.UNKNOWN,"Fetching auth token failed: "+i.message);return this.o_(s)})})}s_(e,t){const i=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{i(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(s=>{i(()=>this.o_(s))}),this.stream.onMessage(s=>{i(()=>this.onMessage(s))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return q("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(q("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class iO extends bI{constructor(e,t,i,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,s,o),this.serializer=r}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=y4(this.serializer,e),i=function(r){if(!("targetChange"in r))return ne.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?ne.min():o.readTime?hn(o.readTime):ne.min()}(e);return this.listener.a_(t,i)}u_(e){const t={};t.database=tc(this.serializer),t.addTarget=function(r,o){let a;const c=o.target;if(a=s0(c)?{documents:v4(r,c)}:{query:w4(r,c)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=vI(r,o.resumeToken);const u=o0(r,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ne.min())>0){a.readTime=Qu(r,o.snapshotVersion.toTimestamp());const u=o0(r,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const i=E4(this.serializer,e);i&&(t.labels=i),this.e_(t)}c_(e){const t={};t.database=tc(this.serializer),t.removeTarget=e,this.e_(t)}}class sO extends bI{constructor(e,t,i,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,o),this.serializer=r,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(ke(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=_4(e.writeResults,e.commitTime),i=hn(e.commitTime);return this.listener.I_(i,t)}return ke(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=tc(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>EI(this.serializer,i))};this.e_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO extends class{}{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=s,this.d_=!1}A_(){if(this.d_)throw new z(S.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,r])=>this.connection.wo(e,t,i,s,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new z(S.UNKNOWN,s.toString())})}Co(e,t,i,s){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Co(e,t,i,r,o,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new z(S.UNKNOWN,r.toString())})}terminate(){this.d_=!0}}class oO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Oi(t),this.f_=!1):q("OnlineStateTracker",t)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e,t,i,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=r,this.F_.ro(o=>{i.enqueueAndForget(async()=>{hr(this)&&(q("RemoteStore","Restarting streams for network reachability change."),await async function(c){const u=re(c);u.C_.add(4),await Fc(u),u.M_.set("Unknown"),u.C_.delete(4),await _h(u)}(this))})}),this.M_=new oO(i,s)}}async function _h(n){if(hr(n))for(const e of n.v_)await e(!0)}async function Fc(n){for(const e of n.v_)await e(!1)}function kI(n,e){const t=re(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),jm(t)?Qm(t):No(t).Ho()&&Km(t,e))}function SI(n,e){const t=re(n),i=No(t);t.D_.delete(e),i.Ho()&&PI(t,e),t.D_.size===0&&(i.Ho()?i.Zo():hr(t)&&t.M_.set("Unknown"))}function Km(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ne.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}No(n).u_(e)}function PI(n,e){n.x_.Oe(e),No(n).c_(e)}function Qm(n){n.x_=new u4({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),No(n).start(),n.M_.g_()}function jm(n){return hr(n)&&!No(n).jo()&&n.D_.size>0}function hr(n){return re(n).C_.size===0}function RI(n){n.x_=void 0}async function cO(n){n.D_.forEach((e,t)=>{Km(n,e)})}async function uO(n,e){RI(n),jm(n)?(n.M_.w_(e),Qm(n)):n.M_.set("Unknown")}async function lO(n,e,t){if(n.M_.set("Online"),e instanceof _I&&e.state===2&&e.cause)try{await async function(s,r){const o=r.cause;for(const a of r.targetIds)s.D_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.D_.delete(a),s.x_.removeTarget(a))}(n,e)}catch(i){q("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Xu(n,i)}else if(e instanceof Eu?n.x_.$e(e):e instanceof yI?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(ne.min()))try{const i=await CI(n.localStore);t.compareTo(i)>=0&&await function(r,o){const a=r.x_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const l=r.D_.get(u);l&&r.D_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{const l=r.D_.get(c);if(!l)return;r.D_.set(c,l.withResumeToken(qt.EMPTY_BYTE_STRING,l.snapshotVersion)),PI(r,c);const h=new ts(l.target,c,u,l.sequenceNumber);Km(r,h)}),r.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(i){q("RemoteStore","Failed to raise snapshot:",i),await Xu(n,i)}}async function Xu(n,e,t){if(!Rc(e))throw e;n.C_.add(1),await Fc(n),n.M_.set("Offline"),t||(t=()=>CI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{q("RemoteStore","Retrying IndexedDB access"),await t(),n.C_.delete(1),await _h(n)})}function NI(n,e){return e().catch(t=>Xu(n,t,e))}async function vh(n){const e=re(n),t=ms(e);let i=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;hO(e);)try{const s=await K4(e.localStore,i);if(s===null){e.b_.length===0&&t.Zo();break}i=s.batchId,dO(e,s)}catch(s){await Xu(e,s)}MI(e)&&OI(e)}function hO(n){return hr(n)&&n.b_.length<10}function dO(n,e){n.b_.push(e);const t=ms(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function MI(n){return hr(n)&&!ms(n).jo()&&n.b_.length>0}function OI(n){ms(n).start()}async function fO(n){ms(n).E_()}async function mO(n){const e=ms(n);for(const t of n.b_)e.P_(t.mutations)}async function pO(n,e,t){const i=n.b_.shift(),s=Hm.from(i,e,t);await NI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await vh(n)}async function gO(n,e){e&&ms(n).h_&&await async function(i,s){if(function(o){return pI(o)&&o!==S.ABORTED}(s.code)){const r=i.b_.shift();ms(i).Yo(),await NI(i,()=>i.remoteSyncer.rejectFailedWrite(r.batchId,s)),await vh(i)}}(n,e),MI(n)&&OI(n)}async function Zy(n,e){const t=re(n);t.asyncQueue.verifyOperationInProgress(),q("RemoteStore","RemoteStore received new credentials");const i=hr(t);t.C_.add(3),await Fc(t),i&&t.M_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),await _h(t)}async function yO(n,e){const t=re(n);e?(t.C_.delete(2),await _h(t)):e||(t.C_.add(2),await Fc(t),t.M_.set("Unknown"))}function No(n){return n.O_||(n.O_=function(t,i,s){const r=re(t);return r.A_(),new iO(i,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(n.datastore,n.asyncQueue,{ho:cO.bind(null,n),Io:uO.bind(null,n),a_:lO.bind(null,n)}),n.v_.push(async e=>{e?(n.O_.Yo(),jm(n)?Qm(n):n.M_.set("Unknown")):(await n.O_.stop(),RI(n))})),n.O_}function ms(n){return n.N_||(n.N_=function(t,i,s){const r=re(t);return r.A_(),new sO(i,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(n.datastore,n.asyncQueue,{ho:fO.bind(null,n),Io:gO.bind(null,n),T_:mO.bind(null,n),I_:pO.bind(null,n)}),n.v_.push(async e=>{e?(n.N_.Yo(),await vh(n)):(await n.N_.stop(),n.b_.length>0&&(q("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))})),n.N_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,i,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new Qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,r){const o=Date.now()+i,a=new Xm(e,t,o,s,r);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zm(n,e){if(Oi("AsyncQueue",`${e}: ${n}`),Rc(n))return new z(S.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e){this.comparator=e?(t,i)=>e(t,i)||X.comparator(t.key,i.key):(t,i)=>X.comparator(t.key,i.key),this.keyedMap=aa(),this.sortedSet=new ot(this.comparator)}static emptySet(e){return new Wr(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Wr;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(){this.B_=new ot(X.comparator)}track(e){const t=e.doc.key,i=this.B_.get(t);i?e.type!==0&&i.type===3?this.B_=this.B_.insert(t,e):e.type===3&&i.type!==1?this.B_=this.B_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.B_=this.B_.remove(t):e.type===1&&i.type===2?this.B_=this.B_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):ee():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,i)=>{e.push(i)}),e}}class uo{constructor(e,t,i,s,r,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,s,r){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new uo(e,t,Wr.emptySet(t),o,i,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==i[s].type||!t[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _O{constructor(){this.k_=void 0,this.listeners=[]}}class vO{constructor(){this.queries=new Ro(e=>eI(e),hh),this.onlineState="Unknown",this.q_=new Set}}async function ep(n,e){const t=re(n),i=e.query;let s=!1,r=t.queries.get(i);if(r||(s=!0,r=new _O),s)try{r.k_=await t.onListen(i)}catch(o){const a=Zm(o,`Initialization of query '${Cr(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,r),r.listeners.push(e),e.Q_(t.onlineState),r.k_&&e.K_(r.k_)&&np(t)}async function tp(n,e){const t=re(n),i=e.query;let s=!1;const r=t.queries.get(i);if(r){const o=r.listeners.indexOf(e);o>=0&&(r.listeners.splice(o,1),s=r.listeners.length===0)}if(s)return t.queries.delete(i),t.onUnlisten(i)}function wO(n,e){const t=re(n);let i=!1;for(const s of e){const r=s.query,o=t.queries.get(r);if(o){for(const a of o.listeners)a.K_(s)&&(i=!0);o.k_=s}}i&&np(t)}function xO(n,e,t){const i=re(n),s=i.queries.get(e);if(s)for(const r of s.listeners)r.onError(t);i.queries.delete(e)}function np(n){n.q_.forEach(e=>{e.next()})}class ip{constructor(e,t,i){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=i||{}}K_(e){if(!this.options.includeMetadataChanges){const i=[];for(const s of e.docChanges)s.type!==3&&i.push(s);e=new uo(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){if(!e.fromCache)return!0;const i=t!=="Offline";return(!this.options.J_||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}z_(e){if(e.docChanges.length>0)return!0;const t=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}H_(e){e=uo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(e){this.key=e}}class BI{constructor(e){this.key=e}}class EO{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=ye(),this.mutatedKeys=ye(),this._a=tI(e),this.aa=new Wr(this._a)}get ua(){return this.ia}ca(e,t){const i=t?t.la:new e_,s=t?t.aa:this.aa;let r=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{const f=s.get(l),m=dh(this.query,h)?h:null,p=!!f&&this.mutatedKeys.has(f.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let g=!1;f&&m?f.data.isEqual(m.data)?p!==y&&(i.track({type:3,doc:m}),g=!0):this.ha(f,m)||(i.track({type:2,doc:m}),g=!0,(c&&this._a(m,c)>0||u&&this._a(m,u)<0)&&(a=!0)):!f&&m?(i.track({type:0,doc:m}),g=!0):f&&!m&&(i.track({type:1,doc:f}),g=!0,(c||u)&&(a=!0)),g&&(m?(o=o.add(m),r=y?r.add(l):r.delete(l)):(o=o.delete(l),r=r.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),r=r.delete(l.key),i.track({type:1,doc:l})}return{aa:o,la:i,Zi:a,mutatedKeys:r}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,s){const r=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const o=e.la.L_();o.sort((l,h)=>function(m,p){const y=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ee()}};return y(m)-y(p)}(l.type,h.type)||this._a(l.doc,h.doc)),this.Pa(i),s=s!=null&&s;const a=t&&!s?this.Ia():[],c=this.oa.size===0&&this.current&&!s?1:0,u=c!==this.sa;return this.sa=c,o.length!==0||u?{snapshot:new uo(this.query,e.aa,r,o,e.mutatedKeys,c===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new e_,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=ye(),this.aa.forEach(i=>{this.Ea(i.key)&&(this.oa=this.oa.add(i.key))});const t=[];return e.forEach(i=>{this.oa.has(i)||t.push(new BI(i))}),this.oa.forEach(i=>{e.has(i)||t.push(new FI(i))}),t}da(e){this.ia=e.ls,this.oa=ye();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return uo.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}}class IO{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class TO{constructor(e){this.key=e,this.Ra=!1}}class DO{constructor(e,t,i,s,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new Ro(a=>eI(a),hh),this.fa=new Map,this.ga=new Set,this.pa=new ot(X.comparator),this.ya=new Map,this.wa=new zm,this.Sa={},this.ba=new Map,this.Da=co.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}}async function AO(n,e){const t=FO(n);let i,s;const r=t.ma.get(e);if(r)i=r.targetId,t.sharedClientState.addLocalQueryTarget(i),s=r.view.Aa();else{const o=await Q4(t.localStore,jn(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,s=await CO(t,e,i,a==="current",o.resumeToken),t.isPrimaryClient&&kI(t.remoteStore,o)}return s}async function CO(n,e,t,i,s){n.va=(h,f,m)=>async function(y,g,x,_){let v=g.view.ca(x);v.Zi&&(v=await Qy(y.localStore,g.query,!1).then(({documents:D})=>g.view.ca(D,v)));const w=_&&_.targetChanges.get(g.targetId),I=_&&_.targetMismatches.get(g.targetId)!=null,T=g.view.applyChanges(v,y.isPrimaryClient,w,I);return n_(y,g.targetId,T.Ta),T.snapshot}(n,h,f,m);const r=await Qy(n.localStore,e,!0),o=new EO(e,r.ls),a=o.ca(r.documents),c=Oc.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,c);n_(n,t,u.Ta);const l=new IO(e,t,o);return n.ma.set(e,l),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),u.snapshot}async function bO(n,e){const t=re(n),i=t.ma.get(e),s=t.fa.get(i.targetId);if(s.length>1)return t.fa.set(i.targetId,s.filter(r=>!hh(r,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||await c0(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),SI(t.remoteStore,i.targetId),u0(t,i.targetId)}).catch(Pc)):(u0(t,i.targetId),await c0(t.localStore,i.targetId,!0))}async function kO(n,e,t){const i=BO(n);try{const s=await function(o,a){const c=re(o),u=Le.now(),l=a.reduce((m,p)=>m.add(p.key),ye());let h,f;return c.persistence.runTransaction("Locally write mutations","readwrite",m=>{let p=Fi(),y=ye();return c.ss.getEntries(m,l).next(g=>{p=g,p.forEach((x,_)=>{_.isValidDocument()||(y=y.add(x))})}).next(()=>c.localDocuments.getOverlayedDocuments(m,p)).next(g=>{h=g;const x=[];for(const _ of a){const v=i4(_,h.get(_.key).overlayedDocument);v!=null&&x.push(new xs(_.key,v,YE(v.value.mapValue),Lt.exists(!0)))}return c.mutationQueue.addMutationBatch(m,u,x,a)}).next(g=>{f=g;const x=g.applyToLocalDocumentSet(h,y);return c.documentOverlayCache.saveOverlays(m,g.batchId,x)})}).then(()=>({batchId:f.batchId,changes:iI(h)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Sa[o.currentUser.toKey()];u||(u=new ot(be)),u=u.insert(a,c),o.Sa[o.currentUser.toKey()]=u}(i,s.batchId,t),await Bc(i,s.changes),await vh(i.remoteStore)}catch(s){const r=Zm(s,"Failed to persist write");t.reject(r)}}async function LI(n,e){const t=re(n);try{const i=await Y4(t.localStore,e);e.targetChanges.forEach((s,r)=>{const o=t.ya.get(r);o&&(ke(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Ra=!0:s.modifiedDocuments.size>0?ke(o.Ra):s.removedDocuments.size>0&&(ke(o.Ra),o.Ra=!1))}),await Bc(t,i,e)}catch(i){await Pc(i)}}function t_(n,e,t){const i=re(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.ma.forEach((r,o)=>{const a=o.view.Q_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=re(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(const f of h.listeners)f.Q_(a)&&(u=!0)}),u&&np(c)}(i.eventManager,e),s.length&&i.Va.a_(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function SO(n,e,t){const i=re(n);i.sharedClientState.updateQueryState(e,"rejected",t);const s=i.ya.get(e),r=s&&s.key;if(r){let o=new ot(X.comparator);o=o.insert(r,yt.newNoDocument(r,ne.min()));const a=ye().add(r),c=new gh(ne.min(),new Map,new ot(be),o,a);await LI(i,c),i.pa=i.pa.remove(r),i.ya.delete(e),sp(i)}else await c0(i.localStore,e,!1).then(()=>u0(i,e,t)).catch(Pc)}async function PO(n,e){const t=re(n),i=e.batch.batchId;try{const s=await G4(t.localStore,e);UI(t,i,null),VI(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Bc(t,s)}catch(s){await Pc(s)}}async function RO(n,e,t){const i=re(n);try{const s=await function(o,a){const c=re(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(h=>(ke(h!==null),l=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(i.localStore,e);UI(i,e,t),VI(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Bc(i,s)}catch(s){await Pc(s)}}function VI(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function UI(n,e,t){const i=re(n);let s=i.Sa[i.currentUser.toKey()];if(s){const r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),i.Sa[i.currentUser.toKey()]=s}}function u0(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.fa.get(e))n.ma.delete(i),t&&n.Va.Fa(i,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(i=>{n.wa.containsKey(i)||WI(n,i)})}function WI(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);t!==null&&(SI(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),sp(n))}function n_(n,e,t){for(const i of t)i instanceof FI?(n.wa.addReference(i.key,e),NO(n,i)):i instanceof BI?(q("SyncEngine","Document no longer in limbo: "+i.key),n.wa.removeReference(i.key,e),n.wa.containsKey(i.key)||WI(n,i.key)):ee()}function NO(n,e){const t=e.key,i=t.path.canonicalString();n.pa.get(t)||n.ga.has(i)||(q("SyncEngine","New document in limbo: "+t),n.ga.add(i),sp(n))}function sp(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new X(Qe.fromString(e)),i=n.Da.next();n.ya.set(i,new TO(t)),n.pa=n.pa.insert(t,i),kI(n.remoteStore,new ts(jn(lh(t.path)),i,"TargetPurposeLimboResolution",Om._e))}}async function Bc(n,e,t){const i=re(n),s=[],r=[],o=[];i.ma.isEmpty()||(i.ma.forEach((a,c)=>{o.push(i.va(c,e,t).then(u=>{if((u||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,u!=null&&u.fromCache?"not-current":"current"),u){s.push(u);const l=Ym.Qi(c.targetId,u);r.push(l)}}))}),await Promise.all(o),i.Va.a_(s),await async function(c,u){const l=re(c);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>M.forEach(u,f=>M.forEach(f.ki,m=>l.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>M.forEach(f.qi,m=>l.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Rc(h))throw h;q("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const m=l.ts.get(f),p=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(p);l.ts=l.ts.insert(f,y)}}}(i.localStore,r))}async function MO(n,e){const t=re(n);if(!t.currentUser.isEqual(e)){q("SyncEngine","User change. New user:",e.toKey());const i=await AI(t.localStore,e);t.currentUser=e,function(r,o){r.ba.forEach(a=>{a.forEach(c=>{c.reject(new z(S.CANCELLED,o))})}),r.ba.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Bc(t,i._s)}}function OO(n,e){const t=re(n),i=t.ya.get(e);if(i&&i.Ra)return ye().add(i.key);{let s=ye();const r=t.fa.get(e);if(!r)return s;for(const o of r){const a=t.ma.get(o);s=s.unionWith(a.view.ua)}return s}}function FO(n){const e=re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=LI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=OO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=SO.bind(null,e),e.Va.a_=wO.bind(null,e.eventManager),e.Va.Fa=xO.bind(null,e.eventManager),e}function BO(n){const e=re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=PO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=RO.bind(null,e),e}class i_{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=yh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return z4(this.persistence,new $4,e.initialUser,this.serializer)}createPersistence(e){return new U4(Gm.jr,this.serializer)}createSharedClientState(e){return new X4}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class LO{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>t_(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=MO.bind(null,this.syncEngine),await yO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new vO}()}createDatastore(e){const t=yh(e.databaseInfo.databaseId),i=function(r){return new nO(r)}(e.databaseInfo);return function(r,o,a,c){return new rO(r,o,a,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,s,r,o,a){return new aO(i,s,r,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>t_(this.syncEngine,t,0),function(){return Xy.D()?new Xy:new Z4}())}createSyncEngine(e,t){return function(s,r,o,a,c,u,l){const h=new DO(s,r,o,a,c,u);return l&&(h.Ca=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const i=re(t);q("RemoteStore","RemoteStore shutting down."),i.C_.add(5),await Fc(i),i.F_.shutdown(),i.M_.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):Oi("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VO{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new z(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(s,r){const o=re(s),a=tc(o.serializer)+"/documents",c={documents:r.map(f=>ju(o.serializer,f))},u=await o.Co("BatchGetDocuments",a,c,r.length),l=new Map;u.forEach(f=>{const m=g4(o.serializer,f);l.set(m.key.toString(),m)});const h=[];return r.forEach(f=>{const m=l.get(f.toString());ke(!!m),h.push(m)}),h}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new ph(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{const s=X.fromPath(i);this.mutations.push(new mI(s,this.precondition(s)))}),await async function(i,s){const r=re(i),o=tc(r.serializer)+"/documents",a={writes:s.map(c=>EI(r.serializer,c))};await r.wo("Commit",o,a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ee();t=ne.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new z(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ne.min())?Lt.exists(!1):Lt.updateTime(t):Lt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ne.min()))throw new z(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Lt.updateTime(t)}return Lt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UO{constructor(e,t,i,s,r){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=s,this.deferred=r,this.Wa=i.maxAttempts,this.zo=new Jm(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){this.zo.ko(async()=>{const e=new VO(this.datastore),t=this.za(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(s=>{this.ja(s)}))}).catch(i=>{this.ja(i)})})}za(e){try{const t=this.updateFunction(e);return!Nc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!pI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WO{constructor(e,t,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=Ft.UNAUTHENTICATED,this.clientId=qE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async r=>{q("FirestoreClient","Received user=",r.uid),await this.authCredentialListener(r),this.user=r}),this.appCheckCredentials.start(i,r=>(q("FirestoreClient","Received new app check token=",r),this.appCheckCredentialListener(r,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new z(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Zm(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function _d(n,e){n.asyncQueue.verifyOperationInProgress(),q("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async s=>{i.isEqual(s)||(await AI(e.localStore,s),i=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function s_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await $O(n);q("FirestoreClient","Initializing OnlineComponentProvider");const i=await n.getConfiguration();await e.initialize(t,i),n.setCredentialChangeListener(s=>Zy(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>Zy(e.remoteStore,r)),n._onlineComponents=e}function HO(n){return n.name==="FirebaseError"?n.code===S.FAILED_PRECONDITION||n.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function $O(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){q("FirestoreClient","Using user provided OfflineComponentProvider");try{await _d(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!HO(t))throw t;no("Error using user provided cache. Falling back to memory cache: "+t),await _d(n,new i_)}}else q("FirestoreClient","Using default OfflineComponentProvider"),await _d(n,new i_);return n._offlineComponents}async function op(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(q("FirestoreClient","Using user provided OnlineComponentProvider"),await s_(n,n._uninitializedComponentsProvider._online)):(q("FirestoreClient","Using default OnlineComponentProvider"),await s_(n,new LO))),n._onlineComponents}function qO(n){return op(n).then(e=>e.syncEngine)}function zO(n){return op(n).then(e=>e.datastore)}async function Zu(n){const e=await op(n),t=e.eventManager;return t.onListen=AO.bind(null,e.syncEngine),t.onUnlisten=bO.bind(null,e.syncEngine),t}function GO(n,e,t={}){const i=new Qn;return n.asyncQueue.enqueueAndForget(async()=>function(r,o,a,c,u){const l=new rp({next:f=>{o.enqueueAndForget(()=>tp(r,h));const m=f.docs.has(a);!m&&f.fromCache?u.reject(new z(S.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&c&&c.source==="server"?u.reject(new z(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new ip(lh(a.path),l,{includeMetadataChanges:!0,J_:!0});return ep(r,h)}(await Zu(n),n.asyncQueue,e,t,i)),i.promise}function YO(n,e,t={}){const i=new Qn;return n.asyncQueue.enqueueAndForget(async()=>function(r,o,a,c,u){const l=new rp({next:f=>{o.enqueueAndForget(()=>tp(r,h)),f.fromCache&&c.source==="server"?u.reject(new z(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new ip(a,l,{includeMetadataChanges:!0,J_:!0});return ep(r,h)}(await Zu(n),n.asyncQueue,e,t,i)),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $I(n,e,t){if(!t)throw new z(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JO(n,e,t,i){if(e===!0&&i===!0)throw new z(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function o_(n){if(!X.isDocumentKey(n))throw new z(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function a_(n){if(X.isDocumentKey(n))throw new z(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ap(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ee()}function Xn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new z(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ap(n);throw new z(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new z(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new z(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}JO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=HI((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new z(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new z(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new z(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,s){return i.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wh{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new c_({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new z(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new z(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new c_(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new mM;switch(i.type){case"firstParty":return new _M(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new z(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=r_.get(t);i&&(q("ComponentProvider","Removing Datastore"),r_.delete(t),i.terminate())}(this),Promise.resolve()}}function KO(n,e,t,i={}){var s;const r=(n=Xn(n,wh))._getSettings(),o=`${e}:${t}`;if(r.host!=="firestore.googleapis.com"&&r.host!==o&&no("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),i.mockUserToken){let a,c;if(typeof i.mockUserToken=="string")a=i.mockUserToken,c=Ft.MOCK_USER;else{a=gw(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new z(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ft(u)}n._authCredentials=new pM(new $E(a,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Lc(this.firestore,e,this._query)}}class on{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new as(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new on(this.firestore,e,this._key)}}class as extends Lc{constructor(e,t,i){super(e,t,lh(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new on(this.firestore,null,new X(e))}withConverter(e){return new as(this.firestore,e,this._path)}}function Mt(n,e,...t){if(n=Te(n),$I("collection","path",e),n instanceof wh){const i=Qe.fromString(e,...t);return a_(i),new as(n,null,i)}{if(!(n instanceof on||n instanceof as))throw new z(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Qe.fromString(e,...t));return a_(i),new as(n.firestore,null,i)}}function Xt(n,e,...t){if(n=Te(n),arguments.length===1&&(e=qE.newId()),$I("doc","path",e),n instanceof wh){const i=Qe.fromString(e,...t);return o_(i),new on(n,null,new X(i))}{if(!(n instanceof on||n instanceof as))throw new z(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Qe.fromString(e,...t));return o_(i),new on(n.firestore,n instanceof as?n.converter:null,new X(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QO{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Jm(this,"async_queue_retry"),this.iu=()=>{const t=yd();t&&q("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=yd();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=yd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new Qn;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!Rc(e))throw e;q("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(i=>{this.eu=i,this.tu=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Oi("INTERNAL UNHANDLED ERROR: ",s),i}).then(i=>(this.tu=!1,i))));return this.Ja=t,t}enqueueAfterDelay(e,t,i){this.su(),this.ru.indexOf(e)>-1&&(t=0);const s=Xm.createAndSchedule(this,e,t,i,r=>this.au(r));return this.Xa.push(s),s}su(){this.eu&&ee()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function u_(n){return function(t,i){if(typeof t!="object"||t===null)return!1;const s=t;for(const r of i)if(r in s&&typeof s[r]=="function")return!0;return!1}(n,["next","error","complete"])}class Zs extends wh{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=function(){return new QO}(),this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||qI(this),this._firestoreClient.terminate()}}function jO(n,e){const t=typeof n=="object"?n:Do(),i=typeof n=="string"?n:e||"(default)",s=Pl(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const r=fw("firestore");r&&KO(s,...r)}return s}function Mo(n){return n._firestoreClient||qI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function qI(n){var e,t,i;const s=n._freezeSettings(),r=function(a,c,u,l){return new SM(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,HI(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._firestoreClient=new WO(n._authCredentials,n._appCheckCredentials,n._queue,r),!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=s.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this._byteString=e}static fromBase64String(e){try{return new er(qt.fromBase64String(e))}catch(t){throw new z(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new er(qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ct(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return be(this._lat,e._lat)||be(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XO=/^__.*__$/;class ZO{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new xs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mc(e,this.data,t,this.fieldTransforms)}}class zI{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new xs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function GI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ee()}}class xh{constructor(e,t,i,s,r,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=s,r===void 0&&this.Pu(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new xh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Tu({path:i,du:!1});return s.Au(e),s}Ru(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Tu({path:i,du:!1});return s.Pu(),s}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return el(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(GI(this.Iu)&&XO.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class e2{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||yh(e)}pu(e,t,i,s=!1){return new xh({Iu:e,methodName:t,gu:i,path:Ct.emptyPath(),du:!1,fu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function YI(n){const e=n._freezeSettings(),t=yh(n._databaseId);return new e2(n._databaseId,!!e.ignoreUndefinedProperties,t)}function JI(n,e,t,i,s,r={}){const o=n.pu(r.merge||r.mergeFields?2:0,e,t,s);up("Data must be an object, but it was:",o,i);const a=XI(i,o);let c,u;if(r.merge)c=new ln(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const l=[];for(const h of r.mergeFields){const f=l0(e,h,t);if(!o.contains(f))throw new z(S.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);eT(l,f)||l.push(f)}c=new ln(l),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new ZO(new Yt(a),c,u)}class Uc extends Oo{_toFieldTransform(e){if(e.Iu!==2)throw e.Iu===1?e.mu(`${this._methodName}() can only appear at the top level of your update data`):e.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Uc}}function KI(n,e,t){return new xh({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class t2 extends Oo{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=KI(this,e,!0),i=this.yu.map(r=>Fo(r,t)),s=new oo(i);return new Wm(e.path,s)}isEqual(e){return this===e}}class n2 extends Oo{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=KI(this,e,!0),i=this.yu.map(r=>Fo(r,t)),s=new ao(i);return new Wm(e.path,s)}isEqual(e){return this===e}}class i2 extends Oo{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new ec(e.serializer,aI(e.serializer,this.wu));return new Wm(e.path,t)}isEqual(e){return this===e}}function QI(n,e,t,i){const s=n.pu(1,e,t);up("Data must be an object, but it was:",s,i);const r=[],o=Yt.empty();lr(i,(c,u)=>{const l=lp(e,c,t);u=Te(u);const h=s.Ru(l);if(u instanceof Uc)r.push(l);else{const f=Fo(u,h);f!=null&&(r.push(l),o.set(l,f))}});const a=new ln(r);return new zI(o,a,s.fieldTransforms)}function jI(n,e,t,i,s,r){const o=n.pu(1,e,t),a=[l0(e,i,t)],c=[s];if(r.length%2!=0)throw new z(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<r.length;f+=2)a.push(l0(e,r[f])),c.push(r[f+1]);const u=[],l=Yt.empty();for(let f=a.length-1;f>=0;--f)if(!eT(u,a[f])){const m=a[f];let p=c[f];p=Te(p);const y=o.Ru(m);if(p instanceof Uc)u.push(m);else{const g=Fo(p,y);g!=null&&(u.push(m),l.set(m,g))}}const h=new ln(u);return new zI(l,h,o.fieldTransforms)}function Fo(n,e){if(ZI(n=Te(n)))return up("Unsupported field value:",e,n),XI(n,e);if(n instanceof Oo)return function(i,s){if(!GI(s.Iu))throw s.mu(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.mu(`${i._methodName}() is not currently supported inside arrays`);const r=i._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(i,s){const r=[];let o=0;for(const a of i){let c=Fo(a,s.Vu(o));c==null&&(c={nullValue:"NULL_VALUE"}),r.push(c),o++}return{arrayValue:{values:r}}}(n,e)}return function(i,s){if((i=Te(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return aI(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const r=Le.fromDate(i);return{timestampValue:Qu(s.serializer,r)}}if(i instanceof Le){const r=new Le(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Qu(s.serializer,r)}}if(i instanceof cp)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof er)return{bytesValue:vI(s.serializer,i._byteString)};if(i instanceof on){const r=s.databaseId,o=i.firestore._databaseId;if(!o.isEqual(r))throw s.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:qm(i.firestore._databaseId||s.databaseId,i._key.path)}}throw s.mu(`Unsupported field value: ${ap(i)}`)}(n,e)}function XI(n,e){const t={};return zE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):lr(n,(i,s)=>{const r=Fo(s,e.Eu(i));r!=null&&(t[i]=r)}),{mapValue:{fields:t}}}function ZI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Le||n instanceof cp||n instanceof er||n instanceof on||n instanceof Oo)}function up(n,e,t){if(!ZI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const i=ap(t);throw i==="an object"?e.mu(n+" a custom object"):e.mu(n+" "+i)}}function l0(n,e,t){if((e=Te(e))instanceof Vc)return e._internalPath;if(typeof e=="string")return lp(n,e);throw el("Field path arguments must be of type string or ",n,!1,void 0,t)}const s2=new RegExp("[~\\*/\\[\\]]");function lp(n,e,t){if(e.search(s2)>=0)throw el(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Vc(...e.split("."))._internalPath}catch{throw el(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function el(n,e,t,i,s){const r=i&&!i.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new z(S.INVALID_ARGUMENT,a+n+c)}function eT(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(e,t,i,s,r){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new on(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new r2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(tT("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class r2 extends tl{data(){return super.data()}}function tT(n,e){return typeof e=="string"?lp(n,e):e instanceof Vc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new z(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class iT{convertValue(e,t="none"){switch(Xs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(js(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ee()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return lr(e,(s,r)=>{i[s]=this.convertValue(r,t)}),i}convertGeoPoint(e){return new cp(rt(e.latitude),rt(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Bm(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(ja(e));default:return null}}convertTimestamp(e){const t=fs(e);return new Le(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=Qe.fromString(e);ke(DI(i));const s=new Xa(i.get(1),i.get(3)),r=new X(i.popFirst(5));return s.isEqual(t)||Oi(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sT(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class o2 extends iT{constructor(e){super(),this.firestore=e}convertBytes(e){return new er(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new on(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hp extends tl{constructor(e,t,i,s,r,o){super(e,t,i,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Iu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(tT("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Iu extends hp{data(e={}){return super.data(e)}}class rT{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Nr(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Iu(this._firestore,this._userDataWriter,i.key,i,new Nr(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new Iu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Nr(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>r||a.type!==3).map(a=>{const c=new Iu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Nr(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:a2(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function a2(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ee()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l_(n){n=Xn(n,on);const e=Xn(n.firestore,Zs);return GO(Mo(e),n._key).then(t=>oT(e,n,t))}class Eh extends iT{constructor(e){super(),this.firestore=e}convertBytes(e){return new er(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new on(this.firestore,null,t)}}function h_(n){n=Xn(n,Lc);const e=Xn(n.firestore,Zs),t=Mo(e),i=new Eh(e);return nT(n._query),YO(t,n._query).then(s=>new rT(e,i,n,s))}function c2(n,...e){var t,i,s;n=Te(n);let r={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||u_(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(u_(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let c,u,l;if(n instanceof on)u=Xn(n.firestore,Zs),l=lh(n._key.path),c={next:h=>{e[o]&&e[o](oT(u,n,h))},error:e[o+1],complete:e[o+2]};else{const h=Xn(n,Lc);u=Xn(h.firestore,Zs),l=h._query;const f=new Eh(u);c={next:m=>{e[o]&&e[o](new rT(u,f,h,m))},error:e[o+1],complete:e[o+2]},nT(n._query)}return function(f,m,p,y){const g=new rp(y),x=new ip(m,g,p);return f.asyncQueue.enqueueAndForget(async()=>ep(await Zu(f),x)),()=>{g.Na(),f.asyncQueue.enqueueAndForget(async()=>tp(await Zu(f),x))}}(Mo(u),l,a,c)}function u2(n,e){return function(i,s){const r=new Qn;return i.asyncQueue.enqueueAndForget(async()=>kO(await qO(i),s,r)),r.promise}(Mo(n),e)}function oT(n,e,t){const i=t.docs.get(e._key),s=new Eh(n);return new hp(n,s,e._key,i,new Nr(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l2={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=YI(e)}set(e,t,i){this._verifyNotCommitted();const s=Qi(e,this._firestore),r=sT(s.converter,t,i),o=JI(this._dataReader,"WriteBatch.set",s._key,r,s.converter!==null,i);return this._mutations.push(o.toMutation(s._key,Lt.none())),this}update(e,t,i,...s){this._verifyNotCommitted();const r=Qi(e,this._firestore);let o;return o=typeof(t=Te(t))=="string"||t instanceof Vc?jI(this._dataReader,"WriteBatch.update",r._key,t,i,s):QI(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(o.toMutation(r._key,Lt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Qi(e,this._firestore);return this._mutations=this._mutations.concat(new ph(t._key,Lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new z(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Qi(n,e){if((n=Te(n)).firestore!==e)throw new z(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2 extends class{constructor(t,i){this._firestore=t,this._transaction=i,this._dataReader=YI(t)}get(t){const i=Qi(t,this._firestore),s=new o2(this._firestore);return this._transaction.lookup([i._key]).then(r=>{if(!r||r.length!==1)return ee();const o=r[0];if(o.isFoundDocument())return new tl(this._firestore,s,o.key,o,i.converter);if(o.isNoDocument())return new tl(this._firestore,s,i._key,null,i.converter);throw ee()})}set(t,i,s){const r=Qi(t,this._firestore),o=sT(r.converter,i,s),a=JI(this._dataReader,"Transaction.set",r._key,o,r.converter!==null,s);return this._transaction.set(r._key,a),this}update(t,i,s,...r){const o=Qi(t,this._firestore);let a;return a=typeof(i=Te(i))=="string"||i instanceof Vc?jI(this._dataReader,"Transaction.update",o._key,i,s,r):QI(this._dataReader,"Transaction.update",o._key,i),this._transaction.update(o._key,a),this}delete(t){const i=Qi(t,this._firestore);return this._transaction.delete(i._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Qi(e,this._firestore),i=new Eh(this._firestore);return super.get(e).then(s=>new hp(this._firestore,i,t._key,s._document,new Nr(!1,!1),t.converter))}}function f2(n,e,t){n=Xn(n,Zs);const i=Object.assign(Object.assign({},l2),t);return function(r){if(r.maxAttempts<1)throw new z(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(r,o,a){const c=new Qn;return r.asyncQueue.enqueueAndForget(async()=>{const u=await zO(r);new UO(r.asyncQueue,u,a,o,c).run()}),c.promise}(Mo(n),s=>e(new d2(n,s)),i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(){return new Uc("deleteField")}function m2(...n){return new t2("arrayUnion",n)}function p2(...n){return new n2("arrayRemove",n)}function hu(n){return new i2("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g2(n){return Mo(n=Xn(n,Zs)),new h2(n,e=>u2(n,e))}(function(e,t=!0){(function(s){Po=s})(ar),Ks(new hs("firestore",(i,{instanceIdentifier:s,options:r})=>{const o=i.getProvider("app").getImmediate(),a=new Zs(new gM(i.getProvider("auth-internal")),new wM(i.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new z(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xa(u.options.projectId,l)}(o,s),o);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),Kn(Sy,"4.4.0",e),Kn(Sy,"4.4.0","esm2017")})();var Hr=(n=>(n[n.Barber=0]="Barber",n[n.Polish=1]="Polish",n[n.Beautician=2]="Beautician",n[n.ManicurePedicure=3]="ManicurePedicure",n[n.Eyelashes=4]="Eyelashes",n[n.Eyebrows=5]="Eyebrows",n[n.Braids=6]="Braids",n[n.MakeUpArtist=7]="MakeUpArtist",n[n.TattooArtist=8]="TattooArtist",n[n.HairRemoval=9]="HairRemoval",n[n.Masseur=10]="Masseur",n[n.Physiotherapy=11]="Physiotherapy",n[n.Cobblers=12]="Cobblers",n[n.Clown=13]="Clown",n[n.SocialWorker=14]="SocialWorker",n[n.Magician=15]="Magician",n[n.Doctor=16]="Doctor",n[n.Veterinarian=17]="Veterinarian",n[n.CommunicationTherapist=18]="CommunicationTherapist",n[n.DogGroomer=19]="DogGroomer",n[n.DJ=20]="DJ",n[n.Psychologist=21]="Psychologist",n[n.Tutor=22]="Tutor",n[n.WeddingDresses=23]="WeddingDresses",n[n.DanceTeacher=24]="DanceTeacher",n[n.Babysitter=25]="Babysitter",n[n.Reflexologist=26]="Reflexologist",n[n.Dietitian=27]="Dietitian",n[n.CarWash=28]="CarWash",n[n.Photographer=29]="Photographer",n[n.SwimmingTeacher=30]="SwimmingTeacher",n[n.Counselor=31]="Counselor",n[n.Mentor=32]="Mentor",n[n.TennisCoach=33]="TennisCoach",n[n.PrivateChef=34]="PrivateChef",n[n.PersonalTrainer=35]="PersonalTrainer",n[n.Lawyer=36]="Lawyer",n[n.Sales=37]="Sales",n[n.RealEstate=38]="RealEstate",n[n.DrivingTeacher=39]="DrivingTeacher",n[n.InvestmentAdvice=40]="InvestmentAdvice",n[n.Library=41]="Library",n[n.Tailor=42]="Tailor",n[n.Restaurant=43]="Restaurant",n[n.NailConstruction=44]="NailConstruction",n[n.Dentist=45]="Dentist",n[n.BeautysSalon=46]="BeautysSalon",n[n.Washer=47]="Washer",n[n.CleaningSofas=48]="CleaningSofas",n[n.Other=49]="Other",n))(Hr||{});const y2={0:"barber",1:"polish",48:"cleaningSofas",2:"beautician",3:"manicurePedicure",4:"eyelashes",5:"eyebrows",25:"babysitter",6:"braids",7:"makeUpArtist",8:"tattooArtist",9:"hairRemoval",10:"masseur",12:"cobblers",13:"clown",14:"socialWorker",15:"magician",16:"doctor",20:"dj",17:"veterinarian",18:"communicationTherapist",19:"dogGroomer",21:"psychologist",11:"physiotherapy",22:"Tutor",23:"weddingDresses",24:"danceTeacher",26:"reflexologist",27:"dietitian",28:"carWash",29:"photographer",30:"swimmingTeacher",31:"counselor",32:"mentor",33:"tennisCoach",34:"privateChef",35:"personalTrainer",36:"lawyer",37:"sales",38:"realEstate",39:"drivingTeacher",40:"investmentAdvice",41:"library",49:"other",42:"tailor",43:"restaurant",44:"nailConstruction",45:"dentist",46:"beautysSalon",47:"washer"},aT={barber:0,cleaningSofas:48,polish:1,beautician:2,manicurePedicure:3,eyelashes:4,eyebrows:5,babysitter:25,braids:6,makeUpArtist:7,tattooArtist:8,hairRemoval:9,masseur:10,cobblers:12,clown:13,socialWorker:14,magician:15,doctor:16,veterinarian:17,communicationTherapist:18,dogGroomer:19,psychologist:21,physiotherapy:11,Tutor:22,weddingDresses:23,danceTeacher:24,reflexologist:26,dietitian:27,carWash:28,photographer:29,swimmingTeacher:30,counselor:31,mentor:32,dj:20,tennisCoach:33,privateChef:34,personalTrainer:35,lawyer:36,sales:37,realEstate:38,drivingTeacher:39,investmentAdvice:40,library:41,other:49,restaurant:43,tailor:42,nailConstruction:44,dentist:45,beautysSalon:46,washer:47};function D5(n){return n.length<20?gt.currentBusinesssId.startsWith(n.substring(1)):gt.currentBusinesssId.startsWith(n)}function A5(n){function e(u){return u<=.03928?u/12.92:Math.pow((u+.055)/1.055,2.4)}let t=n.toString(16),i=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),r=parseInt(t.slice(6,8),16);const o=e(i/255),a=e(s/255),c=e(r/255);return .2126*o+.7152*a+.0722*c}function _2(n,e=155){console.log(n);const t=n.toString(16),i=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),r=parseInt(t.slice(6,8),16),o=(i*299+s*587+r*114)/1e3;return console.log(o),o>e}function d_(n,e){if(n===null)return e===null;if(e===null||n.size!==e.size)return!1;if(n===e)return!0;for(const t of n)if(!e.has(t))return!1;return!0}async function C5(){return!0}var h0=(n=>(n[n.light=0]="light",n[n.dark=1]="dark",n))(h0||{});class wi{constructor({background:e=0,primary:t=0,surface:i=0,inverseSurface:s=0,tertiary:r=0,id:o,fontName:a="",themeName:c=""}){d(this,"background",0);d(this,"primary",0);d(this,"surface",0);d(this,"inverseSurface",0);d(this,"tertiary",0);d(this,"id","");d(this,"fontName","");d(this,"themeName","");this.background=e,this.primary=t,this.surface=i,this.inverseSurface=s,this.tertiary=r,this.id=o,this.fontName=a,this.themeName=c}static fromJson(e,t){return new wi({background:e.background||0,primary:e.primary||0,id:t,themeName:e.themeName||"",surface:e.surface||0,tertiary:e.tertiary||0,inverseSurface:e.inverseSurface||0,fontName:e.fontName||""})}static fromBusinessTheme(e){return new wi({themeName:e.themeName,background:e.background,primary:e.primary,tertiary:e.tertiary,id:e.id,surface:e.surface,inverseSurface:e.inverseSurface,fontName:e.fontName})}isEqual(e,t=!0){const i=e.toJson();t&&(i.id=e.id);const s=this.toJson();return t&&(s.id=this.id),JSON.stringify(i)===JSON.stringify(s)}get brightness(){return _2(this.background)?1:0}toJson(){const e={};return this.fontName!==""&&(e.fontName=this.fontName),this.surface!==0&&(e.surface=this.surface),this.inverseSurface!==0&&(e.inverseSurface=this.inverseSurface),e.tertiary=this.tertiary,e.themeName=this.themeName,this.background!==0&&(e.background=this.background),this.primary!==0&&(e.primary=this.primary),e}}var hi=(n=>(n[n.Grid=0]="Grid",n[n.Carousel=1]="Carousel",n[n.EndlessCarousel=2]="EndlessCarousel",n))(hi||{});const f_={0:"grid",1:"carousel",2:"endlessCarousel"},m_={grid:0,carousel:1,endlessCarousel:2},cT={dark:new wi({fontName:"Varela Round",themeName:"Original",id:"dark",inverseSurface:4279637532,background:4280229673,surface:4280690225,tertiary:4279834916,primary:4294940672}),darkIos:new wi({fontName:"Varela Round",themeName:"Dark",id:"darkIos",inverseSurface:4281084974,background:4279637528,surface:4280361252,tertiary:4278190080,primary:4278225100}),light:new wi({fontName:"Varela Round",themeName:"Pink",id:"light",inverseSurface:4294831859,background:4294375158,surface:4294967295,tertiary:4294243315,primary:4294936498}),lightIos:new wi({fontName:"Varela Round",themeName:"Light",id:"lightIos",inverseSurface:4292664541,background:4294111991,surface:4294967295,tertiary:4293322471,primary:4278221567})};class Be{constructor(e){d(this,"id","");d(this,"token","");e&&(this.id=e.I||"",this.token=e.T||"")}static fromShopIconUrl(e){const t=new Be;try{const i=e.split("SHOPICON");t.id=i[1].split("?alt")[0];const s=e.split("&token=");return t.token=s[1],t}catch{return new Be}}static fromJson(e){const t=new Be;return t.id=e.I||"",t.token=e.T||"",t}static fromJsonStr(e){const t=JSON.parse(e),i=new Be;return i.id=t.I||"",i.token=t.T||"",i}get isEmpty(){return this.token===""||this.id===""}get isNotEmpty(){return this.token!==""&&this.id!==""}isEqual(e){return e.id==this.id&&e.token==this.token}getShopIconPath(e){return this.token===""||this.id===""?"":`https://firebasestorage.googleapis.com/v0/b/managementsystemapp-c1fda.appspot.com/o/enviroments%2F${je.replace("enviroments/","")}%2F${e}%2Fimages%2Flogos%2FSHOPICON${this.id}?alt=media&token=${this.token}`}toJsonStr(){const e={I:this.id,T:this.token};return JSON.stringify(e)}toJson(){return{I:this.id,T:this.token}}}class Vt{constructor({amount:e,currency:t}){d(this,"amount",0);d(this,"currency",Ci);const i=parseFloat(e)||0;this.amount=parseFloat(i.toFixed(2)),this.currency=t}static fromJson(e){const t=new Vt({amount:"0.0",currency:gi.fromJson(e.currency)});return e.amount!=null&&(t.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),t}add(e){e.currency.code===this.currency.code&&(this.amount+=e.amount)}isEqual(e){return this.amount===e.amount&&this.currency.code===e.currency.code}toString(){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.currency.code}).format(this.amount).slice(0,-1)}toJson(){return{amount:this.amount,currency:this.currency.toJson()}}}let p_=class d0{constructor({name:e="",description:t="",id:i="",price:s,imageUrl:r=""}={}){d(this,"description","");d(this,"price");d(this,"imageUrl","");d(this,"id","");d(this,"name","");d(this,"createdAt",new Date);this.name=e||"",this.description=t||"",this.id=i||"",this.price=s,this.imageUrl=r||""}static fromProduct(e){const t=new d0({id:e.id,description:e.description,price:e.price,imageUrl:e.imageUrl,name:e.name});return t.createdAt=e.createdAt,t}static fromJson(e,t){const i=new d0({id:t,description:e.description,price:Vt.fromJson(e.price),imageUrl:e.imageUrl,name:e.name});return i.createdAt=e.createdAt,i}toJson(){return{description:this.description,price:this.price?this.price.toJson():null,imageUrl:this.imageUrl,name:this.name,createdAt:this.createdAt}}toString(){return JSON.stringify(this.toJson())}};class lo{constructor(e,t,i,s,r,o=!1){d(this,"title","");d(this,"content","");d(this,"lastModified","");d(this,"index","");d(this,"id","");d(this,"popOnEnter",!1);this.title=e,this.content=t,this.id=i,this.lastModified=s,this.index=r,this.popOnEnter=o}static fromJson(e,t){return new lo(e.title??"",e.content??"",e.id??"",e.lastModified??"",t,e.popOnEnter??!1)}static fromUpdate(e){return new lo(e.title,e.content,e.id,e.lastModified,e.index,e.popOnEnter)}toJson(){const e={};return e.title=this.title,e.id=this.id,e.content=this.content,this.lastModified!==""&&(e.lastModified=this.lastModified),this.popOnEnter&&(e.popOnEnter=this.popOnEnter),e}isValid(){return this.title!==""&&this.content!==""}toString(){return JSON.stringify(this,null,2)}}class xi{constructor({storyView:e=hi.Grid,productView:t=hi.Grid,changingImagesSwapSeconds:i=6,shopIconUrl:s="",pickedThemeKey:r="darkIos"}={}){d(this,"storyView",hi.Grid);d(this,"productView",hi.Grid);d(this,"changingImages",[]);d(this,"products",new Map);d(this,"updates",new Map);d(this,"storyTitle","");d(this,"shopIconUrl","");d(this,"productsTitle","");d(this,"bottomIcons",!1);d(this,"changingImagesSwapSeconds",6);d(this,"pickedThemeKey","darkIos");d(this,"lastTimeToUpdateTerm",new Date(0));d(this,"businessThemes",new Map);d(this,"term","");d(this,"mustConfirmTerm",!1);d(this,"popTermOnFirstEneter",!1);d(this,"isPrivateTheme",!1);this.changingImagesSwapSeconds=i,this.shopIconUrl=s,this.pickedThemeKey=r}static fromJson(e){const t=new xi;return Object.entries(e.products).forEach(([i,s])=>{t.products.set(i,p_.fromJson(s,i))}),e.changingImages&&(t.changingImages=e.changingImages.map(i=>i)),e.updates&&Object.entries(e.updates).forEach(([i,s])=>{t.updates.set(i,lo.fromJson(s,i))}),e.storyView&&(t.storyView=m_[e.storyView]||hi.EndlessCarousel),e.productView&&(t.productView=m_[e.productView]||hi.Grid),e.businessThemes&&Object.entries(e.businessThemes).forEach(([i,s])=>{t.businessThemes.set(i,wi.fromJson(s,i))}),e.lastTimeToUpdateTerm&&(t.lastTimeToUpdateTerm=ae(e.lastTimeToUpdateTerm)||new Date(0)),t.pickedThemeKey=e.pickedThemeKey||"darkIoss",t.term=e.term||"",t.bottomIcons=e.bottomIcons||!1,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds||6,t.productsTitle=e.productsTitle||"",t.storyTitle=e.storyTitle||"",t.shopIconUrl=e.shopIcon||"",t.mustConfirmTerm=e.mustConfirmTerm||!1,t.popTermOnFirstEneter=e.popTermOnFirstEneter||!1,t.isPrivateTheme=e.isPrivateTheme||!1,t}get shopIconData(){return Be.fromShopIconUrl(this.shopIconUrl)}static fromBusinessDesign(e){const t=new xi;return e.products.forEach((i,s)=>{t.products.set(s,p_.fromProduct(i))}),t.changingImages=[...e.changingImages],e.updates.forEach((i,s)=>{t.updates.set(s,lo.fromUpdate(i))}),t.storyView=e.storyView,e.businessThemes.forEach((i,s)=>{t.businessThemes.set(s,wi.fromBusinessTheme(i))}),t.shopIconUrl=e.shopIconUrl,t.pickedThemeKey=e.pickedThemeKey,t.lastTimeToUpdateTerm=e.lastTimeToUpdateTerm,t.changingImagesSwapSeconds=e.changingImagesSwapSeconds,t.term=e.term,t.bottomIcons=e.bottomIcons,t.productsTitle=e.productsTitle,t.productView=e.productView,t.storyTitle=e.storyTitle,t.mustConfirmTerm=e.mustConfirmTerm,t.popTermOnFirstEneter=e.popTermOnFirstEneter,t.isPrivateTheme=e.isPrivateTheme,t}toJson(){const e={};return this.storyView!==hi.EndlessCarousel&&(e.storyView=f_[this.storyView]),this.productView!==hi.Grid&&(e.productView=f_[this.storyView]),e.changingImages=this.changingImages,e.products={},this.products.forEach((t,i)=>{e.products[i]=t.toJson()}),e.updates={},this.updates.forEach((t,i)=>{e.updates[i]=t.toJson()}),this.mustConfirmTerm&&(e.mustConfirmTerm=this.mustConfirmTerm),this.popTermOnFirstEneter&&(e.popTermOnFirstEneter=this.popTermOnFirstEneter),this.term!==""&&(e.term=this.term),this.lastTimeToUpdateTerm!==new Date(0)&&(e.lastTimeToUpdateTerm=oe(this.lastTimeToUpdateTerm)),e.bottomIcons=this.bottomIcons,e.changingImagesSwapSeconds=this.changingImagesSwapSeconds,e.storyTitle=this.storyTitle,e.productsTitle=this.productsTitle,e.businessThemes={},this.businessThemes.forEach((t,i)=>{cT.hasOwnProperty(i)||(e.businessThemes[i]=t.toJson())}),e.pickedThemeKey=this.pickedThemeKey,e.shopIcon=this.shopIconUrl,e.isPrivateTheme=this.isPrivateTheme,e}}class ho{constructor({businessId:e="",businessName:t="",shopIcon:i=new Be}={}){d(this,"businessId","");d(this,"shopIcon",new Be);d(this,"businessName","");this.businessId=e,this.shopIcon=i,this.businessName=t}static empty(){return new ho}static fromJsonStr(e){const t=JSON.parse(e),i=ho.empty();return i.businessId=t.businessId,i.businessName=t.businessName,t.shopIcon&&(i.shopIcon=Be.fromJsonStr(t.shopIcon)),i}toJsonStr(){const e={businessId:this.businessId,shopIcon:this.shopIcon.toJsonStr(),businessName:this.businessName};return JSON.stringify(e)}}const v2={noPayNoPayment:0,noPayNoPaymentWithReceipts:1,pay100For30WithReceipts:2,pay70For700Actiions:3},b5=60,w2=15,x2=20;var g_={};const y_="@firebase/database",__="1.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uT="";function E2(n){uT=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ut(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Na(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T2{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ri(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new I2(e)}}catch{}return new T2},Ls=lT("localStorage"),f0=lT("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $r=new Sl("@firebase/database"),D2=function(){let n=1;return function(){return n++}}(),hT=function(n){const e=hA(n),t=new aA;t.update(e);const i=t.digest();return L0.encodeByteArray(i)},Wc=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Wc.apply(null,i):typeof i=="object"?e+=ut(i):e+=i,e+=" "}return e};let $s=null,v_=!0;const A2=function(n,e){L(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?($r.logLevel=ge.VERBOSE,$s=$r.log.bind($r),e&&f0.set("logging_enabled",!0)):typeof n=="function"?$s=n:($s=null,f0.remove("logging_enabled"))},At=function(...n){if(v_===!0&&(v_=!1,$s===null&&f0.get("logging_enabled")===!0&&A2(!0)),$s){const e=Wc.apply(null,n);$s(e)}},Hc=function(n){return function(...e){At(n,...e)}},m0=function(...n){const e="FIREBASE INTERNAL ERROR: "+Wc(...n);$r.error(e)},Bi=function(...n){const e=`FIREBASE FATAL ERROR: ${Wc(...n)}`;throw $r.error(e),new Error(e)},Qt=function(...n){const e="FIREBASE WARNING: "+Wc(...n);$r.warn(e)},C2=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Qt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},dp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},b2=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},fo="[MIN_NAME]",tr="[MAX_NAME]",dr=function(n,e){if(n===e)return 0;if(n===fo||e===tr)return-1;if(e===fo||n===tr)return 1;{const t=w_(n),i=w_(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},k2=function(n,e){return n===e?0:n<e?-1:1},ta=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ut(e))},fp=function(n){if(typeof n!="object"||n===null)return ut(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=ut(e[i]),t+=":",t+=fp(n[e[i]]);return t+="}",t},dT=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function Rt(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const fT=function(n){L(!dp(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,r,o,a,c;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));const u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(s?1:0),u.reverse();const l=u.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(l.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},S2=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},P2=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function R2(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const N2=new RegExp("^-?(0*)\\d{1,10}$"),M2=-2147483648,O2=2147483647,w_=function(n){if(N2.test(n)){const e=Number(n);if(e>=M2&&e<=O2)return e}return null},Bo=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Qt("Exception was thrown by user callback.",t),e},Math.floor(0))}},F2=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},xa=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){Qt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(At("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Qt(e)}}class qr{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}qr.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp="5",mT="v",pT="s",gT="r",yT="f",_T=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,vT="ls",wT="p",p0="ac",xT="websocket",ET="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(e,t,i,s,r=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ls.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ls.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function V2(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function TT(n,e,t){L(typeof e=="string","typeof type must == string"),L(typeof t=="object","typeof params must == object");let i;if(e===xT)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===ET)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);V2(n)&&(t.ns=n.namespace);const s=[];return Rt(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U2{constructor(){this.counters_={}}incrementCounter(e,t=1){ri(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return GD(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd={},xd={};function pp(n){const e=n.toString();return wd[e]||(wd[e]=new U2),wd[e]}function W2(n,e){const t=n.toString();return xd[t]||(xd[t]=e()),xd[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Bo(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_="start",$2="close",q2="pLPCommand",z2="pRTLPCB",DT="id",AT="pw",CT="ser",G2="cb",Y2="seg",J2="ts",K2="d",Q2="dframe",bT=1870,kT=30,j2=bT-kT,X2=25e3,Z2=3e4;class Mr{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Hc(e),this.stats_=pp(t),this.urlFn=c=>(this.appCheckToken&&(c[p0]=this.appCheckToken),TT(t,ET,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new H2(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Z2)),b2(()=>{if(this.isClosed_)return;this.scriptTagHolder=new gp((...r)=>{const[o,a,c,u,l]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===x_)this.id=a,this.password=c;else if(o===$2)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[x_]="t",i[CT]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[G2]=this.scriptTagHolder.uniqueCallbackIdentifier),i[mT]=mp,this.transportSessionId&&(i[pT]=this.transportSessionId),this.lastSessionId&&(i[vT]=this.lastSessionId),this.applicationId&&(i[wT]=this.applicationId),this.appCheckToken&&(i[p0]=this.appCheckToken),typeof location<"u"&&location.hostname&&_T.test(location.hostname)&&(i[gT]=yT);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Mr.forceAllow_=!0}static forceDisallow(){Mr.forceDisallow_=!0}static isAvailable(){return Mr.forceAllow_?!0:!Mr.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!S2()&&!P2()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ut(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=lw(t),s=dT(i,j2);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[Q2]="t",i[DT]=e,i[AT]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ut(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class gp{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=D2(),window[q2+this.uniqueCallbackIdentifier]=e,window[z2+this.uniqueCallbackIdentifier]=t,this.myIFrame=gp.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){At("frame writing exception"),a.stack&&At(a.stack),At(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||At("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[DT]=this.myID,e[AT]=this.myPW,e[CT]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+kT+i.length<=bT;){const o=this.pendingSegs.shift();i=i+"&"+Y2+s+"="+o.seg+"&"+J2+s+"="+o.ts+"&"+K2+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(X2)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{At("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eF=16384,tF=45e3;let nl=null;typeof MozWebSocket<"u"?nl=MozWebSocket:typeof WebSocket<"u"&&(nl=WebSocket);class Pn{constructor(e,t,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Hc(this.connId),this.stats_=pp(t),this.connURL=Pn.connectionURL_(t,o,a,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,r){const o={};return o[mT]=mp,typeof location<"u"&&location.hostname&&_T.test(location.hostname)&&(o[gT]=yT),t&&(o[pT]=t),i&&(o[vT]=i),s&&(o[p0]=s),r&&(o[wT]=r),TT(e,xT,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ls.set("previous_websocket_failure",!0);try{let i;_w(),this.mySock=new nl(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Pn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&nl!==null&&!Pn.forceDisallow_}static previouslyFailed(){return Ls.isInMemoryStorage||Ls.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ls.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=Na(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(L(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=ut(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=dT(t,eF);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(tF))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Pn.responsesRequiredToBeHealthy=2;Pn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Mr,Pn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Pn&&Pn.isAvailable();let i=t&&!Pn.previouslyFailed();if(e.webSocketOnly&&(t||Qt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Pn];else{const s=this.transports_=[];for(const r of nc.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);nc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}nc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nF=6e4,iF=5e3,sF=10*1024,rF=100*1024,Ed="t",E_="d",oF="s",I_="r",aF="e",T_="o",D_="a",A_="n",C_="p",cF="h";class uF{constructor(e,t,i,s,r,o,a,c,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Hc("c:"+this.id+":"),this.transportManager_=new nc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=xa(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>rF?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>sF?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ed in e){const t=e[Ed];t===D_?this.upgradeIfSecondaryHealthy_():t===I_?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===T_&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ta("t",e),i=ta("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:C_,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:D_,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:A_,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ta("t",e),i=ta("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ta(Ed,e);if(E_ in e){const i=e[E_];if(t===cF){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===A_){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===oF?this.onConnectionShutdown_(i):t===I_?this.onReset_(i):t===aF?m0("Server Error: "+i):t===T_?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):m0("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),mp!==i&&Qt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),xa(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(nF))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xa(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(iF))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:C_,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ls.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PT{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il extends PT{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!U0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new il}getInitialEvent(e){return L(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b_=32,k_=768;class Oe{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function De(){return new Oe("")}function fe(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ps(n){return n.pieces_.length-n.pieceNum_}function He(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Oe(n.pieces_,e)}function yp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function lF(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function ic(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function RT(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Oe(e,0)}function Ze(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof Oe)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new Oe(t,0)}function pe(n){return n.pieceNum_>=n.pieces_.length}function Kt(n,e){const t=fe(n),i=fe(e);if(t===null)return e;if(t===i)return Kt(He(n),He(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function hF(n,e){const t=ic(n,0),i=ic(e,0);for(let s=0;s<t.length&&s<i.length;s++){const r=dr(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function _p(n,e){if(ps(n)!==ps(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function En(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(ps(n)>ps(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class dF{constructor(e,t){this.errorPrefix_=t,this.parts_=ic(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=kl(this.parts_[i]);NT(this)}}function fF(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=kl(e),NT(n)}function mF(n){const e=n.parts_.pop();n.byteLength_-=kl(e),n.parts_.length>0&&(n.byteLength_-=1)}function NT(n){if(n.byteLength_>k_)throw new Error(n.errorPrefix_+"has a key path longer than "+k_+" bytes ("+n.byteLength_+").");if(n.parts_.length>b_)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+b_+") or object contains a cycle "+ks(n))}function ks(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp extends PT{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new vp}getInitialEvent(e){return L(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na=1e3,pF=60*5*1e3,S_=30*1e3,gF=1.3,yF=3e4,_F="server_kill",P_=3;class Si extends ST{constructor(e,t,i,s,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Si.nextPersistentConnectionId_++,this.log_=Hc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=na,this.maxReconnectDelay_=pF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!_w())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");vp.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&il.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(ut(r)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new gc,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),L(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const c=a.d,u=a.s;Si.warnOnListenWarnings_(c,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&ri(e,"w")){const i=Zr(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();Qt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||oA(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=S_)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=rA(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),L(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,r){this.initConnection_();const o={p:t,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ut(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):m0("Unrecognized action received from server: "+ut(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=na,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=na,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>yF&&(this.reconnectDelay_=na),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*gF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Si.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},u=function(h){L(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:u};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?At("getToken() completed but was canceled"):(At("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,a=new uF(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,m=>{Qt(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(_F)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Qt(h),c())}}}interrupt(e){At("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){At("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Tf(this.interruptReasons_)&&(this.reconnectDelay_=na,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(r=>fp(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new Oe(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(t),r.delete(t),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){At("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=P_&&(this.reconnectDelay_=S_,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){At("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=P_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+uT.replace(/\./g,"-")]=1,U0()?e["framework.cordova"]=1:yw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=il.getInstance().currentlyOnline();return Tf(this.interruptReasons_)&&e}}Si.nextPersistentConnectionId_=0;Si.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new me(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new me(fo,e),s=new me(fo,t);return this.compare(i,s)!==0}minPost(){return me.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du;class MT extends Ih{static get __EMPTY_NODE(){return du}static set __EMPTY_NODE(e){du=e}compare(e,t){return dr(e.name,t.name)}isDefinedOn(e){throw To("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return me.MIN}maxPost(){return new me(tr,du)}makePost(e,t){return L(typeof e=="string","KeyIndex indexValue must always be a string."),new me(e,du)}toString(){return".key"}}const zr=new MT;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class pt{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i??pt.RED,this.left=s??rn.EMPTY_NODE,this.right=r??rn.EMPTY_NODE}copy(e,t,i,s,r){return new pt(e??this.key,t??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return rn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return rn.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}pt.RED=!0;pt.BLACK=!1;class vF{copy(e,t,i,s,r){return this}insert(e,t,i){return new pt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class rn{constructor(e,t=rn.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new rn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,pt.BLACK,null,null))}remove(e){return new rn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,pt.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fu(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fu(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fu(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fu(this.root_,null,this.comparator_,!0,e)}}rn.EMPTY_NODE=new vF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wF(n,e){return dr(n.name,e.name)}function wp(n,e){return dr(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g0;function xF(n){g0=n}const OT=function(n){return typeof n=="number"?"number:"+fT(n):"string:"+n},FT=function(n){if(n.isLeafNode()){const e=n.val();L(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ri(e,".sv"),"Priority must be a string or number.")}else L(n===g0||n.isEmpty(),"priority of unexpected type.");L(n===g0||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let R_;class ft{constructor(e,t=ft.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,L(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),FT(this.priorityNode_)}static set __childrenNodeConstructor(e){R_=e}static get __childrenNodeConstructor(){return R_}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ft(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ft.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return pe(e)?this:fe(e)===".priority"?this.priorityNode_:ft.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:ft.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=fe(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(L(i!==".priority"||ps(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,ft.__childrenNodeConstructor.EMPTY_NODE.updateChild(He(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+OT(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=fT(this.value_):e+=this.value_,this.lazyHash_=hT(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ft.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ft.__childrenNodeConstructor?-1:(L(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=ft.VALUE_TYPE_ORDER.indexOf(t),r=ft.VALUE_TYPE_ORDER.indexOf(i);return L(s>=0,"Unknown leaf type: "+t),L(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}ft.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BT,LT;function EF(n){BT=n}function IF(n){LT=n}class TF extends Ih{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?dr(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return me.MIN}maxPost(){return new me(tr,new ft("[PRIORITY-POST]",LT))}makePost(e,t){const i=BT(e);return new me(t,new ft("[PRIORITY-POST]",i))}toString(){return".priority"}}const et=new TF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DF=Math.log(2);class AF{constructor(e){const t=r=>parseInt(Math.log(r)/DF,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const sl=function(n,e,t,i){n.sort(e);const s=function(c,u){const l=u-c;let h,f;if(l===0)return null;if(l===1)return h=n[c],f=t?t(h):h,new pt(f,h.node,pt.BLACK,null,null);{const m=parseInt(l/2,10)+c,p=s(c,m),y=s(m+1,u);return h=n[m],f=t?t(h):h,new pt(f,h.node,pt.BLACK,p,y)}},r=function(c){let u=null,l=null,h=n.length;const f=function(p,y){const g=h-p,x=h;h-=p;const _=s(g+1,x),v=n[g],w=t?t(v):v;m(new pt(w,v.node,y,null,_))},m=function(p){u?(u.left=p,u=p):(l=p,u=p)};for(let p=0;p<c.count;++p){const y=c.nextBitIsOne(),g=Math.pow(2,c.count-(p+1));y?f(g,pt.BLACK):(f(g,pt.BLACK),f(g,pt.RED))}return l},o=new AF(n.length),a=r(o);return new rn(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Id;const Tr={};class Ei{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return L(Tr&&et,"ChildrenNode.ts has not been loaded"),Id=Id||new Ei({".priority":Tr},{".priority":et}),Id}get(e){const t=Zr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof rn?t:null}hasIndex(e){return ri(this.indexSet_,e.toString())}addIndex(e,t){L(e!==zr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(me.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=sl(i,e.getCompare()):a=Tr;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const l=Object.assign({},this.indexes_);return l[c]=a,new Ei(l,u)}addToIndexes(e,t){const i=Su(this.indexes_,(s,r)=>{const o=Zr(this.indexSet_,r);if(L(o,"Missing index implementation for "+r),s===Tr)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(me.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),sl(a,o.getCompare())}else return Tr;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new me(e.name,a))),c.insert(e,e.node)}});return new Ei(i,this.indexSet_)}removeFromIndexes(e,t){const i=Su(this.indexes_,s=>{if(s===Tr)return s;{const r=t.get(e.name);return r?s.remove(new me(e.name,r)):s}});return new Ei(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ia;class te{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&FT(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ia||(ia=new te(new rn(wp),null,Ei.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ia}updatePriority(e){return this.children_.isEmpty()?this:new te(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ia:t}}getChild(e){const t=fe(e);return t===null?this:this.getImmediateChild(t).getChild(He(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(L(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new me(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?ia:this.priorityNode_;return new te(s,o,r)}}updateChild(e,t){const i=fe(e);if(i===null)return t;{L(fe(e)!==".priority"||ps(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(He(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,r=!0;if(this.forEachChild(et,(o,a)=>{t[o]=a.val(e),i++,r&&te.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+OT(this.getPriority().val())+":"),this.forEachChild(et,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":hT(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new me(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new me(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new me(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,me.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,me.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===$c?-1:0}withIndex(e){if(e===zr||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new te(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===zr||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(et),s=t.getIterator(et);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===zr?null:this.indexMap_.get(e.toString())}}te.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class CF extends te{constructor(){super(new rn(wp),te.EMPTY_NODE,Ei.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return te.EMPTY_NODE}isEmpty(){return!1}}const $c=new CF;Object.defineProperties(me,{MIN:{value:new me(fo,te.EMPTY_NODE)},MAX:{value:new me(tr,$c)}});MT.__EMPTY_NODE=te.EMPTY_NODE;ft.__childrenNodeConstructor=te;xF($c);IF($c);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bF=!0;function ct(n,e=null){if(n===null)return te.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),L(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new ft(t,ct(e))}if(!(n instanceof Array)&&bF){const t=[];let i=!1;if(Rt(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=ct(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new me(o,c)))}}),t.length===0)return te.EMPTY_NODE;const r=sl(t,wF,o=>o.name,wp);if(i){const o=sl(t,et.getCompare());return new te(r,ct(e),new Ei({".priority":o},{".priority":et}))}else return new te(r,ct(e),Ei.Default)}else{let t=te.EMPTY_NODE;return Rt(n,(i,s)=>{if(ri(n,i)&&i.substring(0,1)!=="."){const r=ct(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(ct(e))}}EF(ct);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF extends Ih{constructor(e){super(),this.indexPath_=e,L(!pe(e)&&fe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?dr(e.name,t.name):r}makePost(e,t){const i=ct(e),s=te.EMPTY_NODE.updateChild(this.indexPath_,i);return new me(t,s)}maxPost(){const e=te.EMPTY_NODE.updateChild(this.indexPath_,$c);return new me(tr,e)}toString(){return ic(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SF extends Ih{compare(e,t){const i=e.node.compareTo(t.node);return i===0?dr(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return me.MIN}maxPost(){return me.MAX}makePost(e,t){const i=ct(e);return new me(t,i)}toString(){return".value"}}const PF=new SF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VT(n){return{type:"value",snapshotNode:n}}function mo(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function sc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function rc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function RF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(sc(t,a)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(mo(t,i)):o.trackChildChange(rc(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(et,(s,r)=>{t.hasChild(s)||i.trackChildChange(sc(s,r))}),t.isLeafNode()||t.forEachChild(et,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(rc(s,r,o))}else i.trackChildChange(mo(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?te.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e){this.indexedFilter_=new xp(e.getIndex()),this.index_=e.getIndex(),this.startPost_=oc.getStartPost_(e),this.endPost_=oc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new me(t,i))||(i=te.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=te.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(te.EMPTY_NODE);const r=this;return t.forEachChild(et,(o,a)=>{r.matches(new me(o,a))||(s=s.updateImmediateChild(o,te.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new oc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new me(t,i))||(i=te.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=te.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=te.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(te.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,te.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,m)=>h(m,f)}else o=this.index_.getCompare();const a=e;L(a.numChildren()===this.limit_,"");const c=new me(t,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(a.hasChild(t)){const h=a.getImmediateChild(t);let f=s.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===t||a.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,c);if(l&&!i.isEmpty()&&m>=0)return r!=null&&r.trackChildChange(rc(t,i,h)),a.updateImmediateChild(t,i);{r!=null&&r.trackChildChange(sc(t,h));const y=a.updateImmediateChild(t,te.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r!=null&&r.trackChildChange(mo(f.name,f.node)),y.updateImmediateChild(f.name,f.node)):y}}else return i.isEmpty()?e:l&&o(u,c)>=0?(r!=null&&(r.trackChildChange(sc(u.name,u.node)),r.trackChildChange(mo(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(u.name,te.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ep{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=et}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return L(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fo}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return L(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:tr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===et}copy(){const e=new Ep;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function MF(n){return n.loadsAllData()?new xp(n.getIndex()):n.hasLimit()?new NF(n):new oc(n)}function N_(n){const e={};if(n.isDefault())return e;let t;if(n.index_===et?t="$priority":n.index_===PF?t="$value":n.index_===zr?t="$key":(L(n.index_ instanceof kF,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ut(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=ut(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+ut(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=ut(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+ut(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function M_(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==et&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl extends ST{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Hc("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=rl.getListenId_(e,i),a={};this.listens_[o]=a;const c=N_(e._queryParams);this.restRequest_(r+".json",c,(u,l)=>{let h=l;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(r,h,!1,i),Zr(this.listens_,o)===a){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",s(f,null)}})}unlisten(e,t){const i=rl.getListenId_(e,t);delete this.listens_[i]}get(e){const t=N_(e._queryParams),i=e._path.toString(),s=new gc;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+or(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Na(a.responseText)}catch{Qt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&Qt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(){this.rootNode_=te.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(){return{value:null,children:new Map}}function UT(n,e,t){if(pe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=fe(e);n.children.has(i)||n.children.set(i,ol());const s=n.children.get(i);e=He(e),UT(s,e,t)}}function y0(n,e,t){n.value!==null?t(e,n.value):FF(n,(i,s)=>{const r=new Oe(e.toString()+"/"+i);y0(s,r,t)})}function FF(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Rt(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O_=10*1e3,LF=30*1e3,VF=5*60*1e3;class UF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new BF(e);const i=O_+(LF-O_)*Math.random();xa(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;Rt(e,(s,r)=>{r>0&&ri(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),xa(this.reportStats_.bind(this),Math.floor(Math.random()*2*VF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mn;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Mn||(Mn={}));function Ip(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Tp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Dp(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Mn.ACK_USER_WRITE,this.source=Ip()}operationForChild(e){if(pe(this.path)){if(this.affectedTree.value!=null)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Oe(e));return new al(De(),t,this.revert)}}else return L(fe(this.path)===e,"operationForChild called for unrelated child."),new al(He(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e,t){this.source=e,this.path=t,this.type=Mn.LISTEN_COMPLETE}operationForChild(e){return pe(this.path)?new ac(this.source,De()):new ac(this.source,He(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Mn.OVERWRITE}operationForChild(e){return pe(this.path)?new nr(this.source,De(),this.snap.getImmediateChild(e)):new nr(this.source,He(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Mn.MERGE}operationForChild(e){if(pe(this.path)){const t=this.children.subtree(new Oe(e));return t.isEmpty()?null:t.value?new nr(this.source,De(),t.value):new po(this.source,De(),t)}else return L(fe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new po(this.source,He(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(pe(e))return this.isFullyInitialized()&&!this.filtered_;const t=fe(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function HF(n,e,t,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(RF(o.childName,o.snapshotNode))}),sa(n,s,"child_removed",e,i,t),sa(n,s,"child_added",e,i,t),sa(n,s,"child_moved",r,i,t),sa(n,s,"child_changed",e,i,t),sa(n,s,"value",e,i,t),s}function sa(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,c)=>qF(n,a,c)),o.forEach(a=>{const c=$F(n,a,r);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function $F(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function qF(n,e,t){if(e.childName==null||t.childName==null)throw To("Should only compare child_ events.");const i=new me(e.childName,e.snapshotNode),s=new me(t.childName,t.snapshotNode);return n.index_.compare(i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(n,e){return{eventCache:n,serverCache:e}}function Ea(n,e,t,i){return Th(new gs(e,t,i),n.serverCache)}function WT(n,e,t,i){return Th(n.eventCache,new gs(e,t,i))}function cl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ir(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Td;const zF=()=>(Td||(Td=new rn(k2)),Td);class We{constructor(e,t=zF()){this.value=e,this.children=t}static fromObject(e){let t=new We(null);return Rt(e,(i,s)=>{t=t.set(new Oe(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:De(),value:this.value};if(pe(e))return null;{const i=fe(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(He(e),t);return r!=null?{path:Ze(new Oe(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(pe(e))return this;{const t=fe(e),i=this.children.get(t);return i!==null?i.subtree(He(e)):new We(null)}}set(e,t){if(pe(e))return new We(t,this.children);{const i=fe(e),r=(this.children.get(i)||new We(null)).set(He(e),t),o=this.children.insert(i,r);return new We(this.value,o)}}remove(e){if(pe(e))return this.children.isEmpty()?new We(null):new We(null,this.children);{const t=fe(e),i=this.children.get(t);if(i){const s=i.remove(He(e));let r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new We(null):new We(this.value,r)}else return this}}get(e){if(pe(e))return this.value;{const t=fe(e),i=this.children.get(t);return i?i.get(He(e)):null}}setTree(e,t){if(pe(e))return t;{const i=fe(e),r=(this.children.get(i)||new We(null)).setTree(He(e),t);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new We(this.value,o)}}fold(e){return this.fold_(De(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(Ze(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,De(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(pe(e))return null;{const r=fe(e),o=this.children.get(r);return o?o.findOnPath_(He(e),Ze(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,De(),t)}foreachOnPath_(e,t,i){if(pe(e))return this;{this.value&&i(t,this.value);const s=fe(e),r=this.children.get(s);return r?r.foreachOnPath_(He(e),Ze(t,s),i):new We(null)}}foreach(e){this.foreach_(De(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(Ze(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.writeTree_=e}static empty(){return new Fn(new We(null))}}function Ia(n,e,t){if(pe(e))return new Fn(new We(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=Kt(s,e);return r=r.updateChild(o,t),new Fn(n.writeTree_.set(s,r))}else{const s=new We(t),r=n.writeTree_.setTree(e,s);return new Fn(r)}}}function _0(n,e,t){let i=n;return Rt(t,(s,r)=>{i=Ia(i,Ze(e,s),r)}),i}function F_(n,e){if(pe(e))return Fn.empty();{const t=n.writeTree_.setTree(e,new We(null));return new Fn(t)}}function v0(n,e){return fr(n,e)!=null}function fr(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Kt(t.path,e)):null}function B_(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(et,(i,s)=>{e.push(new me(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new me(i,s.value))}),e}function cs(n,e){if(pe(e))return n;{const t=fr(n,e);return t!=null?new Fn(new We(t)):new Fn(n.writeTree_.subtree(e))}}function w0(n){return n.writeTree_.isEmpty()}function go(n,e){return HT(De(),n.writeTree_,e)}function HT(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(L(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=HT(Ze(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(Ze(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dh(n,e){return GT(e,n)}function GF(n,e,t,i,s){L(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=Ia(n.visibleWrites,e,t)),n.lastWriteId=i}function YF(n,e,t,i){L(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=_0(n.visibleWrites,e,t),n.lastWriteId=i}function JF(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function KF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);L(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&QF(a,i.path)?s=!1:En(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return jF(n),!0;if(i.snap)n.visibleWrites=F_(n.visibleWrites,i.path);else{const a=i.children;Rt(a,c=>{n.visibleWrites=F_(n.visibleWrites,Ze(i.path,c))})}return!0}else return!1}function QF(n,e){if(n.snap)return En(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&En(Ze(n.path,t),e))return!0;return!1}function jF(n){n.visibleWrites=$T(n.allWrites,XF,De()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function XF(n){return n.visible}function $T(n,e,t){let i=Fn.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)En(t,o)?(a=Kt(t,o),i=Ia(i,a,r.snap)):En(o,t)&&(a=Kt(o,t),i=Ia(i,De(),r.snap.getChild(a)));else if(r.children){if(En(t,o))a=Kt(t,o),i=_0(i,a,r.children);else if(En(o,t))if(a=Kt(o,t),pe(a))i=_0(i,De(),r.children);else{const c=Zr(r.children,fe(a));if(c){const u=c.getChild(He(a));i=Ia(i,De(),u)}}}else throw To("WriteRecord should have .snap or .children")}}return i}function qT(n,e,t,i,s){if(!i&&!s){const r=fr(n.visibleWrites,e);if(r!=null)return r;{const o=cs(n.visibleWrites,e);if(w0(o))return t;if(t==null&&!v0(o,De()))return null;{const a=t||te.EMPTY_NODE;return go(o,a)}}}else{const r=cs(n.visibleWrites,e);if(!s&&w0(r))return t;if(!s&&t==null&&!v0(r,De()))return null;{const o=function(u){return(u.visible||s)&&(!i||!~i.indexOf(u.writeId))&&(En(u.path,e)||En(e,u.path))},a=$T(n.allWrites,o,e),c=t||te.EMPTY_NODE;return go(a,c)}}}function ZF(n,e,t){let i=te.EMPTY_NODE;const s=fr(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(et,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=cs(n.visibleWrites,e);return t.forEachChild(et,(o,a)=>{const c=go(cs(r,new Oe(o)),a);i=i.updateImmediateChild(o,c)}),B_(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=cs(n.visibleWrites,e);return B_(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function eB(n,e,t,i,s){L(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=Ze(e,t);if(v0(n.visibleWrites,r))return null;{const o=cs(n.visibleWrites,r);return w0(o)?s.getChild(t):go(o,s.getChild(t))}}function tB(n,e,t,i){const s=Ze(e,t),r=fr(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){const o=cs(n.visibleWrites,s);return go(o,i.getNode().getImmediateChild(t))}else return null}function nB(n,e){return fr(n.visibleWrites,e)}function iB(n,e,t,i,s,r,o){let a;const c=cs(n.visibleWrites,e),u=fr(c,De());if(u!=null)a=u;else if(t!=null)a=go(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const l=[],h=o.getCompare(),f=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let m=f.getNext();for(;m&&l.length<s;)h(m,i)!==0&&l.push(m),m=f.getNext();return l}else return[]}function sB(){return{visibleWrites:Fn.empty(),allWrites:[],lastWriteId:-1}}function ul(n,e,t,i){return qT(n.writeTree,n.treePath,e,t,i)}function Ap(n,e){return ZF(n.writeTree,n.treePath,e)}function L_(n,e,t,i){return eB(n.writeTree,n.treePath,e,t,i)}function ll(n,e){return nB(n.writeTree,Ze(n.treePath,e))}function rB(n,e,t,i,s,r){return iB(n.writeTree,n.treePath,e,t,i,s,r)}function Cp(n,e,t){return tB(n.writeTree,n.treePath,e,t)}function zT(n,e){return GT(Ze(n.treePath,e),n.writeTree)}function GT(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oB{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;L(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),L(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,rc(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,sc(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,mo(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,rc(i,e.snapshotNode,s.oldSnap));else throw To("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aB{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const YT=new aB;class bp{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new gs(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Cp(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ir(this.viewCache_),r=rB(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cB(n){return{filter:n}}function uB(n,e){L(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),L(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function lB(n,e,t,i,s){const r=new oB;let o,a;if(t.type===Mn.OVERWRITE){const u=t;u.source.fromUser?o=x0(n,e,u.path,u.snap,i,s,r):(L(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!pe(u.path),o=hl(n,e,u.path,u.snap,i,s,a,r))}else if(t.type===Mn.MERGE){const u=t;u.source.fromUser?o=dB(n,e,u.path,u.children,i,s,r):(L(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=E0(n,e,u.path,u.children,i,s,a,r))}else if(t.type===Mn.ACK_USER_WRITE){const u=t;u.revert?o=pB(n,e,u.path,i,s,r):o=fB(n,e,u.path,u.affectedTree,i,s,r)}else if(t.type===Mn.LISTEN_COMPLETE)o=mB(n,e,t.path,i,r);else throw To("Unknown operation type: "+t.type);const c=r.getChanges();return hB(e,o,c),{viewCache:o,changes:c}}function hB(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=cl(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(VT(cl(e)))}}function JT(n,e,t,i,s,r){const o=e.eventCache;if(ll(i,t)!=null)return e;{let a,c;if(pe(t))if(L(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=ir(e),l=u instanceof te?u:te.EMPTY_NODE,h=Ap(i,l);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const u=ul(i,ir(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const u=fe(t);if(u===".priority"){L(ps(t)===1,"Can't have a priority with additional path components");const l=o.getNode();c=e.serverCache.getNode();const h=L_(i,t,l,c);h!=null?a=n.filter.updatePriority(l,h):a=o.getNode()}else{const l=He(t);let h;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const f=L_(i,t,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(u).updateChild(l,f):h=o.getNode().getImmediateChild(u)}else h=Cp(i,u,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),u,h,l,s,r):a=o.getNode()}}return Ea(e,a,o.isFullyInitialized()||pe(t),n.filter.filtersNodes())}}function hl(n,e,t,i,s,r,o,a){const c=e.serverCache;let u;const l=o?n.filter:n.filter.getIndexedFilter();if(pe(t))u=l.updateFullNode(c.getNode(),i,null);else if(l.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(t,i);u=l.updateFullNode(c.getNode(),m,null)}else{const m=fe(t);if(!c.isCompleteForPath(t)&&ps(t)>1)return e;const p=He(t),g=c.getNode().getImmediateChild(m).updateChild(p,i);m===".priority"?u=l.updatePriority(c.getNode(),g):u=l.updateChild(c.getNode(),m,g,p,YT,null)}const h=WT(e,u,c.isFullyInitialized()||pe(t),l.filtersNodes()),f=new bp(s,h,r);return JT(n,h,t,s,f,a)}function x0(n,e,t,i,s,r,o){const a=e.eventCache;let c,u;const l=new bp(s,e,r);if(pe(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=Ea(e,u,!0,n.filter.filtersNodes());else{const h=fe(t);if(h===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),i),c=Ea(e,u,a.isFullyInitialized(),a.isFiltered());else{const f=He(t),m=a.getNode().getImmediateChild(h);let p;if(pe(f))p=i;else{const y=l.getCompleteChild(h);y!=null?yp(f)===".priority"&&y.getChild(RT(f)).isEmpty()?p=y:p=y.updateChild(f,i):p=te.EMPTY_NODE}if(m.equals(p))c=e;else{const y=n.filter.updateChild(a.getNode(),h,p,f,l,o);c=Ea(e,y,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function V_(n,e){return n.eventCache.isCompleteForChild(e)}function dB(n,e,t,i,s,r,o){let a=e;return i.foreach((c,u)=>{const l=Ze(t,c);V_(e,fe(l))&&(a=x0(n,a,l,u,s,r,o))}),i.foreach((c,u)=>{const l=Ze(t,c);V_(e,fe(l))||(a=x0(n,a,l,u,s,r,o))}),a}function U_(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function E0(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;pe(t)?u=i:u=new We(null).setTree(t,i);const l=e.serverCache.getNode();return u.children.inorderTraversal((h,f)=>{if(l.hasChild(h)){const m=e.serverCache.getNode().getImmediateChild(h),p=U_(n,m,f);c=hl(n,c,new Oe(h),p,s,r,o,a)}}),u.children.inorderTraversal((h,f)=>{const m=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!l.hasChild(h)&&!m){const p=e.serverCache.getNode().getImmediateChild(h),y=U_(n,p,f);c=hl(n,c,new Oe(h),y,s,r,o,a)}}),c}function fB(n,e,t,i,s,r,o){if(ll(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(pe(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return hl(n,e,t,c.getNode().getChild(t),s,r,a,o);if(pe(t)){let u=new We(null);return c.getNode().forEachChild(zr,(l,h)=>{u=u.set(new Oe(l),h)}),E0(n,e,t,u,s,r,a,o)}else return e}else{let u=new We(null);return i.foreach((l,h)=>{const f=Ze(t,l);c.isCompleteForPath(f)&&(u=u.set(l,c.getNode().getChild(f)))}),E0(n,e,t,u,s,r,a,o)}}function mB(n,e,t,i,s){const r=e.serverCache,o=WT(e,r.getNode(),r.isFullyInitialized()||pe(t),r.isFiltered());return JT(n,o,t,i,YT,s)}function pB(n,e,t,i,s,r){let o;if(ll(i,t)!=null)return e;{const a=new bp(i,e,s),c=e.eventCache.getNode();let u;if(pe(t)||fe(t)===".priority"){let l;if(e.serverCache.isFullyInitialized())l=ul(i,ir(e));else{const h=e.serverCache.getNode();L(h instanceof te,"serverChildren would be complete if leaf node"),l=Ap(i,h)}l=l,u=n.filter.updateFullNode(c,l,r)}else{const l=fe(t);let h=Cp(i,l,e.serverCache);h==null&&e.serverCache.isCompleteForChild(l)&&(h=c.getImmediateChild(l)),h!=null?u=n.filter.updateChild(c,l,h,He(t),a,r):e.eventCache.getNode().hasChild(l)?u=n.filter.updateChild(c,l,te.EMPTY_NODE,He(t),a,r):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ul(i,ir(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,r)))}return o=e.serverCache.isFullyInitialized()||ll(i,De())!=null,Ea(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new xp(i.getIndex()),r=MF(i);this.processor_=cB(r);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(te.EMPTY_NODE,o.getNode(),null),u=r.updateFullNode(te.EMPTY_NODE,a.getNode(),null),l=new gs(c,o.isFullyInitialized(),s.filtersNodes()),h=new gs(u,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Th(h,l),this.eventGenerator_=new WF(this.query_)}get query(){return this.query_}}function yB(n){return n.viewCache_.serverCache.getNode()}function _B(n){return cl(n.viewCache_)}function vB(n,e){const t=ir(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!pe(e)&&!t.getImmediateChild(fe(e)).isEmpty())?t.getChild(e):null}function W_(n){return n.eventRegistrations_.length===0}function wB(n,e){n.eventRegistrations_.push(e)}function H_(n,e,t){const i=[];if(t){L(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function $_(n,e,t,i){e.type===Mn.MERGE&&e.source.queryId!==null&&(L(ir(n.viewCache_),"We should always have a full cache before handling merges"),L(cl(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=lB(n.processor_,s,e,t,i);return uB(n.processor_,r.viewCache),L(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,KT(n,r.changes,r.viewCache.eventCache.getNode(),null)}function xB(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(et,(r,o)=>{i.push(mo(r,o))}),t.isFullyInitialized()&&i.push(VT(t.getNode())),KT(n,i,t.getNode(),e)}function KT(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return HF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dl;class QT{constructor(){this.views=new Map}}function EB(n){L(!dl,"__referenceConstructor has already been defined"),dl=n}function IB(){return L(dl,"Reference.ts has not been loaded"),dl}function TB(n){return n.views.size===0}function kp(n,e,t,i){const s=e.source.queryId;if(s!==null){const r=n.views.get(s);return L(r!=null,"SyncTree gave us an op for an invalid query."),$_(r,e,t,i)}else{let r=[];for(const o of n.views.values())r=r.concat($_(o,e,t,i));return r}}function jT(n,e,t,i,s){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=ul(t,s?i:null),c=!1;a?c=!0:i instanceof te?(a=Ap(t,i),c=!1):(a=te.EMPTY_NODE,c=!1);const u=Th(new gs(a,c,!1),new gs(i,s,!1));return new gB(e,u)}return o}function DB(n,e,t,i,s,r){const o=jT(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),wB(o,t),xB(o,t)}function AB(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=ys(n);if(s==="default")for(const[c,u]of n.views.entries())o=o.concat(H_(u,t,i)),W_(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||r.push(u.query));else{const c=n.views.get(s);c&&(o=o.concat(H_(c,t,i)),W_(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!ys(n)&&r.push(new(IB())(e._repo,e._path)),{removed:r,events:o}}function XT(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function us(n,e){let t=null;for(const i of n.views.values())t=t||vB(i,e);return t}function ZT(n,e){if(e._queryParams.loadsAllData())return Ah(n);{const i=e._queryIdentifier;return n.views.get(i)}}function e1(n,e){return ZT(n,e)!=null}function ys(n){return Ah(n)!=null}function Ah(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fl;function CB(n){L(!fl,"__referenceConstructor has already been defined"),fl=n}function bB(){return L(fl,"Reference.ts has not been loaded"),fl}let kB=1;class q_{constructor(e){this.listenProvider_=e,this.syncPointTree_=new We(null),this.pendingWriteTree_=sB(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function t1(n,e,t,i,s){return GF(n.pendingWriteTree_,e,t,i,s),s?Lo(n,new nr(Ip(),e,t)):[]}function SB(n,e,t,i){YF(n.pendingWriteTree_,e,t,i);const s=We.fromObject(t);return Lo(n,new po(Ip(),e,s))}function ns(n,e,t=!1){const i=JF(n.pendingWriteTree_,e);if(KF(n.pendingWriteTree_,e)){let r=new We(null);return i.snap!=null?r=r.set(De(),!0):Rt(i.children,o=>{r=r.set(new Oe(o),!0)}),Lo(n,new al(i.path,r,t))}else return[]}function qc(n,e,t){return Lo(n,new nr(Tp(),e,t))}function PB(n,e,t){const i=We.fromObject(t);return Lo(n,new po(Tp(),e,i))}function RB(n,e){return Lo(n,new ac(Tp(),e))}function NB(n,e,t){const i=Pp(n,t);if(i){const s=Rp(i),r=s.path,o=s.queryId,a=Kt(r,e),c=new ac(Dp(o),a);return Np(n,r,c)}else return[]}function ml(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||e1(o,e))){const c=AB(o,e,t,i);TB(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const u=c.removed;if(a=c.events,!s){const l=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(r,(f,m)=>ys(m));if(l&&!h){const f=n.syncPointTree_.subtree(r);if(!f.isEmpty()){const m=FB(f);for(let p=0;p<m.length;++p){const y=m[p],g=y.query,x=r1(n,y);n.listenProvider_.startListening(Ta(g),cc(n,g),x.hashFn,x.onComplete)}}}!h&&u.length>0&&!i&&(l?n.listenProvider_.stopListening(Ta(e),null):u.forEach(f=>{const m=n.queryToTagMap.get(Ch(f));n.listenProvider_.stopListening(Ta(f),m)}))}BB(n,u)}return a}function n1(n,e,t,i){const s=Pp(n,i);if(s!=null){const r=Rp(s),o=r.path,a=r.queryId,c=Kt(o,e),u=new nr(Dp(a),c,t);return Np(n,o,u)}else return[]}function MB(n,e,t,i){const s=Pp(n,i);if(s){const r=Rp(s),o=r.path,a=r.queryId,c=Kt(o,e),u=We.fromObject(t),l=new po(Dp(a),c,u);return Np(n,o,l)}else return[]}function I0(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(f,m)=>{const p=Kt(f,s);r=r||us(m,p),o=o||ys(m)});let a=n.syncPointTree_.get(s);a?(o=o||ys(a),r=r||us(a,De())):(a=new QT,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;r!=null?c=!0:(c=!1,r=te.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((m,p)=>{const y=us(p,De());y&&(r=r.updateImmediateChild(m,y))}));const u=e1(a,e);if(!u&&!e._queryParams.loadsAllData()){const f=Ch(e);L(!n.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=LB();n.queryToTagMap.set(f,m),n.tagToQueryMap.set(m,f)}const l=Dh(n.pendingWriteTree_,s);let h=DB(a,e,t,l,r,c);if(!u&&!o&&!i){const f=ZT(a,e);h=h.concat(VB(n,e,f))}return h}function Sp(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=Kt(o,e),u=us(a,c);if(u)return u});return qT(s,e,r,t,!0)}function OB(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(u,l)=>{const h=Kt(u,t);i=i||us(l,h)});let s=n.syncPointTree_.get(t);s?i=i||us(s,De()):(s=new QT,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=i!=null,o=r?new gs(i,!0,!1):null,a=Dh(n.pendingWriteTree_,e._path),c=jT(s,e,a,r?o.getNode():te.EMPTY_NODE,r);return _B(c)}function Lo(n,e){return i1(e,n.syncPointTree_,null,Dh(n.pendingWriteTree_,De()))}function i1(n,e,t,i){if(pe(n.path))return s1(n,e,t,i);{const s=e.get(De());t==null&&s!=null&&(t=us(s,De()));let r=[];const o=fe(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,l=zT(i,o);r=r.concat(i1(a,c,u,l))}return s&&(r=r.concat(kp(s,n,i,t))),r}}function s1(n,e,t,i){const s=e.get(De());t==null&&s!=null&&(t=us(s,De()));let r=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=zT(i,o),l=n.operationForChild(o);l&&(r=r.concat(s1(l,a,c,u)))}),s&&(r=r.concat(kp(s,n,i,t))),r}function r1(n,e){const t=e.query,i=cc(n,t);return{hashFn:()=>(yB(e)||te.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?NB(n,t._path,i):RB(n,t._path);{const r=R2(s,t);return ml(n,t,null,r)}}}}function cc(n,e){const t=Ch(e);return n.queryToTagMap.get(t)}function Ch(n){return n._path.toString()+"$"+n._queryIdentifier}function Pp(n,e){return n.tagToQueryMap.get(e)}function Rp(n){const e=n.indexOf("$");return L(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Oe(n.substr(0,e))}}function Np(n,e,t){const i=n.syncPointTree_.get(e);L(i,"Missing sync point for query tag that we're tracking");const s=Dh(n.pendingWriteTree_,e);return kp(i,t,s,null)}function FB(n){return n.fold((e,t,i)=>{if(t&&ys(t))return[Ah(t)];{let s=[];return t&&(s=XT(t)),Rt(i,(r,o)=>{s=s.concat(o)}),s}})}function Ta(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(bB())(n._repo,n._path):n}function BB(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=Ch(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function LB(){return kB++}function VB(n,e,t){const i=e._path,s=cc(n,e),r=r1(n,t),o=n.listenProvider_.startListening(Ta(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)L(!ys(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,l,h)=>{if(!pe(u)&&l&&ys(l))return[Ah(l).query];{let f=[];return l&&(f=f.concat(XT(l).map(m=>m.query))),Rt(h,(m,p)=>{f=f.concat(p)}),f}});for(let u=0;u<c.length;++u){const l=c[u];n.listenProvider_.stopListening(Ta(l),cc(n,l))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Mp(t)}node(){return this.node_}}class Op{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ze(this.path_,e);return new Op(this.syncTree_,t)}node(){return Sp(this.syncTree_,this.path_)}}const UB=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},z_=function(n,e,t){if(!n||typeof n!="object")return n;if(L(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return WB(n[".sv"],e,t);if(typeof n[".sv"]=="object")return HB(n[".sv"],e);L(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},WB=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:L(!1,"Unexpected server value: "+n)}},HB=function(n,e,t){n.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&L(!1,"Unexpected increment value: "+i);const s=e.node();if(L(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},o1=function(n,e,t,i){return Fp(e,new Op(t,n),i)},a1=function(n,e,t){return Fp(n,new Mp(e),t)};function Fp(n,e,t){const i=n.getPriority().val(),s=z_(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=z_(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new ft(a,ct(s)):n}else{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new ft(s))),o.forEachChild(et,(a,c)=>{const u=Fp(c,e.getImmediateChild(a),t);u!==c&&(r=r.updateImmediateChild(a,u))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Lp(n,e){let t=e instanceof Oe?e:new Oe(e),i=n,s=fe(t);for(;s!==null;){const r=Zr(i.node.children,s)||{children:{},childCount:0};i=new Bp(s,i,r),t=He(t),s=fe(t)}return i}function Vo(n){return n.node.value}function c1(n,e){n.node.value=e,T0(n)}function u1(n){return n.node.childCount>0}function $B(n){return Vo(n)===void 0&&!u1(n)}function bh(n,e){Rt(n.node.children,(t,i)=>{e(new Bp(t,n,i))})}function l1(n,e,t,i){t&&!i&&e(n),bh(n,s=>{l1(s,e,!0,i)}),t&&i&&e(n)}function qB(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function zc(n){return new Oe(n.parent===null?n.name:zc(n.parent)+"/"+n.name)}function T0(n){n.parent!==null&&zB(n.parent,n.name,n)}function zB(n,e,t){const i=$B(t),s=ri(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,T0(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,T0(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GB=/[\[\].#$\/\u0000-\u001F\u007F]/,YB=/[\[\].#$\u0000-\u001F\u007F]/,Dd=10*1024*1024,Vp=function(n){return typeof n=="string"&&n.length!==0&&!GB.test(n)},h1=function(n){return typeof n=="string"&&n.length!==0&&!YB.test(n)},JB=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),h1(n)},KB=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!dp(n)||n&&typeof n=="object"&&ri(n,".sv")},QB=function(n,e,t,i){i&&e===void 0||kh(bl(n,"value"),e,t)},kh=function(n,e,t){const i=t instanceof Oe?new dF(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ks(i));if(typeof e=="function")throw new Error(n+"contains a function "+ks(i)+" with contents = "+e.toString());if(dp(e))throw new Error(n+"contains "+e.toString()+" "+ks(i));if(typeof e=="string"&&e.length>Dd/3&&kl(e)>Dd)throw new Error(n+"contains a string greater than "+Dd+" utf8 bytes "+ks(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Rt(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Vp(o)))throw new Error(n+" contains an invalid key ("+o+") "+ks(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);fF(i,o),kh(n,a,i),mF(i)}),s&&r)throw new Error(n+' contains ".value" child '+ks(i)+" in addition to actual children.")}},jB=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const r=ic(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Vp(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(hF);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&En(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},XB=function(n,e,t,i){if(i&&e===void 0)return;const s=bl(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];Rt(e,(o,a)=>{const c=new Oe(o);if(kh(s,a,Ze(t,c)),yp(c)===".priority"&&!KB(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),jB(s,r)},d1=function(n,e,t,i){if(!(i&&t===void 0)&&!h1(t))throw new Error(bl(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},ZB=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),d1(n,e,t,i)},f1=function(n,e){if(fe(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},e6=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Vp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!JB(t))throw new Error(bl(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t6{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Sh(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();t!==null&&!_p(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function m1(n,e,t){Sh(n,t),p1(n,i=>_p(i,e))}function Tn(n,e,t){Sh(n,t),p1(n,i=>En(i,e)||En(e,i))}function p1(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const r=s.path;e(r)?(n6(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function n6(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();$s&&At("event: "+t.toString()),Bo(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i6="repo_interrupt",s6=25;class r6{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new t6,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ol(),this.transactionQueueTree_=new Bp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function o6(n,e,t){if(n.stats_=pp(n.repoInfo_),n.forceRestClient_||F2())n.server_=new rl(n.repoInfo_,(i,s,r,o)=>{G_(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Y_(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ut(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Si(n.repoInfo_,e,(i,s,r,o)=>{G_(n,i,s,r,o)},i=>{Y_(n,i)},i=>{c6(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=W2(n.repoInfo_,()=>new UF(n.stats_,n.server_)),n.infoData_=new OF,n.infoSyncTree_=new q_({startListening:(i,s,r,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=qc(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Up(n,"connected",!1),n.serverSyncTree_=new q_({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,c)=>{const u=o(a,c);Tn(n.eventQueue_,i._path,u)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function a6(n){const t=n.infoData_.getNode(new Oe(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ph(n){return UB({timestamp:a6(n)})}function G_(n,e,t,i,s){n.dataUpdateCount++;const r=new Oe(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const c=Su(t,u=>ct(u));o=MB(n.serverSyncTree_,r,c,s)}else{const c=ct(t);o=n1(n.serverSyncTree_,r,c,s)}else if(i){const c=Su(t,u=>ct(u));o=PB(n.serverSyncTree_,r,c)}else{const c=ct(t);o=qc(n.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=yo(n,r)),Tn(n.eventQueue_,a,o)}function Y_(n,e){Up(n,"connected",e),e===!1&&d6(n)}function c6(n,e){Rt(e,(t,i)=>{Up(n,t,i)})}function Up(n,e,t){const i=new Oe("/.info/"+e),s=ct(t);n.infoData_.updateSnapshot(i,s);const r=qc(n.infoSyncTree_,i,s);Tn(n.eventQueue_,i,r)}function Wp(n){return n.nextWriteId_++}function u6(n,e,t){const i=OB(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{const r=ct(s).withIndex(e._queryParams.getIndex());I0(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=qc(n.serverSyncTree_,e._path,r);else{const a=cc(n.serverSyncTree_,e);o=n1(n.serverSyncTree_,e._path,r,a)}return Tn(n.eventQueue_,e._path,o),ml(n.serverSyncTree_,e,t,null,!0),r},s=>(Gc(n,"get for query "+ut(e)+" failed: "+s),Promise.reject(new Error(s))))}function l6(n,e,t,i,s){Gc(n,"set",{path:e.toString(),value:t,priority:i});const r=Ph(n),o=ct(t,i),a=Sp(n.serverSyncTree_,e),c=a1(o,a,r),u=Wp(n),l=t1(n.serverSyncTree_,e,c,u,!0);Sh(n.eventQueue_,l),n.server_.put(e.toString(),o.val(!0),(f,m)=>{const p=f==="ok";p||Qt("set at "+e+" failed: "+f);const y=ns(n.serverSyncTree_,u,!p);Tn(n.eventQueue_,e,y),D0(n,s,f,m)});const h=$p(n,e);yo(n,h),Tn(n.eventQueue_,h,[])}function h6(n,e,t,i){Gc(n,"update",{path:e.toString(),value:t});let s=!0;const r=Ph(n),o={};if(Rt(t,(a,c)=>{s=!1,o[a]=o1(Ze(e,a),ct(c),n.serverSyncTree_,r)}),s)At("update() called with empty data.  Don't do anything."),D0(n,i,"ok",void 0);else{const a=Wp(n),c=SB(n.serverSyncTree_,e,o,a);Sh(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,l)=>{const h=u==="ok";h||Qt("update at "+e+" failed: "+u);const f=ns(n.serverSyncTree_,a,!h),m=f.length>0?yo(n,e):e;Tn(n.eventQueue_,m,f),D0(n,i,u,l)}),Rt(t,u=>{const l=$p(n,Ze(e,u));yo(n,l)}),Tn(n.eventQueue_,e,[])}}function d6(n){Gc(n,"onDisconnectEvents");const e=Ph(n),t=ol();y0(n.onDisconnect_,De(),(s,r)=>{const o=o1(s,r,n.serverSyncTree_,e);UT(t,s,o)});let i=[];y0(t,De(),(s,r)=>{i=i.concat(qc(n.serverSyncTree_,s,r));const o=$p(n,s);yo(n,o)}),n.onDisconnect_=ol(),Tn(n.eventQueue_,De(),i)}function f6(n,e,t){let i;fe(e._path)===".info"?i=I0(n.infoSyncTree_,e,t):i=I0(n.serverSyncTree_,e,t),m1(n.eventQueue_,e._path,i)}function J_(n,e,t){let i;fe(e._path)===".info"?i=ml(n.infoSyncTree_,e,t):i=ml(n.serverSyncTree_,e,t),m1(n.eventQueue_,e._path,i)}function m6(n){n.persistentConnection_&&n.persistentConnection_.interrupt(i6)}function Gc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),At(t,...e)}function D0(n,e,t,i){e&&Bo(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function g1(n,e,t){return Sp(n.serverSyncTree_,e,t)||te.EMPTY_NODE}function Hp(n,e=n.transactionQueueTree_){if(e||Rh(n,e),Vo(e)){const t=_1(n,e);L(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&p6(n,zc(e),t)}else u1(e)&&bh(e,t=>{Hp(n,t)})}function p6(n,e,t){const i=t.map(u=>u.currentWriteId),s=g1(n,e,i);let r=s;const o=s.hash();for(let u=0;u<t.length;u++){const l=t[u];L(l.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;const h=Kt(e,l.path);r=r.updateChild(h,l.currentOutputSnapshotRaw)}const a=r.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Gc(n,"transaction put response",{path:c.toString(),status:u});let l=[];if(u==="ok"){const h=[];for(let f=0;f<t.length;f++)t[f].status=2,l=l.concat(ns(n.serverSyncTree_,t[f].currentWriteId)),t[f].onComplete&&h.push(()=>t[f].onComplete(null,!0,t[f].currentOutputSnapshotResolved)),t[f].unwatcher();Rh(n,Lp(n.transactionQueueTree_,e)),Hp(n,n.transactionQueueTree_),Tn(n.eventQueue_,e,l);for(let f=0;f<h.length;f++)Bo(h[f])}else{if(u==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{Qt("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=u}yo(n,e)}},o)}function yo(n,e){const t=y1(n,e),i=zc(t),s=_1(n,t);return g6(n,s,i),i}function g6(n,e,t){if(e.length===0)return;const i=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=Kt(t,c.path);let l=!1,h;if(L(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)l=!0,h=c.abortReason,s=s.concat(ns(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=s6)l=!0,h="maxretry",s=s.concat(ns(n.serverSyncTree_,c.currentWriteId,!0));else{const f=g1(n,c.path,o);c.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){kh("transaction failed: Data returned ",m,c.path);let p=ct(m);typeof m=="object"&&m!=null&&ri(m,".priority")||(p=p.updatePriority(f.getPriority()));const g=c.currentWriteId,x=Ph(n),_=a1(p,f,x);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=_,c.currentWriteId=Wp(n),o.splice(o.indexOf(g),1),s=s.concat(t1(n.serverSyncTree_,c.path,_,c.currentWriteId,c.applyLocally)),s=s.concat(ns(n.serverSyncTree_,g,!0))}else l=!0,h="nodata",s=s.concat(ns(n.serverSyncTree_,c.currentWriteId,!0))}Tn(n.eventQueue_,t,s),s=[],l&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Rh(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Bo(i[a]);Hp(n,n.transactionQueueTree_)}function y1(n,e){let t,i=n.transactionQueueTree_;for(t=fe(e);t!==null&&Vo(i)===void 0;)i=Lp(i,t),e=He(e),t=fe(e);return i}function _1(n,e){const t=[];return v1(n,e,t),t.sort((i,s)=>i.order-s.order),t}function v1(n,e,t){const i=Vo(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);bh(e,s=>{v1(n,s,t)})}function Rh(n,e){const t=Vo(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,c1(e,t.length>0?t:void 0)}bh(e,i=>{Rh(n,i)})}function $p(n,e){const t=zc(y1(n,e)),i=Lp(n.transactionQueueTree_,e);return qB(i,s=>{Ad(n,s)}),Ad(n,i),l1(i,s=>{Ad(n,s)}),t}function Ad(n,e){const t=Vo(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(L(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(L(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ns(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?c1(e,void 0):t.length=r+1,Tn(n.eventQueue_,zc(e),s);for(let o=0;o<i.length;o++)Bo(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y6(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function _6(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Qt(`Invalid query segment '${t}' in query '${n}'`)}return e}const K_=function(n,e){const t=v6(n),i=t.namespace;t.domain==="firebase.com"&&Bi(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&Bi("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||C2();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new IT(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new Oe(t.pathString)}},v6=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let l=n.indexOf("/");l===-1&&(l=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(l,h)),l<h&&(s=y6(n.substring(l,h)));const f=_6(n.substring(Math.min(n.length,h)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const m=e.slice(0,u);if(m.toLowerCase()==="localhost")t="localhost";else if(m.split(".").length<=2)t=m;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=i}"ns"in f&&(r=f.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ut(this.snapshot.exportVal())}}class x1{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return pe(this._path)?null:yp(this._path)}get ref(){return new ci(this._repo,this._path)}get _queryIdentifier(){const e=M_(this._queryParams),t=fp(e);return t==="{}"?"default":t}get _queryObject(){return M_(this._queryParams)}isEqual(e){if(e=Te(e),!(e instanceof qp))return!1;const t=this._repo===e._repo,i=_p(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+lF(this._path)}}class ci extends qp{constructor(e,t){super(e,t,new Ep,!1)}get parent(){const e=RT(this._path);return e===null?null:new ci(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class _o{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Oe(e),i=pl(this.ref,e);return new _o(this._node.getChild(t),i,et)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new _o(s,pl(this.ref,i),et)))}hasChild(e){const t=new Oe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ds(n,e){return n=Te(n),n._checkNotDeleted("ref"),e!==void 0?pl(n._root,e):n._root}function pl(n,e){return n=Te(n),fe(n._path)===null?ZB("child","path",e,!1):d1("child","path",e,!1),new ci(n._repo,Ze(n._path,e))}function w6(n){return f1("remove",n._path),I1(n,null)}function I1(n,e){n=Te(n),f1("set",n._path),QB("set",e,n._path,!1);const t=new gc;return l6(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Cd(n,e){XB("update",e,n._path,!1);const t=new gc;return h6(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function x6(n){n=Te(n);const e=new E1(()=>{}),t=new Nh(e);return u6(n._repo,n,t).then(i=>new _o(i,new ci(n._repo,n._path),n._queryParams.getIndex()))}class Nh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new w1("value",this,new _o(e.snapshotNode,new ci(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new x1(this,e,t):null}matches(e){return e instanceof Nh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class zp{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new x1(this,e,t):null}createEvent(e,t){L(e.childName!=null,"Child events should have a childName.");const i=pl(new ci(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new w1(e.type,this,new _o(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof zp?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function E6(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){const c=t,u=(l,h)=>{J_(n._repo,n,a),c(l,h)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new E1(t,r||void 0),a=e==="value"?new Nh(o):new zp(e,o);return f6(n._repo,n,a),()=>J_(n._repo,n,a)}function I6(n,e,t,i){return E6(n,"value",e,t,i)}EB(ci);CB(ci);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T6="FIREBASE_DATABASE_EMULATOR_HOST",A0={};let D6=!1;function A6(n,e,t,i){n.repoInfo_=new IT(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function C6(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||Bi("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),At("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=K_(r,s),a=o.repoInfo,c,u;typeof process<"u"&&g_&&(u=g_[T6]),u?(c=!0,r=`http://${u}?ns=${a.namespace}`,o=K_(r,s),a=o.repoInfo):c=!o.repoInfo.secure;const l=s&&c?new qr(qr.OWNER):new L2(n.name,n.options,e);e6("Invalid Firebase Database URL",o),pe(o.path)||Bi("Database URL must point to the root of a Firebase Database (not including a child path).");const h=k6(a,n,l,new B2(n.name,t));return new S6(h,n)}function b6(n,e){const t=A0[e];(!t||t[n.key]!==n)&&Bi(`Database ${e}(${n.repoInfo_}) has already been deleted.`),m6(n),delete t[n.key]}function k6(n,e,t,i){let s=A0[e.name];s||(s={},A0[e.name]=s);let r=s[n.toURLString()];return r&&Bi("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new r6(n,D6,t,i),s[n.toURLString()]=r,r}class S6{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(o6(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ci(this._repo,De())),this._rootInternal}_delete(){return this._rootInternal!==null&&(b6(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Bi("Cannot call "+e+" on a deleted database.")}}function P6(n=Do(),e){const t=Pl(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const i=fw("database");i&&R6(t,...i)}return t}function R6(n,e,t,i={}){n=Te(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Bi("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Bi('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new qr(qr.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:gw(i.mockUserToken,n.app.options.projectId);r=new qr(o)}A6(s,e,t,r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N6(n){E2(ar),Ks(new hs("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return C6(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Kn(y_,__,n),Kn(y_,__,"esm2017")}function Q_(n){return{".sv":{increment:n}}}Si.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Si.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};N6();const M6={simpletor_golden_business_month_1:1e3,simpletor_advanced_business_month_1:200,simpletor_basic_business_month_1:0,simpletor_landing_business_month_1:0},O6={simpletor_golden_business_month_1:100,simpletor_advanced_business_month_1:20,simpletor_basic_business_month_1:10,simpletor_landing_business_month_1:10};class gl{constructor(e=0,t=0){d(this,"messagesCounter",0);d(this,"paymentRequestCounter",0);d(this,"listener");this.messagesCounter=e,this.paymentRequestCounter=t}static forNewBusiness(){return new gl(x2,w2)}static fromProductId(e){return new gl(M6[e]||0,O6[e]||0)}setBusinessData(e){this.messagesCounter=parseInt(e.val().messagesCounter.toString())||0,this.paymentRequestCounter=parseInt(e.val().paymentRequestCounter.toString())||0}toJson(){const e={};return e.messagesCounter=this.messagesCounter,e.paymentRequestCounter=this.paymentRequestCounter,e}}class yl{constructor({name:e="",description:t="",id:i="",price:s,imageUrl:r=""}={}){d(this,"description","");d(this,"price");d(this,"imageUrl","");d(this,"id","");d(this,"name","");d(this,"createdAt",new Date);this.name=e||"",this.description=t||"",this.id=i||"",this.price=s,this.imageUrl=r||""}static fromProduct(e){const t=new yl({id:e.id,description:e.description,price:e.price,imageUrl:e.imageUrl,name:e.name});return t.createdAt=e.createdAt,t}static fromJson(e,t){const i=new yl({id:t,description:e.description,price:Vt.fromJson(e.price),imageUrl:e.imageUrl,name:e.name});return i.createdAt=e.createdAt,i}toJson(){return{description:this.description,price:this.price?this.price.toJson():null,imageUrl:this.imageUrl,name:this.name,createdAt:this.createdAt}}toString(){return JSON.stringify(this.toJson())}}var F6=(n=>(n[n.scheduleSettings=0]="scheduleSettings",n[n.workSettings=1]="workSettings",n[n.customers=2]="customers",n[n.dataPermission=3]="dataPermission",n[n.waitings=4]="waitings",n[n.storyUpload=5]="storyUpload",n[n.resumePermission=6]="resumePermission",n[n.schedulePemission=7]="schedulePemission",n[n.bookingsPermission=8]="bookingsPermission",n[n.invoicesPremission=9]="invoicesPremission",n[n.paymentRequestPermmission=10]="paymentRequestPermmission",n))(F6||{});const B6={0:"scheduleSettings",1:"workSettings",2:"customers",6:"resumePermission",3:"dataPermission",9:"invoicesPremission",4:"waitings",5:"storyUpload",7:"schedulePemission",8:"bookingsPermission",10:"paymentRequestPermmission"},L6={scheduleSettings:0,workSettings:1,customers:2,resumePermission:2,dataPermission:3,invoicesPremission:9,waitings:4,storyUpload:5,schedulePermission:7,bookingsPermission:8,paymentRequestPermission:10},V6=[0,1,2,3,4,5,6,7,8,9,10];class _l{constructor(){d(this,"map",{})}static fromJson(e){const t=new _l;return t.map={},Object.entries(e).forEach(([i,s])=>{t.map[i]=new Map,V6.forEach(r=>{t.map[i].set(r,e[i][L6[r]]??!0)})}),t}toJson(){const e={};return Object.entries(this.map).forEach(([t,i])=>{i.forEach((s,r)=>{s||(e[t]??(e[t]={}),e[t][B6[r]]=s)})}),e}}class sr{constructor({shopName:e="",businessId:t,productId:i="",adress:s="",dynamicLink:r="",revenueCatId:o="",ownersName:a="",instagramAccount:c="",shopPhone:u="",design:l}){d(this,"businesseType",Hr.Other);d(this,"currency",Ci);d(this,"notifyOnNewCustomer",!0);d(this,"searchable",!0);d(this,"billingIssue",new Map);d(this,"isLandingPageMode",!1);d(this,"allWorkersIds",new Map);d(this,"workersIds",new Map);d(this,"hypPath");d(this,"expiredDate",new Date);d(this,"workersPermissions",new _l);d(this,"shopPhone","");d(this,"ownersName","");d(this,"companyNumber","");d(this,"ownersPhone","");d(this,"masofNumber","");d(this,"previewDoc","");d(this,"instagramAccount","");d(this,"revenueCatId","");d(this,"pendingWorkersProductsId","");d(this,"adress","");d(this,"workersProductsId","");d(this,"pendingProductId","");d(this,"dynamicLink","");d(this,"shopName","");d(this,"productId","");d(this,"businessId","");d(this,"createdAt",new Date);d(this,"blockedUsersTemp",new Map);d(this,"lastTimeConnected",new Date);d(this,"businessData",new gl);d(this,"design",new xi);this.shopName=e,this.businessId=t,this.productId=i,this.adress=s,this.dynamicLink=r,this.revenueCatId=o,this.ownersName=a,this.instagramAccount=c,this.shopPhone=u,this.design=l}static empty(){return new sr({design:new xi,businessId:""})}get businessPayLoadData(){return new ho({businessId:this.businessId,businessName:this.shopName,shopIcon:this.design.shopIconData})}static fromJson(e,t){const i=new sr({businessId:t,design:new xi});return i.setData(e,t),i}setData(e,t){if(this.businessId=t,e.currency&&(this.currency=gi.fromJson(e.currency)),e.design)this.design=xi.fromJson(e.design);else{const s=e.theme;this.design.pickedThemeKey=s,Object.entries(e.products).forEach(([r,o])=>{this.design.products.set(r,yl.fromJson(o,r))}),e.changingImages&&(this.design.changingImages=e.changingImages.map(r=>r)),e.updates&&e.updates.forEach((r,o)=>{this.design.updates.set(o.toString(),lo.fromJson(r,o.toString()))}),this.design.bottomIcons=e.bottomIcons??!1,this.design.storyTitle=e.storyTitle??"",this.design.changingImagesSwapSeconds=e.changingImagesSwapSeconds??6,this.design.shopIconUrl=e.shopIcon??""}e.workersPermissions!=null&&(this.workersPermissions=_l.fromJson(e.workersPermissions)),this.previewDoc=e.previewDoc??"",this.workersProductsId=e.workersProductsId??"",this.pendingWorkersProductsId=e.pendingWorkersProductsId??"",this.shopName=e.shopName??"",this.isLandingPageMode=e.isLandingPageMode??!1,this.searchable=e.searchable??!0,e.expiredDate!=null&&(this.expiredDate=vt(e.expiredDate)),this.notifyOnNewCustomer=e.notifyOnNewCustomer??!0,this.companyNumber=e.companyNumber??"",e.hypPath!=null&&(this.hypPath=v2[e.hypPath]),this.allWorkersIds=new Map,e.allWorkersIds!=null&&Object.entries(e.allWorkersIds).forEach(([s,r])=>{this.allWorkersIds.set(s,r)});const i=this.businessId.split("--")[0];this.allWorkersIds.hasOwnProperty("+"+i)||this.allWorkersIds.set("+"+i,""),this.workersIds=new Map,e.workersIds!=null&&Object.entries(e.workersIds).forEach(([s,r])=>{this.workersIds.set(s,r)}),this.workersIds.hasOwnProperty(i)||this.workersIds.set(i,""),this.dynamicLink=e.dynamicLink??"",this.masofNumber=e.masofNumber??"",this.ownersName=e.ownersName??"",this.revenueCatId=e.revenueCatId??"",this.productId=e.productId??"",this.pendingProductId=e.pendingProductId??"",this.businesseType=aT[e.businesseType]??Hr.Other,this.instagramAccount=e.instagramAccount??"",this.adress=e.adress??"",this.shopPhone=e.shopPhone??"";try{e.billingIssue!=null&&Object.entries(e.billingIssue).forEach(([s,r])=>{this.billingIssue.set(s,r.toDate())})}catch{}e.createdAt instanceof Le?this.createdAt=e.createdAt.toDate():typeof e.createdAt=="string"&&(this.createdAt=ae(e.createdAt)||new Date),e.lastTimeConnected!=null&&(this.lastTimeConnected=ae(e.lastTimeConnected)||new Date)}toJson(){const e={};return e.notifyOnNewCustomer=this.notifyOnNewCustomer,e.currency=this.currency.toJson(),e.searchable=this.searchable,e.workersProductsId=this.workersProductsId,e.pendingWorkersProductsId=this.pendingWorkersProductsId,e.previewDoc=this.previewDoc,e.masofNumber=this.masofNumber,e.revenueCatId=this.revenueCatId,e.pendingProductId=this.pendingProductId,e.productId=this.productId,e.shopName=this.shopName,this.hypPath&&(e.hypPath=this.hypPath),this.billingIssue.size>0&&(e.billingIssue={},this.billingIssue.forEach((t,i)=>{e.billingIssue[i]=Le.fromDate(t)})),this.dynamicLink!==""&&(e.dynamicLink=this.dynamicLink),e.companyNumber=this.companyNumber,e.expiredDate=this.expiredDate,e.businesseType=this.businesseType,e.ownersName=this.ownersName,e.instagramAccount=this.instagramAccount,e.adress=this.adress,e.shopPhone=this.shopPhone,e.workersPermissions=this.workersPermissions.toJson(),e.workersIds=this.workersIds,e.createdAt=this.createdAt,e.lastTimeConnected=this.lastTimeConnected,this.isLandingPageMode&&(e.isLandingPageMode=this.isLandingPageMode),e.design=this.design.toJson(),e}toString(){return JSON.stringify(this.toJson())}}class Da{constructor({businessId:e,shopPhone:t,type:i,adress:s,ownerName:r,iconUrl:o,businessName:a}){d(this,"businessName","");d(this,"iconUrl","");d(this,"businessId","");d(this,"type",Hr.Other);d(this,"adress","");d(this,"ownerName","");d(this,"shopPhone","");this.businessId=e,this.shopPhone=t,this.type=i,this.adress=s,this.ownerName=r,this.iconUrl=o,this.businessName=a}static empty(){return new Da({businessId:"",shopPhone:"",type:Hr.Other,adress:"",ownerName:"",iconUrl:"",businessName:""})}static fromJson(e,t){const i=e.businessName||"",s=e.iconUrl||"",r=aT[e.T]||Hr.Other,o=e.ON||"",a=e.SP||"",c=e.A||"";return new Da({businessId:t,shopPhone:a,type:r,adress:c,ownerName:o,iconUrl:s,businessName:i})}get toBusinessModel(){const e=new sr({businessId:this.businessId,design:new xi({shopIconUrl:this.iconUrl})});return e.ownersName=this.ownerName,e.shopPhone=this.shopPhone,e.shopName=this.businessName,e.adress=this.adress,e.businesseType=this.type,e}static fromBusinessInfo(e){return new Da({businessId:e.businessId,shopPhone:e.shopPhone,type:e.type,adress:e.adress,ownerName:e.ownerName,iconUrl:e.iconUrl,businessName:e.businessName})}toJson(){const e={};return e.businessName=this.businessName,e.iconUrl=this.iconUrl,e.ON=this.ownerName,e.SP=this.shopPhone,e.A=this.adress,e.T=y2[this.type],e}isTheSame(e){return e.iconUrl===this.iconUrl&&e.ownerName===this.ownerName&&e.shopPhone===this.shopPhone&&e.adress===this.adress&&e.type===this.type&&e.businessName===this.businessName}toString(){return JSON.stringify(this.toJson())}}var T1={exports:{}};function U6(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var bd={exports:{}};const W6={},H6=Object.freeze(Object.defineProperty({__proto__:null,default:W6},Symbol.toStringTag,{value:"Module"})),$6=HD(H6);var j_;function we(){return j_||(j_=1,function(n,e){(function(t,i){n.exports=i()})(le,function(){var t=t||function(i,s){var r;if(typeof window<"u"&&window.crypto&&(r=window.crypto),typeof self<"u"&&self.crypto&&(r=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(r=globalThis.crypto),!r&&typeof window<"u"&&window.msCrypto&&(r=window.msCrypto),!r&&typeof le<"u"&&le.crypto&&(r=le.crypto),!r&&typeof U6=="function")try{r=$6}catch{}var o=function(){if(r){if(typeof r.getRandomValues=="function")try{return r.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof r.randomBytes=="function")try{return r.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function _(){}return function(v){var w;return _.prototype=v,w=new _,_.prototype=null,w}}(),c={},u=c.lib={},l=u.Base=function(){return{extend:function(_){var v=a(this);return _&&v.mixIn(_),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var v in _)_.hasOwnProperty(v)&&(this[v]=_[v]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=u.WordArray=l.extend({init:function(_,v){_=this.words=_||[],v!=s?this.sigBytes=v:this.sigBytes=_.length*4},toString:function(_){return(_||m).stringify(this)},concat:function(_){var v=this.words,w=_.words,I=this.sigBytes,T=_.sigBytes;if(this.clamp(),I%4)for(var D=0;D<T;D++){var C=w[D>>>2]>>>24-D%4*8&255;v[I+D>>>2]|=C<<24-(I+D)%4*8}else for(var R=0;R<T;R+=4)v[I+R>>>2]=w[R>>>2];return this.sigBytes+=T,this},clamp:function(){var _=this.words,v=this.sigBytes;_[v>>>2]&=4294967295<<32-v%4*8,_.length=i.ceil(v/4)},clone:function(){var _=l.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var v=[],w=0;w<_;w+=4)v.push(o());return new h.init(v,_)}}),f=c.enc={},m=f.Hex={stringify:function(_){for(var v=_.words,w=_.sigBytes,I=[],T=0;T<w;T++){var D=v[T>>>2]>>>24-T%4*8&255;I.push((D>>>4).toString(16)),I.push((D&15).toString(16))}return I.join("")},parse:function(_){for(var v=_.length,w=[],I=0;I<v;I+=2)w[I>>>3]|=parseInt(_.substr(I,2),16)<<24-I%8*4;return new h.init(w,v/2)}},p=f.Latin1={stringify:function(_){for(var v=_.words,w=_.sigBytes,I=[],T=0;T<w;T++){var D=v[T>>>2]>>>24-T%4*8&255;I.push(String.fromCharCode(D))}return I.join("")},parse:function(_){for(var v=_.length,w=[],I=0;I<v;I++)w[I>>>2]|=(_.charCodeAt(I)&255)<<24-I%4*8;return new h.init(w,v)}},y=f.Utf8={stringify:function(_){try{return decodeURIComponent(escape(p.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return p.parse(unescape(encodeURIComponent(_)))}},g=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=y.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var v,w=this._data,I=w.words,T=w.sigBytes,D=this.blockSize,C=D*4,R=T/C;_?R=i.ceil(R):R=i.max((R|0)-this._minBufferSize,0);var E=R*D,A=i.min(E*4,T);if(E){for(var k=0;k<E;k+=D)this._doProcessBlock(I,k);v=I.splice(0,E),w.sigBytes-=A}return new h.init(v,A)},clone:function(){var _=l.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0});u.Hasher=g.extend({cfg:l.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var v=this._doFinalize();return v},blockSize:16,_createHelper:function(_){return function(v,w){return new _.init(w).finalize(v)}},_createHmacHelper:function(_){return function(v,w){return new x.HMAC.init(_,w).finalize(v)}}});var x=c.algo={};return c}(Math);return t})}(bd)),bd.exports}var kd={exports:{}},X_;function Mh(){return X_||(X_=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(i){var s=t,r=s.lib,o=r.Base,a=r.WordArray,c=s.x64={};c.Word=o.extend({init:function(u,l){this.high=u,this.low=l}}),c.WordArray=o.extend({init:function(u,l){u=this.words=u||[],l!=i?this.sigBytes=l:this.sigBytes=u.length*8},toX32:function(){for(var u=this.words,l=u.length,h=[],f=0;f<l;f++){var m=u[f];h.push(m.high),h.push(m.low)}return a.create(h,this.sigBytes)},clone:function(){for(var u=o.clone.call(this),l=u.words=this.words.slice(0),h=l.length,f=0;f<h;f++)l[f]=l[f].clone();return u}})}(),t})}(kd)),kd.exports}var Sd={exports:{}},Z_;function q6(){return Z_||(Z_=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(){if(typeof ArrayBuffer=="function"){var i=t,s=i.lib,r=s.WordArray,o=r.init,a=r.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var u=c.byteLength,l=[],h=0;h<u;h++)l[h>>>2]|=c[h]<<24-h%4*8;o.call(this,l,u)}else o.apply(this,arguments)};a.prototype=r}}(),t.lib.WordArray})}(Sd)),Sd.exports}var Pd={exports:{}},ev;function z6(){return ev||(ev=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(){var i=t,s=i.lib,r=s.WordArray,o=i.enc;o.Utf16=o.Utf16BE={stringify:function(c){for(var u=c.words,l=c.sigBytes,h=[],f=0;f<l;f+=2){var m=u[f>>>2]>>>16-f%4*8&65535;h.push(String.fromCharCode(m))}return h.join("")},parse:function(c){for(var u=c.length,l=[],h=0;h<u;h++)l[h>>>1]|=c.charCodeAt(h)<<16-h%2*16;return r.create(l,u*2)}},o.Utf16LE={stringify:function(c){for(var u=c.words,l=c.sigBytes,h=[],f=0;f<l;f+=2){var m=a(u[f>>>2]>>>16-f%4*8&65535);h.push(String.fromCharCode(m))}return h.join("")},parse:function(c){for(var u=c.length,l=[],h=0;h<u;h++)l[h>>>1]|=a(c.charCodeAt(h)<<16-h%2*16);return r.create(l,u*2)}};function a(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(Pd)),Pd.exports}var Rd={exports:{}},tv;function mr(){return tv||(tv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(){var i=t,s=i.lib,r=s.WordArray,o=i.enc;o.Base64={stringify:function(c){var u=c.words,l=c.sigBytes,h=this._map;c.clamp();for(var f=[],m=0;m<l;m+=3)for(var p=u[m>>>2]>>>24-m%4*8&255,y=u[m+1>>>2]>>>24-(m+1)%4*8&255,g=u[m+2>>>2]>>>24-(m+2)%4*8&255,x=p<<16|y<<8|g,_=0;_<4&&m+_*.75<l;_++)f.push(h.charAt(x>>>6*(3-_)&63));var v=h.charAt(64);if(v)for(;f.length%4;)f.push(v);return f.join("")},parse:function(c){var u=c.length,l=this._map,h=this._reverseMap;if(!h){h=this._reverseMap=[];for(var f=0;f<l.length;f++)h[l.charCodeAt(f)]=f}var m=l.charAt(64);if(m){var p=c.indexOf(m);p!==-1&&(u=p)}return a(c,u,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(c,u,l){for(var h=[],f=0,m=0;m<u;m++)if(m%4){var p=l[c.charCodeAt(m-1)]<<m%4*2,y=l[c.charCodeAt(m)]>>>6-m%4*2,g=p|y;h[f>>>2]|=g<<24-f%4*8,f++}return r.create(h,f)}}(),t.enc.Base64})}(Rd)),Rd.exports}var Nd={exports:{}},nv;function G6(){return nv||(nv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(){var i=t,s=i.lib,r=s.WordArray,o=i.enc;o.Base64url={stringify:function(c,u){u===void 0&&(u=!0);var l=c.words,h=c.sigBytes,f=u?this._safe_map:this._map;c.clamp();for(var m=[],p=0;p<h;p+=3)for(var y=l[p>>>2]>>>24-p%4*8&255,g=l[p+1>>>2]>>>24-(p+1)%4*8&255,x=l[p+2>>>2]>>>24-(p+2)%4*8&255,_=y<<16|g<<8|x,v=0;v<4&&p+v*.75<h;v++)m.push(f.charAt(_>>>6*(3-v)&63));var w=f.charAt(64);if(w)for(;m.length%4;)m.push(w);return m.join("")},parse:function(c,u){u===void 0&&(u=!0);var l=c.length,h=u?this._safe_map:this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var m=0;m<h.length;m++)f[h.charCodeAt(m)]=m}var p=h.charAt(64);if(p){var y=c.indexOf(p);y!==-1&&(l=y)}return a(c,l,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(c,u,l){for(var h=[],f=0,m=0;m<u;m++)if(m%4){var p=l[c.charCodeAt(m-1)]<<m%4*2,y=l[c.charCodeAt(m)]>>>6-m%4*2,g=p|y;h[f>>>2]|=g<<24-f%4*8,f++}return r.create(h,f)}}(),t.enc.Base64url})}(Nd)),Nd.exports}var Md={exports:{}},iv;function pr(){return iv||(iv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(i){var s=t,r=s.lib,o=r.WordArray,a=r.Hasher,c=s.algo,u=[];(function(){for(var y=0;y<64;y++)u[y]=i.abs(i.sin(y+1))*4294967296|0})();var l=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,g){for(var x=0;x<16;x++){var _=g+x,v=y[_];y[_]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var w=this._hash.words,I=y[g+0],T=y[g+1],D=y[g+2],C=y[g+3],R=y[g+4],E=y[g+5],A=y[g+6],k=y[g+7],P=y[g+8],G=y[g+9],j=y[g+10],ue=y[g+11],qe=y[g+12],Se=y[g+13],Ve=y[g+14],Ne=y[g+15],b=w[0],O=w[1],F=w[2],N=w[3];b=h(b,O,F,N,I,7,u[0]),N=h(N,b,O,F,T,12,u[1]),F=h(F,N,b,O,D,17,u[2]),O=h(O,F,N,b,C,22,u[3]),b=h(b,O,F,N,R,7,u[4]),N=h(N,b,O,F,E,12,u[5]),F=h(F,N,b,O,A,17,u[6]),O=h(O,F,N,b,k,22,u[7]),b=h(b,O,F,N,P,7,u[8]),N=h(N,b,O,F,G,12,u[9]),F=h(F,N,b,O,j,17,u[10]),O=h(O,F,N,b,ue,22,u[11]),b=h(b,O,F,N,qe,7,u[12]),N=h(N,b,O,F,Se,12,u[13]),F=h(F,N,b,O,Ve,17,u[14]),O=h(O,F,N,b,Ne,22,u[15]),b=f(b,O,F,N,T,5,u[16]),N=f(N,b,O,F,A,9,u[17]),F=f(F,N,b,O,ue,14,u[18]),O=f(O,F,N,b,I,20,u[19]),b=f(b,O,F,N,E,5,u[20]),N=f(N,b,O,F,j,9,u[21]),F=f(F,N,b,O,Ne,14,u[22]),O=f(O,F,N,b,R,20,u[23]),b=f(b,O,F,N,G,5,u[24]),N=f(N,b,O,F,Ve,9,u[25]),F=f(F,N,b,O,C,14,u[26]),O=f(O,F,N,b,P,20,u[27]),b=f(b,O,F,N,Se,5,u[28]),N=f(N,b,O,F,D,9,u[29]),F=f(F,N,b,O,k,14,u[30]),O=f(O,F,N,b,qe,20,u[31]),b=m(b,O,F,N,E,4,u[32]),N=m(N,b,O,F,P,11,u[33]),F=m(F,N,b,O,ue,16,u[34]),O=m(O,F,N,b,Ve,23,u[35]),b=m(b,O,F,N,T,4,u[36]),N=m(N,b,O,F,R,11,u[37]),F=m(F,N,b,O,k,16,u[38]),O=m(O,F,N,b,j,23,u[39]),b=m(b,O,F,N,Se,4,u[40]),N=m(N,b,O,F,I,11,u[41]),F=m(F,N,b,O,C,16,u[42]),O=m(O,F,N,b,A,23,u[43]),b=m(b,O,F,N,G,4,u[44]),N=m(N,b,O,F,qe,11,u[45]),F=m(F,N,b,O,Ne,16,u[46]),O=m(O,F,N,b,D,23,u[47]),b=p(b,O,F,N,I,6,u[48]),N=p(N,b,O,F,k,10,u[49]),F=p(F,N,b,O,Ve,15,u[50]),O=p(O,F,N,b,E,21,u[51]),b=p(b,O,F,N,qe,6,u[52]),N=p(N,b,O,F,C,10,u[53]),F=p(F,N,b,O,j,15,u[54]),O=p(O,F,N,b,T,21,u[55]),b=p(b,O,F,N,P,6,u[56]),N=p(N,b,O,F,Ne,10,u[57]),F=p(F,N,b,O,A,15,u[58]),O=p(O,F,N,b,Se,21,u[59]),b=p(b,O,F,N,R,6,u[60]),N=p(N,b,O,F,ue,10,u[61]),F=p(F,N,b,O,D,15,u[62]),O=p(O,F,N,b,G,21,u[63]),w[0]=w[0]+b|0,w[1]=w[1]+O|0,w[2]=w[2]+F|0,w[3]=w[3]+N|0},_doFinalize:function(){var y=this._data,g=y.words,x=this._nDataBytes*8,_=y.sigBytes*8;g[_>>>5]|=128<<24-_%32;var v=i.floor(x/4294967296),w=x;g[(_+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,g[(_+64>>>9<<4)+14]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,y.sigBytes=(g.length+1)*4,this._process();for(var I=this._hash,T=I.words,D=0;D<4;D++){var C=T[D];T[D]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}return I},clone:function(){var y=a.clone.call(this);return y._hash=this._hash.clone(),y}});function h(y,g,x,_,v,w,I){var T=y+(g&x|~g&_)+v+I;return(T<<w|T>>>32-w)+g}function f(y,g,x,_,v,w,I){var T=y+(g&_|x&~_)+v+I;return(T<<w|T>>>32-w)+g}function m(y,g,x,_,v,w,I){var T=y+(g^x^_)+v+I;return(T<<w|T>>>32-w)+g}function p(y,g,x,_,v,w,I){var T=y+(x^(g|~_))+v+I;return(T<<w|T>>>32-w)+g}s.MD5=a._createHelper(l),s.HmacMD5=a._createHmacHelper(l)}(Math),t.MD5})}(Md)),Md.exports}var Od={exports:{}},sv;function D1(){return sv||(sv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(){var i=t,s=i.lib,r=s.WordArray,o=s.Hasher,a=i.algo,c=[],u=a.SHA1=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,h){for(var f=this._hash.words,m=f[0],p=f[1],y=f[2],g=f[3],x=f[4],_=0;_<80;_++){if(_<16)c[_]=l[h+_]|0;else{var v=c[_-3]^c[_-8]^c[_-14]^c[_-16];c[_]=v<<1|v>>>31}var w=(m<<5|m>>>27)+x+c[_];_<20?w+=(p&y|~p&g)+1518500249:_<40?w+=(p^y^g)+1859775393:_<60?w+=(p&y|p&g|y&g)-1894007588:w+=(p^y^g)-899497514,x=g,g=y,y=p<<30|p>>>2,p=m,m=w}f[0]=f[0]+m|0,f[1]=f[1]+p|0,f[2]=f[2]+y|0,f[3]=f[3]+g|0,f[4]=f[4]+x|0},_doFinalize:function(){var l=this._data,h=l.words,f=this._nDataBytes*8,m=l.sigBytes*8;return h[m>>>5]|=128<<24-m%32,h[(m+64>>>9<<4)+14]=Math.floor(f/4294967296),h[(m+64>>>9<<4)+15]=f,l.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var l=o.clone.call(this);return l._hash=this._hash.clone(),l}});i.SHA1=o._createHelper(u),i.HmacSHA1=o._createHmacHelper(u)}(),t.SHA1})}(Od)),Od.exports}var Fd={exports:{}},rv;function Gp(){return rv||(rv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){return function(i){var s=t,r=s.lib,o=r.WordArray,a=r.Hasher,c=s.algo,u=[],l=[];(function(){function m(x){for(var _=i.sqrt(x),v=2;v<=_;v++)if(!(x%v))return!1;return!0}function p(x){return(x-(x|0))*4294967296|0}for(var y=2,g=0;g<64;)m(y)&&(g<8&&(u[g]=p(i.pow(y,1/2))),l[g]=p(i.pow(y,1/3)),g++),y++})();var h=[],f=c.SHA256=a.extend({_doReset:function(){this._hash=new o.init(u.slice(0))},_doProcessBlock:function(m,p){for(var y=this._hash.words,g=y[0],x=y[1],_=y[2],v=y[3],w=y[4],I=y[5],T=y[6],D=y[7],C=0;C<64;C++){if(C<16)h[C]=m[p+C]|0;else{var R=h[C-15],E=(R<<25|R>>>7)^(R<<14|R>>>18)^R>>>3,A=h[C-2],k=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;h[C]=E+h[C-7]+k+h[C-16]}var P=w&I^~w&T,G=g&x^g&_^x&_,j=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),ue=(w<<26|w>>>6)^(w<<21|w>>>11)^(w<<7|w>>>25),qe=D+ue+P+l[C]+h[C],Se=j+G;D=T,T=I,I=w,w=v+qe|0,v=_,_=x,x=g,g=qe+Se|0}y[0]=y[0]+g|0,y[1]=y[1]+x|0,y[2]=y[2]+_|0,y[3]=y[3]+v|0,y[4]=y[4]+w|0,y[5]=y[5]+I|0,y[6]=y[6]+T|0,y[7]=y[7]+D|0},_doFinalize:function(){var m=this._data,p=m.words,y=this._nDataBytes*8,g=m.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=i.floor(y/4294967296),p[(g+64>>>9<<4)+15]=y,m.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var m=a.clone.call(this);return m._hash=this._hash.clone(),m}});s.SHA256=a._createHelper(f),s.HmacSHA256=a._createHmacHelper(f)}(Math),t.SHA256})}(Fd)),Fd.exports}var Bd={exports:{}},ov;function Y6(){return ov||(ov=1,function(n,e){(function(t,i,s){n.exports=i(we(),Gp())})(le,function(t){return function(){var i=t,s=i.lib,r=s.WordArray,o=i.algo,a=o.SHA256,c=o.SHA224=a.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=a._doFinalize.call(this);return u.sigBytes-=4,u}});i.SHA224=a._createHelper(c),i.HmacSHA224=a._createHmacHelper(c)}(),t.SHA224})}(Bd)),Bd.exports}var Ld={exports:{}},av;function A1(){return av||(av=1,function(n,e){(function(t,i,s){n.exports=i(we(),Mh())})(le,function(t){return function(){var i=t,s=i.lib,r=s.Hasher,o=i.x64,a=o.Word,c=o.WordArray,u=i.algo;function l(){return a.create.apply(a,arguments)}var h=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],f=[];(function(){for(var p=0;p<80;p++)f[p]=l()})();var m=u.SHA512=r.extend({_doReset:function(){this._hash=new c.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(p,y){for(var g=this._hash.words,x=g[0],_=g[1],v=g[2],w=g[3],I=g[4],T=g[5],D=g[6],C=g[7],R=x.high,E=x.low,A=_.high,k=_.low,P=v.high,G=v.low,j=w.high,ue=w.low,qe=I.high,Se=I.low,Ve=T.high,Ne=T.low,b=D.high,O=D.low,F=C.high,N=C.low,Je=R,Ue=E,jt=A,he=k,Wo=P,yr=G,zh=j,Ho=ue,kn=qe,an=Se,jc=Ve,$o=Ne,Xc=b,qo=O,Gh=F,zo=N,Sn=0;Sn<80;Sn++){var pn,qi,Zc=f[Sn];if(Sn<16)qi=Zc.high=p[y+Sn*2]|0,pn=Zc.low=p[y+Sn*2+1]|0;else{var xg=f[Sn-15],_r=xg.high,Go=xg.low,CD=(_r>>>1|Go<<31)^(_r>>>8|Go<<24)^_r>>>7,Eg=(Go>>>1|_r<<31)^(Go>>>8|_r<<24)^(Go>>>7|_r<<25),Ig=f[Sn-2],vr=Ig.high,Yo=Ig.low,bD=(vr>>>19|Yo<<13)^(vr<<3|Yo>>>29)^vr>>>6,Tg=(Yo>>>19|vr<<13)^(Yo<<3|vr>>>29)^(Yo>>>6|vr<<26),Dg=f[Sn-7],kD=Dg.high,SD=Dg.low,Ag=f[Sn-16],PD=Ag.high,Cg=Ag.low;pn=Eg+SD,qi=CD+kD+(pn>>>0<Eg>>>0?1:0),pn=pn+Tg,qi=qi+bD+(pn>>>0<Tg>>>0?1:0),pn=pn+Cg,qi=qi+PD+(pn>>>0<Cg>>>0?1:0),Zc.high=qi,Zc.low=pn}var RD=kn&jc^~kn&Xc,bg=an&$o^~an&qo,ND=Je&jt^Je&Wo^jt&Wo,MD=Ue&he^Ue&yr^he&yr,OD=(Je>>>28|Ue<<4)^(Je<<30|Ue>>>2)^(Je<<25|Ue>>>7),kg=(Ue>>>28|Je<<4)^(Ue<<30|Je>>>2)^(Ue<<25|Je>>>7),FD=(kn>>>14|an<<18)^(kn>>>18|an<<14)^(kn<<23|an>>>9),BD=(an>>>14|kn<<18)^(an>>>18|kn<<14)^(an<<23|kn>>>9),Sg=h[Sn],LD=Sg.high,Pg=Sg.low,cn=zo+BD,zi=Gh+FD+(cn>>>0<zo>>>0?1:0),cn=cn+bg,zi=zi+RD+(cn>>>0<bg>>>0?1:0),cn=cn+Pg,zi=zi+LD+(cn>>>0<Pg>>>0?1:0),cn=cn+pn,zi=zi+qi+(cn>>>0<pn>>>0?1:0),Rg=kg+MD,VD=OD+ND+(Rg>>>0<kg>>>0?1:0);Gh=Xc,zo=qo,Xc=jc,qo=$o,jc=kn,$o=an,an=Ho+cn|0,kn=zh+zi+(an>>>0<Ho>>>0?1:0)|0,zh=Wo,Ho=yr,Wo=jt,yr=he,jt=Je,he=Ue,Ue=cn+Rg|0,Je=zi+VD+(Ue>>>0<cn>>>0?1:0)|0}E=x.low=E+Ue,x.high=R+Je+(E>>>0<Ue>>>0?1:0),k=_.low=k+he,_.high=A+jt+(k>>>0<he>>>0?1:0),G=v.low=G+yr,v.high=P+Wo+(G>>>0<yr>>>0?1:0),ue=w.low=ue+Ho,w.high=j+zh+(ue>>>0<Ho>>>0?1:0),Se=I.low=Se+an,I.high=qe+kn+(Se>>>0<an>>>0?1:0),Ne=T.low=Ne+$o,T.high=Ve+jc+(Ne>>>0<$o>>>0?1:0),O=D.low=O+qo,D.high=b+Xc+(O>>>0<qo>>>0?1:0),N=C.low=N+zo,C.high=F+Gh+(N>>>0<zo>>>0?1:0)},_doFinalize:function(){var p=this._data,y=p.words,g=this._nDataBytes*8,x=p.sigBytes*8;y[x>>>5]|=128<<24-x%32,y[(x+128>>>10<<5)+30]=Math.floor(g/4294967296),y[(x+128>>>10<<5)+31]=g,p.sigBytes=y.length*4,this._process();var _=this._hash.toX32();return _},clone:function(){var p=r.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});i.SHA512=r._createHelper(m),i.HmacSHA512=r._createHmacHelper(m)}(),t.SHA512})}(Ld)),Ld.exports}var Vd={exports:{}},cv;function J6(){return cv||(cv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Mh(),A1())})(le,function(t){return function(){var i=t,s=i.x64,r=s.Word,o=s.WordArray,a=i.algo,c=a.SHA512,u=a.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var l=c._doFinalize.call(this);return l.sigBytes-=16,l}});i.SHA384=c._createHelper(u),i.HmacSHA384=c._createHmacHelper(u)}(),t.SHA384})}(Vd)),Vd.exports}var Ud={exports:{}},uv;function K6(){return uv||(uv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Mh())})(le,function(t){return function(i){var s=t,r=s.lib,o=r.WordArray,a=r.Hasher,c=s.x64,u=c.Word,l=s.algo,h=[],f=[],m=[];(function(){for(var g=1,x=0,_=0;_<24;_++){h[g+5*x]=(_+1)*(_+2)/2%64;var v=x%5,w=(2*g+3*x)%5;g=v,x=w}for(var g=0;g<5;g++)for(var x=0;x<5;x++)f[g+5*x]=x+(2*g+3*x)%5*5;for(var I=1,T=0;T<24;T++){for(var D=0,C=0,R=0;R<7;R++){if(I&1){var E=(1<<R)-1;E<32?C^=1<<E:D^=1<<E-32}I&128?I=I<<1^113:I<<=1}m[T]=u.create(D,C)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=u.create()})();var y=l.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],x=0;x<25;x++)g[x]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,x){for(var _=this._state,v=this.blockSize/2,w=0;w<v;w++){var I=g[x+2*w],T=g[x+2*w+1];I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,T=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360;var D=_[w];D.high^=T,D.low^=I}for(var C=0;C<24;C++){for(var R=0;R<5;R++){for(var E=0,A=0,k=0;k<5;k++){var D=_[R+5*k];E^=D.high,A^=D.low}var P=p[R];P.high=E,P.low=A}for(var R=0;R<5;R++)for(var G=p[(R+4)%5],j=p[(R+1)%5],ue=j.high,qe=j.low,E=G.high^(ue<<1|qe>>>31),A=G.low^(qe<<1|ue>>>31),k=0;k<5;k++){var D=_[R+5*k];D.high^=E,D.low^=A}for(var Se=1;Se<25;Se++){var E,A,D=_[Se],Ve=D.high,Ne=D.low,b=h[Se];b<32?(E=Ve<<b|Ne>>>32-b,A=Ne<<b|Ve>>>32-b):(E=Ne<<b-32|Ve>>>64-b,A=Ve<<b-32|Ne>>>64-b);var O=p[f[Se]];O.high=E,O.low=A}var F=p[0],N=_[0];F.high=N.high,F.low=N.low;for(var R=0;R<5;R++)for(var k=0;k<5;k++){var Se=R+5*k,D=_[Se],Je=p[Se],Ue=p[(R+1)%5+5*k],jt=p[(R+2)%5+5*k];D.high=Je.high^~Ue.high&jt.high,D.low=Je.low^~Ue.low&jt.low}var D=_[0],he=m[C];D.high^=he.high,D.low^=he.low}},_doFinalize:function(){var g=this._data,x=g.words;this._nDataBytes*8;var _=g.sigBytes*8,v=this.blockSize*32;x[_>>>5]|=1<<24-_%32,x[(i.ceil((_+1)/v)*v>>>5)-1]|=128,g.sigBytes=x.length*4,this._process();for(var w=this._state,I=this.cfg.outputLength/8,T=I/8,D=[],C=0;C<T;C++){var R=w[C],E=R.high,A=R.low;E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,A=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,D.push(A),D.push(E)}return new o.init(D,I)},clone:function(){for(var g=a.clone.call(this),x=g._state=this._state.slice(0),_=0;_<25;_++)x[_]=x[_].clone();return g}});s.SHA3=a._createHelper(y),s.HmacSHA3=a._createHmacHelper(y)}(Math),t.SHA3})}(Ud)),Ud.exports}var Wd={exports:{}},lv;function Q6(){return lv||(lv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){/** @preserve
			(c) 2012 by Cdric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(i){var s=t,r=s.lib,o=r.WordArray,a=r.Hasher,c=s.algo,u=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),h=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),m=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),y=c.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(T,D){for(var C=0;C<16;C++){var R=D+C,E=T[R];T[R]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360}var A=this._hash.words,k=m.words,P=p.words,G=u.words,j=l.words,ue=h.words,qe=f.words,Se,Ve,Ne,b,O,F,N,Je,Ue,jt;F=Se=A[0],N=Ve=A[1],Je=Ne=A[2],Ue=b=A[3],jt=O=A[4];for(var he,C=0;C<80;C+=1)he=Se+T[D+G[C]]|0,C<16?he+=g(Ve,Ne,b)+k[0]:C<32?he+=x(Ve,Ne,b)+k[1]:C<48?he+=_(Ve,Ne,b)+k[2]:C<64?he+=v(Ve,Ne,b)+k[3]:he+=w(Ve,Ne,b)+k[4],he=he|0,he=I(he,ue[C]),he=he+O|0,Se=O,O=b,b=I(Ne,10),Ne=Ve,Ve=he,he=F+T[D+j[C]]|0,C<16?he+=w(N,Je,Ue)+P[0]:C<32?he+=v(N,Je,Ue)+P[1]:C<48?he+=_(N,Je,Ue)+P[2]:C<64?he+=x(N,Je,Ue)+P[3]:he+=g(N,Je,Ue)+P[4],he=he|0,he=I(he,qe[C]),he=he+jt|0,F=jt,jt=Ue,Ue=I(Je,10),Je=N,N=he;he=A[1]+Ne+Ue|0,A[1]=A[2]+b+jt|0,A[2]=A[3]+O+F|0,A[3]=A[4]+Se+N|0,A[4]=A[0]+Ve+Je|0,A[0]=he},_doFinalize:function(){var T=this._data,D=T.words,C=this._nDataBytes*8,R=T.sigBytes*8;D[R>>>5]|=128<<24-R%32,D[(R+64>>>9<<4)+14]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,T.sigBytes=(D.length+1)*4,this._process();for(var E=this._hash,A=E.words,k=0;k<5;k++){var P=A[k];A[k]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}return E},clone:function(){var T=a.clone.call(this);return T._hash=this._hash.clone(),T}});function g(T,D,C){return T^D^C}function x(T,D,C){return T&D|~T&C}function _(T,D,C){return(T|~D)^C}function v(T,D,C){return T&C|D&~C}function w(T,D,C){return T^(D|~C)}function I(T,D){return T<<D|T>>>32-D}s.RIPEMD160=a._createHelper(y),s.HmacRIPEMD160=a._createHmacHelper(y)}(),t.RIPEMD160})}(Wd)),Wd.exports}var Hd={exports:{}},hv;function Yp(){return hv||(hv=1,function(n,e){(function(t,i){n.exports=i(we())})(le,function(t){(function(){var i=t,s=i.lib,r=s.Base,o=i.enc,a=o.Utf8,c=i.algo;c.HMAC=r.extend({init:function(u,l){u=this._hasher=new u.init,typeof l=="string"&&(l=a.parse(l));var h=u.blockSize,f=h*4;l.sigBytes>f&&(l=u.finalize(l)),l.clamp();for(var m=this._oKey=l.clone(),p=this._iKey=l.clone(),y=m.words,g=p.words,x=0;x<h;x++)y[x]^=1549556828,g[x]^=909522486;m.sigBytes=p.sigBytes=f,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var l=this._hasher,h=l.finalize(u);l.reset();var f=l.finalize(this._oKey.clone().concat(h));return f}})})()})}(Hd)),Hd.exports}var $d={exports:{}},dv;function j6(){return dv||(dv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Gp(),Yp())})(le,function(t){return function(){var i=t,s=i.lib,r=s.Base,o=s.WordArray,a=i.algo,c=a.SHA256,u=a.HMAC,l=a.PBKDF2=r.extend({cfg:r.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,f){for(var m=this.cfg,p=u.create(m.hasher,h),y=o.create(),g=o.create([1]),x=y.words,_=g.words,v=m.keySize,w=m.iterations;x.length<v;){var I=p.update(f).finalize(g);p.reset();for(var T=I.words,D=T.length,C=I,R=1;R<w;R++){C=p.finalize(C),p.reset();for(var E=C.words,A=0;A<D;A++)T[A]^=E[A]}y.concat(I),_[0]++}return y.sigBytes=v*4,y}});i.PBKDF2=function(h,f,m){return l.create(m).compute(h,f)}}(),t.PBKDF2})}($d)),$d.exports}var qd={exports:{}},fv;function Es(){return fv||(fv=1,function(n,e){(function(t,i,s){n.exports=i(we(),D1(),Yp())})(le,function(t){return function(){var i=t,s=i.lib,r=s.Base,o=s.WordArray,a=i.algo,c=a.MD5,u=a.EvpKDF=r.extend({cfg:r.extend({keySize:128/32,hasher:c,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,h){for(var f,m=this.cfg,p=m.hasher.create(),y=o.create(),g=y.words,x=m.keySize,_=m.iterations;g.length<x;){f&&p.update(f),f=p.update(l).finalize(h),p.reset();for(var v=1;v<_;v++)f=p.finalize(f),p.reset();y.concat(f)}return y.sigBytes=x*4,y}});i.EvpKDF=function(l,h,f){return u.create(f).compute(l,h)}}(),t.EvpKDF})}(qd)),qd.exports}var zd={exports:{}},mv;function Et(){return mv||(mv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Es())})(le,function(t){t.lib.Cipher||function(i){var s=t,r=s.lib,o=r.Base,a=r.WordArray,c=r.BufferedBlockAlgorithm,u=s.enc;u.Utf8;var l=u.Base64,h=s.algo,f=h.EvpKDF,m=r.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(E,A){return this.create(this._ENC_XFORM_MODE,E,A)},createDecryptor:function(E,A){return this.create(this._DEC_XFORM_MODE,E,A)},init:function(E,A,k){this.cfg=this.cfg.extend(k),this._xformMode=E,this._key=A,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(E){return this._append(E),this._process()},finalize:function(E){E&&this._append(E);var A=this._doFinalize();return A},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function E(A){return typeof A=="string"?R:T}return function(A){return{encrypt:function(k,P,G){return E(P).encrypt(A,k,P,G)},decrypt:function(k,P,G){return E(P).decrypt(A,k,P,G)}}}}()});r.StreamCipher=m.extend({_doFinalize:function(){var E=this._process(!0);return E},blockSize:1});var p=s.mode={},y=r.BlockCipherMode=o.extend({createEncryptor:function(E,A){return this.Encryptor.create(E,A)},createDecryptor:function(E,A){return this.Decryptor.create(E,A)},init:function(E,A){this._cipher=E,this._iv=A}}),g=p.CBC=function(){var E=y.extend();E.Encryptor=E.extend({processBlock:function(k,P){var G=this._cipher,j=G.blockSize;A.call(this,k,P,j),G.encryptBlock(k,P),this._prevBlock=k.slice(P,P+j)}}),E.Decryptor=E.extend({processBlock:function(k,P){var G=this._cipher,j=G.blockSize,ue=k.slice(P,P+j);G.decryptBlock(k,P),A.call(this,k,P,j),this._prevBlock=ue}});function A(k,P,G){var j,ue=this._iv;ue?(j=ue,this._iv=i):j=this._prevBlock;for(var qe=0;qe<G;qe++)k[P+qe]^=j[qe]}return E}(),x=s.pad={},_=x.Pkcs7={pad:function(E,A){for(var k=A*4,P=k-E.sigBytes%k,G=P<<24|P<<16|P<<8|P,j=[],ue=0;ue<P;ue+=4)j.push(G);var qe=a.create(j,P);E.concat(qe)},unpad:function(E){var A=E.words[E.sigBytes-1>>>2]&255;E.sigBytes-=A}};r.BlockCipher=m.extend({cfg:m.cfg.extend({mode:g,padding:_}),reset:function(){var E;m.reset.call(this);var A=this.cfg,k=A.iv,P=A.mode;this._xformMode==this._ENC_XFORM_MODE?E=P.createEncryptor:(E=P.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==E?this._mode.init(this,k&&k.words):(this._mode=E.call(P,this,k&&k.words),this._mode.__creator=E)},_doProcessBlock:function(E,A){this._mode.processBlock(E,A)},_doFinalize:function(){var E,A=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(A.pad(this._data,this.blockSize),E=this._process(!0)):(E=this._process(!0),A.unpad(E)),E},blockSize:128/32});var v=r.CipherParams=o.extend({init:function(E){this.mixIn(E)},toString:function(E){return(E||this.formatter).stringify(this)}}),w=s.format={},I=w.OpenSSL={stringify:function(E){var A,k=E.ciphertext,P=E.salt;return P?A=a.create([1398893684,1701076831]).concat(P).concat(k):A=k,A.toString(l)},parse:function(E){var A,k=l.parse(E),P=k.words;return P[0]==1398893684&&P[1]==1701076831&&(A=a.create(P.slice(2,4)),P.splice(0,4),k.sigBytes-=16),v.create({ciphertext:k,salt:A})}},T=r.SerializableCipher=o.extend({cfg:o.extend({format:I}),encrypt:function(E,A,k,P){P=this.cfg.extend(P);var G=E.createEncryptor(k,P),j=G.finalize(A),ue=G.cfg;return v.create({ciphertext:j,key:k,iv:ue.iv,algorithm:E,mode:ue.mode,padding:ue.padding,blockSize:E.blockSize,formatter:P.format})},decrypt:function(E,A,k,P){P=this.cfg.extend(P),A=this._parse(A,P.format);var G=E.createDecryptor(k,P).finalize(A.ciphertext);return G},_parse:function(E,A){return typeof E=="string"?A.parse(E,this):E}}),D=s.kdf={},C=D.OpenSSL={execute:function(E,A,k,P,G){if(P||(P=a.random(64/8)),G)var j=f.create({keySize:A+k,hasher:G}).compute(E,P);else var j=f.create({keySize:A+k}).compute(E,P);var ue=a.create(j.words.slice(A),k*4);return j.sigBytes=A*4,v.create({key:j,iv:ue,salt:P})}},R=r.PasswordBasedCipher=T.extend({cfg:T.cfg.extend({kdf:C}),encrypt:function(E,A,k,P){P=this.cfg.extend(P);var G=P.kdf.execute(k,E.keySize,E.ivSize,P.salt,P.hasher);P.iv=G.iv;var j=T.encrypt.call(this,E,A,G.key,P);return j.mixIn(G),j},decrypt:function(E,A,k,P){P=this.cfg.extend(P),A=this._parse(A,P.format);var G=P.kdf.execute(k,E.keySize,E.ivSize,A.salt,P.hasher);P.iv=G.iv;var j=T.decrypt.call(this,E,A,G.key,P);return j}})}()})}(zd)),zd.exports}var Gd={exports:{}},pv;function X6(){return pv||(pv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.mode.CFB=function(){var i=t.lib.BlockCipherMode.extend();i.Encryptor=i.extend({processBlock:function(r,o){var a=this._cipher,c=a.blockSize;s.call(this,r,o,c,a),this._prevBlock=r.slice(o,o+c)}}),i.Decryptor=i.extend({processBlock:function(r,o){var a=this._cipher,c=a.blockSize,u=r.slice(o,o+c);s.call(this,r,o,c,a),this._prevBlock=u}});function s(r,o,a,c){var u,l=this._iv;l?(u=l.slice(0),this._iv=void 0):u=this._prevBlock,c.encryptBlock(u,0);for(var h=0;h<a;h++)r[o+h]^=u[h]}return i}(),t.mode.CFB})}(Gd)),Gd.exports}var Yd={exports:{}},gv;function Z6(){return gv||(gv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.mode.CTR=function(){var i=t.lib.BlockCipherMode.extend(),s=i.Encryptor=i.extend({processBlock:function(r,o){var a=this._cipher,c=a.blockSize,u=this._iv,l=this._counter;u&&(l=this._counter=u.slice(0),this._iv=void 0);var h=l.slice(0);a.encryptBlock(h,0),l[c-1]=l[c-1]+1|0;for(var f=0;f<c;f++)r[o+f]^=h[f]}});return i.Decryptor=s,i}(),t.mode.CTR})}(Yd)),Yd.exports}var Jd={exports:{}},yv;function e3(){return yv||(yv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var i=t.lib.BlockCipherMode.extend();function s(a){if((a>>24&255)===255){var c=a>>16&255,u=a>>8&255,l=a&255;c===255?(c=0,u===255?(u=0,l===255?l=0:++l):++u):++c,a=0,a+=c<<16,a+=u<<8,a+=l}else a+=1<<24;return a}function r(a){return(a[0]=s(a[0]))===0&&(a[1]=s(a[1])),a}var o=i.Encryptor=i.extend({processBlock:function(a,c){var u=this._cipher,l=u.blockSize,h=this._iv,f=this._counter;h&&(f=this._counter=h.slice(0),this._iv=void 0),r(f);var m=f.slice(0);u.encryptBlock(m,0);for(var p=0;p<l;p++)a[c+p]^=m[p]}});return i.Decryptor=o,i}(),t.mode.CTRGladman})}(Jd)),Jd.exports}var Kd={exports:{}},_v;function t3(){return _v||(_v=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.mode.OFB=function(){var i=t.lib.BlockCipherMode.extend(),s=i.Encryptor=i.extend({processBlock:function(r,o){var a=this._cipher,c=a.blockSize,u=this._iv,l=this._keystream;u&&(l=this._keystream=u.slice(0),this._iv=void 0),a.encryptBlock(l,0);for(var h=0;h<c;h++)r[o+h]^=l[h]}});return i.Decryptor=s,i}(),t.mode.OFB})}(Kd)),Kd.exports}var Qd={exports:{}},vv;function n3(){return vv||(vv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.mode.ECB=function(){var i=t.lib.BlockCipherMode.extend();return i.Encryptor=i.extend({processBlock:function(s,r){this._cipher.encryptBlock(s,r)}}),i.Decryptor=i.extend({processBlock:function(s,r){this._cipher.decryptBlock(s,r)}}),i}(),t.mode.ECB})}(Qd)),Qd.exports}var jd={exports:{}},wv;function i3(){return wv||(wv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.pad.AnsiX923={pad:function(i,s){var r=i.sigBytes,o=s*4,a=o-r%o,c=r+a-1;i.clamp(),i.words[c>>>2]|=a<<24-c%4*8,i.sigBytes+=a},unpad:function(i){var s=i.words[i.sigBytes-1>>>2]&255;i.sigBytes-=s}},t.pad.Ansix923})}(jd)),jd.exports}var Xd={exports:{}},xv;function s3(){return xv||(xv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.pad.Iso10126={pad:function(i,s){var r=s*4,o=r-i.sigBytes%r;i.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(i){var s=i.words[i.sigBytes-1>>>2]&255;i.sigBytes-=s}},t.pad.Iso10126})}(Xd)),Xd.exports}var Zd={exports:{}},Ev;function r3(){return Ev||(Ev=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.pad.Iso97971={pad:function(i,s){i.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(i,s)},unpad:function(i){t.pad.ZeroPadding.unpad(i),i.sigBytes--}},t.pad.Iso97971})}(Zd)),Zd.exports}var ef={exports:{}},Iv;function o3(){return Iv||(Iv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.pad.ZeroPadding={pad:function(i,s){var r=s*4;i.clamp(),i.sigBytes+=r-(i.sigBytes%r||r)},unpad:function(i){for(var s=i.words,r=i.sigBytes-1,r=i.sigBytes-1;r>=0;r--)if(s[r>>>2]>>>24-r%4*8&255){i.sigBytes=r+1;break}}},t.pad.ZeroPadding})}(ef)),ef.exports}var tf={exports:{}},Tv;function a3(){return Tv||(Tv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(tf)),tf.exports}var nf={exports:{}},Dv;function c3(){return Dv||(Dv=1,function(n,e){(function(t,i,s){n.exports=i(we(),Et())})(le,function(t){return function(i){var s=t,r=s.lib,o=r.CipherParams,a=s.enc,c=a.Hex,u=s.format;u.Hex={stringify:function(l){return l.ciphertext.toString(c)},parse:function(l){var h=c.parse(l);return o.create({ciphertext:h})}}}(),t.format.Hex})}(nf)),nf.exports}var sf={exports:{}},Av;function u3(){return Av||(Av=1,function(n,e){(function(t,i,s){n.exports=i(we(),mr(),pr(),Es(),Et())})(le,function(t){return function(){var i=t,s=i.lib,r=s.BlockCipher,o=i.algo,a=[],c=[],u=[],l=[],h=[],f=[],m=[],p=[],y=[],g=[];(function(){for(var v=[],w=0;w<256;w++)w<128?v[w]=w<<1:v[w]=w<<1^283;for(var I=0,T=0,w=0;w<256;w++){var D=T^T<<1^T<<2^T<<3^T<<4;D=D>>>8^D&255^99,a[I]=D,c[D]=I;var C=v[I],R=v[C],E=v[R],A=v[D]*257^D*16843008;u[I]=A<<24|A>>>8,l[I]=A<<16|A>>>16,h[I]=A<<8|A>>>24,f[I]=A;var A=E*16843009^R*65537^C*257^I*16843008;m[D]=A<<24|A>>>8,p[D]=A<<16|A>>>16,y[D]=A<<8|A>>>24,g[D]=A,I?(I=C^v[v[v[E^C]]],T^=v[v[T]]):I=T=1}})();var x=[0,1,2,4,8,16,32,64,128,27,54],_=o.AES=r.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var w=this._keyPriorReset=this._key,I=w.words,T=w.sigBytes/4,D=this._nRounds=T+6,C=(D+1)*4,R=this._keySchedule=[],E=0;E<C;E++)E<T?R[E]=I[E]:(v=R[E-1],E%T?T>6&&E%T==4&&(v=a[v>>>24]<<24|a[v>>>16&255]<<16|a[v>>>8&255]<<8|a[v&255]):(v=v<<8|v>>>24,v=a[v>>>24]<<24|a[v>>>16&255]<<16|a[v>>>8&255]<<8|a[v&255],v^=x[E/T|0]<<24),R[E]=R[E-T]^v);for(var A=this._invKeySchedule=[],k=0;k<C;k++){var E=C-k;if(k%4)var v=R[E];else var v=R[E-4];k<4||E<=4?A[k]=v:A[k]=m[a[v>>>24]]^p[a[v>>>16&255]]^y[a[v>>>8&255]]^g[a[v&255]]}}},encryptBlock:function(v,w){this._doCryptBlock(v,w,this._keySchedule,u,l,h,f,a)},decryptBlock:function(v,w){var I=v[w+1];v[w+1]=v[w+3],v[w+3]=I,this._doCryptBlock(v,w,this._invKeySchedule,m,p,y,g,c);var I=v[w+1];v[w+1]=v[w+3],v[w+3]=I},_doCryptBlock:function(v,w,I,T,D,C,R,E){for(var A=this._nRounds,k=v[w]^I[0],P=v[w+1]^I[1],G=v[w+2]^I[2],j=v[w+3]^I[3],ue=4,qe=1;qe<A;qe++){var Se=T[k>>>24]^D[P>>>16&255]^C[G>>>8&255]^R[j&255]^I[ue++],Ve=T[P>>>24]^D[G>>>16&255]^C[j>>>8&255]^R[k&255]^I[ue++],Ne=T[G>>>24]^D[j>>>16&255]^C[k>>>8&255]^R[P&255]^I[ue++],b=T[j>>>24]^D[k>>>16&255]^C[P>>>8&255]^R[G&255]^I[ue++];k=Se,P=Ve,G=Ne,j=b}var Se=(E[k>>>24]<<24|E[P>>>16&255]<<16|E[G>>>8&255]<<8|E[j&255])^I[ue++],Ve=(E[P>>>24]<<24|E[G>>>16&255]<<16|E[j>>>8&255]<<8|E[k&255])^I[ue++],Ne=(E[G>>>24]<<24|E[j>>>16&255]<<16|E[k>>>8&255]<<8|E[P&255])^I[ue++],b=(E[j>>>24]<<24|E[k>>>16&255]<<16|E[P>>>8&255]<<8|E[G&255])^I[ue++];v[w]=Se,v[w+1]=Ve,v[w+2]=Ne,v[w+3]=b},keySize:256/32});i.AES=r._createHelper(_)}(),t.AES})}(sf)),sf.exports}var rf={exports:{}},Cv;function l3(){return Cv||(Cv=1,function(n,e){(function(t,i,s){n.exports=i(we(),mr(),pr(),Es(),Et())})(le,function(t){return function(){var i=t,s=i.lib,r=s.WordArray,o=s.BlockCipher,a=i.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],m=a.DES=o.extend({_doReset:function(){for(var x=this._key,_=x.words,v=[],w=0;w<56;w++){var I=c[w]-1;v[w]=_[I>>>5]>>>31-I%32&1}for(var T=this._subKeys=[],D=0;D<16;D++){for(var C=T[D]=[],R=l[D],w=0;w<24;w++)C[w/6|0]|=v[(u[w]-1+R)%28]<<31-w%6,C[4+(w/6|0)]|=v[28+(u[w+24]-1+R)%28]<<31-w%6;C[0]=C[0]<<1|C[0]>>>31;for(var w=1;w<7;w++)C[w]=C[w]>>>(w-1)*4+3;C[7]=C[7]<<5|C[7]>>>27}for(var E=this._invSubKeys=[],w=0;w<16;w++)E[w]=T[15-w]},encryptBlock:function(x,_){this._doCryptBlock(x,_,this._subKeys)},decryptBlock:function(x,_){this._doCryptBlock(x,_,this._invSubKeys)},_doCryptBlock:function(x,_,v){this._lBlock=x[_],this._rBlock=x[_+1],p.call(this,4,252645135),p.call(this,16,65535),y.call(this,2,858993459),y.call(this,8,16711935),p.call(this,1,1431655765);for(var w=0;w<16;w++){for(var I=v[w],T=this._lBlock,D=this._rBlock,C=0,R=0;R<8;R++)C|=h[R][((D^I[R])&f[R])>>>0];this._lBlock=D,this._rBlock=T^C}var E=this._lBlock;this._lBlock=this._rBlock,this._rBlock=E,p.call(this,1,1431655765),y.call(this,8,16711935),y.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),x[_]=this._lBlock,x[_+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(x,_){var v=(this._lBlock>>>x^this._rBlock)&_;this._rBlock^=v,this._lBlock^=v<<x}function y(x,_){var v=(this._rBlock>>>x^this._lBlock)&_;this._lBlock^=v,this._rBlock^=v<<x}i.DES=o._createHelper(m);var g=a.TripleDES=o.extend({_doReset:function(){var x=this._key,_=x.words;if(_.length!==2&&_.length!==4&&_.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var v=_.slice(0,2),w=_.length<4?_.slice(0,2):_.slice(2,4),I=_.length<6?_.slice(0,2):_.slice(4,6);this._des1=m.createEncryptor(r.create(v)),this._des2=m.createEncryptor(r.create(w)),this._des3=m.createEncryptor(r.create(I))},encryptBlock:function(x,_){this._des1.encryptBlock(x,_),this._des2.decryptBlock(x,_),this._des3.encryptBlock(x,_)},decryptBlock:function(x,_){this._des3.decryptBlock(x,_),this._des2.encryptBlock(x,_),this._des1.decryptBlock(x,_)},keySize:192/32,ivSize:64/32,blockSize:64/32});i.TripleDES=o._createHelper(g)}(),t.TripleDES})}(rf)),rf.exports}var of={exports:{}},bv;function h3(){return bv||(bv=1,function(n,e){(function(t,i,s){n.exports=i(we(),mr(),pr(),Es(),Et())})(le,function(t){return function(){var i=t,s=i.lib,r=s.StreamCipher,o=i.algo,a=o.RC4=r.extend({_doReset:function(){for(var l=this._key,h=l.words,f=l.sigBytes,m=this._S=[],p=0;p<256;p++)m[p]=p;for(var p=0,y=0;p<256;p++){var g=p%f,x=h[g>>>2]>>>24-g%4*8&255;y=(y+m[p]+x)%256;var _=m[p];m[p]=m[y],m[y]=_}this._i=this._j=0},_doProcessBlock:function(l,h){l[h]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var l=this._S,h=this._i,f=this._j,m=0,p=0;p<4;p++){h=(h+1)%256,f=(f+l[h])%256;var y=l[h];l[h]=l[f],l[f]=y,m|=l[(l[h]+l[f])%256]<<24-p*8}return this._i=h,this._j=f,m}i.RC4=r._createHelper(a);var u=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var l=this.cfg.drop;l>0;l--)c.call(this)}});i.RC4Drop=r._createHelper(u)}(),t.RC4})}(of)),of.exports}var af={exports:{}},kv;function d3(){return kv||(kv=1,function(n,e){(function(t,i,s){n.exports=i(we(),mr(),pr(),Es(),Et())})(le,function(t){return function(){var i=t,s=i.lib,r=s.StreamCipher,o=i.algo,a=[],c=[],u=[],l=o.Rabbit=r.extend({_doReset:function(){for(var f=this._key.words,m=this.cfg.iv,p=0;p<4;p++)f[p]=(f[p]<<8|f[p]>>>24)&16711935|(f[p]<<24|f[p]>>>8)&4278255360;var y=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],g=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var p=0;p<4;p++)h.call(this);for(var p=0;p<8;p++)g[p]^=y[p+4&7];if(m){var x=m.words,_=x[0],v=x[1],w=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,I=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,T=w>>>16|I&4294901760,D=I<<16|w&65535;g[0]^=w,g[1]^=T,g[2]^=I,g[3]^=D,g[4]^=w,g[5]^=T,g[6]^=I,g[7]^=D;for(var p=0;p<4;p++)h.call(this)}},_doProcessBlock:function(f,m){var p=this._X;h.call(this),a[0]=p[0]^p[5]>>>16^p[3]<<16,a[1]=p[2]^p[7]>>>16^p[5]<<16,a[2]=p[4]^p[1]>>>16^p[7]<<16,a[3]=p[6]^p[3]>>>16^p[1]<<16;for(var y=0;y<4;y++)a[y]=(a[y]<<8|a[y]>>>24)&16711935|(a[y]<<24|a[y]>>>8)&4278255360,f[m+y]^=a[y]},blockSize:128/32,ivSize:64/32});function h(){for(var f=this._X,m=this._C,p=0;p<8;p++)c[p]=m[p];m[0]=m[0]+1295307597+this._b|0,m[1]=m[1]+3545052371+(m[0]>>>0<c[0]>>>0?1:0)|0,m[2]=m[2]+886263092+(m[1]>>>0<c[1]>>>0?1:0)|0,m[3]=m[3]+1295307597+(m[2]>>>0<c[2]>>>0?1:0)|0,m[4]=m[4]+3545052371+(m[3]>>>0<c[3]>>>0?1:0)|0,m[5]=m[5]+886263092+(m[4]>>>0<c[4]>>>0?1:0)|0,m[6]=m[6]+1295307597+(m[5]>>>0<c[5]>>>0?1:0)|0,m[7]=m[7]+3545052371+(m[6]>>>0<c[6]>>>0?1:0)|0,this._b=m[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var y=f[p]+m[p],g=y&65535,x=y>>>16,_=((g*g>>>17)+g*x>>>15)+x*x,v=((y&4294901760)*y|0)+((y&65535)*y|0);u[p]=_^v}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}i.Rabbit=r._createHelper(l)}(),t.Rabbit})}(af)),af.exports}var cf={exports:{}},Sv;function f3(){return Sv||(Sv=1,function(n,e){(function(t,i,s){n.exports=i(we(),mr(),pr(),Es(),Et())})(le,function(t){return function(){var i=t,s=i.lib,r=s.StreamCipher,o=i.algo,a=[],c=[],u=[],l=o.RabbitLegacy=r.extend({_doReset:function(){var f=this._key.words,m=this.cfg.iv,p=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],y=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var g=0;g<4;g++)h.call(this);for(var g=0;g<8;g++)y[g]^=p[g+4&7];if(m){var x=m.words,_=x[0],v=x[1],w=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,I=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,T=w>>>16|I&4294901760,D=I<<16|w&65535;y[0]^=w,y[1]^=T,y[2]^=I,y[3]^=D,y[4]^=w,y[5]^=T,y[6]^=I,y[7]^=D;for(var g=0;g<4;g++)h.call(this)}},_doProcessBlock:function(f,m){var p=this._X;h.call(this),a[0]=p[0]^p[5]>>>16^p[3]<<16,a[1]=p[2]^p[7]>>>16^p[5]<<16,a[2]=p[4]^p[1]>>>16^p[7]<<16,a[3]=p[6]^p[3]>>>16^p[1]<<16;for(var y=0;y<4;y++)a[y]=(a[y]<<8|a[y]>>>24)&16711935|(a[y]<<24|a[y]>>>8)&4278255360,f[m+y]^=a[y]},blockSize:128/32,ivSize:64/32});function h(){for(var f=this._X,m=this._C,p=0;p<8;p++)c[p]=m[p];m[0]=m[0]+1295307597+this._b|0,m[1]=m[1]+3545052371+(m[0]>>>0<c[0]>>>0?1:0)|0,m[2]=m[2]+886263092+(m[1]>>>0<c[1]>>>0?1:0)|0,m[3]=m[3]+1295307597+(m[2]>>>0<c[2]>>>0?1:0)|0,m[4]=m[4]+3545052371+(m[3]>>>0<c[3]>>>0?1:0)|0,m[5]=m[5]+886263092+(m[4]>>>0<c[4]>>>0?1:0)|0,m[6]=m[6]+1295307597+(m[5]>>>0<c[5]>>>0?1:0)|0,m[7]=m[7]+3545052371+(m[6]>>>0<c[6]>>>0?1:0)|0,this._b=m[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var y=f[p]+m[p],g=y&65535,x=y>>>16,_=((g*g>>>17)+g*x>>>15)+x*x,v=((y&4294901760)*y|0)+((y&65535)*y|0);u[p]=_^v}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}i.RabbitLegacy=r._createHelper(l)}(),t.RabbitLegacy})}(cf)),cf.exports}var uf={exports:{}},Pv;function m3(){return Pv||(Pv=1,function(n,e){(function(t,i,s){n.exports=i(we(),mr(),pr(),Es(),Et())})(le,function(t){return function(){var i=t,s=i.lib,r=s.BlockCipher,o=i.algo;const a=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],u=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var l={pbox:[],sbox:[]};function h(g,x){let _=x>>24&255,v=x>>16&255,w=x>>8&255,I=x&255,T=g.sbox[0][_]+g.sbox[1][v];return T=T^g.sbox[2][w],T=T+g.sbox[3][I],T}function f(g,x,_){let v=x,w=_,I;for(let T=0;T<a;++T)v=v^g.pbox[T],w=h(g,v)^w,I=v,v=w,w=I;return I=v,v=w,w=I,w=w^g.pbox[a],v=v^g.pbox[a+1],{left:v,right:w}}function m(g,x,_){let v=x,w=_,I;for(let T=a+1;T>1;--T)v=v^g.pbox[T],w=h(g,v)^w,I=v,v=w,w=I;return I=v,v=w,w=I,w=w^g.pbox[1],v=v^g.pbox[0],{left:v,right:w}}function p(g,x,_){for(let D=0;D<4;D++){g.sbox[D]=[];for(let C=0;C<256;C++)g.sbox[D][C]=u[D][C]}let v=0;for(let D=0;D<a+2;D++)g.pbox[D]=c[D]^x[v],v++,v>=_&&(v=0);let w=0,I=0,T=0;for(let D=0;D<a+2;D+=2)T=f(g,w,I),w=T.left,I=T.right,g.pbox[D]=w,g.pbox[D+1]=I;for(let D=0;D<4;D++)for(let C=0;C<256;C+=2)T=f(g,w,I),w=T.left,I=T.right,g.sbox[D][C]=w,g.sbox[D][C+1]=I;return!0}var y=o.Blowfish=r.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,x=g.words,_=g.sigBytes/4;p(l,x,_)}},encryptBlock:function(g,x){var _=f(l,g[x],g[x+1]);g[x]=_.left,g[x+1]=_.right},decryptBlock:function(g,x){var _=m(l,g[x],g[x+1]);g[x]=_.left,g[x+1]=_.right},blockSize:64/32,keySize:128/32,ivSize:64/32});i.Blowfish=r._createHelper(y)}(),t.Blowfish})}(uf)),uf.exports}(function(n,e){(function(t,i,s){n.exports=i(we(),Mh(),q6(),z6(),mr(),G6(),pr(),D1(),Gp(),Y6(),A1(),J6(),K6(),Q6(),Yp(),j6(),Es(),Et(),X6(),Z6(),e3(),t3(),n3(),i3(),s3(),r3(),o3(),a3(),c3(),u3(),l3(),h3(),d3(),f3(),m3())})(le,function(t){return t})})(T1);var p3=T1.exports;const g3=ow(p3),{AES:y3,enc:uc,SHA256:Jp}=g3,_3="16charactersiv!";function v3(n,e){const t=w3(e),i=uc.Utf8.parse(_3);return y3.encrypt(n,t,{iv:i}).toString()}function w3(n){let e="htr;lmn;rkmnkryemnkrmnbavsdbshtg6437";return e=Jp(n+e).toString(uc.Hex).substring(0,32),uc.Utf8.parse(e)}function k5(n,e="simpleCode"){return n===""?"":Jp(n+e).toString(uc.Hex)}function x3({id:n}){if(n.length<7)return"";const e=n.substring(3,6),t=Jp(n+e).toString(uc.Hex);return t.substring(0,Math.min(10,t.length)).replace(/[/.*]/g,"")}function rr(n){return v3(n+zC,qC).replace("/","").replace("*","").replace(".","")}var Bn=(n=>(n[n.shortestTreatment=0]="shortestTreatment",n[n.longestTreatment=1]="longestTreatment",n[n.custom=2]="custom",n[n.first=3]="first",n[n.last=4]="last",n[n.edges=5]="edges",n))(Bn||{});const E3={3:"first",4:"last",5:"edges",0:"shortestTreatment",1:"longestTreatment",2:"custom"},I3={first:3,last:4,edges:5,shortestTreatment:0,longestTreatment:1,custom:2};class C1{constructor({start:e,end:t}){d(this,"start");d(this,"end");this.start=e,this.end=t}}function b1(n){n.sort((s,r)=>s.start.getTime()-r.start.getTime());const e=[];let t=0;for(let s=0;s<n.length;s=t){const r=n[s];for(e.push(r),t=s+1;t<n.length;t++){const o=n[t],a=_c(la(r.start),la(r.end),la(o.start),la(o.end));if(a==="AFTER")if(r.end.toUTCString()===o.start.toUTCString())r.end=o.end;else break;a==="STRIKE"&&(o.start.getTime()<r.start.getTime()&&(r.start=o.start),o.end.getTime()>r.end.getTime()&&(r.end=o.end))}}const i=[];return e.forEach(s=>{i.push(un(s.start)),i.push(un(s.end))}),i}function T3(n){const e=[];for(let t=0;t<n.length;t+=2){const i=kt(n[t]),s=kt(n[t+1]);e.push(new C1({start:i,end:s}))}return e}function Rv(n,e){for(let t=0;t<e.length;t+=2){const i=kt(e[t]),s=kt(e[t+1]);n.push(new C1({start:i,end:s}))}}class Zn{constructor({token:e="",joinDate:t,id:i="",activeNotifications:s=!0}){d(this,"token");d(this,"joinDate");d(this,"id");d(this,"activeNotifications");this.token=e,this.joinDate=t,this.id=i,this.activeNotifications=s}static fromJson(e,t){const i=new Zn({joinDate:new Date(0)});return i.id=t,i.activeNotifications=e.activeNotifications??!0,i.token=e.token??"",i}toJson(){const e={};return this.activeNotifications||(e.activeNotifications=this.activeNotifications),e.token=this.token,e.joinDate=Me(this.joinDate),e}static fromDevice(e){return new Zn({joinDate:e.joinDate,id:e.id,activeNotifications:e.activeNotifications,token:e.token})}}function ua(n,e=-1){let t="",i="",s="",r="",o="",a="",c=n.days;Math.floor(c/30)>0&&(Math.floor(c/30)===1&&(a=J("month")),Math.floor(c/30)===2&&(a=J("twoMonths")),Math.floor(c/30)>2&&(a=`${Math.floor(c/30)} `+J("months"))),c-=Math.floor(c/30)*30,Math.floor(c/7)>0&&(Math.floor(c/7)===1&&(o=J("week")),Math.floor(c/7)===2&&(o=J("twoWeeks")),Math.floor(c/7)>2&&(o=`${Math.floor(c/7)} `+J("weeks"))),c-=Math.floor(c/7)*7,c===1&&(r=J("day")),c===2&&(r=J("twoDays")),c>2&&(r=`${c} `+J("days"));let u=n.hours-n.days*24;u===1&&(t=J("hour")),u===2&&(t=J("twoHours")),u>2&&(t=`${u}`+J("hoursChar"));let l=n.minutes-n.hours*60;i=l>0?`${l}`+J("minutesChar"):"";let h=n.seconds-n.minutes*60;h===1&&(s=J("second",void 0,!1)),h>1&&(s=`${h} `+J("seconds"));let f="";return n.days===365?f=J("year"):n.days%365===0&&n.days>365?f=(n.days/365).toFixed(0)+" "+J("years"):o===""&&a!==""&&r===""?f=a:o!==""&&a===""&&r===""?f=o:o!==""&&a!==""&&r===""?f=a+" "+J("and")+o:o!==""&&a===""&&r!==""?f=o+" "+J("and")+r:o===""&&a!==""&&r!==""?f=a+" "+J("and")+r:o!==""&&a!==""&&r!==""?f=a+" ,"+o+" "+J("and")+r:i===""&&t===""&&r!==""?f=r:i!==""&&t===""&&r===""?f=i:i===""&&t!==""&&r===""?f=t:i!==""&&t!==""&&r===""?f=t+" "+J("and")+i:i!==""&&t===""&&r!==""?f=r+" "+J("and")+i:i===""&&t!==""&&r!==""?f=r+" "+J("and")+t:i!==""&&t!==""&&r!==""?f=r+" ,"+t+" "+J("and")+i:s!==""&&(f=s),f.length===0?"":e===-1||e>f.length?f:f.slice(0,e)+".."+f.slice(e)}function S5(n){const e=i=>i.toString().padStart(2,"0"),t=e(n.minutes%60);return`${e(n.hours)}:${t}`}function P5(n,e=""){let t="";Me(n)===Me(Nu(new Date,1))&&(t=J("tomorrow")),Me(n)===Me(new Date)&&(t=J("today"));const i=ZC[n.getDay()];return`${t!==""?t:e+J(i)}`}function D3(n){try{const e=n.indexOf("-");let t=n.substring(e+1,n.length);return t="0"+t,t.substring(0,3)+"-"+t.substring(3,t.length)}catch{return n}}var zn=(n=>(n[n.deposit=0]="deposit",n[n.payment=1]="payment",n))(zn||{});const C0={0:"deposit",1:"payment"},b0={deposit:0,payment:1};class qs{constructor({type:e=1,amount:t=0,id:i="",hypId:s="",createdAt:r=new Date(0)}){d(this,"type",1);d(this,"amount",0);d(this,"createdAt",new Date(0));d(this,"id","");d(this,"hypId","");this.type=e,this.amount=parseFloat(t.toFixed(2)),this.id=i,this.hypId=s,this.createdAt=r}static fromJson(e,t){const i=new qs({});return e.amount!=null&&(i.amount=e.amount),i.hypId=e.hypId||"",i.id=t,i.type=b0[e.type]||1,i.createdAt=e.createdAt?ae(e.createdAt):new Date(0),i}static fromTransaction(e){const t=new qs({});return t.type=e.type,t.amount=e.amount,t.id=e.id,t.hypId=e.hypId,t.createdAt=e.createdAt,t}toJson(){const e={};return e.amount=this.amount,e.hypId=this.hypId,e.type=C0[this.type],e.createdAt=oe(this.createdAt),e}toString(){return JSON.stringify(this.toJson(),null,2)}}class Gr{constructor({workMinutes:e=0,breakMinutes:t=0,title:i=""}){d(this,"workMinutes",0);d(this,"breakMinutes",0);d(this,"title","");this.workMinutes=e,this.breakMinutes=t,this.title=i}get wholeMinutes(){return this.workMinutes+this.breakMinutes}static fromTreatmentTime(e){return new Gr({breakMinutes:e.breakMinutes,workMinutes:e.workMinutes,title:e.title})}static fromJson(e){return new Gr({breakMinutes:e.break||0,workMinutes:e.duration||0,title:e.title||""})}toJson(){const e={};return e.break=this.breakMinutes,e.duration=this.workMinutes,e.title=this.title,e}toString(){return JSON.stringify(this,null,2)}}class bt{constructor({times:e=new Map,id:t="",price:i,count:s=1,name:r="",isMulti:o=!1,maxTicketsForUser:a=1,index:c="",amountInAdvance:u=0,colorIndex:l=-2,hide:h=!1,paymentType:f,note:m="",maxParticipants:p=1,showPrice:y=!0,showParticipants:g=!0,showTime:x=!0}={}){d(this,"totalMinutes",0);d(this,"index","");d(this,"id","");d(this,"note","");d(this,"price");d(this,"amountInAdvance",0);d(this,"paymentType");d(this,"isMulti",!1);d(this,"showPrice",!0);d(this,"showTime",!0);d(this,"count",1);d(this,"name","");d(this,"colorIndex",-2);d(this,"maxParticipants",1);d(this,"maxTicketsForUser",1);d(this,"tempMaxParticipants");d(this,"hide",!1);d(this,"showParticipants",!0);d(this,"times",new Map);d(this,"priceChangingNote");this.times=e,this.id=t,this.price=i,this.count=s,this.name=r,this.isMulti=o,this.maxTicketsForUser=a,this.index=c,this.amountInAdvance=u,this.colorIndex=l,this.hide=h,this.paymentType=f,this.note=m,this.maxParticipants=p,this.showPrice=y,this.showParticipants=g,this.showTime=x,this.totalMinutes=this.totalTotalMinutes}isEqual(e){return!0}get totalTotalMinutes(){let e=0;return this.times.forEach((t,i)=>{e+=t.wholeMinutes}),e}get totalWorkMinutes(){let e=0;return this.times.forEach((t,i)=>{e+=t.workMinutes}),e}get totalMinutesForBooking(){return this.totalMinutes*this.count}get amountInAdvanceForBooking(){return this.amountInAdvance*this.count}get totalPriceForBooking(){return this.price.amount*this.count}get nameForBooking(){return this.count===1?this.name:`${this.name} X${this.count}`}static fromTreatment(e){const t=new bt({times:new Map,showTime:e.showTime,paymentType:e.paymentType,id:e.id,hide:e.hide,showPrice:e.showPrice,price:e.price,index:e.index,maxTicketsForUser:e.maxTicketsForUser,colorIndex:e.colorIndex,name:e.name,isMulti:e.isMulti,note:e.note,count:e.count,maxParticipants:e.maxParticipants,amountInAdvance:e.amountInAdvance});return t.priceChangingNote=e.priceChangingNote,t.tempMaxParticipants=e.tempMaxParticipants,t.totalMinutes=e.totalMinutes,e.times.forEach((i,s)=>{t.times.set(s,Gr.fromTreatmentTime(i))}),t}static fromTreatmentsMap(e){let t=0;const i=new bt({price:new Vt({amount:"0",currency:Ci})});return e.forEach((s,r)=>{for(let o=0;o<s.count;o++)s.times.forEach((a,c)=>{i.times.set(t.toString(),a),t++}),s.price&&(i.price.amount+=s.price.amount,i.price.currency=s.price.currency),i.name===""?i.name=s.name:i.name+=` + ${s.name}`,i.showTime=i.showTime&&s.showTime,i.showPrice=i.showPrice&&s.showPrice,i.paymentType=s.paymentType,i.amountInAdvance+=s.amountInAdvance,i.totalMinutes+=s.totalMinutes}),i}get participants(){return this.tempMaxParticipants!==void 0?this.tempMaxParticipants:this.maxParticipants}priceToString(){return this.price.toString()}minutesToString(){return ua(new V({minutes:this.totalMinutes}))}static fromJson(e,t){const i=new bt({times:new Map,id:e.id||"",colorIndex:e.colorIndex||-2,maxTicketsForUser:e.maxTicketsForUser||1,index:t,hide:e.hide||!1,name:e.name||"",isMulti:e.isMulti||!1,note:e.note||"",count:e.count||1,price:e.price?Vt.fromJson(e.price):void 0,amountInAdvance:e.amountInAdvance!==void 0?typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance):0,maxParticipants:e.maxParticipants||1,paymentType:b0[e.paymentType],showPrice:e.showPrice||!1,showTime:e.showTime||!1,showParticipants:e.showParticipants||!0});if(i.priceChangingNote=e.priceChangingNote,i.tempMaxParticipants=e.tempMaxParticipants,e.times)for(const s in e.times)i.times.set(s,Gr.fromJson(e.times[s]));return i.totalMinutes=i.totalTotalMinutes,i}toJson(){const e={};return e.times={},this.times.forEach((t,i)=>{e.times[i]=t.toJson()}),e.name=this.name,this.note!==""&&(e.note=this.note),this.id!==""&&(e.id=this.id),this.hide&&(e.hide=this.hide),this.maxTicketsForUser>1&&(e.maxTicketsForUser=this.maxTicketsForUser),this.colorIndex!==-2&&(e.colorIndex=this.colorIndex),this.priceChangingNote!==void 0&&(e.priceChangingNote=this.priceChangingNote),e.price=this.price?this.price.toJson():void 0,this.amountInAdvance!==0&&(e.amountInAdvance=this.amountInAdvance),this.paymentType!=null&&C0[this.paymentType]!=null&&(e.paymentType=C0[this.paymentType]),this.isMulti&&(e.isMulti=this.isMulti),this.tempMaxParticipants!==void 0&&(e.tempMaxParticipants=this.tempMaxParticipants),this.count!==1&&(e.count=this.count),this.maxParticipants!==1&&(e.maxParticipants=this.maxParticipants),this.showParticipants||(e.showParticipants=this.showParticipants),e.showPrice=this.showPrice,e.showTime=this.showTime,e}static fromOldJson(e,t,i,s){const r=new bt({});if(e.times)for(const o in e.times)e.times.hasOwnProperty(o)&&r.times.set(o,Gr.fromJson(e.times[o]));return r.id="",r.colorIndex=s,r.index=t,r.name=r.parseNameFromDbField(i),e.price&&(r.price=Vt.fromJson(e.price)),e.amountInAdvance!==void 0&&(r.amountInAdvance=typeof e.amountInAdvance=="number"?e.amountInAdvance:parseFloat(e.amountInAdvance)),r.paymentType=b0[e.paymentType],r.showPrice=e.showPrice||!1,r.showTime=e.showTime||!1,r.totalMinutes=r.totalTotalMinutes,r}parseNameFromDbField(e){return e.replace(Jg,"/").replace(Kg,"*")}parseNameToDbField(e){return e.replace("/",Jg).replace("*",Kg)}toString(){return JSON.stringify(this,null,2)}}class Yr{constructor({treatmentId:e,minutes:t,maxParticipants:i,paymentRequestId:s,showWaitingList:r=!0,currentParticipants:o=0,expiredDate:a,index:c=0}){d(this,"treatmentId","");d(this,"currentParticipants",0);d(this,"maxParticipants");d(this,"minutes",0);d(this,"index",0);d(this,"showWaitingList",!0);d(this,"expiredDate");d(this,"paymentRequestId");this.treatmentId=e,this.currentParticipants=o,this.minutes=t,this.showWaitingList=r,this.maxParticipants=i,this.expiredDate=a,this.paymentRequestId=s,this.index=c}static fromMultiBookingTime(e){return new Yr({treatmentId:e.treatmentId,currentParticipants:e.currentParticipants,minutes:e.minutes,showWaitingList:e.showWaitingList,maxParticipants:e.maxParticipants,expiredDate:e.expiredDate,paymentRequestId:e.paymentRequestId,index:e.index})}static fromJson(e){const t=e.TI||"",i=e.CP||0,s=e.M||0,r=e.PRI,o=e.SWL||!0,a=e.ED,c=e.MP,u=e.I||0,l=a?ae(a):void 0;return new Yr({treatmentId:t,currentParticipants:i,minutes:s,maxParticipants:c,paymentRequestId:r,showWaitingList:o,expiredDate:l,index:u})}toJson(){const e={};return this.treatmentId!==""&&(e.TI=this.treatmentId),this.currentParticipants!==0&&(e.CP=this.currentParticipants),this.maxParticipants!==void 0&&(e.MP=this.maxParticipants),this.paymentRequestId!==void 0&&(e.PRI=this.paymentRequestId),e.M=this.minutes,this.index!==0&&(e.I=this.index),this.showWaitingList||(e.SWL=this.showWaitingList),this.expiredDate!==void 0&&(e.ED=oe(this.expiredDate)),e}}class Kp{constructor(){d(this,"times",{});d(this,"duringPaymentsTimes",{});d(this,"listener");d(this,"lastBookingTimeDate")}static fromJson(e){const t=new Kp;return t.setData(e),t}setData(e,t=!0){this.times={},e.eventsTimes!==null&&Object.entries(e.eventsTimes).forEach(([i,s])=>{const r=vt(i),o=Nu(new Date,-7);r>=o&&s instanceof Object&&Object.keys(s).length>0&&(this.times[i]={},Object.entries(s).forEach(([a,c])=>{this.times[i][a]=Yr.fromJson(c)}))}),e.eventsTimeDuringPayment!==null&&t&&Object.entries(e.eventsTimeDuringPayment).forEach(([i,s])=>{const r=vt(i),o=Nu(new Date,-7);r>=o&&Object.entries(s).forEach(([a,c])=>{var l,h;const u=Yr.fromJson(c);if(u.expiredDate!==null&&u.expiredDate.getTime()>Date.now()){if((l=this.times)[i]??(l[i]={}),this.times[i][a]===null){const f=Yr.fromMultiBookingTime(u);f.expiredDate=void 0,this.times[i][a]=f}else this.times[i][a].currentParticipants+=u.currentParticipants;r>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=r),(h=this.duringPaymentsTimes)[i]??(h[i]={}),this.duringPaymentsTimes[i][a]=u}})})}toJson(){const e={};return e.eventsTimes={},Object.entries(this.times).forEach(([t,i])=>{e.eventsTimes[t]={},Object.entries(i).forEach(([s,r])=>{e.eventsTimes[t][s]=r.toJson()})}),e}}class Jr{constructor(){d(this,"showAdressAlert",!1);d(this,"showAdressMessage",!1);d(this,"showPhoneAlert",!1);d(this,"showPhoneMessage",!1);d(this,"recurrenceNotificationsLastDate");d(this,"notifyOnPayments",!0);d(this,"notifyOnWaitingListEvents",!0);d(this,"notifyAboutCancelNearDeadline",!0);d(this,"notifyOnClientConfirmArrival",!0);d(this,"notifyAboutOrderNearDeadline",!0);d(this,"notificationOption",$e.PushOrSMS);d(this,"notifyWhenGettingBooking",!0);d(this,"remindersTypes",new Map)}static fromJson(e){const t=new Jr;if(t.notifyOnWaitingListEvents=e.notifyOnWaitingListEvents??!0,e.notificationOption!==void 0&&(t.notificationOption=Ml[e.notificationOption]??$e.PushOrSMS),t.recurrenceNotificationsLastDate=e.recurrenceNotificationsLastDate?ae(e.recurrenceNotificationsLastDate):void 0,t.remindersTypes=new Map,e.remindersTypes!==void 0)for(const[i,s]of Object.entries(e.remindersTypes)){const r=Ns[i];r!==void 0&&t.remindersTypes.set(r,s)}else t.remindersTypes.set(Gt.regular,e.minutesBeforeNotify??60);return t.notifyOnClientConfirmArrival=e.notifyOnClientConfirmArrival??!0,t.showAdressAlert=e.showAdressAlert??!1,t.showAdressMessage=e.showAdressMessage??!1,t.showPhoneAlert=e.showPhoneAlert??!1,t.showPhoneMessage=e.showPhoneMessage??!1,t.notifyOnPayments=e.notifyOnPayments??!0,t.notifyAboutCancelNearDeadline=e.notifyAboutCancelNearDeadline??!0,t.notifyAboutOrderNearDeadline=e.notifyAboutOrderNearDeadline??!0,t.notifyWhenGettingBooking=e.notifyWhenGettingBooking??!0,t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}static fromWorkerNotificatiosSettings(e){return Jr.fromJson(e.toJson())}toJson(){const e={};return this.notifyOnWaitingListEvents||(e.notifyOnWaitingListEvents=this.notifyOnWaitingListEvents),this.notificationOption!==$e.PushOrSMS&&(e.notificationOption=$e[this.notificationOption]),this.recurrenceNotificationsLastDate!=null&&(e.recurrenceNotificationsLastDate=oe(this.recurrenceNotificationsLastDate)),this.notifyOnClientConfirmArrival||(e.notifyOnClientConfirmArrival=this.notifyOnClientConfirmArrival),this.notifyOnPayments||(e.notifyOnPayments=this.notifyOnPayments),e.remindersTypes={},this.remindersTypes.forEach((t,i)=>{e.remindersTypes[Gt[i]]=t}),this.notifyAboutCancelNearDeadline||(e.notifyAboutCancelNearDeadline=this.notifyAboutCancelNearDeadline),this.notifyAboutOrderNearDeadline||(e.notifyAboutOrderNearDeadline=this.notifyAboutOrderNearDeadline),this.notifyWhenGettingBooking||(e.notifyWhenGettingBooking=this.notifyWhenGettingBooking),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showAdressMessage&&(e.showAdressMessage=this.showAdressMessage),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.showPhoneMessage&&(e.showPhoneMessage=this.showPhoneMessage),e}toString(){return JSON.stringify(this.toJson())}}class Kr{constructor({freeFromPayments:e=!1,hashNumber:t="",blocked:i=!1}={}){d(this,"freeFromPayments");d(this,"hashNumber");d(this,"blocked");this.freeFromPayments=e,this.hashNumber=t,this.blocked=i}static fromJson(e,t){return new Kr({freeFromPayments:e.freeFromPayments,hashNumber:t})}static fromMinimalJson(e,t){return new Kr({blocked:e.B??!1,freeFromPayments:e.FP,hashNumber:t})}static fromCustomerData(e){return new Kr({blocked:e.blocked,freeFromPayments:e.freeFromPayments,hashNumber:e.hashNumber})}toJson(){const e={};return e.freeFromPayments=this.freeFromPayments,e.blocked=this.blocked,e}toMinimalJson(){const e={};return e.FP=this.freeFromPayments,e.B=this.blocked,e}toString(){return JSON.stringify(this.toJson(),null,2)}}class Qp{constructor({publicCustomersData:e}={}){d(this,"publicCustomersData");this.publicCustomersData=e}static fromJson(e){return new Qp().setPublicCustomersDataJson(e)}setPublicCustomersDataJson(e){return e.data??(e.data={}),this.publicCustomersData={},Object.entries(e.data).forEach(([t,i])=>{const s=Kr.fromMinimalJson(i,t);this.publicCustomersData[t]=s}),this}toMinimalJson(){const e={};return e.data={},this.publicCustomersData??(this.publicCustomersData={}),Object.entries(this.publicCustomersData).forEach(([t,i])=>{e.data[t]=i.toMinimalJson()}),e}}class Ps extends Set{constructor(e,t){super(e),t&&this.sort(t)}sort(e){this.clear(),Array.from(this).sort(e).forEach(t=>this.add(t))}get last(){if(this.size===0)return;const e=Array.from(this);return e[e.length-1]}get isEmpty(){return this.size===0}elementAt(e){if(!(e<0||e>=this.size))return Array.from(this)[e]}intersection(e){const t=new Ps;return this.forEach(i=>{e.has(i)&&t.add(i)}),t}}const A3={0:"years",1:"months",2:"weeks",3:"days"},C3={years:0,months:1,weeks:2,days:3},b3={0:"YEARLY",1:"MONTHLY",2:"WEEKLY",3:"DAILY"};var k1=(n=>(n[n.endless=0]="endless",n[n.date=1]="date",n[n.repeats=2]="repeats",n))(k1||{});const lf=["SU","MO","TU","WE","TH","FR","SA"],hf={0:new V({days:365}),1:new V({days:30}),2:new V({days:7}),3:new V({days:1})};class On{constructor({start:e,endOption:t=2,endDate:i,repeats:s=10,interval:r=1,weekDays:o=new Ps,customEndDate:a,freqRecurrence:c=3,exceptionDates:u=new Set}){d(this,"start");d(this,"endDate");d(this,"repeats",10);d(this,"interval",1);d(this,"freqRecurrence",3);d(this,"weekDays",new Ps);d(this,"endOption",2);d(this,"exceptionDates",new Set);d(this,"customEndDate");this.start=e,this.weekDays=o,this.endOption=t,this.endDate=i,this.repeats=s,this.interval=r,this.customEndDate=a,this.freqRecurrence=c,this.exceptionDates=u}static fromJson(e,t){const i=new On({});return i.start=t,e.ED?(i.endDate=vt(e.ED),i.endOption=1):e.R?(i.repeats=e.R,i.endOption=2):i.endOption=0,i.interval=e.I||1,i.weekDays=new Ps(e.WD||[]),i.exceptionDates=new Set(Object.keys(e.EDA||{}).map(vt)),i.freqRecurrence=C3[e.FR]||3,i}toJson({saveStartDate:e=!1,saveEnd:t=!0,saveException:i=!0}){const s={};return t&&this.endDate&&this.endOption===1&&(s.ED=Me(this.endDate)),t&&this.endOption===2&&(s.R=this.repeats),this.interval!==1&&(s.I=this.interval),this.weekDays.size>0&&this.freqRecurrence===2&&(s.WD=[...this.weekDays]),i&&this.exceptionDates.size>0&&(s.EDA={},this.exceptionDates.forEach(r=>{s.EDA[Me(r)]=""})),e&&this.start&&(s.SD=oe(this.start)),s.FR=A3[this.freqRecurrence],s}static fromRecurrenceEvent(e){return new On({start:e.start,endDate:e.endDate,repeats:e.repeats,interval:e.interval,freqRecurrence:e.freqRecurrence,weekDays:new Ps(e.weekDays),endOption:e.endOption,exceptionDates:new Set(e.exceptionDates)})}isEqual(e){var t,i;return!this.start||!e.start||this.start.getTime()!==e.start.getTime()||(((t=this.endDate)==null?void 0:t.getTime())||0)!==(((i=e.endDate)==null?void 0:i.getTime())||0)?!1:this.repeats===e.repeats&&this.interval===e.interval&&this.freqRecurrence===e.freqRecurrence&&d_(e.weekDays,this.weekDays)&&d_(e.exceptionDates,this.exceptionDates)&&this.endOption===e.endOption}get syncfuString(){var t,i,s,r;let e=`FREQ=${b3[this.freqRecurrence]};`;if(this.freqRecurrence===1&&this.start&&(e+=`BYMONTHDAY=${this.start.getDate()};`),this.freqRecurrence===0&&this.start&&(e+=`BYMONTHDAY=${this.start.getDate()};BYMONTH=${this.start.getMonth()+1};`),e+=`INTERVAL=${this.interval};`,this.freqRecurrence===2&&this.weekDays.size>0&&(e+="BYDAY=",this.weekDays.forEach(o=>{o<lf.length&&(e+=lf[o]+",")}),e=e.slice(0,-1)+";"),this.customEndDate&&(this.endOption===0||this.endOfTheEvent&&this.endOfTheEvent>new Date)){const o=new Date(this.customEndDate.getFullYear(),this.customEndDate.getMonth(),this.customEndDate.getDate(),((t=this.start)==null?void 0:t.getHours())??0,((i=this.start)==null?void 0:i.getMinutes())??0);e+=`UNTIL=${In(o,"yyyyMMdd'T'HHmmss'Z'")}`}else switch(this.endOption){case 0:break;case 1:if(this.endDate){const o=new Date(this.endDate.getFullYear(),this.endDate.getMonth(),this.endDate.getDate(),((s=this.start)==null?void 0:s.getHours())??0,((r=this.start)==null?void 0:r.getMinutes())??0);e+=`UNTIL=${In(o,"yyyyMMdd'T'HHmmss'Z'")}`}break;case 2:e+=`COUNT=${this.repeats}`;break}return e}get accurances(){if(this.start&&this.endOption!==0){if(this.endOption===2)return this.repeats-this.exceptionDates.size;if(this.endOption===1&&this.endDate){let e=0;if(this.exceptionDates.forEach(t=>{t<=this.endDate&&e++}),this.freqRecurrence===2){let t=0;const i=As(this.start);this.weekDays.forEach(u=>{this.isAccureInDate({date:Q(i,new V({days:u})),considerException:!1})&&t++});const s=Math.abs(Q(i,new V({days:6})).getTime()-As(this.endDate).getTime()),r=Math.floor(s/this.rangeBetweenInterval.inMilliseconds),o=As(this.endDate);let a=0;return tn(o).getTime()!==tn(i).getTime()&&this.weekDays.forEach(u=>{this.isAccureInDate({date:Q(o,new V({days:u})),considerException:!1})&&a++}),r*this.weekDays.size+a+t-e}else if(this.freqRecurrence===1){const t=Lv(this.start,this.endDate);return Math.floor(t/this.interval)-e}else{const t=this.start.getTime()-this.endDate.getTime();return Math.floor(Math.abs(t)/this.rangeBetweenInterval.inDays)-e}}}}get rangeBetweenInterval(){return new V({minutes:hf[this.freqRecurrence].inMinutes*this.interval})}get endOfTheEvent(){const e=this.rangeBetweenInterval;if(this.endOption===1&&this.endDate!==void 0)return this.endDate??void 0;if(this.endOption===2)if(this.freqRecurrence===2){let t=0;const i=this.start.getDay()===7?0:this.start.getDay();this.weekDays.forEach(u=>{u>=i&&t++});const s=this.repeats-t,r=Math.ceil(s/this.weekDays.size),o=s%this.weekDays.size,a=Q(this.start,new V({minutes:e.inMinutes*r})),c=As(a);this.weekDays=new Ps(this.weekDays,(u,l)=>u-l);try{return Q(c,new V({days:o-1<0?this.weekDays.last:this.weekDays.elementAt(o-1)}))}catch{return}}else return this.freqRecurrence===1?ny(this.start,(this.repeats-1)*this.interval):Q(this.start,new V({minutes:e.inMinutes*(this.repeats-1)}))}get explainText(){if(this.start===void 0)return"";let e="";const t=new V({minutes:hf[this.freqRecurrence].inMinutes*this.interval});switch(this.freqRecurrence){case 0:e+=J("yearTamplate").replaceAll("DURATION",ua(t)).replaceAll("DATE",In(this.start,"dd/MM"));break;case 1:e+=J("monthTemplate").replaceAll("DURATION",ua(t)).replaceAll("DATE",this.start.getDate().toString());break;case 2:let s="";this.weekDays.forEach(r=>{s+=J(lf[r])+", "}),s=s.substring(0,s.length-2),e+=J("weekTemplate").replaceAll("DURATION",ua(t)).replaceAll("DAYS",s).replaceAll("AMOUNT",J(Object.keys(this.weekDays).length===1?"onDay":"onDays"));break;case 3:e+=J("dayTemplate").replaceAll("DURATION",ua(t));break}const i=this.endOfTheEvent;return i!==void 0&&(e+=` ${J("until")} ${Me(i)}`),e}isAccureInDate({date:e,considerException:t=!0}){if(this.start===void 0||tn(this.start)>e)return!1;const i=this.endOfTheEvent;if(i!==void 0&&i<tn(e)||t&&this.exceptionDates.has(tn(e)))return!1;const s=new V({minutes:hf[this.freqRecurrence].inMinutes*this.interval}),r=Us(e,tn(this.start)),o=this.start.getDay()===7?0:this.start.getDay(),a=e.getDay()===7?0:e.getDay();if(this.freqRecurrence===2){const c=7-o,u=s.inDays-o,l=(r.inDays+s.inDays)%s.inDays;return(l<c||l>=u)&&this.weekDays.has(a)}if(this.freqRecurrence===1){const c=Lv(this.start,e);return this.start.getDate()===e.getDate()&&c%this.interval===0}return r.inDays%s.inDays===0}addRangeBetween(e){return this.freqRecurrence===1?ny(e,this.interval):Q(e,this.rangeBetweenInterval)}overlapingDatesWith(e){if(this.start===void 0||e.start===void 0)return new Set([new Date(0)]);if(this.endOfTheEvent===void 0&&e.endOfTheEvent===void 0)return new Set([new Date(0)]);const t=new Set,i=this._getOptimalEventToPassOver(this,e),s=i[0],r=i[1];let o=s.start;for(;tn(o)<=tn(s.endOfTheEvent);){if(s.freqRecurrence===2){const a=As(o);s.weekDays.forEach(c=>{const u=Q(a,new V({days:c}));r.isAccureInDate({date:u})&&s.isAccureInDate({date:u})&&t.add(tn(u))})}else r.isAccureInDate({date:o})&&s.isAccureInDate({date:o})&&t.add(tn(o));o=this.addRangeBetween(o)}return t}get isRelevant(){return this.endOfTheEvent===void 0||this.endOfTheEvent>new Date}nearestFutureAccurenceDate(e,{needToBeAfterStart:t=!0}={}){if(console.log("eeeeeeeeeeeee",this.endOfTheEvent),this.endOfTheEvent!=null&&e>this.endOfTheEvent)return;if(this.start===void 0||e<this.start&&t&&this.isAccureInDate({date:this.start}))return this.start;const i=Us(e,this.start).inDays;if(this.freqRecurrence===2){const a=Math.floor(i/this.rangeBetweenInterval.inDays);let c=Q(this.start,new V({days:a*this.rangeBetweenInterval.inDays})),u=As(c);for(const l of this.weekDays){const h=Q(u,new V({days:l}));if(h>=e&&(this.endOfTheEvent===void 0||c<=this.endOfTheEvent))return h}c=Q(c,this.rangeBetweenInterval),u=As(c);for(const l of this.weekDays){const h=Q(u,new V({days:l}));if(h>=e&&(this.endOfTheEvent===void 0||c<=this.endOfTheEvent))return h}return}const s=Math.ceil(i/this.rangeBetweenInterval.inDays);let r=Q(this.start,new V({days:s*this.rangeBetweenInterval.inDays}));r<e&&(r=this.addRangeBetween(r));const o=this.endOfTheEvent;for(;!this.isAccureInDate({date:r})&&(o===void 0||r<o);)console.log(this.isAccureInDate({date:r})),r=this.addRangeBetween(r);if(o===void 0||r<=o)return r}_getOptimalEventToPassOver(e,t){return e.endOfTheEvent===void 0&&t.endOfTheEvent!==void 0?[t,e]:e.endOfTheEvent!==void 0&&t.endOfTheEvent===void 0?[e,t]:(t.jumps??99999)<(e.jumps??99999)?[t,e]:[e,t]}get jumps(){if(this.start===void 0||this.endOfTheEvent===void 0)return;const t=new V({milliseconds:this.start.getTime()-this.endOfTheEvent.getTime()}).inMinutes/this.rangeBetweenInterval.inMinutes;return Math.ceil(t*Math.max(this.weekDays.size,1))}toString(){return JSON.stringify(this,void 0,2)}}class vl{constructor({end:e,start:t,title:i="",id:s="",workerId:r=""}){d(this,"start",new Date(0));d(this,"end",new Date(0));d(this,"id","");d(this,"createdAt");d(this,"workerId","");d(this,"addedToDeviceCalendar",!1);d(this,"colorIndex",1);d(this,"title","");d(this,"recurrenceObj");this.start=t,this.end=e,this.title=i,this.id=s,this.workerId=r,this.recurrenceObj=new On({start:t,endDate:e,endOption:k1.date})}isOneDay(){return Me(this.end)===Me(this.start)}static fromEvent(e){var i;const t=new vl({});return t.start=e.from,(i=e.recurrenceEvent)!=null&&i.endDate&&(t.end=e.recurrenceEvent.endDate),t.title=e.eventName,t.createdAt=e.vacationCreatedAt,t.id=e.vacationId,t.recurrenceObj=e.recurrenceEvent,t.addedToDeviceCalendar=e.vacationAddedToDeviceCalendar,t.colorIndex=e.colorIndex,t.workerId=e.ids.length>0?e.ids[0]:"",t}static fromVacation(e){const t=new vl({});return t.start=e.start,t.end=e.end,t.addedToDeviceCalendar=e.addedToDeviceCalendar,t.id=e.id,t.createdAt=e.createdAt,t.workerId=e.workerId,t.title=e.title,t.colorIndex=e.colorIndex,t}}class k3{constructor(){d(this,"listener");d(this,"recurrenceEvents",{});d(this,"vacationsEvents",{})}get recurrenceEventsList(){const e=[];return Object.entries(this.recurrenceEvents).forEach(([t,i])=>{e.push(...Object.values(i))}),e}get recurrenceEventsListWithOutVacations(){const e=[];return Object.entries(this.recurrenceEvents).forEach(([t,i])=>{Object.entries(i).forEach(([s,r])=>{r.isVacation||e.push(r)})}),e}setRecurrenceEvents(e,t,i,{putBreaks:s=!0}={}){this.recurrenceEvents={},this.vacationsEvents={},Object.entries(e).forEach(([r,o])=>{this.recurrenceEvents[r]={};const a=vt(r);Object.entries(o).forEach(([c,u])=>{let l="",h="";const f=c.split("_");f.length===2&&(l=f[1]),h=f[0];const m=dc.fromJson({json:u,timeStr:h,businessModel:i,newTimeId:l,dayString:P0(a),monthString:_s(a),workerId:t});m.isVacation&&(this.vacationsEvents[Me(m.from)]=m),!(!s&&m.isBreak)&&(this.recurrenceEvents[r][c]=m)})})}vacationInDate(e){var t;for(const i of Object.values(this.vacationsEvents))if((t=i.recurrenceEvent)!=null&&t.isAccureInDate({date:e}))return vl.fromEvent(i)}}const S3={R:"R",A:"A"},P3={R:"R",A:"A"};class wl{constructor({start:e,end:t,operation:i,shifts:s}){d(this,"start",new Date(0));d(this,"end",new Date(0));d(this,"operation","R");d(this,"shifts",[]);this.start=e,this.end=t,this.operation=i,this.shifts=s}static fromJson(e,t){const i=t.split("&"),s=vt(i[0]),r=vt(i[1]),o=P3[e.operation]||"R",a=e.shifts.map(c=>c);return new wl({start:s,end:r,operation:o,shifts:a})}static fromShiftChangeRange(e){const{start:t,end:i,operation:s,shifts:r}=e;return new wl({start:t,end:i,operation:s,shifts:[...r]})}isSameAs(e){return this.start.getTime()===e.start.getTime()&&this.end.getTime()===e.end.getTime()&&this.operation===e.operation&&this.shifts.toString()===e.shifts.toString()}toJson(){return{operation:S3[this.operation],shifts:this.shifts}}combineShifts(e){if(this.operation==="R")return this.shifts;const t=[];return Rv(t,e),Rv(t,this.shifts),b1(t)}getKey(){const e=Me(this.start),t=Me(this.end);return`${e}&${t}`}toString(){return JSON.stringify(this.toJson())}}class xl{constructor({name:e,treatments:t,index:i}){d(this,"name","");d(this,"index","");d(this,"treatments",new Map);this.name=e,this.treatments=t,this.index=i}static fromJson(e,t,{pointerShortBookingTime:i,pointerLognestBookingTime:s}={}){const r=e.name||"",o=t,a=new Map;return e.treatments&&Object.entries(e.treatments).forEach(([c,u])=>{a.set(c,bt.fromJson(u,c)),i&&(a.get(c).totalMinutes<i[0]&&(i[0]=Math.max(a.get(c).times.get("0").workMinutes,5)),a.get(c).totalMinutes===i[0]&&(i[0]=Math.min(Math.max(a.get(c).times.get("0").workMinutes,5),i[0]))),s&&a.get(c).totalMinutes>s[0]&&(s[0]=Math.max(a.get(c).totalMinutes,5))}),new xl({name:r,treatments:a,index:o})}containTreatment(e){for(const[t,i]of this.treatments)if(i.id===e)return!0;return!1}toJson(){const e={};return e.name=this.name,e.treatments={},Object.entries(this.treatments).forEach(([t,i])=>{e.treatments[t]=i.toJson()}),e}fromTreatmentSubject(e){return this.name=e.name,this.index=e.index,this.treatments=new Map,e.treatments.forEach((t,i)=>{this.treatments.set(i,bt.fromTreatment(t))}),this}toString(){return JSON.stringify(this.toJson(),null,2)}}const S1=new Set([new Date(2023,10,29)]);class R3{constructor(){d(this,"bookingsTimes",{});d(this,"lastBookingTimeDate");d(this,"duringPaymentBookingsTime",{});d(this,"listener")}findLastBookingsTimesDate(){let e;return Object.entries(this.bookingsTimes).forEach(([t,i])=>{const s=vt(t);Object.keys(i).length>0&&(!e||s>e)&&(e=s)}),e}setWorkerPublicData(e,t=!0){this.duringPaymentBookingsTime={},this.bookingsTimes={},S1.forEach(i=>{i=Q(i,new V({hours:1})),this.bookingsTimes[Me(i)]={[un(i)]:60}}),e.bookingsTimes!=null&&Object.entries(e.bookingsTimes).forEach(([i,s])=>{const r=vt(i),o=Rn(new Date,new V({days:7}));r>=o&&Object.keys(s).length!=0&&(this.bookingsTimes[i]={},Object.entries(s).forEach(([a,c])=>{a.includes("00:00v")?t&&(this.bookingsTimes[i]={"00:00":1439}):(a!=="00:00"||this.bookingsTimes[i]["00:00"]!=1439)&&(this.bookingsTimes[i][a]=c)}),Object.keys(s).length>0&&r>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=r))}),e.duringPaymentBookingsTime!==null&&Object.entries(e.duringPaymentBookingsTime).forEach(([i,s])=>{const r=vt(i),o=Nu(new Date,-7);r>=o&&Object.entries(s).forEach(([a,c])=>{c.length===2&&c[0]instanceof Le&&c[0].toDate().getTime()>Date.now()&&typeof c[1]=="number"&&(i in this.bookingsTimes?this.bookingsTimes[i][a]=c[1]:this.bookingsTimes[i]={[a]:c[1]},r>(this.lastBookingTimeDate||new Date(0))&&(this.lastBookingTimeDate=r),i in this.duringPaymentBookingsTime?this.duringPaymentBookingsTime[i][a]=c:this.duringPaymentBookingsTime[i]={[a]:c})})})}emptyBookingTimesDatesInMonth(e){Object.entries(this.bookingsTimes).forEach(([t,i])=>{t.includes(e)&&(this.bookingsTimes[t]={})})}toWorkerPublicDataJson(){const e={};return e.bookingsTimes={},Object.entries(this.bookingsTimes).forEach(([t,i])=>{e.bookingsTimes[t]={},Object.entries(i).forEach(([s,r])=>{e.bookingsTimes[t][s]=r})}),e.duringPaymentBookingsTime={},Object.entries(this.duringPaymentBookingsTime).forEach(([t,i])=>{e.duringPaymentBookingsTime[t]={},Object.entries(i).forEach(([s,r])=>{e.duringPaymentBookingsTime[t][s]=r})}),e}}class lc{constructor({}){d(this,"daysToAllowBookings",7);d(this,"name","");d(this,"phone","");d(this,"id","");d(this,"profileImg","");d(this,"about","");d(this,"maxTreatments",5);d(this,"allowAppNotification",!0);d(this,"religions",[]);d(this,"waitingListExceptionDays",new Set);d(this,"closeScheduleOnHolidays",!1);d(this,"weekendDays",[5,6]);d(this,"onHoldMinutes",0);d(this,"cancelMinutes",0);d(this,"minutesBeforeBookingToConfirm",1440);d(this,"tempFcm");d(this,"hasRecurrenceEvents",!1);d(this,"windowSpaces",Bn.shortestTreatment);d(this,"customWindowMinute",30);d(this,"showWaitingListWhenThereIsChoises",!0);d(this,"isVerifiedPhone",!1);d(this,"lastCleanDate",new Date);d(this,"gender",Ie.anonymous);d(this,"deleteNeerDedlineBookingMessage");d(this,"orderNeerDedlineBookingMessage");d(this,"generalBookingMessage");d(this,"closeCalendarDate");d(this,"minDateForShowinData",new Date(0));d(this,"openCalendar",!0);d(this,"maxFutureBookings",4);d(this,"currentClientCount",0);d(this,"showVacations",!0);d(this,"mustVerifyPhone",!0);d(this,"allowBookingConfirmations",!0);d(this,"devices",new Map);d(this,"storyImages",new Map);d(this,"createdAt",new Date(0));d(this,"workTime",new Map([["sunday",[]],["monday",[]],["tuesday",[]],["wednesday",[]],["thursday",[]],["friday",[]],["saturday",[]]]));d(this,"isCustomersNeedRecurrence",!1);d(this,"specificRangeChanges",new Map);d(this,"treatmentsSubjects",new Map);d(this,"workerPublicData",new R3);d(this,"publicCustomers",new Qp);d(this,"storylikesAmount",{});d(this,"multiEventsTimes",new Kp);d(this,"generalBookingsCount",0);d(this,"passedBookingsCount",0);d(this,"shortBookingTime",999);d(this,"longestBookingTime",0);d(this,"recurrence",new k3);d(this,"notifications",new Jr);d(this,"workerDocListner")}static fromUserPublicData(e){const t=new lc({});return t.phone=e.phoneNumber||"",t.currentClientCount=e.currentClientCount||0,t.id=e.id||t.phone,t.name=e.name||"",e.devices!=null&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([i,s])=>{t.devices.set(i,Zn.fromJson(s,i))}):e.currentFcm!=null&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),t.gender=Ri[e.gender]||Ie.anonymous,t.lastCleanDate=new Date,t.createdAt=new Date,t.notifications.remindersTypes=new Map([[Gt.regular,60]]),t}static fromWorkerDocJson(e){const t=new lc({});return t.setFromWorkerDoc(e),t}get treatmentsLength(){let e=0;return Object.values(this.treatmentsSubjects).forEach(t=>{e+=Object.values(t.treatments).length}),e}shiftsFor({day:e}){const t=this.workTime.get(In(e,"EEEE").toLowerCase())||[];console.log("this.workTime",this.workTime),console.log("format(day, EEEE).toLowerCase()",In(e,"EEEE").toLowerCase()),console.log("defaultShifts",t);for(const i of Object.values(this.specificRangeChanges))if(_c(i.start,new Date(i.end.getTime()+23*60*60*1e3+59*60*1e3),e,e)==="STRIKE")return i.combineShifts(t);return b1(T3(t))}get fcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm!=null)return new Set([this.tempFcm]);const e=new Set;for(const t of Object.values(this.devices))t.activeNotifications&&e.add(t.token);return e}isClosingDate(e){return!this.openCalendar||this.closeCalendarDate!=null&&tn(this.closeCalendarDate).getTime()===tn(e).getTime()}hasTreatemnt(e){for(const[t,i]of this.treatmentsSubjects)if(i.containTreatment(e))return!0;return!1}get useWhatsApp(){return this.notifications.notificationOption===$e.WhatsApp||this.notifications.notificationOption===$e.PushOrWhatsApp}setFromWorkerDoc(e){if(this.daysToAllowBookings=e.daysToAllowBookings||7,this.profileImg=e.profileImg||"",this.about=e.about||"",e.lastCleanDate instanceof Le?this.lastCleanDate=e.lastCleanDate.toDate():typeof e.lastCleanDate=="string"&&(this.lastCleanDate=ae(e.lastCleanDate)),e.religions&&(this.religions=e.religions.map(t=>XC[t])),e.windowSpaces&&(this.windowSpaces=I3[e.windowSpaces]||Bn.shortestTreatment),this.isCustomersNeedRecurrence=e.isCustomersNeedRecurrence||!1,this.showWaitingListWhenThereIsChoises=e.showWaitingListWhenThereIsChoises||!0,this.customWindowMinute=e.customWindowMinute||30,this.closeScheduleOnHolidays=e.closeScheduleOnHolidays||!1,this.weekendDays=e.weekendDays||[5,6],this.mustVerifyPhone=e.mustVerifyPhone||!0,this.showVacations=e.showVacations||!0,this.gender=Ri[e.gender]||Ie.anonymous,this.allowAppNotification=e.allowAppNotification||!0,this.name=e.name||"",this.maxTreatments=e.maxTreatments||3,this.phone=e.phone||"",this.hasRecurrenceEvents=e.hasRecurrenceEvents||!1,this.id=e.id||e.phone||"",this.minutesBeforeBookingToConfirm=e.minutesBeforeBookingToConfirm||1440,this.maxFutureBookings=e.maxFutureBookings||4,this.treatmentsSubjects=new Map,this.shortBookingTime=999,e.treatmentsSubjects){let t=[this.shortBookingTime],i=[this.longestBookingTime];Object.entries(e.treatmentsSubjects).forEach(([s,r])=>{const o=xl.fromJson(r,s,{pointerShortBookingTime:t,pointerLognestBookingTime:i});this.treatmentsSubjects.set(s,o)}),this.shortBookingTime=t[0],this.longestBookingTime=i[0]}else if(e.treatments){const t=new Map;let i=0;Object.entries(e.treatments).forEach(([s,r])=>{const o=bt.fromOldJson(r,i.toString(),s,i+4);t.set(i.toString(),o),o.totalMinutes<this.shortBookingTime&&(this.shortBookingTime=Math.max(o.times.get("0").workMinutes,5)),o.totalMinutes===this.shortBookingTime&&(this.shortBookingTime=Math.min(Math.max(o.times.get("0").workMinutes,5),this.shortBookingTime)),i+=1}),this.treatmentsSubjects=new Map([["0",new xl({name:J("general"),treatments:t,index:"0"})]])}this.onHoldMinutes=e.onHoldMinutes||0,this.cancelMinutes=e.cancelMinutes||0,e.devices!=null&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,i])=>{this.devices.set(t,Zn.fromJson(i,t))}),this.deleteNeerDedlineBookingMessage=e.deleteNeerDedlineBookingMessage,this.orderNeerDedlineBookingMessage=e.orderNeerDedlineBookingMessage,this.generalBookingMessage=e.generalBookingMessage,this.workTime=new Map,e.workTime&&Object.entries(e.workTime).forEach(([t,i])=>{this.workTime.set(t,i.map(s=>s))}),this.waitingListExceptionDays=new Set,e.waitingListExceptionDays&&e.waitingListExceptionDays.forEach(t=>{this.waitingListExceptionDays.add(t)}),e.notifications?this.notifications=Jr.fromJson(e.notifications):(this.notifications=new Jr,this.notifications.notifyOnWaitingListEvents=e.notifyOnWaitingListEvents||!0,this.notifications.showAdressAlert=e.showAdressAlert||!1,this.notifications.showAdressMessage=e.showAdressMessage||!1,this.notifications.showPhoneAlert=e.showPhoneAlert||!1,this.notifications.showPhoneMessage=e.showPhoneMessage||!1,this.notifications.remindersTypes=new Map([[Gt.regular,e.minutesBeforeNotify||60]]),this.notifications.notifyOnPayments=e.notifyOnPayments||!0,this.notifications.notifyAboutCancelNearDeadline=e.notifyAboutCancelNearDeadline||!0,this.notifications.notifyAboutOrderNearDeadline=e.notifyAboutOrderNearDeadline||!0,this.notifications.notifyWhenGettingBooking=e.notifyWhenGettingBooking||!0,e.notificationOption&&(this.notifications.notificationOption=Ml[e.notificationOption]||$e.OnlyPush),e.recurrenceNotificationsLastDate?this.notifications.recurrenceNotificationsLastDate=ae(e.recurrenceNotificationsLastDate):this.notifications.recurrenceNotificationsLastDate=new Date),this.specificRangeChanges=new Map,e.specificRangeChanges&&Object.entries(e.specificRangeChanges).forEach(([t,i])=>{const s=wl.fromJson(i,t);s.end>=tn(new Date)&&this.specificRangeChanges.set(t,s)}),this.storyImages=new Map,e.storyImages&&Object.entries(e.storyImages).forEach(([t,i])=>{this.storyImages.set(t,i)}),e.closeCalendarDate&&(this.closeCalendarDate=ae(e.closeCalendarDate)),e.minDateForShowinData&&(this.minDateForShowinData=vt(e.minDateForShowinData)),this.openCalendar=e.openCalendar||!0,this.allowBookingConfirmations=e.allowBookingConfirmations||!0,e.createdAt?this.createdAt=ae(e.createdAt):this.createdAt=new Date(2023,0,1),this.id===this.phone?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1}getInvoiceWorkerInfo(){return new InvoiceWorkerInfo({workerId:this.id,workerName:this.name})}getFcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm!=null)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}toWorkerDocJson(){const e={};return e.workTime={},Object.entries(this.workTime).forEach(([t,i])=>{e.workTime[t]=i}),e.specificRangeChanges={},Object.entries(this.specificRangeChanges).forEach(([t,i])=>{e.specificRangeChanges[t]=i.toJson()}),e.religions=[],this.religions.forEach(t=>{e.religions.push(jC[t])}),this.closeCalendarDate!=null&&(e.closeCalendarDate=new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}).format(this.closeCalendarDate)),this.minDateForShowinData.getFullYear()!=new Date(0).getFullYear()&&(e.minDateForShowinData=Me(this.minDateForShowinData)),this.openCalendar||(e.openCalendar=this.openCalendar),e.allowBookingConfirmations=this.allowBookingConfirmations,this.mustVerifyPhone||(e.mustVerifyPhone=this.mustVerifyPhone),this.isCustomersNeedRecurrence&&(e.isCustomersNeedRecurrence=this.isCustomersNeedRecurrence),e.weekendDays=this.weekendDays,e.maxTreatments=this.maxTreatments,e.gender=eo[this.gender],e.onHoldMinutes=this.onHoldMinutes,e.cancelMinutes=this.cancelMinutes,this.hasRecurrenceEvents&&(e.hasRecurrenceEvents=this.hasRecurrenceEvents),this.showVacations||(e.showVacations=this.showVacations),e.devices={},Object.entries(this.devices).forEach(([t,i])=>{e.devices[t]=i.toJson()}),e.deleteNeerDedlineBookingMessage=this.deleteNeerDedlineBookingMessage,e.orderNeerDedlineBookingMessage=this.orderNeerDedlineBookingMessage,e.generalBookingMessage=this.generalBookingMessage,e.closeScheduleOnHolidays=this.closeScheduleOnHolidays,this.customWindowMinute!=30&&(e.customWindowMinute=this.customWindowMinute),this.windowSpaces!=Bn.shortestTreatment&&(e.windowSpaces=E3[this.windowSpaces]),this.minutesBeforeBookingToConfirm!=1440&&(e.minutesBeforeBookingToConfirm=this.minutesBeforeBookingToConfirm),e.bookingDaysToDeleteLocal=[],e.notifications=this.notifications.toJson(),e.lastCleanDate=this.lastCleanDate.toString(),e.daysToAllowBookings=this.daysToAllowBookings,this.maxFutureBookings!=4&&(e.maxFutureBookings=this.maxFutureBookings),this.currentClientCount!=0&&(e.currentClientCount=this.currentClientCount),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),this.waitingListExceptionDays.entries.length>0&&(e.waitingListExceptionDays=Array.from(this.waitingListExceptionDays)),e.treatmentsSubjects={},Object.entries(this.treatmentsSubjects).forEach(([t,i])=>{e.treatmentsSubjects[t]=i.toJson()}),this.showWaitingListWhenThereIsChoises||(e.showWaitingListWhenThereIsChoises=this.showWaitingListWhenThereIsChoises),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.profileImg=this.profileImg,e.about=this.about,e.name=name,e.phone=this.phone,e.id=this.id,e.storyImages={},Object.entries(this.storyImages).forEach(([t,i])=>{e.storyImages[t]=i}),e.createdAt=oe(this.createdAt),e}toString(){return JSON.stringify(this.toWorkerDocJson())+this.workerPublicData.toWorkerPublicDataJson().toString()}}function P1({booking:n,worker:e,notificationOption:t,customHsEnoughMessages:i}){if(t=t||(e==null?void 0:e.notifications.notificationOption),!t)return Z.none;const s=i||Xe.GI().business.businessData.messagesCounter>1;switch(t){case $e.OnlyPush:return Object.values(n.userFcms).length===0?Z.none:Z.push;case $e.SMSOnly:return!n.canSendMessage||!s?Z.none:Z.message;case $e.WhatAppOnly:return!n.canSendMessage||!s?Z.none:Z.whatsapp;case $e.PushOrSMS:return Object.values(n.userFcms).length>0?Z.push:!n.canSendMessage||!s?Z.none:Z.message;case $e.PushOrWhatsApp:return Object.values(n.userFcms).length>0?Z.push:!n.canSendMessage||!s?Z.none:Z.whatsapp;case $e.SMSOrPush:return n.canSendMessage&&s?Z.message:Object.values(n.userFcms).length>0?Z.push:Z.none;case $e.WhatsAppOrPush:return n.canSendMessage&&s?Z.whatsapp:Object.values(n.userFcms).length>0?Z.push:Z.none;default:return Z.none}}function N3(n,e){const t=Xe.GI().business.businessData.messagesCounter>1;switch(e.notifications.notificationOption){case $e.OnlyPush:return Object.keys(n.userFcms).length===0?Z.none:Z.push;case $e.SMSOnly:return!n.canSendMessage||!t?Z.none:Z.message;case $e.WhatAppOnly:return!n.canSendMessage||!t?Z.none:Z.whatsapp;case $e.PushOrSMS:return Object.values(n.userFcms).length>0?Z.push:!n.canSendMessage||!t?Z.none:Z.message;case $e.PushOrWhatsApp:return Object.values(n.userFcms).length>0?Z.push:!n.canSendMessage||!t?Z.none:Z.whatsapp;case $e.SMSOrPush:return n.canSendMessage&&t?Z.message:Object.values(n.userFcms).length>0?Z.push:Z.none;case $e.WhatsAppOrPush:return n.canSendMessage&&t?Z.whatsapp:Object.values(n.userFcms).length>0?Z.push:Z.none;default:return Z.none}}var k0={exports:{}},Nv=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Nv){var Mv=new Uint8Array(16);k0.exports=function(){return Nv(Mv),Mv}}else{var Ov=new Array(16);k0.exports=function(){for(var e=0,t;e<16;e++)e&3||(t=Math.random()*4294967296),Ov[e]=t>>>((e&3)<<3)&255;return Ov}}var R1=k0.exports,N1=[];for(var mu=0;mu<256;++mu)N1[mu]=(mu+256).toString(16).substr(1);function M3(n,e){var t=e||0,i=N1;return[i[n[t++]],i[n[t++]],i[n[t++]],i[n[t++]],"-",i[n[t++]],i[n[t++]],"-",i[n[t++]],i[n[t++]],"-",i[n[t++]],i[n[t++]],"-",i[n[t++]],i[n[t++]],i[n[t++]],i[n[t++]],i[n[t++]],i[n[t++]]].join("")}var M1=M3,O3=R1,F3=M1,Fv,df,ff=0,mf=0;function B3(n,e,t){var i=e&&t||0,s=e||[];n=n||{};var r=n.node||Fv,o=n.clockseq!==void 0?n.clockseq:df;if(r==null||o==null){var a=O3();r==null&&(r=Fv=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=df=(a[6]<<8|a[7])&16383)}var c=n.msecs!==void 0?n.msecs:new Date().getTime(),u=n.nsecs!==void 0?n.nsecs:mf+1,l=c-ff+(u-mf)/1e4;if(l<0&&n.clockseq===void 0&&(o=o+1&16383),(l<0||c>ff)&&n.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ff=c,mf=u,df=o,c+=122192928e5;var h=((c&268435455)*1e4+u)%4294967296;s[i++]=h>>>24&255,s[i++]=h>>>16&255,s[i++]=h>>>8&255,s[i++]=h&255;var f=c/4294967296*1e4&268435455;s[i++]=f>>>8&255,s[i++]=f&255,s[i++]=f>>>24&15|16,s[i++]=f>>>16&255,s[i++]=o>>>8|128,s[i++]=o&255;for(var m=0;m<6;++m)s[i+m]=r[m];return e||F3(s)}var L3=B3,V3=R1,U3=M1;function W3(n,e,t){var i=e&&t||0;typeof n=="string"&&(e=n==="binary"?new Array(16):null,n=null),n=n||{};var s=n.random||(n.rng||V3)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e)for(var r=0;r<16;++r)e[i+r]=s[r];return e||U3(s)}var H3=W3,$3=L3,O1=H3,jp=O1;jp.v1=$3;jp.v4=O1;var q3=jp;const Xp=ow(q3);class Pi{constructor({monthStr:e,invoiceId:t,docId:i,amount:s,issuedBy:r}){d(this,"invoiceId","");d(this,"docId","");d(this,"monthStr","");d(this,"issuedBy","");d(this,"amount",0);this.monthStr=e,this.invoiceId=t,this.docId=i,this.amount=s,this.issuedBy=r}toJson(){const e={};return e.monthStr=this.monthStr,e.docId=this.docId,e.issuedBy=this.issuedBy,e.amount=this.amount,e}static fromJson(e,t,i){const s=new Pi({});return s.invoiceId=t,s.docId=e.docId??"",s.monthStr=e.monthStr??"",s.issuedBy=e.issuedBy??i,e.amount!=null&&(s.amount=typeof e.amount=="number"?e.amount:parseFloat(e.amount)),s}static fromBookingInvoiceData(e){const t=new Pi({});return t.invoiceId=e.invoiceId,t.docId=e.docId,t.monthStr=e.monthStr,t.issuedBy=e.issuedBy,t.amount=e.amount,t}toString(){return JSON.stringify(this.toJson(),null,2)}}class gr{constructor({userId:e="",name:t="",gender:i=Ie.male,isVerifiedPhone:s=!1,phone:r="",isExist:o=!0,userDecline:a=!1}){d(this,"userId","");d(this,"name","");d(this,"gender",Ie.male);d(this,"phone","");d(this,"payments",{});d(this,"isExist",!1);d(this,"fcmTokens");d(this,"isVerifiedPhone",!1);d(this,"userDecline",!1);this.userId=e,this.name=t,this.gender=i,this.isVerifiedPhone=s,this.phone=r,this.isExist=o,this.userDecline=a}get customerHashPhone(){return rr(this.phone)}get customerPhoneAsCollection(){return this.phone.replaceAll("-","")}get isPaid(){return Object.keys(this.payments).length>0}static fromJson(e,t){const i=new gr({userId:t,name:e.N??"",gender:e.G?Ri[e.G]:Ie.male,isVerifiedPhone:e.IVP??!1,phone:e.P??"",isExist:e.IE??!0,userDecline:e.UD??!1});return e.PY!=null&&typeof e.PY=="object"&&Object.entries(e.PY).forEach(([s,r])=>{i.payments[s]=ae(r)??new Date(0)}),i}toJson(){const e={};return e.N=this.name,this.isVerifiedPhone&&(e.IVP=this.isVerifiedPhone),this.isExist||(e.IE=this.isExist),e.P=this.phone,this.gender!==Ie.male&&(e.G=Ie[this.gender]),Object.keys(this.payments).length>0&&(e.PY={},Object.entries(this.payments).forEach(([t,i])=>{e.PY[t]=oe(i)})),this.userDecline&&(e.UD=this.userDecline),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class vo{constructor({createdAt:e,amount:t,id:i,showUser:s,description:r=""}){d(this,"createdAt",new Date(0));d(this,"id","");d(this,"amount",0);d(this,"description","");d(this,"showUser",!1);this.createdAt=e,this.amount=t,this.id=i,this.showUser=s,this.description=r}static fromJson(e,t){return new vo({createdAt:e.createdAt?ae(e.createdAt):new Date(0),amount:e.amount!=null?typeof e.amount=="number"?e.amount:parseFloat(e.amount):0,id:t,showUser:e.showUser??!1,description:e.description??""})}static fromDebt(e){return new vo({createdAt:e.createdAt,amount:e.amount,id:e.id,showUser:e.showUser,description:e.description})}isEqual(e){return e.id===this.id&&e.description===this.description&&e.showUser===this.showUser&&oe(e.createdAt)===oe(this.createdAt)&&this.amount===e.amount}toJson(){const e={};return e.createdAt=oe(this.createdAt),e.amount=this.amount,this.showUser&&(e.showUser=this.showUser),this.description!==""&&(e.description=this.description),e}}const{v4:z3}=Xp;class Zp{constructor(){d(this,"customerName","");d(this,"customerPhone","");d(this,"isVerifiedPhone",!1);d(this,"notificationType",Z.none);d(this,"workerNotificationOption",$e.PushOrSMS);d(this,"workerRemindersTypes",new Map);d(this,"customerId","");d(this,"orderingOptions",_n.app);d(this,"remindersTypes",new Map);d(this,"isUserExist",!0);d(this,"signOnDeviceCalendar",!1);d(this,"lastTimeNotifyOnDebt",null);d(this,"clientMail","");d(this,"finishInvoices",!1);d(this,"showAdressAlert",!1);d(this,"userBookingId","");d(this,"showPhoneAlert",!1);d(this,"cancelDate",null);d(this,"wasWaiting",!1);d(this,"createdAt",new Date(0));d(this,"needCancel",!1);d(this,"userGender",Ie.anonymous);d(this,"status",Bt.approved);d(this,"confirmedArrival",!1);d(this,"userFcms",new Set);d(this,"clientNote","");d(this,"invoices",new Map);d(this,"transactions",new Map);d(this,"debts",new Map);d(this,"addToClientAt",!1);d(this,"userDeleted",!1)}copyDataToOrder({worker:e,needToHoldOn:t,workerAction:i,bookingDate:s,addToCalendar:r,business:o,user:a,noteText:c=""}){this.clientNote=c,t?this.status=Bt.waiting:this.status=Bt.approved,this.showAdressAlert=e.notifications.showAdressAlert,this.showPhoneAlert=e.notifications.showPhoneAlert,!i&&!t&&s.getTime()-Date.now()<60*60*1e3&&(this.confirmedArrival=!0),this.signOnDeviceCalendar=r,this.workerNotificationOption=e.notifications.notificationOption,this.workerRemindersTypes=new Map(e.notifications.remindersTypes),e.notifications.remindersTypes.forEach((l,h)=>{s.getTime()<Date.now()||h===Gt.confirmArrival&&this.confirmedArrival||(s.getTime()-l*60*1e3<Date.now()+1e3?(this.remindersTypes.set(h,Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))-Math.abs(Math.floor((Date.now()-s.getTime())/1e3/60/2))%5),this.remindersTypes.get(h)<10&&this.remindersTypes.delete(h)):this.remindersTypes.set(h,l))}),this.orderingOptions=_n.web,this.isUserExist=!0,this.userFcms=new Set(a.userPublicData.fcmsTokens),this.isVerifiedPhone=a.isVerifiedPhone;const u=a.userPublicData.clientAt;this.addToClientAt=!u.has(o.businessId)||!u.get(o.businessId).has(e.id),this.createdAt.getTime()===new Date(0).getTime()&&(this.createdAt=new Date),this.userBookingId===""&&(this.userBookingId=z3()),this.notificationType=N3(this,e)}get isDepositTransaction(){let e=!1;return this.transactions.forEach((t,i)=>{e=t.type===zn.deposit}),e}get transactionsTotalPaymentAmount(){let e=0;return this.transactions.forEach((t,i)=>{t.type===zn.payment&&(e+=t.amount)}),e}get canSendMessage(){return this.isVerifiedPhone||this.orderingOptions===_n.byWorker}get totalDebtAmount(){let e=0;return this.debts.forEach((t,i)=>{e+=t.amount}),e}get invoicePriceAmount(){return Array.from(this.invoices.values()).reduce((e,t)=>e+t.amount,0)}invoicesCoverPrice(e){const{totalAmount:t}=e;return this.finishInvoices||this.invoices.size>0&&Array.from(this.invoices.values()).reduce((i,s)=>i+s.amount,0)>=t}get transactionsTotalDepositAmount(){let e=0;return this.transactions.forEach((t,i)=>{t.type===zn.deposit&&(e+=t.amount)}),e}get customerHashPhone(){return rr(this.customerPhone)}get customerPhoneAsCollection(){return this.customerPhone.replace(/-/g,"")}reminderId(e){return this.userBookingId+"__"+Or[e]}get toPaymentRequestUser(){return new gr({name:this.customerName,userId:this.customerId,gender:this.userGender,isExist:this.isUserExist,isVerifiedPhone:this.isVerifiedPhone,phone:this.customerPhone})}get typesOfEvents(){const e=new Map;return this.needCancel&&e.set(Vs.needCancel,1),this.debts.size>0&&e.set(Vs.withDebts,1),this.status===Bt.waiting&&e.set(Vs.onHold,1),e}static fromJson(e,t,i){const s=new Zp;return s.customerName=e.customerName||"",s.customerId=e.customerId||"",s.customerPhone=e.customerPhone||s.customerId,s.needCancel=e.needCancel||!1,s.remindersTypes=e.remindersTypes?new Map(Object.entries(e.remindersTypes).map(([r,o])=>[Ns[r],o])):new Map([[Gt.regular,e.minutesBeforeNotify||60]]),s.workerRemindersTypes=e.workerRemindersTypes?new Map(Object.entries(e.workerRemindersTypes).map(([r,o])=>[Ns[r],o])):new Map,s.signOnDeviceCalendar=e.signOnDeviceCalendar||!1,s.userDeleted=e.userDeleted||!1,s.isVerifiedPhone=e.isVerifiedPhone||!1,s.clientMail=e.clientMail||"",s.clientNote=e.clientNote||"",s.userBookingId=t,s.orderingOptions=Hw[e.orderingOptions]||_n.app,s.debts=e.debts?new Map(Object.entries(e.debts).map(([r,o])=>[r,vo.fromJson(o,r)])):new Map,s.finishInvoices=e.finishInvoices||!1,s.cancelDate=e.cancelDate?ae(e.cancelDate):null,s.wasWaiting=e.wasWaiting||!1,s.isUserExist=e.isUserExist||!0,s.lastTimeNotifyOnDebt=e.lastTimeNotifyOnDebt?ae(e.lastTimeNotifyOnDebt):null,s.invoices=e.invoices?new Map(Object.entries(e.invoices).map(([r,o])=>[r,Pi.fromJson(o,r,i)])):new Map,s.userGender=Ri[e.userGender]||Ie.anonymous,s.status=Uw[e.status.toString()]||Bt.approved,s.confirmedArrival=e.confirmedArrival||!1,s.showAdressAlert=e.showAdressAlert||!1,s.showPhoneAlert=e.showPhoneAlert||!1,s.notificationType=$w[e.notificationType]||Z.none,s.workerNotificationOption=Ml[e.workerNotificationOption]||$e.PushOrSMS,s.userFcms=e.userFcms?new Set(e.userFcms):e.deviceFCM&&e.deviceFCM!==""?new Set([e.deviceFCM]):new Set,s.createdAt=e.createdAt?ae(e.createdAt):new Date(0),s.transactions=e.transactions?new Map(Object.entries(e.transactions).map(([r,o])=>[r,qs.fromJson(o,r)])):new Map,s}toJson(){const e={};return e.customerName=this.customerName,e.customerId=this.customerId,this.wasWaiting&&(e.wasWaiting=this.wasWaiting),this.cancelDate&&(e.cancelDate=oe(this.cancelDate)),e.remindersTypes={},this.remindersTypes.forEach((t,i)=>{e.remindersTypes[Or[i]]=t}),e.workerRemindersTypes={},this.workerRemindersTypes.forEach((t,i)=>{e.workerRemindersTypes[Or[i]]=t}),this.userDeleted&&(e.userDeleted=this.userDeleted),this.signOnDeviceCalendar&&(e.signOnDeviceCalendar=this.signOnDeviceCalendar),this.clientNote!==""&&(e.clientNote=this.clientNote),this.needCancel&&(e.needCancel=this.needCancel),this.finishInvoices&&(e.finishInvoices=this.finishInvoices),e.userGender=eo[this.userGender],this.invoices.size>0&&(e.invoices={},this.invoices.forEach((t,i)=>{e.invoices[i]=t.toJson()})),this.debts.size>0&&(e.debts={},this.debts.forEach((t,i)=>{e.debts[i]=t.toJson()})),this.lastTimeNotifyOnDebt&&(e.lastTimeNotifyOnDebt=oe(this.lastTimeNotifyOnDebt)),this.isUserExist||(e.isUserExist=this.isUserExist),this.orderingOptions!==_n.app&&(e.orderingOptions=Ww[this.orderingOptions]),this.showAdressAlert&&(e.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(e.showPhoneAlert=this.showPhoneAlert),this.clientMail!==""&&(e.clientMail=this.clientMail),e.customerPhone=this.customerPhone,this.status!==Bt.approved&&(e.status=Vw[this.status]),this.confirmedArrival&&(e.confirmedArrival=this.confirmedArrival),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.userFcms.size>0&&(e.userFcms=Array.from(this.userFcms)),e.createdAt=oe(this.createdAt),this.transactions.size>0&&(e.transactions={},this.transactions.forEach((t,i)=>{e.transactions[i]=t.toJson()})),e}toString(){return JSON.stringify(this,null,"  ")}}class ls{constructor({name:e="",amoutOfBookings:t=0,gender:i=Ie.male,email:s="",id:r="",freeFromPayments:o=!1,addedManually:a=!1,customerUuid:c="",isVerifiedPhone:u=!1,workerNaming:l="",blocked:h=!1,phoneNumber:f="",firstBookingsDate:m,userFirstBookingsDate:p,lastBookingsDate:y}){d(this,"name","");d(this,"workerNaming","");d(this,"phoneNumber","");d(this,"freeFromPayments",!1);d(this,"isExapmle",!1);d(this,"id","");d(this,"customerUuid","");d(this,"blocked",!1);d(this,"isVerifiedPhone",!1);d(this,"email","");d(this,"addedManually",!1);d(this,"gender",Ie.male);d(this,"amoutOfBookings",0);d(this,"firstBookingsDate");d(this,"userFirstBookingsDate");d(this,"lastBookingsDate");d(this,"belongings",new Set);d(this,"isDeleted",!1);this.name=e,this.amoutOfBookings=t,this.gender=i,this.email=s,this.id=r,this.freeFromPayments=o,this.addedManually=a,this.customerUuid=c,this.isVerifiedPhone=u,this.workerNaming=l,this.blocked=h,this.phoneNumber=f,this.firstBookingsDate=m,this.userFirstBookingsDate=p,this.lastBookingsDate=y}static fromJson(e,t){const i=new ls({});return i.name=e.name??"",e.gender!=null&&(i.gender=i.getGenderFromStr(e.gender)),i.isVerifiedPhone=e.isVerifiedPhone??!1,i.freeFromPayments=e.freeFromPayments??!1,i.customerUuid=t,i.phoneNumber=e.phoneNumber??(t.length<20&&t.includes("-")?t:""),e.firstBookingsDate!=""&&e.firstBookingsDate!=null&&(i.firstBookingsDate=ae(e.firstBookingsDate)),e.userFirstBookingsDate!=""&&e.userFirstBookingsDate!=null&&(i.userFirstBookingsDate=ae(e.userFirstBookingsDate),(i.firstBookingsDate==null||i.userFirstBookingsDate<i.firstBookingsDate)&&(i.firstBookingsDate=i.userFirstBookingsDate)),e.lastBookingsDate!=null&&(i.lastBookingsDate=ae(e.lastBookingsDate)),i.workerNaming=e.workerNaming??"",i.amoutOfBookings=e.amoutOfBookings??0,i.blocked=e.blocked??!1,i.email=e.email??"",i.id=e.id??"",i.addedManually=e.AM??!1,i}fromCustomerData(e){return this.name=e.name,this.gender=e.gender,this.isVerifiedPhone=e.isVerifiedPhone,this.phoneNumber=e.phoneNumber,this.belongings=e.belongings,this.email=e.email,this.isDeleted=e.isDeleted,this.blocked=e.blocked,this.id=e.id,this.addedManually=e.addedManually,this.freeFromPayments=e.freeFromPayments,this.customerUuid=e.customerUuid,this.workerNaming=e.workerNaming,this.firstBookingsDate=e.firstBookingsDate,this.lastBookingsDate=e.lastBookingsDate,this.amoutOfBookings=e.amoutOfBookings,this.userFirstBookingsDate=e.userFirstBookingsDate,this}get nameForWorker(){return this.workerNaming==""?this.name:this.workerNaming}get getFirstDate(){return this.firstBookingsDate==null||this.userFirstBookingsDate!=null&&this.userFirstBookingsDate<this.firstBookingsDate?this.userFirstBookingsDate:this.firstBookingsDate}get customerHashPhone(){return rr(this.phoneNumber)}get customerPhoneAsCollection(){return this.phoneNumber.replaceAll("-","")}isTheSameAs(e,{withId:t=!1}={}){const i=this.toJson();t&&(i.id=e.customerUuid);const s=e.toJson();return t&&(s.id=this.customerUuid),JSON.stringify(s)===JSON.stringify(i)}getGenderFromStr(e){return e==null||e=="A"?Ie.anonymous:e=="F"?Ie.female:Ie.male}getStrFromGender(e){return{[Ie.anonymous]:"A",[Ie.male]:"M",[Ie.female]:"F"}[e]||"A"}get toMultiBookingUser(){const e=new Zp;return e.customerName=this.name!=""?this.name:this.workerNaming,e.customerPhone=this.phoneNumber,e.customerId=this.customerUuid,e.userGender=this.gender,e}get toPaymentRequestUser(){return new gr({userId:this.customerUuid,name:this.nameForWorker,gender:this.gender,isExist:!this.addedManually,isVerifiedPhone:this.isVerifiedPhone,phone:this.phoneNumber})}isMissing(e){return this.lastBookingsDate==null?!1:(new Date().getTime()-this.lastBookingsDate.getTime())/(1e3*3600*24)>e}amountOfBookingsInMonth(){if(this.firstBookingsDate==null)return-1;if(this.lastBookingsDate==null)return 0;const e=this.lastBookingsDate>new Date?new Date:this.lastBookingsDate,t=Math.max((e.getTime()-this.firstBookingsDate.getTime())/(1e3*3600*24),1);return this.amoutOfBookings/t*30}toJson(){const e={};return this.name!==""&&(e.name=this.name),this.gender!==Ie.male&&(e.gender=this.getStrFromGender(this.gender)),this.phoneNumber!==this.id&&(e.phoneNumber=this.phoneNumber),this.firstBookingsDate!=null&&(e.firstBookingsDate=oe(this.firstBookingsDate)),this.userFirstBookingsDate!=null&&(e.userFirstBookingsDate=oe(this.userFirstBookingsDate)),this.lastBookingsDate!=null&&(e.lastBookingsDate=oe(this.lastBookingsDate)),this.amoutOfBookings!==0&&(e.amoutOfBookings=this.amoutOfBookings),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.freeFromPayments=this.freeFromPayments,this.email!==""&&(e.email=this.email),e.blocked=this.blocked,this.id!==""&&(e.id=this.id),this.addedManually&&(e.AM=this.addedManually),this.workerNaming!==""&&(e.workerNaming=this.workerNaming),e}toMinimalJson(){const e={};return e.N=this.name!==""?this.name:this.workerNaming,e.G=this.getStrFromGender(this.gender),e.P=this.phoneNumber,this.phoneNumber!==this.customerUuid&&(e.CU=this.customerUuid),this.email!==""&&(e.E=this.email),this.id!==""&&(e.ID=this.id),e}static fromMinimalJson(e){const t=new ls({});return t.workerNaming=e.N??"",t.name=e.N??"",e.G!=null&&(t.gender=t.getGenderFromStr(e.gender)),t.addedManually=e.AM??!1,t.phoneNumber=e.P??"",t.customerUuid=e.CU??e.P??"",t.email=e.E??"",t.id=e.ID??"",t}get publicCustomer(){return new Kr({freeFromPayments:this.freeFromPayments,blocked:this.blocked,hashNumber:x3({id:this.customerUuid})})}get forUpdate(){const e=new ls({});return e.name=this.name,e.gender=this.gender,e.isVerifiedPhone=this.isVerifiedPhone,e.phoneNumber=this.phoneNumber,e.belongings=this.belongings,e.email=this.email,e.isDeleted=this.isDeleted,e.blocked=this.blocked,e.id=this.id,e.addedManually=this.addedManually,e.freeFromPayments=this.freeFromPayments,e.customerUuid=this.customerUuid,e.workerNaming=this.workerNaming,e.firstBookingsDate=null,e.userFirstBookingsDate=null,e.amoutOfBookings=0,e.lastBookingsDate=null,e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}const Bv="~.9.~",G3="..",pf="_";class hc{constructor({workerName:e="",date:t="",workerId:i="",timeStr:s="",treatmentId:r="",treatmentName:o="",businessId:a=""}){d(this,"id","");d(this,"businessId","");d(this,"workerName","");d(this,"date","");d(this,"workerId","");d(this,"timeStr","");d(this,"treatmentId","");d(this,"treatmentName","");this.workerName=e,this.date=t,this.workerId=i,this.timeStr=s,this.treatmentId=r,this.treatmentName=o,this.businessId=a}fixEmptyAttributes(){this.workerName=this.workerName===""?"E":this.workerName,this.date=this.date===""?"E":this.date,this.businessId=this.businessId===""?"E":this.businessId,this.workerId=this.workerId===""?"E":this.workerId}static fromJson(e,t){const i=new hc({});return i.id=t,i.workerName=e.workerName??"",i.date=e.date??"",i.timeStr=e.timeStr??"",i.treatmentId=e.treatmentId??"",i.treatmentName=e.treatmentName??"",i.businessId=e.businessId??"",i.workerId=e.workerId??"",i}get isMulti(){return this.timeStr!==""}static fromTopicStr(e){const t=new hc({}),i=e.split(G3),s=i[0].split(pf),r=i[1].split(pf);return t.businessId=s[0],t.workerId=s[1].replaceAll(Bv,"+"),t.date=s[2],t.workerName=r[1],t}isEqual(e){return JSON.stringify(e.toJson())===JSON.stringify(this.toJson())}toTopicStr(){this.fixEmptyAttributes();const e=this.workerId.replaceAll("+",Bv);return[this.businessId,e,this.date,this.timeStr,this.treatmentId].join(pf).split("").filter(s=>QC.test(s)).join("")}get dateTime(){const e=vt(this.date),t=this.timeStr===""?new Date(0):kt(this.timeStr);return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes())}toJson(){const e={};return e.businessId=this.businessId,this.workerName!==""&&(e.workerName=this.workerName),this.workerId!==""&&(e.workerId=this.workerId),this.date!==""&&(e.date=this.date),this.timeStr!==""&&(e.timeStr=this.timeStr),this.treatmentName!==""&&(e.treatmentName=this.treatmentName),this.treatmentId!==""&&(e.treatmentId=this.treatmentId),e}toString(){return JSON.stringify(this.toJson())}}const Y3={1:"PL",2:"MasterCard",3:"Visa",4:"Maestro",5:"Isracard"},J3={PL:"1",MasterCard:"2",Visa:"3",Maestro:"4",Isracard:"5"},K3={1:"Isracard",2:"Visa Cal",3:"Diners",4:"Amex",6:"Leumi Card"},Q3={Isracard:"1","Visa Cal":"2",Diners:"3",Amex:"4","Leumi Card":"6"};class Aa{constructor({brand:e="",token:t="",validityMonth:i="",validityYear:s="",name:r="",userId:o="",bankName:a="",l4Digits:c="",cardId:u="",businessId:l="",attemptsLeft:h=gu}={}){d(this,"brand","");d(this,"token","");d(this,"validityMonth","");d(this,"validityYear","");d(this,"name","");d(this,"bankName","");d(this,"l4Digits","");d(this,"userId","");d(this,"attemptsLeft",gu);d(this,"cardId","");d(this,"businessId","");this.brand=e,this.token=t,this.validityMonth=i,this.validityYear=s,this.name=r,this.userId=o,this.bankName=a,this.l4Digits=c,this.cardId=u,this.businessId=l,this.attemptsLeft=h}static fromJson(e,t,i){const s=new Aa;return s.cardId=t,s.brand=Y3[e.brand]||"Card",s.token=e.token||"",s.userId=e.userId||"",s.attemptsLeft=e.attemptsLeft||gu,s.validityMonth=e.validityMonth||"",s.validityYear=e.validityYear||"",s.businessId=i,s.name=e.name||"",s.bankName=e.bankName||"",s.bankName=K3[e.bankName]||"Bank",s.l4Digits=e.l4Digits||"",s}fromPaymentCard(e){this.brand=e.brand,this.token=e.token,this.userId=e.userId,this.businessId=e.businessId,this.cardId=e.cardId,this.attemptsLeft=e.attemptsLeft,this.validityMonth=e.validityMonth,this.validityYear=e.validityYear,this.name=e.name,this.bankName=e.bankName,this.l4Digits=e.l4Digits}toJson(){const e={};return e.brand=J3[this.brand]||"",e.token=this.token,e.userId=this.userId,e.attemptsLeft=this.attemptsLeft,e.validityMonth=this.validityMonth,e.validityYear=this.validityYear,e.name=this.name,e.bankName=this.bankName,e.bankName=Q3[this.bankName]||"",e.l4Digits=this.l4Digits,e}decryptCard(e){return new Aa({cardId:this.cardId,brand:this.brand,token:decryptText({encryption:this.token,password:e}),validityMonth:decryptText({encryption:this.validityMonth,password:e}),validityYear:decryptText({encryption:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}encryptCard(e){return new Aa({cardId:this.cardId,brand:this.brand,token:encryptText({text:this.token,password:e}),validityMonth:encryptText({text:this.validityMonth,password:e}),validityYear:encryptText({text:this.validityYear,password:e}),name:this.name,userId:this.userId,bankName:this.bankName,businessId:this.businessId,l4Digits:this.l4Digits})}isTheSameAs(e){return this.bankName===e.bankName&&this.brand===e.brand&&this.name===e.name&&this.l4Digits===e.l4Digits&&this.userId===e.userId&&this.validityMonth===e.validityMonth&&this.validityYear===e.validityYear}toString(){return JSON.stringify(this,null,"  ")}}class j3{constructor(){d(this,"futureBookings",{});d(this,"passedBookings",{});d(this,"recurrence")}setMonth(e,t){const i=F1(t),s=B1(new Date);i.getTime()===s.getTime()?(this.passedBookings[t]={},this.futureBookings[t]={}):i.getTime()>s.getTime()?this.futureBookings[t]={}:i.getTime()<s.getTime()&&(this.passedBookings[t]={}),Object.entries(e).forEach(([r,o])=>{const a=_t.fromJson(o,r);a.cancelDate==null&&(a.isPassed?this.passedBookings[t][r]=a:this.futureBookings[t][r]=a)})}setRecurrence(e){this.recurrence={},Object.entries(e).forEach(([t,i])=>{const s=_t.fromJson(i,t);s.cancelDate===void 0&&(this.recurrence[t]=s)})}get all(){const e={};return Object.values(this.futureBookings).forEach(t=>{Object.entries(t).forEach(([i,s])=>{e[s.bookingId]=s})}),Object.values(this.passedBookings).forEach(t=>{Object.entries(t).forEach(([i,s])=>{e[s.bookingId]=s})}),this.recurrence!==void 0&&Object.entries(this.recurrence).forEach(([t,i])=>{e[t]=i}),e}addBooking(e){var t,i;if(e.recurrenceEvent!==null)this.recurrence??(this.recurrence={}),this.recurrence[e.bookingId]=e;else{const s=_s(e.bookingDate);e.isPassed?((t=this.passedBookings)[s]??(t[s]={}),this.passedBookings[s][e.bookingId]=e):((i=this.futureBookings)[s]??(i[s]={}),this.futureBookings[s][e.bookingId]=e)}}deleteBooking(e){var t,i,s;if(e.recurrenceEvent!==null)(t=this.recurrence)==null||delete t[e.bookingId];else{const r=_s(e.bookingDate);(i=this.passedBookings[r])==null||delete i[e.bookingId],(s=this.futureBookings[r])==null||delete s[e.bookingId]}}lastBookingForBusiness({businessId:e,workerId:t,includePast:i=!1,initDate:s,exclude:r}){let o=s;return Object.entries(this.futureBookings).forEach(([a,c])=>{Object.entries(c).forEach(([u,l])=>{e!==l.buisnessId||t!==l.workerId||r!=null&&r.getTime()===l.bookingDate.getTime()||(o===void 0||l.bookingDate.getTime()>o.getTime())&&(o=l.bookingDate)})}),o}firstBookingForBusiness({businessId:e,workerId:t,includePast:i,initDate:s,exclude:r}){let o=s;for(const[a,c]of Object.entries(this.futureBookings))for(const[u,l]of Object.entries(c))e!==l.buisnessId||t!==l.workerId||r!=null&&r.getTime()===l.bookingDate.getTime()||(o===void 0||l.bookingDate.getTime()<o.getTime())&&(o=l.bookingDate);if(o===void 0&&i)for(const[a,c]of Object.entries(this.passedBookings))for(const[u,l]of Object.entries(c))e!==l.buisnessId||t!==l.workerId||r!==void 0&&r.getTime()===l.bookingDate.getTime()||(o===void 0||l.bookingDate.getTime()<o.getTime())&&(o=l.bookingDate);return o}}class eg{constructor(e,t){d(this,"docId","");d(this,"path","");this.docId=e,this.path=t}toJson(){const e={};return e.docId=this.docId,e.path=this.path,e}static fromJson(e){const t=new eg("","");return t.docId=e.docId||"",t.path=e.path||"",t}toString(){return JSON.stringify(this,null,2)}}class Oh{constructor({docId:e=""}){d(this,"bookingCount",0);d(this,"lastUpdateTime",new Date(0));d(this,"docId","");this.docId=e}static fromJson(e,t){const i=new Oh({});return e!==void 0&&t!==void 0&&(i.docId=t,i.bookingCount=e.bookingCount??0,i.lastUpdateTime=e.lastUpdateTime?ae(e.lastUpdateTime):new Date(0)),i}toJson(){const e={};return this.lastUpdateTime.getTime()!==new Date(0).getTime()&&(e.lastUpdateTime=oe(this.lastUpdateTime)),this.bookingCount>0&&(e.bookingCount=this.bookingCount),e}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class Ca{constructor({email:e="",isVerifiedPhone:t=!1,isVerifiedEmail:i=!1,name:s="",phoneNumber:r="",id:o="",gender:a=Ie.anonymous,devices:c=new Map}){d(this,"email","");d(this,"name","");d(this,"phoneNumber","");d(this,"id","");d(this,"devices",new Map);d(this,"gender",Ie.anonymous);d(this,"myBuisnessesIds",[]);d(this,"reminders");d(this,"clientAt",new Map);d(this,"hasNotificationPermission",!0);d(this,"permission",new Map);d(this,"tempFcm");d(this,"allowAppNotification",!0);d(this,"isVerifiedPhone",!1);d(this,"isVerifiedEmail",!1);d(this,"invoiceCounter");d(this,"newWorkerWelcomes",new Set);d(this,"bookings",new Map);d(this,"bookingsPreviews",new Map);d(this,"bookingsDocsToLoad",new Set);d(this,"localDocsToDelete",new Set);this.email=e,this.isVerifiedPhone=t,this.isVerifiedEmail=i,this.name=s,this.phoneNumber=r,this.id=o,this.gender=a,this.devices=c}static fromJson(e,t){const i=new Ca({email:e.email,isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:e.isVerifiedEmail,name:e.name,phoneNumber:e.phoneNumber,id:e.id,gender:e.gender});return i.setUserPublicData(e,t),i}get customerData(){return new ls({customerUuid:this.id,name:this.name,email:this.email,isVerifiedPhone:this.isVerifiedPhone,gender:this.gender,phoneNumber:this.phoneNumber})}setUserPublicData(e,t){if(this.permission=new Map,this.myBuisnessesIds=[],this.isVerifiedEmail=e.isVerifiedEmail||!1,this.email=e.email||"",this.allowAppNotification=e.allowAppNotification||!0,this.email=e.email||"",this.name=e.name||"",this.clientAt=new Map,e.clientAt&&Object.entries(e.clientAt).forEach(([i,s])=>{Object.keys(s).length!==0&&(this.clientAt.set(i,new Set),Object.keys(s).forEach(r=>{this.clientAt.set(i,this.clientAt.get(i).add(r))}))}),e.localDocsToDelete&&(this.localDocsToDelete=new Set,e.localDocsToDelete.forEach(i=>{this.localDocsToDelete.add(eg.fromJson(i))})),this.invoiceCounter=e.invoiceCounter,this.devices=new Map,e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([i,s])=>{this.devices.set(i,Zn.fromJson(s,i))}):e.currentFcm&&e.currentFcm!==""&&(this.tempFcm=e.currentFcm),this.hasNotificationPermission=e.hasNotificationPermission||!0,e.gender&&(this.gender=Ri[e.gender]||Ie.anonymous),this.phoneNumber=e.phoneNumber||"",this.id=e.id||e.phoneNumber||"",e.permission&&Object.entries(e.permission).forEach(([i,s])=>{s===2&&this.myBuisnessesIds.push(i),this.permission.set(i,s)}),e.bookings&&(this.bookings=new Map,Object.entries(e.bookings).forEach(([i,s])=>{const r=_t.fromJson(s,i);r.cancelDate||this.bookings.set(i,r)})),this.bookingsDocsToLoad=new Set,e.bookingsPreviews){const i=new Map;Object.entries(e.bookingsPreviews).forEach(([s,r])=>{i.set(s,Oh.fromJson(r,s))}),i.forEach((s,r)=>{var o,a;((o=this.bookingsPreviews.get(r))==null?void 0:o.lastUpdateTime)!==s.lastUpdateTime&&(r===Bw||F1(r)>=B1(new Date)||(((a=t==null?void 0:t.passedBookings)==null?void 0:a.hasOwnProperty(r))??!1))&&this.bookingsDocsToLoad.add(r)}),this.bookingsPreviews=i}this.id===this.phoneNumber?this.isVerifiedPhone=!0:this.isVerifiedPhone=e.isVerifiedPhone||!1,this.newWorkerWelcomes=new Set,e.newWorkerWelcomes&&Object.keys(e.newWorkerWelcomes).forEach(i=>{this.newWorkerWelcomes.add(i)})}get fcmsTokens(){if(!this.allowAppNotification)return new Set;if(this.tempFcm)return new Set(this.tempFcm);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDevicesByToken(e){const t=[];return Object.values(this.devices).forEach(i=>{i.token===e&&t.push(Zn.fromDevice(i))}),t}toJson(){const e={};return this.hasNotificationPermission||(e.hasNotificationPermission=this.hasNotificationPermission),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),this.isVerifiedEmail&&(e.isVerifiedEmail=this.isVerifiedEmail),this.email!==""&&(e.email=this.email),Object.keys(this.bookingsPreviews).length>0&&(e.bookingsPreviews={},Object.entries(this.bookingsPreviews).forEach(([t,i])=>{e.bookingsPreviews[t]=i.toJson()})),this.allowAppNotification||(e.allowAppNotification=this.allowAppNotification),e.permission={},Object.entries(this.permission).forEach(([t,i])=>{e.permission[t]=i}),this.localDocsToDelete.size>0&&(e.localDocsToDelete=[],this.localDocsToDelete.forEach(t=>{e.localDocsToDelete.push(t.toJson())})),e.email=this.email,e.name=this.name,e.devices={},this.devices.forEach((t,i)=>{e.devices[i]=t.toJson()}),e.clientAt={},this.clientAt.forEach((t,i)=>{e.clientAt[i]={},t.forEach(s=>{e.clientAt[i][s]=""})}),e.gender=eo[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,this.newWorkerWelcomes.size>0&&(e.newWorkerWelcomes={},this.newWorkerWelcomes.forEach(t=>{e.newWorkerWelcomes[t]=""})),e}}class tg{constructor(e,t,i){d(this,"businessId","");d(this,"date");d(this,"productId","");this.businessId=e,this.date=t,this.productId=i}static fromJson(e,t){const i=new tg(t,null,"");return i.businessId=e.businessId||"",e.date instanceof Le&&(i.date=e.date),i}toJson(){const e={};return e.businessId=this.businessId,this.date!==null&&this.date!==void 0&&(e.date=this.date),e}}class Qr{constructor({name:e="",phoneNumber:t="",id:i="",productsIds:s={},myBuisnessesIds:r=[],revenueCatId:o="",limitOfBuisnesses:a=1,gender:c=Ie.anonymous,lastVisitedBuisnesses:u=[],lastVisitedBuisnessesRemoved:l=[],paymentCards:h={},isVerifiedPhone:f=!1,isVerifiedEmail:m=!1,email:p="",lastCleanDate:y=Le.fromDate(new Date),createdAt:g=new Date}){d(this,"productsIds",{});d(this,"pendingProductsIds",{});d(this,"id","");d(this,"revenueCatId","");d(this,"limitOfBuisnesses",1);d(this,"preferdTipPercentage",0);d(this,"cardPaymentsPass","");d(this,"lastTimeUpdatePhone",new Date(0));d(this,"lastTimeUpdateEmail",new Date(0));d(this,"authProviders",new Map);d(this,"businessesInfo",{});d(this,"storyLikes",[]);d(this,"paymentCards",{});d(this,"lastVisitedBuisnesses",[]);d(this,"lastVisitedBuisnessesRemoved",[]);d(this,"lastCleanDate",Le.fromDate(new Date));d(this,"businessTopics",new Set);d(this,"waitingListTopics",{});d(this,"tempFcm");d(this,"termsApprovals",{});d(this,"seenUpdates",{});d(this,"createdAt",new Date);d(this,"userPublicData",new Ca({}));d(this,"name","");d(this,"isVerifiedPhone",!1);d(this,"phoneNumber","");d(this,"gender",Ie.anonymous);d(this,"lastTimeConnect",new Date);d(this,"userPublicDataListener");d(this,"connectedGoogleEmail","");d(this,"currentMonthInvoices");d(this,"currentMonthPaymentRequest");d(this,"currentMonthPayments");d(this,"existInvoicesDocs",new Set);d(this,"existPaymentsDocs",new Set);d(this,"existPaymentRequestsDocs",new Set);d(this,"invoices",{});d(this,"devices",{});d(this,"bookings",new j3);d(this,"hasOldNotification",!1);this.userPublicData=new Ca({email:p,isVerifiedEmail:m,isVerifiedPhone:f,name:e,phoneNumber:t,id:i,gender:c}),this.name=e,this.phoneNumber=t,this.id=i,this.productsIds=s,this.revenueCatId=o,this.limitOfBuisnesses=a,this.gender=c,this.lastVisitedBuisnesses=u,this.lastVisitedBuisnessesRemoved=l,this.paymentCards=h,this.isVerifiedPhone=f,this.cardPaymentsPass="",this.lastCleanDate=y,this.createdAt=g}get toPaymentRequestUser(){return new gr({userId:this.id,name:this.name,gender:this.gender,isVerifiedPhone:this.isVerifiedPhone,isExist:!0,phone:this.phoneNumber,userDecline:!1})}customerDataFromBooking({booking:e,exclude:t,needDelete:i=!1,initDate:s}){return new ls({name:this.name,email:this.userPublicData.email,gender:this.gender,customerUuid:this.id,phoneNumber:this.phoneNumber,isVerifiedPhone:this.isVerifiedPhone,userFirstBookingsDate:this.bookings.firstBookingForBusiness({businessId:e.buisnessId,workerId:e.workerId,exclude:i?e.bookingDate:t,initDate:i?s:e.bookingDate}),lastBookingsDate:this.bookings.lastBookingForBusiness({businessId:e.buisnessId,workerId:e.workerId,exclude:i?e.bookingDate:t,initDate:i?s:e.bookingDate})})}get fcmsTokens(){if(!this.userPublicData.allowAppNotification)return new Set;if(this.tempFcm)return new Set([this.tempFcm]);const e=new Set;return Object.values(this.devices).forEach(t=>{t.activeNotifications&&e.add(t.token)}),e}getDeviceByToken(e){let t;return Object.values(this.devices).forEach(i=>{i.token===e&&(t=Zn.fromDevice(i))}),t}static fromUserDocJson(e){const t=new Qr({name:e.name,phoneNumber:e.phoneNumber,id:e.id,productsIds:{},myBuisnessesIds:[],revenueCatId:e.revenueCatId,limitOfBuisnesses:e.limitOfBuisnesses,gender:Ri[e.gender],lastVisitedBuisnesses:e.lastVisitedBuisnesses,lastVisitedBuisnessesRemoved:e.lastVisitedBuisnessesRemoved,paymentCards:{},isVerifiedPhone:e.isVerifiedPhone,isVerifiedEmail:!1,email:"",lastCleanDate:e.lastCleanDate,createdAt:ae(e.createdAt)});return e.devices&&typeof e.devices=="object"?Object.entries(e.devices).forEach(([i,s])=>{t.devices[i]=Zn.fromJson(s,i)}):e.currentFcm&&e.currentFcm!==""&&(t.tempFcm=e.currentFcm),e.termsApprovals&&Object.entries(e.termsApprovals).forEach(([i,s])=>{t.termsApprovals[i]=ae(s)||new Date(0)}),t.seenUpdates={},e.seenUpdates&&Object.entries(e.seenUpdates).forEach(([i,s])=>{t.seenUpdates[i]=new Set(s)}),t.phoneNumber=e.phoneNumber||"0",t.id=e.id||e.phoneNumber,t.preferdTipPercentage=0,e.preferdTipPercentage&&(t.preferdTipPercentage=Number.isInteger(e.preferdTipPercentage)?e.preferdTipPercentage:Math.floor(e.preferdTipPercentage)),t.cardPaymentsPass=e.cardPaymentsPass||"",e.storyLikes&&e.storyLikes.forEach(i=>t.storyLikes.push(i)),e.lastTimeUpdatePhone&&(t.lastTimeUpdatePhone=ae(e.lastTimeUpdatePhone)),e.lastTimeUpdateEmail&&(t.lastTimeUpdateEmail=ae(e.lastTimeUpdateEmail)),t.productsIds={},e.productsIds&&Object.entries(e.productsIds).forEach(([i,s])=>{t.productsIds[i]=tg.fromJson(s,i)}),e.pendingProductsIds&&Object.entries(e.pendingProductsIds).forEach(([i,s])=>{t.pendingProductsIds[i]=s}),t.revenueCatId=e.revenueCatId||"",t.lastCleanDate=e.lastCleanDate,e.lastVisitedBuisnesses.forEach(i=>t.lastVisitedBuisnesses.push(i)),e.lastVisitedBuisnessesRemoved&&e.lastVisitedBuisnessesRemoved.forEach(i=>t.lastVisitedBuisnessesRemoved.push(i)),t.businessesInfo={},e.businessesInfo&&Object.entries(e.businessesInfo).forEach(([i,s])=>{t.businessesInfo[i]=Da.fromJson(s,i)}),e.businessTopics&&e.businessTopics.forEach(i=>{t.businessTopics.add(i)}),e.waitingListTopics&&(t.waitingListTopics={},Object.entries(e.waitingListTopics).forEach(([i,s])=>{const r=hc.fromJson(s,i);r.date===""?t.businessTopics.add(i):t.waitingListTopics[i]=r})),t.paymentCards={},e.paymentCards&&Object.entries(e.paymentCards).forEach(([i,s])=>{t.paymentCards[i]={},Object.entries(s).forEach(([r,o])=>{t.paymentCards[i][r]=Aa.fromJson(o,r,i)})}),t.createdAt=ae(e.createdAt),t.limitOfBuisnesses=e.limitOfBuisnesses||1,e.authProviders?Object.entries(e.authProviders).forEach(([i,s])=>{if(py[i]){const r=py[i];t.authProviders.set(r,ae(s))}}):t.authProviders=new Map([[Vx.Phone,t.createdAt]]),t.id===t.phoneNumber?t.isVerifiedPhone=!0:t.isVerifiedPhone=e.isVerifiedPhone||!1,e.lastTimeConnect&&(t.lastTimeConnect=ae(e.lastTimeConnect)),t.userPublicData=new Ca({isVerifiedPhone:t.isVerifiedPhone,phoneNumber:t.phoneNumber}),t}setUserPublicData(e){this.name=e.name||"",e.devices&&typeof e.devices=="object"&&Object.entries(e.devices).forEach(([t,i])=>{this.devices[t]=Zn.fromJson(i,t)}),this.gender=Ri[e.gender],this.phoneNumber=e.phoneNumber,this.id=e.id||e.phoneNumber,this.userPublicData.setUserPublicData(e,this.bookings)}firstEnterance(e){return!new Set([...this.lastVisitedBuisnesses,...this.lastVisitedBuisnessesRemoved]).has(e)}toUserDocJson(){const e={};return e.name=this.name,e.devices={},Object.entries(this.devices).forEach(([t,i])=>{e.devices[t]=i.toJson()}),this.lastTimeUpdateEmail.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdateEmail=oe(this.lastTimeUpdateEmail)),this.lastTimeUpdatePhone.getTime()!==new Date(0).getTime()&&(e.lastTimeUpdatePhone=oe(this.lastTimeUpdatePhone)),e.gender=eo[this.gender],e.phoneNumber=this.phoneNumber,e.id=this.id,Object.keys(this.termsApprovals).length>0&&(e.termsApprovals={},Object.entries(this.termsApprovals).forEach(([t,i])=>{e.termsApprovals[t]=oe(i)})),Object.keys(this.seenUpdates).length>0&&(e.seenUpdates={},Object.entries(this.seenUpdates).forEach(([t,i])=>{e.seenUpdates[t]=Array.from(i)})),this.isVerifiedPhone&&(e.isVerifiedPhone=this.isVerifiedPhone),e.preferdTipPercentage=this.preferdTipPercentage,e.revenueCatId=this.revenueCatId,Object.keys(this.productsIds).length>0&&(e.productsIds={},Object.entries(this.productsIds).forEach(([t,i])=>{e.productsIds[t]=i.toJson()})),e.pendingProductsIds=this.pendingProductsIds,e.lastCleanDate=this.lastCleanDate,e.limitOfBuisnesses=this.limitOfBuisnesses,e.lastVisitedBuisnesses=this.lastVisitedBuisnesses,e.lastVisitedBuisnessesRemoved=this.lastVisitedBuisnessesRemoved,e.businessesInfo={},this.cardPaymentsPass!==""&&(e.cardPaymentsPass=this.cardPaymentsPass),Object.entries(this.businessesInfo).forEach(([t,i])=>{e.businessesInfo[t]=i.toJson()}),e.storyLikes=this.storyLikes,e.waitingListTopics={},Object.entries(this.waitingListTopics).forEach(([t,i])=>{e.waitingListTopics[t]=i.toJson()}),e.businessTopics=Array.from(this.businessTopics),e.authProviders={},this.authProviders.forEach((t,i)=>{e.authProviders[i]=oe(t)}),e.paymentCards={},Object.entries(this.paymentCards).forEach(([t,i])=>{e.paymentCards[t]={},Object.entries(i).forEach(([s,r])=>{e.paymentCards[t][s]=r.toJson()})}),e.createdAt=oe(this.createdAt),e}get developerId(){return this.id.replace("+","")}toString(){return JSON.stringify(this.toUserDocJson())+JSON.stringify(this.userPublicData.toJson())}}let S0=Io(new Qr({})),gf=Io(!1);function J(n,e=yn($D),t=!0){const i=e(n);return yn(aw)==="he"&&t?X3(i):i}function X3(n){const e=yn(S0).gender;return e===Ie.male||e===Ie.anonymous||Object.keys(Zg).forEach(i=>{n=n.replaceAll(i,Zg[i])}),n}class dc{constructor(){d(this,"eventName","");d(this,"from",new Date(0));d(this,"to",new Date(0));d(this,"colorIndex",-1);d(this,"isBreak",!1);d(this,"eventIndex",0);d(this,"eventsBelong",1);d(this,"partOfRecurrence",!1);d(this,"treatmentName","");d(this,"transactionCounter",0);d(this,"wantDelete",!1);d(this,"onHold",!1);d(this,"hasInvoice",!1);d(this,"durationMinutes",0);d(this,"breakNotificaiton",!1);d(this,"minutesBreakNotification",60);d(this,"extraData");d(this,"note");d(this,"ids",[]);d(this,"recurrenceEvent");d(this,"timeId");d(this,"hasDebt",!1);d(this,"confirmArrival",!1);d(this,"treatmentId");d(this,"isMulti",!1);d(this,"currentParticipants",0);d(this,"debtCounter",0);d(this,"onHoldCounter",0);d(this,"invoiceCoverCounter",0);d(this,"transactionsPerUser",0);d(this,"wantDeleteCounter",0);d(this,"confirmedArrivalAmount",0);d(this,"recurrenceFatherBookingId");d(this,"recurrenceBreakFatherDate");d(this,"blockSchedule",!0);d(this,"recurrenceBreakRefInfo");d(this,"breakIconData");d(this,"breakBusinessName");d(this,"breakFatherRecurrenceId");d(this,"breakBusinessId");d(this,"breakAddedToDeviceCalendar",!1);d(this,"breakId","");d(this,"vacationId","");d(this,"belongTreatments",1);d(this,"vacationCreatedAt");d(this,"isVacation",!1);d(this,"vacationAddedToDeviceCalendar",!1);d(this,"vacationEndTemp");d(this,"isHoliday",!1);d(this,"holidayReligion");d(this,"subTreatmentName","");d(this,"totalBookingMinutes",0);d(this,"waitingListCounter",1);d(this,"isWaitingList",!1);d(this,"waitingListCustomerGender",Ie.male);d(this,"customerPhoneWaitingList","")}static fromJson({json:e,timeStr:t,dayString:i,monthString:s,workerId:r,businessModel:o,newTimeId:a}){const c=new dc;c.eventName=e.p??"",c.eventIndex=e.i??0,c.onHold=e.oH??!1,c.eventsBelong=e.EB??1,c.wantDelete=e.wD??!1,c.isVacation=e.IV??!1,c.isVacation&&c.eventName===""&&(c.eventName=J("Vacation")),c.vacationId=a??"",c.breakFatherRecurrenceId=e.BFRI??"",c.vacationAddedToDeviceCalendar=e.VATDC??!1,c.blockSchedule=e.BS??!0,c.transactionCounter=e.TC??0,c.transactionsPerUser=e.TPU??0,c.hasDebt=e.HD??!1,c.debtCounter=e.DC??0,c.treatmentId=e.TID,c.confirmArrival=e.CA??!1,c.confirmedArrivalAmount=e.CAA??0,c.durationMinutes=e.d??0,c.treatmentName=e.TN??"",c.hasInvoice=e.Hi??!1,c.invoiceCoverCounter=e.ICC??0,c.note=e.N,c.recurrenceFatherBookingId=e.RFBI,c.wantDeleteCounter=e.WDC??0,c.onHoldCounter=e.OHC??0,c.isMulti=e.IM??!1,c.currentParticipants=e.CP??0,c.breakNotificaiton=e.BN??!1,c.partOfRecurrence=e.POR??!1,c.minutesBreakNotification=e.MBN??60,c.recurrenceBreakRefInfo=e.RBRI?On.fromJson(e.RBRI):void 0,c.recurrenceBreakFatherDate=e.RBFD;const u=e.IB??!1,l=kt(t),h=vt(`${i}-${s}`),f=new Date(h.getFullYear(),h.getMonth(),h.getDate(),l.getHours(),l.getMinutes());return c.to=Q(f,new V({minutes:c.durationMinutes})),c.recurrenceEvent=e.RE?On.fromJson(e.RE,f):void 0,c.colorIndex=e.c??(c.isVacation?1:0),c.ids=[r],c.isHoliday=!1,c.subTreatmentName="",c.totalBookingMinutes=0,c.waitingListCounter=1,c.isWaitingList=!1,c.waitingListCustomerGender=Ie.male,c.customerPhoneWaitingList="",u&&(c.breakIconData=o==null?void 0:o.design.shopIconData,c.breakBusinessName=o==null?void 0:o.shopName,c.breakBusinessId=o==null?void 0:o.businessId),e.VE&&(c.vacationEndTemp=vt(e.VE)),c}get endOfBooking(){return Q(this.from,new V({minutes:this.totalBookingMinutes}))}toJson(){const e={};return e.p=this.eventName,e.d=this.durationMinutes,e.c=this.colorIndex,this.minutesBreakNotification!==60&&(e.MBN=this.minutesBreakNotification),this.breakNotificaiton&&(e.BN=this.breakNotificaiton),this.onHoldCounter>0&&(e.OHC=this.onHoldCounter),this.confirmArrival&&(e.CA=this.confirmArrival),this.confirmedArrivalAmount>0&&(e.CAA=this.confirmedArrivalAmount),this.blockSchedule||(e.BS=this.blockSchedule),this.treatmentId!==void 0&&(e.TID=this.treatmentId),this.wantDeleteCounter>0&&(e.WDC=this.wantDeleteCounter),this.hasDebt&&(e.HD=this.hasDebt),this.transactionCounter>0&&(e.TC=this.transactionCounter),this.transactionsPerUser>0&&(e.TPU=this.transactionsPerUser),this.debtCounter>0&&(e.DC=this.debtCounter),this.invoiceCoverCounter>0&&(e.ICC=this.invoiceCoverCounter),this.eventsBelong!==1&&(e.EB=this.eventsBelong),this.isBreak&&(e.IB=this.isBreak),this.breakId!==""&&(e.BI=this.breakId),this.eventIndex!==0&&(e.i=this.eventIndex),this.treatmentName!==""&&(e.TN=this.treatmentName),this.onHold&&(e.oH=this.onHold),this.isMulti&&(e.IM=this.isMulti),this.currentParticipants>0&&(e.CP=this.currentParticipants),this.wantDelete&&(e.wD=this.wantDelete),this.hasInvoice&&(e.Hi=this.hasInvoice),this.recurrenceEvent!=null&&(e.RE=this.recurrenceEvent.toJson({})),this.note!==void 0&&this.note!==""&&(e.N=this.note),this.partOfRecurrence&&(e.POR=this.partOfRecurrence),this.recurrenceFatherBookingId!=null&&(e.RFBI=this.recurrenceFatherBookingId),this.isVacation&&(e.IV=this.isVacation),this.breakFatherRecurrenceId!=null&&(e.BFRI=this.breakFatherRecurrenceId),this.vacationAddedToDeviceCalendar&&(e.VATDC=this.vacationAddedToDeviceCalendar),this.vacationCreatedAt!=null&&(e.VCA=oe(this.vacationCreatedAt)),this.breakAddedToDeviceCalendar&&(e.BATDC=this.breakAddedToDeviceCalendar),this.timeId!==void 0&&this.recurrenceEvent===void 0&&(e.RTI=this.timeId),this.recurrenceBreakFatherDate!==void 0&&(e.RBFD=this.recurrenceBreakFatherDate),this.recurrenceBreakRefInfo!=null&&(e.RBRI=this.recurrenceBreakRefInfo.toJson({saveStartDate:!1,saveEnd:!0,saveException:!1})),this.subTreatmentName!==""&&(e.STN=this.subTreatmentName),this.totalBookingMinutes!==this.durationMinutes&&(e.TBM=this.totalBookingMinutes),this.belongTreatments>1&&(e.BTR=this.belongTreatments),e}toString(){return JSON.stringify(this,void 0,2)}}function R5(n,e){const t=Q(e.bookingDate,new V({minutes:e.totalMinutes}));return n.getTime()===kt("23:59").getTime()&&t.getHours()===0&&t.getMinutes()===0}function Z3(n,e){const t=[];for(let i=0;i<n.length;i+=2)n[i+1]>=e&&t.push(n[i],n[i+1]);return t}function un(n){return In(n,"HH:mm")}function N5(n,e){return In(n,e,{})}function P0(n){return In(n,"dd")}function _s(n){return In(n,"MM-yyyy")}function Me(n){return In(n,"dd-MM-yyyy")}function kt(n){const e=W(n,"HH:mm").toDate();return e.setFullYear(1970),e.setMonth(0),e.setDate(1),e}function vt(n){const[e,t,i]=n.split("-").map(Number);return new Date(i,t-1,e)}function F1(n){return W(n,"MM-yyyy").toDate()}function M5(n){return n.getHours()>=19&&n.getHours()<=23||n.getHours()>=0&&n.getHours()<=2?J("night"):n.getHours()>=3&&n.getHours()<=4?J("beforeMorning"):n.getHours()>=5&&n.getHours()<=11?J("morning"):J("noon")}function B1(n){return new Date(n.getFullYear(),n.getMonth(),1)}function tn(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate())}function la(n){return new Date(1970,0,1,n.getHours(),n.getMinutes())}function e8(n){const e=[];for(let t=0;t<n.length;t++)e.push(kt(n[t]));return e}function As(n){const e=n.getDay(),t=n.getDate()-e+(e===0?-6:1);return new Date(n.setDate(t))}function L1(n,e){let t=!1;return n.religions.forEach(i=>{var r,o;console.log(e);let s=Me(e);switch(i){case Mf.christian:s=s.substring(0,s.length-4)+"0000",t=(t||((r=ey[Mf.christian])==null?void 0:r[s])!=null)??!1;break;default:t=(t||((o=ey[i])==null?void 0:o[s])!=null)??!1;break}}),t}function oe(n){return`${In(n,"yyyy-MM-dd")}T${In(n,"HH:mm:ss")}.000Z`}function ae(n){const e=n.replace("Z","");return new Date(e)}function R0(n){return new Date(new Date().toISOString())}function ng(n){return vt(Me(n))}function Lv(n,e){let t=n.getFullYear()-e.getFullYear(),i=n.getMonth()-e.getMonth();return i<0&&(t-=1,i+=12),Math.abs(t*12+i)}function yf(n,e){return Rn(R0(n.bookingDate),new V({minutes:e}))}class Yc{constructor({businessId:e="",date:t,id:i="",workerId:s="",businessName:r="",shopIcon:o=new Be}={}){d(this,"businessId","");d(this,"businessName","");d(this,"date");d(this,"id","");d(this,"workerId","");d(this,"shopIcon",new Be);this.businessId=e,this.date=t||void 0,this.id=i,this.workerId=s,this.businessName=r,this.shopIcon=o}static fromJsonStr(e){const t=JSON.parse(e),i=t.date?ae(t.date):void 0,s=t.shopIcon?Be.fromJsonStr(t.shopIcon):new Be,r=new Yc({businessId:t.businessId,date:i,id:t.id,workerId:t.workerId,businessName:t.businessName});return r.shopIcon=s,r}toJsonStr(){const e={businessId:this.businessId,date:this.date?oe(this.date):void 0,id:this.id,workerId:this.workerId,businessName:this.businessName,shopIcon:this.shopIcon.toJsonStr()};return JSON.stringify(e)}toString(){return this.toJsonStr()}}class ig extends Yc{constructor({businessId:t,date:i,id:s,workerId:r,businessName:o,totalMinutes:a,isRecurrence:c,shopIcon:u}){super({businessId:t,date:i,id:s,workerId:r,businessName:o,shopIcon:u});d(this,"isRecurrence",!1);d(this,"totalMinutes",0);this.totalMinutes=a,this.isRecurrence=c}static fromJsonStr(t){const i=JSON.parse(t),s=i.businessId||"",r=i.businessName||"",o=i.date?ae(i.date):void 0,a=i.workerId||"",c=i.id||"",u=i.isRecurrence||!1,l=i.totalMinutes||0,h=i.shopIcon?Be.fromJsonStr(i.shopIcon):void 0;return new ig({businessId:s,date:o,id:c,workerId:a,businessName:r,totalMinutes:l,isRecurrence:u,shopIcon:h})}toJsonStr(){var i;const t={};return t.businessId=this.businessId,t.isRecurrence=this.isRecurrence,t.totalMinutes=this.totalMinutes,this.date!==void 0&&(t.date=oe(this.date)),t.businessName=this.businessName,t.id=this.id,t.workerId=this.workerId,t.shopIcon=((i=this.shopIcon)==null?void 0:i.toJsonStr())||null,JSON.stringify(t)}toString(){return this.toJsonStr()}}class sg{constructor({businessId:e,id:t,businessName:i,type:s,dateToNotify:r,isMulti:o,minutesToAdd:a,address:c,phoneToContact:u,shopIcon:l,fcms:h,totalEventMinutes:f=0,isRecurrence:m=!1}){d(this,"id","");d(this,"businessId","");d(this,"shopIcon",new Be);d(this,"businessName","");d(this,"dateToNotify",new Date(0));d(this,"fcms",new Set);d(this,"minutesToAdd",0);d(this,"address","");d(this,"phoneToContact","");d(this,"isMulti",!1);d(this,"isRecurrence",!1);d(this,"totalEventMinutes",0);d(this,"type","");this.businessId=e,this.id=t,this.businessName=i,this.type=s,this.dateToNotify=r,this.isMulti=o,this.minutesToAdd=a,this.address=c,this.phoneToContact=u,this.shopIcon=l,this.fcms=h,this.totalEventMinutes=f,this.isRecurrence=m}isEqual(e){return e.businessId===this.businessId&&e.businessName===this.businessName&&JSON.stringify([...e.fcms])===JSON.stringify([...this.fcms])&&e.shopIcon.isEqual(this.shopIcon)&&e.totalEventMinutes===this.totalEventMinutes&&e.isMulti===this.isMulti&&e.minutesToAdd===this.minutesToAdd&&e.isRecurrence===this.isRecurrence&&e.type===this.type}static fromJson(e){const t=Be.fromJson(e.SI),i=new Set(e.FS||[]),s=ae(e.dateToNotify);return new sg({businessId:e.I,id:e.ID,businessName:e.B,type:e.T,dateToNotify:s,isMulti:e.IM,minutesToAdd:e.MTA,address:e.A,phoneToContact:e.P,shopIcon:t,fcms:i,totalEventMinutes:e.TEM,isRecurrence:e.IR})}get dbPath(){return`/${UC}/${HC}/1/${this.dateToNotify.getFullYear()}/${this.dateToNotify.getMonth()}/${this.dateToNotify.getDay()}/${this.dateToNotify.getHours()}`}toJson(){const e={};return this.phoneToContact!==""&&(e.P=this.phoneToContact),this.address!==""&&(e.A=this.address),this.type!==""&&(e.T=this.type),this.businessName!==""&&(e.B=this.businessName),this.fcms.size>0&&(e.FS=Array.from(this.fcms)),this.businessId!==""&&(e.I=this.businessId),this.isMulti&&(e.IM=this.isMulti),this.minutesToAdd!==3&&(e.MTA=this.minutesToAdd),this.isRecurrence&&(e.IR=this.isRecurrence),this.totalEventMinutes>0&&(e.TEM=this.totalEventMinutes),e.SI=this.shopIcon.toJson(),e}toString(){return JSON.stringify(this.toJson(),null,2)}}class Fh{constructor({id:e,date:t,isMultiBooking:i,workerId:s,signNewMultiBookingUsers:r=!1}){d(this,"id","");d(this,"date",new Date(0));d(this,"isMultiBooking",!1);d(this,"workerId","");d(this,"signNewMultiBookingUsers",!1);this.id=e,this.date=t,this.isMultiBooking=i,this.workerId=s,this.signNewMultiBookingUsers=r}toJson(){const e={};return e.I=this.id,e.D=oe(this.date),e.WI=this.workerId,this.isMultiBooking&&(e.IMB=this.isMultiBooking),this.signNewMultiBookingUsers&&(e.SNMBU=this.signNewMultiBookingUsers),e}static fromJson(e){const t=e.D?ae(e.D):new Date(0),i=e.I||"",s=e.IMB||!1,r=e.WI||"",o=e.SNMBU||!1;return new Fh({id:i,date:t,isMultiBooking:s,workerId:r,signNewMultiBookingUsers:o})}toString(){return JSON.stringify(this,null,2)}}class t8{constructor({workerId:e="",workerName:t="",businessName:i="",buisnessId:s="",workerPhone:r=""}={}){d(this,"date",new Date(0));d(this,"workerId","");d(this,"workerName","");d(this,"workerPhone","");d(this,"buisnessId","");d(this,"businessName","");d(this,"recurrenceEvent");d(this,"recurrenceRef");d(this,"recurrenceFatherDate");d(this,"recurrenceEventRefInfo");d(this,"recurrenceNotificationsLastDate");d(this,"recurrenceChildDate");this.workerId=e,this.workerName=t,this.businessName=i,this.buisnessId=s,this.workerPhone=r}}const rg="simpletor.officialsimplecode.com",O5="businesses?BusinessId=BUISNESS_ID",og="?PaymentId=PAYMENT_ID";class Bh{constructor({id:e,workerId:t}){d(this,"id","");d(this,"workerId","");d(this,"createdAt",new Date(0));d(this,"signNewMultiBookingUsers",!0);this.id=e,this.workerId=t}get link(){return`https://${rg}/${og}`.replace("PAYMENT_ID",this.id)}static fromJson(e){const t=new Bh({});return t.id=e.id??"",e.createdAt!=null&&(t.createdAt=ae(e.createdAt)||new Date(0)),t.workerId=e.workerId??"",t.signNewMultiBookingUsers=e.signNewMultiBookingUsers??!0,t}toJson(){const e={};return this.createdAt.getTime()!==new Date(0).getTime()&&(e.createdAt=oe(this.createdAt)),this.signNewMultiBookingUsers||(e.signNewMultiBookingUsers=this.signNewMultiBookingUsers),e.id=this.id,e.workerId=this.workerId,e}toString(){return JSON.stringify(this.toJson(),null,2)}}const{v4:Vv}=Xp;class _t extends t8{constructor({workerId:t,workerName:i,businessName:s,buisnessId:r,workerPhone:o}){super({workerId:t,workerName:i,businessName:s,buisnessId:r,workerPhone:o});d(this,"customerName","");d(this,"customerPhone","");d(this,"customerId","");d(this,"orderingOptions",_n.app);d(this,"isVerifiedPhone",!1);d(this,"isUserExist",!0);d(this,"notificationType",Z.none);d(this,"workerNotificationOption",$e.PushOrSMS);d(this,"remindersTypes",new Map);d(this,"workerRemindersTypes",new Map);d(this,"workerDeleted",!1);d(this,"clientMail","");d(this,"showAdressAlert",!1);d(this,"showPhoneAlert",!1);d(this,"signOnDeviceCalendar",!1);d(this,"isMultiRef",!1);d(this,"cancelDate");d(this,"lastTimeNotifyOnDebt");d(this,"adress","");d(this,"wasWaiting",!1);d(this,"bookingDate",new Date(0));d(this,"note","");d(this,"needCancel",!1);d(this,"treatments",new Map);d(this,"userGender",Ie.anonymous);d(this,"workerGender",Ie.anonymous);d(this,"status",Bt.approved);d(this,"confirmedArrival",!1);d(this,"bookingId","");d(this,"userFcms",new Set);d(this,"clientNote","");d(this,"shopIcon",new Be);d(this,"createdAt",new Date);d(this,"finishInvoices",!1);d(this,"invoices",new Map);d(this,"transactions",new Map);d(this,"recurrenceTimeId");d(this,"recurreneFatherDate");d(this,"debts",new Map);d(this,"addToClientAt",!1);d(this,"paymentRequest");d(this,"userDeleted",!1);d(this,"fatherMultiBooking");d(this,"fatherRecurrenceBooking")}static empty(){return new _t({})}static fromBooking(t){const i=new _t({});return i.customerName=t.customerName,i.customerPhone=t.customerPhone,i.customerId=t.customerId,i.workerPhone=t.workerPhone,i.workerGender=t.workerGender,i.userGender=t.userGender,i.businessName=t.businessName,i.buisnessId=t.buisnessId,i.bookingId=t.bookingId,i.workerGender=t.workerGender,i.shopIcon=t.shopIcon,i.recurrenceTimeId=t.recurrenceTimeId,i.note=t.note,i.workerRemindersTypes={...t.workerRemindersTypes},i.signOnDeviceCalendar=t.signOnDeviceCalendar,i.userDeleted=t.userDeleted,i.workerNotificationOption=t.workerNotificationOption,i.paymentRequest=t.paymentRequest,i.remindersTypes={...t.remindersTypes},i.isVerifiedPhone=t.isVerifiedPhone,i.workerDeleted=t.workerDeleted,i.finishInvoices=t.finishInvoices,i.adress=t.adress,i.addToClientAt=t.addToClientAt,i.showAdressAlert=t.showAdressAlert,i.showPhoneAlert=t.showPhoneAlert,i.orderingOptions=t.orderingOptions,i.isUserExist=t.isUserExist,i.isMultiRef=t.isMultiRef,i.needCancel=t.needCancel,i.userGender=t.userGender,i.bookingDate=t.bookingDate,t.recurrenceEventRefInfo!==void 0&&(i.recurrenceEventRefInfo=On.fromRecurrenceEvent(t.recurrenceEventRefInfo)),t.recurrenceEvent!==void 0&&(i.recurrenceEvent=On.fromRecurrenceEvent(t.recurrenceEvent)),i.recurrenceNotificationsLastDate=t.recurrenceNotificationsLastDate,i.cancelDate=t.cancelDate,i.customerId=t.customerId,i.workerPhone=t.workerPhone,i.lastTimeNotifyOnDebt=t.lastTimeNotifyOnDebt,t.debts.forEach((s,r)=>{i.debts.set(r,vo.fromDebt(s))}),i.treatments=new Map,t.treatments.forEach((s,r)=>{const o=bt.fromTreatment(s);o.index=r,i.treatments.set(r,s)}),i.invoices=new Map,t.invoices.forEach((s,r)=>{i.invoices.set(r,Pi.fromBookingInvoiceData(s))}),i.clientNote=t.clientNote,i.status=t.status,i.confirmedArrival=t.confirmedArrival,i.createdAt=t.createdAt,i.clientMail=t.clientMail,i.workerName=t.workerName,i.buisnessId=t.buisnessId,i.notificationType=t.notificationType,i.userFcms=new Set(t.userFcms),i.recurreneFatherDate=t.recurreneFatherDate,i.recurrenceRef=t.recurrenceRef,i.transactions=new Map,t.transactions.forEach((s,r)=>{i.transactions.set(r,qs.fromTransaction(s))}),i}static fromJson(t,i){try{const s=new _t({});if(s.workerGender=Ri[t.workerGender]||Ie.anonymous,s.customerName=t.customerName||"",s.note=t.note||"",s.bookingId=i,s.signOnDeviceCalendar=t.signOnDeviceCalendar||!1,s.userDeleted=t.userDeleted||!1,s.workerDeleted=t.workerDeleted||!1,s.customerId=t.customerId||t.customerPhone||"",s.workerPhone=t.workerPhone||"",s.customerPhone=t.customerPhone||"",s.recurrenceTimeId=t.recurrenceTimeId,s.workerId=t.workerId||t.workerPhone||"",s.adress=t.adress||"",t.shopIcon!=null&&(s.shopIcon=Be.fromJson(t.shopIcon)),s.isVerifiedPhone=t.isVerifiedPhone||!1,s.customerId==s.customerPhone&&s.customerId.length==14&&(s.isVerifiedPhone=!0),s.isMultiRef=t.isMultiRef||!1,s.needCancel=t.needCancel||!1,t.lastTimeNotifyOnDebt!=null&&(s.lastTimeNotifyOnDebt=ae(t.lastTimeNotifyOnDebt)),s.finishInvoices=t.finishInvoices||!1,t.remindersTypes!=null?Object.entries(t.remindersTypes).forEach(([r,o])=>{Ns[r]!=null&&s.remindersTypes.set(Ns[r],o)}):s.remindersTypes=new Map([Gt.regular,t.minutesBeforeNotify||60]),t.workerRemindersTypes!=null&&Object.entries(t.workerRemindersTypes).forEach(([r,o])=>{Ns[r]!=null&&s.workerRemindersTypes.set(Ns[r],o)}),s.clientMail=t.clientMail||"",t.recurrenceNotificationsLastDate!=null&&(s.recurrenceNotificationsLastDate=ae(t.recurrenceNotificationsLastDate)),s.clientNote=t.clientNote||"",s.recurreneFatherDate=t.recurreneFatherDate,s.recurrenceRef=t.recurrenceRef,t.orderingOptions!=null&&(s.orderingOptions=Hw[t.orderingOptions]||_n.app),t.debts!=null&&Object.entries(t.debts).forEach(([r,o])=>{s.debts.set(r,vo.fromJson(o,r))}),t.cancelDate!=null&&(s.cancelDate=ae(t.cancelDate)),s.wasWaiting=t.wasWaiting||!1,s.isUserExist=t.isUserExist||!0,t.invoices!=null&&Object.entries(t.invoices).forEach(([r,o])=>{s.invoices.set(r,Pi.fromJson(o,r,s.workerId))}),t.userGender!=null&&(s.userGender=Ri[t.userGender]||Ie.anonymous),s.status=Uw[t.status.toString()]||Bt.approved,s.confirmedArrival=t.confirmedArrival||!1,t.bookingDate!=null&&(s.bookingDate=ae(t.bookingDate)||new Date(0)),console.log(s.bookingDate),console.log(t.bookingDate),t.treatments!=null){s.treatments=new Map;let r=0;Object.entries(t.treatments).forEach(([o,a])=>{const c=t.treatments[r.toString()];s.treatments.set(r.toString(),bt.fromJson(c,r.toString())),r+=1})}else if(t.treatment!=null){const r=bt.fromJson(t.treatment,"0");s.treatments.set("0",r)}return s.showAdressAlert=t.showAdressAlert||!1,s.showPhoneAlert=t.showPhoneAlert||!1,s.workerName=t.workerName||"",s.businessName=t.businessName||"",s.buisnessId=t.buisnessId||"",t.notificationType!=null?s.notificationType=$w[t.notificationType]||Z.push:t.withMessage?s.notificationType=Z.message:s.notificationType=Z.push,t.workerNotificationOption!=null&&(s.workerNotificationOption=Ml[t.workerNotificationOption]||$e.PushOrSMS),t.userFcms!=null?t.userFcms.forEach(r=>{s.userFcms.add(r)}):t.deviceFCM!=null&&t.deviceFCM!=""&&(s.userFcms=new Set([t.deviceFCM])),t.createdAt!=null&&(s.createdAt=ae(t.createdAt)||new Date(0)),t.RE!=null&&(s.recurrenceEvent=On.fromJson(t.RE,s.bookingDate)),t.RERI!=null&&(s.recurrenceEventRefInfo=On.fromJson(t.RERI)),s.transactions=new Map,t.transactions!=null&&Object.entries(t.transactions).forEach(([r,o])=>{s.transactions.set(r,qs.fromJson(o,r))}),t.paymentRequest!=null&&(s.paymentRequest=Bh.fromJson(t.paymentRequest)),s}catch(s){return de.error(`Error loading booking doc ${i}: ${s}`),new _t({})}}get treatmentLength(){return Array.from(this.treatments.values()).reduce((t,i)=>i.count+t,0)}get canSendMessage(){return this.isVerifiedPhone||this.orderingOptions===_n.byWorker}get treatmentsToStringNotDetailed(){return this.treatmentLength===1?this.treatments.values().next().value.name:this.treatments.size===1?`${this.treatments.values().next().value.name}x${this.treatmentLength}`:`${this.treatments.values().next().value.name}+${this.treatmentLength-1}`}get isPassed(){if(this.recurrenceEvent!=null){if(this.recurrenceChildDate!=null)return Q(this.recurrenceChildDate,new V({minutes:this.totalMinutes+2}))<new Date;const t=this.recurrenceEvent.endOfTheEvent;return t!==void 0&&t<ng(new Date)}else return Q(this.bookingDate,new V({minutes:this.totalMinutes+2}))<new Date}get isRightNow(){return Q(this.recurrenceChildDate??this.bookingDate,new V({minutes:this.totalMinutes}))>new Date&&(this.recurrenceChildDate??this.bookingDate)<new Date}get currentDisplayDate(){return this.recurrenceChildDate??this.bookingDate}get totalMinutes(){let t=0;return this.treatments.forEach((i,s)=>{t+=i.totalMinutesForBooking}),t}get customerHashPhone(){return rr(this.customerPhone)}get bookingWorkTimes(){const t=new Map;let i=this.bookingDate;return this.treatments.forEach((s,r)=>{Array.from({length:s.count}).forEach(()=>{s.times.forEach((o,a)=>{i=Q(i,new V({minutes:o.breakMinutes})),t.set(un(i),o.workMinutes),i=Q(i,new V({minutes:o.workMinutes}))})})}),t}get totalEventsCount(){let t=0;return Object.values(this.treatments).forEach(i=>{t+=i.times.length*i.count}),t}get currency(){return this.treatments.size===0?Ci:this.treatments.values().next().value.price.currency}get invoicesCoverPrice(){const t=Object.values(this.invoices).reduce((i,s)=>i+s.amount,0);return this.finishInvoices||this.invoices.size>0&&t>=this.totalPrice.amount}get totalPrice(){let t=new Vt({amount:"0",currency:Ci});return Object.values(this.treatments).forEach(i=>{t.amount+=i.totalPriceForBooking,t.currency=i.price.currency}),t}get typesOfEvents(){const t=new Map;return this.recurrenceEvent!==null?new Map:(this.needCancel&&t.set(Vs.needCancel,1),this.debts.size>0&&t.set(Vs.withDebts,1),this.status===Bt.waiting&&t.set(Vs.onHold,1),t)}get remindersToFutureNotifications(){const t=[];for(const[i,s]of this.remindersTypes){const r=this.reminder(i);r!==null&&t.push(r)}return t}reminder(t){if(this.notificationType!==Z.push)return null;const i=this.remindersTypes.get(t);if(i===void 0||i===0)return null;const s=yf(this,i);return s<R0()||this.userFcms.size===0?null:new sg({businessName:this.businessName,shopIcon:this.shopIcon,address:this.showAdressAlert?this.adress:"",isMulti:this.isMultiRef,isRecurrence:this.recurrenceEvent!==null||this.recurrenceRef!==null,id:this.reminderId(t),dateToNotify:s,phoneToContact:this.showPhoneAlert?D3(this.workerPhone):"",businessId:this.buisnessId,type:this.treatmentsToStringNotDetailed,minutesToAdd:this.utcDeltaMinutes()+i,totalEventMinutes:this.totalMinutes,fcms:{...this.userFcms}})}utcDeltaMinutes(){const t=new Date,i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes());return Math.floor((Date.now()-i.getTime())/(60*1e3))}get remindersOnBooking(){const t={};return this.cancelDate!==null?{}:this.userFcms.size===0?{}:this.notificationType===Z.message?{}:(this.remindersTypes.forEach((i,s)=>{var o;if(i<=0)return;const r=yf(this,i);r>=R0()&&(t[o=oe(r)]??(t[o]={}),t[oe(r)]={[this.reminderId(s)]:null})}),t)}get bookingsEventsAsJson(){const t=new Map;let i=this.bookingDate,s=this.totalEventsCount,r=0;return this.invoicesCoverPrice,this.treatments.forEach((o,a)=>{Array.from({length:o.count}).forEach(()=>{o.times.forEach((c,u)=>{i=Q(i,new V({minutes:c.breakMinutes}));const l=this.recurrenceTimeId!=null&&this.recurrenceEvent!=null?`${un(i)}_${this.recurrenceTimeId}`:un(i),h=new dc;h.eventIndex=r,h.treatmentId=o.id,h.subTreatmentName=c.title,h.totalBookingMinutes=this.totalMinutes,h.belongTreatments=this.treatmentLength,h.onHold=this.status==="waiting",h.wantDelete=this.needCancel,h.ids=[this.workerId],h.confirmArrival=this.confirmedArrival,h.hasDebt=this.debts.size>0,h.timeId=this.recurrenceEvent!=null?this.recurrenceTimeId:void 0,h.treatmentName=o.name,h.transactionCounter=this.transactions.size,h.eventsBelong=s,h.isBreak=!1,h.partOfRecurrence=this.recurrenceRef!=null,h.hasInvoice,h.recurrenceEvent=this.recurrenceEvent,h.eventName=this.customerId,h.from=i,h.durationMinutes=c.workMinutes,h.colorIndex=o.colorIndex,t.set(l,h.toJson()),i=Q(i,new V({minutes:c.workMinutes})),r+=1})})}),t}get monthStr(){return _s(this.bookingDate)}get toBookingReferencePaymentObj(){return new Fh({id:this.bookingId,isMultiBooking:!1,date:this.bookingDate,workerId:this.workerId})}async copyDataToOrder({user:t,worker:i,needToHoldOn:s,business:r,clientNoteText:o=""}){var c;this.customerName=t.name,this.customerId=t.id,this.customerPhone=t.phoneNumber,this.userGender=t.gender,this.isVerifiedPhone=t.isVerifiedPhone,this.clientMail=t.userPublicData.email;const a=t.userPublicData.clientAt;this.addToClientAt=!a.hasOwnProperty(r.businessId)||!((c=a.get(r.businessId))!=null&&c.has(i.id)),this.userFcms=t.fcmsTokens,this.isVerifiedPhone=t.isVerifiedPhone,this.orderingOptions=_n.web,this.adress=r.adress,this.clientNote=o,this.wasWaiting=!1,this.shopIcon=r.design.shopIconData,Us(this.bookingDate,new Date).inMinutes<60&&!s&&(this.confirmedArrival=!0),this.workerNotificationOption=i.notifications.notificationOption,this.workerRemindersTypes=new Map(i.notifications.remindersTypes);for(const[u,l]of i.notifications.remindersTypes)this.isPassed||u===Gt.confirmArrival&&this.confirmedArrival||(Rn(this.bookingDate,new V({minutes:l}))<Q(new Date,new V({seconds:1}))&&this.recurrenceEvent===void 0?(this.remindersTypes.set(u,this.remindersTypes.get(u)-this.remindersTypes.get(u)%5),this.remindersTypes.get(u)<10&&this.remindersTypes.delete(u)):this.remindersTypes.set(u,l));this.workerId=i.id,this.workerPhone=i.phone,this.workerName=i.name,this.workerGender=i.gender,this.showPhoneAlert=i.notifications.showPhoneAlert,this.showAdressAlert=i.notifications.showAdressAlert,this.businessName=r.shopName,this.bookingId=this.bookingId===""?Vv():this.bookingId,this.buisnessId=r.businessId,s?this.status=Bt.waiting:this.status=Bt.approved,this.notificationType=P1({booking:this,worker:i})}updateBookingByBooking({oldBooking:t,worker:i,needToHoldOn:s,business:r,newClientNote:o,keepRecurrence:a=!1}){if(this.customerName=t.customerName,this.customerPhone=t.customerPhone,this.userGender=t.userGender,this.clientMail=t.clientMail,this.customerId=t.customerId,this.note=t.note,t.treatments.size>this.treatments.size){const u=new Map;let l=0;for(const[h,f]of Object.entries(this.treatments))u.set(l.toString(),f),l+=1;this.treatments=u}const c=new Map([...t.treatments.entries()].sort((u,l)=>u[0].localeCompare(l[0])));t.treatments=c,t.customerPhone!=this.customerPhone?this.orderingOptions=_n.byWorker:this.orderingOptions=t.orderingOptions,o!=null?this.clientNote=o:this.clientNote=t.clientNote,this.workerNotificationOption=i.notifications.notificationOption,this.workerRemindersTypes=new Map(i.notifications.remindersTypes),i.notifications.remindersTypes.forEach((u,l)=>{Rn(this.bookingDate,new V({minutes:u}))<Q(new Date,new V({minutes:1}))&&(this.remindersTypes.set(l,Math.abs(Math.floor(Us(new Date,this.bookingDate).inMinutes/2))),this.remindersTypes.set(l,this.remindersTypes.get(l)-this.remindersTypes.get(l)%5),this.remindersTypes.get(l)<10&&this.remindersTypes.delete(l))}),this.debts=new Map(t.debts),this.isUserExist=t.isUserExist,this.createdAt=t.createdAt,this.lastTimeNotifyOnDebt=t.lastTimeNotifyOnDebt,this.cancelDate=t.cancelDate,this.wasWaiting=t.wasWaiting,this.signOnDeviceCalendar=t.signOnDeviceCalendar,this.recurrenceEvent=void 0,this.recurrenceNotificationsLastDate=void 0,this.recurrenceTimeId=void 0,a||(this.recurrenceRef=void 0,this.recurreneFatherDate=void 0,this.recurrenceEventRefInfo=void 0),this.userDeleted=t.userDeleted,this.paymentRequest=t.paymentRequest,this.shopIcon=r.design.shopIconData,this.workerName=i.name,this.workerGender=i.gender,this.workerId=i.id,this.workerPhone=i.phone,this.showPhoneAlert=i.notifications.showPhoneAlert,this.showAdressAlert=i.notifications.showAdressAlert,this.adress=r.adress,this.businessName=r.shopName,this.bookingId=t.bookingId===""||t.recurrenceEvent!=null?Vv():t.bookingId,this.buisnessId=t.buisnessId,this.notificationType=t.notificationType,this.bookingDate===t.bookingDate?this.status=t.status:this.status=s?Bt.waiting:Bt.approved,this.confirmedArrival=!1,s||Us(this.bookingDate,new Date).inMinutes<60&&(this.confirmedArrival=!0),this.needCancel=t.needCancel,this.finishInvoices=t.finishInvoices,this.invoices=new Map,t.invoices.forEach((u,l)=>{this.invoices.set(l,Pi.fromBookingInvoiceData(u))}),this.transactions=new Map,t.transactions.forEach((u,l)=>{this.transactions.set(l,qs.fromTransaction(u))})}sameTreatments(t){let i=!0;return this.treatmentLength!==t.treatmentLength?!1:(Object.entries(this.treatments).forEach(([s,r])=>{let o=!1;Object.entries(t.treatments).forEach(([a,c])=>{r.id===c.id&&r.count===c.count&&(o=!0)}),i=i&&o}),i)}get businessPayloadData(){return new ho({businessName:this.businessName,businessId:this.buisnessId,shopIcon:this.shopIcon})}get notificationTopic(){return new hc({date:Me(this.bookingDate),businessId:this.buisnessId,workerId:this.workerId,workerName:this.workerName})}get remindersToScheduleMessages(){const t=[];return this.remindersTypes.forEach((i,s)=>{const r=this.reminderMessage(s);r!=null&&t.push(r)}),t}reminderMessage(t){const i=this.remindersTypes.get(t);i==null||i===0||Rn(this.bookingDate,new V({minutes:i}))<new Date}get toBookingNotificationPayload(){return new ig({businessId:this.buisnessId,id:this.bookingId,businessName:this.businessName,totalMinutes:this.totalMinutes,isRecurrence:this.recurrenceEvent!=null,date:this.bookingDate,workerId:this.workerId,shopIcon:this.shopIcon})}get transactionsTotalPaymentPrice(){let t=new Vt({amount:"0",currency:this.totalPrice.currency});for(const i of Object.values(this.transactions))i.type===zn.payment&&(t.amount+=i.amount);return t}get isDepositTransaction(){return Object.keys(this.transactions).length===1?Object.values(this.transactions)[0].type===zn.deposit:!1}get totalDebtAmount(){let t=0;for(const i of Object.values(this.debts))t+=i.amount;return t}get treatmentsToStringDetailed(){let t="";for(const i of Object.values(this.treatments))t+=i.nameForBooking+" + ";return t.length>0?t.substring(0,t.length-3):""}get priceInAdvance(){const t=new Vt({amount:"0",currency:Ci});for(const i of Object.values(this.treatments))t.amount+=i.amountInAdvanceForBooking,t.currency=i.price.currency;return t}get messageRemindersOnBooking(){const t=[];if(this.cancelDate!==null||this.userFcms.size===0||this.notificationType===Z.push)return t;for(const[i,s]of this.remindersTypes){if(s<=0)continue;yf(this,s).toUTCString()>=new Date().toUTCString()&&t.push(this.reminderId(i))}return t}get invoiceItem(){return new InvoiceItem({code:0,information:this.treatmentsToStringDetailed,amountPerItem:this.totalPrice.amount,quantity:1})}get toPaymentRequestUser(){return new gr({name:this.customerName,userId:this.customerId,gender:this.userGender,isVerifiedPhone:this.isVerifiedPhone,isExist:this.isUserExist,phone:this.customerPhone})}get invoiceItems(){const t=new Map;let i=0;for(const s of Object.values(this.treatments)){let r=s.name;s.priceChangingNote!==null&&s.priceChangingNote!==""&&(r+=`: ${s.priceChangingNote}.`),Array.from({length:s.count},o=>{t.set(i,new InvoiceItem({code:i,information:r,amountPerItem:s.price.amount,quantity:1})),i++})}return t}get transactionsTotalDepositPrice(){let t=new Vt({amount:"0",currency:this.totalPrice.currency});for(const i of Object.values(this.transactions))i.type===zn.deposit&&(t.amount+=i.amount);return t}get transactionDepositLength(){let t=0;for(const i of Object.values(this.transactions))i.type===zn.deposit&&(t+=1);return t}get transactionPaymentLength(){let t=0;for(const i of Object.values(this.transactions))i.type===zn.payment&&(t+=1);return t}reminderId(t){return this.createdAt<LC?this.bookingId:`${this.bookingId}__${Or[t]}`}get bookingsEventsAsEvents(){const t=new Map;let i=this.bookingDate,s=this.totalEventsCount,r=0;return this.invoicesCoverPrice,this.treatments.forEach((o,a)=>{Array.from({length:o.count}).forEach(()=>{o.times.forEach((c,u)=>{i=Q(i,new V({minutes:c.breakMinutes}));const l=this.recurrenceTimeId!=null&&this.recurrenceEvent!=null?`${un(i)}_${this.recurrenceTimeId}`:un(i),h=new dc;h.eventIndex=r,h.treatmentId=o.id,h.subTreatmentName=c.title,h.totalBookingMinutes=this.totalMinutes,h.belongTreatments=this.treatmentLength,h.onHold=this.status==="waiting",h.wantDelete=this.needCancel,h.ids=[this.workerId],h.confirmArrival=this.confirmedArrival,h.hasDebt=this.debts.size>0,h.timeId=this.recurrenceEvent!=null?this.recurrenceTimeId:void 0,h.treatmentName=o.name,h.transactionCounter=this.transactions.size,h.eventsBelong=s,h.isBreak=!1,h.partOfRecurrence=this.recurrenceRef!=null,h.hasInvoice,h.recurrenceEvent=this.recurrenceEvent,h.eventName=this.customerId,h.from=i,h.durationMinutes=c.workMinutes,h.colorIndex=o.colorIndex,t.set(l,h),i=Q(i,new V({minutes:c.workMinutes})),r+=1})})}),t}isTheSameAs({booking:t,customerId:i,note:s}){var o,a;let r=!0;if(this.treatments.size!==t.treatments.size)return!1;for(const[c,u]of this.treatments)if(((o=t.treatments.get(c))==null?void 0:o.id)!=u.id||((a=t.treatments.get(c))==null?void 0:a.count)!=u.count){r=!1;break}return r&&t.customerId===i&&t.clientNote===this.clientNote&&t.note===s&&this.bookingDate.getTime()===t.bookingDate.getTime()&&this.workerId===t.workerId}toJson(){const t={};return t.workerGender=eo[this.workerGender],t.customerName=this.customerName,t.note=this.note,t.customerId=this.customerId,this.wasWaiting&&(t.wasWaiting=this.wasWaiting),this.workerDeleted&&(t.workerDeleted=this.workerDeleted),this.cancelDate!=null&&(t.cancelDate=oe(this.cancelDate)),t.remindersTypes={},this.remindersTypes.forEach((i,s)=>{t.remindersTypes[Or[s]]=i}),t.workerRemindersTypes={},this.workerRemindersTypes.forEach((i,s)=>{t.workerRemindersTypes[Or[s]]=i}),this.clientNote!=""&&(t.clientNote=this.clientNote),this.finishInvoices&&(t.finishInvoices=this.finishInvoices),this.debts.size>0&&(t.debts={},this.debts.forEach((i,s)=>{t.debts[s]=i.toJson()})),this.lastTimeNotifyOnDebt!=null&&(t.lastTimeNotifyOnDebt=oe(this.lastTimeNotifyOnDebt)),this.isVerifiedPhone&&(t.isVerifiedPhone=this.isVerifiedPhone),this.userDeleted&&(t.userDeleted=this.userDeleted),t.bookingId=this.bookingId,t.needCancel=this.needCancel,t.userGender=eo[this.userGender],t.businessName=this.businessName,this.signOnDeviceCalendar&&(t.signOnDeviceCalendar=this.signOnDeviceCalendar),this.recurrenceTimeId!=null&&(t.recurrenceTimeId=this.recurrenceTimeId),t.treatments={},this.recurrenceRef!=null&&(t.recurrenceRef=this.recurrenceRef),this.recurreneFatherDate!=null&&(t.recurreneFatherDate=this.recurreneFatherDate),this.treatments.forEach((i,s)=>{t.treatments[s.toString()]=i.toJson()}),t.invoices={},this.invoices.forEach((i,s)=>{t.invoices[s]=i.toJson()}),this.isMultiRef&&(t.isMultiRef=this.isMultiRef),this.isUserExist||(t.isUserExist=this.isUserExist),this.orderingOptions!=_n.app&&(t.orderingOptions=Ww[this.orderingOptions]),this.showAdressAlert&&(t.showAdressAlert=this.showAdressAlert),this.showPhoneAlert&&(t.showPhoneAlert=this.showPhoneAlert),this.adress!=""&&(t.adress=this.adress),this.clientMail!=""&&(t.clientMail=this.clientMail),t.customerPhone=this.customerPhone,t.status=Vw[this.status],t.confirmedArrival=this.confirmedArrival,t.bookingDate=oe(this.bookingDate),t.workerId=this.workerId.toString(),t.workerName=this.workerName,t.buisnessId=this.buisnessId,t.shopIcon=this.shopIcon.toJson(),this.recurrenceNotificationsLastDate!=null&&(t.recurrenceNotificationsLastDate=oe(this.recurrenceNotificationsLastDate)),t.notificationType=GC[this.notificationType],t.workerNotificationOption=KC[this.workerNotificationOption],t.userFcms=Array.from(this.userFcms),t.createdAt=oe(this.createdAt),this.recurrenceEvent!=null&&(t.RE=this.recurrenceEvent.toJson({})),this.recurrenceEventRefInfo!=null&&(t.RERI=this.recurrenceEventRefInfo.toJson({saveStartDate:!0,saveException:!1,saveEnd:!1})),t.transactions={},this.transactions.forEach((i,s)=>{t.transactions[s]=i.toJson()}),this.paymentRequest!=null&&(t.paymentRequest=this.paymentRequest.toJson()),t}}class ag extends Yc{constructor({businessId:e="",date:t,id:i="",workerId:s="",businessName:r="",shopIcon:o}={}){super({businessId:e,date:t,id:i,workerId:s,businessName:r,shopIcon:o})}static fromJsonStr(e){const t=JSON.parse(e),i=t.date?ae(t.date):void 0,s=t.shopIcon?Be.fromJsonStr(t.shopIcon):new Be,r=new ag({businessId:t.businessId,date:i,id:t.id,workerId:t.workerId,businessName:t.businessName});return r.shopIcon=s,r}toJsonStr(){const e={businessId:this.businessId,date:this.date?oe(this.date):void 0,businessName:this.businessName,id:this.id,workerId:this.workerId,shopIcon:this.shopIcon.toJsonStr()};return JSON.stringify(e)}toString(){return this.toJsonStr()}}class cg{constructor(){d(this,"price",new Vt({amount:"0",currency:Ci}));d(this,"id","");d(this,"createdAt",new Date(0))}}class wo{constructor({masofNumber:e="",businessName:t="",adress:i="",businessId:s="",shopIcon:r,businessNumber:o=""}={}){d(this,"masofNumber","");d(this,"businessName","");d(this,"adress","");d(this,"businessNumber","");d(this,"businessId","");d(this,"shopIcon");this.masofNumber=e||"",this.businessName=t||"",this.adress=i||"",this.businessNumber=o||"",this.businessId=s||"",this.shopIcon=r}toJson(){const e={};return e.MN=this.masofNumber,this.shopIcon!==void 0&&(e.SI=this.shopIcon.toJson()),e.BNA=this.businessName,e.BID=this.businessId,e.A=this.adress,e.BNU=this.businessNumber,e}static fromJson(e){const t=e.SI!==void 0?Be.fromJson(e.SI):void 0;return new wo({masofNumber:e.MN||"",businessName:e.BNA||"",businessId:e.BID||"",shopIcon:t,adress:e.A||"",businessNumber:e.BNU||""})}}class Uv{constructor(e=0){d(this,"amount");this.amount=e}addAmount(e){this.amount+=e}removeAmount(e){this.amount-=e}}class ug{constructor({accountNumber:e,bankBranch:t,bankNumber:i,checkNumber:s,amount:r,repaymentDate:o}){d(this,"accountNumber","");d(this,"bankBranch","");d(this,"bankNumber","");d(this,"checkNumber","");d(this,"amount",0);d(this,"repaymentDate",new Date(0));this.accountNumber=e,this.bankBranch=t,this.bankNumber=i,this.checkNumber=s,this.amount=r,this.repaymentDate=o}toJson(){const e={};return e.AN=this.accountNumber,e.BB=this.bankBranch,e.BN=this.bankNumber,e.CN=this.checkNumber,e.A=this.amount,e.RD=oe(this.repaymentDate),e}static fromJson(e){const t=new ug({});return t.accountNumber=e.AN||"",t.bankBranch=e.BB||"",t.bankNumber=e.BN||"",t.checkNumber=e.CN||"",t.amount=e.A||0,t.repaymentDate=ae(e.RD)??new Date(0),t}toString(){return JSON.stringify(this,null,2)}}class El{constructor({amount:e=0,currency:t,onlinePayment:i,cash:s}={}){d(this,"checks",[]);d(this,"onlinePayment");d(this,"cash");d(this,"applicationPayments",[]);d(this,"amount",0);d(this,"currency");this.amount=e,this.currency=t,this.onlinePayment=i,this.cash=s}addCheck(e){this.checks.push(e),this.amount+=e.amount}removeCheck(e){const t=this.checks.indexOf(e);t!==-1&&(this.checks.splice(t,1),this.amount-=e.amount)}addCashAmount(e){this.cash||(this.cash=new Uv),this.cash.addAmount(e),this.amount+=e}removeCashAmount(e){this.cash&&(this.cash.removeAmount(e),this.amount-=e)}get cashAmount(){return this.cash?this.cash.amount:0}toJson(){const e={};return this.checks.length>0&&(e.Ch=this.checks.map(t=>t.toJson())),this.applicationPayments.length>0&&(e.AP=this.applicationPayments.map(t=>t.toJson())),this.cash&&this.cash.amount>0&&(e.CA=this.cash.amount),this.onlinePayment&&(e.OP=this.onlinePayment.amount),e.A=this.amount,e.C=this.currency,e}static fromJson(e){const t=new El;if(t.checks=[],e.Ch&&e.Ch.forEach(i=>{t.checks.push(ug.fromJson(i))}),e.AP&&e.AP.forEach(i=>{t.applicationPayments.push(ApplicationPayment.fromJson(i))}),e.CA){const i=typeof e.CA=="number"?e.CA:parseFloat(e.CA);t.cash=new Uv(i)}return e.OP&&(t.onlinePayment=new OnlinePayment(e.OP)),e.A&&(t.amount=typeof e.A=="number"?e.A:parseFloat(e.A)),t.currency=e.C||"",t}}class lg extends cg{constructor({customerData:t,createdAt:i,paymentsMethods:s,items:r,businessInfo:o,workerInfo:a,invoiceNumber:c,invoiceId:u=""}){super();d(this,"customerData",new ls({}));d(this,"invoiceNumber");d(this,"workerInfo",new InvoiceWorkerInfo);d(this,"businessInfo",new wo);d(this,"invoiceId","");d(this,"signature");d(this,"items",{});d(this,"paymentsMethods",new El);this.customerData=t,this.createdAt=i,this.paymentsMethods=s,this.items=r,this.businessInfo=o,this.workerInfo=a,this.invoiceNumber=c,this.invoiceId=u||"",this.price=new Vt({amount:this.paymentsMethods.amount.toString(),currency:jg[this.paymentsMethods.currency??""]||Ci})}get itemsAsString(){let t="";for(const i in this.items)t+=this.items[i].toItemFormat();return t}get itemsTotalAmount(){let t=0;for(const i in this.items)t+=this.items[i].totalAmount;return t}get toBookingInvoiceData(){return new Pi({issuedBy:this.workerInfo.workerId,docId:this.getInvoiceDocIndexByDate(this.createdAt).toString(),monthStr:_s(this.createdAt),invoiceId:this.invoiceId,amount:this.paymentsMethods.amount})}getInvoiceDocIndexByDate(t){return(parseInt(P0(t),10)||0)>16?2:1}static fromJson(t,i){const s=new lg({});return s.invoiceId=i,t.CD!=null&&(s.customerData=ls.fromMinimalJson(t.CD)),t.RD!=null&&(s.createdAt=ae(t.RD)),t.BI!=null&&(s.businessInfo=wo.fromJson(t.BI)),t.WIN!=null&&(s.workerInfo=InvoiceWorkerInfo.fromJson(t.WIN)),s.items={},Object.entries(t.I).forEach(([r,o])=>{s.items[parseInt(r,10)]=InvoiceItem.fromJson(o,parseInt(r,10))}),t.PM!==void 0&&(s.paymentsMethods=El.fromJson(t.PM)),t.IN!==void 0&&(s.invoiceNumber=parseInt(t.IN,10)),s.price=new Vt({amount:s.paymentsMethods.amount.toString(),currency:jg[s.paymentsMethods.currency??""]||Ci}),s.signature=t.Sig,s}toJson(){const t={};this.invoiceNumber!==void 0&&(t.IN=this.invoiceNumber.toString()),this.signature!==void 0&&(t.Sig=this.signature),t.BI=this.businessInfo.toJson(),t.WIN=this.workerInfo.toJson(),t.RD=oe(this.createdAt),t.CD=this.customerData.toMinimalJson(),t.I={};for(const i in this.items)t.I[i]=this.items[i].toJson();return t.PM=this.paymentsMethods.toJson(),t}get customerHashPhone(){return rr(this.customerData.phoneNumber)}get customerPhoneAsCollection(){return this.customerData.phoneNumber.replace(/-/g,"")}get bookingInvoiceData(){return new Pi({docId:this.docId.toString(),amount:this.paymentsMethods.amount,monthStr:_s(this.createdAt),issuedBy:this.workerInfo.workerId,invoiceId:this.invoiceId})}get link(){let t="";return this.signature===void 0?"":(this.invoiceNumber!==void 0&&(t=YC.replace("MASOFNUMBER",this.businessInfo.masofNumber).replace("INVOICENUMBER",this.invoiceNumber.toString()).replace("SIGNATURE",this.signature)),t)}get toInvoiceNoticaficationPayload(){return new ag({businessId:this.businessInfo.businessId,businessName:this.businessInfo.businessName,date:this.createdAt,id:this.invoiceId})}get docId(){return(parseInt(P0(this.createdAt),10)||0)>16?2:1}toString(){return JSON.stringify(this,null,2)}}class Lh extends Yc{constructor({businessId:e,date:t,id:i,workerId:s,businessName:r,shopIcon:o}){super({businessId:e,date:t,id:i,workerId:s,businessName:r})}static fromJsonStr(e){const t=JSON.parse(e),i=t.businessId||"",s=t.businessName||"",r=t.date?ae(t.date):void 0,o=t.workerId||"",a=t.id||"",c=t.shopIcon?Be.fromJsonStr(t.shopIcon):void 0;return new Lh({businessId:i,date:r,id:a,workerId:o,businessName:s,shopIcon:c})}toJsonStr(){var t;const e={};return e.businessId=this.businessId,this.date!==void 0&&(e.date=oe(this.date)),e.businessName=this.businessName,e.id=this.id,e.workerId=this.workerId,e.shopIcon=((t=this.shopIcon)==null?void 0:t.toJsonStr())||null,JSON.stringify(e)}toString(){return this.toJsonStr()}}class Vh extends cg{constructor({id:t,price:i,createdAt:s,summary:r="",multi:o=!1,userDecline:a=!1,canceled:c=!1,oneTime:u,shopIcon:l,closeForAll:h,workerInfo:f,businessInfo:m}){super();d(this,"id","");d(this,"summary","");d(this,"workerInfo",new InvoiceWorkerInfo);d(this,"businessInfo",new wo);d(this,"payers",0);d(this,"multi",!1);d(this,"closeForAll",!0);d(this,"users",{});d(this,"oneTime",!0);d(this,"userPayments",{});d(this,"userDecline",!1);d(this,"canceled",!1);d(this,"shopIcon",new Be);this.price=i,this.createdAt=s,this.id=t,this.summary=r,this.multi=o,this.userDecline=a,this.canceled=c,this.oneTime=u,this.shopIcon=l,this.closeForAll=h,this.workerInfo=f,this.businessInfo=m}get link(){return`https://${rg}/${og}`.replace("PAYMENT_ID",this.id)}get toPaymentRequestPreview(){const t=new fc({id:this.id,businessName:this.businessInfo.businessName,shopIcon:this.shopIcon,businessId:this.businessInfo.businessId,workerId:this.workerInfo.workerId,price:this.price,oneTime:this.oneTime,workerName:this.workerInfo.workerName,summary:this.summary,closeForAll:this.closeForAll});return t.users=this.users,t.createdAt=this.createdAt,t}get toPaymentRequestNotificationPayload(){const t=new Lh({businessId:this.businessInfo.businessId,id:this.id,businessName:this.businessInfo.businessName,date:this.createdAt,workerId:this.workerInfo.workerId,shopIcon:this.shopIcon});return t.shopIcon=this.shopIcon,t}get businessPayloadData(){return new ho({businessName:this.businessInfo.businessName,businessId:this.businessInfo.businessId,shopIcon:this.shopIcon})}get docId(){return _s(this.createdAt)}get toBookingPaymentRequestData(){const t=new Bh({});return t.createdAt=this.createdAt,t.id=this.id,t.workerId=this.workerInfo.workerId,t}get userPay(){return Object.keys(this.userPayments).length>0}static fromJson(t,i){const s=new Vh({});return s.id=i,t.businessInfo!=null&&(s.businessInfo=wo.fromJson(t.businessInfo)),s.closeForAll=t.closeForAll??!0,t.workerInfo!=null&&(s.workerInfo=InvoiceWorkerInfo.fromJson(t.workerInfo)),t.shopIcon!=null&&(s.shopIcon=Be.fromJson(t.shopIcon)),s.canceled=t.canceled??!1,s.oneTime=t.oneTime??!0,t.price!=null&&(s.price=Vt.fromJson(t.price)),s.multi=t.multi??!1,s.userDecline=t.userDecline??!1,t.userPayments!=null&&typeof t.userPayments=="object"&&Object.entries(t.userPayments).forEach(([r,o])=>{s.userPayments[r]=o!=null?ae(o):new Date(0)}),s.summary=t.summary??"",t.createdAt!=null&&(s.createdAt=t.createdAt!=null?ae(t.createdAt):new Date(0)),s.payers=t.payers??0,s}toJson(){const t={};return this.createdAt!=null&&this.createdAt.getTime()!==new Date(0).getTime()&&(t.createdAt=oe(this.createdAt)),this.oneTime||(t.oneTime=this.oneTime),this.canceled&&(t.canceled=this.canceled),this.summary!==""&&(t.summary=this.summary),this.closeForAll||(t.closeForAll=this.closeForAll),Object.keys(this.userPayments).length>0&&(t.userPayments={},Object.entries(this.userPayments).forEach(([i,s])=>{t.userPayments[i]=oe(s)})),this.payers>0&&(t.payers=this.payers),this.userDecline&&(t.userDecline=this.userDecline),this.multi&&(t.multi=this.multi),t.price=this.price.toJson(),t.workerInfo=this.workerInfo.toJson(),t.businessInfo=this.businessInfo.toJson(),t.shopIcon=this.shopIcon.toJson(),t}toString(){return JSON.stringify(this,null,"  ")}}class fc extends cg{constructor({id:t,price:i,createdAt:s,summary:r="",businessName:o,shopIcon:a,oneTime:c=!1,closeForAll:u=!1,workerName:l,workerId:h,businessId:f}){super();d(this,"id","");d(this,"summary","");d(this,"workerId","");d(this,"businessName","");d(this,"workerName","");d(this,"businessId");d(this,"multi",!1);d(this,"closeForAll",!0);d(this,"users",{});d(this,"oneTime",!0);d(this,"userPayments",{});d(this,"userDecline",!1);d(this,"canceled",!1);d(this,"bookingReference");d(this,"shopIcon",new Be);this.id=t,this.price=i,this.createdAt=s,this.summary=r,this.workerId=h,this.businessId=f,this.businessName=o,this.workerName=l,this.users={},this.closeForAll=u,this.oneTime=c,this.bookingReference=void 0,this.shopIcon=new Be}static empty(){return new fc({})}get link(){return`https://${rg}/${og}`.replaceAll("PAYMENT_ID",this.id)}get payers(){let t=0;return Object.values(this.users).forEach(i=>{t+=Object.keys(i.payments).length}),t}get docId(){return _s(this.createdAt)}toPaymentRequest(t,i){const s=new Vh({id:this.id,price:this.price,oneTime:this.oneTime,shopIcon:this.shopIcon,multi:Object.keys(this.users).length>1,workerInfo:t,businessInfo:i,summary:this.summary,closeForAll:this.closeForAll});return s.createdAt=this.createdAt,s}get toPaymentRequestNotificationPayload(){return new Lh({businessId:this.businessId,businessName:this.businessName,id:this.id,date:this.createdAt,workerId:this.workerId,shopIcon:this.shopIcon})}static fromJson(t,i){const s=new fc({});return s.id=i,t.price!=null&&(s.price=Vt.fromJson(t.price)),s.closeForAll=t.closeForAll??!0,s.summary=t.summary??"",t.shopIcon!=null&&(s.shopIcon=Be.fromJson(t.shopIcon)),t.createdAt!=null&&(s.createdAt=ae(t.createdAt)??new Date(0)),s.oneTime=t.oneTime??!0,s.businessName=t.businessName??"",s.workerId=t.workerId??"",s.businessId=t.businessId??"",s.workerName=t.workerName??"",s.users={},t.users!=null&&Object.entries(t.users).forEach(([r,o])=>{s.users[r]=gr.fromJson(o,r)}),t.bookingReference!=null&&(s.bookingReference=Fh.fromJson(t.bookingReference)),s}toJson(){const t={};return this.createdAt!=new Date(0)&&(t.createdAt=oe(this.createdAt)),this.summary!==""&&(t.summary=this.summary),this.oneTime||(t.oneTime=this.oneTime),this.closeForAll||(t.closeForAll=this.closeForAll),t.price=this.price.toJson(),t.workerId=this.workerId,t.businessName=this.businessName,t.businessId=this.businessId,t.workerName=this.workerName,Object.keys(this.users).length>0&&(t.users={},Object.entries(this.users).forEach(([i,s])=>{t.users[i]=s.toJson()})),this.bookingReference!=null&&(t.bookingReference=this.bookingReference.toJson()),t.shopIcon=this.shopIcon.toJson(),t}toString(){return JSON.stringify(this.toJson(),null,"  ")}}class n8{constructor(){d(this,"bookings",{});d(this,"invoices",{});d(this,"paymentsRequests",{});d(this,"clientAt",{})}get isEmpty(){return this.bookingCount===0&&this.invoicesCount===0&&this.paymentsRequestCount===0}get bookingCount(){let e=0;for(const t of Object.values(this.bookings))e+=Object.keys(t).length;return e}get invoicesCount(){let e=0;for(const t of Object.values(this.invoices))e+=Object.keys(t).length;return e}get paymentsRequestCount(){let e=0;for(const t of Object.values(this.paymentsRequests))e+=Object.keys(t).length;return e}get clientAtJson(){const e={};for(const[t,i]of Object.entries(this.clientAt)){e[t]={};for(const s of i)e[t][s]=""}return e}get bookingsJson(){const e={};for(const[t,i]of Object.entries(this.bookings)){e[t]={};for(const[s,r]of Object.entries(i))e[t][s]=r.toJson()}return e}get invoicesJson(){const e={};for(const[t,i]of Object.entries(this.invoices)){e[t]={};for(const[s,r]of Object.entries(i))e[t][s]=r.toJson()}return e}get paymentRequestJson(){const e={};for(const[t,i]of Object.entries(this.paymentsRequests)){e[t]={};for(const[s,r]of Object.entries(i))e[t][s]=r.toJson()}return e}get bookingsPreviewsJson(){const e={};for(const[t,i]of Object.entries(this.bookings)){const s=new Oh({});for(const[r,o]of Object.entries(i))o.cancelDate===null&&(s.bookingCount=s.bookingCount+1);s.lastUpdateTime=new Date,e[t]=s.toJson()}return e}get whatWeFoundStr(){let e=J("weFound");const t=[];return this.bookingCount>0&&t.push(J("foundBookings").replace("COUNTER",this.bookingCount.toString())),this.invoicesCount>0&&t.push(J("foundInvoices").replace("COUNTER",this.invoicesCount.toString())),this.paymentsRequestCount>0&&t.push(J("foundPaymentsRequests").replace("COUNTER",this.paymentsRequestCount.toString())),t.forEach((i,s)=>{if(s===0){e+=i;return}if(s===t.length-1){e+=" ",e+=J("and")+i;return}e+=", "+i}),e+=", "+J("thatAutoMaticllyAdded"),e}}class i8{constructor(){d(this,"_db");H0().length===0?Rl(B0):Do(),this._db=P6()}async getChild({childPath:e}){try{const t=Ds(this._db,`${je}/${e}`);return await x6(t)}catch(t){throw t}}async updateChild({childPath:e,data:t}){try{const i=Ds(this._db,`${je}/${e}`);return await Cd(i,t),!0}catch{return!1}}async removeChild({childPath:e}){try{const t=Ds(this._db,`${je}/${e}`);return await w6(t),!0}catch{return!1}}async incrementNumberChild({childPath:e,valueId:t,delta:i,command:s}){try{s===fa.decrement&&(i=-i);const r={[t]:Q_(i)},o=Ds(this._db,`${je}/${e}`);return await Cd(o,r),!0}catch{return!1}}async incrementMultipleNumberChild({childPath:e,data:t}){try{const i={};for(const[r,o]of Object.entries(t))i[r]=Q_(o);const s=Ds(this._db,`${je}/${e}`);return await Cd(s,i),!0}catch{return!1}}listenToChild({childPath:e,callback:t}){const i=Ds(this._db,`${je}/${e}`);return I6(i,t)}async setChild({childPath:e,data:t}){try{const i=Ds(this._db,`${je}/${e}`);return await I1(i,t),!0}catch{return!1}}}class s8 extends i8{constructor(){H0().length===0?Rl(B0):Do();super();d(this,"_firestore");this._firestore=jO()}get getBatch(){return g2(this._firestore)}async getDocSRV({path:t,docId:i,insideEnviroments:s=!0}){try{const r=Mt(this._firestore,s?`${je}/${t}`:t),o=Xt(r,i);return await l_(o)}catch(r){throw r instanceof Error&&(de.error(r.message),ve.GI().addError({error:ie.serverError,details:r.message})),r}}async getAllDocsInsideCollection(t){try{const i=Mt(this._firestore,`${je}/${t}`);return(await h_(i)).docs.map(r=>r.data())}catch(i){if(i instanceof Error)throw ve.GI().addError({error:ie.serverError,details:i.toString()}),i;return[]}}async commmitBatch(t){try{return await t.commit(),!0}catch(i){throw de.error("Error while commit batch -->",i),i instanceof Error&&ve.GI().addError({error:ie.serverError,details:i.toString()}),new Error(`Server Error: ${i}`)}}async runTransaction(t){try{return await f2(this._firestore,async s=>{try{return await t(s)}catch(r){return r instanceof Error&&(de.error(`Error while run transaction -> ${r} ${r.stack}`),ve.GI().addError({error:ie.serverError,details:r.toString()})),!1}})}catch(i){throw console.error("Error while run transaction -->",i),i instanceof Error&&ve.GI().addError({error:ie.serverError,details:i.toString()}),new Error(`Server Error: ${i}`)}}async transactionGet(t,i,s){try{const r=Mt(this._firestore,`${je}/${i}`),o=Xt(r,s);return await t.get(o)}catch(r){throw console.error("Error while getting document in transaction -->",r),r instanceof Error&&ve.GI().addError({error:ie.serverError,details:r.toString()}),new Error(`Server Error: ${r}`)}}async transactionUpdateAsMap({transaction:t,path:i,docId:s,fieldName:r,value:o}){try{const a=Mt(this._firestore,`${je}/${i}`),c=Xt(a,s),u={[r]:o||vd()};t.update(c,u)}catch(a){throw de.error("Error while updating document in transaction -->",a),a instanceof Error&&ve.GI().addError({error:ie.serverError,details:a.toString()}),new Error(`Server Error: ${a}`)}}async setAsMap({batch:t,path:i,docId:s,data:r,insideEnviroments:o=!0}){try{const a=Mt(this._firestore,o?`${je}/${i}`:i),c=Xt(a,s);t.set(c,r,{merge:!0})}catch(a){throw a instanceof Error&&ve.GI().addError({error:ie.serverError,details:a.toString()}),a}}async getAllDocsAndIdsInsideCollection({path:t}){try{const i=Mt(this._firestore,`$envKey/${t}`),s=await h_(i),r={};return s.docs.forEach(o=>{r[o.id]=o.data()}),r}catch(i){throw i instanceof Error&&ve.GI().addError({error:ie.serverError,details:i.toString()}),i}}async transactionUpdateMultipleFieldsAsMap({transaction:t,path:i,docId:s,data:r,insideEnvironments:o=!0}){try{const a=Mt(this._firestore,o?`${je}/${i}`:i),c=Xt(a,s),u=this.organizeData(r);t.update(c,u)}catch(a){throw console.error("Error while updating multiple fields in transaction -->",a),a instanceof Error&&ve.GI().addError({error:ie.serverError,details:a.toString()}),new Error(`Server Error: ${a}`)}}async transactionCreateDoc({transaction:t,path:i,docId:s,value:r}){try{const o=Mt(this._firestore,`${je}/${i}`),a=Xt(o,s);t.set(a,r)}catch(o){throw de.error("Error while creating document in transaction -->",o),o instanceof Error&&ve.GI().addError({error:ie.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async transactionSetAsMap({transaction:t,path:i,docId:s,data:r}){try{const o=Mt(this._firestore,`${je}/${i}`),a=Xt(o,s),c=this.organizeData(r);console.log(c),t.set(a,c,{merge:!0})}catch(o){throw de.error("Error while setting document as map in transaction -->",o),o instanceof Error&&ve.GI().addError({error:ie.serverError,details:o.toString()}),new Error(`Server Error: ${o}`)}}async deleteDoc({batch:t,path:i,docId:s}){try{const r=Mt(this._firestore,`${je}/${i}`),o=Xt(r,s);t.delete(o)}catch(r){throw r instanceof Error&&ve.GI().addError({error:ie.serverError,details:r.toString()}),r}}async setDoc({batch:t,path:i,docId:s,valueToSet:r,insideEnviroments:o=!0}){try{const a=Mt(this._firestore,o?`${je}/${i}`:i),c=Xt(a,s);t.set(c,r)}catch(a){throw a instanceof Error&&ve.GI().addError({error:ie.serverError,details:a.toString()}),a}}async createDoc({batch:t,path:i,docId:s,valueAsJson:r,insideEnviroments:o=!0,mergeIfExist:a=!1}){try{const c=Mt(this._firestore,o?`${je}/${i}`:i),u=Xt(c,s);t.set(u,r,{merge:a})}catch(c){throw c instanceof Error&&ve.GI().addError({error:ie.serverError,details:c.toString()}),c}}async updateFieldInsideDocAsMap({batch:t,path:i,docId:s,value:r,fieldName:o,command:a,insideEnviroments:c=!0}){try{const u=Mt(this._firestore,c?`${je}/${i}`:i),l=Xt(u,s);a===void 0?t.update(l,{[o]:r??vd()}):t.update(l,{[o]:a===fa.increment?hu(1):hu(-1)})}catch(u){throw u instanceof Error&&ve.GI().addError({error:ie.serverError,details:u.toString()}),u}}async updateMultipleFieldsInsideDocAsMap({batch:t,path:i,docId:s,data:r,insideEnviroments:o=!0}){try{const a=Mt(this._firestore,o?`${je}/${i}`:i),c=Xt(a,s);t.update(c,this.organizeData(r))}catch(a){throw de.error("Error while updating the batch -->",a),a instanceof Error&&ve.GI().addError({error:ie.serverError,details:a.toString()}),new Error(`Server Error: ${a}`)}}updateFieldInsideDocAsArray({batch:t,path:i,docId:s,fieldName:r,value:o,command:a=Nf.add}){try{const c=Mt(this._firestore,`${je}/${i}`),u=Xt(c,s);t.update(u,{[r]:a===Nf.remove?p2([o]):m2([o])})}catch(c){throw c instanceof Error&&ve.GI().addError({error:ie.serverError,details:c.toString()}),new Error(`Server Error: ${c}`)}}docListener({path:t,docId:i,onChanged:s}){try{const r=Mt(this._firestore,`${je}/${t}`),o=Xt(r,i);return l_(o).then(a=>{a.exists()&&s(a)}),c2(o,s)}catch(r){throw r instanceof Error&&ve.GI().addError({error:ie.serverError,details:r.message}),r}}organizeData(t){var i={};return Object.entries(t).forEach(([s,r])=>{let o=r;o==null&&(o=vd()),o===fa.increment&&(o=hu(1)),o===fa.decrement&&(o=hu(-1)),i[s]=o}),i}get currentTimestamp(){return Le.now()}}class V1 extends s8{constructor(){super()}async getDocRepo({path:e,docId:t,insideEnviroments:i=!0}){return await super.getDocSRV({path:e,docId:t,insideEnviroments:i})}async createDocRepo({path:e,docId:t,valueAsJson:i,insideEnviroments:s=!0,mergeIfExist:r=!1}){const o=this.getBatch;return super.createDoc({batch:o,path:e,docId:t,valueAsJson:i,insideEnviroments:s,mergeIfExist:r}),await this.commmitBatch(o)}async updateFieldInsideDocAsArrayRepo({path:e,docId:t,fieldName:i,value:s,command:r}){const o=this.getBatch;return super.updateFieldInsideDocAsArray({batch:o,path:e,docId:t,fieldName:i,value:s,command:r}),await this.commmitBatch(o)}async updateFieldInsideDocAsMapRepo({path:e,docId:t,fieldName:i,value:s,insideEnviroments:r=!0,command:o=void 0}){const a=this.getBatch;return this.updateFieldInsideDocAsMap({batch:a,path:e,docId:t,fieldName:i,value:s,command:o,insideEnviroments:r}),await this.commmitBatch(a)}async updateMultipleFieldsInsideDocAsMapRepo({path:e,docId:t,data:i,insideEnviroments:s=!0}){const r=this.getBatch;return super.updateMultipleFieldsInsideDocAsMap({batch:r,path:e,docId:t,data:i,insideEnviroments:s}),await this.commmitBatch(r)}async deleteDocRepo({path:e,docId:t}){const i=this.getBatch;return super.deleteDoc({batch:i,path:e,docId:t}),await this.commmitBatch(i)}async setDocRepo({path:e,docId:t,valueAsJson:i,insideEnviroments:s=!0}){const r=this.getBatch;return super.setDoc({batch:r,path:e,docId:t,valueToSet:i,insideEnviroments:s}),await this.commmitBatch(r)}async setAsMapWithMergeRepo({path:e,docId:t,valueAsJson:i,insideEnviroments:s=!0}){const r=this.getBatch;return super.setAsMap({batch:r,path:e,docId:t,data:i,insideEnviroments:s}),await this.commmitBatch(r)}docListenerRepo({path:e,docId:t,onChanged:i}){return super.docListener({path:e,docId:t,onChanged:i})}async getWorkerFromTransactionRepo({transaction:e,workerId:t,businessModel:i,needMultiDoc:s=!1}){const r=`${Tt}/${gt.currentBusinesssId}/${sn}`,o=await this.transactionGet(e,r,t);if(!o.exists())return;const a=lc.fromWorkerDocJson(o.data());return await super.transactionGet(e,`${r}/${t}/${at}`,nn).then(c=>{c.exists()&&a.workerPublicData.setWorkerPublicData(c.data())}),a.hasRecurrenceEvents&&a.isCustomersNeedRecurrence&&await super.transactionGet(e,`${r}/${t}/${at}`,Fw).then(c=>{c.exists()&&c.data()!=null&&a.recurrence.setRecurrenceEvents(c.data(),t,i??sr.empty())}),s&&await super.transactionGet(e,`${r}/${t}/${at}`,Lw).then(c=>{c.exists()&&a.multiEventsTimes.setData(c.data())}),a}toFormatedCustomerData({customerData:e,amountOfBookingsCommand:t,useUserFirstBookingsDate:i=!1,saveExtraData:s=!1}){const r=e.toJson();r.amoutOfBookings=t;const o={};return o[`data.${e.customerUuid}.amoutOfBookings`]=r.amoutOfBookings,r.lastBookingsDate!=null&&(o[`data.${e.customerUuid}.lastBookingsDate`]=r.lastBookingsDate),i?r.userFirstBookingsDate!=null&&(o[`data.${e.customerUuid}.userFirstBookingsDate`]=r.userFirstBookingsDate):r.firstBookingsDate!=null&&(o[`data.${e.customerUuid}.firstBookingsDate`]=r.firstBookingsDate),s&&(r.gender!=null&&(o[`data.${e.customerUuid}.gender`]=r.gender),r.name!=null&&(o[`data.${e.customerUuid}.name`]=r.name),r.workerNaming!=null&&(o[`data.${e.customerUuid}.name`]=r.workerNaming),r.email!=null&&(o[`data.${e.customerUuid}.email`]=r.email),r.id!=null&&(o[`data.${e.customerUuid}.id`]=r.id)),o}async realTimeEventsCounterHandler({businessId:e,workerId:t,types:i,increment:s}){if(i.size===0)return!0;const r=Fa.GI().getWorkerCountersPath(e,t),o={};return i.forEach((a,c)=>{ty[c]!==null&&a!==0&&(o[ty[c]]=(s?1:-1)*a)}),Object.keys(o).length===0?!0:await this.incrementMultipleNumberChild({childPath:r,data:o})}}class r8 extends V1{constructor(){super()}async updatePublicUserField({userId:e,businessesIds:t,fieldName:i,cangeUserDoc:s=!0,value:r}){console.log(r);const o=this.getBatch;return s&&this.updateFieldInsideDocAsMap({batch:o,path:en,docId:e,fieldName:i,value:r}),this.updateFieldInsideDocAsMap({batch:o,path:`${en}/${e}/${at}`,docId:nn,fieldName:i,value:r}),t.forEach(a=>{this.updateFieldInsideDocAsMap({batch:o,path:`${Tt}/${a}/${sn}`,docId:e,fieldName:i,value:r})}),await this.commmitBatch(o)}async updatePublicUserFields({userId:e,businessesIds:t,cangeUserDoc:i=!0,dataForWorker:s,data:r}){const o=this.getBatch;return i&&this.updateMultipleFieldsInsideDocAsMap({batch:o,path:en,docId:e,data:r}),this.updateMultipleFieldsInsideDocAsMap({batch:o,path:`${en}/${e}/${at}`,docId:nn,data:r}),t.forEach(a=>{this.updateMultipleFieldsInsideDocAsMap({batch:o,path:`${Tt}/${a}/${sn}`,docId:e,data:s||r})}),await this.commmitBatch(o)}async createUser({user:e}){const t=this.getBatch;return this.createDoc({batch:t,path:en,docId:e.id,valueAsJson:e.toUserDocJson()}),this.setAsMap({batch:t,path:`${en}/${e.id}/${at}`,docId:nn,data:e.userPublicData.toJson()}),await this.commmitBatch(t)}async mergePhoneDataWithUser({phone:e,userId:t,name:i}){const s=new n8,r=rr(e),o=e.replaceAll("-",""),a=async c=>{const u=await this.transactionGet(c,Hn,r);if(u.exists()&&u.data().userId!=t)return ve.GI().error=ie.alreadyExistPhone,!1;const l=await this.transactionGet(c,`${Hn}/${r}/${o}`,zg);l.exists()&&l.data()!=null&&Object.entries(l.data().clientAt).forEach(([p,y])=>{Object.keys(y).length!==0&&(s.clientAt[p]=new Set,Object.entries(y).forEach(([g,x])=>{s.clientAt[p].add(g)}))});const h=await this.getAllDocsAndIdsInsideCollection({path:`${Hn}/${r}/${o}/${wr}/${da}`});Object.entries(h).forEach(([p,y])=>{var g;(g=s.bookings)[p]??(g[p]={}),Object.entries(y).forEach(([x,_])=>{const v=_t.fromJson(_,x);v.customerId=t,v.isUserExist=!0,s.bookings[p][x]=v})});const f=await this.getAllDocsAndIdsInsideCollection({path:`${Hn}/${r}/${o}/${wr}/${td}`});Object.entries(f).forEach(([p,y])=>{var g;(g=s.invoices)[p]??(g[p]={}),Object.entries(y).forEach(([x,_])=>{const v=lg.fromJson(_,x);s.invoices[p][x]=v})});const m=await this.getAllDocsAndIdsInsideCollection({path:`${Hn}/${r}/${o}/${wr}/${nd}`});return Object.entries(m).forEach(([p,y])=>{var g;(g=s.paymentsRequests)[p]??(g[p]={}),Object.entries(y).forEach(([x,_])=>{const v=Vh.fromJson(_,x);s.paymentsRequests[p][x]=v})}),(s.clientAt.isNotEmpty||s.bookingCount>0)&&this.transactionSetAsMap({transaction:c,path:`${en}/${t}/${at}`,docId:nn,data:{clientAt:s.clientAtJson,bookingsPreviews:s.bookingsPreviewsJson}}),this.transactionCreateDoc({transaction:c,path:Hn,docId:rr(e),value:{userId:t,name:i}}),Object.entries(s.bookingsJson).forEach(([p,y])=>{this.transactionSetAsMap({transaction:c,path:`${en}/${t}/${at}/${nn}/${da}`,docId:p,data:y})}),Object.entries(s.invoicesJson).forEach(([p,y])=>{this.transactionSetAsMap({transaction:c,path:`${en}/${t}/${at}/${nn}/${td}`,docId:p,data:y})}),Object.entries(s.paymentRequestJson).forEach(([p,y])=>{this.transactionSetAsMap({transaction:c,path:`${en}/${t}/${at}/${nn}/${nd}`,docId:p,data:y})}),!0};return await this.runTransaction(a).then(async c=>{if(c){const u=[];return s.clientAt.isNotEmpty&&u.push(this.deleteDoc({batch:this.getBatch,path:`${Hn}/${r}/${o}`,docId:zg})),Object.entries(s.invoices).forEach(([l,h])=>{u.push(this.deleteDoc({batch:this.getBatch,path:`${Hn}/${r}/${o}/${wr}/${td}`,docId:l}))}),Object.entries(s.paymentsRequests).forEach(([l,h])=>{u.push(this.deleteDoc({batch:this.getBatch,path:`${Hn}/${r}/${o}/${wr}/${nd}`,docId:l}))}),Object.entries(s.bookings).forEach(([l,h])=>{u.push(this.deleteDoc({batch:this.getBatch,path:`${Hn}/${r}/${o}/${wr}/${da}`,docId:l}))}),s.bookings.isNotEmpty&&Object.entries(s.bookings).forEach(([l,h])=>{Object.entries(h).forEach(([f,m])=>{u.push(this.updateMultipleFieldsInsideDocAsMapRepo({path:`${Tt}/${m.buisnessId}/${sn}/${m.workerId}/${at}/${nn}/${Ow}`,docId:Me(m.bookingDate),data:m.isMultiRef?{[`${un(m.bookingDate)}.users.${f}.customerId`]:t,[`${un(m.bookingDate)}.users.${f}.isUserExist`]:!0,[`${un(m.bookingDate)}.users.${f}.isVerifiedPhone`]:!0}:{[`${f}.customerId`]:t,[`${f}.isUserExist`]:!0,[`${f}.isVerifiedPhone`]:!0}}))})}),s.paymentsRequests.isNotEmpty&&Object.entries(s.paymentsRequests).forEach(([l,h])=>{Object.entries(h).forEach(([f,m])=>{u.push(new Promise(async()=>{const p=await this.getDocSRV({path:qg,docId:f});if(p.data()===void 0||!p.exists())return;const g=fc.fromJson(p.data(),f).users[e];g!=null&&(g.isExist=!0,g.isVerifiedPhone=!0,g.userId=t,await this.updateMultipleFieldsInsideDocAsMapRepo({path:qg,docId:f,data:{[`users.${e}`]:void 0,[`users.${t}`]:g.toJson()}}))}))})}),u.length>0&&await Promise.all(u),s}})}}function U1(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const o8=U1,W1=new yc("auth","Firebase",U1());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il=new Sl("@firebase/auth");function a8(n,...e){Il.logLevel<=ge.WARN&&Il.warn(`Auth (${ar}): ${n}`,...e)}function Tu(n,...e){Il.logLevel<=ge.ERROR&&Il.error(`Auth (${ar}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(n,...e){throw dg(n,...e)}function dn(n,...e){return dg(n,...e)}function H1(n,e,t){const i=Object.assign(Object.assign({},o8()),{[e]:t});return new yc("auth","Firebase",i).create(e,{appName:n.name})}function hg(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&si(n,"argument-error"),H1(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function dg(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return W1.create(n,...e)}function $(n,e,...t){if(!n)throw dg(e,...t)}function Ii(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Tu(e),new Error(e)}function Li(n,e){n||Ii(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function $1(){return Wv()==="http:"||Wv()==="https:"}function Wv(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c8(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($1()||XD()||"connection"in navigator)?navigator.onLine:!0}function u8(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Li(t>e,"Short delay should be less than long delay!"),this.isMobile=U0()||yw()}get(){return c8()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(n,e){Li(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ii("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ii("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ii("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l8={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h8=new Jc(3e4,6e4);function $i(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function bn(n,e,t,i,s={}){return z1(n,s,async()=>{let r={},o={};i&&(e==="GET"?o=i:r={body:JSON.stringify(i)});const a=or(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),q1.fetch()(G1(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},r))})}async function z1(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},l8),e);try{const s=new d8(n),r=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw ha(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw ha(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw ha(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw ha(n,"user-disabled",o);const l=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw H1(n,l,u);si(n,l)}}catch(s){if(s instanceof Ui)throw s;si(n,"network-request-failed",{message:String(s)})}}async function Uh(n,e,t,i,s={}){const r=await bn(n,e,t,i,s);return"mfaPendingCredential"in r&&si(n,"multi-factor-auth-required",{_serverResponse:r}),r}function G1(n,e,t,i){const s=`${e}${t}?${i}`;return n.config.emulator?fg(n.config,s):`${n.config.apiScheme}://${s}`}class d8{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(dn(this.auth,"network-request-failed")),h8.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ha(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=dn(n,e,i);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hv(n){return n!==void 0&&n.getResponse!==void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f8(n){return(await bn(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m8(n,e){return bn(n,"POST","/v1/accounts:delete",e)}async function p8(n,e){return bn(n,"POST","/v1/accounts:update",e)}async function g8(n,e){return bn(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function y8(n,e=!1){const t=Te(n),i=await t.getIdToken(e),s=mg(i);$(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:ba(_f(s.auth_time)),issuedAtTime:ba(_f(s.iat)),expirationTime:ba(_f(s.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function _f(n){return Number(n)*1e3}function mg(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Tu("JWT malformed, contained fewer than 3 sections"),null;try{const s=ku(t);return s?JSON.parse(s):(Tu("Failed to decode base64 JWT payload"),null)}catch(s){return Tu("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function _8(n){const e=mg(n);return $(e,"internal-error"),$(typeof e.exp<"u","internal-error"),$(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xo(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Ui&&v8(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function v8({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w8{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ba(this.lastLoginAt),this.creationTime=ba(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mc(n){var e;const t=n.auth,i=await n.getIdToken(),s=await xo(n,g8(t,{idToken:i}));$(s==null?void 0:s.users.length,t,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?I8(r.providerUserInfo):[],a=E8(n.providerData,o),c=n.isAnonymous,u=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),l=c?u:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Y1(r.createdAt,r.lastLoginAt),isAnonymous:l};Object.assign(n,h)}async function x8(n){const e=Te(n);await mc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function E8(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function I8(n){return n.map(e=>{var{providerId:t}=e,i=F0(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T8(n,e){const t=await z1(n,{},async()=>{const i=or({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=G1(n,s,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",q1.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function D8(n,e){return bn(n,"POST","/v2/accounts:revokeToken",$i(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$(e.idToken,"internal-error"),$(typeof e.idToken<"u","internal-error"),$(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):_8(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return $(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:r}=await T8(e,t);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:r}=t,o=new pc;return i&&($(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),s&&($(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),r&&($(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new pc,this.toJSON())}_performRefresh(){return Ii("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ji(n,e){$(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class zs{constructor(e){var{uid:t,auth:i,stsTokenManager:s}=e,r=F0(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new w8(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Y1(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await xo(this,this.stsTokenManager.getToken(this.auth,e));return $(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return y8(this,e)}reload(){return x8(this)}_assign(e){this!==e&&($(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new zs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await mc(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await xo(this,m8(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,s,r,o,a,c,u,l;const h=(i=t.displayName)!==null&&i!==void 0?i:void 0,f=(s=t.email)!==null&&s!==void 0?s:void 0,m=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,y=(a=t.tenantId)!==null&&a!==void 0?a:void 0,g=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,x=(u=t.createdAt)!==null&&u!==void 0?u:void 0,_=(l=t.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:T,stsTokenManager:D}=t;$(v&&D,e,"internal-error");const C=pc.fromJSON(this.name,D);$(typeof v=="string",e,"internal-error"),Ji(h,e.name),Ji(f,e.name),$(typeof w=="boolean",e,"internal-error"),$(typeof I=="boolean",e,"internal-error"),Ji(m,e.name),Ji(p,e.name),Ji(y,e.name),Ji(g,e.name),Ji(x,e.name),Ji(_,e.name);const R=new zs({uid:v,auth:e,email:f,emailVerified:w,displayName:h,isAnonymous:I,photoURL:p,phoneNumber:m,tenantId:y,stsTokenManager:C,createdAt:x,lastLoginAt:_});return T&&Array.isArray(T)&&(R.providerData=T.map(E=>Object.assign({},E))),g&&(R._redirectEventId=g),R}static async _fromIdTokenResponse(e,t,i=!1){const s=new pc;s.updateFromServerResponse(t);const r=new zs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await mc(r),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v=new Map;function Ti(n){Li(n instanceof Function,"Expected a class definition");let e=$v.get(n);return e?(Li(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,$v.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}J1.type="NONE";const qv=J1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Du(n,e,t){return`firebase:${n}:${e}:${t}`}class jr{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=Du(this.userKey,s.apiKey,r),this.fullPersistenceKey=Du("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?zs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new jr(Ti(qv),e,i);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let r=s[0]||Ti(qv);const o=Du(i,e.config.apiKey,e.name);let a=null;for(const u of t)try{const l=await u._get(o);if(l){const h=zs._fromJSON(e,l);u!==r&&(a=h),r=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new jr(r,e,i):(r=c[0],a&&await r._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==r)try{await u._remove(o)}catch{}})),new jr(r,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(j1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(K1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Z1(e))return"Blackberry";if(eD(e))return"Webos";if(pg(e))return"Safari";if((e.includes("chrome/")||Q1(e))&&!e.includes("edge/"))return"Chrome";if(X1(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function K1(n=$t()){return/firefox\//i.test(n)}function pg(n=$t()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Q1(n=$t()){return/crios\//i.test(n)}function j1(n=$t()){return/iemobile/i.test(n)}function X1(n=$t()){return/android/i.test(n)}function Z1(n=$t()){return/blackberry/i.test(n)}function eD(n=$t()){return/webos/i.test(n)}function Wh(n=$t()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function A8(n=$t()){var e;return Wh(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function C8(){return ZD()&&document.documentMode===10}function tD(n=$t()){return Wh(n)||X1(n)||eD(n)||Z1(n)||/windows phone/i.test(n)||j1(n)}function b8(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD(n,e=[]){let t;switch(n){case"Browser":t=zv($t());break;case"Worker":t=`${zv($t())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ar}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k8{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=r=>new Promise((o,a)=>{try{const c=e(r);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S8(n,e={}){return bn(n,"GET","/v2/passwordPolicy",$i(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P8=6;class R8{constructor(e){var t,i,s,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:P8,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,s,r,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(r=c.containsUppercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let s=0;s<e.length;s++)i=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N8{constructor(e,t,i,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gv(this),this.idTokenSubscription=new Gv(this),this.beforeStateQueue=new k8(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=W1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ti(t)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await jr.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const i=await this.assertedPersistence.getCurrentUser();let s=i,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(s=c.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return $(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=u8()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Te(e):null;return t&&$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Ti(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await S8(this),t=new R8(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new yc("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await D8(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ti(e)||this._popupRedirectResolver;$(t,this,"argument-error"),this.redirectPersistenceManager=await jr.create(this,[Ti(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if($(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,i,s);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nD(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&a8(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Is(n){return Te(n)}class Gv{constructor(e){this.auth=e,this.observer=null,this.addObserver=cA(t=>this.observer=t)}get next(){return $(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M8(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function iD(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const r=dn("internal-error");r.customData=s,t(r)},i.type="text/javascript",i.charset="UTF-8",M8().appendChild(i)})}function sD(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O8(n,e){const t=Pl(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),r=t.getOptions();if(Pu(r,e??{}))return s;si(s,"already-initialized")}return t.initialize({options:e})}function F8(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Ti);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function B8(n,e,t){const i=Is(n);$(i._canInitEmulator,i,"emulator-config-failed"),$(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),r=rD(e),{host:o,port:a}=L8(e),c=a===null?"":`:${a}`;i.config.emulator={url:`${r}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||V8()}function rD(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function L8(n){const e=rD(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const r=s[1];return{host:r,port:Yv(i.substr(r.length+1))}}else{const[r,o]=i.split(":");return{host:r,port:Yv(o)}}}function Yv(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function V8(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ii("not implemented")}_getIdTokenResponse(e){return Ii("not implemented")}_linkToIdToken(e,t){return Ii("not implemented")}_getReauthenticationResolver(e){return Ii("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xr(n,e){return Uh(n,"POST","/v1/accounts:signInWithIdp",$i(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U8="http://localhost";class Vi extends gg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Vi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):si("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s}=t,r=F0(t,["providerId","signInMethod"]);if(!i||!s)return null;const o=new Vi(i,s);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Xr(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Xr(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Xr(e,t)}buildRequest(){const e={requestUri:U8,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=or(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W8(n,e){return bn(n,"POST","/v1/accounts:sendVerificationCode",$i(n,e))}async function H8(n,e){return Uh(n,"POST","/v1/accounts:signInWithPhoneNumber",$i(n,e))}async function $8(n,e){const t=await Uh(n,"POST","/v1/accounts:signInWithPhoneNumber",$i(n,e));if(t.temporaryProof)throw ha(n,"account-exists-with-different-credential",t);return t}const q8={USER_NOT_FOUND:"user-not-found"};async function z8(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Uh(n,"POST","/v1/accounts:signInWithPhoneNumber",$i(n,t),q8)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends gg{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Gs({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Gs({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return H8(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return $8(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return z8(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:i,phoneNumber:s,temporaryProof:r}=e;return!i&&!t&&!s&&!r?null:new Gs({verificationId:t,verificationCode:i,phoneNumber:s,temporaryProof:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo extends Kc{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ka extends Uo{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return $("providerId"in t&&"signInMethod"in t,"argument-error"),Vi._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return $(e.idToken||e.accessToken,"argument-error"),Vi._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ka.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ka.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:r,nonce:o,providerId:a}=e;if(!i&&!s&&!t&&!r||!a)return null;try{return new ka(a)._credential({idToken:t,accessToken:i,nonce:o,pendingToken:r})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends Uo{constructor(){super("facebook.com")}static credential(e){return Vi._fromParams({providerId:mi.PROVIDER_ID,signInMethod:mi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mi.credentialFromTaggedObject(e)}static credentialFromError(e){return mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return mi.credential(e.oauthAccessToken)}catch{return null}}}mi.FACEBOOK_SIGN_IN_METHOD="facebook.com";mi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi extends Uo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Vi._fromParams({providerId:pi.PROVIDER_ID,signInMethod:pi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return pi.credentialFromTaggedObject(e)}static credentialFromError(e){return pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return pi.credential(t,i)}catch{return null}}}pi.GOOGLE_SIGN_IN_METHOD="google.com";pi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji extends Uo{constructor(){super("github.com")}static credential(e){return Vi._fromParams({providerId:ji.PROVIDER_ID,signInMethod:ji.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ji.credentialFromTaggedObject(e)}static credentialFromError(e){return ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ji.credential(e.oauthAccessToken)}catch{return null}}}ji.GITHUB_SIGN_IN_METHOD="github.com";ji.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi extends Uo{constructor(){super("twitter.com")}static credential(e,t){return Vi._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Xi.credential(t,i)}catch{return null}}}Xi.TWITTER_SIGN_IN_METHOD="twitter.com";Xi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const r=await zs._fromIdTokenResponse(e,i,s),o=Jv(i);return new Eo({user:r,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=Jv(i);return new Eo({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function Jv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl extends Ui{constructor(e,t,i,s){var r;super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,Tl.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new Tl(e,t,i,s)}}function oD(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Tl._fromErrorAndOperation(n,r,e,i):r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G8(n,e){const t=Te(n);await cD(!0,t,e);const{providerUserInfo:i}=await p8(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=aD(i||[]);return t.providerData=t.providerData.filter(r=>s.has(r.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function yg(n,e,t=!1){const i=await xo(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Eo._forOperation(n,"link",i)}async function cD(n,e,t){await mc(e);const i=aD(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";$(i.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uD(n,e,t=!1){const{auth:i}=n,s="reauthenticate";try{const r=await xo(n,oD(i,s,e,n),t);$(r.idToken,i,"internal-error");const o=mg(r.idToken);$(o,i,"internal-error");const{sub:a}=o;return $(n.uid===a,i,"user-mismatch"),Eo._forOperation(n,s,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&si(i,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lD(n,e,t=!1){const i="signIn",s=await oD(n,i,e),r=await Eo._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(r.user),r}async function hD(n,e){return lD(Is(n),e)}async function Y8(n,e){const t=Te(n);return await cD(!1,t,e.providerId),yg(t,e)}async function J8(n,e){return uD(Te(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K8(n,e){return bn(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q8(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=Te(n),r={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await xo(i,K8(i.auth,r));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function j8(n,e,t,i){return Te(n).onIdTokenChanged(e,t,i)}function X8(n,e,t){return Te(n).beforeAuthStateChanged(e,t)}function Z8(n,e,t,i){return Te(n).onAuthStateChanged(e,t,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eL(n,e){return bn(n,"POST","/v2/accounts/mfaEnrollment:start",$i(n,e))}const Dl="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Dl,"1"),this.storage.removeItem(Dl),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tL(){const n=$t();return pg(n)||Wh(n)}const nL=1e3,iL=10;class fD extends dD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=tL()&&b8(),this.fallbackToPolling=tD(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(i);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const s=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},r=this.storage.getItem(i);C8()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,iL):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},nL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}fD.type="LOCAL";const sL=fD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD extends dD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}mD.type="SESSION";const pD=mD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rL(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new Hh(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:r}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,r)),c=await rL(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _g(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,o;return new Promise((a,c)=>{const u=_g("",20);s.port1.start();const l=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(l),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(f.data.response);break;default:clearTimeout(l),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(){return window}function aL(n){st().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(){return typeof st().WorkerGlobalScope<"u"&&typeof st().importScripts=="function"}async function cL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function uL(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function lL(){return vg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gD="firebaseLocalStorageDb",hL=1,Al="firebaseLocalStorage",yD="fbase_key";class Qc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function $h(n,e){return n.transaction([Al],e?"readwrite":"readonly").objectStore(Al)}function dL(){const n=indexedDB.deleteDatabase(gD);return new Qc(n).toPromise()}function M0(){const n=indexedDB.open(gD,hL);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Al,{keyPath:yD})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Al)?e(i):(i.close(),await dL(),e(await M0()))})})}async function Kv(n,e,t){const i=$h(n,!0).put({[yD]:e,value:t});return new Qc(i).toPromise()}async function fL(n,e){const t=$h(n,!1).get(e),i=await new Qc(t).toPromise();return i===void 0?null:i.value}function Qv(n,e){const t=$h(n,!0).delete(e);return new Qc(t).toPromise()}const mL=800,pL=3;class _D{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await M0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>pL)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hh._getInstance(lL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await cL(),!this.activeServiceWorker)return;this.sender=new oL(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||uL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await M0();return await Kv(e,Dl,"1"),await Qv(e,Dl),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Kv(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>fL(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Qv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const r=$h(s,!1).getAll();return new Qc(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:s,value:r}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_D.type="LOCAL";const gL=_D;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yL(n,e){return bn(n,"POST","/v2/accounts/mfaSignIn:start",$i(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _L=500,vL=6e4,pu=1e12;class wL{constructor(e){this.auth=e,this.counter=pu,this._widgets=new Map}render(e,t){const i=this.counter;return this._widgets.set(i,new xL(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;const i=e||pu;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;const i=e||pu;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const i=e||pu;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""}}class xL{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;$(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=EL(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},vL)},_L))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function EL(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vf=sD("rcb"),IL=new Jc(3e4,6e4),TL="https://www.google.com/recaptcha/api.js?";class DL{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=st().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return $(AL(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Hv(st().grecaptcha)?Promise.resolve(st().grecaptcha):new Promise((i,s)=>{const r=st().setTimeout(()=>{s(dn(e,"network-request-failed"))},IL.get());st()[vf]=()=>{st().clearTimeout(r),delete st()[vf];const a=st().grecaptcha;if(!a||!Hv(a)){s(dn(e,"internal-error"));return}const c=a.render;a.render=(u,l)=>{const h=c(u,l);return this.counter++,h},this.hostLanguage=t,i(a)};const o=`${TL}?${or({onload:vf,render:"explicit",hl:t})}`;iD(o).catch(()=>{clearTimeout(r),s(dn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=st().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function AL(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class CL{async load(e){return new wL(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD="recaptcha",bL={theme:"light",type:"image"};class kL{constructor(e,t,i=Object.assign({},bL)){this.parameters=i,this.type=vD,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Is(e),this.isInvisible=this.parameters.size==="invisible",$(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;$(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new CL:new DL,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(s=>{const r=o=>{o&&(this.tokenChangeListeners.delete(r),s(o))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){$(!this.parameters.sitekey,this.auth,"argument-error"),$(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),$(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){const i=st()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){$(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){$($1()&&!vg(),this.auth,"internal-error"),await SL(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await f8(this.auth);$(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return $(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function SL(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PL{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Gs._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function RL(n,e,t){const i=Is(n),s=await wD(i,e,Te(t));return new PL(s,r=>hD(i,r))}async function wD(n,e,t){var i;const s=await t.verify();try{$(typeof s=="string",n,"argument-error"),$(t.type===vD,n,"argument-error");let r;if(typeof e=="string"?r={phoneNumber:e}:r=e,"session"in r){const o=r.session;if("phoneNumber"in r)return $(o.type==="enroll",n,"internal-error"),(await eL(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{$(o.type==="signin",n,"internal-error");const a=((i=r.multiFactorHint)===null||i===void 0?void 0:i.uid)||r.multiFactorUid;return $(a,n,"missing-multi-factor-info"),(await yL(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await W8(n,{phoneNumber:r.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function NL(n,e){await yg(Te(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e){this.providerId=Ys.PROVIDER_ID,this.auth=Is(e)}verifyPhoneNumber(e,t){return wD(this.auth,e,Te(t))}static credential(e,t){return Gs._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ys.credentialFromTaggedObject(t)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:i}=e;return t&&i?Gs._fromTokenResponse(t,i):null}}Ys.PROVIDER_ID="phone";Ys.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(n,e){return e?Ti(e):($(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg extends gg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Xr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Xr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Xr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ML(n){return lD(n.auth,new wg(n),n.bypassAuthState)}function OL(n){const{auth:e,user:t}=n;return $(t,e,"internal-error"),uD(t,new wg(n),n.bypassAuthState)}async function FL(n){const{auth:e,user:t}=n;return $(t,e,"internal-error"),yg(t,new wg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(e,t,i,s,r=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ML;case"linkViaPopup":case"linkViaRedirect":return FL;case"reauthViaPopup":case"reauthViaRedirect":return OL;default:si(this.auth,"internal-error")}}resolve(e){Li(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Li(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BL=new Jc(2e3,1e4);async function wf(n,e,t){const i=Is(n);hg(n,e,Kc);const s=qh(i,t);return new Di(i,"signInViaPopup",e,s).executeNotNull()}async function xf(n,e,t){const i=Te(n);hg(i.auth,e,Kc);const s=qh(i.auth,t);return new Di(i.auth,"reauthViaPopup",e,s,i).executeNotNull()}async function Ef(n,e,t){const i=Te(n);hg(i.auth,e,Kc);const s=qh(i.auth,t);return new Di(i.auth,"linkViaPopup",e,s,i).executeNotNull()}class Di extends xD{constructor(e,t,i,s,r){super(e,t,s,r),this.provider=i,this.authWindow=null,this.pollId=null,Di.currentPopupAction&&Di.currentPopupAction.cancel(),Di.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $(e,this.auth,"internal-error"),e}async onExecution(){Li(this.filter.length===1,"Popup operations only handle one event");const e=_g();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(dn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(dn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Di.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,BL.get())};e()}}Di.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL="pendingRedirect",Au=new Map;class VL extends xD{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Au.get(this.auth._key());if(!e){try{const i=await UL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Au.set(this.auth._key(),e)}return this.bypassAuthState||Au.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function UL(n,e){const t=$L(e),i=HL(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}function WL(n,e){Au.set(n._key(),e)}function HL(n){return Ti(n._redirectPersistence)}function $L(n){return Du(LL,n.config.apiKey,n.name)}async function qL(n,e,t=!1){const i=Is(n),s=qh(i,e),o=await new VL(i,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zL=10*60*1e3;class GL{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!YL(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!ED(e)){const s=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(dn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zL&&this.cachedEventUids.clear(),this.cachedEventUids.has(jv(e))}saveEventToCache(e){this.cachedEventUids.add(jv(e)),this.lastProcessedEventTime=Date.now()}}function jv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ED({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function YL(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ED(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JL(n,e={}){return bn(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QL=/^https?/;async function jL(n){if(n.config.emulator)return;const{authorizedDomains:e}=await JL(n);for(const t of e)try{if(XL(t))return}catch{}si(n,"unauthorized-domain")}function XL(n){const e=N0(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!QL.test(t))return!1;if(KL.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZL=new Jc(3e4,6e4);function Xv(){const n=st().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function e9(n){return new Promise((e,t)=>{var i,s,r;function o(){Xv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Xv(),t(dn(n,"network-request-failed"))},timeout:ZL.get()})}if(!((s=(i=st().gapi)===null||i===void 0?void 0:i.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((r=st().gapi)===null||r===void 0)&&r.load)o();else{const a=sD("iframefcb");return st()[a]=()=>{gapi.load?o():t(dn(n,"network-request-failed"))},iD(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Cu=null,e})}let Cu=null;function t9(n){return Cu=Cu||e9(n),Cu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9=new Jc(5e3,15e3),i9="__/auth/iframe",s9="emulator/auth/iframe",r9={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},o9=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function a9(n){const e=n.config;$(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?fg(e,s9):`https://${n.config.authDomain}/${i9}`,i={apiKey:e.apiKey,appName:n.name,v:ar},s=o9.get(n.config.apiHost);s&&(i.eid=s);const r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${t}?${or(i).slice(1)}`}async function c9(n){const e=await t9(n),t=st().gapi;return $(t,n,"internal-error"),e.open({where:document.body,url:a9(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:r9,dontclear:!0},i=>new Promise(async(s,r)=>{await i.restyle({setHideOnLeave:!1});const o=dn(n,"network-request-failed"),a=st().setTimeout(()=>{r(o)},n9.get());function c(){st().clearTimeout(a),s(i)}i.ping(c).then(c,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u9={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},l9=500,h9=600,d9="_blank",f9="http://localhost";class Zv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function m9(n,e,t,i=l9,s=h9){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},u9),{width:i.toString(),height:s.toString(),top:r,left:o}),u=$t().toLowerCase();t&&(a=Q1(u)?d9:t),K1(u)&&(e=e||f9,c.scrollbars="yes");const l=Object.entries(c).reduce((f,[m,p])=>`${f}${m}=${p},`,"");if(A8(u)&&a!=="_self")return p9(e||"",a),new Zv(null);const h=window.open(e||"",a,l);$(h,n,"popup-blocked");try{h.focus()}catch{}return new Zv(h)}function p9(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g9="__/auth/handler",y9="emulator/auth/handler",_9=encodeURIComponent("fac");async function ew(n,e,t,i,s,r){$(n.config.authDomain,n,"auth-domain-config-required"),$(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:ar,eventId:s};if(e instanceof Kc){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Tf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[l,h]of Object.entries(r||{}))o[l]=h}if(e instanceof Uo){const l=e.getScopes().filter(h=>h!=="");l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const l of Object.keys(a))a[l]===void 0&&delete a[l];const c=await n._getAppCheckToken(),u=c?`#${_9}=${encodeURIComponent(c)}`:"";return`${v9(n)}?${or(a).slice(1)}${u}`}function v9({config:n}){return n.emulator?fg(n,y9):`https://${n.authDomain}/${g9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If="webStorageSupport";class w9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pD,this._completeRedirectFn=qL,this._overrideRedirectResult=WL}async _openPopup(e,t,i,s){var r;Li((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await ew(e,t,i,N0(),s);return m9(e,o,_g())}async _openRedirect(e,t,i,s){await this._originValidation(e);const r=await ew(e,t,i,N0(),s);return aL(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:r}=this.eventManagers[t];return s?Promise.resolve(s):(Li(r,"If manager is not set, promise should be"),r)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await c9(e),i=new GL(e);return t.register("authEvent",s=>($(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(If,{type:If},s=>{var r;const o=(r=s==null?void 0:s[0])===null||r===void 0?void 0:r[If];o!==void 0&&t(!!o),si(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=jL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return tD()||pg()||Wh()}}const x9=w9;var tw="@firebase/auth",nw="1.5.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I9(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function T9(n){Ks(new hs("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;$(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nD(n)},u=new N8(i,s,r,c);return F8(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Ks(new hs("auth-internal",e=>{const t=Is(e.getProvider("auth").getImmediate());return(i=>new E9(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Kn(tw,nw,I9(n)),Kn(tw,nw,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D9=5*60,A9=pw("authIdTokenMaxAge")||D9;let iw=null;const C9=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>A9)return;const s=t==null?void 0:t.token;iw!==s&&(iw=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function b9(n=Do()){const e=Pl(n,"auth");if(e.isInitialized())return e.getImmediate();const t=O8(n,{popupRedirectResolver:x9,persistence:[gL,sL,pD]}),i=pw("authTokenSyncURL");if(i){const r=C9(i);X8(t,r,()=>r(t.currentUser)),j8(t,o=>r(o))}const s=dw("auth");return s&&B8(t,`http://${s}`),t}T9("Browser");const Dr={"operation-not-allowed":ie.providerNotAllowed,"user-disabled":ie.userDisable,"provider-already-linked":ie.providerAlreadyLinked,"credential-already-in-use":ie.credentialAlreadyInUse,"invalid-verification-code":ie.wrongOptCode,"invalid-verification-id":ie.verification,"invalid-credential":ie.invalidCredential,"user-mismatch":ie.userMissmatch,"user-not-found":ie.userNotFound,"no-such-provider":ie.noSuchProvider,canceled:ie.userExitManually,"too-many-requests":ie.tooManyAttempts,"too-many-attempts":ie.tooManyAttempts,"expired-code":ie.expiredCode,"account-exists-with-different-credential":ie.credentialAlreadyInUse,"invalid-phone-number":ie.invalidPhoneNumber};var k9=(n=>(n[n.login=0]="login",n[n.link=1]="link",n[n.reauthenticate=2]="reauthenticate",n[n.phoneUpdate=3]="phoneUpdate",n))(k9||{});class S9{constructor(){d(this,"_auth");H0().length===0?Rl(B0):Do(),this._auth=b9(),this._auth.languageCode=yn(aw)??"en"}async signInWithFacebookSRV(e){try{return await this.signInWithFacebookWebSRV(e),!0}catch(t){return t instanceof Error&&(console.error(`Error: ${t}`),de.error(`it was an error the error is --> ${t}`),de.error(t.name),ve.GI().details=t.name,ve.GI().error=Dr[t.name]??ie.unknown),!1}}async signInWithFacebookWebSRV(e){const t=new mi;switch(t.addScope("email"),t.setCustomParameters({display:"popup"}),e){case 0:await wf(this._auth,t);break;case 1:await Ef(this._auth.currentUser,t);break;case 2:await xf(this._auth.currentUser,t);break}}async signInWithGoogleSRV(e){try{return await this.signInWithGoogleWebSRV(e),!0}catch(t){return t instanceof Error&&(console.error(`Error: ${t}`),de.error(`it was an error the error is --> ${t}`),de.error(t.name),ve.GI().details=t.name,ve.GI().error=Dr[t.name]??ie.unknown),!1}}async signInWithGoogleWebSRV(e){const t=new pi;switch(t.addScope("email"),t.addScope("profile"),t.setCustomParameters({login_hint:"user@example.com"}),e){case 0:await wf(this._auth,t);break;case 1:await Ef(this._auth.currentUser,t);break;case 2:await xf(this._auth.currentUser,t);break}}async signInWithAppleSRV(e){try{return await this.signInWithAppleWebSRV(e),!0}catch(t){return t instanceof Error&&(console.error(`Error: ${t}`),de.error(`it was an error the error is --> ${t}`),de.error(t.name),ve.GI().details=t.name,ve.GI().error=Dr[t.name]??ie.unknown),!1}}async signInWithAppleWebSRV(e){const t=new ka("apple.com");switch(t.addScope("email"),t.addScope("name"),e){case 0:await wf(this._auth,t);break;case 1:await Ef(this._auth.currentUser,t);break;case 2:await xf(this._auth.currentUser,t);break}}async signInWithOtpSRV({loginType:e,verificationId:t,otp:i,autocredential:s}){const r=s??Ys.credential(t,i);try{switch(e){case 0:await hD(this._auth,r);break;case 1:await Y8(this._auth.currentUser,r);break;case 2:await J8(this._auth.currentUser,r);break;case 3:await NL(this._auth.currentUser,r);break}return!0}catch(o){return console.error(`Error: ${o}`),o instanceof Error&&(console.error(`Error: ${o}`),de.error(`it was an error the error is --> ${o}`),de.error(o.name),ve.GI().details=o.name,ve.GI().error=Dr[o.name]??ie.unknown),!1}}get isLoggedInSRV(){return this._auth.currentUser!=null}onAuthUserStateChangedSRV(e){return Z8(this._auth,e)}async updateUserNameSRV(e){try{await Q8(this._auth.currentUser,{displayName:e}),await this._auth.currentUser.reload()}catch(t){throw t instanceof Error&&ve.GI().addError({error:ie.updateDisplayName,details:t.toString()}),t}}userConnectedOnlyLocallySRV(){return this.isLoggedInSRV&&this._auth.currentUser.displayName===null}async sendSmsForFirebaseVerificationSRV({completePhone:e,onCodeSent:t,onFailed:i}){const s=new Date;let r;const o=document.getElementById("recaptcha-container");console.log(o),console.log("wwwwwww");const a=new kL(this._auth,o,{size:"invisible",callback:c=>{console.log(c)}});console.log("222222222222222"),await RL(this._auth,e,a).then(c=>{console.log("ssssssssssss"),t(c.verificationId)}).catch(c=>{console.log("wwwwwwwwwwwwwwwww"),c instanceof Error&&(ve.GI().details=c.message,ve.GI().error=Dr[c.message]??Dr[c.name]??ie.unknown,i(e,c,r,s))})}get lastLoginDateSRV(){var e;return(e=this._auth.currentUser)==null?void 0:e.metadata.lastSignInTime}get userIdSRV(){if(this._auth.currentUser!=null){const e=this._auth.currentUser.displayName;return e!==null&&e.includes("&&")&&e.includes("+")?this.userPhoneSRV:this._auth.currentUser.uid}return""}get userDataSRV(){return this._auth.currentUser}async userClaimsSRV(){return this._auth.currentUser===null?null:(await this._auth.currentUser.getIdToken(!0),(await this._auth.currentUser.getIdTokenResult()).claims)}get userPhoneSRV(){if(this._auth.currentUser!==null){const t=this._auth.currentUser.displayName.split("&&")[1];return this._auth.currentUser.phoneNumber.replace(t,`${t}-`)}return""}get existsProvidersSRV(){if(this._auth.currentUser===null)return new Set;const e=new Set;return this._auth.currentUser.providerData.forEach(t=>{e.add(t.providerId)}),e}async deleteUserSRV(){if(this._auth.currentUser===null)return!1;try{return await this._auth.currentUser.delete(),!0}catch{return!1}}async unlinkProviderSRV({providerId:e}){try{return G8(this._auth.currentUser,e),!0}catch{return!1}}async reloadUserSRV(){this._auth.currentUser!==null&&await this._auth.currentUser.reload()}async logoutSRV(){try{return await this._auth.signOut(),!this.isLoggedInSRV}catch{return!1}}}class P9 extends S9{constructor(){super()}async signInWithGoogle(e){return await this.signInWithGoogleSRV(e)}async signInWithApple(e){return await this.signInWithAppleSRV(e)}async signInWithFacebook(e){return await this.signInWithFacebookSRV(e)}onAuthUserStateChanged(e){return this.onAuthUserStateChangedSRV(e)}async sendSmsForFirebaseVerification({completePhone:e,onCodeSent:t,onFailed:i}){await this.sendSmsForFirebaseVerificationSRV({completePhone:e,onCodeSent:t,onFailed:i})}async signInWithOtp({loginType:e,verificationId:t,otp:i}){return await this.signInWithOtpSRV({loginType:e,verificationId:t,otp:i})}async logout(){return await this.logoutSRV()}async unlinkProvider({providerId:e}){return await this.unlinkProviderSRV({providerId:e})}async deleteUser(){return await this.deleteUserSRV()}async reloadUser(){await this.reloadUserSRV()}userConnectedOnlyLocally(){return this.userConnectedOnlyLocallySRV()}async updateUserName({name:e}){try{return await this.updateUserNameSRV(e),!0}catch(t){return console.error(`Error occurred while saving user name --> ${t}`),!1}}get isLoggedIn(){return this.isLoggedInSRV}get existsProviders(){return this.existsProvidersSRV}get userData(){return this.userDataSRV}get userId(){return this.userIdSRV}get lastLoginDate(){return this.lastLoginDateSRV}async userClaims(){return await this.userClaimsSRV}}async function R9(){var s,r;if(gt.currentBusinesssId!==""){let o=0;for(;Xe.GI().workers.isEmpty&&o<10;)o++,await new Promise(a=>setTimeout(a,100))}const n={},e=Ai.GI().user,t=new Map,i=e.bookings.recurrence||{};for(const o of Object.values(e.bookings.futureBookings))for(const[a,c]of Object.entries(o))t.set(a,c);for(const[o,a]of Object.entries(i)){if(a.buisnessId!==Xe.GI().business.businessId||a.status!==Bt.approved||a.recurrenceEvent==null)continue;const c=Xe.GI().workers[a.workerId];if(c==null)continue;const u=c.notifications.remindersTypes.size===0?0:Math.max(...Object.values(c.notifications.remindersTypes));let l=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDay(),a.bookingDate.getHours(),a.bookingDate.getMinutes());for(;l<Q(new Date,new V({minutes:u}));){if(l<new Date){l=Q(l,new V({days:1}));continue}if(!a.recurrenceEvent.isAccureInDate({date:l})){l=Q(l,new V({days:1}));continue}const h=_t.fromBooking(a);h.bookingDate=l;let f=!1;Rn(l,Qg)<new Date&&(f=!0,n[s=Gt.regular]??(n[s]=[]),n[Gt.regular].push(h));for(const[m,p]of a.remindersTypes)Gt.regular===m&&f||c.notifications.remindersTypes.get(m)!=null&&(Rn(l,new V({minutes:c.notifications.remindersTypes.get(m)}))<new Date||(n[m]||(n[m]=[]),n[m].push(h)));l=Q(l,new V({days:1}))}}for(const[o,a]of t){if(a.buisnessId!==Xe.GI().business.businessId||a.status!==Bt.approved)continue;const c=Xe.GI().workers[a.workerId];if(c==null||a.bookingDate<new Date)continue;let u=!1;Rn(a.bookingDate,Qg)<new Date&&(u=!0,n[r=Gt.regular]||(n[r]=[]),n[Gt.regular].push(a));for(const[l,h]of a.remindersTypes)c.notifications.remindersTypes.get(l)!=null&&(Gt.regular===l&&u||Rn(a.bookingDate,new V({minutes:c.notifications.remindersTypes.get(l)}))>=new Date)}return n}function F5(n,e){const t=new Date;return t.setMinutes(t.getMinutes()+e.onHoldMinutes),t.getTime()>n.getTime()}const Rs=class Rs{constructor(){d(this,"user",new Qr({}));d(this,"verificationRepo",new P9);d(this,"userRepo",new r8);d(this,"userDoc")}static GI(){return Rs.instance||(Rs.instance=new Rs),Rs.instance}get getPermission(){return 0}isDeveloper(){return this.isConnected?gt.developers.hasOwnProperty(this.user.id.replace("+","")):!1}get isConnected(){return this.verificationRepo.isLoggedIn}get userId(){try{return this.verificationRepo.userId}catch{return""}}async setupUser({newUserId:e="",logoutIfDosentExist:t=!1}){var i;try{return gf.set(!1),de.info(`The user id is -> ${e}`),e.length<5?(await this.verificationRepo.logout(),!0):(this.userDoc===void 0&&(this.userDoc=await this.userRepo.getDocSRV({path:en,docId:e})),!t&&(this.userDoc===void 0||!this.userDoc.exists())?(this.userDoc=void 0,!0):(this.user=Qr.fromUserDocJson((i=this.userDoc)==null?void 0:i.data()),this.startPublicDataListening(),S0.set(this.user),gf.set(!0),!0))}catch(s){return this.userDoc=void 0,s instanceof Error&&(de.error(`Error while setting up the user --> ${s}`),ve.GI().addError({details:s.toString()})),!1}}async startPublicDataListening(){this.isConnected&&(this.user.userPublicDataListener=this.userRepo.docListener({path:`${en}/${this.user.id}/${at}`,docId:nn,onChanged:async e=>{try{e.exists()&&(this.user.setUserPublicData(e.data()),console.log("eeeeeeeeeeeeeeee"),console.log(this.user.userPublicData.bookingsDocsToLoad),await this.loadBookingsDocs(this.user.userPublicData.bookingsDocsToLoad),de.info("Getting new user data from database"),this.user.userPublicData.reminders={},gt.currentBusinesssId!==""&&(this.user.userPublicData.reminders=await R9()))}catch(t){console.error(`Error in startPublicDataListening: ${t}`)}}}))}async loadBookingsDocs(e){const t=[];e.forEach(i=>{t.push(this.loadBookingDoc(i))}),await Promise.all(t)}async logout(){return this.verificationRepo.logout().then(async e=>(e&&(this.user=new Qr({}),S0.set(this.user),gf.set(!1)),e))}async loadBookingDoc(e){try{const t=await this.userRepo.getDocSRV({path:Fa.GI().userBookingsPathByUser(this.user.id),docId:e});e===Bw?this.user.bookings.setRecurrence((t==null?void 0:t.data())||{}):this.user.bookings.setMonth((t==null?void 0:t.data())||{},e)}catch(t){de.error(`Error loading booking doc ${e}: ${t}`)}}};d(Rs,"instance");let Ai=Rs;const ID=1440,TD=60,N9=40,M9=150,{v4:O9}=Xp;class xn{constructor({displayDate:e,maxParticipants:t=1,currentParticipants:i=0,isMulti:s=!1,isHoliday:r=!1,signedPaymentRequestId:o,isVacation:a=!1,recurrenceTimeId:c,showParticipants:u=!0,showMultiWaitingList:l=!0,recurrenceFatherBookingId:h,isWaitingList:f=!1,recurrenceMultiEvent:m,fatherRecurrenceMultiEventDate:p}){d(this,"displayDate");d(this,"from",new Date(0));d(this,"maxParticipants",0);d(this,"currentParticipants",0);d(this,"showParticipants",!0);d(this,"isWaitingList",!1);d(this,"showMultiWaitingList",!0);d(this,"duration",new V({}));d(this,"isMulti",!1);d(this,"recurrenceMultiEvent");d(this,"fatherRecurrenceMultiEventDate");d(this,"recurrenceFatherBookingId");d(this,"recurrenceTimeId");d(this,"isVacation",!1);d(this,"isHoliday",!1);d(this,"id","");d(this,"signedPaymentRequestId");this.id=O9(),this.displayDate=e,this.maxParticipants=t,this.currentParticipants=i,this.isMulti=s,this.isHoliday=r,this.signedPaymentRequestId=o,this.isVacation=a,this.recurrenceTimeId=c,this.showParticipants=u,this.showMultiWaitingList=l,this.recurrenceFatherBookingId=h,this.isWaitingList=f,this.recurrenceMultiEvent=m,this.fatherRecurrenceMultiEventDate=p}static fromTimePickerObj(e){const t=new xn({displayDate:e.displayDate,recurrenceTimeId:e.recurrenceTimeId,showMultiWaitingList:e.showMultiWaitingList,isVacation:e.isVacation,isHoliday:e.isHoliday,isMulti:e.isMulti,signedPaymentRequestId:e.signedPaymentRequestId,maxParticipants:e.maxParticipants,currentParticipants:e.currentParticipants,showParticipants:e.showParticipants,recurrenceFatherBookingId:e.recurrenceFatherBookingId,recurrenceMultiEvent:e.recurrenceMultiEvent,fatherRecurrenceMultiEventDate:e.fatherRecurrenceMultiEventDate});return t.from=e.from,t.duration=e.duration,t}get hasFreePlace(){return this.maxParticipants>this.currentParticipants}get timeId(){if(this.displayDate)return this.recurrenceTimeId?`${this.dateToTimeStr(this.displayDate)}_${this.recurrenceTimeId}`:this.dateToTimeStr(this.displayDate)}static fromScheduleEvent(e){const t=new xn({});return t.displayDate=e.displayDate,t.recurrenceTimeId=e.recurrenceTimeId,t.showMultiWaitingList=e.showMultiWaitingList,t.isVacation=e.isVacation??!1,t.isHoliday=e.isHoliday??!1,t.isMulti=e.isMulti??!1,t.signedPaymentRequestId=e.signedPaymentRequestId,t.maxParticipants=e.maxParticipants??0,t.currentParticipants=e.currentParticipants??0,t.showParticipants=e.showParticipants??!0,t.recurrenceFatherBookingId=e.recurrenceFatherBookingId,e.recurrenceMultiEvent!=null&&(t.recurrenceMultiEvent=On.fromJson(e.recurrenceMultiEvent)),t.fatherRecurrenceMultiEventDate=e.fatherRecurrenceMultiEventDate,t.from=e.from,t.duration=e.duration,t}toJson(){const e={};return e.from=this.from,e.id=this.id,e.duration=this.duration.inMinutes,e.to=Q(this.from,this.duration),e.displayDate=this.displayDate??"",this.recurrenceTimeId!=null&&(e.recurrenceTimeId=this.recurrenceTimeId),this.recurrenceFatherBookingId!=null&&(e.recurrenceFatherBookingId=this.recurrenceFatherBookingId),this.fatherRecurrenceMultiEventDate!=null&&(e.fatherRecurrenceMultiEventDate=this.fatherRecurrenceMultiEventDate),this.recurrenceMultiEvent!=null&&(e.recurrenceMultiEvent=this.recurrenceMultiEvent.toJson({})),this.showMultiWaitingList||(e.showMultiWaitingList=this.showMultiWaitingList),this.isVacation&&(e.isVacation=this.isVacation),this.isHoliday&&(e.isHoliday=this.isHoliday),this.isMulti&&(e.isMulti=this.isMulti),this.signedPaymentRequestId!=null&&(e.signedPaymentRequestId=this.signedPaymentRequestId),this.maxParticipants!=0&&(e.maxParticipants=this.maxParticipants),this.currentParticipants!=0&&(e.currentParticipants=this.currentParticipants),this.showParticipants||(e.showParticipants=this.showParticipants),e}dateToTimeStr(e){return""}}function DD(n,e,t,i){return n.closeScheduleOnHolidays&&L1(n,e)?(de.debug("Holiday is a free day for this worker -> don't generate times"),!0):!t&&n.recurrence.vacationInDate(e)!=null?(de.debug("Vacation is a free day for this worker -> don't generate times"),!0):!i&&n.isClosingDate(e)?(de.debug("This day is closing by the worker"),!0):!1}function AD(n,e,t){let i=0,s=0;const r=Array.from(e.values());return n.forEach(o=>{const a=r[s].start,c=Q(a,r[s].duration);for(o;o<t.length&&!(o+1>=t.length);o+=2){const u=_c(t[o],t[o+1],a,c);if(u==="STRIKE"){const l=Us(t[o+1],a);i=Math.max(i,l.inMinutes);break}if(u==="BEFORE")break}s+=1}),i}function F9(n,e,t){let i=0;const s=Object.values(e);let r=s.length-1;return n.forEach(o=>{const a=s[r].start,c=Q(a,s[r].duration);for(o;o>=0&&!(o-1<0);o-=2){const u=_c(t[o-1],t[o],a,c);if(u==="STRIKE"){const l=Us(c,t[o-1]).inMinutes;i=Math.max(i,l);break}if(u==="AFTER")break}r-=1}),i}function Gn(n,e){n.forEach((t,i)=>{t.start=Q(t.start,new V({minutes:e})),n.set(i,t)})}function B9(n,e,t,i){const s=i.windowSpaces===Bn.custom?i.customWindowMinute:i.windowSpaces===Bn.longestTreatment?i.longestBookingTime:i.shortBookingTime;console.log("worker.longestBookingTime",i.longestBookingTime,"worker.shortBookingTime",i.shortBookingTime);const r=Q(n,new V({minutes:s}));if(t.length<=0||t[0]+1>=e.length)return s;const o=e[t[0]],a=e[t[0]+1];return o>n&&o<r?new V({milliseconds:a.getTime()-n.getTime()}).inMinutes:s}function L9(n,e,t,i){const s=i.windowSpaces===Bn.custom?i.customWindowMinute:i.windowSpaces===Bn.longestTreatment?i.longestBookingTime:i.shortBookingTime,r=Rn(n,new V({minutes:s}));if(t.length<=0||t[0]+1>=e.length)return s;const o=e[t[0]];return o.getTime()<n.getTime()&&o.getTime()>r.getTime()?n.getTime()-o.getTime():s}function V9({worker:n,bookingDate:e,oldBooking:t,recurrenceSkipDate:i,isUpdate:s=!1,workerAction:r=!1}){const o=[],a=vt(e);n.workerPublicData.bookingsTimes[e]&&Object.entries(n.workerPublicData.bookingsTimes[e]).forEach(([l,h])=>{const f=kt(l);o.push(f,Q(f,new V({minutes:h})))});const c=new Set;s&&t&&t.recurrenceEvent&&i&&t.bookingsEventsAsEvents.forEach((l,h)=>{const f=kt(h);c.add(oe(new Date(i.getFullYear(),i.getMonth(),i.getDate(),f.getHours(),f.getMinutes())))});let u=!1;if(Object.entries(n.recurrence.recurrenceEvents).forEach(([l,h])=>{Object.entries(h).forEach(([f,m])=>{if(!(!m.blockSchedule&&m.isBreak)&&!(m.isVacation&&r)&&!u){if(s&&t&&t.recurrenceEvent){const p=kt(f),y=Q(a,new V({hours:p.getHours(),minutes:p.getMinutes()}));if(c.has(oe(y)))return}if(m.recurrenceEvent&&m.recurrenceEvent.isAccureInDate({date:a})){const p=kt(f);m.isVacation&&(u=!0,o.length=0),o.push(p,Q(p,new V({minutes:m.durationMinutes})))}}})}),s&&t&&t.workerId===n.id&&!t.recurrenceEvent){const l=tn(t.bookingDate);if(a.getTime()/1e3-l.getTime()/1e3===0){let h=la(t.bookingDate);bt.fromTreatmentsMap(t.treatments).times.forEach((m,p)=>{h=Q(h,new V({minutes:m.breakMinutes}));const y=Q(h,new V({minutes:m.workMinutes}));o.splice(o.indexOf(h),2),o.splice(o.indexOf(y),2),h=y})}}return o}function U9(n,e,t){const i=un(new Date),s=t??e===Me(new Date),r=n<kt(i);return s&&r}function W9(n,e){const t=un(new Date),i=e===Me(new Date),s=n<kt(t);return i&&s}function H9(n,e){const t=new Map;let i=e;return bt.fromTreatmentsMap(n.treatments).times.forEach((r,o)=>{i=Q(i,new V({minutes:r.breakMinutes})),t.set(o,{start:i,duration:new V({minutes:r.workMinutes})}),i=Q(i,new V({minutes:r.workMinutes}))}),t}function $9(n,e){const t=new Map,i=bt.fromTreatmentsMap(n.treatments);let s=Rn(e,new V({minutes:i.totalMinutes}));return i.times.forEach((r,o)=>{s=Q(s,new V({minutes:r.breakMinutes})),t.set(o,{start:s,duration:new V({minutes:r.workMinutes})}),s=Q(s,new V({minutes:r.workMinutes}))}),t}function B5(n,e,t,i,s){if(!i.workerPublicData.duringPaymentBookingsTime[t])return!1;const r=[];Object.entries(i.workerPublicData.duringPaymentBookingsTime[t]).forEach(([l,h])=>{try{const f=kt(l),m=Q(f,new V({minutes:h[1]}));r.push(f,m)}catch(f){de.error(`Error while creating the during payment list, illegal list -> ${h}
${f}`)}});const o=Z3(r,e),a=bt.fromTreatmentsMap(n.treatments),c=Array.from({length:a.times.keys.length},(l,h)=>0);return AD(c,s,o)!==0}function q9(n,e=!1){const t=n.getMinutes(),i=Math.floor(t/10),s=t%10,r=Math.ceil(s/5);return e?new Date(1970,0,1,n.getHours(),i*10+r*5):new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),i*10+r*5)}function Sa({worker:n,booking:e,isUpdate:t=!1,oldBooking:i,workerSheet:s=!1,reverse:r=!1,workerAction:o=!1,amoutLimit:a,recurrenceSkipDate:c}){const u=[];if(n===void 0||DD(n,e.bookingDate,o,s))return u;const l=Me(e.bookingDate),h=e8(n.shiftsFor({day:e.bookingDate})),m=V9({worker:n,bookingDate:l,isUpdate:t,workerAction:o,oldBooking:i,recurrenceSkipDate:c});m.sort(),h.sort();const p=bt.fromTreatmentsMap(e.treatments);if(console.log("work",h),console.log("forbbidenTimes",m),console.log("treatment",p),r)return z9({worker:n,work:h,forbbidenTimes:m,bookingDate:l,treatment:p,booking:_t.fromBooking(e),workerSheet:s,amoutLimit:a});const y=Array.from({length:p.times.size},()=>0);console.log("forbiddenTimesPointers",y);let g=q9(new Date,!0);console.log("currentTime",g);let x=0;for(let _=0;_<h.length;_+=2){let v=h[_];const w=h[_+1];if(console.log("pointerWork",v),console.log("endWork",w),U9(v,l)){switch(_c(g,g,v,w)){case"BEFORE":de.debug("Alg duration status - BEFORE");continue;case"AFTER":de.debug("Alg duration status - AFTER");break;case"STRIKE":de.debug("Alg duration status - STRIKE");break}v=g}const I=H9(e,v),T=Array.from(I.values()),D=T[T.length-1],C=T[0];for(console.log("valuesArr",T),console.log("valuesArr",T),console.log("lastTimeSegment",D),console.log("firstTimeSegment",C);Q(D.start,D.duration)<=w;){if(x++,x>500){de.error("Infinity loop in times algorithm - stopping");break}const R=AD(y,I,m),E=B9(C.start,m,y,n),A=R===0;if(console.log("pointerWork",v),console.log("minutesToJump",R),console.log("jump",E),A){const k=C.start,P=new Date(e.bookingDate.getFullYear(),e.bookingDate.getMonth(),e.bookingDate.getDate(),k.getHours(),k.getMinutes());if(console.log("allowedTime",A),console.log("timeToAdd",k),console.log("timeToAdd",k),u.push(new xn({displayDate:P})),a!==void 0&&a>=u.length)return u;s?Gn(I,5):(console.log("BEFORE"),I.forEach((G,j)=>{console.log("Values for key",j),console.log(G.start),console.log(G.duration)}),Gn(I,E),console.log("AFTER"),I.forEach((G,j)=>{console.log("Values for key",j),console.log(G.start),console.log(G.duration)}))}else m.length-1<y[0]+1?s?Gn(I,5):Gn(I,E):Gn(I,R)}}return u}function z9({worker:n,work:e,forbbidenTimes:t,bookingDate:i,treatment:s,booking:r,workerSheet:o=!1,amoutLimit:a}){const c=[];if(DD(n,r.bookingDate,!1,o))return c;const u=Array.from({length:s.times.size},()=>t.length-1);let l=0;for(let h=e.length-1;h>=0;h-=2){const f=e[h],m=e[h-1],p=$9(r,f),g=Array.from(p.values())[0];for(;g.start>=m;){if(l++,l>500){de.error("Infinity loop in times algorithm - stopping");break}if(W9(g.start,i))break;const x=F9(u,p,t),_=L9(g.start,t,u,n);if(x===0){const w=g.start,I=new Date(r.bookingDate.getFullYear(),r.bookingDate.getMonth(),r.bookingDate.getDate(),w.getHours(),w.getMinutes());if(c.push(new xn({displayDate:I})),a!==void 0&&a>=c.length)return c;o?Gn(p,-5):Gn(p,-_)}else u[0]<0?o?Gn(p,-5):Gn(p,-_):Gn(p,-x)}}return c}function G9({worker:n,dateForCheck:e,treatment:t}){const i=[];if(Me(n.closeCalendarDate??new Date(0))===Me(e)||!n.openCalendar)return i;const s=n.multiEventsTimes.times[Me(e)]??{};return Object.entries(s).forEach(([r,o])=>{if(o.treatmentId===t.id&&o.index===0){const a=kt(r),c=new Date(e.getFullYear(),e.getMonth(),e.getDate(),a.getHours(),a.getMinutes());if(c<new Date)return;const u=o.maxParticipants??t.participants;i.push(new xn({isMulti:!0,showMultiWaitingList:o.showWaitingList,signedPaymentRequestId:o.paymentRequestId,displayDate:c,maxParticipants:u,isWaitingList:u<=o.currentParticipants,currentParticipants:o.currentParticipants,showParticipants:t.showParticipants}))}}),Object.entries(n.recurrence.recurrenceEvents).forEach(([r,o])=>{Object.entries(o).forEach(([a,c])=>{var h;if(!c.isMulti||c.recurrenceEvent===null||c.treatmentId!==t.id||!((h=c.recurrenceEvent)!=null&&h.isAccureInDate({date:e}))||c.eventIndex!==0)return;const u=kt(a),l=new Date(e.getFullYear(),e.getMonth(),e.getDate(),u.getHours(),u.getMinutes());i.push(new xn({displayDate:l,isMulti:!0,recurrenceTimeId:c.timeId??void 0,recurrenceFatherBookingId:c.recurrenceFatherBookingId,maxParticipants:t.participants,currentParticipants:c.currentParticipants,isWaitingList:t.participants<=c.currentParticipants,showParticipants:t.showParticipants,recurrenceMultiEvent:c.recurrenceEvent,fatherRecurrenceMultiEventDate:c.from}))})}),i.sort((r,o)=>r.displayDate.getTime()-o.displayDate.getTime()),i}function Y9(n,e,t,i,s,r){const o=yn(dt);if(zt.visibleDates=n,console.log(o),e==null)return;zt.timePickerObjects={},n.length>1&&(zt.firstDateToShow=n[0]);const a=j9(e);if(a===void 0)return;const c={};let u=0;n.forEach((h,f)=>{if(h>=a||h<ng(new Date))return;let m=[];if(o.isMultiEvent===!0)Object.keys(o.services).length===1&&(m=G9({worker:e,dateForCheck:h,treatment:Object.values(o.services)[0]}));else{const p=zt.bookingFromValues;switch(p.bookingDate=h,m=[],e.windowSpaces){case Bn.first:m=Sa({worker:e,booking:_t.fromBooking(p),isUpdate:i,oldBooking:s,recurrenceSkipDate:r,amoutLimit:1});break;case Bn.last:m=Sa({worker:e,booking:_t.fromBooking(p),isUpdate:i,oldBooking:s,recurrenceSkipDate:r,reverse:!0,amoutLimit:1});break;case Bn.edges:m=J9(e,p,s,i,r);break;default:m=Sa({worker:e,booking:_t.fromBooking(p),isUpdate:i,oldBooking:s,recurrenceSkipDate:r});break}}if(m.length<=0){c[Me(h)]=[];return}c[Me(h)]=m,u=Math.max(u,c[Me(h)].length)}),u=Math.max(u+1,15),u+=e.showWaitingListWhenThereIsChoises?4:0,K9(u,t);const l=Q9(t);console.log(u),Object.entries(c).forEach(([h,f])=>{const m=vt(h);if(e.recurrence.vacationInDate(m)!=null){if(e.showVacations){const g=new xn({displayDate:void 0,isVacation:!0});g.from=m,g.duration=new V({minutes:Math.floor(l*1.3)}),zt.timePickerObjects[g.id]=g.toJson()}return}if(L1(e,m)&&e.closeScheduleOnHolidays){const g=new xn({displayDate:void 0,isHoliday:!0});g.from=m,g.duration=new V({minutes:Math.floor(l*1.3)}),zt.timePickerObjects[g.id]=g.toJson();return}const p=Math.floor(ID/u);console.log(p);let y=0;if(f.forEach((g,x)=>{if(o.isMultiEvent!==!0||g.hasFreePlace){const _=g.showParticipants&&g.isMulti?Math.ceil(p*1.5):p;let v=Q(m,new V({minutes:y}));S1.has(m)&&v>Q(m,new V({hours:1}))&&(v=Q(v,new V({hours:1})));const w=xn.fromTimePickerObj(g);w.from=v,w.duration=new V({minutes:_}),zt.timePickerObjects[w.id]=w.toJson(),y+=_}else{if(o.isMultiEvent===!0&&!g.showMultiWaitingList)return;const _=new xn({...g,isWaitingList:!0});_.from=Q(m,new V({minutes:y})),_.duration=new V({minutes:Math.ceil(l*1.1)}),zt.timePickerObjects[_.id]=_.toJson(),y+=Math.ceil(l*1.1)}}),(f.length===0||e.showWaitingListWhenThereIsChoises)&&o.isMultiEvent!=!0){const g=new xn({displayDate:void 0,isWaitingList:!0});g.from=Q(m,new V({minutes:y})),g.duration=new V({minutes:l}),zt.timePickerObjects[g.id]=g.toJson();return}})}function J9(n,e,t,i,s){const r=Sa({worker:n,booking:_t.fromBooking(e),isUpdate:i,oldBooking:t,recurrenceSkipDate:s,amoutLimit:1}),o=Sa({worker:n,booking:_t.fromBooking(e),reverse:!0,isUpdate:i,oldBooking:t,recurrenceSkipDate:s,amoutLimit:1}),a=new Set;return r.length>0&&a.add(r[0]),o.length>0&&a.add(o[0]),Array.from(a)}function K9(n,e){if(n===0)return;const t=Math.floor(ID/n);e[0]=N9*(TD/t)}function Q9(n){const e=M9/n[0];return Math.ceil(e*TD)}function j9(n){if(n!==void 0)return Q(ng(new Date),new V({days:n.daysToAllowBookings}))}const dt=Io(),It=class It{static initializeBookingMaker({bookingForUpdate:e}){console.log("eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee");const t={workerId:e==null?void 0:e.workerId,showVerificationAlert:!1,services:{},date:e==null?void 0:e.bookingDate,isUpdate:e!=null,currentPaymentType:zn.payment,currentCurrencyCode:e==null?void 0:e.currency.code,pickMultipleServices:((e==null?void 0:e.treatmentLength)??0)>1,hasMultiTreatment:!1,isBookingWithPaymentUpdate:!1,currentStep:0,isMultiEvent:!1};e==null||e.treatments.forEach((i,s)=>{t.services[i.id]=i}),console.log(t),It.oldBooking=e,dt.set(t)}static get worker(){const e=yn(dt);return Xe.GI().workers[e.workerId??""]}static setWorkerId(e){const t=yn(dt);if(e===t.workerId){t.currentStep+=1,dt.set(t);return}Xe.GI().cancelAllWorkersRegularListenings();const i=Xe.GI().workers[e];i!=null&&Xe.GI().startWorkerListening(i);const s=Xe.GI().workers[e];s!=null&&(t.showVerificationAlert=sw(s)),t.workerId=e,t.currentStep+=1,dt.set(t)}static updateWorkerData(e){const t=yn(dt);console.log("rrrrrrrrrrrrrrrr",t),de.debug("Getting new data for the worker");const i={...t.services};Object.keys(i).forEach(r=>{e.hasTreatemnt(r)||delete t.services[r]}),e.treatmentsSubjects.forEach((r,o)=>{r.treatments.forEach((a,c)=>{if(t.services.hasOwnProperty(a.id)){const u=t.services[a.id].count,l=bt.fromTreatment(a);l.count=u,t.services[a.id]=l}})});const s=Xe.GI().workers[t.workerId];s!=null&&(t.showVerificationAlert=sw(s)),dt.set(t),t.workerId!=null&&Object.entries(t.services).length>0&&It.scheduleObj!=null&&(It.scheduleObj.deleteEvent(Object.values(It.timePickerObjects)),Y9(It.scheduleObj.getCurrentViewDates(),It.worker,[30]),It.scheduleObj.addEvent(Object.values(It.timePickerObjects)))}static get bookingFromValues(){const e=yn(dt),t=new _t({workerId:e.workerId});t.bookingDate=e.date??new Date(0);const i=Xe.GI().workers[e.workerId??""];if(i==null)return t;const s=new Map;let r=0;return Object.entries(e.services).forEach(([o,a])=>{s.set(r.toString(),a),r+=1}),t.treatments=s,t}static onTapService(e){const t=yn(dt);if(t.isBookingWithPaymentUpdate&&!t.services.hasOwnProperty(e.id)){Gi({text:J("cantEditTreatmentOnPaymentBooking"),status:"warning"});return}if(t.isUpdate&&e.amountInAdvance>0){Gi({text:J("cantChoosePaymentServiceOnBookingUpdate"),status:"warning"});return}t.services.hasOwnProperty(e.id)?t.pickMultipleServices?this.removeService(t,e):(t.currentStep+=1,dt.set(t)):e.isMulti?this.addMultiService(t,e):this.addService(t,e)}static addMultiService(e,t){if(e.pickMultipleServices&&Object.keys(e.services).length>0){Gi({text:J(e.hasMultiTreatment?"noMultiWithMulti":"noMultiWithRegular",void 0,!1),status:"warning"});return}e.services={[t.id]:t};const i=Xe.GI().workers[e.workerId??""];i!==void 0&&(Xe.GI().startTimesListening(i,t.isMulti),e.currentStep+=1,dt.set(e))}static removeService(e,t){Object.keys(e.services).length===1&&(e.currentCurrencyCode=void 0,e.currentPaymentType=void 0),e.services[t.id].count=1,delete e.services[t.id],dt.set(e)}static addService(e,t){console.log("addService");let i=0;Object.values(e.services).forEach(r=>{i+=r.count});const s=Xe.GI().workers[e.workerId??""];if(s!==void 0){if(e.pickMultipleServices&&e.hasMultiTreatment){Gi({text:J("noMultiWithRegular"),status:"warning"});return}if(i>=s.maxTreatments){Gi({text:J("userMaxTreatments").replace("AMOUNT",s.maxTreatments.toString()),status:"warning"});return}if(e.pickMultipleServices&&t.amountInAdvance>0&&t.paymentType!=null&&t.paymentType!=e.currentPaymentType&&e.currentPaymentType!=null){Gi({text:J("cantPickDiffrentPaymentType"),status:"warning"});return}if(e.pickMultipleServices&&t.price.currency.code!=e.currentCurrencyCode&&e.currentCurrencyCode!=null){Gi({text:J("cantPickDiffrentCurrencies"),status:"warning"});return}Xe.GI().startTimesListening(s,t.isMulti),e.currentCurrencyCode=t.price.currency.code,t.amountInAdvance>0&&(e.currentPaymentType=t.paymentType),e.pickMultipleServices||(e.services={},e.currentStep+=1),e.services[t.id]=t,dt.set(e)}}static onRemoveTreatmentCount(e){var i;const t=yn(dt);t.services[e.id]!==void 0&&(((i=t.services[e.id])==null?void 0:i.count)===1?this.removeService(t,e):(t.services[e.id].count=-1,dt.set(t)))}static onAddTreatmentCount(e){const t=yn(dt);if(t.services[e.id]==null)return;let i=0;if(Object.entries(t.services).forEach(([s,r])=>{if(t.services.hasOwnProperty(s)){const o=t.services[s];i+=o.count}}),i>=It.worker.maxTreatments){Gi({text:J("userMaxTreatments").replaceAll("AMOUNT",It.worker.maxTreatments.toString()),status:"warning"});return}dt.set(t)}};d(It,"timePickerObjects",{}),d(It,"oldBooking"),d(It,"visibleDates",[]),d(It,"scheduleObj"),d(It,"firstDateToShow");let zt=It;function sw(n){const e=new _t({});return e.userFcms=Ai.GI().user.fcmsTokens,e.isVerifiedPhone=!0,(P1({booking:e,worker:n})==Z.message||n.mustVerifyPhone)&&!Ai.GI().user.isVerifiedPhone}const Ra=class Ra{constructor(){d(this,"defaultTheme","darkIos");d(this,"currentKeyTheme",null);d(this,"themeCauseMainBuilt",!1);d(this,"currentThemes",{...cT});d(this,"currentBusinessTheme",null)}static GI(){return Ra._singleton}async changeTheme(e,{needOverlayHandling:t=!0,ovveride:i=!1,needWaitOverlay:s=!1}={}){var o;const r=this.currentThemes[e];if(r==null||this.currentBusinessTheme==null||!r.isEqual(this.currentBusinessTheme)||i){switch((o=this.currentThemes[e])==null?void 0:o.brightness){case h0.light:Xe.GI().businessIcon="darkShopIcon";break;case h0.dark:Xe.GI().businessIcon="lightShopIcon";break;default:Xe.GI().businessIcon="lightShopIcon";break}return this.themeCauseMainBuilt=!0,this.currentKeyTheme=e,this.currentThemes.hasOwnProperty(e)&&(this.currentBusinessTheme=this.currentThemes[e]),!0}return!1}};d(Ra,"_singleton",new Ra);let O0=Ra,X9=Io(),Z9=Io();function e5(n,e){const t=e.split("--")[0];return gt.developers.hasOwnProperty(t)&&(n=gt.developers[t].businessProductId),n.includes("basic")?Ss.basic:n.includes("landing")?Ss.landingPage:n.includes("advanced")?Ss.advanced:n.includes("golden")?Ss.golden:Ss.trial}const fi=class fi{constructor(){d(this,"generalRepo",new V1);d(this,"business",new sr({businessId:"",design:new xi}));d(this,"workers",{});d(this,"businessIcon","");d(this,"businessSubtype",Ss.trial)}static GI(){return fi.instance||(fi.instance=new fi),fi.instance}async initSettings(e,{fromLoading:t=!1}={}){try{this.workers={},gt.currentBusinesssId=e;const i=await Promise.all([this._loadSettingsDoc(e),this._loadBusinessWorkers(e)]);return this.businessSubtype=e5(this.business.productId,e),i.length>0&&i[0]===!1?!1:(this.makeBusinessDataListener(),!0)}catch(i){return de.error(`Error while initializing settings --> ${i}`),!1}}async loadBusiness(e,t,{fromLoading:i=!1,fromSearch:s=!1}={}){try{const r=await this.initSettings(e,{fromLoading:i});return O0.GI().themeCauseMainBuilt,Z9.set(fi.GI().workers),X9.set(fi.GI().business),!0}catch{return!1}}async _loadSettingsDoc(e){try{const t=await this.generalRepo.getDocRepo({path:Tt,docId:e});return t===void 0||!t.exists||t.data()===null?(ve.GI().error=ie.notFoundBusiness,!1):(this.business=sr.fromJson(t.data(),e),!0)}catch{return!1}}async _loadBusinessWorkers(e){try{const t=`${Tt}/${e}/${sn}`,i=await this.generalRepo.getAllDocsInsideCollection(t);return i!==null&&i.forEach(s=>{const r=lc.fromWorkerDocJson(s);Ai.GI().getPermission>1||(r.id,Ai.GI().user.id),this.workers[r.id]=r}),!0}catch(t){return t instanceof Error&&(de.error(`Error while loading the business workers docs --> ${t}`),de.error(t.stack)),!0}}async makeBusinessDataListener(){const e=Fa.GI().getBusinessDataPath(gt.currentBusinesssId);this.business.businessData.listener=this.generalRepo.listenToChild({childPath:e,callback:t=>{t.exists()&&this.business.businessData.setBusinessData(t)}})}startWorkerListening(e){try{console.log("cjdoscijdsoicdos"),e.workerDocListner||(console.log("cjdoscijdsoge2542353454"),e.workerDocListner=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${sn}`,docId:e.id,onChanged:t=>{this.updateWorkerObj(t,e.id)}})),e.publicCustomers.publicCustomersData===null&&this.generalRepo.getDocRepo({path:`${Tt}/${gt.currentBusinesssId}/${sn}/${e.id}/${at}`,docId:WC}).then(t=>{t.exists()&&t.data()!==null&&e.publicCustomers.setPublicCustomersDataJson(t.data())})}catch(t){console.error(`Error while resuming the Worker listener --> ${t}`)}}updateWorkerObj(e,t){if(e.exists()){if(!Object.keys(this.workers).includes(t))return;this.workers[t].setFromWorkerDoc(e.data()),zt.updateWorkerData(this.workers[t])}else{delete this.workers[t];return}de.info(`Get new worker for the current worker updateWorkerObj--> ${t}`)}cancelAllWorkersRegularListenings(e=!1){Object.values(this.workers).map(async t=>{try{(e||t.id!==Ai.GI().user.id&&Ai.GI().getPermission<2)&&(t.workerDocListner!=null&&(t.workerDocListner(),t.workerDocListner=void 0),t.recurrence.listener!=null&&(t.recurrence.listener(),t.recurrence.listener=void 0)),t.workerPublicData.listener!=null&&(t.workerPublicData.listener(),t.workerPublicData.listener=void 0),t.multiEventsTimes.listener!=null&&(t.multiEventsTimes.listener(),t.multiEventsTimes.listener=void 0),de.info("Workers Listenings have canceled")}catch{console.error("Error while canceling the Workers listeners")}})}startTimesListening(e,t){e.workerPublicData.listener==null&&(e.workerPublicData.listener=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${sn}/${e.id}/${at}`,docId:nn,onChanged:i=>{this.updateWorkerPublicData(i,e.id)}})),e.recurrence.listener===void 0&&e.hasRecurrenceEvents&&e.isCustomersNeedRecurrence&&(e.recurrence.listener=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${sn}/${e.id}/${at}`,docId:Fw,onChanged:i=>{this.updateReccurenceEvents(i,e.id)}})),e.multiEventsTimes.listener===void 0&&t&&(e.multiEventsTimes.listener=this.generalRepo.docListenerRepo({path:`${Tt}/${this.business.businessId}/${sn}/${e.id}/${at}`,docId:Lw,onChanged:i=>{this.updateMultiEventsTimes(i,e.id)}}))}updateWorkerPublicData(e,t){this.workers[t]!==void 0&&(!e.exists()||e.data()===void 0||(this.workers[t].workerPublicData.setWorkerPublicData(e.data()),zt.updateWorkerData(this.workers[t]),de.debug(`Get new workerData for the current worker updateWorkerPublicData--> ${t}`)))}updateReccurenceEvents(e,t){this.workers[t]!==void 0&&(!e.exists()||e.data()===void 0||(this.workers[t].recurrence.setRecurrenceEvents(e.data()??{},t,this.business),zt.updateWorkerData(this.workers[t]),de.debug(`Get new workerData for the current worker updateReccurenceEvents --> ${t}`)))}updateMultiEventsTimes(e,t){this.workers[t]!==void 0&&(!e.exists()||e.data()===void 0||(this.workers[t].multiEventsTimes.setData(e.data()),zt.updateWorkerData(this.workers[t]),de.debug(`Get new workerData for the current worker updateReccurenceEvents --> ${t}`)))}};d(fi,"instance");let Xe=fi;export{Bt as $,Vx as A,Xe as B,e8 as C,V9 as D,Z3 as E,bt as F,V1 as G,Q as H,V as I,R5 as J,ve as K,ie as L,H9 as M,AD as N,B5 as O,da as P,Bw as Q,_t as R,tn as S,Le as T,Ca as U,P9 as V,P0 as W,f5 as X,hu as Y,fa as Z,Vs as _,at as a,sn as a0,h5 as a1,oe as a2,Fw as a3,d5 as a4,Ow as a5,Fa as a6,P1 as a7,F5 as a8,eo as a9,aN as aA,ng as aB,N5 as aC,un as aD,M5 as aE,S5 as aF,Z9 as aG,ua as aH,Vt as aI,zt as aJ,On as aK,k1 as aL,cT as aM,rg as aN,O5 as aO,A5 as aP,dt as aQ,xn as aR,Y9 as aS,D5 as aT,F6 as aU,m5 as aa,p5 as ab,b5 as ac,r8 as ad,Hn as ae,rr as af,Qr as ag,n8 as ah,k5 as ai,Nf as aj,Gi as ak,BC as al,g5 as am,_5 as an,y5 as ao,gf as ap,k9 as aq,Ng as ar,O0 as as,C5 as at,H0 as au,Rl as av,B0 as aw,Do as ax,JC as ay,Xg as az,X9 as b,nn as c,a5 as d,Tt as e,gt as f,c5 as g,u5 as h,o5 as i,_s as j,v5 as k,S0 as l,Ai as m,Ie as n,P5 as o,Xp as p,In as q,l5 as r,L1 as s,J as t,en as u,de as v,ZC as w,la as x,kt as y,Me as z};
